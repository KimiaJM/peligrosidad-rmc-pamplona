/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={25:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}},153:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(8038),i=r(797);const o={loadResources:async function(e,t,r){if(e){const e=(await n.A.ajax({url:t+r+".json",method:"GET",responseType:i.A.mimeType.JSON})).data;o[r]=o[r]||{},Object.assign(o[r],e),o.currentLocale=o[r],o.currentLocaleKey=r}else o.currentLocale=o[r]}},a=o},187:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,H:()=>u});var n=r(8038),i=r(797),o=r(3301);let a,s=n.A.apiLocation;/^http?:/.test(s)?/^https?:/.test(s)||(s=(globalThis.location?.protocol??"")+n.A.apiLocation):s=new URL(n.A.apiLocation,globalThis.location?.href??"").href;const l=new XMLHttpRequest;l.open("GET",n.A.apiLocation+"config/predefined-layers.json",!1);let c="[]";l.onreadystatechange=function(e){4===l.readyState&&200===l.status&&(c=l.responseText)};try{l.send(null)}catch(e){console.error("Could not fetch predefined layer configuration"),console.error(e)}a=JSON.parse(c);for(const e of a)Object.prototype.hasOwnProperty.call(e,"url")&&(e.url=new URL(e.url,s).href),Object.prototype.hasOwnProperty.call(e,"thumbnail")&&(e.thumbnail=new URL(e.thumbnail,s).href);const u=(h={},{imageRatio:1.05,proxy:"",acceptedBrowserVersions:[],crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,locale:"es-ES",view:i.A.view.DEFAULT,screenSize:27,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,averageTileSize:31e3,availableBaseLayers:a,baseLayers:[i.A.layer.IDENA_BASEMAP,i.A.layer.IDENA_ORTHOPHOTO,i.A.layer.IDENA_CADASTER,i.A.layer.IDENA_CARTO],defaultBaseLayer:i.A.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,workLayerManager:!1,layerCatalog:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"https://idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},town:{},street:{},postalAddress:{},cadastralParcel:{}}},measure:!1,streetView:!1,click:!1,printMap:!1,featureInfo:{active:!0,persistentHighlights:!0},featureTools:!0},layout:null,styles:{point:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10},marker:{classes:[i.A.classes.MARKER+1,i.A.classes.MARKER+2,i.A.classes.MARKER+3,i.A.classes.MARKER+4,i.A.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-32],fontColor:"#000000",fontSize:10},line:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},polygon:{strokeColor:"#ff0000",strokeWidth:2,strokeOpacity:1,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10},label:{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#000000"},cluster:{point:{fillColor:"#333366",fillOpacity:.6,radius:function(e){var t=e.features.length,r=h[t];return r||(r=2+Math.round(5*Math.sqrt(t)),h[t]=r),r},label:"${features.length}",fontColor:"#ffffff",fontSize:9}},selection:{point:{fillColor:"#008000",fillOpacity:.5,strokeColor:"#008000",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10,zIndex:1},line:{strokeColor:"#008000",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10,zIndex:1},polygon:{strokeColor:"#008000",strokeWidth:2,fillColor:"#000000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#ffffff",fontColor:"#000000",fontSize:10,zIndex:1}},snapping:{point:{fillColor:"#00ffff",fillOpacity:.3,strokeColor:"#00ffff",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#ffffff",labelOffset:[0,-16],fontColor:"#000000",fontSize:10,zIndex:1}}}});var h;const d=o.A.extend(!0,{},u)},503:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(6514),i=r(915),o=r(1597),a=r(4294),s=r(2096),l=r(2497),c=r(6361);class u extends s.Ay{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){(0,n.X$)(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new u(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,n){if(n<(0,i.Ld)(this.getExtent(),e,t))return n;const a=this.flatCoordinates,s=this.stride;for(let i=0,l=a.length;i<l;i+=s){const l=(0,o.hG)(e,t,a[i],a[i+1]);if(l<n){n=l;for(let e=0;e<s;++e)r[e]=a[i+e];r.length=s}}return n}getCoordinates(){return(0,c.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new a.A(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,r=this.stride,n=[];for(let i=0,o=e.length;i<o;i+=r){const o=new a.A(e.slice(i,i+r),t);n.push(o)}return n}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,r=this.stride;for(let n=0,o=t.length;n<o;n+=r){const r=t[n],o=t[n+1];if((0,i.Rj)(e,r,o))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,l.z2)(this.flatCoordinates,0,e,this.stride),this.changed()}}const h=u},561:(e,t,r)=>{var n={"./AttributesEdit":7098,"./AttributesEdit.js":7098,"./Attribution":6394,"./Attribution.js":6394,"./BasemapSelector":4459,"./BasemapSelector.js":4459,"./CacheBuilder":5794,"./CacheBuilder.js":5794,"./Click":6083,"./Click.js":6083,"./Container":8848,"./Container.js":8848,"./ControlContainer":7843,"./ControlContainer.js":7843,"./Coordinates":5272,"./Coordinates.js":5272,"./DataLoader":2484,"./DataLoader.js":2484,"./Download":3387,"./Download.js":3387,"./Draw":5121,"./Draw.js":5121,"./DrawMeasureModify":4532,"./DrawMeasureModify.js":4532,"./Edit":3607,"./Edit.js":3607,"./Elevation":7088,"./Elevation.js":7088,"./ExternalWMS":2335,"./ExternalWMS.js":2335,"./FeatureDownloadDialog":5357,"./FeatureDownloadDialog.js":5357,"./FeatureInfo":8927,"./FeatureInfo.js":8927,"./FeatureInfoCommons":9687,"./FeatureInfoCommons.js":9687,"./FeatureStyler":1092,"./FeatureStyler.js":1092,"./FeatureTools":7830,"./FeatureTools.js":7830,"./FileEdit":3721,"./FileEdit.js":3721,"./FileImport":780,"./FileImport.js":780,"./FullScreen":1302,"./FullScreen.js":1302,"./Geolocation":3093,"./Geolocation.js":3093,"./GeometryFeatureInfo":5909,"./GeometryFeatureInfo.js":5909,"./ImageMagnifier":5112,"./ImageMagnifier.js":5112,"./InfoDisplay":9105,"./InfoDisplay.js":9105,"./LanguageSelector":2376,"./LanguageSelector.js":2376,"./LayerCatalog":9683,"./LayerCatalog.js":9683,"./LayerLegend":9239,"./LayerLegend.js":9239,"./Legend":3126,"./Legend.js":3126,"./LineFeatureInfo":2875,"./LineFeatureInfo.js":2875,"./ListTOC":2189,"./ListTOC.js":2189,"./LoadingIndicator":5874,"./LoadingIndicator.js":5874,"./MapContents":3967,"./MapContents.js":3967,"./MapInfo":1421,"./MapInfo.js":1421,"./Measure":1979,"./Measure.js":1979,"./Measurement":6052,"./Measurement.js":6052,"./Modify":3333,"./Modify.js":3333,"./MultiFeatureInfo":5882,"./MultiFeatureInfo.js":5882,"./NavBar":9433,"./NavBar.js":9433,"./NavBarHome":8994,"./NavBarHome.js":8994,"./OfflineMapMaker":2994,"./OfflineMapMaker.js":2994,"./OverviewMap":9770,"./OverviewMap.js":9770,"./PolygonFeatureInfo":8839,"./PolygonFeatureInfo.js":8839,"./Popup":3521,"./Popup.js":3521,"./Print":5056,"./Print.js":5056,"./PrintMap":5232,"./PrintMap.js":5232,"./ProjectionSelector":7735,"./ProjectionSelector.js":7735,"./ResultsPanel":1535,"./ResultsPanel.js":1535,"./SWCacheClient":4128,"./SWCacheClient.js":4128,"./Scale":4641,"./Scale.js":4641,"./ScaleBar":2180,"./ScaleBar.js":2180,"./ScaleSelector":4272,"./ScaleSelector.js":4272,"./Search":2639,"./Search.js":2639,"./SelectContainer":6728,"./SelectContainer.js":6728,"./Share":2268,"./Share.js":2268,"./StreetView":3833,"./StreetView.js":3833,"./TOC":2773,"./TOC.js":2773,"./TabContainer":1993,"./TabContainer.js":1993,"./ThreeD":1783,"./ThreeD.js":1783,"./TrackDownloadDialog":9096,"./TrackDownloadDialog.js":9096,"./TrackEdit":9740,"./TrackEdit.js":9740,"./WFSEdit":7633,"./WFSEdit.js":7633,"./WFSQuery":4193,"./WFSQuery.js":4193,"./WebComponentControl":1845,"./WebComponentControl.js":1845,"./WorkLayerManager":6378,"./WorkLayerManager.js":6378,"./infoShare":5264,"./infoShare.js":5264,"./itemToolContainer":575,"./itemToolContainer.js":575,"./layerOwner":2935,"./layerOwner.js":2935};function i(e){return o(e).then(r)}function o(e){return Promise.resolve().then((()=>{if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}))}i.keys=()=>Object.keys(n),i.resolve=o,i.id=561,e.exports=i},575:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(3301),o=r(797),a=r(2902);n.A.control=n.A.control||{};const s={_uiElementSelector:"ul > li",_toolContainerSelector:".tc-item-tools",isItemToolContainer:!0,getItemTools:function(){const e=this;return e.itemTools||(e.itemTools=[]),e.itemTools},getItemUIElements:function(e){const t=this;return e&&(t._uiElementSelector=e),Array.from(t.div.querySelectorAll(t._uiElementSelector))},getToolContainer:function(e){return e.querySelector(this._toolContainerSelector)},addItemToolUI:function(e,t){const r=this;if(i.A.isFunction(t.renderFn)){const n=r.getToolContainer(e),s=t.renderFn(n,e.dataset.layerId);if(s){const e=n.querySelector(".tc-item-tool-last");if(e?e.insertAdjacentElement("beforebegin",s):n.appendChild(s),i.A.isFunction(t.actionFn)){const e=s instanceof a.A?"change":o.A.event.CLICK;s.addEventListener(e,(function(e){t.actionFn.call(s)}),{passive:!0})}i.A.isFunction(t.updateFn)&&t.updateEvents&&r.map.on(t.updateEvents.join(" "),(function(e){e.layer&&e.layer.id!==s.dataset.layerId||t.updateFn.call(s,e)}))}}},addItemTool:function(e){const t=this;t.getItemTools().push(e),t.getItemUIElements().forEach((function(r){t.addItemToolUI(r,e)}))}};n.A.control.itemToolContainer=s;const l=s},581:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(915),i=r(7947),o=r(3942),a=r(8217),s=r(1386),l=r(7468);const c=s.M+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",u={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class h extends s.A{constructor(e){super(e=e||{}),this.FEATURE_COLLECTION_PARSERS[s.M].featureMember=(0,o.VT)(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:c}readFlatCoordinates(e,t){const r=(0,o.mT)(e,!1).replace(/^\s*|\s*$/g,""),n=t[0].srsName;let a="enu";if(n){const e=(0,i.Jt)(n);e&&(a=e.getAxisOrientation())}const s=r.trim().split(/\s+/),l=[];for(let e=0,t=s.length;e<t;e++){const t=s[e].split(/,+/),r=parseFloat(t[0]),n=parseFloat(t[1]),i=3===t.length?parseFloat(t[2]):0;a.startsWith("en")?l.push(r,n,i):l.push(n,r,i)}return l}readBox(e,t){const r=(0,o.eY)([null],this.BOX_PARSERS_,e,t,this);return(0,n.N)(r[1][0],r[1][1],r[1][3],r[1][4])}innerBoundaryIsParser(e,t){const r=(0,o.eY)(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}outerBoundaryIsParser(e,t){const r=(0,o.eY)(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)}GEOMETRY_NODE_FACTORY_(e,t,r){const n=t[t.length-1],i=n.multiSurface,a=n.surface,s=n.multiCurve;return Array.isArray(e)?r="Envelope":"MultiPolygon"===(r=e.getType())&&!0===i?r="MultiSurface":"Polygon"===r&&!0===a?r="Surface":"MultiLineString"===r&&!0===s&&(r="MultiCurve"),(0,o.qq)("http://www.opengis.net/gml",r)}writeFeatureElement(e,t,r){const n=t.getId();n&&e.setAttribute("fid",n);const i=r[r.length-1],a=i.featureNS,s=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[a]={});const c=[],u=[];if(t.hasProperties()){const e=t.getProperties();for(const t in e){const r=e[t];null!=r&&(c.push(t),u.push(r),t==s||"function"==typeof r.getSimplifiedGeometry?t in i.serializers[a]||(i.serializers[a][t]=(0,o.mm)(this.writeGeometryElement,this)):t in i.serializers[a]||(i.serializers[a][t]=(0,o.mm)(l.uB)))}}const h=Object.assign({},i);h.node=e,(0,o.NQ)(h,i.serializers,(0,o.X1)(void 0,a),u,r,c)}writeCurveOrLineString(e,t,r){const n=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&n&&e.setAttribute("srsName",n),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){const n=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(n),this.writeCoordinates_(n,t,r)}else if("Curve"===e.nodeName){const n=(0,o.qq)(e.namespaceURI,"segments");e.appendChild(n),this.writeCurveSegments_(n,t,r)}}writeLineStringOrCurveMember(e,t,r){const n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,r))}writeMultiCurveOrLineString(e,t,r){const n=r[r.length-1],i=n.hasZ,a=n.srsName,s=n.curve;a&&e.setAttribute("srsName",a);const l=t.getLineStrings();(0,o.NQ)({node:e,hasZ:i,srsName:a,curve:s},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeGeometryElement(e,t,r){const n=r[r.length-1],i=Object.assign({},n);let s;i.node=e,s=Array.isArray(t)?(0,a.zU)(t,n):(0,a.hX)(t,!0,n),(0,o.NQ)(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[s],r,void 0,this)}createCoordinatesNode_(e){const t=(0,o.qq)(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,r){const n=r[r.length-1],i=n.hasZ,o=n.srsName,a=t.getCoordinates(),s=a.length,c=new Array(s);for(let e=0;e<s;++e){const t=a[e];c[e]=this.getCoords_(t,o,i)}(0,l.uB)(e,c.join(" "))}writeCurveSegments_(e,t,r){const n=(0,o.qq)(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,r)}writeSurfaceOrPolygon(e,t,r){const n=r[r.length-1],i=n.hasZ,a=n.srsName;if("PolygonPatch"!==e.nodeName&&a&&e.setAttribute("srsName",a),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){const n=t.getLinearRings();(0,o.NQ)({node:e,hasZ:i,srsName:a},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,n,r,void 0,this)}else if("Surface"===e.nodeName){const n=(0,o.qq)(e.namespaceURI,"patches");e.appendChild(n),this.writeSurfacePatches_(n,t,r)}}RING_NODE_FACTORY_(e,t,r){const n=t[t.length-1],i=n.node,a=n.exteriorWritten;return void 0===a&&(n.exteriorWritten=!0),(0,o.qq)(i.namespaceURI,void 0!==a?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,r){const n=(0,o.qq)(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r)}writeRing(e,t,r){const n=(0,o.qq)(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,r)}getCoords_(e,t,r){let n=(t?(0,i.Jt)(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];return r&&(n+=","+(e[2]||0)),n}writePoint(e,t,r){const n=r[r.length-1],i=n.hasZ,o=n.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const s=t.getCoordinates(),c=this.getCoords_(s,o,i);(0,l.uB)(a,c)}writeMultiPoint(e,t,r){const n=r[r.length-1],i=n.hasZ,a=n.srsName;a&&e.setAttribute("srsName",a);const s=t.getPoints();(0,o.NQ)({node:e,hasZ:i,srsName:a},this.POINTMEMBER_SERIALIZERS,(0,o.X1)("pointMember"),s,r,void 0,this)}writePointMember(e,t,r){const n=(0,o.qq)(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,r)}writeLinearRing(e,t,r){const n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);const i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i),this.writeCoordinates_(i,t,r)}writeMultiSurfaceOrPolygon(e,t,r){const n=r[r.length-1],i=n.hasZ,a=n.srsName,s=n.surface;a&&e.setAttribute("srsName",a);const l=t.getPolygons();(0,o.NQ)({node:e,hasZ:i,srsName:a,surface:s},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,r,void 0,this)}writeSurfaceOrPolygonMember(e,t,r){const n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r))}writeEnvelope(e,t,r){const n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);const i=[t[0]+" "+t[1],t[2]+" "+t[3]];(0,o.NQ)({node:e},this.ENVELOPE_SERIALIZERS,o.OL,i,r,["lowerCorner","upperCorner"],this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const n=t[t.length-1].node;return(0,o.qq)("http://www.opengis.net/gml",u[n.nodeName])}}h.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:(0,o.Tb)(h.prototype.readFlatCoordinates)}},h.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:h.prototype.innerBoundaryIsParser,outerBoundaryIs:h.prototype.outerBoundaryIsParser}},h.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:(0,o.VT)(h.prototype.readFlatCoordinates)}},h.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:(0,o.Tb)(s.A.prototype.readPoint),MultiPoint:(0,o.Tb)(s.A.prototype.readMultiPoint),LineString:(0,o.Tb)(s.A.prototype.readLineString),MultiLineString:(0,o.Tb)(s.A.prototype.readMultiLineString),LinearRing:(0,o.Tb)(s.A.prototype.readLinearRing),Polygon:(0,o.Tb)(s.A.prototype.readPolygon),MultiPolygon:(0,o.Tb)(s.A.prototype.readMultiPolygon),Box:(0,o.Tb)(h.prototype.readBox)}},h.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:(0,o.mm)(h.prototype.writeCurveOrLineString),MultiCurve:(0,o.mm)(h.prototype.writeMultiCurveOrLineString),Point:(0,o.mm)(h.prototype.writePoint),MultiPoint:(0,o.mm)(h.prototype.writeMultiPoint),LineString:(0,o.mm)(h.prototype.writeCurveOrLineString),MultiLineString:(0,o.mm)(h.prototype.writeMultiCurveOrLineString),LinearRing:(0,o.mm)(h.prototype.writeLinearRing),Polygon:(0,o.mm)(h.prototype.writeSurfaceOrPolygon),MultiPolygon:(0,o.mm)(h.prototype.writeMultiSurfaceOrPolygon),Surface:(0,o.mm)(h.prototype.writeSurfaceOrPolygon),MultiSurface:(0,o.mm)(h.prototype.writeMultiSurfaceOrPolygon),Envelope:(0,o.mm)(h.prototype.writeEnvelope)}},h.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:(0,o.mm)(h.prototype.writeLineStringOrCurveMember),curveMember:(0,o.mm)(h.prototype.writeLineStringOrCurveMember)}},h.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:(0,o.mm)(h.prototype.writeRing),innerBoundaryIs:(0,o.mm)(h.prototype.writeRing)}},h.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:(0,o.mm)(h.prototype.writePointMember)}},h.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:(0,o.mm)(h.prototype.writeSurfaceOrPolygonMember),polygonMember:(0,o.mm)(h.prototype.writeSurfaceOrPolygonMember)}},h.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:(0,o.mm)(l.uB),upperCorner:(0,o.mm)(l.uB)}};const d=h},588:(e,t,r)=>{"use strict";function n(e,t){if(!e)throw new Error(t)}r.d(t,{v:()=>n})},780:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>_});var n=r(8038),i=r(797),o=r(1845),a=r(4370),s=r(2935),l=r(3301),c=r(3790),u=r.n(c),h=r(7018),d=r(1651),p=r(8606),g=r(6257),f=r(6546),m=r(1667),y=r(6792),v=r(3791),A=r(5777);n.A.control=n.A.control||{};const S="sitna-file-import";class E{constructor(){this.openFile="",this["fileImport.instructions"]="",this.fileAccessPrompt="",this.close="",this.ok=""}}class w extends o.default{#e=new Map;constructor(){super(...arguments);const e=this;if(e.model=new E,e.LAYER_METADATA_STORE_KEY_PREFIX="TC.fileLayerMetadata.",e._dialogDiv=l.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.fileTypes=[{accept:{[i.A.mimeType.KML]:["."+i.A.format.KML]}},{accept:{[i.A.mimeType.KMZ]:["."+i.A.format.KMZ]}},{accept:{[i.A.mimeType.GML]:["."+i.A.format.GML,"."+i.A.format.GML2]}},{accept:{[i.A.mimeType.GEOJSON]:["."+i.A.format.GEOJSON,"."+i.A.format.JSON]}},{accept:{"text/plain":["."+i.A.format.WKT]}},{accept:{"text/plain":["."+i.A.format.WKB]}},{accept:{[i.A.mimeType.ZIP]:[".zip"]}},{accept:{[i.A.mimeType.GEOPACKAGE]:["."+i.A.format.GEOPACKAGE]}},{accept:{[i.A.mimeType.SHAPEFILE]:[".shp",".dbf",".prj",".cst",".cpg",".shx"]}},{accept:{[i.A.mimeType.GPX]:["."+i.A.format.GPX]}}],Array.isArray(e.options.formats)){e.formats=e.options.formats;const t=e.format.map((e=>l.A.getMimeTypeFromUrl(e)));e.fileTypes=e.fileTypes.filter((e=>{e.accept.keys.some((e=>t.includes(e)))}))}else e.formats=e.fileTypes.reduce(((e,t)=>{for(var r in t.accept)e=e.concat(t.accept[r].map((e=>e.substr(1))));return e}),[]);e.apiAttribution="",e.mainDataAttribution="",e.dataAttributions=[],e.exportsState=!0}register(e){const t=this,r=super.register.call(t,e);return t.registerLayerAdd(),t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options),e._bufferFeatures=[],document.addEventListener("paste",(async r=>{if(r.clipboardData.files&&r.clipboardData.files.length){let e=r.clipboardData.files;if(DataTransferItem.prototype.getAsFileSystemHandle){e=[];for(var n=0,o=r.clipboardData.items.length;n<o;++n){const t=r.clipboardData.items[n],i=await t.getAsFileSystemHandle();i&&e.push(i)}}t.loadFiles(e)}else r.clipboardData.items.length||e.toast(t.getLocaleString("fileImport.pasteNotSupported"),{type:i.A.msgType.WARNING})})),e.on(i.A.event.FEATURESIMPORT,(async function(r){const o=r.fileName,a=r.fileHandle,s=r.dropTarget,c=r.features,u=r.timeStamp,v=r.groupIndex,A=r.groupCount,S=r.groupName,E=r.fileSystemFile?.name,w=function(e){const r=e.geometry;if(r){var n;switch(!0){case e instanceof h.A:n=[r];break;case e instanceof d.A:case e instanceof p.A:n=r;break;case e instanceof g.A:case e instanceof f.A:n=r.flat();break;case e instanceof m.A:n=r.flat(2)}n&&n.every((function(e){return Math.abs(e[0])<=180&&Math.abs(e[1])<=90}))&&e.setCoords(l.A.reproject(r,"EPSG:4326",t.map.crs))}return e};var _="."+i.A.format.GPX.toLowerCase();if(o.toLowerCase().indexOf(_)===o.length-_.length||s&&s!==t.map.div&&s!==t)return void t.renderRecentFileList();const L=e=>{if(!e)do{e=t.getUID(a||u)}while(t.map.getLayer(e));return new y.A({id:e,title:E??o,owner:t,file:o,groupIndex:v,groupCount:A,groupName:S,fileSystemFile:E})};let C=r.targetLayers||[];C.length||C.push(await L());for(var b=0;b<C.length;b++){const e=C[b],n=t.map.getLayer(e)||L(e.id);n.setFeatureTypeMetadata(r.metadata);const i=await t.loadLayerMetadata(n);i&&i.groupIndex!==v&&(v||i.groupIndex)?C[b]=!1:(n.groupIndex=v,n.groupCount=A,n.groupName=S,C[b]=n)}C=C.filter((e=>e));for(const e of C)t.map.getLayer(e)||await t.map.addLayer(e);if(C.length){e._fileDropLoadingIndicator=e.getLoadingIndicator().addWait(e._fileDropLoadingIndicator);for(const i of C){a&&(i._fileHandle=a,i.fileSystemFile=a.name,r.additionalFileHandles?i._additionalFileHandles=r.additionalFileHandles:delete i._additionalFileHandles,await t.saveLayerMetadata(i)),i._timeStamp=u,i.owner=t,t.getLayers().push(i);const o=i.id+".",s=c.map((e=>e.getId())),l=function(e,t){const r=e.getId();if(s.filter(((e,r)=>r!==t)).includes(r)){const r=n.A.getUID({prefix:o,banlist:s});s[t]=r,e.setId(r)}return e};i.clearFeatures(),i.addFeatures(c.map(w).map(l)).then((()=>t.subtrackPendingFile())),r.targetLayer||(e._bufferFeatures=e._bufferFeatures.concat(i.features))}t.renderRecentFileList()}})).on(i.A.event.FEATURESIMPORTERROR,(function(e){var r=e.file.name;n.A.error(e.message?t.getLocaleString(e.message):t.getLocaleString("fileImport.error.reasonUnknown",{fileName:r}),i.A.msgErrorMode.TOAST),(new FileReader).onload=function(e){n.A.error("Nombre del archivo: "+r+" \n Contenido del archivo: \n\n"+e.target.result,i.A.msgErrorMode.EMAIL,"Error en la subida de un archivo")},t.subtrackPendingFile()})).on(i.A.event.FEATURESIMPORTWARN,(function(e){t.map.toast(t.getLocaleString("fileImport.geomEmpty",{fileName:e.file.name}),{type:i.A.msgType.WARNING})})).on(i.A.event.RECENTFILEADD,(function(e){t.renderRecentFileList()})).on(i.A.event.LAYERADD,(function(e){t.loadLayersFromFile([e.layer])})).on(i.A.event.LAYERREMOVE,(function(e){e.layer.owner===t&&t.deleteLayerMetadata(e.layer);const r=t.getLayers(),n=r.indexOf(e.layer);n>=0&&r.splice(n,1)})).on(i.A.event.FILESAVE,(function(e){t.map.workLayers.forEach((r=>{r._fileHandle?.isSameEntry(e.fileHandle).then((n=>{n&&t.saveLayerMetadata(r),r.owner===t&&(r._title=r.title=e.fileHandle.name,t.map.trigger(i.A.event.VECTORUPDATE,{layer:r}))}))}))})),e.loaded((()=>{t.loadLayersFromFile(e.workLayers)})),r}async loadTemplates(){const e=this,t=r.e(3649).then(r.bind(r,3649)),n=r.e(1926).then(r.bind(r,1926)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(){const e=this;e._dialogDiv.innerHTML=await e.getRenderedHtml(e.CLASS+"-dialog",null),await e.renderData({formats:e.formats}),e.controller=new A.A(e.model,new v.A(e.div)),e.controller.add(e._dialogDiv),e.updateModel(),e.addUIEventListeners(),e.renderRecentFileList()}addUIEventListeners(){const e=this,t=e.querySelector("input[type=file]");t.addEventListener(i.A.event.CLICK,(async function(t){const r=this,n=document.createElement("form"),o=r.parentElement;if(o.insertBefore(n,r),n.appendChild(r),n.reset(),n.insertAdjacentElement("afterend",r),o.removeChild(n),l.A.isFunction(window.showOpenFilePicker)){let r;t.preventDefault();try{r=await window.showOpenFilePicker({multiple:!0})}catch(t){if(t instanceof DOMException&&window.parent!==window){let t=e.getLocaleString("cannotOpenFileIfEmbedded");e.options.enableDragAndDrop&&(t+="<br/><br/>"+e.getLocaleString("alternativelyYouCanDropFile")),e.map.toast(t,{type:i.A.msgType.WARNING})}else if("AbortError"!==t.name)throw t}r&&e.loadFiles(r)}})),t.addEventListener("change",(function(t){e.map&&e.loadFiles(t.target.files)}))}loadFiles(e){const t=this;return t.map.loadFiles(e,{control:t}),t}async loadLayersFromFile(e){const t=this,r=e.filter((e=>t.getIdCount(e.id)&&!e.options.owner&&e.file));if(r.length){const a=[],s=Math.max(...r.map((e=>t.getIdCount(e.id))));n.A.setUIDStart(s+1,{prefix:t.getId()+"-"});const c=await Promise.all(r.map((e=>t.loadLayerMetadata(e))));r.forEach(((e,t)=>{e.options.groupIndex=c[t]?.groupIndex}));const u=new Map;for(var i=0;i<c.length;i++){const n=c[i];if(n?.fileHandle){let e;for(const[t,r]of u.entries())if(await t.isSameEntry(n.fileHandle)){e=r;break}e||(e=[],u.set(n.fileHandle,e),a.push(n.fileHandle),n.fileHandle._siblings=n.additionalFileHandles),e.push(r[i])}else{const r=e[i];t.map.getLayer(r)&&t.map.removeLayer(r)}}await t.renderPromise();const h=t._dialogDiv.querySelector(".tc-ctl-file-dialog"),d=h.querySelector("h3"),p=t._dialogDiv.querySelector("sitna-button.tc-ctl-file-dialog-ok"),g=e=>{const r=e[0],n=u.get(r);n.forEach((e=>e._fileHandle=r)),t.map.loadFiles(e,{layers:n,target:t})};for(const e of u.keys()){let r=[e];const n=e._siblings;n&&(r=r.concat(n));const i=[];for await(let e of r.map((e=>e.queryPermission())))i.push(e);let a=!1;for(var o=0;o<i.length;o++)if("prompt"===i[o]){a=!0;const e=r[o];if(d.innerHTML.length){const t=",<br>";d.innerHTML.split(t).includes(e.name)||(d.innerHTML=d.innerHTML+t+e.name)}else d.innerHTML=e.name}const s=e=>"granted"===e;if(a){const n=async function(){for(var n=0;n<i.length;n++)i[n]=await r[n].requestPermission();i.every(s)?g(r):u.get(e).forEach((e=>t.map.removeLayer(e)))},o=async function(e){await n(),d.innerHTML="",p.removeEventListener("click",o),l.A.closeModal()};navigator.userActivation?.isActive?n():(l.A.showModal(h,{closeCallback:o}),p.addEventListener("click",o))}else i.every(s)&&g(r)}}}exportState(){const e=this;return e.exportsState&&e.getLayers().length?{id:e.getId(),layers:e.getLayers().map((function(e){const t={title:e.title,state:l.A.extend(e.exportState(),{path:e.features?.length?e.features[0].getPath():void 0})};return e._fileHandle&&(t.file=e._fileHandle.name),t}))}:null}async importState(e){const t=this;if(t.map){const o=[];await t.loadLayersFromFile(t.map.workLayers),e.layers.filter((function(e){return!t.map.workLayers.some((t=>t.file&&e.file===t.file))})).forEach((function(e){o.push(t.map.addLayer({id:t.getUID(),title:e.title,owner:t,type:i.A.layerType.VECTOR}))}));const a=await Promise.all(o);for(var r=0,n=a.length;r<n;r++){const n=a[r],i=r;n.importState(e.layers[r].state).then((function(){for(var t=0;t<n.features.length;t++)n.features[t].folders=e.layers[i].state.path})),t.getLayers().push(n)}}}async saveLayerMetadata(e){const t=this,r={fileHandle:e._fileHandle,groupIndex:e.options.groupIndex};return e._additionalFileHandles&&(r.additionalFileHandles=e._additionalFileHandles),t.#e.set(e.id,r),await u().setItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id,r).catch((e=>console.warn(e)))}async loadLayerMetadata(e){const t=this;let r=await u().getItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id).catch((e=>console.warn(e)));return r?t.#e.set(e.id,r):r=t.#e.get(e.id),r}deleteLayerMetadata(e){const t=this;return u().removeItem(t.LAYER_METADATA_STORE_KEY_PREFIX+t.map.id+"-"+e.id).catch((function(e){console.warn(e.message)})),t}async addRecentFileEntry(e){await this.map.addRecentFileEntry(e)}async removeRecentFileEntry(e){await this.map.removeRecentFileEntry(e),this.renderRecentFileList()}async renderRecentFileList(e){const t=this,r=function(e){t.map.loadRecentFileEntry(e.target.dataset.fileIndex)},n=function(e){t.removeRecentFileEntry(e.target.dataset.fileIndex)},o=t.querySelector(".tc-ctl-file-recent");if(o){const s=t.getLocaleString("removeFromList"),l=await(e?Promise.resolve(e):t.map&&t.map.loadRecentFiles()||[]);if(o.replaceChildren?o.replaceChildren():o.innerHTML="",l.length){const e=document.createElement("li"),r=document.createElement("h3");r.innerHTML=t.getLocaleString("recentFiles"),e.appendChild(r),o.appendChild(e)}l.forEach(((e,t)=>{const l=document.createElement("li"),c=document.createElement("sitna-button");c.dataset.fileIndex=t,c.addEventListener(i.A.event.CLICK,r),c.setAttribute("variant",a.A.variant.LINK),c.setAttribute("text",e.mainHandle?.name||e.name),l.appendChild(c);const u=document.createElement("sitna-button");u.text=s,u.dataset.fileIndex=t,u.addEventListener(i.A.event.CLICK,n),u.setAttribute("variant",a.A.variant.MINIMAL),u.setAttribute("icon",a.A.action.CLOSE),l.appendChild(u),o.appendChild(l)}))}}subtrackPendingFile(){const e=this;e.map.dropFilesCounter--,0===e.map.dropFilesCounter&&(e.map.zoomToFeatures(e.map._bufferFeatures),e.map._bufferFeatures=[],delete e.map.dropFilesCounter);var t=e.map.getLoadingIndicator();return t&&(e.map._featureImportWaitId&&t.removeWait(e.map._featureImportWaitId),e.map._fileDropLoadingIndicator&&t.removeWait(e.map._fileDropLoadingIndicator)),e}getUID(e){const t=this;if(e){const r=Object.prototype.hasOwnProperty.call(window,"FileSystemFileHandle")?"_fileHandle":"_timeStamp",i=t.getLayers().reduce(((e,t)=>e.findByProperty(r,t[r])&&e.some((e=>/^[\w]*-\d-\d/gi.exec(t.id)[0]===/^[\w]*-\d-\d/gi.exec(e.id)[0]))?e:e.concat(t)),[]);return n.A.getUID({prefix:`${t.getId()}-${i.filter((t=>t[r]!=e)).length+1}-`})}return n.A.getUID({prefix:t.getId()+"-"})}updateModel(){const e=this;e.model.openFile=e.getLocaleString("openFile"),e.model["fileImport.instructions"]=e.getLocaleString("fileImport.instructions"),e.model.addWMS=e.getLocaleString("addWMS"),e.model.fileAccessPrompt=e.getLocaleString("fileAccessPrompt"),e.model.close=e.getLocaleString("close"),e.model.ok=e.getLocaleString("ok")}async updateLanguage(){this.updateModel()}}n.A.mix(w,s.default),w.prototype.CLASS="tc-ctl-file",customElements.get(S)||customElements.define(S,w),n.A.control.FileImport=w;const _=w},797:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});const n={OLNS:"ol",PROJ4JSOBJ:"proj4",GEOGRAPHIC:"geographic",UTM:"UTM",OLD_BROWSER_ALERT:"TC.oldBrowserAlert",CLUSTER_ANIMATION_DURATION:200,ZOOM_ANIMATION_DURATION:300,URL_MAX_LENGTH:2048,METER_PRECISION:0,DEGREE_PRECISION:5,EXTENT_TOLERANCE:.9998,SRSDOWNLOAD_GEOJSON_KML:"urn:ogc:def:crs:OGC::CRS84",url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,EPSG:"https://epsg.io/"}};if(void 0!==globalThis.SITNA_BASE_URL)n.url.ERROR_LOGGER=globalThis.SITNA_BASE_URL+"errors/logger.ashx";else{const e=(document.currentScript??document.scripts[document.scripts.length-1]).getAttribute("src"),t=e.substr(0,e.lastIndexOf("/")+1);n.url.ERROR_LOGGER=t+"errors/logger.ashx"}n.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",COLLAPSED_LEFT:"tc-collapsed-left",COLLAPSED_RIGHT:"tc-collapsed-right",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",HIGHLIGHTED:"tc-highlighted",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error",THREED:"tc-3d",TOAST:"tc-toast",TOAST_CONTAINER:"tc-toast-container",LEFT_PANEL:"tc-left-panel",RIGHT_PANEL:"tc-right-panel",SLIDE_PANEL:"tc-slide-panel",TOOLS_PANEL:"tc-tools-panel",LEGEND_PANEL:"tc-legend-panel",OVERVIEW_MAP_PANEL:"tc-ovmap-panel",PANEL_CONTENT:"tc-panel-content",PANEL_TAB:"tc-panel-tab",FULL_SCREEN:"tc-fullscreen",NOT_AVAILABLE:"tc-legend-not-available"},n.msgType={INFO:"info",WARNING:"warning",ERROR:"error"},n.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"},n.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",MAPCHANGE:"mapchange.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",BEFOREFEATUREREMOVE:"beforefeatureremove.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",FEATURESIMPORTPARTIAL:"featuresimportpartial.tc",FEATURESIMPORTWARN:"featuresimportwarn.tc",FILESAVE:"filesave.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",CONTROLHIGHLIGHT:"controlhighlight.tc",CONTROLUNHIGHLIGHT:"controlunhighlight.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click",MOUSEUP:"mouseup",MOUSEMOVE:"mousemove",MOUSELEAVE:"mouseleave",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",CAMERACHANGE:"camerachange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc",OVERVIEWBASELAYERCHANGE:"overviewbaselayerchange.tc",POPUP:"popup.tc",BEFOREAPPLYQUERY:"beforeapplyquery.tc",RECENTFILEADD:"recentfileadd.tc",CHANGELANGUAGE:"changelanguage.tc",BEFORECHANGELANGUAGE:"beforechangelanguage.tc"},n.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_BASEMAP_GREY:"mapabase_gris",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2023:"ortofoto2023",IDENA_ORTHOPHOTO2022:"ortofoto2022",IDENA_ORTHOPHOTO2021:"ortofoto2021",IDENA_ORTHOPHOTO2020:"ortofoto2020",IDENA_ORTHOPHOTO2019:"ortofoto2019",IDENA_ORTHOPHOTO2018:"ortofoto2018",IDENA_ORTHOPHOTO2017:"ortofoto2017",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_PAMPLONA_ORTHOPHOTO2020:"ortofoto_pamplona2020",IDENA_PAMPLONA_CARTO:"cartografia_pamplona",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNBASEMAP_GREY:"mapabase_gris_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2023:"ortofoto2023_dinamico",IDENA_DYNORTHOPHOTO2022:"ortofoto2022_dinamico",IDENA_DYNORTHOPHOTO2021:"ortofoto2021_dinamico",IDENA_DYNORTHOPHOTO2020:"ortofoto2020_dinamico",IDENA_DYNORTHOPHOTO2019:"ortofoto2019_dinamico",IDENA_DYNORTHOPHOTO2018:"ortofoto2018_dinamico",IDENA_DYNORTHOPHOTO2017:"ortofoto2017_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_PAMPLONA_DYNORTHOPHOTO2020:"ortofoto_pamplona2020_dinamico",IDENA_PAMPLONA_DYNCARTO:"cartografia_pamplona_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_BASEMAP_GREY:"ign-base-gris",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_LIDAR:"ign-lidar",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNBASEMAP_GREY:"ign-base-gris-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_ES_DYNLIDAR:"ign-lidar-dyn",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",OPENTOPOMAP:"opentopomap",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"},n.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicación"},n.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"},n.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle",GEOMETRY:"geometry"},n.dataType={BOOLEAN:"boolean",TINYINT:"tinyint",SMALLINT:"smallint",MEDIUMINT:"mediumint",BIGINT:"bigint",INTEGER:"integer",FLOAT:"float",DOUBLE:"double",DECIMAL:"decimal",STRING:"string",DATE:"date",TIME:"time",DATETIME:"datetime"},n.searchType={CADASTRALPARCEL:"cadastralParcel",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",TOWN:"town",STREET:"street",POSTALADDRESS:"postalAddress",COMMONWEALTH:"commonwealth",ROAD:"road",ROADMILESTONE:"roadMilestone",PLACENAME:"placeName",PLACENAMEMUNICIPALITY:"placeNameMunicipality"},n.mapSearchType={MUNICIPALITY:n.searchType.MUNICIPALITY,COUNCIL:n.searchType.COUNCIL,TOWN:n.searchType.TOWN,COMMONWEALTH:n.searchType.COMMONWEALTH,GENERIC:"generic"},n.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"},n.logicalOperator={AND:"and",OR:"or"},n.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"},n.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",KMZ:"application/vnd.google-earth.kmz",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml",GEOPACKAGE:"application/geopackage+sqlite3",SHAPEFILE:"x-gis/x-shapefile",ZIP:"application/x-zip"},n.format={JSON:"JSON",KML:"KML",KMZ:"KMZ",GML:"GML",GML2:"GML2",GML3:"GML3",GML32:"GML32",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT",WKB:"WKB",SHAPEFILE:"SHP",ZIP:"ZIP",GEOPACKAGE:"GPKG"},n.WFSErrors={GETFEATURE_NOT_AVAILABLE:"GetFeatureNotAvailable",LAYERS_NOT_AVAILABLE:"LayersNotAvailable",NO_LAYERS:"NoLayers",NO_VALID_LAYERS:"noValidLayers",QUERY_NOT_AVAILABLE:"QueryNotAvailable",MAX_NUM_FEATURES:"NumMaxFeatures",GETCAPABILITIES:"GetCapabilities",INDETERMINATE:"Indeterminate",NO_FEATURES:"NoFeatures",NO_VALID_FORMAT:"NoValidFormat"},n.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4},n.view={DEFAULT:0,THREED:1,PRINTING:2},n.units={DEGREES:"degrees",METERS:"m"},n.MARKER="marker",n.infoContainer={POPUP:"popup",RESULTS_PANEL:"resultsPanel"},n.DownloadError={MIMETYPE_NOT_SUPORTED:"MimeTypeNotSupported"};const i=n},904:(e,t,r)=>{"use strict";function n(e,t,r,n){let i=e[t],o=e[t+1],a=0;for(let s=t+n;s<r;s+=n){const t=e[s],r=e[s+1];a+=Math.sqrt((t-i)*(t-i)+(r-o)*(r-o)),i=t,o=r}return a}function i(e,t,r,i){let o=n(e,t,r,i);const a=e[r-i]-e[t],s=e[r-i+1]-e[t+1];return o+=Math.sqrt(a*a+s*s),o}r.d(t,{K:()=>i,k:()=>n})},915:(e,t,r)=>{"use strict";r.d(t,{$C:()=>A,$u:()=>F,Af:()=>G,Bg:()=>x,HY:()=>N,Im:()=>k,Ld:()=>s,Li:()=>q,Mx:()=>B,N:()=>p,NW:()=>U,Oq:()=>M,Py:()=>R,QJ:()=>W,R:()=>L,R8:()=>S,RG:()=>D,Rj:()=>u,S5:()=>d,Tr:()=>i,UG:()=>_,Vy:()=>m,WU:()=>O,X$:()=>v,Ym:()=>l,Yw:()=>P,_N:()=>I,aI:()=>y,aZ:()=>g,dP:()=>f,k_:()=>C,ms:()=>c,o8:()=>a,q1:()=>b,qF:()=>T,r:()=>o,sB:()=>w,vz:()=>h});var n=r(1580);function i(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0,n=e.length;r<n;++r)A(t,e[r]);return t}function o(e,t,r){return r?(r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r):[e[0]-t,e[1]-t,e[2]+t,e[3]+t]}function a(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e.slice()}function s(e,t,r){let n,i;return n=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0,i=r<e[1]?e[1]-r:e[3]<r?r-e[3]:0,n*n+i*i}function l(e,t){return u(e,t[0],t[1])}function c(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function u(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function h(e,t){const r=e[0],i=e[1],o=e[2],a=e[3],s=t[0],l=t[1];let c=n.A.UNKNOWN;return s<r?c|=n.A.LEFT:s>o&&(c|=n.A.RIGHT),l<i?c|=n.A.BELOW:l>a&&(c|=n.A.ABOVE),c===n.A.UNKNOWN&&(c=n.A.INTERSECTING),c}function d(){return[1/0,1/0,-1/0,-1/0]}function p(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function g(e){return p(1/0,1/0,-1/0,-1/0,e)}function f(e,t){const r=e[0],n=e[1];return p(r,n,r,n,t)}function m(e,t,r,n,i){return S(g(i),e,t,r,n)}function y(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]}function v(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function A(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function S(e,t,r,n,i){for(;r<n;r+=i)E(e,t[r],t[r+1]);return e}function E(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function w(e,t){let r;return r=t(L(e)),r||(r=t(C(e)),r||(r=t(O(e)),r||(r=t(R(e)),r||!1)))}function _(e){let t=0;return k(e)||(t=D(e)*M(e)),t}function L(e){return[e[0],e[1]]}function C(e){return[e[2],e[1]]}function b(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function T(e,t){let r;if("bottom-left"===t)r=L(e);else if("bottom-right"===t)r=C(e);else if("top-left"===t)r=R(e);else{if("top-right"!==t)throw new Error("Invalid corner");r=O(e)}return r}function x(e,t,r,n,i){const[o,a,s,l,c,u,h,d]=P(e,t,r,n);return p(Math.min(o,s,c,h),Math.min(a,l,u,d),Math.max(o,s,c,h),Math.max(a,l,u,d),i)}function P(e,t,r,n){const i=t*n[0]/2,o=t*n[1]/2,a=Math.cos(r),s=Math.sin(r),l=i*a,c=i*s,u=o*a,h=o*s,d=e[0],p=e[1];return[d-l+h,p-c-u,d-l-h,p-c+u,d+l-h,p+c+u,d+l+h,p+c-u,d-l+h,p-c-u]}function M(e){return e[3]-e[1]}function I(e,t,r){const n=r||[1/0,1/0,-1/0,-1/0];return N(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):g(n),n}function R(e){return[e[0],e[3]]}function O(e){return[e[2],e[3]]}function D(e){return e[2]-e[0]}function N(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function k(e){return e[2]<e[0]||e[3]<e[1]}function F(e,t){return t?(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t):e}function G(e,t){const r=(e[2]-e[0])/2*(t-1),n=(e[3]-e[1])/2*(t-1);e[0]-=r,e[2]+=r,e[1]-=n,e[3]+=n}function B(e,t,r){let i=!1;const o=h(e,t),a=h(e,r);if(o===n.A.INTERSECTING||a===n.A.INTERSECTING)i=!0;else{const s=e[0],l=e[1],c=e[2],u=e[3],h=t[0],d=t[1],p=r[0],g=r[1],f=(g-d)/(p-h);let m,y;a&n.A.ABOVE&&!(o&n.A.ABOVE)&&(m=p-(g-u)/f,i=m>=s&&m<=c),i||!(a&n.A.RIGHT)||o&n.A.RIGHT||(y=g-(p-c)*f,i=y>=l&&y<=u),i||!(a&n.A.BELOW)||o&n.A.BELOW||(m=p-(g-l)/f,i=m>=s&&m<=c),i||!(a&n.A.LEFT)||o&n.A.LEFT||(y=g-(p-s)*f,i=y>=l&&y<=u)}return i}function U(e,t,r,n){if(k(e))return g(r);let i=[];if(n>1){const t=e[2]-e[0],r=e[3]-e[1];for(let o=0;o<n;++o)i.push(e[0]+t*o/n,e[1],e[2],e[1]+r*o/n,e[2]-t*o/n,e[3],e[0],e[3]-r*o/n)}else i=[e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]];t(i,i,2);const o=[],a=[];for(let e=0,t=i.length;e<t;e+=2)o.push(i[e]),a.push(i[e+1]);return function(e,t,r){return p(Math.min.apply(null,e),Math.min.apply(null,t),Math.max.apply(null,e),Math.max.apply(null,t),r)}(o,a,r)}function q(e,t){const r=t.getExtent(),n=b(e);if(t.canWrapX()&&(n[0]<r[0]||n[0]>=r[2])){const t=D(r),i=Math.floor((n[0]-r[0])/t)*t;e[0]-=i,e[2]-=i}return e}function W(e,t,r){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(e[0])||!isFinite(e[2]))return[[n[0],e[1],n[2],e[3]]];q(e,t);const i=D(n);if(D(e)>i&&!r)return[[n[0],e[1],n[2],e[3]]];if(e[0]<n[0])return[[e[0]+i,e[1],n[2],e[3]],[n[0],e[1],e[2],e[3]]];if(e[2]>n[2])return[[e[0],e[1],n[2],e[3]],[n[0],e[1],e[2]-i,e[3]]]}return[e]}},1092:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1845),l=r(7018),c=r(1651),u=r(8606),h=r(6257),d=r(6546),p=r(1667),g=r(3791),f=r(5777);i.A.event.STYLECHANGE="stylechange.tc";const m="sitna-feature-styler",y=function(e){if(e){const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);if(t&&t.length)return"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]}return e};class v{constructor(){this.strokeColor="",this.selectColor="",this.width="",this.fillColor="",this.opacity="",this.symbolRadius=""}}class A extends s.default{#t=".tc-ctl-fstyler";#r;#n;#i;#o;#a;#s;#l;#c;#u=new WeakMap;constructor(){super(...arguments);const e=this;e.#c=e.options.styles||a.A.extend(!0,{},o.H.styles),e.styles=e.#c,e.initProperty("mode"),e.setStyle(e.getModeStyle()),e.model=new v}static get observedAttributes(){return["mode","disabled"]}attributeChangedCallback(e,t,r){if(t===r)return;"mode"===e&&this.#h(),"disabled"===e&&this.#d()}get mode(){return this.hasAttribute("mode")?this.getAttribute("mode"):i.A.geom.POINT}set mode(e){e?this.setAttribute("mode",e):this.removeAttribute("mode")}#h(){const e=this,t=e.mode;e.#r=e.getModeStyle(t),e.#p(t!==i.A.geom.POLYLINE&&t!==i.A.geom.MULTIPOLYLINE&&t!==i.A.geom.RECTANGLE),e.#g(t===i.A.geom.POINT||t===i.A.geom.MULTIPOINT)}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}#d(){const e=this;e.querySelectorAll("input").forEach((t=>t.disabled=e.disabled))}async loadTemplates(){const e=await r.e(5668).then(r.bind(r,5668));this.template=e.default}render(e){const t=this;let r,n,o,s,l;const c=t.styles;switch(t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:r=c.line.strokeColor,n=c.line.strokeWidth;break;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:r=c.polygon.strokeColor,n=c.polygon.strokeWidth,o=c.polygon.fillColor,s=c.polygon.fillOpacity;break;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:r=c.point.strokeColor,n=c.point.strokeWidth,o=c.point.fillColor,s=c.point.fillOpacity,l=c.point.radius;break;case i.A.geom.RECTANGLE:r=c.line.strokeColor,n=c.line.strokeWidth,o=c.polygon?.fillColor,s=0;break;default:r=c.line?.strokeColor,n=c.line?.strokeWidth,o=c.polygon?.fillColor,s=c.polygon?.fillOpacity}const u={strokeColor:y(r),strokeWidth:n,fillColor:y(o),fillOpacity:100*(s||0),radius:l};return t.renderData(u,(function(){t.#h(),t.#d(),t.#n=t.querySelector(t.#t+"-str-c"),t.#i=t.querySelector(t.#t+"-str-w"),t.#o=t.querySelector(t.#t+"-str-w-watch"),t.#a=t.querySelector(t.#t+"-fll-c"),t.#s=t.querySelector(t.#t+"-fll-w"),t.#l=t.querySelector(t.#t+"-rad-w"),t.addUIEventListeners(),a.A.isFunction(e)&&e(),t.controller=new f.A(t.model,new g.A(t)),t.updateModel()}))}addUIEventListeners(){const e=this;e.#n.addEventListener(i.A.event.CHANGE,(function(t){e.setStrokeColor(t.target.value)})),e.#i.addEventListener(i.A.event.CHANGE,(function(t){e.setStrokeWidth(t.target.value)})),e.#a.addEventListener(i.A.event.CHANGE,(function(t){e.setFillColor(t.target.value)})),e.#s.addEventListener(i.A.event.CHANGE,(function(t){e.setFillOpacity(parseFloat(t.target.value)/100)})),e.#l.addEventListener(i.A.event.CHANGE,(function(t){e.setRadius(parseFloat(t.target.value))}))}setStyles(e){const t=this;return t.styles=a.A.extend(!0,{},e),t.setStyle(t.getModeStyle()),t}setStyle(e){const t=this,r=a.A.extend(t.#r,e);let n={};for(var o in r)t.#f(o)&&(n[o]=r[o]);switch(t.#r=n,t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:case i.A.geom.RECTANGLE:t.styles.line=n;break;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:t.styles.polygon=n;break;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:t.styles.point=n;break;default:n={}}return t.renderPromise().then((function(){switch(t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:case i.A.geom.RECTANGLE:{const e=t.styles.line;e.strokeColor&&t.setStrokeColor(e.strokeColor),e.strokeWidth&&t.setStrokeWidth(e.strokeWidth);break}case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:{const e=t.styles.polygon;e.strokeColor&&t.setStrokeColor(e.strokeColor),e.strokeWidth&&t.setStrokeWidth(e.strokeWidth),e.fillColor&&t.setFillColor(e.fillColor),e.fillOpacity&&t.setFillOpacity(e.fillOpacity);break}case i.A.geom.POINT:case i.A.geom.MULTIPOINT:{const e=t.styles.point;e.strokeColor&&t.setStrokeColor(e.strokeColor),e.strokeWidth&&t.setStrokeWidth(e.strokeWidth),e.fillColor&&t.setFillColor(e.fillColor),e.fillOpacity&&t.setFillOpacity(e.fillOpacity),e.radius&&t.setRadius(e.radius);break}}t.#m()})),t}getStyle(){return this.#r}resetStyle(){const e=this;return e.setStyle(e.getModeStyle()),e}getModeStyle(e){const t=this;switch(e=e||t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:case i.A.geom.RECTANGLE:return t.styles.line;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:return t.styles.polygon;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:return t.styles.point;default:return null}}#m(){const e=this;e.layer&&e.#u.set(e.layer,e.styles)}setLayer(e){const t=this;if(t.layer=e,!e)return t;let r=t.#u.get(e);return r||(r=e.styles?[{},t.#c,e.styles]:[{},t.#c].concat(e.features.map((e=>{const t=e.getStyle();if(0===Object.keys(t).length)return null;const r={};switch(!0){case e instanceof u.A:case e instanceof h.A:r.line=t;break;case e instanceof d.A:case e instanceof p.A:r.polygon=t;break;case e instanceof l.A:case e instanceof c.A:r.point=t;break;default:return null}return r})).filter((e=>!!e))),r=a.A.extend(...r)),t.setStyles(r),t}#f(e){return"strokeColor"===e||"strokeWidth"===e||"fillColor"===e||"fillOpacity"===e||"radius"===e}setFeature(e){const t=this;t.layer=null;const r=e?.getStyle();switch(!0){case e instanceof u.A:case e instanceof h.A:t.mode=i.A.geom.POLYLINE;break;case e instanceof l.A:case e instanceof c.A:t.mode=i.A.geom.POINT;break;default:t.mode=i.A.geom.POLYGON}return r&&Object.keys(r).length>0&&t.setStyle(r),t}#y(e,t){const r=e=>new Number(e).toString(16).padStart(2,"0");if(Array.isArray(t))t=`#${r(t[0])}${r(t[1])}${r(t[2])}`;else{const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);e&&e.length&&(t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3])}if(e.value=t,!n.A.browserFeatures.inputTypeColor()){const r=e;r.style.backgroundColor=t,r.blur()}}setStrokeColorWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().strokeColor),t.#y(t.#n,e),t}setFillColorWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().fillColor),t.#y(t.#a,e),t}#v(e,t,r){const n=this,i=n.#r;if(i){if(t.call(n,r),i[e]===r)return n;i[e]=r}return n.#A({property:e,value:r}),n}setStrokeColor(e){return this.#v("strokeColor",this.setStrokeColorWatch,e)}setFillColor(e){return this.#v("fillColor",this.setFillColorWatch,e)}setFillOpacityWatch(e){const t=this;return void 0===e&&(e=Math.round(100*t.getModeStyle().fillOpacity)),e=parseInt(e,10),Number.isNaN(e)||(t.#s.value=e),t}setFillOpacity(e){const t=this;if(!Number.isNaN(e)){t.setFillOpacityWatch(Math.round(100*e));const r=t.#r;if(r){if(r.fillOpacity===e)return t;r.fillOpacity=e}t.#A({property:"fillOpacity",value:e})}return t}setStrokeWidthWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().strokeWidth),e=parseInt(e,10),Number.isNaN(e)||(t.#i.value=e,t.#o.style.borderBottomWidth=e+"px"),t}setStrokeWidth(e){const t=this;if(e=parseInt(e,10),!Number.isNaN(e)){t.setStrokeWidthWatch(e);const r=t.#r;if(r){if(r.strokeWidth===e)return t;r.strokeWidth=e}t.#A({property:"strokeWidth",value:e})}return t}setRadiusWatch(e){const t=this;return void 0===e&&(e=t.getModeStyle().radius),e=parseInt(e,10),Number.isNaN(e)||(t.#l.value=e),t}setRadius(e){const t=this;if(e=parseInt(e,10),!Number.isNaN(e)){t.setRadiusWatch(e);const r=t.#r;if(r){if(r.radius===e)return t;r.radius=e}t.#A({property:"radius",value:e})}return t}#S(e,t){if(e){const r=void 0!==t?!t:void 0;e.classList.toggle(i.A.classes.HIDDEN,r)}}#E(){return this.querySelector(`.${this.CLASS}-fill`)}#w(){return this.querySelector(`.${this.CLASS}-radius`)}#p(e){const t=this;return t.#S(t.#E(),e),t}#g(e){const t=this;return t.#S(t.#w(),e),t}#A(e){const t=new CustomEvent(i.A.event.STYLECHANGE,{detail:e});this.dispatchEvent(t)}updateModel(){this.model.strokeColor=this.getLocaleString("strokeColor"),this.model.selectColor=this.getLocaleString("selectColor"),this.model.width=this.getLocaleString("width"),this.model.fillColor=this.getLocaleString("fillColor"),this.model.opacity=this.getLocaleString("opacity"),this.model.symbolRadius=this.getLocaleString("symbolRadius")}async updateLanguage(){this.updateModel()}}A.prototype.CLASS="tc-ctl-fstyler",customElements.get(m)||customElements.define(m,A),n.A.control.FeatureStyler=A;const S=A},1126:(e,t,r)=>{"use strict";r.d(t,{A:()=>dv});var n=r(4087);const i="add",o="remove";var a=r(4120),s=r(1685);const l="length";class c extends s.Ay{constructor(e,t,r){super(e),this.element=t,this.index=r}}class u extends a.A{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let e=0,t=this.array_.length;e<t;++e)this.assertUnique_(this.array_[e],e);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,r=e.length;t<r;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let r=0,n=t.length;r<n;++r)e(t[r],r,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(l)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new c(i,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let r=0,n=t.length;r<n;++r)if(t[r]===e)return this.removeAt(r)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new c(o,t,e)),t}setAt(e,t){if(e>=this.getLength())return void this.insertAt(e,t);if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new c(o,r,e)),this.dispatchEvent(new c(i,t,e))}updateLength_(){this.set(l,this.array_.length)}assertUnique_(e,t){for(let r=0,n=this.array_.length;r<n;++r)if(this.array_[r]===e&&r!==t)throw new Error("Duplicate item added to a unique collection")}}const h=u;class d extends s.Ay{constructor(e,t,r){super(e),this.map=t,this.frameState=void 0!==r?r:null}}const p=d,g=class extends p{constructor(e,t,r,n,i,o){super(e,t,i),this.originalEvent=r,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==n&&n,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}};var f=r(6837);const m={SINGLECLICK:"singleclick",CLICK:f.A.CLICK,DBLCLICK:f.A.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};var y=r(9332),v=r(9438);const A="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",S=A.includes("safari")&&!A.includes("chrom")&&(A.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(A)),E=A.includes("webkit")&&!A.includes("edge"),w=A.includes("macintosh"),_="undefined"!=typeof devicePixelRatio?devicePixelRatio:1,L="undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope,C="undefined"!=typeof Image&&Image.prototype.decode,b="function"==typeof createImageBitmap,T=function(){let e=!1;try{const t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}(),x="pointermove",P="pointerdown",M="pointerup";class I extends y.A{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===t?1:t,this.down_=null;const r=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=r,this.pointerdownListenerKey_=(0,v.KT)(r,P,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=(0,v.KT)(r,x,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(f.A.TOUCHMOVE,this.boundHandleTouchMove_,!!T&&{passive:!1})}emulateClick_(e){let t=new g(m.CLICK,this.map_,e);this.dispatchEvent(t),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new g(m.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const t=new g(m.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}),250)}updateActivePointers_(e){const t=e,r=t.pointerId;if(t.type==m.POINTERUP||t.type==m.POINTERCANCEL){delete this.trackedTouches_[r];for(const e in this.trackedTouches_)if(this.trackedTouches_[e].target!==t.target){delete this.trackedTouches_[e];break}}else t.type!=m.POINTERDOWN&&t.type!=m.POINTERMOVE||(this.trackedTouches_[r]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new g(m.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(v.JH),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return 0===e.button}handlePointerDown_(e){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(e);const t=new g(m.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),0===this.dragListenerKeys_.length){const e=this.map_.getOwnerDocument();this.dragListenerKeys_.push((0,v.KT)(e,m.POINTERMOVE,this.handlePointerMove_,this),(0,v.KT)(e,m.POINTERUP,this.handlePointerUp_,this),(0,v.KT)(this.element_,m.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==e&&this.dragListenerKeys_.push((0,v.KT)(this.element_.getRootNode(),m.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new g(m.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new g(m.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;t&&!t.defaultPrevented||"boolean"==typeof e.cancelable&&!0!==e.cancelable||e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&((0,v.JH)(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(f.A.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&((0,v.JH)(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(v.JH),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const R=I,O={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},D="layergroup",N="size",k="target",F="view";var G=r(8450);var B=r(588),U=r(3530);const q=1/0,W=class{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,(0,U.I)(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,r=e[0];1==e.length?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const n=this.keyFunction_(r);return delete this.queuedElements_[n],r}enqueue(e){(0,B.v)(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=q&&(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(e){return 2*e+1}getRightChildIndex_(e){return 2*e+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return 0===this.elements_.length}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,r=this.priorities_,n=t.length,i=t[e],o=r[e],a=e;for(;e<n>>1;){const i=this.getLeftChildIndex_(e),o=this.getRightChildIndex_(e),a=o<n&&r[o]<r[i]?o:i;t[e]=t[a],r[e]=r[a],e=a}t[e]=i,r[e]=o,this.siftDown_(a,e)}siftDown_(e,t){const r=this.elements_,n=this.priorities_,i=r[t],o=n[t];for(;t>e;){const e=this.getParentIndex_(t);if(!(n[e]>o))break;r[t]=r[e],n[t]=n[e],t=e}r[t]=i,n[t]=o}reprioritize(){const e=this.priorityFunction_,t=this.elements_,r=this.priorities_;let n=0;const i=t.length;let o,a,s;for(a=0;a<i;++a)o=t[a],s=e(o),s==q?delete this.queuedElements_[this.keyFunction_(o)]:(r[n]=s,t[n++]=o);t.length=n,r.length=n,this.heapify_()}},H=class extends W{constructor(e,t){super((t=>e.apply(null,t)),(e=>e[0].getKey())),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(f.A.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,r=t.getState();if(2===r||3===r||4===r){3!==r&&t.removeEventListener(f.A.CHANGE,this.boundHandleTileChange_);const e=t.getKey();e in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[e],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let r=0;for(;this.tilesLoading_<e&&r<t&&this.getCount()>0;){const e=this.dequeue()[0],t=e.getKey();0!==e.getState()||t in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[t]=!0,++this.tilesLoading_,++r,e.load())}}},j={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var V=r(6514),z=r(1597);function Y(e,t,r){return function(n,i,o,a,s){if(!n)return;if(!i&&!t)return n;const l=t?0:o[0]*i,c=t?0:o[1]*i,u=s?s[0]:0,h=s?s[1]:0;let d=e[0]+l/2+u,p=e[2]-l/2+u,g=e[1]+c/2+h,f=e[3]-c/2+h;d>p&&(d=(p+d)/2,p=d),g>f&&(g=(f+g)/2,f=g);let m=(0,z.qE)(n[0],d,p),y=(0,z.qE)(n[1],g,f);if(a&&r&&i){const e=30*i;m+=-e*Math.log(1+Math.max(0,d-n[0])/e)+e*Math.log(1+Math.max(0,n[0]-p)/e),y+=-e*Math.log(1+Math.max(0,g-n[1])/e)+e*Math.log(1+Math.max(0,n[1]-f)/e)}return[m,y]}}function $(e){return e}var K=r(6933);function X(e){return Math.pow(e,3)}function Z(e){return 1-X(1-e)}function J(e){return 3*e*e-2*e*e*e}function Q(e){return e}var ee=r(915),te=r(4238),re=r(4142),ne=r(7947);function ie(e,t,r,n){const i=(0,ee.RG)(t)/r[0],o=(0,ee.Oq)(t)/r[1];return n?Math.min(e,Math.max(i,o)):Math.min(e,Math.min(i,o))}function oe(e,t,r){let n=Math.min(e,t);return n*=Math.log(1+50*Math.max(0,e/t-1))/50+1,r&&(n=Math.max(n,r),n/=Math.log(1+50*Math.max(0,r/e-1))/50+1),(0,z.qE)(n,r/2,2*t)}function ae(e,t,r,n,i){return r=void 0===r||r,function(o,a,s,l){if(void 0!==o){const a=n?ie(e,n,s,i):e;return r&&l?oe(o,a,t):(0,z.qE)(o,t,a)}}}function se(e){if(void 0!==e)return 0}function le(e){if(void 0!==e)return e}const ce=256;class ue extends a.A{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=(0,ne.Av)(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&(0,ne.RJ)(),e.center&&(e.center=(0,ne.Ad)(e.center,this.projection_)),e.extent&&(e.extent=(0,ne.SD)(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const e in j)delete t[e];this.setProperties(t,!0);const r=function(e){let t,r,n;let i=void 0!==e.minZoom?e.minZoom:0,o=void 0!==e.maxZoom?e.maxZoom:28;const a=void 0!==e.zoomFactor?e.zoomFactor:2,s=void 0!==e.multiWorld&&e.multiWorld,l=void 0===e.smoothResolutionConstraint||e.smoothResolutionConstraint,c=void 0!==e.showFullExtent&&e.showFullExtent,u=(0,ne.Av)(e.projection,"EPSG:3857"),h=u.getExtent();let d=e.constrainOnlyCenter,p=e.extent;if(s||p||!u.isGlobal()||(d=!1,p=h),void 0!==e.resolutions){const a=e.resolutions;r=a[i],n=void 0!==a[o]?a[o]:a[a.length-1],t=e.constrainResolution?function(e,t,r,n){return t=void 0===t||t,function(i,o,a,s){if(void 0!==i){const l=e[0],c=e[e.length-1],u=r?ie(l,r,a,n):l;if(s)return t?oe(i,u,c):(0,z.qE)(i,c,u);const h=Math.min(u,i),d=Math.floor((0,V.FT)(e,h,o));return e[d]>u&&d<e.length-1?e[d+1]:e[d]}}}(a,l,!d&&p,c):ae(r,n,l,!d&&p,c)}else{const s=(h?Math.max((0,ee.RG)(h),(0,ee.Oq)(h)):360*ne.Ig.degrees/u.getMetersPerUnit())/256/Math.pow(2,0),g=s/Math.pow(2,28);r=e.maxResolution,void 0!==r?i=0:r=s/Math.pow(a,i),n=e.minResolution,void 0===n&&(n=void 0!==e.maxZoom?void 0!==e.maxResolution?r/Math.pow(a,o):s/Math.pow(a,o):g),o=i+Math.floor(Math.log(r/n)/Math.log(a)),n=r/Math.pow(a,o-i),t=e.constrainResolution?function(e,t,r,n,i,o){return n=void 0===n||n,r=void 0!==r?r:0,function(a,s,l,c){if(void 0!==a){const u=i?ie(t,i,l,o):t;if(c)return n?oe(a,u,r):(0,z.qE)(a,r,u);const h=1e-9,d=Math.ceil(Math.log(t/u)/Math.log(e)-h),p=-s*(.5-h)+.5,g=Math.min(u,a),f=Math.floor(Math.log(t/g)/Math.log(e)+p),m=Math.max(d,f),y=t/Math.pow(e,m);return(0,z.qE)(y,r,u)}}}(a,r,n,l,!d&&p,c):ae(r,n,l,!d&&p,c)}return{constraint:t,maxResolution:r,minResolution:n,minZoom:i,zoomFactor:a}}(e);this.maxResolution_=r.maxResolution,this.minResolution_=r.minResolution,this.zoomFactor_=r.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=r.minZoom;const n=function(e){if(void 0!==e.extent){const t=void 0===e.smoothExtentConstraint||e.smoothExtentConstraint;return Y(e.extent,e.constrainOnlyCenter,t)}const t=(0,ne.Av)(e.projection,"EPSG:3857");if(!0!==e.multiWorld&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Y(e,!1,!1)}return $}(e),i=r.constraint,o=function(e){if(void 0===e.enableRotation||e.enableRotation){const t=e.constrainRotation;return void 0===t||!0===t?function(){const e=(0,z.eh)(5);return function(t,r){return r||void 0===t?t:Math.abs(t)<=e?0:t}}():!1===t?le:"number"==typeof t?function(e){const t=2*Math.PI/e;return function(e,r){return r?e:void 0!==e?e=Math.floor(e/t+.5)*t:void 0}}(t):le}return se}(e);this.constraints_={center:n,resolution:i,rotation:o},this.setRotation(void 0!==e.rotation?e.rotation:0),this.setCenterInternal(void 0!==e.center?e.center:null),void 0!==e.resolution?this.setResolution(e.resolution):void 0!==e.zoom&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const r=this.getCenterInternal();if(r){const n=e||[0,0,0,0];t=t||[0,0,0,0];const i=this.getResolution(),o=i/2*(n[3]-t[3]+t[1]-n[1]),a=i/2*(n[0]-t[0]+t[2]-n[2]);this.setCenterInternal([r[0]+o,r[1]-a])}}getUpdatedOptions_(e){const t=this.getProperties();return void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let e=0;e<t.length;++e){let r=arguments[e];r.center&&(r=Object.assign({},r),r.center=(0,ne.Ad)(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=(0,ne.Ad)(r.anchor,this.getProjection())),t[e]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t,r=arguments.length;r>1&&"function"==typeof arguments[r-1]&&(t=arguments[r-1],--r);let n=0;for(;n<r&&!this.isDef();++n){const e=arguments[n];e.center&&this.setCenterInternal(e.center),void 0!==e.zoom?this.setZoom(e.zoom):e.resolution&&this.setResolution(e.resolution),void 0!==e.rotation&&this.setRotation(e.rotation)}if(n===r)return void(t&&he(t,!0));let i=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,s=this.targetRotation_;const l=[];for(;n<r;++n){const e=arguments[n],r={start:i,complete:!1,anchor:e.anchor,duration:void 0!==e.duration?e.duration:1e3,easing:e.easing||J,callback:t};if(e.center&&(r.sourceCenter=o,r.targetCenter=e.center.slice(),o=r.targetCenter),void 0!==e.zoom?(r.sourceResolution=a,r.targetResolution=this.getResolutionForZoom(e.zoom),a=r.targetResolution):e.resolution&&(r.sourceResolution=a,r.targetResolution=e.resolution,a=r.targetResolution),void 0!==e.rotation){r.sourceRotation=s;const t=(0,z.xP)(e.rotation-s+Math.PI,2*Math.PI)-Math.PI;r.targetRotation=s+t,s=r.targetRotation}de(r)?r.complete=!0:i+=r.duration,l.push(r)}this.animations_.push(l),this.setHint(0,1),this.updateAnimations_()}getAnimating(){return this.hints_[0]>0}getInteracting(){return this.hints_[1]>0}cancelAnimations(){let e;this.setHint(0,-this.hints_[0]);for(let t=0,r=this.animations_.length;t<r;++t){const r=this.animations_[t];if(r[0].callback&&he(r[0].callback,!1),!e)for(let t=0,n=r.length;t<n;++t){const n=r[t];if(!n.complete){e=n.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let r=this.animations_.length-1;r>=0;--r){const n=this.animations_[r];let i=!0;for(let r=0,o=n.length;r<o;++r){const o=n[r];if(o.complete)continue;const a=e-o.start;let s=o.duration>0?a/o.duration:1;s>=1?(o.complete=!0,s=1):i=!1;const l=o.easing(s);if(o.sourceCenter){const e=o.sourceCenter[0],t=o.sourceCenter[1],r=o.targetCenter[0],n=o.targetCenter[1];this.nextCenter_=o.targetCenter;const i=e+l*(r-e),a=t+l*(n-t);this.targetCenter_=[i,a]}if(o.sourceResolution&&o.targetResolution){const e=1===l?o.targetResolution:o.sourceResolution+l*(o.targetResolution-o.sourceResolution);if(o.anchor){const t=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(e,0,t,!0);this.targetCenter_=this.calculateCenterZoom(r,o.anchor)}this.nextResolution_=o.targetResolution,this.targetResolution_=e,this.applyTargetState_(!0)}if(void 0!==o.sourceRotation&&void 0!==o.targetRotation){const e=1===l?(0,z.xP)(o.targetRotation+Math.PI,2*Math.PI)-Math.PI:o.sourceRotation+l*(o.targetRotation-o.sourceRotation);if(o.anchor){const t=this.constraints_.rotation(e,!0);this.targetCenter_=this.calculateCenterRotate(t,o.anchor)}this.nextRotation_=o.targetRotation,this.targetRotation_=e}if(this.applyTargetState_(!0),t=!0,!o.complete)break}if(i){this.animations_[r]=null,this.setHint(0,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const e=n[0].callback;e&&he(e,!0)}}this.animations_=this.animations_.filter(Boolean),t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let r;const n=this.getCenterInternal();return void 0!==n&&(r=[n[0]-t[0],n[1]-t[1]],(0,K.e$)(r,e-this.getRotation()),(0,K.WQ)(r,t)),r}calculateCenterZoom(e,t){let r;const n=this.getCenterInternal(),i=this.getResolution();return void 0!==n&&void 0!==i&&(r=[t[0]-e*(t[0]-n[0])/i,t[1]-e*(t[1]-n[1])/i]),r}getViewportSize_(e){const t=this.viewportSize_;if(e){const r=t[0],n=t[1];return[Math.abs(r*Math.cos(e))+Math.abs(n*Math.sin(e)),Math.abs(r*Math.sin(e))+Math.abs(n*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e?(0,ne.te)(e,this.getProjection()):e}getCenterInternal(){return this.get(j.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return void 0!==e?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return(0,ne.JR)(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();(0,B.v)(t,"The view center is not defined");const r=this.getResolution();(0,B.v)(void 0!==r,"The view resolution is not defined");const n=this.getRotation();return(0,B.v)(void 0!==n,"The view rotation is not defined"),(0,ee.Bg)(t,r,n,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(j.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal((0,ne.SD)(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const r=(0,ee.RG)(e)/t[0],n=(0,ee.Oq)(e)/t[1];return Math.max(r,n)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,n=Math.log(t/r)/Math.log(e);return function(r){return t/Math.pow(e,r*n)}}getRotation(){return this.get(j.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),r=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,i=Math.log(r/n)/t;return function(e){return Math.log(r/e)/t/i}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const r=this.padding_;return r&&(t=[t[0]-r[1]-r[3],t[1]-r[0]-r[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),r=this.getRotation();let n=this.getCenterInternal();const i=this.padding_;if(i){const e=this.getViewportSizeMinusPadding_();n=pe(n,this.getViewportSize_(),[e[0]/2+i[3],e[1]/2+i[0]],t,r)}return{center:n.slice(0),projection:void 0!==e?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:r,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return void 0!==t&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t,r,n=this.minZoom_||0;if(this.resolutions_){const i=(0,V.FT)(this.resolutions_,e,1);n=i,t=this.resolutions_[i],r=i==this.resolutions_.length-1?2:t/this.resolutions_[i+1]}else t=this.maxResolution_,r=this.zoomFactor_;return n+Math.log(t/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_?.length){if(1===this.resolutions_.length)return this.resolutions_[0];const t=(0,z.qE)(Math.floor(e),0,this.resolutions_.length-2),r=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(r,(0,z.qE)(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let r;if((0,B.v)(Array.isArray(e)||"function"==typeof e.getSimplifiedGeometry,"Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){(0,B.v)(!(0,ee.Im)(e),"Cannot fit empty extent provided as `geometry`");const t=(0,ne.SD)(e,this.getProjection());r=(0,re.VY)(t)}else if("Circle"===e.getType()){const t=(0,ne.SD)(e.getExtent(),this.getProjection());r=(0,re.VY)(t),r.rotate(this.getRotation(),(0,ee.q1)(t))}else{const t=(0,ne.Tf)();r=t?e.clone().transform(t,this.getProjection()):e}this.fitInternal(r,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),r=Math.cos(t),n=Math.sin(-t),i=e.getFlatCoordinates(),o=e.getStride();let a=1/0,s=1/0,l=-1/0,c=-1/0;for(let e=0,t=i.length;e<t;e+=o){const t=i[e]*r-i[e+1]*n,o=i[e]*n+i[e+1]*r;a=Math.min(a,t),s=Math.min(s,o),l=Math.max(l,t),c=Math.max(c,o)}return[a,s,l,c]}fitInternal(e,t){let r=(t=t||{}).size;r||(r=this.getViewportSizeMinusPadding_());const n=void 0!==t.padding?t.padding:[0,0,0,0],i=void 0!==t.nearest&&t.nearest;let o;o=void 0!==t.minResolution?t.minResolution:void 0!==t.maxZoom?this.getResolutionForZoom(t.maxZoom):0;const a=this.rotatedExtentForGeometry(e);let s=this.getResolutionForExtentInternal(a,[r[0]-n[1]-n[3],r[1]-n[0]-n[2]]);s=isNaN(s)?o:Math.max(s,o),s=this.getConstrainedResolution(s,i?0:1);const l=this.getRotation(),c=Math.sin(l),u=Math.cos(l),h=(0,ee.q1)(a);h[0]+=(n[1]-n[3])/2*s,h[1]+=(n[0]-n[2])/2*s;const d=h[0]*u-h[1]*c,p=h[1]*u+h[0]*c,g=this.getConstrainedCenter([d,p],s),f=t.callback?t.callback:te.tV;void 0!==t.duration?this.animateInternal({resolution:s,center:g,duration:t.duration,easing:t.easing},f):(this.targetResolution_=s,this.targetCenter_=g,this.applyTargetState_(!1,!0),he(f,!0))}centerOn(e,t,r){this.centerOnInternal((0,ne.Ad)(e,this.getProjection()),t,r)}centerOnInternal(e,t,r){this.setCenterInternal(pe(e,t,r,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,r,n){let i;const o=this.padding_;if(o&&e){const a=this.getViewportSizeMinusPadding_(-r),s=pe(e,n,[a[0]/2+o[3],a[1]/2+o[0]],t,r);i=[e[0]-s[0],e[1]-s[1]]}return i}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(e){const t=(0,ne.te)(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&(0,ne.Ad)(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const r=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),i=this.constraints_.resolution(this.targetResolution_*e,0,n,r);t&&(this.targetCenter_=this.calculateCenterZoom(i,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=(0,ne.Ad)(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const r=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+e,r);t&&(this.targetCenter_=this.calculateCenterRotate(n,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e?(0,ne.Ad)(e,this.getProjection()):e)}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const r=this.getAnimating()||this.getInteracting()||t,n=this.constraints_.rotation(this.targetRotation_,r),i=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,i,r),a=this.constraints_.center(this.targetCenter_,o,i,r,this.calculateCenterShift(this.targetCenter_,o,n,i));this.get(j.ROTATION)!==n&&this.set(j.ROTATION,n),this.get(j.RESOLUTION)!==o&&(this.set(j.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),a&&this.get(j.CENTER)&&(0,K.aI)(this.get(j.CENTER),a)||this.set(j.CENTER,a),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,r){e=void 0!==e?e:200;const n=t||0,i=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(i),a=this.constraints_.resolution(this.targetResolution_,n,o),s=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,i,o));if(0===e&&!this.cancelAnchor_)return this.targetResolution_=a,this.targetRotation_=i,this.targetCenter_=s,void this.applyTargetState_();r=r||(0===e?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===a&&this.getRotation()===i&&this.getCenterInternal()&&(0,K.aI)(this.getCenterInternal(),s)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:i,center:s,resolution:a,duration:e,easing:Z,anchor:r}))}beginInteraction(){this.resolveConstraints(0),this.setHint(1,1)}endInteraction(e,t,r){r=r&&(0,ne.Ad)(r,this.getProjection()),this.endInteractionInternal(e,t,r)}endInteractionInternal(e,t,r){this.getInteracting()&&(this.setHint(1,-1),this.resolveConstraints(e,t,r))}getConstrainedCenter(e,t){const r=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),r)}getConstrainedZoom(e,t){const r=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(r,t))}getConstrainedResolution(e,t){t=t||0;const r=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,r)}}function he(e,t){setTimeout((function(){e(t)}),0)}function de(e){return!(e.sourceCenter&&e.targetCenter&&!(0,K.aI)(e.sourceCenter,e.targetCenter))&&e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation}function pe(e,t,r,n,i){const o=Math.cos(-i);let a=Math.sin(-i),s=e[0]*o-e[1]*a,l=e[1]*o+e[0]*a;return s+=(t[0]/2-r[0])*n,l+=(r[1]-t[1]/2)*n,a=-a,[s*o-l*a,l*o+s*a]}const ge=ue;var fe=r(4422);const me="ol-hidden",ye="ol-unselectable",ve="ol-control",Ae="ol-collapsed",Se=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z0-9]+?)\\s*$"].join(""),"i"),Ee=["style","variant","weight","size","lineHeight","family"],we=function(e){const t=e.match(Se);if(!t)return null;const r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let e=0,n=Ee.length;e<n;++e){const n=t[e+1];void 0!==n&&(r[Ee[e]]=n)}return r.families=r.family.split(/,\s?/),r};function _e(e,t,r,n){let i;return i=r&&r.length?r.shift():L?new OffscreenCanvas(e||300,t||300):document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}let Le;function Ce(){return Le||(Le=_e(1,1)),Le}function be(e){const t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function Te(e){let t=e.offsetWidth;const r=getComputedStyle(e);return t+=parseInt(r.marginLeft,10)+parseInt(r.marginRight,10),t}function xe(e){let t=e.offsetHeight;const r=getComputedStyle(e);return t+=parseInt(r.marginTop,10)+parseInt(r.marginBottom,10),t}function Pe(e,t){const r=t.parentNode;r&&r.replaceChild(e,t)}function Me(e){for(;e.lastChild;)e.lastChild.remove()}class Ie extends a.A{constructor(e){super();const t=e.element;!t||e.target||t.style.pointerEvents||(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&this.element?.remove();for(let e=0,t=this.listenerKeys.length;e<t;++e)(0,v.JH)(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=e,e){const t=this.target_??e.getOverlayContainerStopEvent();this.element&&t.appendChild(this.element),this.render!==te.tV&&this.listenerKeys.push((0,v.KT)(e,O.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_="string"==typeof e?document.getElementById(e):e}}const Re=Ie,Oe=class extends Re{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===e.collapsed||e.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==e.collapsible,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=void 0!==e.className?e.className:"ol-attribution",r=void 0!==e.tipLabel?e.tipLabel:"Attributions",n=void 0!==e.expandClassName?e.expandClassName:t+"-expand",i=void 0!==e.collapseLabel?e.collapseLabel:"›",o=void 0!==e.collapseClassName?e.collapseClassName:t+"-collapse";"string"==typeof i?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=i,this.collapseLabel_.className=o):this.collapseLabel_=i;const a=void 0!==e.label?e.label:"i";"string"==typeof a?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=r,this.toggleButton_.appendChild(s),this.toggleButton_.addEventListener(f.A.CLICK,this.handleClick_.bind(this),!1);const l=t+" "+ye+" "+ve+(this.collapsed_&&this.collapsible_?" "+Ae:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=l,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),r=new Set(t.flatMap((t=>t.getAttributions(e))));if(void 0!==this.attributions_&&(Array.isArray(this.attributions_)?this.attributions_.forEach((e=>r.add(e))):r.add(this.attributions_)),!this.overrideCollapsible_){const e=!t.some((e=>!1===e.getSource()?.getAttributionsCollapsible()));this.setCollapsible(e)}return Array.from(r)}async updateElement_(e){if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=await Promise.all(this.collectSourceAttributions_(e).map((e=>(0,te.hq)((()=>e))))),r=t.length>0;if(this.renderedVisible_!=r&&(this.element.style.display=r?"":"none",this.renderedVisible_=r),!(0,V.aI)(t,this.renderedAttributions_)){Me(this.ulElement_);for(let e=0,r=t.length;e<r;++e){const r=document.createElement("li");r.innerHTML=t[e],this.ulElement_.appendChild(r)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ae),this.collapsed_?Pe(this.collapseLabel_,this.label_):Pe(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}},De=class extends Re{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=void 0!==e.className?e.className:"ol-rotate",r=void 0!==e.label?e.label:"⇧",n=void 0!==e.compassClassName?e.compassClassName:"ol-compass";this.label_=null,"string"==typeof r?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=r):(this.label_=r,this.label_.classList.add(n));const i=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=i,o.appendChild(this.label_),o.addEventListener(f.A.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+ye+" "+ve,s=this.element;s.className=a,s.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=void 0!==e.duration?e.duration:250,this.autoHide_=void 0===e.autoHide||e.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(me)}handleClick_(e){e.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const t=e.getRotation();void 0!==t&&(this.duration_>0&&t%(2*Math.PI)!=0?e.animate({rotation:0,duration:this.duration_,easing:Z}):e.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const r=t.viewState.rotation;if(r!=this.rotation_){const e="rotate("+r+"rad)";if(this.autoHide_){const e=this.element.classList.contains(me);e||0!==r?e&&0!==r&&this.element.classList.remove(me):this.element.classList.add(me)}this.label_.style.transform=e}this.rotation_=r}},Ne=class extends Re{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=void 0!==e.className?e.className:"ol-zoom",r=void 0!==e.delta?e.delta:1,n=void 0!==e.zoomInClassName?e.zoomInClassName:t+"-in",i=void 0!==e.zoomOutClassName?e.zoomOutClassName:t+"-out",o=void 0!==e.zoomInLabel?e.zoomInLabel:"+",a=void 0!==e.zoomOutLabel?e.zoomOutLabel:"–",s=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",l=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=n,c.setAttribute("type","button"),c.title=s,c.appendChild("string"==typeof o?document.createTextNode(o):o),c.addEventListener(f.A.CLICK,this.handleClick_.bind(this,r),!1);const u=document.createElement("button");u.className=i,u.setAttribute("type","button"),u.title=l,u.appendChild("string"==typeof a?document.createTextNode(a):a),u.addEventListener(f.A.CLICK,this.handleClick_.bind(this,-r),!1);const h=t+" "+ye+" "+ve,d=this.element;d.className=h,d.appendChild(c),d.appendChild(u),this.duration_=void 0!==e.duration?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const t=this.getMap().getView();if(!t)return;const r=t.getZoom();if(void 0!==r){const n=t.getConstrainedZoom(r+e);this.duration_>0?(t.getAnimating()&&t.cancelAnimations(),t.animate({zoom:n,duration:this.duration_,easing:Z})):t.setZoom(n)}}},ke=class{constructor(e,t,r){this.decay_=e,this.minVelocity_=t,this.delay_=r,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let r=t-3;for(;r>0&&this.points_[r+2]>e;)r-=3;const n=this.points_[t+2]-this.points_[r+2];if(n<1e3/60)return!1;const i=this.points_[t]-this.points_[r],o=this.points_[t+1]-this.points_[r+1];return this.angle_=Math.atan2(o,i),this.initialVelocity_=Math.sqrt(i*i+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}},Fe="active";class Ge extends a.A{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Fe)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(Fe,e)}setMap(e){this.map_=e}}function Be(e,t,r,n){const i=e.getZoom();if(void 0===i)return;const o=e.getConstrainedZoom(i+t),a=e.getResolutionForZoom(o);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:a,anchor:r,duration:void 0!==n?n:250,easing:Z})}const Ue=Ge,qe=class extends Ue{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:250}handleEvent(e){let t=!1;if(e.type==m.DBLCLICK){const r=e.originalEvent,n=e.map,i=e.coordinate,o=r.shiftKey?-this.delta_:this.delta_;Be(n.getView(),o,i,this.duration_),r.preventDefault(),t=!0}return!t}};function We(e){const t=arguments;return function(e){let r=!0;for(let n=0,i=t.length;n<i&&(r=r&&t[n](e),r);++n);return r}}const He=function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},je=function(e){const t=e.map.getTargetElement(),r=t.getRootNode();return!(r instanceof ShadowRoot?r.host:t).hasAttribute("tabindex")||function(e){const t=e.map.getTargetElement(),r=t.getRootNode(),n=e.map.getOwnerDocument().activeElement;return r instanceof ShadowRoot?r.host.contains(n):t.contains(n)}(e)},Ve=te.rT,ze=function(e){return e.type==m.CLICK},Ye=function(e){const t=e.originalEvent;return t instanceof PointerEvent&&0==t.button&&!(E&&w&&t.ctrlKey)},$e=te.W8,Ke=function(e){return e.type==m.SINGLECLICK},Xe=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Ze=function(e){const t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Je=function(e){const t=e.originalEvent,r=t.target.tagName;return"INPUT"!==r&&"SELECT"!==r&&"TEXTAREA"!==r&&!t.target.isContentEditable},Qe=function(e){const t=e.originalEvent;return t instanceof PointerEvent&&"mouse"==t.pointerType},et=function(e){const t=e.originalEvent;return t instanceof PointerEvent&&t.isPrimary&&0===t.button};function tt(e){const t=e.length;let r=0,n=0;for(let i=0;i<t;i++)r+=e[i].clientX,n+=e[i].clientY;return{clientX:r/t,clientY:n/t}}const rt=class extends Ue{constructor(e){super(e=e||{}),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==m.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==m.POINTERUP){const t=this.handleUpEvent(e);this.handlingDownUpSequence=t&&this.targetPointers.length>0}}else if(e.type==m.POINTERDOWN){const r=this.handleDownEvent(e);this.handlingDownUpSequence=r,t=this.stopDown(r)}else e.type==m.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}},nt=class extends rt{constructor(e){super({stopDown:te.W8}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:We(Xe,et);this.condition_=e.onFocusOnly?We(je,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const r=this.targetPointers,n=t.getEventPixel(tt(r));if(r.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const t=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],r=e.map.getView();(0,K.hs)(t,r.getResolution()),(0,K.e$)(t,r.getRotation()),r.adjustCenterInternal(t)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=r.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,r=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const e=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),i=r.getCenterInternal(),o=t.getPixelFromCoordinateInternal(i),a=t.getCoordinateFromPixelInternal([o[0]-e*Math.cos(n),o[1]-e*Math.sin(n)]);r.animateInternal({center:r.getConstrainedCenter(a),duration:500,easing:Z})}return this.panning_&&(this.panning_=!1,r.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const t=e.map.getView();return this.lastCentroid=null,t.getAnimating()&&t.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}},it=class extends rt{constructor(e){e=e||{},super({stopDown:te.W8}),this.condition_=e.condition?e.condition:He,this.lastAngle_=void 0,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){if(!Qe(e))return;const t=e.map,r=t.getView();if(r.getConstraints().rotation===se)return;const n=t.getSize(),i=e.pixel,o=Math.atan2(n[1]/2-i[1],i[0]-n[0]/2);if(void 0!==this.lastAngle_){const e=o-this.lastAngle_;r.adjustRotationInternal(-e)}this.lastAngle_=o}handleUpEvent(e){return!Qe(e)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){return!!Qe(e)&&(!(!Ye(e)||!this.condition_(e))&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))}};var ot=r(25);class at extends ot.A{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,r="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+r,n.top=Math.min(e[1],t[1])+r,n.width=Math.abs(t[0]-e[0])+r,n.height=Math.abs(t[1]-e[1])+r}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new re.Ay([r])}getGeometry(){return this.geometry_}}const st=at,lt="boxcancel";class ct extends s.Ay{constructor(e,t,r){super(e),this.coordinate=t,this.mapBrowserEvent=r}}const ut=class extends rt{constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new st(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Ye,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,r){const n=r[0]-t[0],i=r[1]-t[1];return n*n+i*i>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new ct("boxdrag",e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new ct(t?"boxend":lt,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return!!this.condition_(e)&&(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new ct("boxstart",e.coordinate,e)),!0)}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ct(lt,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new ct(lt,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}},ht=class extends ut{constructor(e){super({condition:(e=e||{}).condition?e.condition:Ze,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=void 0!==e.duration?e.duration:200,this.out_=void 0!==e.out&&e.out}onBoxEnd(e){const t=this.getMap().getView();let r=this.getGeometry();if(this.out_){const e=t.rotatedExtentForGeometry(r),n=t.getResolutionForExtentInternal(e),i=t.getResolution()/n;r=r.clone(),r.scale(i*i)}t.fitInternal(r,{duration:this.duration_,easing:Z})}},dt="ArrowLeft",pt="ArrowRight",gt="ArrowDown",ft=class extends Ue{constructor(e){super(),e=e||{},this.defaultCondition_=function(e){return Xe(e)&&Je(e)},this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_,this.duration_=void 0!==e.duration?e.duration:100,this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==f.A.KEYDOWN){const r=e.originalEvent,n=r.key;if(this.condition_(e)&&(n==gt||n==dt||n==pt||"ArrowUp"==n)){const i=e.map.getView(),o=i.getResolution()*this.pixelDelta_;let a=0,s=0;n==gt?s=-o:n==dt?a=-o:n==pt?a=o:s=o;const l=[a,s];(0,K.e$)(l,i.getRotation()),function(e,t,r){const n=e.getCenterInternal();if(n){const i=[n[0]+t[0],n[1]+t[1]];e.animateInternal({duration:void 0!==r?r:250,easing:Q,center:e.getConstrainedCenter(i)})}}(i,l,this.duration_),r.preventDefault(),t=!0}}return!t}},mt=class extends Ue{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(e){return!function(e){const t=e.originalEvent;return w?t.metaKey:t.ctrlKey}(e)&&Je(e)},this.delta_=e.delta?e.delta:1,this.duration_=void 0!==e.duration?e.duration:100}handleEvent(e){let t=!1;if(e.type==f.A.KEYDOWN||e.type==f.A.KEYPRESS){const r=e.originalEvent,n=r.key;if(this.condition_(e)&&("+"===n||"-"===n)){const i=e.map,o="+"===n?this.delta_:-this.delta_;Be(i.getView(),o,void 0,this.duration_),r.preventDefault(),t=!0}}return!t}},yt=class extends Ue{constructor(e){super(e=e||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==e.maxDelta?e.maxDelta:1,this.duration_=void 0!==e.duration?e.duration:250,this.timeout_=void 0!==e.timeout?e.timeout:80,this.useAnchor_=void 0===e.useAnchor||e.useAnchor,this.constrainResolution_=void 0!==e.constrainResolution&&e.constrainResolution;const t=e.condition?e.condition:Ve;this.condition_=e.onFocusOnly?We(je,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();e&&e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e))return!0;if(e.type!==f.A.WHEEL)return!0;const t=e.map,r=e.originalEvent;let n;if(r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel),e.type==f.A.WHEEL&&(n=r.deltaY,r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(n*=40)),0===n)return!1;this.lastDelta_=n;const i=Date.now();void 0===this.startTime_&&(this.startTime_=i),(!this.mode_||i-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(n)<4?"trackpad":"wheel");const o=t.getView();if("trackpad"===this.mode_&&!o.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-n/this.deltaPerZoom_,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=i,!1;this.totalDelta_+=n;const a=Math.max(this.timeout_-(i-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,t),a),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let r=-(0,z.qE)(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(r=r?r>0?1:-1:0),Be(t,r,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}},vt=class extends rt{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=te.W8),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==e.threshold?e.threshold:.3,this.duration_=void 0!==e.duration?e.duration:250}handleDragEvent(e){let t=0;const r=this.targetPointers[0],n=this.targetPointers[1],i=Math.atan2(n.clientY-r.clientY,n.clientX-r.clientX);if(void 0!==this.lastAngle_){const e=i-this.lastAngle_;this.rotationDelta_+=e,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=e}this.lastAngle_=i;const o=e.map,a=o.getView();a.getConstraints().rotation!==se&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(tt(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return!(this.targetPointers.length<2)||(e.map.getView().endInteraction(this.duration_),!1)}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}},At=class extends rt{constructor(e){const t=e=e||{};t.stopDown||(t.stopDown=te.W8),super(t),this.anchor_=null,this.duration_=void 0!==e.duration?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const r=this.targetPointers[0],n=this.targetPointers[1],i=r.clientX-n.clientX,o=r.clientY-n.clientY,a=Math.sqrt(i*i+o*o);void 0!==this.lastDistance_&&(t=this.lastDistance_/a),this.lastDistance_=a;const s=e.map,l=s.getView();1!=t&&(this.lastScaleDelta_=t),this.anchor_=s.getCoordinateFromPixelInternal(s.getEventPixel(tt(this.targetPointers))),s.render(),l.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const t=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}};function St(e){e=e||{};const t=new h,r=new ke(-.005,.05,100);return(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&t.push(new it),(void 0===e.doubleClickZoom||e.doubleClickZoom)&&t.push(new qe({delta:e.zoomDelta,duration:e.zoomDuration})),(void 0===e.dragPan||e.dragPan)&&t.push(new nt({onFocusOnly:e.onFocusOnly,kinetic:r})),(void 0===e.pinchRotate||e.pinchRotate)&&t.push(new vt),(void 0===e.pinchZoom||e.pinchZoom)&&t.push(new At({duration:e.zoomDuration})),(void 0===e.keyboard||e.keyboard)&&(t.push(new ft),t.push(new mt({delta:e.zoomDelta,duration:e.zoomDuration}))),(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&t.push(new yt({onFocusOnly:e.onFocusOnly,duration:e.zoomDuration})),(void 0===e.shiftDragZoom||e.shiftDragZoom)&&t.push(new ht({duration:e.zoomDuration})),t}const Et="opacity",wt="visible",_t="extent",Lt="zIndex",Ct="maxResolution",bt="minResolution",Tt="maxZoom",xt="minZoom",Pt="source",Mt="map";class It extends a.A{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);"object"==typeof e.properties&&(delete t.properties,Object.assign(t,e.properties)),t[Et]=void 0!==e.opacity?e.opacity:1,(0,B.v)("number"==typeof t[Et],"Layer opacity must be a number"),t[wt]=void 0===e.visible||e.visible,t[Lt]=e.zIndex,t[Ct]=void 0!==e.maxResolution?e.maxResolution:1/0,t[bt]=void 0!==e.minResolution?e.minResolution:0,t[xt]=void 0!==e.minZoom?e.minZoom:-1/0,t[Tt]=void 0!==e.maxZoom?e.maxZoom:1/0,this.className_=void 0!==t.className?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:void 0===e||e},r=this.getZIndex();return t.opacity=(0,z.qE)(Math.round(100*this.getOpacity())/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=void 0!==r||t.managed?r:1/0,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return(0,n.b0)()}getLayerStatesArray(e){return(0,n.b0)()}getExtent(){return this.get(_t)}getMaxResolution(){return this.get(Ct)}getMinResolution(){return this.get(bt)}getMinZoom(){return this.get(xt)}getMaxZoom(){return this.get(Tt)}getOpacity(){return this.get(Et)}getSourceState(){return(0,n.b0)()}getVisible(){return this.get(wt)}getZIndex(){return this.get(Lt)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(_t,e)}setMaxResolution(e){this.set(Ct,e)}setMinResolution(e){this.set(bt,e)}setMaxZoom(e){this.set(Tt,e)}setMinZoom(e){this.set(xt,e)}setOpacity(e){(0,B.v)("number"==typeof e,"Layer opacity must be a number"),this.set(Et,e)}setVisible(e){this.set(wt,e)}setZIndex(e){this.set(Lt,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Rt=It;class Ot extends s.Ay{constructor(e,t){super(e),this.layer=t}}const Dt="layers";class Nt extends Rt{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let r=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Dt,this.handleLayersChanged_),r?Array.isArray(r)?r=new h(r.slice(),{unique:!0}):(0,B.v)("function"==typeof r.getArray,"Expected `layers` to be an array or a `Collection`"):r=new h(void 0,{unique:!0}),this.setLayers(r)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(v.JH),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push((0,v.KT)(e,i,this.handleLayersAdd_,this),(0,v.KT)(e,o,this.handleLayersRemove_,this));for(const e in this.listenerKeys_)this.listenerKeys_[e].forEach(v.JH);(0,U.I)(this.listenerKeys_);const t=e.getArray();for(let e=0,r=t.length;e<r;e++){const r=t[e];this.registerLayerListeners_(r),this.dispatchEvent(new Ot("addlayer",r))}this.changed()}registerLayerListeners_(e){const t=[(0,v.KT)(e,G.A.PROPERTYCHANGE,this.handleLayerChange_,this),(0,v.KT)(e,f.A.CHANGE,this.handleLayerChange_,this)];e instanceof Nt&&t.push((0,v.KT)(e,"addlayer",this.handleLayerGroupAdd_,this),(0,v.KT)(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[(0,n.v6)(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Ot("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Ot("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Ot("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,r=(0,n.v6)(t);this.listenerKeys_[r].forEach(v.JH),delete this.listenerKeys_[r],this.dispatchEvent(new Ot("removelayer",t)),this.changed()}getLayers(){return this.get(Dt)}setLayers(e){const t=this.getLayers();if(t){const e=t.getArray();for(let t=0,r=e.length;t<r;++t)this.dispatchEvent(new Ot("removelayer",e[t]))}this.set(Dt,e)}getLayersArray(e){return e=void 0!==e?e:[],this.getLayers().forEach((function(t){t.getLayersArray(e)})),e}getLayerStatesArray(e){const t=void 0!==e?e:[],r=t.length;this.getLayers().forEach((function(e){e.getLayerStatesArray(t)}));const n=this.getLayerState();let i=n.zIndex;e||void 0!==n.zIndex||(i=0);for(let e=r,o=t.length;e<o;e++){const r=t[e];r.opacity*=n.opacity,r.visible=r.visible&&n.visible,r.maxResolution=Math.min(r.maxResolution,n.maxResolution),r.minResolution=Math.max(r.minResolution,n.minResolution),r.minZoom=Math.max(r.minZoom,n.minZoom),r.maxZoom=Math.min(r.maxZoom,n.maxZoom),void 0!==n.extent&&(void 0!==r.extent?r.extent=(0,ee._N)(r.extent,n.extent):r.extent=n.extent),void 0===r.zIndex&&(r.zIndex=i)}return t}getSourceState(){return"ready"}}const kt=Nt,Ft={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};function Gt(e,t){if(!e.visible)return!1;const r=t.resolution;if(r<e.minResolution||r>=e.maxResolution)return!1;const n=t.zoom;return n>e.minZoom&&n<=e.maxZoom}const Bt=class extends Rt{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(Pt,this.handleSourcePropertyChange_);const r=e.source?e.source:null;this.setSource(r)}getLayersArray(e){return(e=e||[]).push(this),e}getLayerStatesArray(e){return(e=e||[]).push(this.getLayerState()),e}getSource(){return this.get(Pt)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&((0,v.JH)(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=(0,v.KT)(e,f.A.CHANGE,this.handleSourceChange_,this),"ready"===e.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0)),this.clearRenderer()),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return this.renderer_&&this.rendered?this.renderer_.getData(e):null}isVisible(e){let t;const r=this.getMapInternal();let n;if(!e&&r&&(e=r.getView()),t=e instanceof ge?{viewState:e.getState(),extent:e.calculateExtent()}:e,!t.layerStatesArray&&r&&(t.layerStatesArray=r.getLayerGroup().getLayerStatesArray()),t.layerStatesArray){if(n=t.layerStatesArray.find((e=>e.layer===this)),!n)return!1}else n=this.getLayerState();const i=this.getExtent();return Gt(n,t.viewState)&&(!i||(0,ee.HY)(i,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];const t=this.getSource()?.getAttributions();if(!t)return[];let r=t(e instanceof ge?e.getViewStateAndExtent():e);return Array.isArray(r)||(r=[r]),r}render(e,t){const r=this.getRenderer();return r.prepareFrame(e)?(this.rendered=!0,r.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(Mt,e)}getMapInternal(){return this.get(Mt)}setMap(e){this.mapPrecomposeKey_&&((0,v.JH)(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&((0,v.JH)(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=(0,v.KT)(e,Ft.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=(0,v.KT)(this,f.A.CHANGE,e.render,e),this.changed())}handlePrecompose_(e){const t=e.frameState.layerStatesArray,r=this.getLayerState(!1);(0,B.v)(!t.some((e=>e.layer===r.layer)),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),t.push(r)}setSource(e){this.set(Pt,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}};function Ut(e,t,r=0,n=e.length-1,i=Wt){for(;n>r;){if(n-r>600){const o=n-r+1,a=t-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);Ut(e,t,Math.max(r,Math.floor(t-a*l/o+c)),Math.min(n,Math.floor(t+(o-a)*l/o+c)),i)}const o=e[t];let a=r,s=n;for(qt(e,r,t),i(e[n],o)>0&&qt(e,r,n);a<s;){for(qt(e,a,s),a++,s--;i(e[a],o)<0;)a++;for(;i(e[s],o)>0;)s--}0===i(e[r],o)?qt(e,r,s):(s++,qt(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}}function qt(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function Wt(e,t){return e<t?-1:e>t?1:0}class Ht{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const r=[];if(!er(e,t))return r;const n=this.toBBox,i=[];for(;t;){for(let o=0;o<t.children.length;o++){const a=t.children[o],s=t.leaf?n(a):a;er(e,s)&&(t.leaf?r.push(a):Qt(e,s)?this._all(a,r):i.push(a))}t=i.pop()}return r}collides(e){let t=this.data;if(!er(e,t))return!1;const r=[];for(;t;){for(let n=0;n<t.children.length;n++){const i=t.children[n],o=t.leaf?this.toBBox(i):i;if(er(e,o)){if(t.leaf||Qt(e,o))return!0;r.push(i)}}t=r.pop()}return!1}load(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=tr([]),this}remove(e,t){if(!e)return this;let r=this.data;const n=this.toBBox(e),i=[],o=[];let a,s,l;for(;r||i.length;){if(r||(r=i.pop(),s=i[i.length-1],a=o.pop(),l=!0),r.leaf){const n=jt(e,r.children,t);if(-1!==n)return r.children.splice(n,1),i.push(r),this._condense(i),this}l||r.leaf||!Qt(r,n)?s?(a++,r=s.children[a],l=!1):r=null:(i.push(r),o.push(a),a=0,s=r,r=r.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){const i=r-t+1;let o,a=this._maxEntries;if(i<=a)return o=tr(e.slice(t,r+1)),Vt(o,this.toBBox),o;n||(n=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,n-1))),o=tr([]),o.leaf=!1,o.height=n;const s=Math.ceil(i/a),l=s*Math.ceil(Math.sqrt(a));rr(e,t,r,l,this.compareMinX);for(let i=t;i<=r;i+=l){const t=Math.min(i+l-1,r);rr(e,i,t,s,this.compareMinY);for(let r=i;r<=t;r+=s){const i=Math.min(r+s-1,t);o.children.push(this._build(e,r,i,n-1))}}return Vt(o,this.toBBox),o}_chooseSubtree(e,t,r,n){for(;n.push(t),!t.leaf&&n.length-1!==r;){let r,n=1/0,a=1/0;for(let s=0;s<t.children.length;s++){const l=t.children[s],c=Xt(l),u=(i=e,o=l,(Math.max(o.maxX,i.maxX)-Math.min(o.minX,i.minX))*(Math.max(o.maxY,i.maxY)-Math.min(o.minY,i.minY))-c);u<a?(a=u,n=c<n?c:n,r=l):u===a&&c<n&&(n=c,r=l)}t=r||t.children[0]}var i,o;return t}_insert(e,t,r){const n=r?e:this.toBBox(e),i=[],o=this._chooseSubtree(n,this.data,t,i);for(o.children.push(e),Yt(o,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(e,t){const r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);const o=this._chooseSplitIndex(r,i,n),a=tr(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,Vt(r,this.toBBox),Vt(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=tr([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Vt(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,i=1/0,o=1/0;for(let a=t;a<=r-t;a++){const t=zt(e,0,a,this.toBBox),s=zt(e,a,r,this.toBBox),l=Jt(t,s),c=Xt(t)+Xt(s);l<i?(i=l,n=a,o=c<o?c:o):l===i&&c<o&&(o=c,n=a)}return n||r-t}_chooseSplitAxis(e,t,r){const n=e.leaf?this.compareMinX:$t,i=e.leaf?this.compareMinY:Kt;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const i=this.toBBox,o=zt(e,0,t,i),a=zt(e,r-t,r,i);let s=Zt(o)+Zt(a);for(let n=t;n<r-t;n++){const t=e.children[n];Yt(o,e.leaf?i(t):t),s+=Zt(o)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];Yt(a,e.leaf?i(t):t),s+=Zt(a)}return s}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)Yt(t[n],e)}_condense(e){for(let t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children,t.splice(t.indexOf(e[r]),1)):this.clear():Vt(e[r],this.toBBox)}}function jt(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function Vt(e,t){zt(e,0,e.children.length,t,e)}function zt(e,t,r,n,i){i||(i=tr(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=t;o<r;o++){const t=e.children[o];Yt(i,e.leaf?n(t):t)}return i}function Yt(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function $t(e,t){return e.minX-t.minX}function Kt(e,t){return e.minY-t.minY}function Xt(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Zt(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Jt(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,o-n)}function Qt(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function er(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function tr(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function rr(e,t,r,n,i){const o=[t,r];for(;o.length;){if((r=o.pop())-(t=o.pop())<=n)continue;const a=t+Math.ceil((r-t)/n/2)*n;Ut(e,a,t,r,i),o.push(t,a,a,r)}}const nr=[NaN,NaN,NaN,0];let ir;const or=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,ar=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,sr=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,lr=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function cr(e,t){return e.endsWith("%")?Number(e.substring(0,e.length-1))/t:Number(e)}function ur(e){throw new Error('failed to parse "'+e+'" as color')}function hr(e){if(e.toLowerCase().startsWith("rgb")){const t=e.match(ar)||e.match(or)||e.match(sr);if(t){const e=t[4],r=100/255;return[(0,z.qE)(cr(t[1],r)+.5|0,0,255),(0,z.qE)(cr(t[2],r)+.5|0,0,255),(0,z.qE)(cr(t[3],r)+.5|0,0,255),void 0!==e?(0,z.qE)(cr(e,100),0,1):1]}ur(e)}if(e.startsWith("#")){if(lr.test(e)){const t=e.substring(1),r=t.length<=4?1:2,n=[0,0,0,255];for(let e=0,i=t.length;e<i;e+=r){let i=parseInt(t.substring(e,e+r),16);1===r&&(i+=i<<4),n[e/r]=i}return n[3]=n[3]/255,n}ur(e)}const t=(ir||(ir=_e(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),ir);t.fillStyle="#abcdef";let r=t.fillStyle;t.fillStyle=e,t.fillStyle===r&&(t.fillStyle="#fedcba",r=t.fillStyle,t.fillStyle=e,t.fillStyle===r&&ur(e));const n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return hr(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const i=Array.from(t.getImageData(0,0,1,1).data);return i[3]=(0,z.Mg)(i[3]/255,3),i}function dr(e){return"string"==typeof e?e:_r(e)}const pr={};let gr=0;function fr(e){if(4===e.length)return e;const t=e.slice();return t[3]=1,t}function mr(e){return e>.0031308?269.025*Math.pow(e,1/2.4)-14.025:3294.6*e}function yr(e){return e>.2068965?Math.pow(e,3):108/841*(e-4/29)}function vr(e){return e>10.314724?Math.pow((e+14.025)/269.025,2.4):e/3294.6}function Ar(e){return e>.0088564?Math.pow(e,1/3):e/(108/841)+4/29}function Sr(e){const t=vr(e[0]),r=vr(e[1]),n=vr(e[2]),i=Ar(.222488403*t+.716873169*r+.06060791*n),o=500*(Ar(.452247074*t+.399439023*r+.148375274*n)-i),a=200*(i-Ar(.016863605*t+.117638439*r+.865350722*n)),s=Math.atan2(a,o)*(180/Math.PI);return[116*i-16,Math.sqrt(o*o+a*a),s<0?s+360:s,e[3]]}function Er(e){if("none"===e)return nr;if(pr.hasOwnProperty(e))return pr[e];if(gr>=1024){let e=0;for(const t in pr)3&e++||(delete pr[t],--gr)}const t=hr(e);4!==t.length&&ur(e);for(const r of t)isNaN(r)&&ur(e);return pr[e]=t,++gr,t}function wr(e){return Array.isArray(e)?e:Er(e)}function _r(e){let t=e[0];t!=(0|t)&&(t=t+.5|0);let r=e[1];r!=(0|r)&&(r=r+.5|0);let n=e[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+t+","+r+","+n+","+(void 0===e[3]?1:Math.round(1e3*e[3])/1e3)+")"}function Lr(e){return e[0]>0&&e[1]>0}function Cr(e,t){return Array.isArray(e)?e:(void 0===t?t=[e,e]:(t[0]=e,t[1]=e),t)}let br=0;const Tr=1<<br++,xr=1<<br++,Pr=1<<br++,Mr=1<<br++,Ir=1<<br++,Rr=1<<br++,Or=Math.pow(2,6)-1,Dr={[Tr]:"boolean",[xr]:"number",[Pr]:"string",[Mr]:"color",[Ir]:"number[]",[Rr]:"size"},Nr=Object.keys(Dr).map(Number).sort(V.V_);function kr(e){const t=[];for(const r of Nr)Fr(e,r)&&t.push(Dr[r]);return 0===t.length?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function Fr(e,t){return(e&t)===t}function Gr(e,t){return e===t}class Br{constructor(e,t){if(!function(e){return e in Dr}(e))throw new Error(`literal expressions must have a specific type, got ${kr(e)}`);this.type=e,this.value=t}}class Ur{constructor(e,t,...r){this.type=e,this.operator=t,this.args=r}}function qr(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Wr(e,t,r){switch(typeof e){case"boolean":if(Gr(t,Pr))return new Br(Pr,e?"true":"false");if(!Fr(t,Tr))throw new Error(`got a boolean, but expected ${kr(t)}`);return new Br(Tr,e);case"number":if(Gr(t,Rr))return new Br(Rr,Cr(e));if(Gr(t,Tr))return new Br(Tr,!!e);if(Gr(t,Pr))return new Br(Pr,e.toString());if(!Fr(t,xr))throw new Error(`got a number, but expected ${kr(t)}`);return new Br(xr,e);case"string":if(Gr(t,Mr))return new Br(Mr,Er(e));if(Gr(t,Tr))return new Br(Tr,!!e);if(!Fr(t,Pr))throw new Error(`got a string, but expected ${kr(t)}`);return new Br(Pr,e)}if(!Array.isArray(e))throw new Error("expression must be an array or a primitive value");if(0===e.length)throw new Error("empty expression");if("string"==typeof e[0])return function(e,t,r){const n=e[0],i=Fn[n];if(!i)throw new Error(`unknown operator: ${n}`);return i(e,t,r)}(e,t,r);for(const t of e)if("number"!=typeof t)throw new Error("expected an array of numbers");if(Gr(t,Rr)){if(2!==e.length)throw new Error(`expected an array of two values for a size, got ${e.length}`);return new Br(Rr,e)}if(Gr(t,Mr)){if(3===e.length)return new Br(Mr,[...e,1]);if(4===e.length)return new Br(Mr,e);throw new Error(`expected an array of 3 or 4 values for a color, got ${e.length}`)}if(!Fr(t,Ir))throw new Error(`got an array of numbers, but expected ${kr(t)}`);return new Br(Ir,e)}const Hr="get",jr="var",Vr="concat",zr="geometry-type",Yr="line-metric",$r="any",Kr="all",Xr="!",Zr="resolution",Jr="zoom",Qr="time",en="==",tn="!=",rn=">",nn=">=",on="<",an="<=",sn="*",ln="/",cn="+",un="-",hn="clamp",dn="%",pn="^",gn="abs",fn="floor",mn="ceil",yn="round",vn="sin",An="cos",Sn="atan",En="sqrt",wn="match",_n="between",Ln="interpolate",Cn="coalesce",bn="case",Tn="in",xn="number",Pn="string",Mn="array",In="color",Rn="id",On="band",Dn="palette",Nn="to-string",kn="has",Fn={[Hr]:Vn(qn(1,1/0),Gn),[jr]:Vn(qn(1,1),(function(e,t,r){const n=e[1];if("string"!=typeof n)throw new Error("expected a string argument for var operation");return r.variables.add(n),[new Br(Pr,n)]})),[kn]:Vn(qn(1,1/0),Gn),[Rn]:Vn((function(e,t,r){r.featureId=!0}),Un),[Vr]:Vn(qn(2,1/0),Hn(Pr)),[zr]:Vn((function(e,t,r){r.geometryType=!0}),Un),[Yr]:Vn(Un),[Zr]:Vn(Bn,Un),[Jr]:Vn(Bn,Un),[Qr]:Vn(Bn,Un),[$r]:Vn(qn(2,1/0),Hn(Tr)),[Kr]:Vn(qn(2,1/0),Hn(Tr)),[Xr]:Vn(qn(1,1),Hn(Tr)),[en]:Vn(qn(2,2),Hn(Or)),[tn]:Vn(qn(2,2),Hn(Or)),[rn]:Vn(qn(2,2),Hn(xr)),[nn]:Vn(qn(2,2),Hn(xr)),[on]:Vn(qn(2,2),Hn(xr)),[an]:Vn(qn(2,2),Hn(xr)),[sn]:Vn(qn(2,1/0),Wn),[Cn]:Vn(qn(2,1/0),Wn),[ln]:Vn(qn(2,2),Hn(xr)),[cn]:Vn(qn(2,1/0),Hn(xr)),[un]:Vn(qn(2,2),Hn(xr)),[hn]:Vn(qn(3,3),Hn(xr)),[dn]:Vn(qn(2,2),Hn(xr)),[pn]:Vn(qn(2,2),Hn(xr)),[gn]:Vn(qn(1,1),Hn(xr)),[fn]:Vn(qn(1,1),Hn(xr)),[mn]:Vn(qn(1,1),Hn(xr)),[yn]:Vn(qn(1,1),Hn(xr)),[vn]:Vn(qn(1,1),Hn(xr)),[An]:Vn(qn(1,1),Hn(xr)),[Sn]:Vn(qn(1,2),Hn(xr)),[En]:Vn(qn(1,1),Hn(xr)),[wn]:Vn(qn(4,1/0),jn,(function(e,t,r){const n=e.length-1,i=Pr|xr|Tr,o=Wr(e[1],i,r),a=Wr(e[e.length-1],t,r),s=new Array(n-2);for(let t=0;t<n-2;t+=2){try{const n=Wr(e[t+2],o.type,r);s[t]=n}catch(e){throw new Error(`failed to parse argument ${t+1} of match expression: ${e.message}`)}try{const n=Wr(e[t+3],a.type,r);s[t+1]=n}catch(e){throw new Error(`failed to parse argument ${t+2} of match expression: ${e.message}`)}}return[o,...s,a]})),[_n]:Vn(qn(3,3),Hn(xr)),[Ln]:Vn(qn(6,1/0),jn,(function(e,t,r){const n=e[1];let i;switch(n[0]){case"linear":i=1;break;case"exponential":const e=n[1];if("number"!=typeof e||e<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(e)} instead`);i=e;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const o=new Br(xr,i);let a;try{a=Wr(e[2],xr,r)}catch(e){throw new Error(`failed to parse argument 1 in interpolate expression: ${e.message}`)}const s=new Array(e.length-3);for(let n=0;n<s.length;n+=2){try{const t=Wr(e[n+3],xr,r);s[n]=t}catch(e){throw new Error(`failed to parse argument ${n+2} for interpolate expression: ${e.message}`)}try{const i=Wr(e[n+4],t,r);s[n+1]=i}catch(e){throw new Error(`failed to parse argument ${n+3} for interpolate expression: ${e.message}`)}}return[o,a,...s]})),[bn]:Vn(qn(3,1/0),(function(e,t,r){const n=e[0],i=e.length-1;if(i%2==0)throw new Error(`expected an odd number of arguments for ${n}, got ${i} instead`)}),(function(e,t,r){const n=Wr(e[e.length-1],t,r),i=new Array(e.length-1);for(let t=0;t<i.length-1;t+=2){try{const n=Wr(e[t+1],Tr,r);i[t]=n}catch(e){throw new Error(`failed to parse argument ${t} of case expression: ${e.message}`)}try{const o=Wr(e[t+2],n.type,r);i[t+1]=o}catch(e){throw new Error(`failed to parse argument ${t+1} of case expression: ${e.message}`)}}return i[i.length-1]=n,i})),[Tn]:Vn(qn(2,2),(function(e,t,r){let n,i=e[2];if(!Array.isArray(i))throw new Error('the second argument for the "in" operator must be an array');if("string"==typeof i[0]){if("literal"!==i[0])throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(i[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');i=i[1],n=Pr}else n=xr;const o=new Array(i.length);for(let e=0;e<o.length;e++)try{const t=Wr(i[e],n,r);o[e]=t}catch(t){throw new Error(`failed to parse haystack item ${e} for "in" expression: ${t.message}`)}return[Wr(e[1],n,r),...o]})),[xn]:Vn(qn(1,1/0),Hn(Or)),[Pn]:Vn(qn(1,1/0),Hn(Or)),[Mn]:Vn(qn(1,1/0),Hn(xr)),[In]:Vn(qn(1,4),Hn(xr)),[On]:Vn(qn(1,3),Hn(xr)),[Dn]:Vn(qn(2,2),(function(e,t,r){let n;try{n=Wr(e[1],xr,r)}catch(e){throw new Error(`failed to parse first argument in palette expression: ${e.message}`)}const i=e[2];if(!Array.isArray(i))throw new Error("the second argument of palette must be an array");const o=new Array(i.length);for(let e=0;e<o.length;e++){let t;try{t=Wr(i[e],Mr,r)}catch(t){throw new Error(`failed to parse color at index ${e} in palette expression: ${t.message}`)}if(!(t instanceof Br))throw new Error(`the palette color at index ${e} must be a literal value`);o[e]=t}return[n,...o]})),[Nn]:Vn(qn(1,1),Hn(Tr|xr|Pr|Mr))};function Gn(e,t,r){const n=e.length-1,i=new Array(n);for(let t=0;t<n;++t){const n=e[t+1];switch(typeof n){case"number":i[t]=new Br(xr,n);break;case"string":i[t]=new Br(Pr,n);break;default:throw new Error(`expected a string key or numeric array index for a get operation, got ${n}`)}0===t&&r.properties.add(String(n))}return i}function Bn(e,t,r){r.mapState=!0}function Un(e,t,r){const n=e[0];if(1!==e.length)throw new Error(`expected no arguments for ${n} operation`);return[]}function qn(e,t){return function(r,n,i){const o=r[0],a=r.length-1;if(e===t){if(a!==e)throw new Error(`expected ${e} argument${1===e?"":"s"} for ${o}, got ${a}`)}else if(a<e||a>t)throw new Error(`expected ${t===1/0?`${e} or more`:`${e} to ${t}`} arguments for ${o}, got ${a}`)}}function Wn(e,t,r){const n=e.length-1,i=new Array(n);for(let o=0;o<n;++o){const n=Wr(e[o+1],t,r);i[o]=n}return i}function Hn(e){return function(t,r,n){const i=t.length-1,o=new Array(i);for(let r=0;r<i;++r){const i=Wr(t[r+1],e,n);o[r]=i}return o}}function jn(e,t,r){const n=e[0],i=e.length-1;if(i%2==1)throw new Error(`expected an even number of arguments for operation ${n}, got ${i} instead`)}function Vn(...e){return function(t,r,n){const i=t[0];let o;for(let i=0;i<e.length;i++){const a=e[i](t,r,n);if(i==e.length-1){if(!a)throw new Error("expected last argument validator to return the parsed args");o=a}}return new Ur(r,i,...o)}}function zn(e){if(!e)return"";const t=e.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return zn(e.getGeometries()[0]);default:return""}}function Yn(e,t,r){return $n(Wr(e,t,r),r)}function $n(e,t){if(e instanceof Br){if(e.type===Mr&&"string"==typeof e.value){const t=Er(e.value);return function(){return t}}return function(){return e.value}}const r=e.operator;switch(r){case xn:case Pn:case Cn:return function(e,t){const r=e.operator,n=e.args.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=$n(e.args[r],t);switch(r){case Cn:return e=>{for(let t=0;t<n;++t){const r=i[t](e);if(null!=r)return r}throw new Error("Expected one of the values to be non-null")};case xn:case Pn:return e=>{for(let t=0;t<n;++t){const n=i[t](e);if(typeof n===r)return n}throw new Error(`Expected one of the values to be a ${r}`)};default:throw new Error(`Unsupported assertion operator ${r}`)}}(e,t);case Hr:case jr:case kn:return function(e){const t=e.args[0].value;switch(e.operator){case Hr:return r=>{const n=e.args;let i=r.properties[t];for(let e=1,t=n.length;e<t;++e)i=i[n[e].value];return i};case jr:return e=>e.variables[t];case kn:return r=>{const n=e.args;if(!(t in r.properties))return!1;let i=r.properties[t];for(let e=1,t=n.length;e<t;++e){const t=n[e].value;if(!i||!Object.hasOwn(i,t))return!1;i=i[t]}return!0};default:throw new Error(`Unsupported accessor operator ${e.operator}`)}}(e);case Rn:return e=>e.featureId;case zr:return e=>e.geometryType;case Vr:{const r=e.args.map((e=>$n(e,t)));return e=>"".concat(...r.map((t=>t(e).toString())))}case Zr:return e=>e.resolution;case $r:case Kr:case _n:case Tn:case Xr:return function(e,t){const r=e.operator,n=e.args.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=$n(e.args[r],t);switch(r){case $r:return e=>{for(let t=0;t<n;++t)if(i[t](e))return!0;return!1};case Kr:return e=>{for(let t=0;t<n;++t)if(!i[t](e))return!1;return!0};case _n:return e=>{const t=i[0](e),r=i[1](e),n=i[2](e);return t>=r&&t<=n};case Tn:return e=>{const t=i[0](e);for(let r=1;r<n;++r)if(t===i[r](e))return!0;return!1};case Xr:return e=>!i[0](e);default:throw new Error(`Unsupported logical operator ${r}`)}}(e,t);case en:case tn:case on:case an:case rn:case nn:return function(e,t){const r=e.operator,n=$n(e.args[0],t),i=$n(e.args[1],t);switch(r){case en:return e=>n(e)===i(e);case tn:return e=>n(e)!==i(e);case on:return e=>n(e)<i(e);case an:return e=>n(e)<=i(e);case rn:return e=>n(e)>i(e);case nn:return e=>n(e)>=i(e);default:throw new Error(`Unsupported comparison operator ${r}`)}}(e,t);case sn:case ln:case cn:case un:case hn:case dn:case pn:case gn:case fn:case mn:case yn:case vn:case An:case Sn:case En:return function(e,t){const r=e.operator,n=e.args.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=$n(e.args[r],t);switch(r){case sn:return e=>{let t=1;for(let r=0;r<n;++r)t*=i[r](e);return t};case ln:return e=>i[0](e)/i[1](e);case cn:return e=>{let t=0;for(let r=0;r<n;++r)t+=i[r](e);return t};case un:return e=>i[0](e)-i[1](e);case hn:return e=>{const t=i[0](e),r=i[1](e);if(t<r)return r;const n=i[2](e);return t>n?n:t};case dn:return e=>i[0](e)%i[1](e);case pn:return e=>Math.pow(i[0](e),i[1](e));case gn:return e=>Math.abs(i[0](e));case fn:return e=>Math.floor(i[0](e));case mn:return e=>Math.ceil(i[0](e));case yn:return e=>Math.round(i[0](e));case vn:return e=>Math.sin(i[0](e));case An:return e=>Math.cos(i[0](e));case Sn:return 2===n?e=>Math.atan2(i[0](e),i[1](e)):e=>Math.atan(i[0](e));case En:return e=>Math.sqrt(i[0](e));default:throw new Error(`Unsupported numeric operator ${r}`)}}(e,t);case bn:return function(e,t){const r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=$n(e.args[i],t);return e=>{for(let t=0;t<r-1;t+=2)if(n[t](e))return n[t+1](e);return n[r-1](e)}}(e,t);case wn:return function(e,t){const r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=$n(e.args[i],t);return e=>{const t=n[0](e);for(let i=1;i<r-1;i+=2)if(t===n[i](e))return n[i+1](e);return n[r-1](e)}}(e,t);case Ln:return function(e,t){const r=e.args.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=$n(e.args[i],t);return e=>{const t=n[0](e),i=n[1](e);let o,a;for(let s=2;s<r;s+=2){const r=n[s](e);let l=n[s+1](e);const c=Array.isArray(l);if(c&&(l=fr(l)),r>=i)return 2===s?l:c?Xn(t,i,o,a,r,l):Kn(t,i,o,a,r,l);o=r,a=l}return a}}(e,t);case Nn:return function(e,t){const r=e.operator,n=e.args.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=$n(e.args[r],t);if(r===Nn)return t=>{const r=i[0](t);return e.args[0].type===Mr?_r(r):r.toString()};throw new Error(`Unsupported convert operator ${r}`)}(e,t);default:throw new Error(`Unsupported operator ${r}`)}}function Kn(e,t,r,n,i,o){const a=i-r;if(0===a)return n;const s=t-r;return n+(1===e?s/a:(Math.pow(e,s)-1)/(Math.pow(e,a)-1))*(o-n)}function Xn(e,t,r,n,i,o){if(0==i-r)return n;const a=Sr(n),s=Sr(o);let l=s[2]-a[2];return l>180?l-=360:l<-180&&(l+=360),function(e){const t=(e[0]+16)/116,r=e[1],n=e[2]*Math.PI/180,i=yr(t),o=yr(t+r/500*Math.cos(n)),a=yr(t-r/200*Math.sin(n)),s=mr(3.021973625*o-1.617392459*i-.404875592*a),l=mr(-.943766287*o+1.916279586*i+.027607165*a),c=mr(.069407491*o-.22898585*i+1.159737864*a);return[(0,z.qE)(s+.5|0,0,255),(0,z.qE)(l+.5|0,0,255),(0,z.qE)(c+.5|0,0,255),e[3]]}([Kn(e,t,r,a[0],i,s[0]),Kn(e,t,r,a[1],i,s[1]),a[2]+Kn(e,t,r,0,i,l),Kn(e,t,r,n[3],i,o[3])])}class Zn extends y.A{constructor(e,t,r,n){super(),this.extent=e,this.pixelRatio_=r,this.resolution=t,this.state="function"==typeof n?0:n,this.image_=null,this.loader="function"==typeof n?n:null}changed(){this.dispatchEvent(f.A.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(0==this.state&&this.loader){this.state=1,this.changed();const e=this.getResolution(),t=Array.isArray(e)?e[0]:e;(0,te.hq)((()=>this.loader(this.getExtent(),t,this.getPixelRatio()))).then((e=>{"image"in e&&(this.image_=e.image),"extent"in e&&(this.extent=e.extent),"resolution"in e&&(this.resolution=e.resolution),"pixelRatio"in e&&(this.pixelRatio_=e.pixelRatio),(e instanceof HTMLImageElement||b&&e instanceof ImageBitmap||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement)&&(this.image_=e),this.state=2})).catch((e=>{this.state=3,console.error(e)})).finally((()=>this.changed()))}}setImage(e){this.image_=e}setResolution(e){this.resolution=e}}function Jn(e,t){return t&&(e.src=t),e.src&&C?new Promise(((t,r)=>e.decode().then((()=>t(e))).catch((n=>e.complete&&e.width?t(e):r(n))))):function(e){return new Promise(((t,r)=>{function n(){o(),t(e)}function i(){o(),r(new Error("Image load error"))}function o(){e.removeEventListener("load",n),e.removeEventListener("error",i)}e.addEventListener("load",n),e.addEventListener("error",i)}))}(e)}function Qn(e,t){return t&&(e.src=t),e.src&&C&&b?e.decode().then((()=>createImageBitmap(e))).catch((t=>{if(e.complete&&e.width)return e;throw t})):Jn(e)}const ei=Zn;function ti(e,t,r){return t+":"+e+":"+(r?wr(r):"null")}const ri=new class{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const r=this.cache_[t];3&e++||r.hasListener()||(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,r){const n=ti(e,t,r);return n in this.cache_?this.cache_[n]:null}getPattern(e,t,r){const n=ti(e,t,r);return n in this.patternCache_?this.patternCache_[n]:null}set(e,t,r,n,i){const o=ti(e,t,r),a=o in this.cache_;this.cache_[o]=n,i&&(0===n.getImageState()&&n.load(),1===n.getImageState()?n.ready().then((()=>{this.patternCache_[o]=Ce().createPattern(n.getImage(1),"repeat")})):this.patternCache_[o]=Ce().createPattern(n.getImage(1),"repeat")),a||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}};let ni=null;class ii extends y.A{constructor(e,t,r,n,i){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=r,this.canvas_={},this.color_=i,this.imageState_=void 0===n?0:n,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&2===this.imageState_){ni||(ni=_e(1,1,void 0,{willReadFrequently:!0})),ni.drawImage(this.image_,0,0);try{ni.getImageData(0,0,1,1),this.tainted_=!1}catch{ni=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(f.A.CHANGE)}handleImageError_(){this.imageState_=3,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=2,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],r=_e(e,t);r.fillRect(0,0,e,t),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(0===this.imageState_){this.image_||this.initializeImage_(),this.imageState_=1;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&Jn(this.image_,this.src_).then((e=>{this.image_=e,this.handleImageLoad_()})).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||2!==this.imageState_)return;const t=this.image_,r=_e(Math.ceil(t.width*e),Math.ceil(t.height*e)),n=r.canvas;r.scale(e,e),r.drawImage(t,0,0),r.globalCompositeOperation="multiply",r.fillStyle=dr(this.color_),r.fillRect(0,0,n.width/e,n.height/e),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),this.canvas_[e]=n}ready(){return this.ready_||(this.ready_=new Promise((e=>{if(2===this.imageState_||3===this.imageState_)e();else{const t=()=>{2!==this.imageState_&&3!==this.imageState_||(this.removeEventListener(f.A.CHANGE,t),e())};this.addEventListener(f.A.CHANGE,t)}}))),this.ready_}}function oi(e,t,r,n,i,o){let a=void 0===t?void 0:ri.get(t,r,i);return a||(a=new ii(e,e&&"src"in e?e.src||void 0:t,r,n,i),ri.set(t,r,i,a,o)),o&&a&&!ri.getPattern(t,r,i)&&ri.set(t,r,i,a,o),a}const ai=ii;function si(e){return e?Array.isArray(e)?_r(e):"object"==typeof e&&"src"in e?function(e){if(!e.offset||!e.size)return ri.getPattern(e.src,"anonymous",e.color);const t=e.src+":"+e.offset,r=ri.getPattern(t,void 0,e.color);if(r)return r;const n=ri.get(e.src,"anonymous",null);if(2!==n.getImageState())return null;const i=_e(e.size[0],e.size[1]);return i.drawImage(n.getImage(1),e.offset[0],e.offset[1],e.size[0],e.size[1],0,0,e.size[0],e.size[1]),oi(i.canvas,t,void 0,2,e.color,!0),ri.getPattern(t,void 0,e.color)}(e):e:null}const li="10px sans-serif",ci="#000",ui="round",hi=[],di="round",pi="#000",gi="center",fi="middle",mi=[0,0,0,0],yi=new a.A;let vi,Ai=null;const Si={},Ei=function(){const e="32px ",t=["monospace","serif"],r=t.length,n="wmytzilWMYTZIL@#/&?$%10";let i,o;function a(i,a,s){let l=!0;for(let c=0;c<r;++c){const r=t[c];if(o=Li(i+" "+a+" "+e+r,n),s!=r){const t=Li(i+" "+a+" "+e+s+","+r,n);l=l&&t!=o}}return!!l}function s(){let e=!0;const t=yi.getKeys();for(let r=0,n=t.length;r<n;++r){const n=t[r];if(yi.get(n)<100){const[t,r,i]=n.split("\n");a(t,r,i)?((0,U.I)(Si),Ai=null,vi=void 0,yi.set(n,100)):(yi.set(n,yi.get(n)+1,!0),e=!1)}}e&&(clearInterval(i),i=void 0)}return function(e){const t=we(e);if(!t)return;const r=t.families;for(let e=0,n=r.length;e<n;++e){const n=r[e],o=t.style+"\n"+t.weight+"\n"+n;void 0===yi.get(o)&&(yi.set(o,100,!0),a(t.style,t.weight,n)||(yi.set(o,0,!0),void 0===i&&(i=setInterval(s,32))))}}}(),wi=function(){let e;return function(t){let r=Si[t];if(null==r){if(L){const e=we(t),n=_i(t,"Žg");r=(isNaN(Number(e.lineHeight))?1.2:Number(e.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else e||(e=document.createElement("div"),e.innerHTML="M",e.style.minHeight="0",e.style.maxHeight="none",e.style.height="auto",e.style.padding="0",e.style.border="none",e.style.position="absolute",e.style.display="block",e.style.left="-99999px"),e.style.font=t,document.body.appendChild(e),r=e.offsetHeight,document.body.removeChild(e);Si[t]=r}return r}}();function _i(e,t){return Ai||(Ai=_e(1,1)),e!=vi&&(Ai.font=e,vi=Ai.font),Ai.measureText(t)}function Li(e,t){return _i(e,t).width}function Ci(e,t,r){if(t in r)return r[t];const n=t.split("\n").reduce(((t,r)=>Math.max(t,Li(e,r))),0);return r[t]=n,n}class bi{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Cr(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new bi({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return(0,n.b0)()}getImage(e){return(0,n.b0)()}getHitDetectionImage(){return(0,n.b0)()}getPixelRatio(e){return 1}getImageState(){return(0,n.b0)()}getImageSize(){return(0,n.b0)()}getOrigin(){return(0,n.b0)()}getSize(){return(0,n.b0)()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Cr(e)}listenImageChange(e){(0,n.b0)()}load(){(0,n.b0)()}unlistenImageChange(e){(0,n.b0)()}ready(){return Promise.resolve()}}const Ti=bi;class xi extends Ti{constructor(e){super({opacity:1,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,rotation:void 0!==e.rotation?e.rotation:0,scale:void 0!==e.scale?e.scale:1,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=void 0!==e.fill?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius=e.radius,this.radius2_=e.radius2,this.angle_=void 0!==e.angle?e.angle:0,this.stroke_=void 0!==e.stroke?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?1:2,1===this.imageState_&&this.ready().then((()=>this.imageState_=2)),this.render()}clone(){const e=this.getScale(),t=new xi({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),r=this.getScaleArray();return[e[0]/2-t[0]/r[0],e[1]/2+t[1]/r[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){const t=this.fill_?.getKey(),r=`${e},${this.angle_},${this.radius},${this.radius2_},${this.points_},${t}`+Object.values(this.renderOptions_).join(",");let n=ri.get(r,null,null)?.getImage(1);if(!n){const t=this.renderOptions_,i=Math.ceil(t.size*e),o=_e(i,i);this.draw_(t,o,e),n=o.canvas,ri.set(r,null,null,new ai(n,void 0,null,2,null))}return n}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,r){if(0===t||this.points_===1/0||"bevel"!==e&&"miter"!==e)return t;let n=this.radius,i=void 0===this.radius2_?n:this.radius2_;if(n<i){const e=n;n=i,i=e}const o=void 0===this.radius2_?this.points_:2*this.points_,a=2*Math.PI/o,s=i*Math.sin(a),l=n-Math.sqrt(i*i-s*s),c=Math.sqrt(s*s+l*l),u=c/s;if("miter"===e&&u<=r)return u*t;const h=t/2/u,d=t/2*(l/c),p=Math.sqrt((n+h)*(n+h)+d*d)-n;if(void 0===this.radius2_||"bevel"===e)return 2*p;const g=n*Math.sin(a),f=i-Math.sqrt(n*n-g*g),m=Math.sqrt(g*g+f*f)/g;if(m<=r){const e=m*t/2-i-n;return 2*Math.max(p,e)}return 2*p}createRenderOptions(){let e,t=ui,r=di,n=0,i=null,o=0,a=0;this.stroke_&&(e=si(this.stroke_.getColor()??pi),a=this.stroke_.getWidth()??1,i=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset()??0,r=this.stroke_.getLineJoin()??di,t=this.stroke_.getLineCap()??ui,n=this.stroke_.getMiterLimit()??10);const s=this.calculateLineJoinSize_(r,a,n),l=Math.max(this.radius,this.radius2_||0);return{strokeStyle:e,strokeWidth:a,size:Math.ceil(2*l+s),lineCap:t,lineDash:i,lineDashOffset:o,lineJoin:r,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,r){if(t.scale(r,r),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let e=this.fill_.getColor();null===e&&(e=ci),t.fillStyle=si(e),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let r=this.fill_.getColor(),n=0;"string"==typeof r&&(r=wr(r)),null===r?n=1:Array.isArray(r)&&(n=4===r.length?r[3]:1),0===n&&(t=_e(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const r=this.radius;if(t===1/0)e.arc(0,0,r,0,2*Math.PI);else{const n=void 0===this.radius2_?r:this.radius2_;void 0!==this.radius2_&&(t*=2);const i=this.angle_-Math.PI/2,o=2*Math.PI/t;for(let a=0;a<t;a++){const t=i+a*o,s=a%2==0?r:n;e.lineTo(s*Math.cos(t),s*Math.sin(t))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=ci,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}const Pi=xi;class Mi extends Pi{constructor(e){super({points:1/0,fill:(e=e||{radius:5}).fill,radius:e.radius,stroke:e.stroke,scale:void 0!==e.scale?e.scale:1,rotation:void 0!==e.rotation?e.rotation:0,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new Mi({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius=e,this.render()}}const Ii=Mi;class Ri{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,void 0!==e.color&&this.setColor(e.color)}clone(){const e=this.getColor();return new Ri({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(null!==e&&"object"==typeof e&&"src"in e){const t=oi(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then((()=>{this.patternImage_=null})),0===t.getImageState()&&t.load(),1===t.getImageState()&&(this.patternImage_=t)}this.color_=e}getKey(){const e=this.getColor();return e?e instanceof CanvasPattern||e instanceof CanvasGradient?(0,n.v6)(e):"object"==typeof e&&"src"in e?e.src+":"+e.offset:wr(e).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}const Oi=Ri;function Di(e,t,r,n){return void 0!==r&&void 0!==n?[r/e,n/t]:void 0!==r?r/e:void 0!==n?n/t:1}class Ni extends Ti{constructor(e){const t=void 0!==(e=e||{}).opacity?e.opacity:1,r=void 0!==e.rotation?e.rotation:0,i=void 0!==e.scale?e.scale:1,o=void 0!==e.rotateWithView&&e.rotateWithView;super({opacity:t,rotation:r,scale:i,displacement:void 0!==e.displacement?e.displacement:[0,0],rotateWithView:o,declutterMode:e.declutterMode}),this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:"fraction",this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;const a=void 0!==e.img?e.img:null;let s,l=e.src;if((0,B.v)(!(void 0!==l&&a),"`image` and `src` cannot be provided at the same time"),void 0!==l&&0!==l.length||!a||(l=a.src||(0,n.v6)(a)),(0,B.v)(void 0!==l&&l.length>0,"A defined and non-empty `src` or `image` must be provided"),(0,B.v)(!((void 0!==e.width||void 0!==e.height)&&void 0!==e.scale),"`width` or `height` cannot be provided together with `scale`"),void 0!==e.src?s=0:void 0!==a&&(s="complete"in a?a.complete?a.src?2:0:1:2),this.color_=void 0!==e.color?wr(e.color):null,this.iconImage_=oi(a,l,this.crossOrigin_,s,this.color_),this.offset_=void 0!==e.offset?e.offset:[0,0],this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==e.size?e.size:null,this.initialOptions_,void 0!==e.width||void 0!==e.height){let t,r;if(e.size)[t,r]=e.size;else{const n=this.getImage(1);if(n.width&&n.height)t=n.width,r=n.height;else if(n instanceof HTMLImageElement){this.initialOptions_=e;const t=()=>{if(this.unlistenImageChange(t),!this.initialOptions_)return;const r=this.iconImage_.getSize();this.setScale(Di(r[0],r[1],e.width,e.height))};return void this.listenImageChange(t)}}void 0!==t&&this.setScale(Di(t,r,e.width,e.height))}}clone(){let e,t,r;return this.initialOptions_?(t=this.initialOptions_.width,r=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new Ni({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:r,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const t=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!t)return null;e=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(e[0]*=t[0]),"fraction"==this.anchorYUnits_&&(e[1]*=t[1])}if("top-left"!=this.anchorOrigin_){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(e[0]=-e[0]+t[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),r=this.getScaleArray();return[e[0]-t[0]/r[0],e[1]+t[1]/r[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if("top-left"!=this.offsetOrigin_){const t=this.getSize(),r=this.iconImage_.getSize();if(!t||!r)return null;e=e.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(e[0]=r[0]-t[0]-e[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(e[1]=r[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();return this.size_?this.size_[0]*e[0]:2==this.iconImage_.getImageState()?this.iconImage_.getSize()[0]*e[0]:void 0}getHeight(){const e=this.getScaleArray();return this.size_?this.size_[1]*e[1]:2==this.iconImage_.getImageState()?this.iconImage_.getSize()[1]*e[1]:void 0}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(f.A.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(f.A.CHANGE,e)}ready(){return this.iconImage_.ready()}}const ki=Ni;class Fi{constructor(e){e=e||{},this.color_=void 0!==e.color?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=void 0!==e.lineDash?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Fi({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}const Gi=Fi;class Bi{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=Hi,void 0!==e.geometry&&this.setGeometry(e.geometry),this.fill_=void 0!==e.fill?e.fill:null,this.image_=void 0!==e.image?e.image:null,this.renderer_=void 0!==e.renderer?e.renderer:null,this.hitDetectionRenderer_=void 0!==e.hitDetectionRenderer?e.hitDetectionRenderer:null,this.stroke_=void 0!==e.stroke?e.stroke:null,this.text_=void 0!==e.text?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&"object"==typeof e&&(e=e.clone()),new Bi({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=Hi,this.geometry_=e}setZIndex(e){this.zIndex_=e}}let Ui=null;function qi(e,t){if(!Ui){const e=new Oi({color:"rgba(255,255,255,0.4)"}),t=new Gi({color:"#3399CC",width:1.25});Ui=[new Bi({image:new Ii({fill:e,stroke:t,radius:5}),fill:e,stroke:t})]}return Ui}function Wi(){const e={},t=[255,255,255,1],r=[0,153,255,1];return e.Polygon=[new Bi({fill:new Oi({color:[255,255,255,.5]})})],e.MultiPolygon=e.Polygon,e.LineString=[new Bi({stroke:new Gi({color:t,width:5})}),new Bi({stroke:new Gi({color:r,width:3})})],e.MultiLineString=e.LineString,e.Circle=e.Polygon.concat(e.LineString),e.Point=[new Bi({image:new Ii({radius:6,fill:new Oi({color:r}),stroke:new Gi({color:t,width:1.5})}),zIndex:1/0})],e.MultiPoint=e.Point,e.GeometryCollection=e.Polygon.concat(e.LineString,e.Point),e}function Hi(e){return e.getGeometry()}const ji=Bi;class Vi{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.keepUpright_=e.keepUpright,this.scale_=e.scale,this.scaleArray_=Cr(void 0!==e.scale?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=void 0!==e.fill?e.fill:new Oi({color:"#333"}),this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4,this.placement_=void 0!==e.placement?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=void 0!==e.stroke?e.stroke:null,this.offsetX_=void 0!==e.offsetX?e.offsetX:0,this.offsetY_=void 0!==e.offsetY?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=void 0===e.padding?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new Vi({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setKeepUpright(e){this.keepUpright_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Cr(void 0!==e?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}const zi=Vi;function Yi(e){return!0}function $i(e){const t=qr(),r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=Ki(e[i],t);const i={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""},o=new Array(r);return function(e,a){if(i.properties=e.getPropertiesInternal(),i.resolution=a,t.featureId){const t=e.getId();i.featureId=void 0!==t?t:null}let s=0;for(let e=0;e<r;++e){const t=n[e](i);t&&(o[s]=t,s+=1)}return o.length=s,o}}function Ki(e,t){const r=Xi(e,"",t),n=Zi(e,"",t),i=function(e,t){const r="text-",n=Qi(e,r+"value",t);if(!n)return null;const i=Xi(e,r,t),o=Xi(e,r+"background-",t),a=Zi(e,r,t),s=Zi(e,r+"background-",t),l=Qi(e,r+"font",t),c=Ji(e,r+"max-angle",t),u=Ji(e,r+"offset-x",t),h=Ji(e,r+"offset-y",t),d=eo(e,r+"overflow",t),p=Qi(e,r+"placement",t),g=Ji(e,r+"repeat",t),f=oo(e,r+"scale",t),m=eo(e,r+"rotate-with-view",t),y=Ji(e,r+"rotation",t),v=Qi(e,r+"align",t),A=Qi(e,r+"justify",t),S=Qi(e,r+"baseline",t),E=eo(e,r+"keep-upright",t),w=ro(e,r+"padding",t),_=co(e,r+"declutter-mode"),L=new zi({declutterMode:_});return function(e){if(L.setText(n(e)),i&&L.setFill(i(e)),o&&L.setBackgroundFill(o(e)),a&&L.setStroke(a(e)),s&&L.setBackgroundStroke(s(e)),l&&L.setFont(l(e)),c&&L.setMaxAngle(c(e)),u&&L.setOffsetX(u(e)),h&&L.setOffsetY(h(e)),d&&L.setOverflow(d(e)),p){const t=p(e);if("point"!==t&&"line"!==t)throw new Error("Expected point or line for text-placement");L.setPlacement(t)}if(g&&L.setRepeat(g(e)),f&&L.setScale(f(e)),m&&L.setRotateWithView(m(e)),y&&L.setRotation(y(e)),v){const t=v(e);if("left"!==t&&"center"!==t&&"right"!==t&&"end"!==t&&"start"!==t)throw new Error("Expected left, right, center, start, or end for text-align");L.setTextAlign(t)}if(A){const t=A(e);if("left"!==t&&"right"!==t&&"center"!==t)throw new Error("Expected left, right, or center for text-justify");L.setJustify(t)}if(S){const t=S(e);if("bottom"!==t&&"top"!==t&&"middle"!==t&&"alphabetic"!==t&&"hanging"!==t)throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");L.setTextBaseline(t)}return w&&L.setPadding(w(e)),E&&L.setKeepUpright(E(e)),L}}(e,t),o=function(e,t){return"icon-src"in e?function(e,t){const r="icon-",n=r+"src",i=ho(e[n],n),o=no(e,r+"anchor",t),a=oo(e,r+"scale",t),s=Ji(e,r+"opacity",t),l=no(e,r+"displacement",t),c=Ji(e,r+"rotation",t),u=eo(e,r+"rotate-with-view",t),h=so(e,r+"anchor-origin"),d=lo(e,r+"anchor-x-units"),p=lo(e,r+"anchor-y-units"),g=function(e,t){const r=e[t];if(void 0!==r)return go(r,t)}(e,r+"color"),f=function(e,t){const r=e[t];if(void 0!==r){if("string"!=typeof r)throw new Error(`Expected a string for ${t}`);return r}}(e,r+"cross-origin"),m=function(e,t){const r=e[t];if(void 0!==r)return uo(r,t)}(e,r+"offset"),y=so(e,r+"offset-origin"),v=ao(e,r+"width"),A=ao(e,r+"height"),S=function(e,t){const r=e[t];if(void 0!==r){if("number"==typeof r)return Cr(r);if(!Array.isArray(r))throw new Error(`Expected a number or size array for ${t}`);if(2!==r.length||"number"!=typeof r[0]||"number"!=typeof r[1])throw new Error(`Expected a number or size array for ${t}`);return r}}(e,r+"size"),E=co(e,r+"declutter-mode"),w=new ki({src:i,anchorOrigin:h,anchorXUnits:d,anchorYUnits:p,color:g,crossOrigin:f,offset:m,offsetOrigin:y,height:A,width:v,size:S,declutterMode:E});return function(e){return s&&w.setOpacity(s(e)),l&&w.setDisplacement(l(e)),c&&w.setRotation(c(e)),u&&w.setRotateWithView(u(e)),a&&w.setScale(a(e)),o&&w.setAnchor(o(e)),w}}(e,t):"shape-points"in e?function(e,t){const r="shape-",n=r+"points",i=r+"radius",o=po(e[n],n),a=po(e[i],i),s=Xi(e,r,t),l=Zi(e,r,t),c=oo(e,r+"scale",t),u=no(e,r+"displacement",t),h=Ji(e,r+"rotation",t),d=eo(e,r+"rotate-with-view",t),p=ao(e,r+"radius2"),g=ao(e,r+"angle"),f=co(e,r+"declutter-mode"),m=new Pi({points:o,radius:a,radius2:p,angle:g,declutterMode:f});return function(e){return s&&m.setFill(s(e)),l&&m.setStroke(l(e)),u&&m.setDisplacement(u(e)),h&&m.setRotation(h(e)),d&&m.setRotateWithView(d(e)),c&&m.setScale(c(e)),m}}(e,t):"circle-radius"in e?function(e,t){const r="circle-",n=Xi(e,r,t),i=Zi(e,r,t),o=Ji(e,r+"radius",t),a=oo(e,r+"scale",t),s=no(e,r+"displacement",t),l=Ji(e,r+"rotation",t),c=eo(e,r+"rotate-with-view",t),u=co(e,r+"declutter-mode"),h=new Ii({radius:5,declutterMode:u});return function(e){return o&&h.setRadius(o(e)),n&&h.setFill(n(e)),i&&h.setStroke(i(e)),s&&h.setDisplacement(s(e)),l&&h.setRotation(l(e)),c&&h.setRotateWithView(c(e)),a&&h.setScale(a(e)),h}}(e,t):null}(e,t),a=Ji(e,"z-index",t);if(!(r||n||i||o||(0,U.p)(e)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(e));const s=new ji;return function(e){let t=!0;if(r){const n=r(e);n&&(t=!1),s.setFill(n)}if(n){const r=n(e);r&&(t=!1),s.setStroke(r)}if(i){const r=i(e);r&&(t=!1),s.setText(r)}if(o){const r=o(e);r&&(t=!1),s.setImage(r)}return a&&s.setZIndex(a(e)),t?null:s}}function Xi(e,t,r){let n;if(t+"fill-pattern-src"in e)n=function(e,t,r){const n=Qi(e,t+"pattern-src",r),i=io(e,t+"pattern-offset",r),o=io(e,t+"pattern-size",r),a=to(e,t+"color",r);return function(e){return{src:n(e),offset:i&&i(e),size:o&&o(e),color:a&&a(e)}}}(e,t+"fill-",r);else{if("none"===e[t+"fill-color"])return e=>null;n=to(e,t+"fill-color",r)}if(!n)return null;const i=new Oi;return function(e){const t=n(e);return t===nr?null:(i.setColor(t),i)}}function Zi(e,t,r){const n=Ji(e,t+"stroke-width",r),i=to(e,t+"stroke-color",r);if(!n&&!i)return null;const o=Qi(e,t+"stroke-line-cap",r),a=Qi(e,t+"stroke-line-join",r),s=ro(e,t+"stroke-line-dash",r),l=Ji(e,t+"stroke-line-dash-offset",r),c=Ji(e,t+"stroke-miter-limit",r),u=new Gi;return function(e){if(i){const t=i(e);if(t===nr)return null;u.setColor(t)}if(n&&u.setWidth(n(e)),o){const t=o(e);if("butt"!==t&&"round"!==t&&"square"!==t)throw new Error("Expected butt, round, or square line cap");u.setLineCap(t)}if(a){const t=a(e);if("bevel"!==t&&"round"!==t&&"miter"!==t)throw new Error("Expected bevel, round, or miter line join");u.setLineJoin(t)}return s&&u.setLineDash(s(e)),l&&u.setLineDashOffset(l(e)),c&&u.setMiterLimit(c(e)),u}}function Ji(e,t,r){if(!(t in e))return;const n=Yn(e[t],xr,r);return function(e){return po(n(e),t)}}function Qi(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Pr,r);return function(e){return ho(n(e),t)}}function eo(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Tr,r);return function(e){const r=n(e);if("boolean"!=typeof r)throw new Error(`Expected a boolean for ${t}`);return r}}function to(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Mr,r);return function(e){return go(n(e),t)}}function ro(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Ir,r);return function(e){return uo(n(e),t)}}function no(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Ir,r);return function(e){const r=uo(n(e),t);if(2!==r.length)throw new Error(`Expected two numbers for ${t}`);return r}}function io(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Ir,r);return function(e){return fo(n(e),t)}}function oo(e,t,r){if(!(t in e))return null;const n=Yn(e[t],Ir|xr,r);return function(e){return r=n(e),i=t,"number"==typeof r?r:fo(r,i);var r,i}}function ao(e,t){const r=e[t];if(void 0!==r){if("number"!=typeof r)throw new Error(`Expected a number for ${t}`);return r}}function so(e,t){const r=e[t];if(void 0!==r){if("bottom-left"!==r&&"bottom-right"!==r&&"top-left"!==r&&"top-right"!==r)throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return r}}function lo(e,t){const r=e[t];if(void 0!==r){if("pixels"!==r&&"fraction"!==r)throw new Error(`Expected pixels or fraction for ${t}`);return r}}function co(e,t){const r=e[t];if(void 0!==r){if("string"!=typeof r)throw new Error(`Expected a string for ${t}`);if("declutter"!==r&&"obstacle"!==r&&"none"!==r)throw new Error(`Expected declutter, obstacle, or none for ${t}`);return r}}function uo(e,t){if(!Array.isArray(e))throw new Error(`Expected an array for ${t}`);const r=e.length;for(let n=0;n<r;++n)if("number"!=typeof e[n])throw new Error(`Expected an array of numbers for ${t}`);return e}function ho(e,t){if("string"!=typeof e)throw new Error(`Expected a string for ${t}`);return e}function po(e,t){if("number"!=typeof e)throw new Error(`Expected a number for ${t}`);return e}function go(e,t){if("string"==typeof e)return e;const r=uo(e,t),n=r.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return r}function fo(e,t){const r=uo(e,t);if(2!==r.length)throw new Error(`Expected an array of two numbers for ${t}`);return r}const mo="renderOrder",yo=class extends Bt{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating,this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(mo)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const r=this.getDeclutter();r in e.declutter==0&&(e.declutter[r]=new Ht(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(mo,e)}setStyle(e){this.style_=void 0===e?qi:e;const t=function(e){if(void 0===e)return qi;if(!e)return null;if("function"==typeof e)return e;if(e instanceof ji)return e;if(!Array.isArray(e))return $i([e]);if(0===e.length)return[];const t=e.length,r=e[0];if(r instanceof ji){const r=new Array(t);for(let n=0;n<t;++n){const t=e[n];if(!(t instanceof ji))throw new Error("Expected a list of style instances");r[n]=t}return r}if("style"in r){const r=new Array(t);for(let n=0;n<t;++n){const t=e[n];if(!("style"in t))throw new Error("Expected a list of rules with a style property");r[n]=t}return function(e){const t=qr(),r=function(e,t){const r=e.length,n=new Array(r);for(let i=0;i<r;++i){const r=e[i],o="filter"in r?Yn(r.filter,Tr,t):Yi;let a;if(Array.isArray(r.style)){const e=r.style.length;a=new Array(e);for(let n=0;n<e;++n)a[n]=Ki(r.style[n],t)}else a=[Ki(r.style,t)];n[i]={filter:o,styles:a}}return function(t){const i=[];let o=!1;for(let a=0;a<r;++a)if((0,n[a].filter)(t)&&(!e[a].else||!o)){o=!0;for(const e of n[a].styles){const r=e(t);r&&i.push(r)}}return i}}(e,t),n={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""};return function(e,i){if(n.properties=e.getPropertiesInternal(),n.resolution=i,t.featureId){const t=e.getId();n.featureId=void 0!==t?t:null}return t.geometryType&&(n.geometryType=zn(e.getGeometry())),r(n)}}(r)}return $i(e)}(e);this.styleFunction_=null===e?void 0:function(e){let t;if("function"==typeof e)t=e;else{let r;Array.isArray(e)?r=e:((0,B.v)("function"==typeof e.getZIndex,"Expected an `Style` or an array of `Style`"),r=[e]),t=function(){return r}}return t}(t),this.changed()}setDeclutter(e){this.declutter_=e?String(e):void 0,this.changed()}};class vo extends s.Ay{constructor(e,t,r,n){super(e),this.inversePixelTransform=t,this.frameState=r,this.context=n}}const Ao=vo;var So=r(9703);class Eo extends ot.A{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){(0,n.b0)()}calculateMatrices2D(e){const t=e.viewState,r=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;(0,So.Zz)(r,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),(0,So.T9)(n,r)}forEachFeatureAtCoordinate(e,t,r,n,i,o,a,s){let l;const c=t.viewState;function u(e,t,r,n){return i.call(o,t,e?r:null,n)}const h=c.projection,d=(0,K.Li)(e.slice(),h),p=[[0,0]];if(h.canWrapX()&&n){const e=h.getExtent(),t=(0,ee.RG)(e);p.push([-t,0],[t,0])}const g=t.layerStatesArray,f=g.length,m=[],y=[];for(let n=0;n<p.length;n++)for(let i=f-1;i>=0;--i){const o=g[i],h=o.layer;if(h.hasRenderer()&&Gt(o,c)&&a.call(s,h)){const i=h.getRenderer(),a=h.getSource();if(i&&a){const s=a.getWrapX()?d:e,c=u.bind(null,o.managed);y[0]=s[0]+p[n][0],y[1]=s[1]+p[n][1],l=i.forEachFeatureAtCoordinate(y,t,r,c,m)}if(l)return l}}if(0===m.length)return;const v=1/m.length;return m.forEach(((e,t)=>e.distanceSq+=t*v)),m.sort(((e,t)=>e.distanceSq-t.distanceSq)),m.some((e=>l=e.callback(e.feature,e.layer,e.geometry))),l}hasFeatureAtCoordinate(e,t,r,n,i,o){return void 0!==this.forEachFeatureAtCoordinate(e,t,r,n,te.rT,this,i,o)}getMap(){return this.map_}renderFrame(e){(0,n.b0)()}scheduleExpireIconCache(e){ri.canExpireCache()&&e.postRenderFunctions.push(wo)}}function wo(e,t){ri.expire()}const _o=Eo,Lo=class extends _o{constructor(e){super(e),this.fontChangeListenerKey_=(0,v.KT)(yi,G.A.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=ye+" ol-layers";const r=e.getViewport();r.insertBefore(this.element_,r.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const r=this.getMap();if(r.hasListener(e)){const n=new Ao(e,void 0,t);r.dispatchEvent(n)}}disposeInternal(){(0,v.JH)(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(e),this.dispatchRenderEvent(Ft.PRECOMPOSE,e);const t=e.layerStatesArray.sort(((e,t)=>e.zIndex-t.zIndex));t.some((e=>e.layer instanceof yo&&e.layer.getDeclutter()))&&(e.declutter={});const r=e.viewState;this.children_.length=0;const n=[];let i=null;for(let o=0,a=t.length;o<a;++o){const a=t[o];e.layerIndex=o;const s=a.layer,l=s.getSourceState();if(!Gt(a,r)||"ready"!=l&&"undefined"!=l){s.unrender();continue}const c=s.render(e,i);c&&(c!==i&&(this.children_.push(c),i=c),n.push(a))}this.declutter(e,n),function(e,t){const r=e.childNodes;for(let n=0;;++n){const i=r[n],o=t[n];if(!i&&!o)break;i!==o&&(i?o?e.insertBefore(o,i):(e.removeChild(i),--n):e.appendChild(o))}}(this.element_,this.children_),this.dispatchRenderEvent(Ft.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let r=t.length-1;r>=0;--r){const n=t[r],i=n.layer;i.getDeclutter()&&i.renderDeclutter(e,n)}t.forEach((t=>t.layer.renderDeferred(e)))}}};function Co(e){e instanceof Bt?e.setMapInternal(null):e instanceof kt&&e.getLayers().forEach(Co)}function bo(e,t){if(e instanceof Bt)e.setMapInternal(t);else if(e instanceof kt){const r=e.getLayers().getArray();for(let e=0,n=r.length;e<n;++e)bo(r[e],t)}}class To extends a.A{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=function(e){let t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);const r={},n=e.layers&&"function"==typeof e.layers.getLayers?e.layers:new kt({layers:e.layers});let i,o,a;return r[D]=n,r[k]=e.target,r[F]=e.view instanceof ge?e.view:new ge,void 0!==e.controls&&(Array.isArray(e.controls)?i=new h(e.controls.slice()):((0,B.v)("function"==typeof e.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),i=e.controls)),void 0!==e.interactions&&(Array.isArray(e.interactions)?o=new h(e.interactions.slice()):((0,B.v)("function"==typeof e.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),o=e.interactions)),void 0!==e.overlays?Array.isArray(e.overlays)?a=new h(e.overlays.slice()):((0,B.v)("function"==typeof e.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),a=e.overlays):a=new h,{controls:i,interactions:o,keyboardEventTarget:t,overlays:a,values:r}}(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==e.maxTilesLoading?e.maxTilesLoading:16,this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:_,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=(0,So.vt)(),this.pixelToCoordinateTransform_=(0,So.vt)(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=t.controls||function(e){e=e||{};const t=new h;return(void 0===e.zoom||e.zoom)&&t.push(new Ne(e.zoomOptions)),(void 0===e.rotate||e.rotate)&&t.push(new De(e.rotateOptions)),(void 0===e.attribution||e.attribution)&&t.push(new Oe(e.attributionOptions)),t}(),this.interactions=t.interactions||St({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new H(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(D,this.handleLayerGroupChanged_),this.addChangeListener(F,this.handleViewChanged_),this.addChangeListener(N,this.handleSizeChanged_),this.addChangeListener(k,this.handleTargetChanged_),this.setProperties(t.values);const r=this;!e.view||e.view instanceof ge||e.view.then((function(e){r.setView(new ge(e))})),this.controls.addEventListener(i,(e=>{e.element.setMap(this)})),this.controls.addEventListener(o,(e=>{e.element.setMap(null)})),this.interactions.addEventListener(i,(e=>{e.element.setMap(this)})),this.interactions.addEventListener(o,(e=>{e.element.setMap(null)})),this.overlays_.addEventListener(i,(e=>{this.addOverlayInternal_(e.element)})),this.overlays_.addEventListener(o,(e=>{const t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()],e.element.setMap(null)})),this.controls.forEach((e=>{e.setMap(this)})),this.interactions.forEach((e=>{e.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){bo(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,r){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e),i=void 0!==(r=void 0!==r?r:{}).hitTolerance?r.hitTolerance:0,o=void 0!==r.layerFilter?r.layerFilter:te.rT,a=!1!==r.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,i,a,t,null,o,null)}getFeaturesAtPixel(e,t){const r=[];return this.forEachFeatureAtPixel(e,(function(e){r.push(e)}),t),r}getAllLayers(){const e=[];return function t(r){r.forEach((function(r){r instanceof kt?t(r.getLayers()):e.push(r)}))}(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const r=this.getCoordinateFromPixelInternal(e),n=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:te.rT,i=void 0!==t.hitTolerance?t.hitTolerance:0,o=!1!==t.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(r,this.frameState_,i,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const t=this.viewport_.getBoundingClientRect(),r=this.getSize(),n=t.width/r[0],i=t.height/r[1],o="changedTouches"in e?e.changedTouches[0]:e;return[(o.clientX-t.left)/n,(o.clientY-t.top)/i]}getTarget(){return this.get(k)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return(0,ne.te)(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?(0,So.Bb)(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(D)}setLayers(e){const t=this.getLayerGroup();if(e instanceof h)return void t.setLayers(e);const r=t.getLayers();r.clear(),r.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,r=e.length;t<r;++t){const r=e[t];if(!r.visible)continue;const n=r.layer.getRenderer();if(n&&!n.ready)return!0;const i=r.layer.getSource();if(i&&i.loading)return!0}return!1}getPixelFromCoordinate(e){const t=(0,ne.Ad)(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?(0,So.Bb)(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(N)}getView(){return this.get(F)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,r,n){return function(e,t,r,n,i){if(!e||!(r in e.wantedTiles))return q;if(!e.wantedTiles[r][t.getKey()])return q;const o=e.viewState.center,a=n[0]-o[0],s=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(this.frameState_,e,t,r,n)}handleBrowserEvent(e,t){t=t||e.type;const r=new g(t,this,e);this.handleMapBrowserEvent(r)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,r=t.type;if(r===P||r===f.A.WHEEL||r===f.A.KEYDOWN){const e=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():e,n=t.target,i=r instanceof ShadowRoot?r.host===n?r.host.ownerDocument:r:r===e?e.documentElement:r;if(this.overlayContainerStopEvent_.contains(n)||!i.contains(n))return}if(e.frameState=this.frameState_,!1!==this.dispatchEvent(e)){const t=this.getInteractions().getArray().slice();for(let r=t.length-1;r>=0;r--){const n=t[r];if(n.getMap()===this&&n.getActive()&&this.getTargetElement()&&(!n.handleEvent(e)||e.propagationStopped))break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,n=r;if(e){const t=e.viewHints;if(t[0]||t[1]){const t=Date.now()-e.time>8;r=t?0:8,n=t?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,n))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(Ft.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ft.RENDERCOMPLETE,e),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new p(O.LOADEND,this,e)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new p(O.LOADSTART,this,e))));const r=this.postRenderFunctions_;if(e)for(let t=0,n=r.length;t<n;++t)r[t](this,e);r.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,t=this.targetChangeHandlerKeys_.length;e<t;++e)(0,v.JH)(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(f.A.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(f.A.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const e=this.targetElement_.getRootNode();e instanceof ShadowRoot&&this.resizeObserver_.unobserve(e.host),this.setSize(void 0)}const e=this.getTarget(),t="string"==typeof e?document.getElementById(e):e;if(this.targetElement_=t,t){t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Lo(this)),this.mapBrowserEventHandler_=new R(this,this.moveTolerance_);for(const e in m)this.mapBrowserEventHandler_.addEventListener(m[e],this.handleMapBrowserEvent.bind(this));let e;if(this.viewport_.addEventListener(f.A.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(f.A.WHEEL,this.boundHandleBrowserEvent_,!!T&&{passive:!1}),this.keyboardEventTarget_)e=this.keyboardEventTarget_;else{const r=t.getRootNode();e=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[(0,v.KT)(e,f.A.KEYDOWN,this.handleBrowserEvent,this),(0,v.KT)(e,f.A.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&((0,v.JH)(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&((0,v.JH)(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=(0,v.KT)(e,G.A.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=(0,v.KT)(e,f.A.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(v.JH),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Ot("addlayer",e)),this.layerGroupPropertyListenerKeys_=[(0,v.KT)(e,G.A.PROPERTYCHANGE,this.render,this),(0,v.KT)(e,f.A.CHANGE,this.render,this),(0,v.KT)(e,"addlayer",this.handleLayerAdd_,this),(0,v.KT)(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,r=e.length;t<r;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){Co(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),r=this.getView(),i=this.frameState_;let o=null;if(void 0!==t&&Lr(t)&&r&&r.isDef()){const i=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=r.getState();if(o={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:(0,ee.Bg)(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:i,wantedTiles:{},mapId:(0,n.v6)(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const e=isNaN(a.nextRotation)?a.rotation:a.nextRotation;o.nextExtent=(0,ee.Bg)(a.nextCenter,a.nextResolution,e,t)}}this.frameState_=o,this.renderer_.renderFrame(o),o&&(o.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,o.postRenderFunctions),i&&(!this.previousExtent_||!(0,ee.Im)(this.previousExtent_)&&!(0,ee.aI)(o.extent,this.previousExtent_))&&(this.dispatchEvent(new p(O.MOVESTART,this,i)),this.previousExtent_=(0,ee.aZ)(this.previousExtent_)),this.previousExtent_&&!o.viewHints[0]&&!o.viewHints[1]&&!(0,ee.aI)(o.extent,this.previousExtent_)&&(this.dispatchEvent(new p(O.MOVEEND,this,o)),(0,ee.o8)(o.extent,this.previousExtent_))),this.dispatchEvent(new p(O.POSTRENDER,this,o)),this.renderComplete_=(this.hasListener(O.LOADSTART)||this.hasListener(O.LOADEND)||this.hasListener(Ft.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ot("removelayer",t)),this.set(D,e)}setSize(e){this.set(N,e)}setTarget(e){this.set(k,e)}setView(e){if(!e||e instanceof ge)return void this.set(F,e);this.set(F,new ge);const t=this;e.then((function(e){t.setView(new ge(e))}))}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),n=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),i=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);isNaN(n)||isNaN(i)||(t=[Math.max(0,n),Math.max(0,i)],!Lr(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&(0,fe.R8)("No map visible because the map container's width or height are 0."))}const r=this.getSize();!t||r&&(0,V.aI)(t,r)||(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}const xo=To,Po="element",Mo="map",Io="offset",Ro="position",Oo="positioning";class Do extends a.A{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=void 0===e.insertFirst||e.insertFirst,this.stopEvent=void 0===e.stopEvent||e.stopEvent,this.element=document.createElement("div"),this.element.className=void 0!==e.className?e.className:"ol-overlay-container ol-selectable",this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=!0===e.autoPan?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Po,this.handleElementChanged),this.addChangeListener(Mo,this.handleMapChanged),this.addChangeListener(Io,this.handleOffsetChanged),this.addChangeListener(Ro,this.handlePositionChanged),this.addChangeListener(Oo,this.handlePositioningChanged),void 0!==e.element&&this.setElement(e.element),this.setOffset(void 0!==e.offset?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),void 0!==e.position&&this.setPosition(e.position)}getElement(){return this.get(Po)}getId(){return this.id}getMap(){return this.get(Mo)||null}getOffset(){return this.get(Io)}getPosition(){return this.get(Ro)}getPositioning(){return this.get(Oo)}handleElementChanged(){Me(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),(0,v.JH)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=(0,v.KT)(e,O.POSTRENDER,this.render,this),this.updatePixelPosition();const t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Po,e)}setMap(e){this.set(Mo,e)}setOffset(e){this.set(Io,e)}setPosition(e){this.set(Ro,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Ro))return;const r=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),i=this.getRect(n,[Te(n),xe(n)]),o=void 0===(e=e||{}).margin?20:e.margin;if(!(0,ee.ms)(r,i)){const n=i[0]-r[0],a=r[2]-i[2],s=i[1]-r[1],l=r[3]-i[3],c=[0,0];if(n<0?c[0]=n-o:a<0&&(c[0]=Math.abs(a)+o),s<0?c[1]=s-o:l<0&&(c[1]=Math.abs(l)+o),0!==c[0]||0!==c[1]){const r=t.getView().getCenterInternal(),n=t.getPixelFromCoordinateInternal(r);if(!n)return;const i=[n[0]+c[0],n[1]+c[1]],o=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(i),duration:o.duration,easing:o.easing})}}}getRect(e,t){const r=e.getBoundingClientRect(),n=r.left+window.pageXOffset,i=r.top+window.pageYOffset;return[n,i,n+t[0],i+t[1]]}setPositioning(e){this.set(Oo,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t)return void this.setVisible(!1);const r=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(r,n)}updateRenderedPosition(e,t){const r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let o="0%",a="0%";"bottom-right"==i||"center-right"==i||"top-right"==i?o="-100%":"bottom-center"!=i&&"center-center"!=i&&"top-center"!=i||(o="-50%"),"bottom-left"==i||"bottom-center"==i||"bottom-right"==i?a="-100%":"center-left"!=i&&"center-center"!=i&&"center-right"!=i||(a="-50%");const s=`translate(${o}, ${a}) translate(${Math.round(e[0]+n[0])+"px"}, ${Math.round(e[1]+n[1])+"px"})`;this.rendered.transform_!=s&&(this.rendered.transform_=s,r.transform=s)}getOptions(){return this.options}}const No=Do;var ko=r(2806);const Fo="units",Go=[1,2,5],Bo=25.4/.28;var Uo=r(6717),qo=r(7430),Wo=r(4294),Ho=r(503),jo=r(1217),Vo=r(6702),zo=r(2871),Yo=r(2096),$o=r(2497),Ko=r(7622);class Xo extends Yo.Ay{constructor(e,t,r){super(),void 0!==r&&void 0===t?this.setFlatCoordinates(r,e):(t=t||0,this.setCenterAndRadius(e,t,r))}clone(){const e=new Xo(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,n){const i=this.flatCoordinates,o=e-i[0],a=t-i[1],s=o*o+a*a;if(s<n){if(0===s)for(let e=0;e<this.stride;++e)r[e]=i[e];else{const e=this.getRadius()/Math.sqrt(s);r[0]=i[0]+e*o,r[1]=i[1]+e*a;for(let e=2;e<this.stride;++e)r[e]=i[e]}return r.length=this.stride,s}return n}containsXY(e,t){const r=this.flatCoordinates,n=e-r[0],i=t-r[1];return n*n+i*i<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,r=t[this.stride]-t[0];return(0,ee.N)(t[0]-r,t[1]-r,t[0]+r,t[1]+r,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,ee.HY)(e,t)){const t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||e[1]<=t[1]&&e[3]>=t[1]||(0,ee.sB)(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,r=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+r;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,r){this.setLayout(r,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let i=(0,$o._n)(n,0,e,this.stride);n[i++]=n[0]+t;for(let e=1,t=this.stride;e<t;++e)n[i++]=n[e];n.length=i,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const r=this.getCenter(),n=this.getStride();this.setCenter((0,Ko.e$)(r,0,r.length,n,e,t,r)),this.changed()}}Xo.prototype.transform;const Zo=Xo;var Jo=r(4338),Qo=r(6361),ea=r(904);function ta(e,t){return function(r,n,i,o,a){!function(e,t,r,n,i,o,a){const s=new XMLHttpRequest;s.open("GET","function"==typeof e?e(r,n,i):e,!0),"arraybuffer"==t.getType()&&(s.responseType="arraybuffer"),s.withCredentials=false,s.onload=function(e){if(!s.status||s.status>=200&&s.status<300){const e=t.getType();try{let n;"text"==e||"json"==e?n=s.responseText:"xml"==e?n=s.responseXML||s.responseText:"arraybuffer"==e&&(n=s.response),n?o(t.readFeatures(n,{extent:r,featureProjection:i}),t.readProjection(n)):a()}catch{a()}}else a()},s.onerror=a,s.send()}(e,t,r,n,i,((e,t)=>{this.addFeatures(e),void 0!==o&&o(e)}),(()=>{this.changed(),void 0!==a&&a()}))}}var ra=r(2978),na=r(4165),ia=r(8662);const oa=ia.A;oa.prototype.writeFeatures,oa.prototype.writeFeaturesNode;const aa=oa;var sa=r(7825),la=r(8217);class ca extends la.Ay{constructor(){super()}getType(){return"text"}readFeature(e,t){return this.readFeatureFromText(ua(e),this.adaptOptions(t))}readFeatureFromText(e,t){return(0,n.b0)()}readFeatures(e,t){return this.readFeaturesFromText(ua(e),this.adaptOptions(t))}readFeaturesFromText(e,t){return(0,n.b0)()}readGeometry(e,t){return this.readGeometryFromText(ua(e),this.adaptOptions(t))}readGeometryFromText(e,t){return(0,n.b0)()}readProjection(e){return this.readProjectionFromText(ua(e))}readProjectionFromText(e){return this.dataProjection}writeFeature(e,t){return this.writeFeatureText(e,this.adaptOptions(t))}writeFeatureText(e,t){return(0,n.b0)()}writeFeatures(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))}writeFeaturesText(e,t){return(0,n.b0)()}writeGeometry(e,t){return this.writeGeometryText(e,this.adaptOptions(t))}writeGeometryText(e,t){return(0,n.b0)()}}function ua(e){return"string"==typeof e?e:""}const ha=ca,da={POINT:Wo.A,LINESTRING:jo.A,POLYGON:re.Ay,MULTIPOINT:Ho.A,MULTILINESTRING:Vo.A,MULTIPOLYGON:zo.A},pa="EMPTY",ga={Point:"POINT",LineString:"LINESTRING",Polygon:"POLYGON",MultiPoint:"MULTIPOINT",MultiLineString:"MULTILINESTRING",MultiPolygon:"MULTIPOLYGON",GeometryCollection:"GEOMETRYCOLLECTION",Circle:"CIRCLE"};class fa{constructor(e){this.wkt=e,this.index_=-1}isAlpha_(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}isNumeric_(e,t){return t=void 0!==t&&t,e>="0"&&e<="9"||"."==e&&!t}isWhiteSpace_(e){return" "==e||"\t"==e||"\r"==e||"\n"==e}nextChar_(){return this.wkt.charAt(++this.index_)}nextToken(){const e=this.nextChar_(),t=this.index_;let r,n=e;if("("==e)r=2;else if(","==e)r=5;else if(")"==e)r=3;else if(this.isNumeric_(e)||"-"==e)r=4,n=this.readNumber_();else if(this.isAlpha_(e))r=1,n=this.readText_();else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);r=6}return{position:t,value:n,type:r}}readNumber_(){let e;const t=this.index_;let r=!1,n=!1;do{"."==e?r=!0:"e"!=e&&"E"!=e||(n=!0),e=this.nextChar_()}while(this.isNumeric_(e,r)||!n&&("e"==e||"E"==e)||n&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))}readText_(){let e;const t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()}}class ma{constructor(e){this.lexer_=e,this.token_={position:0,type:0},this.layout_="XY"}consume_(){this.token_=this.lexer_.nextToken()}isTokenType(e){return this.token_.type==e}match(e){const t=this.isTokenType(e);return t&&this.consume_(),t}parse(){return this.consume_(),this.parseGeometry_()}parseGeometryLayout_(){let e="XY";const t=this.token_;if(this.isTokenType(1)){const r=t.value;"Z"===r?e="XYZ":"M"===r?e="XYM":"ZM"===r&&(e="XYZM"),"XY"!==e&&this.consume_()}return e}parseGeometryCollectionText_(){if(this.match(2)){const e=[];do{e.push(this.parseGeometry_())}while(this.match(5));if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePointText_(){if(this.match(2)){const e=this.parsePoint_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseLineStringText_(){if(this.match(2)){const e=this.parsePointList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePolygonText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPointText_(){if(this.match(2)){let e;if(e=2==this.token_.type?this.parsePointTextList_():this.parsePointList_(),this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiLineStringText_(){if(this.match(2)){const e=this.parseLineStringTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parseMultiPolygonText_(){if(this.match(2)){const e=this.parsePolygonTextList_();if(this.match(3))return e}throw new Error(this.formatErrorMessage_())}parsePoint_(){const e=[],t=this.layout_.length;for(let r=0;r<t;++r){const t=this.token_;if(!this.match(4))break;e.push(t.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())}parsePointList_(){const e=[this.parsePoint_()];for(;this.match(5);)e.push(this.parsePoint_());return e}parsePointTextList_(){const e=[this.parsePointText_()];for(;this.match(5);)e.push(this.parsePointText_());return e}parseLineStringTextList_(){const e=[this.parseLineStringText_()];for(;this.match(5);)e.push(this.parseLineStringText_());return e}parsePolygonTextList_(){const e=[this.parsePolygonText_()];for(;this.match(5);)e.push(this.parsePolygonText_());return e}isEmptyGeometry_(){const e=this.isTokenType(1)&&this.token_.value==pa;return e&&this.consume_(),e}formatErrorMessage_(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}parseGeometry_(){const e=this.token_;if(this.match(1)){const t=e.value;this.layout_=this.parseGeometryLayout_();const r=this.isEmptyGeometry_();if("GEOMETRYCOLLECTION"==t){if(r)return new Jo.A([]);const e=this.parseGeometryCollectionText_();return new Jo.A(e)}const n=da[t];if(!n)throw new Error("Invalid geometry type: "+t);let i;if(r)i="POINT"==t?[NaN,NaN]:[];else switch(t){case"POINT":i=this.parsePointText_();break;case"LINESTRING":i=this.parseLineStringText_();break;case"POLYGON":i=this.parsePolygonText_();break;case"MULTIPOINT":i=this.parseMultiPointText_();break;case"MULTILINESTRING":i=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":i=this.parseMultiPolygonText_()}return new n(i,this.layout_)}throw new Error(this.formatErrorMessage_())}}function ya(e){const t=e.getCoordinates();return 0===t.length?"":t.join(" ")}function va(e){const t=e.getCoordinates(),r=[];for(let e=0,n=t.length;e<n;++e)r.push(t[e].join(" "));return r.join(",")}function Aa(e){const t=[],r=e.getLinearRings();for(let e=0,n=r.length;e<n;++e)t.push("("+va(r[e])+")");return t.join(",")}const Sa={Point:ya,LineString:va,Polygon:Aa,MultiPoint:function(e){const t=[],r=e.getPoints();for(let e=0,n=r.length;e<n;++e)t.push("("+ya(r[e])+")");return t.join(",")},MultiLineString:function(e){const t=[],r=e.getLineStrings();for(let e=0,n=r.length;e<n;++e)t.push("("+va(r[e])+")");return t.join(",")},MultiPolygon:function(e){const t=[],r=e.getPolygons();for(let e=0,n=r.length;e<n;++e)t.push("("+Aa(r[e])+")");return t.join(",")},GeometryCollection:function(e){const t=[],r=e.getGeometries();for(let e=0,n=r.length;e<n;++e)t.push(Ea(r[e]));return t.join(",")}};function Ea(e){const t=e.getType(),r=(0,Sa[t])(e);let n=ga[t];if("function"==typeof e.getFlatCoordinates){const t=function(e){const t=e.getLayout();let r="";return"XYZ"!==t&&"XYZM"!==t||(r+="Z"),"XYM"!==t&&"XYZM"!==t||(r+="M"),r}(e);t.length>0&&(n+=" "+t)}return 0===r.length?n+" "+pa:n+"("+r+")"}const wa=class extends ha{constructor(e){super(),e=e||{},this.splitCollection_=void 0!==e.splitCollection&&e.splitCollection}parse_(e){const t=new fa(e);return new ma(t).parse()}readFeatureFromText(e,t){const r=this.readGeometryFromText(e,t),n=new Uo.A;return n.setGeometry(r),n}readFeaturesFromText(e,t){let r=[];const n=this.readGeometryFromText(e,t);r=this.splitCollection_&&"GeometryCollection"==n.getType()?n.getGeometriesArray():[n];const i=[];for(let e=0,t=r.length;e<t;++e){const t=new Uo.A;t.setGeometry(r[e]),i.push(t)}return i}readGeometryFromText(e,t){const r=this.parse_(e);return(0,la.hX)(r,!1,t)}writeFeatureText(e,t){const r=e.getGeometry();return r?this.writeGeometryText(r,t):""}writeFeaturesText(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);const r=[];for(let t=0,n=e.length;t<n;++t)r.push(e[t].getGeometry());const n=new Jo.A(r);return this.writeGeometryText(n,t)}writeGeometryText(e,t){return Ea((0,la.hX)(e,!0,t))}};class _a{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,void 0!==e?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,void 0!==e?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let r=0;r<e;r++)t.push(this.readLineString());return t}readWkbHeader(e){const t=this.readUint8()>0,r=this.readUint32(t),n=Math.floor((268435455&r)/1e3),i=Boolean(2147483648&r)||1===n||3===n,o=Boolean(1073741824&r)||2===n||3===n,a=Boolean(536870912&r),s=(268435455&r)%1e3,l=["XY",i?"Z":"",o?"M":""].join(""),c=a?this.readUint32(t):null;if(void 0!==e&&e!==s)throw new Error("Unexpected WKB geometry type "+s);if(this.initialized_){if(this.isLittleEndian_!==t)throw new Error("Inconsistent endian");if(this.layout_!==l)throw new Error("Inconsistent geometry layout");if(c&&this.srid_!==c)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=t,this.hasZ_=i,this.hasM_=o,this.layout_=l,this.srid_=c,this.initialized_=!0;return s}readWkbPayload(e){switch(e){case 1:return this.readPoint();case 2:return this.readLineString();case 3:case 17:return this.readPolygon();case 4:return this.readMultiPoint();case 5:return this.readMultiLineString();case 6:case 15:case 16:return this.readMultiPolygon();case 7:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const r=this.readUint32(),n=[];for(let i=0;i<r;i++){const r=e.call(this,t);r&&n.push(r)}return n}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,1)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,2)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,3)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case 1:return new Wo.A(t,this.layout_);case 2:return new jo.A(t,this.layout_);case 3:case 17:return new re.Ay(t,this.layout_);case 4:return new Ho.A(t,this.layout_);case 5:return new Vo.A(t,this.layout_);case 6:case 15:case 16:return new zo.A(t,this.layout_);case 7:return new Jo.A(t);default:return null}}getSrid(){return this.srid_}}class La{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=!1!==e.littleEndian,this.isEWKB_=!1!==e.ewkb,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const r=Object.assign.apply(null,t.split("").map(((t,r)=>({[t]:e[r]}))));for(const e of this.layout_)this.writeDouble(e in r?r[e]:this.nodata_[e])}writeLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writePoint(e[r],t)}writePolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeLineString(e[r],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(1),this.writePoint(e[r],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(2),this.writeLineString(e[r],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let r=0;r<e.length;r++)this.writeWkbHeader(3),this.writePolygon(e[r],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){if(e instanceof Yo.Ay)return(r=e.getLayout())===(n=t)?r:"XYZM"===r?n:"XYZM"===n?r:"XY";var r,n;if(e instanceof Jo.A){const r=e.getGeometriesArray();for(let e=0;e<r.length&&"XY"!==t;e++)t=this.findMinimumLayout(r[e],t)}return t}writeGeometry(e,t){const r={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6,GeometryCollection:7},n=e.getType(),i=r[n];if(!i)throw new Error("GeometryType "+n+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(i,t),e instanceof Yo.Ay?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[n].call(this,e.getCoordinates(),e.getLayout()):e instanceof Jo.A&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce(((e,t)=>e+t[0]),0),t=new ArrayBuffer(e),r=new DataView(t);let n=0;return this.writeQueue_.forEach((e=>{switch(e[0]){case 1:r.setUint8(n,e[1]);break;case 4:r.setUint32(n,e[1],this.isLittleEndian_);break;case 8:r.setFloat64(n,e[1],this.isLittleEndian_)}n+=e[0]})),t}}class Ca extends la.Ay{constructor(e){super(),e=e||{},this.splitCollection=Boolean(e.splitCollection),this.viewCache_=null,this.hex_=!1!==e.hex,this.littleEndian_=!1!==e.littleEndian,this.ewkb_=!1!==e.ewkb,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new Uo.A({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let r=[];const n=this.readGeometry(e,t);return r=this.splitCollection&&n instanceof Jo.A?n.getGeometriesArray():[n],r.map((e=>new Uo.A({geometry:e})))}readGeometry(e,t){const r=ba(e);if(!r)return null;const n=new _a(r).readGeometry();return this.viewCache_=r,t=this.getReadOptions(e,t),this.viewCache_=null,(0,la.hX)(n,!1,t)}readProjection(e){const t=this.viewCache_||ba(e);if(!t)return;const r=new _a(t);return r.readWkbHeader(),r.getSrid()&&(0,ne.Jt)("EPSG:"+r.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new Jo.A(e.map((e=>e.getGeometry()))),t)}writeGeometry(e,t){t=this.adaptOptions(t);const r=new La({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let n=Number.isInteger(this.srid_)?Number(this.srid_):null;if(!1!==this.srid_&&!Number.isInteger(this.srid_)){const e=t.dataProjection&&(0,ne.Jt)(t.dataProjection);if(e){const t=e.getCode();t.startsWith("EPSG:")&&(n=Number(t.substring(5)))}}r.writeGeometry((0,la.hX)(e,!0,t),n);const i=r.getBuffer();return this.hex_?function(e){const t=new Uint8Array(e);return Array.from(t.values()).map((e=>(e<16?"0":"")+Number(e).toString(16).toUpperCase())).join("")}(i):i}}function ba(e){return"string"==typeof e?function(e){const t=new Uint8Array(e.length/2);for(let r=0;r<e.length/2;r++)t[r]=parseInt(e.substr(2*r,2),16);return new DataView(t.buffer)}(e):ArrayBuffer.isView(e)?e instanceof DataView?e:new DataView(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new DataView(e):null}const Ta=Ca;var xa=r(3942);const Pa=class{read(e){if(!e)return null;if("string"==typeof e){const t=(0,xa.qg)(e);return this.readFromDocument(t)}return(0,xa.wz)(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){(0,n.b0)()}};function Ma(e){return e.getAttributeNS("http://www.w3.org/1999/xlink","href")}var Ia=r(7468);const Ra=[null,"http://www.opengis.net/wms"];function Oa(e){return(0,ko.Z)(e[0].version,"1.3")>=0}const Da=(0,xa.Dm)(Ra,{Service:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Oa(t)?Ua:Ba,e,t)})),Capability:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Oa(t)?Fa:ka,e,t)}))}),Na={Request:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Xa,e,t)})),Exception:(0,xa.kW)((function(e,t){return(0,xa.eY)([],ja,e,t)})),Layer:(0,xa.kW)((function(e,t){const r=(0,xa.eY)({},Oa(t)?Ya:za,e,t);return void 0===r.Layer?Object.assign(r,is(e,t)):r}))},ka=(0,xa.Dm)(Ra,{...Na,UserDefinedSymbolization:(0,xa.kW)((function(e,t){return{SupportSLD:!!(0,Ia.gC)(e.getAttribute("UserDefinedSymbolization")),UserLayer:!!(0,Ia.gC)(e.getAttribute("UserLayer")),UserStyle:!!(0,Ia.gC)(e.getAttribute("UserStyle")),RemoteWFS:!!(0,Ia.gC)(e.getAttribute("RemoteWFS"))}}))}),Fa=(0,xa.Dm)(Ra,Na),Ga={Name:(0,xa.kW)(Ia.E3),Title:(0,xa.kW)(Ia.E3),Abstract:(0,xa.kW)(Ia.E3),KeywordList:(0,xa.kW)(ls),OnlineResource:(0,xa.kW)(Ma),ContactInformation:(0,xa.kW)((function(e,t){return(0,xa.eY)({},qa,e,t)})),Fees:(0,xa.kW)(Ia.E3),AccessConstraints:(0,xa.kW)(Ia.E3)},Ba=(0,xa.Dm)(Ra,Ga),Ua=(0,xa.Dm)(Ra,{...Ga,LayerLimit:(0,xa.kW)(Ia.yg),MaxWidth:(0,xa.kW)(Ia.yg),MaxHeight:(0,xa.kW)(Ia.yg)}),qa=(0,xa.Dm)(Ra,{ContactPersonPrimary:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Wa,e,t)})),ContactPosition:(0,xa.kW)(Ia.E3),ContactAddress:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Ha,e,t)})),ContactVoiceTelephone:(0,xa.kW)(Ia.E3),ContactFacsimileTelephone:(0,xa.kW)(Ia.E3),ContactElectronicMailAddress:(0,xa.kW)(Ia.E3)}),Wa=(0,xa.Dm)(Ra,{ContactPerson:(0,xa.kW)(Ia.E3),ContactOrganization:(0,xa.kW)(Ia.E3)}),Ha=(0,xa.Dm)(Ra,{AddressType:(0,xa.kW)(Ia.E3),Address:(0,xa.kW)(Ia.E3),City:(0,xa.kW)(Ia.E3),StateOrProvince:(0,xa.kW)(Ia.E3),PostCode:(0,xa.kW)(Ia.E3),Country:(0,xa.kW)(Ia.E3)}),ja=(0,xa.Dm)(Ra,{Format:(0,xa.VT)(Ia.E3)}),Va={Name:(0,xa.kW)(Ia.E3),Title:(0,xa.kW)(Ia.E3),Abstract:(0,xa.kW)(Ia.E3),KeywordList:(0,xa.kW)(ls),BoundingBox:(0,xa.c4)(ns),Dimension:(0,xa.c4)((function(e,t){const r={name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol")};return Oa(t)&&Object.assign(r,{default:e.getAttribute("default"),multipleValues:(0,Ia.gC)(e.getAttribute("multipleValues")),nearestValue:(0,Ia.gC)(e.getAttribute("nearestValue")),current:(0,Ia.gC)(e.getAttribute("current")),values:(0,Ia.E3)(e)}),r})),Attribution:(0,xa.kW)((function(e,t){return(0,xa.eY)({},$a,e,t)})),AuthorityURL:(0,xa.c4)((function(e,t){const r=os(e,t);if(r)return r.name=e.getAttribute("name"),r})),Identifier:(0,xa.c4)(Ia.E3),MetadataURL:(0,xa.c4)((function(e,t){const r=os(e,t);if(r)return r.type=e.getAttribute("type"),r})),DataURL:(0,xa.c4)(os),FeatureListURL:(0,xa.c4)(os),Style:(0,xa.c4)((function(e,t){return(0,xa.eY)({},es,e,t)})),Layer:(0,xa.c4)(is)},za=(0,xa.Dm)(Ra,{...Va,SRS:(0,xa.c4)(Ia.E3),Extent:(0,xa.kW)((function(e,t){return{name:e.getAttribute("name"),default:e.getAttribute("default"),nearestValue:(0,Ia.gC)(e.getAttribute("nearestValue"))}})),ScaleHint:(0,xa.c4)((function(e,t){return{min:(0,Ia.P9)(e.getAttribute("min")),max:(0,Ia.P9)(e.getAttribute("max"))}})),LatLonBoundingBox:(0,xa.kW)(((e,t)=>ns(e,t,!1))),Layer:(0,xa.c4)(is)}),Ya=(0,xa.Dm)(Ra,{...Va,CRS:(0,xa.c4)(Ia.E3),EX_GeographicBoundingBox:(0,xa.kW)((function(e,t){const r=(0,xa.eY)({},Ka,e,t);if(!r)return;const n=r.westBoundLongitude,i=r.southBoundLatitude,o=r.eastBoundLongitude,a=r.northBoundLatitude;return void 0!==n&&void 0!==i&&void 0!==o&&void 0!==a?[n,i,o,a]:void 0})),MinScaleDenominator:(0,xa.kW)(Ia.e4),MaxScaleDenominator:(0,xa.kW)(Ia.e4),Layer:(0,xa.c4)(is)}),$a=(0,xa.Dm)(Ra,{Title:(0,xa.kW)(Ia.E3),OnlineResource:(0,xa.kW)(Ma),LogoURL:(0,xa.kW)(ss)}),Ka=(0,xa.Dm)(Ra,{westBoundLongitude:(0,xa.kW)(Ia.e4),eastBoundLongitude:(0,xa.kW)(Ia.e4),southBoundLatitude:(0,xa.kW)(Ia.e4),northBoundLatitude:(0,xa.kW)(Ia.e4)}),Xa=(0,xa.Dm)(Ra,{GetCapabilities:(0,xa.kW)(as),GetMap:(0,xa.kW)(as),GetFeatureInfo:(0,xa.kW)(as)}),Za=(0,xa.Dm)(Ra,{Format:(0,xa.c4)(Ia.E3),DCPType:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Ja,e,t)}))}),Ja=(0,xa.Dm)(Ra,{HTTP:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Qa,e,t)}))}),Qa=(0,xa.Dm)(Ra,{Get:(0,xa.kW)(os),Post:(0,xa.kW)(os)}),es=(0,xa.Dm)(Ra,{Name:(0,xa.kW)(Ia.E3),Title:(0,xa.kW)(Ia.E3),Abstract:(0,xa.kW)(Ia.E3),LegendURL:(0,xa.c4)(ss),StyleSheetURL:(0,xa.kW)(os),StyleURL:(0,xa.kW)(os)}),ts=(0,xa.Dm)(Ra,{Format:(0,xa.kW)(Ia.E3),OnlineResource:(0,xa.kW)(Ma)}),rs=(0,xa.Dm)(Ra,{Keyword:(0,xa.VT)(Ia.E3)});function ns(e,t,r=!0){const n={extent:[(0,Ia.P9)(e.getAttribute("minx")),(0,Ia.P9)(e.getAttribute("miny")),(0,Ia.P9)(e.getAttribute("maxx")),(0,Ia.P9)(e.getAttribute("maxy"))],res:[(0,Ia.P9)(e.getAttribute("resx")),(0,Ia.P9)(e.getAttribute("resy"))]};return r?(Oa(t)?n.crs=e.getAttribute("CRS"):n.srs=e.getAttribute("SRS"),n):n}function is(e,t){const r=Oa(t),n=t[t.length-1],i=(0,xa.eY)({},r?Ya:za,e,t);if(!i)return;let o=(0,Ia.gC)(e.getAttribute("queryable"));void 0===o&&(o=n.queryable),i.queryable=void 0!==o&&o;let a=(0,Ia._X)(e.getAttribute("cascaded"));void 0===a&&(a=n.cascaded),i.cascaded=a;let s=(0,Ia.gC)(e.getAttribute("opaque"));void 0===s&&(s=n.opaque),i.opaque=void 0!==s&&s;let l=(0,Ia.gC)(e.getAttribute("noSubsets"));void 0===l&&(l=n.noSubsets),i.noSubsets=void 0!==l&&l;let c=(0,Ia.P9)(e.getAttribute("fixedWidth"));c||(c=n.fixedWidth),i.fixedWidth=c;let u=(0,Ia.P9)(e.getAttribute("fixedHeight"));u||(u=n.fixedHeight),i.fixedHeight=u;const h=["Style","AuthorityURL"];r?h.push("CRS"):h.push("SRS","Dimension"),h.forEach((function(e){if(e in n){const t=i[e]||[];i[e]=t.concat(n[e])}}));const d=["BoundingBox","Attribution"];return r?d.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):d.push("LatLonBoundingBox","ScaleHint","Extent"),d.forEach((function(e){if(!(e in i)){const t=n[e];i[e]=t}})),i}function os(e,t){return(0,xa.eY)({},ts,e,t)}function as(e,t){return(0,xa.eY)({},Za,e,t)}function ss(e,t){const r=os(e,t);if(r){const t=[(0,Ia._X)(e.getAttribute("width")),(0,Ia._X)(e.getAttribute("height"))];return r.size=t,r}}function ls(e,t){return(0,xa.eY)([],rs,e,t)}var cs=r(581);class us extends na.A{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new cs.A,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const r=e.localName;let n=[];if(0===e.childNodes.length)return n;if("msGMLOutput"==r)for(let r=0,i=e.childNodes.length;r<i;r++){const i=e.childNodes[r];if(i.nodeType!==Node.ELEMENT_NODE)continue;const o=i,a=t[0],s="_layer",l=o.localName.replace(s,"");if(this.layers_&&!this.layers_.includes(l))continue;const c=l+"_feature";a.featureType=c,a.featureNS=this.featureNS_;const u={};u[c]=(0,xa.VT)(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const h=(0,xa.Dm)([a.featureNS,null],u);o.setAttribute("namespaceURI",this.featureNS_);const d=(0,xa.eY)([],h,o,t,this.gmlFormat_);d&&(0,V.X$)(n,d)}if("FeatureCollection"==r){const t=(0,xa.eY)([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);t&&(n=t)}return n}readFeaturesFromNode(e,t){const r={};return t&&Object.assign(r,this.getReadOptions(e,t)),this.readFeatures_(e,[r])}}const hs=us,ds=[null,"http://www.opengis.net/ows/1.1"],ps=(0,xa.Dm)(ds,{ServiceIdentification:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Cs,e,t)})),ServiceProvider:(0,xa.kW)((function(e,t){return(0,xa.eY)({},bs,e,t)})),OperationsMetadata:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Es,e,t)}))}),gs=(0,xa.Dm)(ds,{DeliveryPoint:(0,xa.kW)(Ia.E3),City:(0,xa.kW)(Ia.E3),AdministrativeArea:(0,xa.kW)(Ia.E3),PostalCode:(0,xa.kW)(Ia.E3),Country:(0,xa.kW)(Ia.E3),ElectronicMailAddress:(0,xa.kW)(Ia.E3)}),fs=(0,xa.Dm)(ds,{Value:(0,xa.c4)((function(e,t){return(0,Ia.E3)(e)}))}),ms=(0,xa.Dm)(ds,{AllowedValues:(0,xa.kW)((function(e,t){return(0,xa.eY)({},fs,e,t)}))}),ys=(0,xa.Dm)(ds,{Phone:(0,xa.kW)((function(e,t){return(0,xa.eY)({},ws,e,t)})),Address:(0,xa.kW)((function(e,t){return(0,xa.eY)({},gs,e,t)}))}),vs=(0,xa.Dm)(ds,{HTTP:(0,xa.kW)((function(e,t){return(0,xa.eY)({},As,e,t)}))}),As=(0,xa.Dm)(ds,{Get:(0,xa.c4)((function(e,t){const r=Ma(e);if(r)return(0,xa.eY)({href:r},_s,e,t)})),Post:void 0}),Ss=(0,xa.Dm)(ds,{DCP:(0,xa.kW)((function(e,t){return(0,xa.eY)({},vs,e,t)}))}),Es=(0,xa.Dm)(ds,{Operation:function(e,t){const r=e.getAttribute("name"),n=(0,xa.eY)({},Ss,e,t);n&&(t[t.length-1][r]=n)}}),ws=(0,xa.Dm)(ds,{Voice:(0,xa.kW)(Ia.E3),Facsimile:(0,xa.kW)(Ia.E3)}),_s=(0,xa.Dm)(ds,{Constraint:(0,xa.c4)((function(e,t){const r=e.getAttribute("name");if(r)return(0,xa.eY)({name:r},ms,e,t)}))}),Ls=(0,xa.Dm)(ds,{IndividualName:(0,xa.kW)(Ia.E3),PositionName:(0,xa.kW)(Ia.E3),ContactInfo:(0,xa.kW)((function(e,t){return(0,xa.eY)({},ys,e,t)}))}),Cs=(0,xa.Dm)(ds,{Abstract:(0,xa.kW)(Ia.E3),AccessConstraints:(0,xa.kW)(Ia.E3),Fees:(0,xa.kW)(Ia.E3),Title:(0,xa.kW)(Ia.E3),ServiceTypeVersion:(0,xa.kW)(Ia.E3),ServiceType:(0,xa.kW)(Ia.E3)}),bs=(0,xa.Dm)(ds,{ProviderName:(0,xa.kW)(Ia.E3),ProviderSite:(0,xa.kW)(Ma),ServiceContact:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Ls,e,t)}))}),Ts=class extends Pa{constructor(){super()}readFromNode(e){return(0,xa.eY)({},ps,e,[])||null}},xs=[null,"http://www.opengis.net/wmts/1.0"],Ps=[null,"http://www.opengis.net/ows/1.1"],Ms=(0,xa.Dm)(xs,{Contents:(0,xa.kW)((function(e,t){return(0,xa.eY)({},Is,e,t)}))}),Is=(0,xa.Dm)(xs,{Layer:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Rs,e,t)})),TileMatrixSet:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Bs,e,t)}))}),Rs=(0,xa.Dm)(xs,{Style:(0,xa.c4)((function(e,t){const r=(0,xa.eY)({},Os,e,t);if(!r)return;const n="true"===e.getAttribute("isDefault");return r.isDefault=n,r})),Format:(0,xa.c4)(Ia.E3),TileMatrixSetLink:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Ds,e,t)})),Dimension:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Fs,e,t)})),ResourceURL:(0,xa.c4)((function(e,t){const r=e.getAttribute("format"),n=e.getAttribute("template"),i=e.getAttribute("resourceType"),o={};return r&&(o.format=r),n&&(o.template=n),i&&(o.resourceType=i),o}))},(0,xa.Dm)(Ps,{Title:(0,xa.kW)(Ia.E3),Abstract:(0,xa.kW)(Ia.E3),WGS84BoundingBox:(0,xa.kW)(qs),BoundingBox:(0,xa.c4)((function(e,t){const r=e.getAttribute("crs"),n=(0,xa.eY)([],Gs,e,t);if(2==n.length)return{extent:(0,ee.Tr)(n),crs:r}})),Identifier:(0,xa.kW)(Ia.E3)})),Os=(0,xa.Dm)(xs,{LegendURL:(0,xa.c4)((function(e,t){const r={};return r.format=e.getAttribute("format"),r.href=Ma(e),r}))},(0,xa.Dm)(Ps,{Title:(0,xa.kW)(Ia.E3),Identifier:(0,xa.kW)(Ia.E3)})),Ds=(0,xa.Dm)(xs,{TileMatrixSet:(0,xa.kW)(Ia.E3),TileMatrixSetLimits:(0,xa.kW)((function(e,t){return(0,xa.eY)([],Ns,e,t)}))}),Ns=(0,xa.Dm)(xs,{TileMatrixLimits:(0,xa.VT)((function(e,t){return(0,xa.eY)({},ks,e,t)}))}),ks=(0,xa.Dm)(xs,{TileMatrix:(0,xa.kW)(Ia.E3),MinTileRow:(0,xa.kW)(Ia.yg),MaxTileRow:(0,xa.kW)(Ia.yg),MinTileCol:(0,xa.kW)(Ia.yg),MaxTileCol:(0,xa.kW)(Ia.yg)}),Fs=(0,xa.Dm)(xs,{Default:(0,xa.kW)(Ia.E3),Value:(0,xa.c4)(Ia.E3)},(0,xa.Dm)(Ps,{Identifier:(0,xa.kW)(Ia.E3)})),Gs=(0,xa.Dm)(Ps,{LowerCorner:(0,xa.VT)(Ws),UpperCorner:(0,xa.VT)(Ws)}),Bs=(0,xa.Dm)(xs,{WellKnownScaleSet:(0,xa.kW)(Ia.E3),TileMatrix:(0,xa.c4)((function(e,t){return(0,xa.eY)({},Us,e,t)}))},(0,xa.Dm)(Ps,{SupportedCRS:(0,xa.kW)(Ia.E3),Identifier:(0,xa.kW)(Ia.E3),BoundingBox:(0,xa.kW)(qs)})),Us=(0,xa.Dm)(xs,{TopLeftCorner:(0,xa.kW)(Ws),ScaleDenominator:(0,xa.kW)(Ia.e4),TileWidth:(0,xa.kW)(Ia.yg),TileHeight:(0,xa.kW)(Ia.yg),MatrixWidth:(0,xa.kW)(Ia.yg),MatrixHeight:(0,xa.kW)(Ia.yg)},(0,xa.Dm)(Ps,{Identifier:(0,xa.kW)(Ia.E3)}));function qs(e,t){const r=(0,xa.eY)([],Gs,e,t);if(2==r.length)return(0,ee.Tr)(r)}function Ws(e,t){const r=(0,Ia.E3)(e).split(/\s+/);if(!r||2!=r.length)return;const n=+r[0],i=+r[1];return isNaN(n)||isNaN(i)?void 0:[n,i]}var Hs=r(2283);class js extends Hs.A{constructor(e){super(),e=e||{},this.layerName_=e.layerName,this.layers_=e.layers?e.layers:null,this.dataProjection=(0,ne.Jt)(e.dataProjection?e.dataProjection:"EPSG:4326")}readFeaturesFromObject(e,t){if("Topology"==e.type){const r=e;let n,i=null,o=null;r.transform&&(n=r.transform,i=n.scale,o=n.translate);const a=r.arcs;n&&function(e,t,r){for(let n=0,i=e.length;n<i;++n)Ks(e[n],t,r)}(a,i,o);const s=[],l=r.objects,c=this.layerName_;let u;for(const e in l)this.layers_&&!this.layers_.includes(e)||("GeometryCollection"===l[e].type?(u=l[e],s.push.apply(s,Ys(u,a,i,o,c,e,t))):(u=l[e],s.push($s(u,a,i,o,c,e,t))));return s}return[]}readProjectionFromObject(e){return this.dataProjection}}const Vs={Point:function(e,t,r){const n=e.coordinates;return t&&r&&Xs(n,t,r),new Wo.A(n)},LineString:function(e,t){const r=zs(e.arcs,t);return new jo.A(r)},Polygon:function(e,t){const r=[];for(let n=0,i=e.arcs.length;n<i;++n)r[n]=zs(e.arcs[n],t);return new re.Ay(r)},MultiPoint:function(e,t,r){const n=e.coordinates;if(t&&r)for(let e=0,i=n.length;e<i;++e)Xs(n[e],t,r);return new Ho.A(n)},MultiLineString:function(e,t){const r=[];for(let n=0,i=e.arcs.length;n<i;++n)r[n]=zs(e.arcs[n],t);return new Vo.A(r)},MultiPolygon:function(e,t){const r=[];for(let n=0,i=e.arcs.length;n<i;++n){const i=e.arcs[n],o=[];for(let e=0,r=i.length;e<r;++e)o[e]=zs(i[e],t);r[n]=o}return new zo.A(r)}};function zs(e,t){const r=[];let n;for(let i=0,o=e.length;i<o;++i)if(n=e[i],i>0&&r.pop(),n>=0){const e=t[n];for(let t=0,n=e.length;t<n;++t)r.push(e[t].slice(0))}else{const e=t[~n];for(let t=e.length-1;t>=0;--t)r.push(e[t].slice(0))}return r}function Ys(e,t,r,n,i,o,a){const s=e.geometries,l=[];for(let e=0,c=s.length;e<c;++e)l[e]=$s(s[e],t,r,n,i,o,a);return l}function $s(e,t,r,n,i,o,a){let s=null;const l=e.type;if(l){const i=Vs[l];s="Point"===l||"MultiPoint"===l?i(e,r,n):i(e,t),s=(0,la.hX)(s,!1,a)}const c=new Uo.A({geometry:s});void 0!==e.id&&c.setId(e.id);let u=e.properties;return i&&(u||(u={}),u[i]=o),u&&c.setProperties(u,!0),c}function Ks(e,t,r){let n=0,i=0;for(let o=0,a=e.length;o<a;++o){const a=e[o];n+=a[0],i+=a[1],a[0]=n,a[1]=i,Xs(a,t,r)}}function Xs(e,t,r){e[0]=e[0]*t[0]+r[0],e[1]=e[1]*t[1]+r[1]}const Zs=js;var Js=r(6128),Qs=r(4778);const el=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>el(e)));const t={};for(const r in e){const n=e[r];n instanceof qo.A||(t[r]=el(n))}return t};class tl extends Js.A{readFeatureFromObject(e,t){let r=null;r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const n=r.geometry?.coordinates?.length?rl(r.geometry):null;if(this.featureClass===Qs.Ay)return(0,la.Bs)({geometry:n,id:r.id,properties:r.properties},t);const i=new Uo.A;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry((0,la.te)(n,t)),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},n=e.getId();if(void 0!==n&&(r.id=n),!e.hasProperties())return r;const i=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=nl(o,t),delete i[e.getGeometryName()]),(0,U.p)(i)||(r.properties=el(i)),r}}function rl(e,t){if(!e)return null;let r;switch(e.type){case"Point":r=function(e){const t=e.coordinates;return{type:"Point",flatCoordinates:t,layout:(0,Yo.p0)(t.length)}}(e);break;case"LineString":r=function(e){const t=e.coordinates,r=t.flat();return{type:"LineString",flatCoordinates:r,ends:[r.length],layout:(0,Yo.p0)(t[0].length)}}(e);break;case"Polygon":r=function(e){const t=e.coordinates,r=[],n=t[0][0].length;return{type:"Polygon",flatCoordinates:r,ends:(0,$o.KG)(r,0,t,n),layout:(0,Yo.p0)(n)}}(e);break;case"MultiPoint":r=function(e){const t=e.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:(0,Yo.p0)(t[0].length)}}(e);break;case"MultiLineString":r=function(e){const t=e.coordinates,r=t[0][0].length,n=[];return{type:"MultiLineString",flatCoordinates:n,ends:(0,$o.KG)(n,0,t,r),layout:(0,Yo.p0)(r)}}(e);break;case"MultiPolygon":r=function(e){const t=e.coordinates,r=[],n=t[0][0][0].length;return{type:"MultiPolygon",flatCoordinates:r,ends:(0,$o.d6)(r,0,t,n),layout:(0,Yo.p0)(n)}}(e);break;case"GeometryCollection":r=function(e){const t=e.geometries.map((function(e){return rl(e)}));return t}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return r}function nl(e,t){const r=(e=(0,la.hX)(e,!0,t)).getType();let n;switch(r){case"Point":n=function(e){return{type:"Point",coordinates:e.getCoordinates()}}(e);break;case"LineString":n=function(e){return{type:"LineString",coordinates:e.getCoordinates()}}(e);break;case"Polygon":n=function(e,t){let r;return t&&(r=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"MultiPoint":n=function(e){return{type:"MultiPoint",coordinates:e.getCoordinates()}}(e);break;case"MultiLineString":n=function(e){return{type:"MultiLineString",coordinates:e.getCoordinates()}}(e);break;case"MultiPolygon":n=function(e,t){let r;return t&&(r=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"GeometryCollection":n=function(e,t){delete(t=Object.assign({},t)).featureProjection;return{type:"GeometryCollection",geometries:e.getGeometriesArray().map((function(e){return nl(e,t)}))}}(e,t);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+r)}return n}const il=tl;var al=r(797),sl=r(5101),ll=r(7018),cl=r(8606),ul=r(6257);let hl=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];const dl=function(e){for(var t=[],r=[],n=Math.pow(2,e.length),i=0;i<n;i++){r=[];for(var o=0;o<e.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(e[o])&&r.push(e[o]);r.length>0&&-1==t.indexOf(r.join(" "))&&t.push(r.join(" "))}return t}(hl.slice().slice(1));!function(e,t){if(e&&e.length>0)for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);n>-1&&e.splice(n,1)}}(dl,hl),hl=hl.concat(dl);const pl=function(e){return 1e3*(0,Ia._I)(e)},gl={rte:Wl,trk:Hl,wpt:jl},fl=(0,xa.Dm)(hl,{rte:(0,xa.VT)(Wl),trk:(0,xa.VT)(Hl),wpt:(0,xa.VT)(jl)}),ml=(0,xa.Dm)(hl,{text:(0,xa.kW)(Ia.E3,"linkText"),type:(0,xa.kW)(Ia.E3,"linkType")}),yl=(0,xa.Dm)(hl,{rte:(0,xa.mm)((function(e,t,r){const n=r[0],i=t.getProperties(),o={node:e};o.properties=i;const a=t.getGeometry();if("LineString"==a.getType()){const e=(0,la.hX)(a,!0,n);o.geometryLayout=e.getLayout(),i.rtept=e.getCoordinates()}const s=r[r.length-1].node,l=Tl[s.namespaceURI],c=(0,xa.Gl)(i,l);(0,xa.NQ)(o,xl,xa.OL,c,r,l)})),trk:(0,xa.mm)((function(e,t,r){const n=r[0],i=t.getProperties(),o={node:e};o.properties=i;const a=t.getGeometry();if("MultiLineString"==a.getType()){const e=(0,la.hX)(a,!0,n);i.trkseg=e.getLineStrings()}const s=r[r.length-1].node,l=Ml[s.namespaceURI],c=(0,xa.Gl)(i,l);(0,xa.NQ)(o,Il,xa.OL,c,r,l)})),wpt:(0,xa.mm)((function(e,t,r){const n=r[0],i=r[r.length-1];i.properties=t.getProperties();const o=t.getGeometry();if("Point"==o.getType()){const t=(0,la.hX)(o,!0,n);i.geometryLayout=t.getLayout(),zl(e,t.getCoordinates(),r)}}))});class vl extends na.A{constructor(e){super(),e=e||{},this.dataProjection=(0,ne.Jt)("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,r=e.length;t<r;++t){const r=e[t];if(this.readExtensions_){const e=r.get("extensionsNode_")||null;this.readExtensions_(r,e)}r.set("extensionsNode_",void 0)}}readFeatureFromNode(e,t){if(!hl.includes(e.namespaceURI))return null;const r=gl[e.localName];if(!r)return null;const n=r(e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_([n]),n):null}readFeaturesFromNode(e,t){if(!hl.includes(e.namespaceURI))return[];if([...e.attributes].forEach((e=>{e.name.startsWith("xmlns:")&&(this.featureTypeMetadata??={origin:al.A.format.GPX,originalMetadata:{namespaces:[],featureTypes:{gpx:{}}}},this.featureTypeMetadata.originalMetadata.namespaces.push({prefix:e.name.substring(e.name.indexOf(":")+1),value:e.value}))})),"gpx"==e.localName){const r=(0,xa.eY)([],fl,e,[this.getReadOptions(e,t)]);return r?(this.featureTypeMetadata&&r.forEach((e=>this.featureMetadata.set(e,this.featureTypeMetadata))),this.handleReadExtensions_(r),r):[]}return[]}async readFeatures(e,t){let r,n=e;if(!e)return[];if("string"==typeof e){const i=(0,xa.qg)(e);r=this.readFeaturesFromDocument(i,t),n=i}else r=(0,xa.wz)(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t);if(this.featureTypeMetadata){const e=this.featureTypeMetadata.originalMetadata,t=new sl.default,r=e.featureTypes.gpx,i=await t.parseSchemas(n,"gpx");Object.assign(r,Object.values(i)[0])}return r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=(0,xa.qq)("http://www.topografix.com/GPX/1/1","gpx");return r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",xa.pF),r.setAttributeNS(xa.pF,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"),r.setAttribute("version","1.1"),r.setAttribute("creator","OpenLayers"),(0,xa.NQ)({node:r},yl,Fl,e,[t]),r}writeFeatures(e,t){const r=e.map((e=>{const t=e.getGeometry();if(t instanceof jo.A)(e=e.clone()).setGeometry(new Vo.A([t.getCoordinates()]));else if(t instanceof Wo.A&&!e.getKeys().includes("name")){let t=e.getStyle();"function"==typeof t&&(t=t(e)),Array.isArray(t)&&(t=t.find((e=>e.getText())));const r=t?.getText();r&&(e=e.clone()).set("name",r.getText())}return e})),n=this.writeFeaturesNode(r,t);return this.xmlSerializer_.serializeToString(n).replaceAll("<ele>NaN</ele>","")}getFeatureTypeMetadata(e,t){const r=super.getFeatureTypeMetadata(e,t),n=e=>t=>t.name===e;return function(e){let t;switch(!0){case e instanceof ll.A:t=r.attributes.find(n("wpt"));break;case e instanceof cl.A:t=r.attributes.find(n("rte"));break;case e instanceof ul.A:t=r.attributes.find(n("trk"))}return{origin:al.A.format.GPX,sealed:!0,attributes:t?.value??[],originalMetadata:r.originalMetadata}}}}const Al=(0,xa.Dm)(hl,{name:(0,xa.kW)(Ia.E3),cmt:(0,xa.kW)(Ia.E3),desc:(0,xa.kW)(Ia.E3),src:(0,xa.kW)(Ia.E3),link:Ul,number:(0,xa.kW)(Ia.yg),extensions:ql,type:(0,xa.kW)(Ia.E3),rtept:function(e,t){const r=(0,xa.eY)({},Sl,e,t);if(r){const n=t[t.length-1];Gl(n.flatCoordinates,n.layoutOptions,e,r)}}}),Sl=(0,xa.Dm)(hl,{ele:(0,xa.kW)(Ia.e4),time:(0,xa.kW)(pl)}),El=(0,xa.Dm)(hl,{name:(0,xa.kW)(Ia.E3),cmt:(0,xa.kW)(Ia.E3),desc:(0,xa.kW)(Ia.E3),src:(0,xa.kW)(Ia.E3),link:Ul,number:(0,xa.kW)(Ia.yg),type:(0,xa.kW)(Ia.E3),extensions:ql,trkseg:function(e,t){const r=t[t.length-1];(0,xa.UN)(wl,e,t);const n=r.flatCoordinates;r.ends.push(n.length)}}),wl=(0,xa.Dm)(hl,{trkpt:function(e,t){const r=(0,xa.eY)({},_l,e,t);if(r){const n=t[t.length-1];Gl(n.flatCoordinates,n.layoutOptions,e,r)}}}),_l=(0,xa.Dm)(hl,{ele:(0,xa.kW)(Ia.e4),time:(0,xa.kW)(pl)}),Ll=(0,xa.Dm)(hl,{ele:(0,xa.kW)(Ia.e4),time:(0,xa.kW)(pl),magvar:(0,xa.kW)(Ia.e4),geoidheight:(0,xa.kW)(Ia.e4),name:(0,xa.kW)(Ia.E3),cmt:(0,xa.kW)(Ia.E3),desc:(0,xa.kW)(Ia.E3),src:(0,xa.kW)(Ia.E3),link:Ul,sym:(0,xa.kW)(Ia.E3),type:(0,xa.kW)(Ia.E3),fix:(0,xa.kW)(Ia.E3),sat:(0,xa.kW)(Ia.yg),hdop:(0,xa.kW)(Ia.e4),vdop:(0,xa.kW)(Ia.e4),pdop:(0,xa.kW)(Ia.e4),ageofdgpsdata:(0,xa.kW)(Ia.e4),dgpsid:(0,xa.kW)(Ia.yg),extensions:ql}),Cl=["text","type"],bl=(0,xa.Dm)(hl,{text:(0,xa.mm)(Ia.uB),type:(0,xa.mm)(Ia.uB)}),Tl=(0,xa.Dm)(hl,["name","cmt","desc","src","link","number","type","rtept"]),xl=(0,xa.Dm)(hl,{name:(0,xa.mm)(Ia.uB),cmt:(0,xa.mm)(Ia.uB),desc:(0,xa.mm)(Ia.uB),src:(0,xa.mm)(Ia.uB),link:(0,xa.mm)(Vl),number:(0,xa.mm)(Ia.pE),type:(0,xa.mm)(Ia.uB),rtept:(0,xa.gN)((0,xa.mm)(zl))}),Pl=(0,xa.Dm)(hl,["ele","time"]),Ml=(0,xa.Dm)(hl,["name","cmt","desc","src","link","number","type","trkseg"]),Il=(0,xa.Dm)(hl,{name:(0,xa.mm)(Ia.uB),cmt:(0,xa.mm)(Ia.uB),desc:(0,xa.mm)(Ia.uB),src:(0,xa.mm)(Ia.uB),link:(0,xa.mm)(Vl),number:(0,xa.mm)(Ia.pE),type:(0,xa.mm)(Ia.uB),trkseg:(0,xa.gN)((0,xa.mm)((function(e,t,r){const n={node:e};n.geometryLayout=t.getLayout(),n.properties={},(0,xa.NQ)(n,Ol,Rl,t.getCoordinates(),r)})))}),Rl=(0,xa.X1)("trkpt"),Ol=(0,xa.Dm)(hl,{trkpt:(0,xa.mm)(zl)}),Dl=(0,xa.Dm)(hl,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Nl=(0,xa.Dm)(hl,{ele:(0,xa.mm)(Ia.Ko),time:(0,xa.mm)(Ia.cS),magvar:(0,xa.mm)(Ia.Ko),geoidheight:(0,xa.mm)(Ia.Ko),name:(0,xa.mm)(Ia.uB),cmt:(0,xa.mm)(Ia.uB),desc:(0,xa.mm)(Ia.uB),src:(0,xa.mm)(Ia.uB),link:(0,xa.mm)(Vl),sym:(0,xa.mm)(Ia.uB),type:(0,xa.mm)(Ia.uB),fix:(0,xa.mm)(Ia.uB),sat:(0,xa.mm)(Ia.pE),hdop:(0,xa.mm)(Ia.Ko),vdop:(0,xa.mm)(Ia.Ko),pdop:(0,xa.mm)(Ia.Ko),ageofdgpsdata:(0,xa.mm)(Ia.Ko),dgpsid:(0,xa.mm)(Ia.pE)}),kl={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function Fl(e,t,r){const n=e.getGeometry();if(n){const e=kl[n.getType()];if(e){const r=t[t.length-1].node;return(0,xa.qq)(r.namespaceURI,e)}}}function Gl(e,t,r,n){return e.push(parseFloat(r.getAttribute("lon")),parseFloat(r.getAttribute("lat"))),"ele"in n?(e.push(n.ele),delete n.ele,t.hasZ=!0):e.push(0),"time"in n?(e.push(n.time),delete n.time,t.hasM=!0):e.push(0),e}function Bl(e,t,r){let n="XY",i=2;if(e.hasZ&&e.hasM?(n="XYZM",i=4):e.hasZ?(n="XYZ",i=3):e.hasM&&(n="XYM",i=3),4!==i){for(let r=0,n=t.length/4;r<n;r++)t[r*i]=t[4*r],t[r*i+1]=t[4*r+1],e.hasZ&&(t[r*i+2]=t[4*r+2]),e.hasM&&(t[r*i+2]=t[4*r+3]);if(t.length=t.length/4*i,r)for(let e=0,t=r.length;e<t;e++)r[e]=r[e]/4*i}return n}function Ul(e,t){const r=t[t.length-1],n=e.getAttribute("href");null!==n&&(r.link=n),(0,xa.UN)(ml,e,t)}function ql(e,t){t[t.length-1].extensionsNode_=e}function Wl(e,t){const r=t[0],n=(0,xa.eY)({flatCoordinates:[],layoutOptions:{}},Al,e,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.layoutOptions;delete n.layoutOptions;const a=Bl(o,i),s=new jo.A(i,a);(0,la.hX)(s,!1,r);const l=new Uo.A(s);return l.setProperties(n,!0),l}function Hl(e,t){const r=t[0],n=(0,xa.eY)({flatCoordinates:[],ends:[],layoutOptions:{}},El,e,t);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const o=n.ends;delete n.ends;const a=n.layoutOptions;delete n.layoutOptions;const s=Bl(a,i,o),l=new Vo.A(i,s,o);(0,la.hX)(l,!1,r);const c=new Uo.A(l);return c.setProperties(n,!0),c}function jl(e,t){const r=t[0],n=(0,xa.eY)({},Ll,e,t);if(!n)return;const i={},o=Gl([],i,e,n),a=Bl(i,o),s=new Wo.A(o,a);(0,la.hX)(s,!1,r);const l=new Uo.A(s);return l.setProperties(n,!0),l}function Vl(e,t,r){e.setAttribute("href",t);const n=r[r.length-1].properties,i=[n.linkText,n.linkType];(0,xa.NQ)({node:e},bl,xa.OL,i,r,Cl)}function zl(e,t,r){const n=r[r.length-1],i=n.node.namespaceURI,o=n.properties;switch(e.setAttributeNS(null,"lat",String(t[1])),e.setAttributeNS(null,"lon",String(t[0])),n.geometryLayout){case"XYZM":0!==t[3]&&(o.time=t[3]);case"XYZ":0!==t[2]&&null!==t[2]&&(o.ele=t[2]);break;case"XYM":0!==t[2]&&(o.time=t[2])}const a="rtept"==e.nodeName?Pl[i]:Dl[i],s=(0,xa.Gl)(o,a);(0,xa.NQ)({node:e,properties:o},Nl,xa.OL,s,r,a)}const Yl=vl,$l=["http://www.google.com/kml/ext/2.2"];let Kl=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];const Xl=function(e){for(var t=[],r=[],n=Math.pow(2,e.length),i=0;i<n;i++){r=[];for(var o=0;o<e.length;o++)i&Math.pow(2,o)&&-1==r.indexOf(e[o])&&r.push(e[o]);r.length>0&&-1==t.indexOf(r.join(" "))&&t.push(r.join(" "))}return t}(Kl.slice().slice(1));!function(e,t){if(e&&e.length>0)for(var r=0;r<t.length;r++){var n=e.indexOf(t[r]);n>-1&&e.splice(n,1)}}(Xl,Kl),Kl=Kl.concat(Xl);const Zl={fraction:"fraction",pixels:"pixels",insetPixels:"pixels"},Jl=(0,xa.Dm)(Kl,{ExtendedData:gu,Region:fu,MultiGeometry:(0,xa.kW)(ou,"geometry"),LineString:(0,xa.kW)(ru,"geometry"),LinearRing:(0,xa.kW)(nu,"geometry"),Point:(0,xa.kW)(au,"geometry"),Polygon:(0,xa.kW)(lu,"geometry"),Style:(0,xa.kW)(uu),StyleMap:function(e,t){const r=qc.call(this,e,t);if(!r)return;const n=t[t.length-1];if(Array.isArray(r))n.Style=r;else{if("string"!=typeof r)throw new Error("`styleMapValue` has an unknown type");n.styleUrl=r}},Schema:(0,xa.kW)(Su),schemaUrl:(0,xa.kW)(Gc),address:(0,xa.kW)(Ia.E3),description:(0,xa.kW)(Ia.E3),name:(0,xa.kW)(Ia.E3),open:(0,xa.kW)(Ia.Vf),phoneNumber:(0,xa.kW)(Ia.E3),styleUrl:(0,xa.kW)(Gc),visibility:(0,xa.kW)(Ia.Vf)},(0,xa.Dm)($l,{MultiTrack:(0,xa.kW)((function(e,t){const r=(0,xa.eY)([],Kc,e,t);if(r)return new Vo.A(r)}),"geometry"),Track:(0,xa.kW)(Zc,"geometry")})),Ql=(0,xa.Dm)(Kl,{ExtendedData:gu,Region:fu,Link:function(e,t){(0,xa.UN)(ec,e,t)},address:(0,xa.kW)(Ia.E3),description:(0,xa.kW)(Ia.E3),name:(0,xa.kW)(Ia.E3),open:(0,xa.kW)(Ia.Vf),phoneNumber:(0,xa.kW)(Ia.E3),visibility:(0,xa.kW)(Ia.Vf)}),ec=(0,xa.Dm)(Kl,{href:(0,xa.kW)(Fc)}),tc=(0,xa.Dm)(Kl,{Altitude:(0,xa.kW)(Ia.e4),Longitude:(0,xa.kW)(Ia.e4),Latitude:(0,xa.kW)(Ia.e4),Tilt:(0,xa.kW)(Ia.e4),AltitudeMode:(0,xa.kW)(Ia.E3),Heading:(0,xa.kW)(Ia.e4),Roll:(0,xa.kW)(Ia.e4)}),rc=(0,xa.Dm)(Kl,{LatLonAltBox:function(e,t){const r=(0,xa.eY)({},wu,e,t);if(!r)return;const n=t[t.length-1],i=[parseFloat(r.west),parseFloat(r.south),parseFloat(r.east),parseFloat(r.north)];n.extent=i,n.altitudeMode=r.altitudeMode,n.minAltitude=parseFloat(r.minAltitude),n.maxAltitude=parseFloat(r.maxAltitude)},Lod:function(e,t){const r=(0,xa.eY)({},_u,e,t);if(!r)return;const n=t[t.length-1];n.minLodPixels=parseFloat(r.minLodPixels),n.maxLodPixels=parseFloat(r.maxLodPixels),n.minFadeExtent=parseFloat(r.minFadeExtent),n.maxFadeExtent=parseFloat(r.maxFadeExtent)}}),nc=(0,xa.Dm)(Kl,["Document","Schema","Placemark"]),ic=(0,xa.Dm)(Kl,{Document:(0,xa.mm)(Du),Placemark:(0,xa.mm)(ah)});let oc,ac,sc,lc,cc,uc,hc,dc,pc=null,gc=null,fc=null,mc=null,yc=null,vc=null;const Ac=function(e,t){var r;return e?(r=(r=wr(e)).slice(),void 0!==t&&(r[3]=t)):r=[0,0,0,1],r};function Sc(e){return 32/Math.min(e[0],e[1])}function Ec(){oc=[255,255,255,1],pc=new Oi({color:Ac(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity)}),ac=[20,2],sc="pixels",lc="pixels",cc=[64,64],uc="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png",gc=new ki({anchor:ac,anchorOrigin:"bottom-left",anchorXUnits:sc,anchorYUnits:lc,crossOrigin:"anonymous",rotation:0,scale:Sc(cc),size:cc,src:uc}),hc="NO_IMAGE",fc=new Gi({color:oc,width:1}),dc=new Gi({color:Ac(TC.Cfg.styles.label.strokeColor,1),width:TC.Cfg.styles.label.strokeWidth||1}),mc=new zi({font:"bold 16px Helvetica",fill:new Oi({color:Ac(TC.Cfg.styles.label.fillColor,1)}),stroke:dc,scale:.8}),yc=new ji({fill:pc,image:gc,text:mc,stroke:fc,zIndex:0}),vc=[yc]}const wc=new WeakMap,_c="_schemaUrl",Lc="data:image/svg+xml;base64,",Cc=function(e,t){var r=e.getStyle();return"function"==typeof r&&(r=r(e)),Array.isArray(r)&&(r=r.reduce((function(e,t){return e.fill_=t.fill_||e.fill_,e.image_=t.image_||e.image_,e.stroke_=t.stroke_||e.stroke_,e.text_=t.text_||e.text_,e}),new ji)),r||t||(r=new ji,e.setStyle(r)),r},bc=function(e,t){if(e.length===t.length){for(let r=0;r<e.length;r++)if(e[r].name!==t[r].name||e[r].type!==t[r].type)return!1;return!0}return!1},Tc=function(e){return t=e,r=new Map([["ä","a"],["ö","o"],["ü","u"],["Ä","A"],["Ö","O"],["Ü","U"],["á","a"],["é","e"],["í","i"],["ó","o"],["ú","u"],["Á","A"],["É","E"],["Í","I"],["Ó","O"],["Ú","U"],["ñ","n"],["Ñ","N"],["ç","c"],["Ç","C"]]),(e=(e=t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑçÇ]/g,(e=>r.get(e)))).replace(/^[^A-Za-z_]+/,"")).replace(/[^A-Za-z0-9_.-]/g,"_");var t,r},xc=function(e){const t={name:e.name};switch(e.type){case al.A.dataType.INTEGER:t.type="int";break;case al.A.dataType.SMALLINT:t.type="short";break;case al.A.dataType.FLOAT:t.type="float";break;case al.A.dataType.DOUBLE:t.type="double";break;case al.A.dataType.BOOLEAN:t.type="bool";break;default:t.type="string"}return t},Pc=async function(e){const t=new Map,r=new Map;for(let n of e){let e=await(n._wrap.parent.layer?.getFeatureTypeMetadata());if(e){"function"==typeof e&&(e=e(n._wrap.parent));const i=JSON.stringify(e.attributes.map(xc));let o;r.set(i,e.name),t.has(i)?o=t.get(i):(o=[],t.set(i,o)),o.push(n)}}for(let[e,n]of t.entries()){const t=n.find((e=>wc.has(e)));let i,o,a=JSON.parse(e);if(t)i=wc.get(t),o=i.substr(1);else{const t=n[0];o=Tc(r.get(e)??t._wrap.parent.layer?.title??t._wrap.parent.layer?.id),i="#"+o}let s=this.sharedSchemas_[o];if(s)for(;s&&!bc(a,s);){let e=2;const t=/\.(\d+)$/,r=o.replace(t,"");r!==o&&(e=parseInt(t.exec(o)[1],10)+1),o=r+"."+e,i="#"+o,s=this.sharedSchemas_[o]}this.sharedSchemas_[o]=a;for(let e of n)wc.set(e,i)}},Mc=function(e){const t=e.getGeometry();if(t instanceof Wo.A){let r=Cc(e,!0);const n=r.getImage();if(n instanceof Pi){const i=n.getRadius(),o=n.getStroke();let a=o.getColor();Array.isArray(a)&&(a=_r(a));const s=o.getWidth();let l=n.getFill().getColor();Array.isArray(l)&&(l=_r(l));const c=2*i+s,u=document.createElement("canvas");u.width=c,u.height=c;const h=r.getText();r=r.clone(),r.setText();const d=new Uo.A(t);return d._wrap=e._wrap,d.setId(e.getId()),d.setProperties(e.getProperties()),wc.set(d,wc.get(e)),d.setStyle(new ji({image:new ki({src:Lc+window.btoa(`<svg xmlns="http://www.w3.org/2000/svg" width="${c}" height="${c}">\n<circle cx="${c/2}" cy="${c/2}" r="${i}" stroke="${a}" fill="${l}" stroke-width="${s}" />\n</svg>`),size:[c,c],imgSize:[c,c],scale:n.getScale()}),text:h})),d}}return e};let Ic;function Rc(e){return e}class Oc extends na.A{constructor(e){super(),e=e||{},vc||Ec(),this.dataProjection=(0,ne.Jt)("EPSG:4326"),this.defaultStyle_=e.defaultStyle?e.defaultStyle:vc,this.extractStyles_=void 0===e.extractStyles||e.extractStyles,this.writeStyles_=void 0===e.writeStyles||e.writeStyles,this.sharedStyles_={},this.sharedSchemas_={},this.showPointNames_=void 0===e.showPointNames||e.showPointNames,this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",this.iconUrlFunction_=e.iconUrlFunction?e.iconUrlFunction:Rc,this.supportedMediaTypes=["application/vnd.google-earth.kml+xml"]}readDocumentOrFolder_(e,t){const r=(0,xa.Dm)(Kl,{Document:(0,xa.Vh)(this.readDocumentOrFolder_,this),Folder:(0,xa.Vh)(this.readDocumentOrFolder_,this),Placemark:(0,xa.VT)(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this),Schema:this.readSharedSchema_.bind(this)}),n=(0,xa.eY)([],r,e,t,this);if(n){const t=e.getElementsByTagName("name")[0];let r=t&&(t.innerHTML||t.textContent);return n.forEach((e=>{Array.isArray(e._folders)||(e._folders=[]),r&&e._folders.unshift(r)})),n.forEach((e=>{const t=wc.get(e);if(t){const r=this.sharedSchemas_[t.substring(t.indexOf("#")+1)],n=e.getProperties();for(let t in n){const i=r.find((e=>e.name===t));if(i){const r=n[t];switch(i.type){case"int":case"uint":case"short":case"ushort":case"float":case"double":n[t]=""===r||null===r?null:parseFloat(r);break;case"bool":n[t]="true"===r}e.setProperties(n)}}}})),n}}readPlacemark_(e,t){const r=(0,xa.eY)({geometry:null},Jl,e,t,this);if(!r)return;const n=new Uo.A,i=e.getAttribute("id");null!==i&&n.setId(i);const o=t[0],a=r.geometry;if(a&&(0,la.hX)(a,!1,o),n.setGeometry(a),delete r.geometry,this.extractStyles_){const e=(s=r.Style,l=r.styleUrl,c=this.defaultStyle_,u=this.sharedStyles_,h=this.showPointNames_,function(e,t){let r=h,n="",i=[];if(r){const t=e.getGeometry();if(t)if(t instanceof Jo.A)i=t.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t})),r=i.length>0;else{const e=t.getType();r="Point"===e||"MultiPoint"===e}}r&&(n=e.get("name"),r=r&&!!n,r&&/&[^&]+;/.test(n)&&(Ic||(Ic=document.createElement("textarea")),Ic.innerHTML=n,n=Ic.value));let o=c;if(s?o=s:l&&(o=Dc(l,c,u)),r){const e=function(e,t){mc||Ec();const r=[0,0];let n="start";const i=e.getImage();if(i){const e=i.getSize();if(e&&2==e.length){const t=i.getScaleArray(),o=i.getAnchor();r[0]=t[0]*(e[0]-o[0]),r[1]=t[1]*(e[1]/2-o[1]),n="left"}}let o=e.getText();o?(o=o.clone(),o.setFont(o.getFont()||mc.getFont()),o.setScale(o.getScale()||mc.getScale()),o.setFill(o.getFill()||mc.getFill()),o.setStroke(o.getStroke()||dc)):o=mc.clone(),o.setText(t),o.setOffsetX(r[0]),o.setOffsetY(r[1]),o.setTextAlign(n);const a=new ji({image:i,text:o});return e._balloon&&(a._balloon=e._balloon),a}(o[0],n);return i.length>0?(e.setGeometry(new Jo.A(i)),[e,new ji({geometry:o[0].getGeometry(),image:null,fill:o[0].getFill(),stroke:o[0].getStroke(),text:null})].concat(o.slice(1))):e}return o});n.setStyle(e)}var s,l,c,u,h;return delete r.Style,delete r.styleUrl,wc.set(n,r[_c]),delete r[_c],n.setProperties(r,!0),n}readSharedStyle_(e,t){const r=e.getAttribute("id");if(null!==r){const n=uu.call(this,e,t);if(n){let t,i=e.baseURI;i&&"about:blank"!=i||(i=window.location.href),t=i?new URL("#"+r,i).href:"#"+r,this.sharedStyles_[t]=n}}}readSharedStyleMap_(e,t){const r=e.getAttribute("id");if(null===r)return;const n=qc.call(this,e,t);if(!n)return;let i,o=e.baseURI;o&&"about:blank"!=o||(o=window.location.href),i=o?new URL("#"+r,o).href:"#"+r,this.sharedStyles_[i]=n}readSharedSchema_(e,t){const r=e.getAttribute("id");if(null!==r){const n=Su.call(this,e,t);n&&(this.sharedSchemas_[r]=n)}}async readFeatures(e,t){const r=await super.readFeatures(e,t);return this.sharedSchemas_={},r}readFeatureFromNode(e,t){if(!Kl.includes(e.namespaceURI))return null;return this.readPlacemark_(e,[this.getReadOptions(e,t)])||null}readFeaturesFromNode(e,t){if(!Kl.includes(e.namespaceURI))return[];let r;const n=e.localName;if("Document"==n||"Folder"==n){if(r=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]),r){if("Document"===n){let e;for(let t in this.sharedSchemas_){const r=this.sharedSchemas_[t];e??={origin:al.A.format.KML,originalMetadata:{schemas:[]}};const n={id:t,simpleFields:r.map((e=>({...e})))};e.originalMetadata.schemas.push(n)}r.forEach((t=>{this.featureMetadata.set(t,e)}))}return r}return[]}if("Placemark"==n){const r=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return r?[r]:[]}if("kml"==n){r=[];for(let n=e.firstElementChild;n;n=n.nextElementSibling){const e=this.readFeaturesFromNode(n,t);e&&(0,V.X$)(r,e)}return r.forEach((function(e){e.getId()||e.setId(TC.getUID())})),r}return[]}readName(e){if(e){if("string"==typeof e){const t=(0,xa.qg)(e);return this.readNameFromDocument(t)}return(0,xa.wz)(e)?this.readNameFromDocument(e):this.readNameFromNode(e)}}readNameFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){const e=this.readNameFromNode(t);if(e)return e}}readNameFromNode(e){for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(Kl.includes(t.namespaceURI)&&"name"==t.localName)return(0,Ia.E3)(t);for(let t=e.firstElementChild;t;t=t.nextElementSibling){const e=t.localName;if(Kl.includes(t.namespaceURI)&&("Document"==e||"Folder"==e||"Placemark"==e||"kml"==e)){const e=this.readNameFromNode(t);if(e)return e}}}readNetworkLinks(e){const t=[];if("string"==typeof e){const r=(0,xa.qg)(e);(0,V.X$)(t,this.readNetworkLinksFromDocument(r))}else(0,xa.wz)(e)?(0,V.X$)(t,this.readNetworkLinksFromDocument(e)):(0,V.X$)(t,this.readNetworkLinksFromNode(e));return t}readNetworkLinksFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&(0,V.X$)(t,this.readNetworkLinksFromNode(r));return t}readNetworkLinksFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(Kl.includes(r.namespaceURI)&&"NetworkLink"==r.localName){const e=(0,xa.eY)({},Ql,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!Kl.includes(r.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||(0,V.X$)(t,this.readNetworkLinksFromNode(r))}return t}readRegion(e){const t=[];if("string"==typeof e){const r=(0,xa.qg)(e);(0,V.X$)(t,this.readRegionFromDocument(r))}else(0,xa.wz)(e)?(0,V.X$)(t,this.readRegionFromDocument(e)):(0,V.X$)(t,this.readRegionFromNode(e));return t}readRegionFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&(0,V.X$)(t,this.readRegionFromNode(r));return t}readRegionFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(Kl.includes(r.namespaceURI)&&"Region"==r.localName){const e=(0,xa.eY)({},rc,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!Kl.includes(r.namespaceURI)||"Document"!=e&&"Folder"!=e&&"kml"!=e||(0,V.X$)(t,this.readRegionFromNode(r))}return t}readCamera(e){const t=[];if("string"==typeof e){const r=(0,xa.qg)(e);(0,V.X$)(t,this.readCameraFromDocument(r))}else(0,xa.wz)(e)?(0,V.X$)(t,this.readCameraFromDocument(e)):(0,V.X$)(t,this.readCameraFromNode(e));return t}readCameraFromDocument(e){const t=[];for(let r=e.firstChild;r;r=r.nextSibling)r.nodeType===Node.ELEMENT_NODE&&(0,V.X$)(t,this.readCameraFromNode(r));return t}readCameraFromNode(e){const t=[];for(let r=e.firstElementChild;r;r=r.nextElementSibling)if(Kl.includes(r.namespaceURI)&&"Camera"===r.localName){const e=(0,xa.eY)({},tc,r,[]);t.push(e)}for(let r=e.firstElementChild;r;r=r.nextElementSibling){const e=r.localName;!Kl.includes(r.namespaceURI)||"Document"!==e&&"Folder"!==e&&"Placemark"!==e&&"kml"!==e||(0,V.X$)(t,this.readCameraFromNode(r))}return t}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=(0,xa.qq)(Kl[4],"kml"),n="http://www.w3.org/2000/xmlns/";r.setAttributeNS(n,"xmlns:gx",$l[0]),r.setAttributeNS(n,"xmlns:xsi",xa.pF),r.setAttributeNS(xa.pF,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");const i={node:r},o={};e=function(e){const t=[];return e.forEach((function(e){const r=Cc(e,!0),n=e.getGeometry(),i=r.getText();var o;if(i&&i.getText()){switch(!0){case n instanceof jo.A:o=new Wo.A(n.getCoordinateAt(.5));break;case n instanceof re.Ay:o=n.getInteriorPoint();break;case n instanceof Vo.A:{const e=n.getLineStrings();var a=-1;o=new Wo.A(e[e.map((function(e){return e.getLength()})).reduce((function(e,t,r){return t>a?(a=t,r):e}),-1)].getCoordinateAt(.5));break}case n instanceof zo.A:{const e=n.getPolygons();var s=-1;o=e[e.map((function(e){return e.getArea()})).reduce((function(e,t,r){return t>s?(s=t,r):e}),-1)].getInteriorPoint();break}}if(o){const e=new Uo.A(o);e.setStyle(new ji({text:i.clone(),image:new ki({crossOrigin:"anonymous",src:TC.apiLocation+"css/img/transparent.gif"})})),t.push(e)}}})),t.length&&(e=e.concat(t)),e}(e=e.map(Mc));const a=[];let s=[];const l=function(e,t,r){if(r>=t._folders.length)e.push(t);else{let n=e.find((e=>e._name===t._folders[r]));n||(n=[],n._name=t._folders[r],e.push(n)),l(n,t,r+1)}};e.forEach((function(e){e._folders?.length?l(s,e,0):a.push(e)})),1===s.length&&(s=s[0]);const c=s._name;Array.isArray(s)||(s=[s]),s=s.concat(a),s._name=c,o.Document=s;const u=nc[r.namespaceURI],h=(0,xa.Gl)(o,u);return(0,xa.NQ)(i,ic,xa.OL,h,[t],u,this),r}async writeFeatures(e,t={}){await Pc.call(this,e);const r=await super.writeFeatures(e,t);return this.sharedSchemas_={},r}getFeatureTypeMetadata(e,t){const r=function(t){const r={...e},n=t.wrap?.feature||t,i=wc.get(n);if(i){const t=e.originalMetadata.schemas,o=t.find((e=>"#"+e.id===i))??t[0];o&&(r.attributes=o.simpleFields.map((e=>{const t={name:e.name,originalType:e.type,optional:!0};switch(e.type){case"int":case"uint":t.type=al.A.dataType.INTEGER;break;case"short":case"ushort":t.type=al.A.dataType.SMALLINT;break;case"float":t.type=al.A.dataType.FLOAT;break;case"double":t.type=al.A.dataType.DOUBLE;break;case"bool":t.type=al.A.dataType.BOOLEAN;break;default:t.type=al.A.dataType.STRING}return t})),n.unset(_c))}return r};if(t.length){const e=t[0],n=wc.get(e);if(t.every((e=>wc.get(e)===n)))return r(e)}return r}groupFeatures(e,t){const r=e.reduce(((e,r)=>{var n=r._folders?.length?r._folders.join(" › "):null;return n||(n=t(r)),e[n]??=[],e[n].push(r),e}),{}),n={};for(let e in r){const t=r[e],i=t.reduce(((e,t)=>{const r=wc.get(t);if(r){const n=r.substring(r.indexOf("#")+1);e[n]??=[],e[n].push(t)}return e}),{});if(Object.keys(i).length>1)for(let t in i){let o;o=r.length>1?e+" › "+t:t,n[o]=i[t]}else n[e]=t}return n}}function Dc(e,t,r){return Array.isArray(e)?e:"string"==typeof e?Dc(r[e],t,r):t}function Nc(e){const t=(0,xa.mT)(e,!1),r=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(r){const e=r[1];return[parseInt(e.substr(6,2),16),parseInt(e.substr(4,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(0,2),16)/255]}}function kc(e){let t=(0,xa.mT)(e,!1);const r=[];t=t.replace(/\s*,\s*/g,",");const n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?),([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|,|$)(?:([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s+|$))?\s*/i;let i;for(;i=n.exec(t);){const e=parseFloat(i[1]),n=parseFloat(i[2]),o=i[3]?parseFloat(i[3]):0;r.push(e,n,o),t=t.substr(i[0].length)}if(""===t)return r}function Fc(e){const t=(0,xa.mT)(e,!1).trim();let r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?("https:"===location.protocol&&0===r.indexOf("http://")&&(r=r.substr(5)),new URL(t,r).href):t}function Gc(e){const t=(0,xa.mT)(e,!1).trim().replace(/^(?!.*#)/,"#");let r=e.baseURI;return r&&"about:blank"!=r||(r=window.location.href),r?new URL(t,r).href:t}function Bc(e){return(0,Ia.e4)(e)}const Uc=(0,xa.Dm)(Kl,{Pair:function(e,t){const r=(0,xa.eY)({},mu,e,t,this);if(!r)return;const n=r.key;if(n&&"normal"==n){const e=r.styleUrl;e&&(t[t.length-1]=e);const n=r.Style;n&&(t[t.length-1]=n)}}});function qc(e,t){return(0,xa.eY)(void 0,Uc,e,t,this)}const Wc=(0,xa.Dm)(Kl,{Icon:(0,xa.kW)((function(e,t){const r=(0,xa.eY)({},Jc,e,t);return r||null})),color:(0,xa.kW)(Nc),heading:(0,xa.kW)(Ia.e4),hotSpot:(0,xa.kW)((function(e){const t=e.getAttribute("xunits"),r=e.getAttribute("yunits");let n;return n="insetPixels"!==t?"insetPixels"!==r?"bottom-left":"top-left":"insetPixels"!==r?"bottom-right":"top-right",{x:parseFloat(e.getAttribute("x")),xunits:Zl[t],y:parseFloat(e.getAttribute("y")),yunits:Zl[r],origin:n}})),scale:(0,xa.kW)(Bc)}),Hc=(0,xa.Dm)(Kl,{text:(0,xa.kW)((function(e,t){return ol.asserts.assert(e.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("text"==e.localName),(0,Ia.E3)(e).trim()}))}),jc=(0,xa.Dm)(Kl,{color:(0,xa.kW)(Nc),scale:(0,xa.kW)(Bc)}),Vc=(0,xa.Dm)(Kl,{color:(0,xa.kW)(Nc),width:(0,xa.kW)(Ia.e4)}),zc=(0,xa.Dm)(Kl,{color:(0,xa.kW)(Nc),fill:(0,xa.kW)(Ia.Vf),outline:(0,xa.kW)(Ia.Vf)}),Yc=(0,xa.Dm)(Kl,{coordinates:(0,xa.Tb)(kc)});function $c(e,t){return(0,xa.eY)(null,Yc,e,t)}const Kc=(0,xa.Dm)($l,{Track:(0,xa.VT)(Zc)}),Xc=(0,xa.Dm)(Kl,{when:function(e,t){const r=t[t.length-1].whens,n=(0,xa.mT)(e,!1),i=Date.parse(n);r.push(isNaN(i)?0:i)}},(0,xa.Dm)($l,{coord:function(e,t){const r=t[t.length-1].coordinates,n=(0,xa.mT)(e,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(n);if(i){const e=parseFloat(i[1]),t=parseFloat(i[2]),n=parseFloat(i[3]);r.push([e,t,n])}else r.push([])}}));function Zc(e,t){const r=(0,xa.eY)({coordinates:[],whens:[]},Xc,e,t);if(!r)return;const n=[],i=r.coordinates,o=r.whens;for(let e=0,t=Math.min(i.length,o.length);e<t;++e)3==i[e].length&&n.push(i[e][0],i[e][1],i[e][2],o[e]);return new jo.A(n,"XYZM")}const Jc=(0,xa.Dm)(Kl,{href:(0,xa.kW)(Fc)},(0,xa.Dm)($l,{x:(0,xa.kW)(Ia.e4),y:(0,xa.kW)(Ia.e4),w:(0,xa.kW)(Ia.e4),h:(0,xa.kW)(Ia.e4)})),Qc=(0,xa.Dm)(Kl,{coordinates:(0,xa.Tb)(kc)});function eu(e,t){return(0,xa.eY)(null,Qc,e,t)}const tu=(0,xa.Dm)(Kl,{extrude:(0,xa.kW)(Ia.Vf),tessellate:(0,xa.kW)(Ia.Vf),altitudeMode:(0,xa.kW)(Ia.E3)});function ru(e,t){const r=(0,xa.eY)({},tu,e,t),n=eu(e,t);if(n){const e=new jo.A(n,"XYZ");return e.setProperties(r,!0),e}}function nu(e,t){const r=(0,xa.eY)({},tu,e,t),n=eu(e,t);if(n){const e=new re.Ay(n,"XYZ",[n.length]);return e.setProperties(r,!0),e}}const iu=(0,xa.Dm)(Kl,{LineString:(0,xa.VT)(ru),LinearRing:(0,xa.VT)(nu),MultiGeometry:(0,xa.VT)(ou),Point:(0,xa.VT)(au),Polygon:(0,xa.VT)(lu)});function ou(e,t){const r=(0,xa.eY)([],iu,e,t);if(!r)return null;if(0===r.length)return new Jo.A(r);let n,i=!0;const o=r[0].getType();let a;for(let e=1,t=r.length;e<t;++e)if(a=r[e],a.getType()!=o){i=!1;break}if(i){let e,t;if("Point"==o){const i=r[0];e=i.getLayout(),t=i.getFlatCoordinates();for(let e=1,n=r.length;e<n;++e)a=r[e],(0,V.X$)(t,a.getFlatCoordinates());n=new Ho.A(t,e),hu(n,r)}else if("LineString"==o)n=new Vo.A(r),hu(n,r);else if("Polygon"==o)n=new zo.A(r),hu(n,r);else{if("GeometryCollection"!=o&&!o.startsWith("Multi"))throw new Error("Unknown geometry type found");n=new Jo.A(r)}}else n=new Jo.A(r);return n}function au(e,t){const r=(0,xa.eY)({},tu,e,t),n=eu(e,t);if(n){const e=new Wo.A(n,"XYZ");return e.setProperties(r,!0),e}}const su=(0,xa.Dm)(Kl,{innerBoundaryIs:function(e,t){const r=(0,xa.eY)([],Lu,e,t);r.length>0&&t[t.length-1].push(...r)},outerBoundaryIs:function(e,t){const r=(0,xa.eY)(void 0,Cu,e,t);r&&(t[t.length-1][0]=r)}});function lu(e,t){const r=(0,xa.eY)({},tu,e,t),n=(0,xa.eY)([null],su,e,t);if(n&&n[0]){const e=n[0],t=[e.length];for(let r=1,i=n.length;r<i;++r)(0,V.X$)(e,n[r]),t.push(e.length);const i=new re.Ay(e,"XYZ",t);return i.setProperties(r,!0),i}}const cu=(0,xa.Dm)(Kl,{IconStyle:function(e,t){const r=(0,xa.eY)({},Wc,e,t);if(!r)return;const n=t[t.length-1],i="Icon"in r?r.Icon:{},o=!("Icon"in r)||Object.keys(i).length>0;let a;const s=i.href;let l,c,u;s?a=s:o&&(a=uc);let h="bottom-left";const d=r.hotSpot;let p;d?(l=[d.x,d.y],c=d.xunits,u=d.yunits,h=d.origin):/^https?:\/\/maps\.(?:google|gstatic)\.com\//.test(a)&&(a.includes("pushpin")?(l=ac,c=sc,u=lc):a.includes("arrow-reverse")?(l=[54,42],c=sc,u=lc):a.includes("paddle")&&(l=[32,1],c=sc,u=lc)),o&&/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&a.startsWith("http:")&&(a=a.replace("http:","https:"));const g=i.x,f=i.y;let m;void 0!==g&&void 0!==f&&(p=[g,f]);const y=i.w,v=i.h;let A;void 0!==y&&void 0!==v&&(m=[y,v]);const S=r.heading;void 0!==S&&(A=(0,z.eh)(S));const E=r.scale,w=r.color;if(o){a==uc&&(m=cc);let e=new ki({anchor:l,anchorOrigin:h,anchorXUnits:c,anchorYUnits:u,crossOrigin:this.crossOrigin_,offset:p,offsetOrigin:"bottom-left",rotation:A,scale:E,size:m,src:this.iconUrlFunction_(a),color:w});const t=e.getScaleArray()[0],r=e.getSize();if(null===r){const r=e.getImageState();if(0===r||1===r){const n=function(){const r=e.getImageState();if(0!==r&&1!==r){const r=e.getSize();if(r&&2==r.length){const n=Sc(r);e.setScale(t*n)}e.unlistenImageChange(n)}};e.listenImageChange(n),0===r&&e.load()}}else if(2==r.length){const n=Sc(r);e.setScale(t*n)}const i=/<circle cx="(?:\d+(?:\.\d+)?)" cy="(?:\d+(?:\.\d+)?)" r="(\d+(?:\.\d+)?)" stroke="([\w\d\.#(),]+)" fill="([\w\d\.#(),]+)" stroke-width="(\d+(?:\.\d+)?)" \/>/,o=e.getSrc();if(o.startsWith(Lc)){const t=window.atob(o.substring(26)).match(i);t&&(e=new Ii({radius:parseFloat(t[1]),stroke:new Gi({color:t[2],width:parseFloat(t[4])}),fill:new Oi({color:t[3]})}))}n.imageStyle=e}else n.imageStyle=hc},LabelStyle:function(e,t){const r=(0,xa.eY)({},jc,e,t);if(!r)return;const n=t[t.length-1],i=new zi({fill:new Oi({color:"color"in r?r.color:oc}),scale:r.scale});n.textStyle=i},LineStyle:function(e,t){const r=(0,xa.eY)({},Vc,e,t);if(!r)return;const n=t[t.length-1],i=new Gi({color:"color"in r?r.color:oc,width:"width"in r?r.width:1});n.strokeStyle=i},PolyStyle:function(e,t){const r=(0,xa.eY)({},zc,e,t);if(!r)return;const n=t[t.length-1],i=new Oi({color:"color"in r?r.color:oc});n.fillStyle=i;const o=r.fill;void 0!==o&&(n.fill=o);const a=r.outline;void 0!==a&&(n.outline=a)},BalloonStyle:function(e,t){ol.asserts.assert(e.nodeType==Node.ELEMENT_NODE),ol.asserts.assert("BalloonStyle"==e.localName);var r=ol.xml.pushParseAndPop({},Hc,e,t);if(!r)return;const n=t[t.length-1],i=typeof n;ol.asserts.assert("object"==i&&null!=n||"function"==i);var o=new zi({text:r.text});n.balloonStyle=o}});function uu(e,t){const r=(0,xa.eY)({},cu,e,t,this);if(!r)return null;let n="fillStyle"in r?r.fillStyle:pc;const i=r.fill;let o;void 0===i||i||(n=null),"imageStyle"in r?r.imageStyle!=hc&&(o=r.imageStyle):o=gc;const a="textStyle"in r?r.textStyle:mc,s="strokeStyle"in r?r.strokeStyle:fc;let l;const c=r.outline;l=void 0===c||c?[new ji({fill:n,image:o,stroke:s,text:a,zIndex:void 0})]:[new ji({geometry:function(e){const t=e.getGeometry(),r=t.getType();if("GeometryCollection"===r){const e=t;return new Jo.A(e.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"!==t&&"MultiPolygon"!==t})))}if("Polygon"!==r&&"MultiPolygon"!==r)return t},fill:n,image:o,stroke:s,text:a,zIndex:void 0}),new ji({geometry:function(e){const t=e.getGeometry(),r=t.getType();if("GeometryCollection"===r){const e=t;return new Jo.A(e.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t})))}if("Polygon"===r||"MultiPolygon"===r)return t},fill:n,stroke:null,zIndex:void 0})];const u=r.balloonStyle;return u&&l.forEach((e=>e._balloon=u)),l}function hu(e,t){const r=t.length,n=new Array(t.length),i=new Array(t.length),o=new Array(t.length);let a,s,l;a=!1,s=!1,l=!1;for(let e=0;e<r;++e){const r=t[e];n[e]=r.get("extrude"),i[e]=r.get("tessellate"),o[e]=r.get("altitudeMode"),a=a||void 0!==n[e],s=s||void 0!==i[e],l=l||o[e]}a&&e.set("extrude",n),s&&e.set("tessellate",i),l&&e.set("altitudeMode",o)}const du=(0,xa.Dm)(Kl,{displayName:(0,xa.kW)(Ia.E3),value:(0,xa.kW)(Ia.E3)}),pu=(0,xa.Dm)(Kl,{Data:function(e,t){const r=e.getAttribute("name");(0,xa.UN)(du,e,t);const n=t[t.length-1];r&&n.displayName?(n[r]={value:n.value,displayName:n.displayName,toString:function(){return n.value}},delete n.displayName):null!==r?n[r]=n.value:null!==n.displayName&&(n[n.displayName]=n.value),delete n.value},SchemaData:function(e,t){const r=e.getAttribute("schemaUrl");null!==r&&(t[t.length-1][_c]=r),(0,xa.UN)(yu,e,t)}});function gu(e,t){(0,xa.UN)(pu,e,t)}function fu(e,t){(0,xa.UN)(rc,e,t)}const mu=(0,xa.Dm)(Kl,{Style:(0,xa.kW)(uu),key:(0,xa.kW)(Ia.E3),styleUrl:(0,xa.kW)(Gc)}),yu=(0,xa.Dm)(Kl,{SimpleData:function(e,t){const r=e.getAttribute("name");if(null!==r){const n=(0,Ia.E3)(e);t[t.length-1][r]=n}}}),vu=(0,xa.Dm)(Kl,{SimpleField:(0,xa.Vh)((function(e,t){const r=(0,xa.eY)({},Au,e,t,this),n=e.getAttribute("name"),i=e.getAttribute("type");if(null!==n&&null!==i)return r.name=n,r.type=i,r}))}),Au=(0,xa.Dm)(Kl,{displayName:(0,xa.kW)(Ia.E3)});function Su(e,t){return(0,xa.eY)([],vu,e,t,this)||null}const Eu=(0,xa.Dm)(Kl,{SimpleField:(0,xa.mm)((function(e,t,r){const n={node:e};e.setAttribute("name",t.name),e.setAttribute("type",t.type),t.displayName&&(0,xa.NQ)(n,Eu,xa.OL,[t.displayName],r,["displayName"])})),displayName:(0,xa.mm)(xu)}),wu=(0,xa.Dm)(Kl,{altitudeMode:(0,xa.kW)(Ia.E3),minAltitude:(0,xa.kW)(Ia.e4),maxAltitude:(0,xa.kW)(Ia.e4),north:(0,xa.kW)(Ia.e4),south:(0,xa.kW)(Ia.e4),east:(0,xa.kW)(Ia.e4),west:(0,xa.kW)(Ia.e4)}),_u=(0,xa.Dm)(Kl,{minLodPixels:(0,xa.kW)(Ia.e4),maxLodPixels:(0,xa.kW)(Ia.e4),minFadeExtent:(0,xa.kW)(Ia.e4),maxFadeExtent:(0,xa.kW)(Ia.e4)}),Lu=(0,xa.Dm)(Kl,{LinearRing:(0,xa.VT)($c)}),Cu=(0,xa.Dm)(Kl,{LinearRing:(0,xa.Tb)($c)});function bu(e,t){const r=wr(t),n=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]];for(let e=0;e<4;++e){const t=Math.floor(n[e]).toString(16);n[e]=1==t.length?"0"+t:t}(0,Ia.uB)(e,n.join(""))}const Tu=(0,xa.Dm)(Kl,{Data:(0,xa.mm)((function(e,t,r){e.setAttribute("name",t.name);const n={node:e},i=t.value;"object"==typeof i?(null!==i&&i.displayName&&(0,xa.NQ)(n,Tu,xa.OL,[i.displayName],r,["displayName"]),null!==i&&i.value&&(0,xa.NQ)(n,Tu,xa.OL,[i.value],r,["value"])):(0,xa.NQ)(n,Tu,xa.OL,[i],r,["value"])})),value:(0,xa.mm)((function(e,t){(0,Ia.uB)(e,t)})),displayName:(0,xa.mm)(xu),SchemaData:(0,xa.mm)((function(e,t,r){e.setAttribute("schemaUrl",t.schemaUrl);const n={node:e},i=t.schemaData.names,o=t.schemaData.values,a=i.length;for(let e=0;e<a;e++)(0,xa.NQ)(n,Tu,Fu,[{name:i[e],value:o[e]}],r)})),SimpleData:(0,xa.mm)((function(e,t,r){e.setAttribute("name",t.name),t.value??="",(0,Ia.uB)(e,t.value)}))});function xu(e,t){(0,Ia.Gc)(e,t)}const Pu=(0,xa.Dm)(Kl,["name","Schema"]);var Mu=(0,xa.Dm)(Kl,{Placemark:(0,xa.mm)(ah),Document:(0,xa.mm)(Du),Folder:(0,xa.mm)(Du),name:(0,xa.mm)(Ia.uB),Schema:(0,xa.mm)((function(e,t,r){const n={node:e};for(let e of t.simpleFields)(0,xa.NQ)(n,Eu,Ou,[{...e}],r)}))});const Iu=function(e,t,r){const n=t[t.length-1].node;return Array.isArray(e)?(0,xa.qq)(n.namespaceURI,"Folder"):"string"==typeof e?(0,xa.qq)(n.namespaceURI,"name"):(0,xa.qq)(n.namespaceURI,"Placemark")},Ru=function(e,t,r){const n=t[t.length-1].node,i=(0,xa.qq)(n.namespaceURI,"Schema");return i.setAttribute("id",e.id),i.setAttribute("name",e.id),i},Ou=function(e,t,r){const n=t[t.length-1].node,i=(0,xa.qq)(n.namespaceURI,"SimpleField");return i.setAttribute("type",e.type),i.setAttribute("name",e.id),i};function Du(e,t,r){const n={node:e};if(t._name){const e={name:t._name},i=r[r.length-1].node,o=Pu[i.namespaceURI],a=(0,xa.Gl)(e,o);(0,xa.NQ)(n,Mu,Iu,a,r,o)}if("Document"===e.localName)for(let e in this.sharedSchemas_)(0,xa.NQ)(n,Mu,Ru,[{id:e.substring(e.indexOf("#")+1),simpleFields:this.sharedSchemas_[e]}],r,void 0,this);(0,xa.NQ)(n,Mu,Iu,t,r,void 0,this)}const Nu=(0,xa.X1)("Data"),ku=(0,xa.X1)("SchemaData"),Fu=(0,xa.X1)("SimpleData"),Gu=(0,xa.Dm)(Kl,["href"],(0,xa.Dm)($l,["x","y","w","h"])),Bu=(0,xa.Dm)(Kl,{href:(0,xa.mm)(Ia.uB)},(0,xa.Dm)($l,{x:(0,xa.mm)(Ia.Ko),y:(0,xa.mm)(Ia.Ko),w:(0,xa.mm)(Ia.Ko),h:(0,xa.mm)(Ia.Ko)})),Uu=function(e,t,r){return(0,xa.qq)($l[0],"gx:"+r)},qu=(0,xa.Dm)(Kl,["scale","heading","Icon","color","hotSpot"]),Wu=(0,xa.Dm)(Kl,{Icon:(0,xa.mm)((function(e,t,r){const n={node:e},i=r[r.length-1].node;let o=Gu[i.namespaceURI],a=(0,xa.Gl)(t,o);(0,xa.NQ)(n,Bu,xa.OL,a,r,o),o=Gu[$l[0]],a=(0,xa.Gl)(t,o),(0,xa.NQ)(n,Bu,Uu,a,r,o)})),color:(0,xa.mm)(bu),heading:(0,xa.mm)(Ia.Ko),hotSpot:(0,xa.mm)((function(e,t){e.setAttribute("x",String(t.x)),e.setAttribute("y",String(t.y)),e.setAttribute("xunits",t.xunits),e.setAttribute("yunits",t.yunits)})),scale:(0,xa.mm)(mh)}),Hu=(0,xa.Dm)(Kl,["color","scale"]),ju=(0,xa.Dm)(Kl,{color:(0,xa.mm)(bu),scale:(0,xa.mm)(mh)}),Vu=(0,xa.Dm)(Kl,["color","width"]),zu=(0,xa.Dm)(Kl,{color:(0,xa.mm)(bu),width:(0,xa.mm)(Ia.Ko)}),Yu={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},$u=function(e,t,r){if(e){const r=t[t.length-1].node;return(0,xa.qq)(r.namespaceURI,Yu[e.getType()])}},Ku=(0,xa.X1)("Point"),Xu=(0,xa.X1)("LineString"),Zu=(0,xa.X1)("LinearRing"),Ju=(0,xa.X1)("Polygon"),Qu=(0,xa.Dm)(Kl,{LineString:(0,xa.mm)(ch),Point:(0,xa.mm)(ch),Polygon:(0,xa.mm)(gh),GeometryCollection:(0,xa.mm)(eh)});function eh(e,t,r){const n={node:e},i=t.getType();let o,a=[];if("GeometryCollection"===i)t.getGeometriesArrayRecursive().forEach((function(e){const t=e.getType();if("MultiPoint"===t)a=a.concat(e.getPoints());else if("MultiLineString"===t)a=a.concat(e.getLineStrings());else if("MultiPolygon"===t)a=a.concat(e.getPolygons());else{if("Point"!==t&&"LineString"!==t&&"Polygon"!==t)throw new Error("Unknown geometry type");a.push(e)}})),o=$u;else if("MultiPoint"===i)a=t.getPoints(),o=Ku;else if("MultiLineString"===i)a=t.getLineStrings(),o=Xu;else{if("MultiPolygon"!==i)throw new Error("Unknown geometry type");a=t.getPolygons(),o=Ju}(0,xa.NQ)(n,Qu,o,a,r)}const th=(0,xa.Dm)(Kl,{LinearRing:(0,xa.mm)(ch)});function rh(e,t,r){const n={node:e};(0,xa.NQ)(n,th,Zu,[t],r)}const nh=(0,xa.Dm)(Kl,{ExtendedData:(0,xa.mm)((function(e,t,r){const n={node:e},i=t.names,o=t.values,a=i.length;if(t.schemaUrl)(0,xa.NQ)(n,Tu,ku,[{schemaUrl:t.schemaUrl,schemaData:{names:i,values:o}}],r);else for(let e=0;e<a;e++)(0,xa.NQ)(n,Tu,Nu,[{name:i[e],value:o[e]}],r)})),MultiGeometry:(0,xa.mm)(eh),LineString:(0,xa.mm)(ch),LinearRing:(0,xa.mm)(ch),Point:(0,xa.mm)(ch),Polygon:(0,xa.mm)(gh),Style:(0,xa.mm)((function(e,t,r){const n={node:e},i={};if(t.pointStyles.length){const e=t.pointStyles[0].getText();e&&(i.LabelStyle=e);const r=t.pointStyles[0].getImage();r&&"function"==typeof r.getSrc&&(i.IconStyle=r);const n=t.pointStyles[0]._balloon;n&&(i.BalloonStyle=n)}if(t.lineStyles.length){const e=t.lineStyles[0].getStroke();e&&(i.LineStyle=e)}if(t.polyStyles.length){const e=t.polyStyles[0].getStroke();e&&!i.LineStyle&&(i.LineStyle=e),i.PolyStyle=t.polyStyles[0]}const o=r[r.length-1].node,a=yh[o.namespaceURI],s=(0,xa.Gl)(i,a);(0,xa.NQ)(n,vh,xa.OL,s,r,a)})),address:(0,xa.mm)(Ia.uB),description:(0,xa.mm)(Ia.uB),name:(0,xa.mm)(Ia.uB),open:(0,xa.mm)(Ia.Z3),phoneNumber:(0,xa.mm)(Ia.uB),styleUrl:(0,xa.mm)(Ia.uB),visibility:(0,xa.mm)(Ia.Z3)}),ih=(0,xa.Dm)(Kl,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),oh=(0,xa.X1)("ExtendedData");function ah(e,t,r){const n={node:e};t.getId()&&e.setAttribute("id",t.getId());const i=t.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[t.getGeometryName()]=1;const a=Object.keys(i||{}).filter((function(e){return!o[e]})),s=t.getStyleFunction();if(s){const e=s(t,0);if(e){const r=Array.isArray(e)?e:[e];let n=r;if(t.getGeometry()&&(n=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Point"===t||"MultiPoint"===t})).length:"Point"===e||"MultiPoint"===e}}))),this.writeStyles_){let e=r,o=r;t.getGeometry()&&(e=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"LineString"===t||"MultiLineString"===t})).length:"LineString"===e||"MultiLineString"===e}})),o=r.filter((function(e){const r=e.getGeometryFunction()(t);if(r){const e=r.getType();return"GeometryCollection"===e?r.getGeometriesArrayRecursive().filter((function(e){const t=e.getType();return"Polygon"===t||"MultiPolygon"===t})).length:"Polygon"===e||"MultiPolygon"===e}}))),i.Style={pointStyles:n,lineStyles:e,polyStyles:o}}if(n.length&&void 0===i.name){const e=n[0].getText();e&&(i.name=e.getText())}}}const l=r[r.length-1].node,c=ih[l.namespaceURI],u=(0,xa.Gl)(i,c);if((0,xa.NQ)(n,nh,xa.OL,u,r,c),a.length>0){const e={names:a,values:(0,xa.Gl)(i,a),schemaUrl:wc.get(t)};(0,xa.NQ)(n,nh,oh,[e],r)}const h=r[0];let d=t.getGeometry();d&&(d=(0,la.hX)(d,!0,h)),(0,xa.NQ)(n,nh,$u,[d],r)}const sh=(0,xa.Dm)(Kl,["extrude","tessellate","altitudeMode","coordinates"]),lh=(0,xa.Dm)(Kl,{extrude:(0,xa.mm)(Ia.Z3),tessellate:(0,xa.mm)(Ia.Z3),altitudeMode:(0,xa.mm)(Ia.uB),coordinates:(0,xa.mm)((function(e,t,r){const n=r[r.length-1],i=n.layout,o=n.stride;let a;if("XY"==i||"XYM"==i)a=2;else{if("XYZ"!=i&&"XYZM"!=i)throw new Error("Invalid geometry layout");a=3}const s=t.length;let l="";if(s>0){l+=t[0];for(let e=1;e<a;++e)l+=","+t[e];for(let e=o;e<s;e+=o){l+=" "+t[e];for(let r=1;r<a;++r)l+=","+t[e+r]}}(0,Ia.uB)(e,l)}))});function ch(e,t,r){const n=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout(),i.stride=t.getStride();const o=t.getProperties();o.coordinates=n;const a=r[r.length-1].node,s=sh[a.namespaceURI],l=(0,xa.Gl)(o,s);(0,xa.NQ)(i,lh,xa.OL,l,r,s)}const uh=(0,xa.Dm)(Kl,["color","fill","outline"]),hh=(0,xa.Dm)(Kl,{outerBoundaryIs:(0,xa.mm)(rh),innerBoundaryIs:(0,xa.mm)(rh)}),dh=(0,xa.X1)("innerBoundaryIs"),ph=(0,xa.X1)("outerBoundaryIs");function gh(e,t,r){const n=t.getLinearRings(),i=n.shift(),o={node:e};(0,xa.NQ)(o,hh,dh,n,r),(0,xa.NQ)(o,hh,ph,[i],r)}const fh=(0,xa.Dm)(Kl,{color:(0,xa.mm)(bu),fill:(0,xa.mm)(Ia.Z3),outline:(0,xa.mm)(Ia.Z3)});function mh(e,t){(0,Ia.Ko)(e,Math.round(1e6*t)/1e6)}const yh=(0,xa.Dm)(Kl,["IconStyle","LabelStyle","LineStyle","PolyStyle","BalloonStyle"]),vh=(0,xa.Dm)(Kl,{IconStyle:(0,xa.mm)((function(e,t,r){const n={node:e},i={},o=t.getSrc(),a=t.getSize(),s=t.getImageSize(),l={href:o};if(a){l.w=a[0],l.h=a[1];const e=t.getAnchor(),r=t.getOrigin();if(r&&s&&0!==r[0]&&r[1]!==a[1]&&(l.x=r[0],l.y=s[1]-(r[1]+a[1])),e&&(e[0]!==a[0]/2||e[1]!==a[1]/2)){const t={x:e[0],xunits:"pixels",y:a[1]-e[1],yunits:"pixels"};i.hotSpot=t}}i.Icon=l;let c=t.getScaleArray()[0],u=a;null===u&&(cc||Ec(),u=cc),2==u.length&&(c/=Sc(u)),1!==c&&(i.scale=c);const h=t.getRotation();0!==h&&(i.heading=h*(180/Math.PI));const d=t.getColor();d&&(i.color=d);const p=r[r.length-1].node,g=qu[p.namespaceURI],f=(0,xa.Gl)(i,g);(0,xa.NQ)(n,Wu,xa.OL,f,r,g)})),LabelStyle:(0,xa.mm)((function(e,t,r){const n={node:e},i={},o=t.getFill();o&&(i.color=o.getColor());const a=t.getScale();a&&1!==a&&(i.scale=a);const s=r[r.length-1].node,l=Hu[s.namespaceURI],c=(0,xa.Gl)(i,l);(0,xa.NQ)(n,ju,xa.OL,c,r,l)})),LineStyle:(0,xa.mm)((function(e,t,r){const n={node:e},i={color:t.getColor(),width:Number(t.getWidth())||1},o=r[r.length-1].node,a=Vu[o.namespaceURI],s=(0,xa.Gl)(i,a);(0,xa.NQ)(n,zu,xa.OL,s,r,a)})),PolyStyle:(0,xa.mm)((function(e,t,r){const n={node:e},i=t.getFill(),o=t.getStroke(),a={color:i?i.getColor():void 0,fill:!!i&&void 0,outline:!!o&&void 0},s=r[r.length-1].node,l=uh[s.namespaceURI],c=(0,xa.Gl)(a,l);(0,xa.NQ)(n,fh,xa.OL,c,r,l)})),BalloonStyle:(0,xa.mm)(((e,t)=>{const r=(0,xa.YE)().createCDATASection(t.getText()),n=(0,xa.YE)().createElement("text");n.appendChild(r),e.appendChild(n)}))}),Ah=Oc;var Sh=r(4583),Eh=r(3301),wh=r(1651),_h=r(6546),Lh=r(1667);let Ch,bh;const Th=function(e){let t=Eh.A.replaceSpecialCharacters(e.toLowerCase()).replace(/[^a-z0-9_]/g,"_");return/^[a-z_]/.test(t)||(t="gp_"+t),t},xh=e=>e.dataColumn?e.dataColumn.name:e.name,Ph=async function(e){const{GeoPackageAPI:t,DataTypes:n}=await r.e(3091).then(r.t.bind(r,3091,23));Ch??=new Map([[n.BOOLEAN,al.A.dataType.BOOLEAN],[n.TINYINT,al.A.dataType.TINYINT],[n.SMALLINT,al.A.dataType.SMALLINT],[n.MEDIUMINT,al.A.dataType.MEDIUMINT],[n.INT,al.A.dataType.INTEGER],[n.INTEGER,al.A.dataType.INTEGER],[n.FLOAT,al.A.dataType.FLOAT],[n.DOUBLE,al.A.dataType.DOUBLE],[n.REAL,al.A.dataType.DOUBLE],[n.TEXT,al.A.dataType.STRING],[n.DATE,al.A.dataType.DATE],[n.DATETIME,al.A.dataType.DATETIME]]);const i=await t.open(e),o=i.getFeatureTables(),a=o.length,s=[];for(var l=0;l<o.length;l++){const e=i.getInfoForTable(i.getFeatureDao(o[l])),t=[];for(let r of i.iterateGeoJSONFeatures(o[l]))if(r.geometry){r.type="Feature";for(let t in r.properties){const i=r.properties[t],a=e.columns.find((e=>xh(e)===t));a&&(a.primaryKey&&(r.id=o[l]+"."+i,delete r.properties[t]),a.dataType===n.BOOLEAN&&(r.properties[t]=!!i))}t[t.length]=r}if(!t.length)throw"empty table";s.push({metadata:Mh.call(this,e),type:"FeatureCollection",features:t})}if(0===a)throw"Error: No hay capas vectoriales válidas que mostrar";return s},Mh=function(e){const t=e=>{if(void 0===e)return null;const t=Ch.get(e);return void 0===t?al.A.dataType.STRING:t};return{name:e.tableName,origin:al.A.format.GEOPACKAGE,originalMetadata:e,geometries:[{name:e.geometryColumns.geometryColumn,type:this.getGeometryType(e.geometryColumns.geometryTypeName),originalType:e.geometryColumns.geometryTypeName}],attributes:e.columns.filter((e=>"number"==typeof e.dataType)).map((e=>({name:xh(e),type:t(e.dataType),originalType:e.dataType,isId:e.primaryKey,optional:!e.primaryKey})))}};class Ih extends Sh.Ay{async readFeatures(e,t){return(await Ph.call(this,new Uint8Array(e))).map((e=>{const r=this.readGeoJsonFeatures(e,t);return r.forEach((t=>this.featureMetadata.set(t,e.metadata))),r})).flat()}async writeFeatures(e,t={}){return await async function(e,t={}){const{GeoPackageAPI:n,FeatureColumn:i,GeometryColumns:o,DataTypes:a,BoundingBox:s,GeometryData:l}=await r.e(3091).then(r.t.bind(r,3091,23)),c=e.filter((e=>!e.options.noExport));bh??=new Map([[al.A.dataType.BOOLEAN,a.BOOLEAN],[al.A.dataType.TINYINT,a.TINYINT],[al.A.dataType.SMALLINT,a.SMALLINT],[al.A.dataType.MEDIUMINT,a.MEDIUMINT],[al.A.dataType.INTEGER,a.INTEGER],[al.A.dataType.FLOAT,a.FLOAT],[al.A.dataType.DOUBLE,a.DOUBLE],[al.A.dataType.STRING,a.TEXT],[al.A.dataType.DATE,a.DATE],[al.A.dataType.DATETIME,a.DATETIME]]);const u=function(e,t){const r=Object.keys(t.getData()).toString();let n=e.get(r);return n||(n=[],e.set(r,n)),n.push(t),e},h=t.crs,{default:d}=await Promise.all([r.e(543),r.e(7807)]).then(r.t.bind(r,543,19)),p=await n.create(),g=function(e,t,r){const n=f(e,t);return null===n?m(r):n},f=function(e,t){if(e){const r=e?.attributes?.find((e=>e.name===t));if(r){if(e.origin===al.A.format.GEOPACKAGE&&r.originalType)return r.originalType;const t=bh.get(r.type);return void 0===t?a.TEXT:t}}return null},m=function(e){let t="";switch(typeof e){case"string":default:t=a.TEXT;break;case"number":t=e%1==0?a.INT:a.FLOAT;break;case"boolean":t=a.BOOLEAN}return t},y=function(e,t){switch(t){case a.DATE:case a.DATETIME:return e?new Date(e):e;default:return e}};let v=1;const A=function(e){let t=e;return"string"==typeof e&&(t=parseInt(e.substring(e.lastIndexOf(".")+1)),Number.isNaN(t)&&(t=v++)),t},S=function(e){let t=e;return e.wrap.feature.getGeometry()?.getLayout?.().length>2&&e.getCoordsArray().some((e=>null===e[2]))&&(t=e.clone(),t.getCoordsArray().forEach((e=>{null===e[2]&&(e[2]=0)})),t.setCoordinates(t.geometry)),t};var E=h.substr(h.indexOf(":")+1);if(!p.spatialReferenceSystemDao.queryForId(E)){var w=p.spatialReferenceSystemDao.createObject(),_=await TC.getProjectionData({crs:h});w.srs_name=h,w.srs_id=_.code,w.organization=_.authority??"EPSG",w.organization_coordsys_id=_.code,w.definition=_.wkt.trim(),w.description=_.name,p.spatialReferenceSystemDao.create(w)}const L={};for(const e of c){let r;if(e.layer){let t=await e.layer.getFeatureTypeMetadata();Eh.A.isFunction(t)&&(t=t(e)),r=t?.origin===al.A.format.GEOPACKAGE?t.originalMetadata.tableName:t?.name||(e.layer?.title??e.layer?.id)}r||(r="string"==typeof e.id?e.id.substr(0,e.id.lastIndexOf(".")):t.fileName,r=r||"layer"),L[r]??=[],L[r].push(S(e))}let C;for(C in L){const e=L[C].reduce(u,new Map);let r=0;for(let n of e.values()){const u=n[0]??{},h=await(u.layer?.getFeatureTypeMetadata());let f=0;const m=n.reduce(((e,t,r)=>{let n;switch(!0){case t instanceof cl.A:n="LineString";break;case t instanceof ul.A:n="MultiLineString";break;case t instanceof ll.A:n="Point";break;case t instanceof wh.A:n="MultiPoint";break;case t instanceof _h.A:n="Polygon";break;case t instanceof Lh.A:n="MultiPolygon";break;default:n="Geometry"}return r>0&&n!==e&&(n="Geometry"),n}),"Geometry");let v=Th(C+(e.size>1?"_"+m:""));p.getFeatureTables().includes(v)&&(v+="_"+r++);var b=[];const S=h?.attributes?.find((e=>e.isId)),w=Th(S?.name??"id");(S||Object.prototype.hasOwnProperty.call(c[0],"id")||Object.prototype.hasOwnProperty.call(c[0],"ID"))&&b.push(i.createPrimaryKeyColumnWithIndexAndName(f++,w)),b.push(i.createGeometryColumn(f++,"geometry",m.toUpperCase(),!0,null));for(var T=[1/0,1/0,-1/0,-1/0],x=0;x<n.length;x++){var P=n[x].getBounds();P&&(T[0]=Math.min(T[0],P[0]),T[1]=Math.min(T[1],P[1]),T[2]=Math.max(T[2],P[2]),T[3]=Math.max(T[3],P[3]))}const _=new Map;for(var M in u.data||u.attributes||{}){let e=u.attributes&&u.attributes[M]?u.attributes[M].name:M;if(e.toLowerCase()===w)continue;var I=u.data[e];if(/^[a-zA-Z][a-zA-Z0-9_:]*$/.test(e))_.set(e,e);else{if(!t.adaptNames)throw new Sh.et('Field "'+e+'" is invalid',{cause:e});_.set(e,Th(e))}const r=i.createColumn(f++,_.get(e),g(h,e,I));b.push(r)}if(n.some((e=>e.getStyle().label&&!e.data.name))){const e=i.createColumn(f++,"name",a.TEXT);b.push(e)}var R=new o;R.table_name=v,R.column_name="geometry",R.geometry_type_name=m.toUpperCase(),R.z=u.getGeometryStride?.()??2,R.m=2,R.srs_id=E,f=0;const L=new s(T[0],T[2],T[1],T[3]);await p.createFeatureTable(v,R,b,L,E);const D=p.getFeatureDao(v);for(let e=0;e<n.length;e++){const t=n[e],r=D.newRow(),i=new l;i.setSrsId(E);const o=d.Geometry.parse("SRID="+E+";"+(new wa).writeFeature(t.wrap.feature));for(var O in i.setGeometry(o),r.setValueWithColumnName(r.geometryColumn.name,i),Object.prototype.hasOwnProperty.call(t,"id")?r.setValueWithColumnName(w,A(t.id)):Object.prototype.hasOwnProperty.call(t,"ID")?r.setValueWithColumnName(w,A(t.ID)):Object.prototype.hasOwnProperty.call(t.data,"id")?r.setValueWithColumnName(w,A(t.data.id)):Object.prototype.hasOwnProperty.call(t.data,"ID")&&r.setValueWithColumnName(w,A(t.data.ID)),t.data||t.attributes){const e=u.attributes&&u.attributes[O]?u.attributes[M].name:O;if(e.toLowerCase()===w)continue;const n=_.get(e),i=y(t.data[e],b.find((e=>e.name===n)).dataType);("object"!=typeof i||i instanceof Date)&&r.setValueWithColumnName(n,i)}D.columns.indexOf("name")>=0&&!t.data.name&&r.setValueWithColumnName("name",t.getStyle().label),D.create(r)}}}return await p.export()}(e.map((e=>e._wrap.parent)),{crs:t.featureProjection,adaptNames:t.adaptNames})}groupFeatures(e){const t={};for(const r of e){const e=this.featureMetadata.get(r);e&&(Object.prototype.hasOwnProperty.call(t,e.name)||(t[e.name]=[]),t[e.name].push(r))}return t}getGeometryType(e){switch(e){case"POLYGON":return al.A.geom.POLYGON;case"MULTIPOLYGON":return al.A.geom.MULTIPOLYGON;case"LINESTRING":return al.A.geom.POLYLINE;case"MULTILINESTRING":return al.A.geom.MULTIPOLYLINE;case"POINT":return al.A.geom.POINT;case"MULTIPOINT":return al.A.geom.MULTIPOINT;default:return!1}}}const Rh=Ih;var Oh=r(8325);const Dh="ISO-8859-1",Nh="C",kh="D",Fh="N",Gh=(e,t)=>{switch(e){case Nh:return al.A.dataType.STRING;case kh:return al.A.dataType.DATE;case Fh:return t>0?al.A.dataType.FLOAT:al.A.dataType.INTEGER;case"L":return al.A.dataType.BOOLEAN;case"@":return al.A.dataType.DATETIME;case"I":case"+":return al.A.dataType.INTEGER;case"F":return al.A.dataType.FLOAT;case"O":return al.A.dataType.DOUBLE;default:al.A.dataType.STRING}},Bh=new Map([[al.A.dataType.BOOLEAN,"L"],[al.A.dataType.TINYINT,Fh],[al.A.dataType.SMALLINT,Fh],[al.A.dataType.MEDIUMINT,Fh],[al.A.dataType.INTEGER,Fh],[al.A.dataType.FLOAT,Fh],[al.A.dataType.DOUBLE,Fh],[al.A.dataType.STRING,Nh],[al.A.dataType.DATE,kh],[al.A.dataType.DATETIME,kh]]),Uh=(e,t)=>e===t,qh=async function({fileName:e,shp:t,dbf:n,prj:i,str:o,cst:a,cpg:s}){if(!t||!i||!n)throw"fileImport.shapeImcomplete";const l=e.replace(/\.shp$/i,""),{default:c}=await r.e(3155).then(r.t.bind(r,3155,23)),u=await c.combine([c.parseShp(t,i,o),c.parseDbf(n,a||s||Dh)]),h=function(e,t){const r=new DataView(e),n=r.getUint16(8,!0),i=[];let o=32;for(;o<n&&(i.push({name:t.decode(e.slice(o,o+11)).replace(/\0/g,"").trim(),dataType:String.fromCharCode(r.getUint8(o+11)),length:r.getUint8(o+16),decimalCount:r.getUint8(o+17)}),13!==r.getUint8(o+32));)o+=32;return i}(n,new TextDecoder(a||s||Dh)),d={name:e,origin:al.A.format.SHAPEFILE,attributes:h.map((e=>({name:e.name,type:Gh(e.dataType,e.decimalCount),originalType:{dataType:e.dataType,length:e.length,decimalCount:e.decimalCount},isId:"+"===e.dataType,optional:"+"!==e.dataType}))),equals:Uh,originalMetadata:{encoding:s}};return(u instanceof Array?u:[u]).map((e=>{const t=e?.features[0]?.geometry.type,r=[{name:"geometry",type:this.getGeometryType(t),originalType:t}];return e.features.forEach(((e,t)=>{e.id=`${l}.${t+1}`;for(const t in e.properties)e.properties[t]instanceof Date&&isNaN(e.properties[t])&&(e.properties[t]=null)})),e.metadata={...d,geometries:r},e}))};class Wh extends Sh.Ay{#_={};async readFeatures(e,t={}){let r=null,n=t.fileName;const i=(e=>e.substring(0,e.lastIndexOf(".")))(n)||n;n=n.match(/^(?:spaSITNA)?(.+)/i)[1];const o=(e,t,r)=>{e[(e=>e.substring(e.lastIndexOf(".")+1))(t)]=r;const n=e.deferreds[e.fileNames.indexOf(t)];n&&n.resolve()};let a=null;if(Object.prototype.hasOwnProperty.call(this.#_,i))a=this.#_[i];else{const e=t.fileNames.filter((e=>e.startsWith(i))).filter((e=>/\.(shp|dbf|str|cst|cpg|prj|shx|idx|sbn|xml)$/gi.test(e)));a=this.#_[i]={fileNames:e,deferreds:e.map((()=>(()=>{const e={};return Object.assign(new Promise(((t,r)=>Object.assign(e,{resolve:t,reject:r}))),e)})()))}}if(/\.(shx|idx|sbn|xml)$/gi.test(n))o(a,n,null),r=!0;else if(/\.(cst|cpg|prj)$/gi.test(n))o(a,n,(new TextDecoder).decode(e)),r=!0;else if(/\.(shp|dbf|str)$/gi.test(n)&&(o(a,n,e),r=!0,/\.(shp)$/gi.test(n))){a.fileName=n,await Promise.all(a.deferreds);const e=await qh.call(this,a);return delete this.#_[i],e.map((e=>{const r=this.readGeoJsonFeatures(e,t);return r.forEach((t=>this.featureMetadata.set(t,e.metadata))),r}))}return r}async writeFeatures(e,t={}){return await async function(e,t={}){let n=Dh;const i=e.filter((e=>!e.options.noExport)).reduce((function(e,t){var r=t.id.substr(0,t.id.lastIndexOf("."));return r.length||(t.folders?.length&&(r=t.folders[t.folders.length-1]),t.layer?.title&&(r=t.layer.title.substr(0,t.layer.title.lastIndexOf(".")))),(e[r]=e[r]||[]).push(t),e}),{}),o=function(e,t){const r=function(e){switch(!0){case e instanceof ll.A:return"POINT";case e instanceof _h.A:case e instanceof Lh.A:return"POLYGON";case e instanceof cl.A:case e instanceof ul.A:return"POLYLINE"}return"NULL"}(t);let n=e.get(r);return n||(n=[],e.set(r,n)),n.push(t),e},a=await TC.getProjectionData({crs:t.crs}),s=[],[{default:l},{default:c}]=await Promise.all([Promise.all([r.e(1710),r.e(5293)]).then(r.t.bind(r,5293,19)),r.e(5955).then(r.t.bind(r,5955,19))]);let u;for(u in i){const e=i[u].reduce(o,new Map);for(let[r,i]of e.entries()){if(!t.adaptNames)for(const e of i)for(const t in e.data)if(t.length>10||!/^[a-zA-Z][a-zA-Z0-9_:]*$/.test(t))throw new Sh.et('Field "'+t+'" is invalid',{cause:t});const o=await Promise.all(i.map((e=>e.layer?.getFeatureTypeMetadata()))),a={};for(let e=0;e<o.length;e++){let t=o[e];"function"==typeof t&&(t=o[e]=t(i[e]));const r=t?.name??"_";a[r]??={metadata:t,features:[]},a[r].features.push(i[e])}const h=Object.entries(a);for(const[i,o]of h){const a=o.metadata,d=o.features,p=a?.equals??Uh;n=a?.originalMetadata?.encoding??Dh;const g=a?.attributes?.filter((e=>!e.isId)).filter((e=>d.some((t=>Object.keys(t.data).some((t=>p(t,e.name))))))).map((e=>{if(e.type===al.A.dataType.TIME&&!t.acceptTimeLoss)throw new Sh.Tp;const r=e.name;if(a.origin===al.A.format.SHAPEFILE&&e.originalType)return{name:r,type:e.originalType.dataType,size:e.originalType.length-e.originalType.decimalCount,decimalCount:e.originalType.decimalCount};const n=Bh.get(e.type)||Nh;let i;switch(n){case Nh:i=254;break;case"L":i=1;break;case kh:case"@":i=8;break;case Fh:case"F":i=18}return{name:r,type:n,size:i}}));s.push(new Promise((function(t){const n=d.map((function(e){const t={};for(var r in e.data){const n=e.data[r];t[r]="string"==typeof n?n.replace(/•/g,"&bull;").replace(/›/g,"&rsaquo;"):n}return e.getStyle().label&&!e.data.name&&(t.name=e.getStyle().label),t})),o=d.map((function(e){let t=e.geometry;const r=e=>{const t=[];t.push(e[0]);for(var r=1;r<e.length;r++){let n;n=Oh.A.getArea(e[r])>0?e[r].reverse():e[r],t.push(n)}return t};if(e instanceof cl.A)return[t];if(e instanceof _h.A)return r(t);if(e instanceof Lh.A){t=[];for(const n of e.geometry)t.push(r(n))}return t})),a=u+(e.size>1||h.length>1?"_"+i:"");if(g){for(const e of g)if(e.type===kh)for(const t of n){const r=t[e.name];if(r){const n=new Date(r);t[e.name]=n.getFullYear()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0")}else t[e.name]="".padEnd(8,"")}for(const e of g)"F"===e.type&&(e.type=Fh);for(const e of n)for(const t in e){const r=e[t],n=g.find((e=>p(e.name,t)));n&&n.name!==t&&(delete e[t],e[n.name]=r)}for(const e of n)for(const t in e){const r=e[t];r&&"object"==typeof r&&(e[t]="")}l.write([],r,o,(function(e,r){r.dbf=c.structure(n,g),t({fileName:a,content:r})}))}else l.write(n,r,o,(function(e,r){t({fileName:a,content:r})}))})))}}}const h=[];for(var d=0;d<s.length;d++)h[d]=await s[d];const{default:p}=await r.e(1710).then(r.t.bind(r,1710,23)),g=new p;return h.forEach((e=>{g.file(e.fileName+".shp",e.content.shp.buffer),g.file(e.fileName+".shx",e.content.shx.buffer),g.file(e.fileName+".dbf",e.content.dbf.buffer),g.file(e.fileName+".prj",a.wkt),g.file(e.fileName+".cst",n),g.file(e.fileName+".cpg",n)})),await g.generateAsync({type:"blob"})}(e.map((e=>e._wrap.parent)),{crs:t.featureProjection,adaptNames:t.adaptNames,acceptTimeLoss:t.acceptTimeLoss})}getGeometryType(e){switch(e){case"Polygon":return al.A.geom.POLYGON;case"MultiPolygon":return al.A.geom.MULTIPOLYGON;case"LineString":return al.A.geom.POLYLINE;case"MultiLineString":return al.A.geom.MULTIPOLYLINE;case"Point":return al.A.geom.POINT;case"MultiPoint":return al.A.geom.MULTIPOINT;default:return!1}}}const Hh=Wh;var jh=r(3662);const Vh="#text",zh=function(e){let[t,r]=e.split(":");return r||([t,r]=[r,t]),[t,r]};jh.A.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);const r=(0,xa.qq)(this.featureNS,"featureMembers");t.parentNode&&t.parentNode.appendChild(r);let n=this.featureNS;if(this.featureTypeMetadata?.origin===al.A.format.GML){this.featureTypeMetadata.originalMetadata?.featureTypes&&(this.featureType=Object.keys(this.featureTypeMetadata.originalMetadata.featureTypes)[0]);const e=this.featureType.substring(0,this.featureType.indexOf(":"));n=this.featureTypeMetadata.originalMetadata?.namespaces?.find((t=>t.prefix===e))?.value??this.featureNS}const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:n,featureType:this.featureType};t&&Object.assign(i,t);const o=e.map((e=>{var t=e.clone();return t.id_=e.id_,t})).map((e=>{let t=e.getProperties();const r=[];for(var n in t)(n.indexOf(" ")>=0||/^\d/.test(n))&&r.push(n);return r.forEach((function(r){var n=r.replace(/ /g,"_");if(/^\d/.test(n)&&(n="_"+n),r!==n)for(;void 0!==t[n];)n+="_";e.set(n,t[r]),e.unset(r)})),e}));return this.writeFeatureMembers_(r,o,[i]),r},jh.A.prototype.writeFeatureMembers_=function(e,t,r){const n=r[r.length-1],i=n.featureType,o=n.featureNS,a={};a[o]={},a[o][i]=(0,xa.mm)(this.writeFeatureElement,this),i.indexOf(":")>0&&(a[o][i.substring(i.indexOf(":")+1)]=a[o][i]);const s=Object.assign({},n);s.node=e,(0,xa.NQ)(s,a,(0,xa.X1)(i,o),t,r)},jh.A.prototype.writeFeatures=function(e,t){const r=t?.featureTypeMetadata;this.hasZ=e.some((e=>e.getGeometry()?.getLayout?.().length>2));const n=function(e){for(const t in e){const r=e[t];void 0===r?e[t]="":null!==r&&"object"==typeof r&&n(r)}};let i=e.map((e=>{const t=e.clone(),r=Eh.A.extend(!0,!0,{},e.getProperties());return n(r),t.setProperties(r),t.setId(e.getId()),t}));if(r?.origin===al.A.format.GML){const e=t=>{const r=[];for(let n in t){const i=t[n];if("string"==typeof i.type)jh.A.getGeometryType(i.type)&&r.push([n]);else if("object"==typeof i.type){const t=e(i.type);for(const e of t)r.push([n,...e])}}return r},[t,n]=Object.entries(r.originalMetadata.featureTypes)[0],[o]=zh(t),a=e(n);if(a.length&&a.every((e=>e.length>1))){const e=a[0],t=(e,t,r)=>{if(Object.prototype.hasOwnProperty.call(e,t))return e[t];if(t.indexOf(":")<0){const n=r+":"+t;if(Object.prototype.hasOwnProperty.call(e,n))return e[n]}};i=i.map((r=>{const n=Eh.A.extend(!0,{},r.getProperties());let i=n;for(let r=0,n=e.length-1;r<n;r++)i=t(i,e[r],o);return i&&(i[e[e.length-1]]=r.getGeometry(),r.setProperties(n),r.unset(r.getGeometryName(),!0)),r}))}}const o=this.writeFeaturesNode(i,t),a=(0,xa.qq)("http://www.opengis.net/wfs","FeatureCollection");r?.origin===al.A.format.GML?a.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",r.originalMetadata.namespaces.filter((e=>e.schemaLocation)).map((e=>`${e.value} ${e.schemaLocation}`)).join(" ")):a.setAttributeNS("http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation),a.appendChild(o);let s=this.xmlSerializer_.serializeToString(a);const l=r?.originalMetadata?.namespaces||[{prefix:"gml",value:"http://www.opengis.net/gml/3.2"}];let c="<FeatureCollection";for(const e of l){const t=` xmlns:${e.prefix}="${e.value}"`;c+=t,s=s.replaceAll(t,"")}return s=s.replace("<FeatureCollection",c),["MultiPolygon","MultiSurface","surfaceMember","Point","Polygon","Surface","LineString","Curve","MultiLineString","MultiPoint","MultiCurve","curveMember","exterior","interior","LinearRing","posList","pos","boundedBy"].forEach((e=>{s=s.replaceAll("<"+e+' xmlns="http://www.opengis.net/gml"',"<gml:"+e),s=s.replaceAll("<"+e,"<gml:"+e),s=s.replaceAll("/"+e,"/gml:"+e)})),s};const Yh=function(e,t){const[r]=zh(e);let n=t;return this.featureTypeMetadata&&(n=this.featureTypeMetadata.originalMetadata?.namespaces?.find((e=>e.prefix===r))?.value??n),n};jh.A.prototype.writeFeatureElement=function(e,t,r){const n=t.getId();n&&e.setAttribute("fid",n);const i=r[r.length-1],o=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});const s=[],l=[];if(t.hasProperties()){const e=t=>{if(t instanceof qo.A)return t;if(!t||"object"!=typeof t||Array.isArray(t))return t;const r={};return Object.entries(t).forEach((([n,i])=>{if(n.indexOf($h)>0){const[e,o]=n.split($h);r[e]&&Object.prototype.hasOwnProperty.call(r[e],Vh)||(r[e]={[Vh]:t[e]}),r[e][$h+o]=i}else Object.prototype.hasOwnProperty.call(r,n)||(r[n]=e(i))})),r},r=e(t.getProperties());for(const e in r){const t=r[e];if(Array.isArray(t)&&"boundedBy"!==e&&"gml:boundedBy"!==e?(t.forEach((e=>l.push(e))),t.forEach((()=>s.push(e)))):(s.push(e),l.push(t)),e==a||"function"==typeof t?.getSimplifiedGeometry)e in i.serializers[o]||(i.serializers[o][e]=(0,xa.mm)(this.writeGeometryElement,this));else{const t=Yh.call(this,e,o);i.serializers[t]??={},e in i.serializers[t]||("boundedBy"===e||"gml:boundedBy"===e?i.serializers[t]["gml:boundedBy"]=(0,xa.mm)(this.writeBoundedByElement):i.serializers[t][e]=(0,xa.mm)(this.writeFeaturePropertyNode),e.indexOf(":")>0&&(i.serializers[t][e.substring(e.indexOf(":")+1)]=i.serializers[t][e]))}}}const c=Object.assign({},i);c.node=e,l.forEach(((e,t)=>{const n=s[t],a=Yh.call(this,n,o),l=this.featureTypeMetadata?.originalMetadata?.namespaces?.find((e=>e.value===a))?.prefix,u=l&&n.indexOf(":")<0?l+":"+n:n;(0,xa.NQ)(c,i.serializers,(0,xa.X1)(u,a),[e],r,[n],this)}))},jh.A.prototype.writeBoundedByElement=function(e,t,r){const n=r[r.length-1],i=Object.assign({},n);let o;i.node=e,Array.isArray(t)&&(o=(0,la.zU)(t,n)),(0,xa.NQ)(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,["Envelope"],this)};const $h="@",Kh=e=>e.substring(e.indexOf($h)+1);jh.A.prototype.writeFeaturePropertyNode=function(e,t,r){const n=r[r.length-1],i=n.featureNS,o=Object.assign({},n);if(o.node=e,null===t)e.setAttribute("xsi:nil","true");else if("object"!=typeof t||Array.isArray(t))(0,Ia.uB)(e,t);else for(let a in t){const s=t[a],l=Yh.call(this,a,i);let[c,u]=zh(Kh(a));c??=this.featureTypeMetadata?.originalMetadata?.namespaces?.find((e=>e.value===l))?.prefix;const h=c?c+":"+u:u;n.serializers[l]??={},a===Vh?null===s?e.setAttribute("xsi:nil","true"):void 0!==s&&(0,Ia.uB)(e,s):a.startsWith($h)?e.setAttribute(Kh(a),s||""):(a in n.serializers[l]||(s instanceof qo.A?n.serializers[l][a]=(0,xa.mm)(this.writeGeometryElement,this):n.serializers[l][a]=(0,xa.mm)(this.writeFeaturePropertyNode),n.serializers[l][u]=n.serializers[l][a]),(0,xa.NQ)(o,n.serializers,(0,xa.X1)(h,l),[void 0===s?"":s],r,[a],this))}[...e.attributes].slice().forEach((t=>{t.name.startsWith("xmlns")&&e.removeAttribute(t)}))};const Xh=jh.A;var Zh=r(1580);const Jh=class{drawCustom(e,t,r,n,i){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,r){}drawFeature(e,t,r){}drawGeometryCollection(e,t,r){}drawLineString(e,t,r){}drawMultiLineString(e,t,r){}drawMultiPoint(e,t,r){}drawMultiPolygon(e,t,r){}drawPoint(e,t,r){}drawPolygon(e,t,r){}drawText(e,t,r){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}},Qh={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ed=[Qh.FILL],td=[Qh.STROKE],rd=[Qh.BEGIN_PATH],nd=[Qh.CLOSE_PATH],id=Qh,od=class extends Jh{constructor(e,t,r,n){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=r,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return 1==t?e:e.map((function(e){return e*t}))}appendFlatPointCoordinates(e,t){const r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,i=this.coordinates;let o=i.length;for(let a=0,s=e.length;a<s;a+=t)n[0]=e[a],n[1]=e[a+1],(0,ee.Ym)(r,n)&&(i[o++]=n[0],i[o++]=n[1]);return o}appendFlatLineCoordinates(e,t,r,n,i,o){const a=this.coordinates;let s=a.length;const l=this.getBufferedMaxExtent();o&&(t+=n);let c=e[t],u=e[t+1];const h=this.tmpCoordinate_;let d,p,g,f=!0;for(d=t+n;d<r;d+=n)h[0]=e[d],h[1]=e[d+1],g=(0,ee.vz)(l,h),g!==p?(f&&(a[s++]=c,a[s++]=u,f=!1),a[s++]=h[0],a[s++]=h[1]):g===Zh.A.INTERSECTING?(a[s++]=h[0],a[s++]=h[1],f=!1):f=!0,c=h[0],u=h[1],p=g;return(i&&f||d===t+n)&&(a[s++]=c,a[s++]=u),s}drawCustomCoordinates_(e,t,r,n,i){for(let o=0,a=r.length;o<a;++o){const a=r[o],s=this.appendFlatLineCoordinates(e,t,a,n,!1,!1);i.push(s),t=a}return t}drawCustom(e,t,r,n,i){this.beginGeometry(e,t,i);const o=e.getType(),a=e.getStride(),s=this.coordinates.length;let l,c,u,h,d;switch(o){case"MultiPolygon":l=e.getOrientedFlatCoordinates(),h=[];const t=e.getEndss();d=0;for(let e=0,r=t.length;e<r;++e){const r=[];d=this.drawCustomCoordinates_(l,d,t[e],a,r),h.push(r)}this.instructions.push([id.CUSTOM,s,h,e,r,Qo.Dz,i]),this.hitDetectionInstructions.push([id.CUSTOM,s,h,e,n||r,Qo.Dz,i]);break;case"Polygon":case"MultiLineString":u=[],l="Polygon"==o?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),d=this.drawCustomCoordinates_(l,0,e.getEnds(),a,u),this.instructions.push([id.CUSTOM,s,u,e,r,Qo.cD,i]),this.hitDetectionInstructions.push([id.CUSTOM,s,u,e,n||r,Qo.cD,i]);break;case"LineString":case"Circle":l=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(l,0,l.length,a,!1,!1),this.instructions.push([id.CUSTOM,s,c,e,r,Qo.n2,i]),this.hitDetectionInstructions.push([id.CUSTOM,s,c,e,n||r,Qo.n2,i]);break;case"MultiPoint":l=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(l,a),c>s&&(this.instructions.push([id.CUSTOM,s,c,e,r,Qo.n2,i]),this.hitDetectionInstructions.push([id.CUSTOM,s,c,e,n||r,Qo.n2,i]));break;case"Point":l=e.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),c=this.coordinates.length,this.instructions.push([id.CUSTOM,s,c,e,r,void 0,i]),this.hitDetectionInstructions.push([id.CUSTOM,s,c,e,n||r,void 0,i])}this.endGeometry(t)}beginGeometry(e,t,r){this.beginGeometryInstruction1_=[id.BEGIN_GEOMETRY,t,0,e,r],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[id.BEGIN_GEOMETRY,t,0,e,r],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;let t;e.reverse();const r=e.length;let n,i,o=-1;for(t=0;t<r;++t)n=e[t],i=n[0],i==id.END_GEOMETRY?o=t:i==id.BEGIN_GEOMETRY&&(n[2]=t,(0,V.gI)(this.hitDetectionInstructions,o,t),o=-1)}fillStyleToState(e,t={}){if(e){const r=e.getColor();t.fillPatternScale=r&&"object"==typeof r&&"src"in r?this.pixelRatio:1,t.fillStyle=si(r||ci)}else t.fillStyle=void 0;return t}strokeStyleToState(e,t={}){if(e){const r=e.getColor();t.strokeStyle=si(r||pi);const n=e.getLineCap();t.lineCap=void 0!==n?n:ui;const i=e.getLineDash();t.lineDash=i?i.slice():hi;const o=e.getLineDashOffset();t.lineDashOffset=o||0;const a=e.getLineJoin();t.lineJoin=void 0!==a?a:di;const s=e.getWidth();t.lineWidth=void 0!==s?s:1;const l=e.getMiterLimit();t.miterLimit=void 0!==l?l:10,t.lineWidth>this.maxLineWidth&&(this.maxLineWidth=t.lineWidth,this.bufferedMaxExtent_=null)}else t.strokeStyle=void 0,t.lineCap=void 0,t.lineDash=null,t.lineDashOffset=void 0,t.lineJoin=void 0,t.lineWidth=void 0,t.miterLimit=void 0;return t}setFillStrokeStyle(e,t){const r=this.state;this.fillStyleToState(e,r),this.strokeStyleToState(t,r)}createFill(e){const t=e.fillStyle,r=[id.SET_FILL_STYLE,t];return"string"!=typeof t&&r.push(e.fillPatternScale),r}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[id.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,e.lineDash?this.applyPixelRatio(e.lineDash):null,e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const r=e.fillStyle;"string"==typeof r&&e.currentFillStyle==r||(void 0!==r&&this.instructions.push(t.call(this,e)),e.currentFillStyle=r)}updateStrokeStyle(e,t){const r=e.strokeStyle,n=e.lineCap,i=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,s=e.lineWidth,l=e.miterLimit;(e.currentStrokeStyle!=r||e.currentLineCap!=n||i!=e.currentLineDash&&!(0,V.aI)(e.currentLineDash,i)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=s||e.currentMiterLimit!=l)&&(void 0!==r&&t.call(this,e),e.currentStrokeStyle=r,e.currentLineCap=n,e.currentLineDash=i,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=s,e.currentMiterLimit=l)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[id.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,ee.o8)(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;(0,ee.r)(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}};var ad=r(3671);const sd=class extends od{constructor(e,t,r,n){super(e,t,r,n)}drawFlatCoordinatess_(e,t,r,n){const i=this.state,o=void 0!==i.fillStyle,a=void 0!==i.strokeStyle,s=r.length;this.instructions.push(rd),this.hitDetectionInstructions.push(rd);for(let i=0;i<s;++i){const o=r[i],s=this.coordinates.length,l=this.appendFlatLineCoordinates(e,t,o,n,!0,!a),c=[id.MOVE_TO_LINE_TO,s,l];this.instructions.push(c),this.hitDetectionInstructions.push(c),a&&(this.instructions.push(nd),this.hitDetectionInstructions.push(nd)),t=o}return o&&(this.instructions.push(ed),this.hitDetectionInstructions.push(ed)),a&&(this.instructions.push(td),this.hitDetectionInstructions.push(td)),t}drawCircle(e,t,r){const n=this.state,i=n.fillStyle,o=n.strokeStyle;if(void 0===i&&void 0===o)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([id.SET_FILL_STYLE,ci]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([id.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,hi,0]);const a=e.getFlatCoordinates(),s=e.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,s,!1,!1);const c=[id.CIRCLE,l];this.instructions.push(rd,c),this.hitDetectionInstructions.push(rd,c),void 0!==n.fillStyle&&(this.instructions.push(ed),this.hitDetectionInstructions.push(ed)),void 0!==n.strokeStyle&&(this.instructions.push(td),this.hitDetectionInstructions.push(td)),this.endGeometry(t)}drawPolygon(e,t,r){const n=this.state,i=n.fillStyle,o=n.strokeStyle;if(void 0===i&&void 0===o)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([id.SET_FILL_STYLE,ci]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([id.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,hi,0]);const a=e.getEnds(),s=e.getOrientedFlatCoordinates(),l=e.getStride();this.drawFlatCoordinatess_(s,0,a,l),this.endGeometry(t)}drawMultiPolygon(e,t,r){const n=this.state,i=n.fillStyle,o=n.strokeStyle;if(void 0===i&&void 0===o)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,r),void 0!==n.fillStyle&&this.hitDetectionInstructions.push([id.SET_FILL_STYLE,ci]),void 0!==n.strokeStyle&&this.hitDetectionInstructions.push([id.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,hi,0]);const a=e.getEndss(),s=e.getOrientedFlatCoordinates(),l=e.getStride();let c=0;for(let e=0,t=a.length;e<t;++e)c=this.drawFlatCoordinatess_(s,c,a[e],l);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(0!==e){const t=this.coordinates;for(let r=0,n=t.length;r<n;++r)t[r]=(0,ad.n$)(t[r],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill),void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)}};function ld(e,t,r,n,i){const o=[];let a=r,s=0,l=t.slice(r,2);for(;s<e&&a+i<n;){const[r,n]=l.slice(-2),c=t[a+i],u=t[a+i+1],h=Math.sqrt((c-r)*(c-r)+(u-n)*(u-n));if(s+=h,s>=e){const t=(e-s+h)/h,d=(0,z.Cc)(r,c,t),p=(0,z.Cc)(n,u,t);l.push(d,p),o.push(l),l=[d,p],s==e&&(a+=i),s=0}else if(s<e)l.push(t[a+i],t[a+i+1]),a+=i;else{const e=h-s,t=(0,z.Cc)(r,c,e/h),d=(0,z.Cc)(n,u,e/h);l.push(t,d),o.push(l),l=[t,d],s=0,a+=i}}return s>0&&o.push(l),o}function cd(e,t,r,n,i){let o,a,s,l,c,u,h,d,p,g,f=r,m=r,y=0,v=0,A=r;for(a=r;a<n;a+=i){const r=t[a],n=t[a+1];void 0!==c&&(p=r-c,g=n-u,l=Math.sqrt(p*p+g*g),void 0!==h&&(v+=s,o=Math.acos((h*p+d*g)/(s*l)),o>e&&(v>y&&(y=v,f=A,m=a),v=0,A=a-i)),s=l,h=p,d=g),c=r,u=n}return v+=l,v>y?[A,a]:[f,m]}const ud={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},hd={Circle:sd,Default:od,Image:class extends od{constructor(e,t,r,n){super(e,t,r,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,r){if(!this.image_||this.maxExtent&&!(0,ee.Ym)(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,r);const n=e.getFlatCoordinates(),i=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(n,i);this.instructions.push([id.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([id.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,r){if(!this.image_)return;this.beginGeometry(e,t,r);const n=e.getFlatCoordinates(),i=[];for(let t=0,r=n.length;t<r;t+=e.getStride())this.maxExtent&&!(0,ee.Ym)(this.maxExtent,n.slice(t,t+2))||i.push(n[t],n[t+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(i,2);this.instructions.push([id.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([id.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const r=e.getAnchor(),n=e.getSize(),i=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=e.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=n[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}},LineString:class extends od{constructor(e,t,r,n){super(e,t,r,n)}drawFlatCoordinates_(e,t,r,n){const i=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,r,n,!1,!1),a=[id.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}drawLineString(e,t,r){const n=this.state,i=n.strokeStyle,o=n.lineWidth;if(void 0===i||void 0===o)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,r),this.hitDetectionInstructions.push([id.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,hi,0],rd);const a=e.getFlatCoordinates(),s=e.getStride();this.drawFlatCoordinates_(a,0,a.length,s),this.hitDetectionInstructions.push(td),this.endGeometry(t)}drawMultiLineString(e,t,r){const n=this.state,i=n.strokeStyle,o=n.lineWidth;if(void 0===i||void 0===o)return;this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(e,t,r),this.hitDetectionInstructions.push([id.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,hi,0],rd);const a=e.getEnds(),s=e.getFlatCoordinates(),l=e.getStride();let c=0;for(let e=0,t=a.length;e<t;++e)c=this.drawFlatCoordinates_(s,c,a[e],l);this.hitDetectionInstructions.push(td),this.endGeometry(t)}finish(){const e=this.state;return null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push(td),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){null!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(td),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(rd)}},Polygon:sd,Text:class extends od{constructor(e,t,r,n){super(e,t,r,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[ci]={fillStyle:ci},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,r){const n=this.textFillState_,i=this.textStrokeState_,o=this.textState_;if(""===this.text_||!o||!n&&!i)return;const a=this.coordinates;let s=a.length;const l=e.getType();let c=null,u=e.getStride();if("line"!==o.placement||"LineString"!=l&&"MultiLineString"!=l&&"Polygon"!=l&&"MultiPolygon"!=l){let n=o.overflow?null:[];switch(l){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),u=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||n.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const t=e.getFlatInteriorPoints();c=[];for(let e=0,r=t.length;e<r;e+=3)o.overflow||n.push(t[e+2]/this.resolution),c.push(t[e],t[e+1]);if(0===c.length)return;u=2}const i=this.appendFlatPointCoordinates(c,u);if(i===s)return;if(n&&(i-s)/2!=c.length/u){let e=s/2;n=n.filter(((t,r)=>{const n=a[2*(e+r)]===c[r*u]&&a[2*(e+r)+1]===c[r*u+1];return n||--e,n}))}this.saveTextStates_();const h=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,d=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(e,t,r);let p=o.padding;if(p!=mi&&(o.scale[0]<0||o.scale[1]<0)){let e=o.padding[0],t=o.padding[1],r=o.padding[2],n=o.padding[3];o.scale[0]<0&&(t=-t,n=-n),o.scale[1]<0&&(e=-e,r=-r),p=[e,t,r,n]}const g=this.pixelRatio;this.instructions.push([id.DRAW_IMAGE,s,i,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,p==mi?mi:p.map((function(e){return e*g})),h,d,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]);const f=1/g,m=h?h.slice(0):null;m&&(m[1]=ci),this.hitDetectionInstructions.push([id.DRAW_IMAGE,s,i,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[f,f],NaN,this.declutterMode_,this.declutterImageWithText_,p,m,d,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?ci:this.fillKey_,this.textOffsetX_,this.textOffsetY_,n]),this.endGeometry(t)}else{if(!(0,ee.HY)(this.maxExtent,e.getExtent()))return;let n;if(c=e.getFlatCoordinates(),"LineString"==l)n=[c.length];else if("MultiLineString"==l)n=e.getEnds();else if("Polygon"==l)n=e.getEnds().slice(0,1);else if("MultiPolygon"==l){const t=e.getEndss();n=[];for(let e=0,r=t.length;e<r;++e)n.push(t[e][0])}this.beginGeometry(e,t,r);const i=o.repeat,h=i?void 0:o.textAlign;let d=0;for(let e=0,t=n.length;e<t;++e){let t;t=i?ld(i*this.resolution,c,d,n[e],u):[c.slice(d,n[e])];for(let r=0,i=t.length;r<i;++r){const i=t[r];let l=0,c=i.length;if(null==h){const e=cd(o.maxAngle,i,0,i.length,2);l=e[0],c=e[1]}for(let e=l;e<c;e+=u)a.push(i[e],i[e+1]);const p=a.length;d=n[e],this.drawChars_(s,p),s=p}}this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,r=this.textFillState_,n=this.strokeKey_;e&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const i=this.textKey_;i in this.textStates||(this.textStates[i]={font:t.font,textAlign:t.textAlign||gi,justify:t.justify,textBaseline:t.textBaseline||fi,scale:t.scale});const o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))}drawChars_(e,t){const r=this.textStrokeState_,n=this.textState_,i=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const s=this.pixelRatio,l=ud[n.textBaseline],c=this.textOffsetY_*s,u=this.text_,h=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([id.DRAW_CHARS,e,t,l,n.overflow,a,n.maxAngle,s,c,i,h*s,u,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([id.DRAW_CHARS,e,t,l,n.overflow,a?ci:a,n.maxAngle,s,c,i,h*s,u,o,1/s,this.declutterMode_,this.textKeepUpright_])}setTextStyle(e,t){let r,i,o;if(e){const t=e.getFill();t?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=si(t.getColor()||ci)):(i=null,this.textFillState_=i);const a=e.getStroke();if(a){o=this.textStrokeState_,o||(o={},this.textStrokeState_=o);const e=a.getLineDash(),t=a.getLineDashOffset(),r=a.getWidth(),n=a.getMiterLimit();o.lineCap=a.getLineCap()||ui,o.lineDash=e?e.slice():hi,o.lineDashOffset=void 0===t?0:t,o.lineJoin=a.getLineJoin()||di,o.lineWidth=void 0===r?1:r,o.miterLimit=void 0===n?10:n,o.strokeStyle=si(a.getColor()||pi)}else o=null,this.textStrokeState_=o;r=this.textState_;const s=e.getFont()||li;Ei(s);const l=e.getScaleArray();r.overflow=e.getOverflow(),r.font=s,r.maxAngle=e.getMaxAngle(),r.placement=e.getPlacement(),r.textAlign=e.getTextAlign(),r.repeat=e.getRepeat(),r.justify=e.getJustify(),r.textBaseline=e.getTextBaseline()||fi,r.backgroundFill=e.getBackgroundFill(),r.backgroundStroke=e.getBackgroundStroke(),r.padding=e.getPadding()||mi,r.scale=void 0===l?[1,1]:l;const c=e.getOffsetX(),u=e.getOffsetY(),h=e.getRotateWithView(),d=e.getKeepUpright(),p=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=void 0===c?0:c,this.textOffsetY_=void 0===u?0:u,this.textRotateWithView_=void 0!==h&&h,this.textKeepUpright_=void 0===d||d,this.textRotation_=void 0===p?0:p,this.strokeKey_=o?("string"==typeof o.strokeStyle?o.strokeStyle:(0,n.v6)(o.strokeStyle))+o.lineCap+o.lineDashOffset+"|"+o.lineWidth+o.lineJoin+o.miterLimit+"["+o.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.repeat||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?"string"==typeof i.fillStyle?i.fillStyle:"|"+(0,n.v6)(i.fillStyle):""}else this.text_="";this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}},dd=class{constructor(e,t,r,n){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=r,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const r=this.buildersByZIndex_[t];for(const n in r){const i=r[n].finish();e[t][n]=i}}return e}getBuilder(e,t){const r=void 0!==e?e.toString():"0";let n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);let i=n[t];return void 0===i&&(i=new(0,hd[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=i),i}};function pd(e,t,r,n,i,o,a,s,l,c,u,h,d=!0){let p=e[t],g=e[t+1],f=0,m=0,y=0,v=0;function A(){f=p,m=g,p=e[t+=n],g=e[t+1],v+=y,y=Math.sqrt((p-f)*(p-f)+(g-m)*(g-m))}do{A()}while(t<r-n&&v+y<o);let S=0===y?0:(o-v)/y;const E=(0,z.Cc)(f,p,S),w=(0,z.Cc)(m,g,S),_=t-n,L=v,C=o+s*l(c,i,u);for(;t<r-n&&v+y<C;)A();S=0===y?0:(C-v)/y;const b=(0,z.Cc)(f,p,S),T=(0,z.Cc)(m,g,S);let x=!1;if(d)if(h){const e=[E,w,b,T];(0,Ko.e$)(e,0,4,2,h,e,e),x=e[0]>e[2]}else x=E>b;const P=Math.PI,M=[],I=_+n===t;let R;if(y=0,v=L,p=e[t=_],g=e[t+1],I){A(),R=Math.atan2(g-m,p-f),x&&(R+=R>0?-P:P);const e=(b+E)/2,t=(T+w)/2;return M[0]=[e,t,(C-o)/2,R,i],M}for(let e=0,h=(i=i.replace(/\n/g," ")).length;e<h;){A();let d=Math.atan2(g-m,p-f);if(x&&(d+=d>0?-P:P),void 0!==R){let e=d-R;if(e+=e>P?-2*P:e<-P?2*P:0,Math.abs(e)>a)return null}R=d;const E=e;let w=0;for(;e<h;++e){const a=s*l(c,i[x?h-e-1:e],u);if(t+n<r&&v+y<o+w+a/2)break;w+=a}if(e===E)continue;const _=x?i.substring(h-E,h-e):i.substring(E,e);S=0===y?0:(o+w/2-v)/y;const L=(0,z.Cc)(f,p,S),C=(0,z.Cc)(m,g,S);M.push([L,C,w/2,d,_]),o+=w}return M}const gd=class{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(Ce(),{get:(e,t)=>{if("function"==typeof Ce()[t])return this.push_(t),this.pushMethodArgs_},set:(e,t,r)=>(this.push_(t,r),!0)})}push_(...e){const t=this.instructions_,r=this.zIndex+this.offset_;t[r]||(t[r]=[]),t[r].push(...e)}pushMethodArgs_=(...e)=>(this.push_(e),this);pushFunction(e){this.push_(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach((t=>{for(let r=0,n=t.length;r<n;++r){const n=t[r];if("function"==typeof n){n(e);continue}const i=t[++r];if("function"==typeof e[n])e[n](...i);else{if("function"==typeof i){e[n]=i(e);continue}e[n]=i}}}))}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}},fd=(0,ee.S5)(),md=[],yd=[],vd=[],Ad=[];function Sd(e){return e[3].declutterBox}const Ed=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function wd(e,t){return"start"===t?t=Ed.test(e)?"right":"left":"end"===t&&(t=Ed.test(e)?"left":"right"),ud[t]}function _d(e,t,r){return r>0&&e.push("\n",""),e.push(t,""),e}function Ld(e,t,r){return r%2==0&&(e+=t),e}const Cd=class{constructor(e,t,r,n,i){this.overlaps=r,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=(0,So.vt)(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=i?new gd:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,r,n){const i=e+t+r+n;if(this.labels_[i])return this.labels_[i];const o=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,s=this.textStates[t],l=this.pixelRatio,c=[s.scale[0]*l,s.scale[1]*l],u=s.justify?ud[s.justify]:wd(Array.isArray(e)?e[0]:e,s.textAlign||gi),h=n&&o.lineWidth?o.lineWidth:0,d=Array.isArray(e)?e:String(e).split("\n").reduce(_d,[]),{width:p,height:g,widths:f,heights:m,lineWidths:y}=function(e,t){const r=[],n=[],i=[];let o=0,a=0,s=0,l=0;for(let c=0,u=t.length;c<=u;c+=2){const h=t[c];if("\n"===h||c===u){o=Math.max(o,a),i.push(a),a=0,s+=l,l=0;continue}const d=t[c+1]||e.font,p=Li(d,h);r.push(p),a+=p;const g=wi(d);n.push(g),l=Math.max(l,g)}return{width:o,height:s,widths:r,heights:n,lineWidths:i}}(s,d),v=p+h,A=[],S=(v+2)*c[0],E=(g+h)*c[1],w={width:S<0?Math.floor(S):Math.ceil(S),height:E<0?Math.floor(E):Math.ceil(E),contextInstructions:A};1==c[0]&&1==c[1]||A.push("scale",c),n&&(A.push("strokeStyle",o.strokeStyle),A.push("lineWidth",h),A.push("lineCap",o.lineCap),A.push("lineJoin",o.lineJoin),A.push("miterLimit",o.miterLimit),A.push("setLineDash",[o.lineDash]),A.push("lineDashOffset",o.lineDashOffset)),r&&A.push("fillStyle",a.fillStyle),A.push("textBaseline","middle"),A.push("textAlign","center");const _=.5-u;let L=u*v+_*h;const C=[],b=[];let T,x=0,P=0,M=0,I=0;for(let e=0,t=d.length;e<t;e+=2){const t=d[e];if("\n"===t){P+=x,x=0,L=u*v+_*h,++I;continue}const i=d[e+1]||s.font;i!==T&&(n&&C.push("font",i),r&&b.push("font",i),T=i),x=Math.max(x,m[M]);const o=[t,L+_*f[M]+u*(f[M]-y[I]),.5*(h+x)+P];L+=f[M],n&&C.push("strokeText",o),r&&b.push("fillText",o),++M}return Array.prototype.push.apply(A,C),Array.prototype.push.apply(A,b),this.labels_[i]=w,w}replayTextBackground_(e,t,r,n,i,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,r),e.lineTo.apply(e,n),e.lineTo.apply(e,i),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],e.fillStyle=o[1],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,r,n,i,o,a,s,l,c,u,h,d,p,g,f){let m=r-(a*=h[0]),y=n-(s*=h[1]);const v=i+l>e?e-l:i,A=o+c>t?t-c:o,S=p[3]+v*h[0]+p[1],E=p[0]+A*h[1]+p[2],w=m-p[3],_=y-p[0];let L;return(g||0!==u)&&(md[0]=w,Ad[0]=w,md[1]=_,yd[1]=_,yd[0]=w+S,vd[0]=yd[0],vd[1]=_+E,Ad[1]=vd[1]),0!==u?(L=(0,So.Zz)((0,So.vt)(),r,n,1,1,u,-r,-n),(0,So.Bb)(L,md),(0,So.Bb)(L,yd),(0,So.Bb)(L,vd),(0,So.Bb)(L,Ad),(0,ee.N)(Math.min(md[0],yd[0],vd[0],Ad[0]),Math.min(md[1],yd[1],vd[1],Ad[1]),Math.max(md[0],yd[0],vd[0],Ad[0]),Math.max(md[1],yd[1],vd[1],Ad[1]),fd)):(0,ee.N)(Math.min(w,w+S),Math.min(_,_+E),Math.max(w,w+S),Math.max(_,_+E),fd),d&&(m=Math.round(m),y=Math.round(y)),{drawImageX:m,drawImageY:y,drawImageW:v,drawImageH:A,originX:l,originY:c,declutterBox:{minX:fd[0],minY:fd[1],maxX:fd[2],maxY:fd[3],value:f},canvasTransform:L,scale:h}}replayImageOrLabel_(e,t,r,n,i,o,a){const s=!(!o&&!a),l=n.declutterBox,c=a?a[2]*n.scale[0]/2:0;return l.minX-c<=t[0]&&l.maxX+c>=0&&l.minY-c<=t[1]&&l.maxY+c>=0&&(s&&this.replayTextBackground_(e,md,yd,vd,Ad,o,a),function(e,t,r,n,i,o,a,s,l,c,u){e.save(),1!==r&&(void 0===e.globalAlpha?e.globalAlpha=e=>e.globalAlpha*=r:e.globalAlpha*=r),t&&e.transform.apply(e,t),n.contextInstructions?(e.translate(l,c),e.scale(u[0],u[1]),function(e,t){const r=e.contextInstructions;for(let e=0,n=r.length;e<n;e+=2)Array.isArray(r[e+1])?t[r[e]].apply(t,r[e+1]):t[r[e]]=r[e+1]}(n,e)):u[0]<0||u[1]<0?(e.translate(l,c),e.scale(u[0],u[1]),e.drawImage(n,i,o,a,s,0,0,a,s)):e.drawImage(n,i,o,a,s,l,c,a*u[0],s*u[1]),e.restore()}(e,n.canvasTransform,i,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const r=(0,So.Bb)(this.renderedTransform_,[0,0]),n=512*this.pixelRatio;e.save(),e.translate(r[0]%n,r[1]%n),1!==t&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,r,n){const i=this.textStates[t],o=this.createLabel(e,t,n,r),a=this.strokeStates[r],s=this.pixelRatio,l=wd(Array.isArray(e)?e[0]:e,i.textAlign||gi),c=ud[i.textBaseline||fi],u=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:l*(o.width/s-2*i.scale[0])+2*(.5-l)*u,anchorY:c*o.height/s+2*(.5-c)*u}}execute_(e,t,r,n,i,o,a,s){const l=this.zIndexContext_;let c;this.pixelCoordinates_&&(0,V.aI)(r,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=(0,Ko.Rc)(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),(0,So.k3)(this.renderedTransform_,r));let u=0;const h=n.length;let d,p,g,f,m,y,v,A,S,E,w,_,L,C=0,b=0,T=0;const x=this.coordinateCache_,P=this.viewRotation_,M=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,I={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},R=this.instructions!=n||this.overlaps?0:200;let O,D,N,k;for(;u<h;){const r=n[u];switch(r[0]){case id.BEGIN_GEOMETRY:O=r[1],k=r[3],O.getGeometry()?void 0===a||(0,ee.HY)(a,k.getExtent())?++u:u=r[2]+1:u=r[2],l&&(l.zIndex=r[4]);break;case id.BEGIN_PATH:b>R&&(this.fill_(e),b=0),T>R&&(e.stroke(),T=0),b||T||(e.beginPath(),m=NaN,y=NaN),++u;break;case id.CIRCLE:C=r[1];const n=c[C],h=c[C+1],F=c[C+2]-n,G=c[C+3]-h,B=Math.sqrt(F*F+G*G);e.moveTo(n+B,h),e.arc(n,h,B,0,2*Math.PI,!0),++u;break;case id.CLOSE_PATH:e.closePath(),++u;break;case id.CUSTOM:C=r[1],d=r[2];const U=r[3],q=r[4],W=r[5];I.geometry=U,I.feature=O,u in x||(x[u]=[]);const H=x[u];W?W(c,C,d,2,H):(H[0]=c[C],H[1]=c[C+1],H.length=2),l&&(l.zIndex=r[6]),q(H,I),++u;break;case id.DRAW_IMAGE:C=r[1],d=r[2],S=r[3],p=r[4],g=r[5];let j=r[6];const V=r[7],z=r[8],Y=r[9],$=r[10];let K=r[11];const X=r[12];let Z=r[13];f=r[14]||"declutter";const J=r[15];if(!S&&r.length>=20){E=r[19],w=r[20],_=r[21],L=r[22];const e=this.drawLabelWithPointPlacement_(E,w,_,L);S=e.label,r[3]=S;const t=r[23];p=(e.anchorX-t)*this.pixelRatio,r[4]=p;const n=r[24];g=(e.anchorY-n)*this.pixelRatio,r[5]=g,j=S.height,r[6]=j,Z=S.width,r[13]=Z}let Q,te,re,ne;r.length>25&&(Q=r[25]),r.length>17?(te=r[16],re=r[17],ne=r[18]):(te=mi,re=null,ne=null),$&&M?K+=P:$||M||(K-=P);let ie=0;for(;C<d;C+=2){if(Q&&Q[ie++]<Z/this.pixelRatio)continue;const r=this.calculateImageOrLabelDimensions_(S.width,S.height,c[C],c[C+1],Z,j,p,g,z,Y,K,X,i,te,!!re||!!ne,O),n=[e,t,S,r,V,re,ne];if(s){let e,t,i,o,a;if(J){const r=d-C;if(!J[r]){J[r]={args:n,declutterMode:f};continue}const o=J[r];e=o.args,t=o.declutterMode,delete J[r],i=Sd(e)}if(!e||"declutter"===t&&s.collides(i)||(o=!0),"declutter"===f&&s.collides(r.declutterBox)||(a=!0),"declutter"===t&&"declutter"===f){const e=o&&a;o=e,a=e}o&&("none"!==t&&s.insert(i),this.replayImageOrLabel_.apply(this,e)),a&&("none"!==f&&s.insert(r.declutterBox),this.replayImageOrLabel_.apply(this,n))}else this.replayImageOrLabel_.apply(this,n)}++u;break;case id.DRAW_CHARS:const oe=r[1],ae=r[2],se=r[3],le=r[4];L=r[5];const ce=r[6],ue=r[7],he=r[8];_=r[9];const de=r[10];E=r[11],Array.isArray(E)&&(E=E.reduce(Ld,"")),w=r[12];const pe=[r[13],r[13]];f=r[14]||"declutter";const ge=r[15],fe=this.textStates[w],me=fe.font,ye=[fe.scale[0]*ue,fe.scale[1]*ue];let ve;me in this.widths_?ve=this.widths_[me]:(ve={},this.widths_[me]=ve);const Ae=(0,ea.k)(c,oe,ae,2),Se=Math.abs(ye[0])*Ci(me,E,ve);if(le||Se<=Ae){const r=pd(c,oe,ae,2,E,(Ae-Se)*wd(E,this.textStates[w].textAlign),ce,Math.abs(ye[0]),Ci,me,ve,M?0:this.viewRotation_,ge);e:if(r){const n=[];let i,o,a,l,c;if(_)for(i=0,o=r.length;i<o;++i){c=r[i],a=c[4],l=this.createLabel(a,w,"",_),p=c[2]+(ye[0]<0?-de:de),g=se*l.height+2*(.5-se)*de*ye[1]/ye[0]-he;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,p,g,0,0,c[3],pe,!1,mi,!1,O);if(s&&"declutter"===f&&s.collides(o.declutterBox))break e;n.push([e,t,l,o,1,null,null])}if(L)for(i=0,o=r.length;i<o;++i){c=r[i],a=c[4],l=this.createLabel(a,w,L,""),p=c[2],g=se*l.height-he;const o=this.calculateImageOrLabelDimensions_(l.width,l.height,c[0],c[1],l.width,l.height,p,g,0,0,c[3],pe,!1,mi,!1,O);if(s&&"declutter"===f&&s.collides(o.declutterBox))break e;n.push([e,t,l,o,1,null,null])}s&&"none"!==f&&s.load(n.map(Sd));for(let e=0,t=n.length;e<t;++e)this.replayImageOrLabel_.apply(this,n[e])}}++u;break;case id.END_GEOMETRY:if(void 0!==o){O=r[1];const e=o(O,k,f);if(e)return e}++u;break;case id.FILL:R?b++:this.fill_(e),++u;break;case id.MOVE_TO_LINE_TO:for(C=r[1],d=r[2],D=c[C],N=c[C+1],e.moveTo(D,N),m=D+.5|0,y=N+.5|0,C+=2;C<d;C+=2)D=c[C],N=c[C+1],v=D+.5|0,A=N+.5|0,C!=d-2&&v===m&&A===y||(e.lineTo(D,N),m=v,y=A);++u;break;case id.SET_FILL_STYLE:this.alignAndScaleFill_=r[2],b&&(this.fill_(e),b=0,T&&(e.stroke(),T=0)),e.fillStyle=r[1],++u;break;case id.SET_STROKE_STYLE:T&&(e.stroke(),T=0),this.setStrokeStyle_(e,r),++u;break;case id.STROKE:R?T++:e.stroke(),++u;break;default:++u}}b&&this.fill_(e),T&&e.stroke()}execute(e,t,r,n,i,o){this.viewRotation_=n,this.execute_(e,t,r,this.instructions,i,void 0,void 0,o)}executeHitDetection(e,t,r,n,i){return this.viewRotation_=r,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,n,i)}},bd=["Polygon","Circle","LineString","Image","Text","Default"],Td=["Image","Text"],xd=bd.filter((e=>!Td.includes(e))),Pd={},Md=class{constructor(e,t,r,n,i,o,a){this.maxExtent_=e,this.overlaps_=n,this.pixelRatio_=r,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,So.vt)(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(i,a)}clip(e,t){const r=this.getClipCoords(t);e.beginPath(),e.moveTo(r[0],r[1]),e.lineTo(r[2],r[3]),e.lineTo(r[4],r[5]),e.lineTo(r[6],r[7]),e.clip()}createExecutors_(e,t){for(const r in e){let n=this.executorsByZIndex_[r];void 0===n&&(n={},this.executorsByZIndex_[r]=n);const i=e[r];for(const e in i){const r=i[e];n[e]=new Cd(this.resolution_,this.pixelRatio_,this.overlaps_,r,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const r=this.executorsByZIndex_[t];for(let t=0,n=e.length;t<n;++t)if(e[t]in r)return!0}return!1}forEachFeatureAtCoordinate(e,t,r,n,i,o){const a=2*(n=Math.round(n))+1,s=(0,So.Zz)(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-r,-e[0],-e[1]),l=!this.hitDetectionContext_;l&&(this.hitDetectionContext_=_e(a,a));const c=this.hitDetectionContext_;let u;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):l||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(u=(0,ee.S5)(),(0,ee.$C)(u,e),(0,ee.r)(u,t*(this.renderBuffer_+n),u));const h=function(e){if(void 0!==Pd[e])return Pd[e];const t=2*e+1,r=e*e,n=new Array(r+1);for(let i=0;i<=e;++i)for(let o=0;o<=e;++o){const a=i*i+o*o;if(a>r)break;let s=n[a];s||(s=[],n[a]=s),s.push(4*((e+i)*t+(e+o))+3),i>0&&s.push(4*((e-i)*t+(e+o))+3),o>0&&(s.push(4*((e+i)*t+(e-o))+3),i>0&&s.push(4*((e-i)*t+(e-o))+3))}const i=[];for(let e=0,t=n.length;e<t;++e)n[e]&&i.push(...n[e]);return Pd[e]=i,i}(n);let d;function p(e,t,r){const s=c.getImageData(0,0,a,a).data;for(let l=0,u=h.length;l<u;l++)if(s[h[l]]>0){if(!o||"none"===r||"Image"!==d&&"Text"!==d||o.includes(e)){const r=(h[l]-3)/4,o=n-r%a,s=n-(r/a|0),c=i(e,t,o*o+s*s);if(c)return c}c.clearRect(0,0,a,a);break}}const g=Object.keys(this.executorsByZIndex_).map(Number);let f,m,y,v,A;for(g.sort(V.V_),f=g.length-1;f>=0;--f){const e=g[f].toString();for(y=this.executorsByZIndex_[e],m=bd.length-1;m>=0;--m)if(d=bd[m],v=y[d],void 0!==v&&(A=v.executeHitDetection(c,s,r,p,u),A))return A}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const r=t[0],n=t[1],i=t[2],o=t[3],a=[r,n,r,o,i,o,i,n];return(0,Ko.Rc)(a,0,8,2,e,a),a}isEmpty(){return(0,U.p)(this.executorsByZIndex_)}execute(e,t,r,n,i,o,a){const s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(a?V.rG:V.V_),o=o||bd;const l=bd.length;for(let c=0,u=s.length;c<u;++c){const u=s[c].toString(),h=this.executorsByZIndex_[u];for(let u=0,d=o.length;u<d;++u){const d=o[u],p=h[d];if(void 0!==p){const o=null===a?void 0:p.getZIndexContext(),h=o?o.getContext():e,g=this.maxExtent_&&"Image"!==d&&"Text"!==d;if(g&&(h.save(),this.clip(h,r)),o&&"Text"!==d&&"Image"!==d?o.pushFunction((e=>p.execute(e,t,r,n,i,a))):p.execute(h,t,r,n,i,a),g&&h.restore(),o){o.offset();const e=s[c]*l+u;this.deferredZIndexContexts_[e]||(this.deferredZIndexContexts_[e]=[]),this.deferredZIndexContexts_[e].push(o)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(V.V_);for(let r=0,n=t.length;r<n;++r)e[t[r]].forEach((e=>{e.draw(this.renderedContext_),e.clear()})),e[t[r]].length=0}},Id=class extends Jh{constructor(e,t,r,n,i,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=r,this.transform_=n,this.transformRotation_=n?(0,z.Mg)(Math.atan2(n[1],n[0]),10):0,this.viewRotation_=i,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=(0,So.vt)()}drawImages_(e,t,r,n){if(!this.image_)return;const i=(0,Ko.Rc)(e,t,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);let l=this.imageRotation_;0===this.transformRotation_&&(l-=this.viewRotation_),this.imageRotateWithView_&&(l+=this.viewRotation_);for(let e=0,t=i.length;e<t;e+=2){const t=i[e]-this.imageAnchorX_,r=i[e+1]-this.imageAnchorY_;if(0!==l||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const e=t+this.imageAnchorX_,n=r+this.imageAnchorY_;(0,So.Zz)(a,e,n,1,1,l,-e,-n),o.save(),o.transform.apply(o,a),o.translate(e,n),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,t,r,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=s)}drawText_(e,t,r,n){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const i=(0,Ko.Rc)(e,t,r,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(0===this.transformRotation_&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<r;t+=n){const e=i[t]+this.textOffsetX_,r=i[t+1]+this.textOffsetY_;0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]?(o.save(),o.translate(e-this.textOffsetX_,r-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,e,r),this.textFillState_&&o.fillText(this.text_,e,r))}}moveToLineTo_(e,t,r,n,i){const o=this.context_,a=(0,Ko.Rc)(e,t,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let s=a.length;i&&(s-=2);for(let e=2;e<s;e+=2)o.lineTo(a[e],a[e+1]);return i&&o.closePath(),r}drawRings_(e,t,r,n){for(let i=0,o=r.length;i<o;++i)t=this.moveToLineTo_(e,t,r[i],n,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ee.HY)(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=(0,Yo.v7)(e,this.transform_,this.pixelCoordinates_),r=t[2]-t[0],n=t[3]-t[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(t[0],t[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e)}}drawFeature(e,t){const r=t.getGeometryFunction()(e);r&&(this.setStyle(t),this.drawGeometry(r))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let e=0,r=t.length;e<r;++e)this.drawGeometry(t[e])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),""!==this.text_&&this.drawText_(t,0,t.length,r)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),r=e.getStride();this.image_&&this.drawImages_(t,0,t.length,r),""!==this.text_&&this.drawText_(t,0,t.length,r)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ee.HY)(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,r=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(r,0,r.length,e.getStride(),!1),t.stroke()}if(""!==this.text_){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if((0,ee.HY)(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,r=e.getFlatCoordinates();let n=0;const i=e.getEnds(),o=e.getStride();t.beginPath();for(let e=0,t=i.length;e<t;++e)n=this.moveToLineTo_(r,n,i[e],o,!1);t.stroke()}if(""!==this.text_){const t=e.getFlatMidpoints();this.drawText_(t,0,t.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ee.HY)(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ee.HY)(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,r=e.getOrientedFlatCoordinates();let n=0;const i=e.getEndss(),o=e.getStride();t.beginPath();for(let e=0,t=i.length;e<t;++e){const t=i[e];n=this.drawRings_(r,n,t,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(""!==this.text_){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,r=this.contextFillState_;r?r.fillStyle!=e.fillStyle&&(r.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=e.lineCap&&(r.lineCap=e.lineCap,t.lineCap=e.lineCap),(0,V.aI)(r.lineDash,e.lineDash)||t.setLineDash(r.lineDash=e.lineDash),r.lineDashOffset!=e.lineDashOffset&&(r.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),r.lineJoin!=e.lineJoin&&(r.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),r.lineWidth!=e.lineWidth&&(r.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),r.miterLimit!=e.miterLimit&&(r.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),r.strokeStyle!=e.strokeStyle&&(r.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,r=this.contextTextState_,n=e.textAlign?e.textAlign:gi;r?(r.font!=e.font&&(r.font=e.font,t.font=e.font),r.textAlign!=n&&(r.textAlign=n,t.textAlign=n),r.textBaseline!=e.textBaseline&&(r.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=n,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:n,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(e){const t=e.getColor();this.fillState_={fillStyle:si(t||ci)}}else this.fillState_=null;if(t){const e=t.getColor(),r=t.getLineCap(),n=t.getLineDash(),i=t.getLineDashOffset(),o=t.getLineJoin(),a=t.getWidth(),s=t.getMiterLimit(),l=n||hi;this.strokeState_={lineCap:void 0!==r?r:ui,lineDash:1===this.pixelRatio_?l:l.map((e=>e*this.pixelRatio_)),lineDashOffset:(i||0)*this.pixelRatio_,lineJoin:void 0!==o?o:di,lineWidth:(void 0!==a?a:1)*this.pixelRatio_,miterLimit:void 0!==s?s:10,strokeStyle:si(e||pi)}}else this.strokeState_=null}setImageStyle(e){let t;if(!e||!(t=e.getSize()))return void(this.image_=null);const r=e.getPixelRatio(this.pixelRatio_),n=e.getAnchor(),i=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*r,this.imageAnchorY_=n[1]*r,this.imageHeight_=t[1]*r,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=i[0],this.imageOriginY_=i[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/r,o[1]*this.pixelRatio_/r],this.imageWidth_=t[0]*r}setTextStyle(e){if(e){const t=e.getFill();if(t){const e=t.getColor();this.textFillState_={fillStyle:si(e||ci)}}else this.textFillState_=null;const r=e.getStroke();if(r){const e=r.getColor(),t=r.getLineCap(),n=r.getLineDash(),i=r.getLineDashOffset(),o=r.getLineJoin(),a=r.getWidth(),s=r.getMiterLimit();this.textStrokeState_={lineCap:void 0!==t?t:ui,lineDash:n||hi,lineDashOffset:i||0,lineJoin:void 0!==o?o:di,lineWidth:void 0!==a?a:1,miterLimit:void 0!==s?s:10,strokeStyle:si(e||pi)}}else this.textStrokeState_=null;const n=e.getFont(),i=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),s=e.getRotation(),l=e.getScaleArray(),c=e.getText(),u=e.getTextAlign(),h=e.getTextBaseline();this.textState_={font:void 0!==n?n:li,textAlign:void 0!==u?u:gi,textBaseline:void 0!==h?h:fi},this.text_=void 0!==c?Array.isArray(c)?c.reduce(((e,t,r)=>e+(r%2?" ":t)),""):c:"",this.textOffsetX_=void 0!==i?this.pixelRatio_*i:0,this.textOffsetY_=void 0!==o?this.pixelRatio_*o:0,this.textRotateWithView_=void 0!==a&&a,this.textRotation_=void 0!==s?s:0,this.textScale_=[this.pixelRatio_*l[0],this.pixelRatio_*l[1]]}else this.text_=""}},Rd=.5,Od={Point:function(e,t,r,n,i,o){const a=r.getImage(),s=r.getText(),l=s&&s.getText(),c=o&&a&&l?{}:void 0;if(a){if(2!=a.getImageState())return;const o=e.getBuilder(r.getZIndex(),"Image");o.setImageStyle(a,c),o.drawPoint(t,n,i)}if(l){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(s,c),o.drawText(t,n,i)}},LineString:function(e,t,r,n,i){const o=r.getStroke();if(o){const a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawLineString(t,n,i)}const a=r.getText();if(a&&a.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,i)}},Polygon:function(e,t,r,n,i){const o=r.getFill(),a=r.getStroke();if(o||a){const s=e.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawPolygon(t,n,i)}const s=r.getText();if(s&&s.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(s),o.drawText(t,n,i)}},MultiPoint:function(e,t,r,n,i,o){const a=r.getImage(),s=a&&0!==a.getOpacity(),l=r.getText(),c=l&&l.getText(),u=o&&s&&c?{}:void 0;if(s){if(2!=a.getImageState())return;const o=e.getBuilder(r.getZIndex(),"Image");o.setImageStyle(a,u),o.drawMultiPoint(t,n,i)}if(c){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(l,u),o.drawText(t,n,i)}},MultiLineString:function(e,t,r,n,i){const o=r.getStroke();if(o){const a=e.getBuilder(r.getZIndex(),"LineString");a.setFillStrokeStyle(null,o),a.drawMultiLineString(t,n,i)}const a=r.getText();if(a&&a.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,i)}},MultiPolygon:function(e,t,r,n,i){const o=r.getFill(),a=r.getStroke();if(a||o){const s=e.getBuilder(r.getZIndex(),"Polygon");s.setFillStrokeStyle(o,a),s.drawMultiPolygon(t,n,i)}const s=r.getText();if(s&&s.getText()){const o=e.getBuilder(r.getZIndex(),"Text");o.setTextStyle(s),o.drawText(t,n,i)}},GeometryCollection:function(e,t,r,n,i,o){const a=t.getGeometriesArray();let s,l;for(s=0,l=a.length;s<l;++s)(0,Od[a[s].getType()])(e,a[s],r,n,i,o)},Circle:function(e,t,r,n,i){const o=r.getFill(),a=r.getStroke();if(o||a){const s=e.getBuilder(r.getZIndex(),"Circle");s.setFillStrokeStyle(o,a),s.drawCircle(t,n,i)}const s=r.getText();if(s&&s.getText()){const i=e.getBuilder(r.getZIndex(),"Text");i.setTextStyle(s),i.drawText(t,n)}}};function Dd(e,t){return parseInt((0,n.v6)(e),10)-parseInt((0,n.v6)(t),10)}function Nd(e,t){const r=kd(e,t);return r*r}function kd(e,t){return.5*e/t}function Fd(e,t,r,n,i,o,a,s){const l=[],c=r.getImage();if(c){let e=!0;const t=c.getImageState();2==t||3==t?e=!1:0==t&&c.load(),e&&l.push(c.ready())}const u=r.getFill();u&&u.loading()&&l.push(u.ready());const h=l.length>0;return h&&Promise.all(l).then((()=>i(null))),function(e,t,r,n,i,o,a){const s=r.getGeometryFunction()(t);if(!s)return;const l=s.simplifyTransformed(n,i);r.getRenderer()?Gd(e,l,r,t,a):(0,Od[l.getType()])(e,l,r,t,a,o)}(e,t,r,n,o,a,s),h}function Gd(e,t,r,n,i){if("GeometryCollection"!=t.getType())e.getBuilder(r.getZIndex(),"Default").drawCustom(t,n,r.getRenderer(),r.getHitDetectionRenderer(),i);else{const o=t.getGeometries();for(let t=0,a=o.length;t<a;++t)Gd(e,o[t],r,n,i)}}var Bd=r(1854);class Ud extends Bd.A{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e,this.staleKeys_=new Array,this.maxStaleKeys=5}getStaleKeys(){return this.staleKeys_}prependStaleKey(e){this.staleKeys_.unshift(e),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(e){return(0,n.b0)()}getData(e){return null}prepareFrame(e){return(0,n.b0)()}renderFrame(e,t){return(0,n.b0)()}forEachFeatureAtCoordinate(e,t,r,n,i){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;2!==t.getState()&&3!==t.getState()||this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return 2!=t&&3!=t&&e.addEventListener(f.A.CHANGE,this.boundHandleImageChange_),0==t&&(e.load(),t=e.getState()),2==t}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&"ready"===e.getSourceState()&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}const qd=Ud,Wd=[];let Hd=null;const jd=class extends qd{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=(0,So.vt)(),this.pixelTransform=(0,So.vt)(),this.inversePixelTransform=(0,So.vt)(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(e,t,r){let n;Hd||(Hd=_e(1,1,void 0,{willReadFrequently:!0})),Hd.clearRect(0,0,1,1);try{Hd.drawImage(e,t,r,1,1,0,0,1,1),n=Hd.getImageData(0,0,1,1).data}catch{return Hd=null,null}return n}getBackground(e){let t=this.getLayer().getBackground();return"function"==typeof t&&(t=t(e.viewState.resolution)),t||void 0}useContainer(e,t,r){const n=this.getLayer().getClassName();let i,o;if(e&&e.className===n&&(!r||e&&e.style.backgroundColor&&(0,V.aI)(wr(e.style.backgroundColor),wr(r)))){const t=e.firstElementChild;t instanceof HTMLCanvasElement&&(o=t.getContext("2d"))}if(o&&(0,So.tI)(o.canvas.style.transform,t)?(this.container=e,this.context=o,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){i=document.createElement("div"),i.className=n;let e=i.style;e.position="absolute",e.width="100%",e.height="100%",o=_e();const t=o.canvas;i.appendChild(t),e=t.style,e.position="absolute",e.left="0",e.transformOrigin="top left",this.container=i,this.context=o}this.containerReused||!r||this.container.style.backgroundColor||(this.container.style.backgroundColor=r)}clipUnrotated(e,t,r){const n=(0,ee.Py)(r),i=(0,ee.WU)(r),o=(0,ee.k_)(r),a=(0,ee.R)(r);(0,So.Bb)(t.coordinateToPixelTransform,n),(0,So.Bb)(t.coordinateToPixelTransform,i),(0,So.Bb)(t.coordinateToPixelTransform,o),(0,So.Bb)(t.coordinateToPixelTransform,a);const s=this.inversePixelTransform;(0,So.Bb)(s,n),(0,So.Bb)(s,i),(0,So.Bb)(s,o),(0,So.Bb)(s,a),e.save(),e.beginPath(),e.moveTo(Math.round(n[0]),Math.round(n[1])),e.lineTo(Math.round(i[0]),Math.round(i[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.clip()}prepareContainer(e,t){const r=e.extent,n=e.viewState.resolution,i=e.viewState.rotation,o=e.pixelRatio,a=Math.round((0,ee.RG)(r)/n*o),s=Math.round((0,ee.Oq)(r)/n*o);(0,So.Zz)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/o,1/o,i,-a/2,-s/2),(0,So.T9)(this.inversePixelTransform,this.pixelTransform);const l=(0,So.dI)(this.pixelTransform);if(this.useContainer(t,l,this.getBackground(e)),!this.containerReused){const e=this.context.canvas;e.width!=a||e.height!=s?(e.width=a,e.height=s):this.context.clearRect(0,0,a,s),l!==e.style.transform&&(e.style.transform=l)}}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){const i=new Ao(e,this.inversePixelTransform,r,t);n.dispatchEvent(i)}}preRender(e,t){this.frameState=t,t.declutter||this.dispatchRenderEvent_(Ft.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(Ft.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new gd),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(Ft.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(Ft.POSTRENDER,this.context,e))}getRenderTransform(e,t,r,n,i,o,a){const s=i/2,l=o/2,c=n/t,u=-c,h=-e[0]+a,d=-e[1];return(0,So.Zz)(this.tempTransform,s,l,c,u,-r,h,d)}disposeInternal(){delete this.frameState,super.disposeInternal()}},Vd=class extends jd{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,ee.S5)(),this.wrappedRenderedExtent_=(0,ee.S5)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,r){const n=t.extent,i=t.viewState,o=i.center,a=i.resolution,s=i.projection,l=i.rotation,c=s.getExtent(),u=this.getLayer().getSource(),h=this.getLayer().getDeclutter(),d=t.pixelRatio,p=t.viewHints,g=!(p[0]||p[1]),f=this.context,m=Math.round((0,ee.RG)(n)/a*d),y=Math.round((0,ee.Oq)(n)/a*d),v=u.getWrapX()&&s.canWrapX(),A=v?(0,ee.RG)(c):null,S=v?Math.ceil((n[2]-c[2])/A)+1:1;let E=v?Math.floor((n[0]-c[0])/A):0;do{let n=this.getRenderTransform(o,a,0,d,m,y,E*A);t.declutter&&(n=n.slice(0)),e.execute(f,[f.canvas.width,f.canvas.height],n,l,g,void 0===r?bd:r?Td:xd,r?h&&t.declutter[h]:void 0)}while(++E<S)}setDrawContext_(){1!==this.opacity_&&(this.targetContext_=this.context,this.context=_e(this.context.canvas.width,this.context.canvas.height,Wd))}resetDrawContext_(){if(1!==this.opacity_){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,be(this.context),Wd.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){this.replayGroup_&&this.getLayer().getDeclutter()&&this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const r=e.layerStatesArray[e.layerIndex];this.opacity_=r.opacity;const n=e.viewState;this.prepareContainer(e,t);const i=this.context,o=this.replayGroup_;let a=o&&!o.isEmpty();if(!a&&!this.getLayer().hasListener(Ft.PRERENDER)&&!this.getLayer().hasListener(Ft.POSTRENDER))return this.container;this.setDrawContext_(),this.preRender(i,e);const s=n.projection;if(this.clipped_=!1,a&&r.extent&&this.clipping){const t=(0,ne.SD)(r.extent,s);a=(0,ee.HY)(t,e.extent),this.clipped_=a&&!(0,ee.ms)(t,e.extent),this.clipped_&&this.clipUnrotated(i,e,t)}return a&&this.renderWorlds(o,e,!this.getLayer().getDeclutter()&&void 0),!e.declutter&&this.clipped_&&i.restore(),this.postRender(i,e),this.renderedRotation_!==n.rotation&&(this.renderedRotation_=n.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise((t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const e=this.frameState.size.slice(),t=this.renderedCenter_,r=this.renderedResolution_,n=this.renderedRotation_,i=this.renderedProjection_,o=this.wrappedRenderedExtent_,a=this.getLayer(),s=[],l=e[0]*Rd,c=e[1]*Rd;s.push(this.getRenderTransform(t,r,n,Rd,l,c,0).slice());const u=a.getSource(),h=i.getExtent();if(u.getWrapX()&&i.canWrapX()&&!(0,ee.ms)(h,o)){let e=o[0];const i=(0,ee.RG)(h);let a,u=0;for(;e<h[0];)--u,a=i*u,s.push(this.getRenderTransform(t,r,n,Rd,l,c,a).slice()),e+=i;for(u=0,e=o[2];e>h[2];)++u,a=i*u,s.push(this.getRenderTransform(t,r,n,Rd,l,c,a).slice()),e-=i}const d=(0,ne.Tf)();this.hitDetectionImageData_=function(e,t,r,n,i,o,a,s,l){const c=l?(0,ne.JR)(i,l):i,u=_e(e[0]*Rd,e[1]*Rd);u.imageSmoothingEnabled=!1;const h=u.canvas,d=new Id(u,Rd,i,null,a,s,l?(0,ne.FO)((0,ne.Tf)(),l):null),p=r.length,g=Math.floor(16777215/p),f={};for(let e=1;e<=p;++e){const t=r[e-1],i=t.getStyleFunction()||n;if(!i)continue;let a=i(t,o);if(!a)continue;Array.isArray(a)||(a=[a]);const s=(e*g).toString(16).padStart(7,"#00000");for(let e=0,r=a.length;e<r;++e){const r=a[e],n=r.getGeometryFunction()(t);if(!n||!(0,ee.HY)(c,n.getExtent()))continue;const i=r.clone(),o=i.getFill();o&&o.setColor(s);const l=i.getStroke();l&&(l.setColor(s),l.setLineDash(null)),i.setText(void 0);const u=r.getImage();if(u){const e=u.getImageSize();if(!e)continue;const t=_e(e[0],e[1],void 0,{alpha:!1}),r=t.canvas;t.fillStyle=s,t.fillRect(0,0,r.width,r.height),i.setImage(new ki({img:r,anchor:u.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:u.getOrigin(),opacity:1,size:u.getSize(),scale:u.getScale(),rotation:u.getRotation(),rotateWithView:u.getRotateWithView()}))}const h=i.getZIndex()||0;let d=f[h];d||(d={},f[h]=d,d.Polygon=[],d.Circle=[],d.LineString=[],d.Point=[]);const p=n.getType();if("GeometryCollection"===p){const e=n.getGeometriesArrayRecursive();for(let t=0,r=e.length;t<r;++t){const r=e[t];d[r.getType().replace("Multi","")].push(r,i)}}else d[p.replace("Multi","")].push(n,i)}}const m=Object.keys(f).map(Number).sort(V.V_);for(let e=0,r=m.length;e<r;++e){const r=f[m[e]];for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e+=2){d.setStyle(n[e+1]);for(let r=0,i=t.length;r<i;++r)d.setTransform(t[r]),d.drawGeometry(n[e])}}}return u.getImageData(0,0,h.width,h.height)}(e,s,this.renderedFeatures_,a.getStyleFunction(),o,r,n,Nd(r,this.renderedPixelRatio_),d?i:null)}t(function(e,t,r){const n=[];if(r){const i=Math.floor(Math.round(e[0])*Rd),o=Math.floor(Math.round(e[1])*Rd),a=4*((0,z.qE)(i,0,r.width-1)+(0,z.qE)(o,0,r.height-1)*r.width),s=r.data[a],l=r.data[a+1],c=r.data[a+2]+256*(l+256*s),u=Math.floor(16777215/t.length);c&&c%u==0&&n.push(t[c/u-1])}return n}(e,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(e,t,r,i,o){if(!this.replayGroup_)return;const a=t.viewState.resolution,s=t.viewState.rotation,l=this.getLayer(),c={},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(e,a,s,r,(function(e,t,r){const a=(0,n.v6)(e),s=c[a];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return c[a]=!0,o.splice(o.lastIndexOf(s),1),i(e,l,t);s.geometry=t,s.distanceSq=r}}else{if(0===r)return c[a]=!0,i(e,l,t);o.push(c[a]={feature:e,layer:l,geometry:t,distanceSq:r,callback:i})}}),u?t.declutter?.[u]?.all().map((e=>e.value)):null)}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),r=t.getSource();if(!r)return!1;const n=e.viewHints[0],i=e.viewHints[1],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&i)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const s=e.extent,l=e.viewState,c=l.projection,u=l.resolution,h=e.pixelRatio,d=t.getRevision(),p=t.getRenderBuffer();let g=t.getRenderOrder();void 0===g&&(g=Dd);const f=l.center.slice(),m=(0,ee.r)(s,p*u),y=m.slice(),v=[m.slice()],A=c.getExtent();if(r.getWrapX()&&c.canWrapX()&&!(0,ee.ms)(A,e.extent)){const e=(0,ee.RG)(A),t=Math.max((0,ee.RG)(m)/2,e);m[0]=A[0]-t,m[2]=A[2]+t,(0,K.Li)(f,c);const r=(0,ee.Li)(v[0],c);r[0]<A[0]&&r[2]<A[2]?v.push([r[0]+e,r[1],r[2]+e,r[3]]):r[0]>A[0]&&r[2]>A[2]&&v.push([r[0]-e,r[1],r[2]-e,r[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==d&&this.renderedRenderOrder_==g&&this.renderedFrameDeclutter_===!!e.declutter&&(0,ee.ms)(this.wrappedRenderedExtent_,m))return(0,V.aI)(this.renderedExtent_,y)||(this.hitDetectionImageData_=null,this.renderedExtent_=y),this.renderedCenter_=f,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const S=new dd(kd(u,h),m,u,h),E=(0,ne.Tf)();let w;if(E){for(let e=0,t=v.length;e<t;++e){const t=v[e],n=(0,ne.JR)(t,c);r.loadFeatures(n,(0,ne.vN)(u,c),E)}w=(0,ne.FO)(E,c)}else for(let e=0,t=v.length;e<t;++e)r.loadFeatures(v[e],u,c);const _=Nd(u,h);let L=!0;const C=(e,r)=>{let n;const i=e.getStyleFunction()||t.getStyleFunction();if(i&&(n=i(e,u)),n){const t=this.renderFeature(e,_,n,S,w,this.getLayer().getDeclutter(),r);L=L&&!t}},b=(0,ne.JR)(m,c),T=r.getFeaturesInExtent(b);g&&T.sort(g);for(let e=0,t=T.length;e<t;++e)C(T[e],e);this.renderedFeatures_=T,this.ready=L;const x=S.finish(),P=new Md(m,u,h,r.getOverlaps(),x,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=u,this.renderedRevision_=d,this.renderedRenderOrder_=g,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=y,this.wrappedRenderedExtent_=m,this.renderedCenter_=f,this.renderedProjection_=c,this.renderedPixelRatio_=h,this.replayGroup_=P,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,r,n,i,o,a){if(!r)return!1;let s=!1;if(Array.isArray(r))for(let l=0,c=r.length;l<c;++l)s=Fd(n,e,r[l],t,this.boundHandleStyleImageChange_,i,o,a)||s;else s=Fd(n,e,r,t,this.boundHandleStyleImageChange_,i,o,a);return s}},zd=class extends yo{constructor(e){super(e)}createRenderer(){return new Vd(this)}};function Yd(e,t){return[[-1/0,-1/0,1/0,1/0]]}const $d=class{constructor(e){this.rbush_=new Ht(e),this.items_={}}insert(e,t){const r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(r),this.items_[(0,n.v6)(t)]=r}load(e,t){const r=new Array(t.length);for(let i=0,o=t.length;i<o;i++){const o=e[i],a=t[i],s={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};r[i]=s,this.items_[(0,n.v6)(a)]=s}this.rbush_.load(r)}remove(e){const t=(0,n.v6)(e),r=this.items_[t];return delete this.items_[t],null!==this.rbush_.remove(r)}update(e,t){const r=this.items_[(0,n.v6)(t)],i=[r.minX,r.minY,r.maxX,r.maxY];(0,ee.aI)(i,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map((function(e){return e.value}))}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map((function(e){return e.value}))}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let r;for(let n=0,i=e.length;n<i;n++)if(r=t(e[n]),r)return r;return r}isEmpty(){return(0,U.p)(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return(0,ee.N)(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}};class Kd extends a.A{constructor(e){super(),this.projection=(0,ne.Jt)(e.projection),this.attributions_=Xd(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible??!0,this.loading=!1,this.state_=void 0!==e.state?e.state:"ready",this.wrapX_=void 0!==e.wrapX&&e.wrapX,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise((function(e,r){t.viewResolver=e,t.viewRejector=r}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=Xd(e),this.changed()}setState(e){this.state_=e,this.changed()}}function Xd(e){return e?"function"==typeof e?e:(Array.isArray(e)||(e=[e]),t=>e):null}const Zd=Kd,Jd={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Qd extends s.Ay{constructor(e,t,r){super(e),this.feature=t,this.features=r}}const ep=class extends Zd{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===e.wrapX||e.wrapX}),this.on,this.once,this.un,this.loader_=te.tV,this.format_=e.format||null,this.overlaps_=void 0===e.overlaps||e.overlaps,this.url_=e.url,void 0!==e.loader?this.loader_=e.loader:void 0!==this.url_&&((0,B.v)(this.format_,"`format` must be set when `url` is set"),this.loader_=ta(this.url_,this.format_)),this.strategy_=void 0!==e.strategy?e.strategy:Yd;const t=void 0===e.useSpatialIndex||e.useSpatialIndex;let r,n;this.featuresRtree_=t?new $d:null,this.loadedExtentsRtree_=new $d,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(e.features)?n=e.features:e.features&&(r=e.features,n=r.getArray()),t||void 0!==r||(r=new h(n)),void 0!==n&&this.addFeaturesInternal(n),void 0!==r&&this.bindFeaturesCollection_(r)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=(0,n.v6)(e);if(!this.addToIndex_(t,e))return void(this.featuresCollection_&&this.featuresCollection_.remove(e));this.setupChangeEvents_(t,e);const r=e.getGeometry();if(r){const t=r.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(t,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Qd(Jd.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Qs.Ay||(this.featureChangeKeys_[e]=[(0,v.KT)(t,f.A.CHANGE,this.handleFeatureChange_,this),(0,v.KT)(t,G.A.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let r=!0;if(void 0!==t.getId()){const e=String(t.getId());if(e in this.idIndex_)if(t instanceof Qs.Ay){const n=this.idIndex_[e];n instanceof Qs.Ay?Array.isArray(n)?n.push(t):this.idIndex_[e]=[n,t]:r=!1}else r=!1;else this.idIndex_[e]=t}return r&&((0,B.v)(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),r}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],r=[],i=[];for(let t=0,i=e.length;t<i;t++){const i=e[t],o=(0,n.v6)(i);this.addToIndex_(o,i)&&r.push(i)}for(let e=0,o=r.length;e<o;e++){const o=r[e],a=(0,n.v6)(o);this.setupChangeEvents_(a,o);const s=o.getGeometry();if(s){const e=s.getExtent();t.push(e),i.push(o)}else this.nullGeometryFeatures_[a]=o}if(this.featuresRtree_&&this.featuresRtree_.load(t,i),this.hasListener(Jd.ADDFEATURE))for(let e=0,t=r.length;e<t;e++)this.dispatchEvent(new Qd(Jd.ADDFEATURE,r[e]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Jd.ADDFEATURE,(function(r){t||(t=!0,e.push(r.feature),t=!1)})),this.addEventListener(Jd.REMOVEFEATURE,(function(r){t||(t=!0,e.remove(r.feature),t=!1)})),e.addEventListener(i,(e=>{t||(t=!0,this.addFeature(e.element),t=!1)})),e.addEventListener(o,(e=>{t||(t=!0,this.removeFeature(e.element),t=!1)})),this.featuresCollection_=e}clear(e){if(e){for(const e in this.featureChangeKeys_)this.featureChangeKeys_[e].forEach(v.JH);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach((e=>{this.removeFeatureInternal(e)}));for(const e in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[e])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Qd(Jd.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,(function(r){const n=r.getGeometry();if(n instanceof Qs.Ay||n.intersectsCoordinate(e))return t(r)}))}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,(function(r){const n=r.getGeometry();if(n instanceof Qs.Ay||n.intersectsExtent(e)){const e=t(r);if(e)return e}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),(0,U.p)(this.nullGeometryFeatures_)||(0,V.X$)(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,(function(e){t.push(e)})),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=(0,ee.QJ)(e,t);return[].concat(...r.map((e=>this.featuresRtree_.getInExtent(e))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const r=e[0],n=e[1];let i=null;const o=[NaN,NaN];let a=1/0;const s=[-1/0,-1/0,1/0,1/0];return t=t||te.rT,this.featuresRtree_.forEachInExtent(s,(function(e){if(t(e)){const t=e.getGeometry(),l=a;if(a=t instanceof Qs.Ay?0:t.closestPointXY(r,n,o,a),a<l){i=e;const t=Math.sqrt(a);s[0]=r-t,s[1]=n-t,s[2]=r+t,s[3]=n+t}}})),i}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return void 0!==t?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return void 0!==t?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,r=(0,n.v6)(t),i=t.getGeometry();if(i){const e=i.getExtent();r in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[r],this.featuresRtree_&&this.featuresRtree_.insert(e,t)):this.featuresRtree_&&this.featuresRtree_.update(e,t)}else r in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[r]=t);const o=t.getId();if(void 0!==o){const e=o.toString();this.idIndex_[e]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[e]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[r]=t;this.changed(),this.dispatchEvent(new Qd(Jd.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return void 0!==t?t in this.idIndex_:(0,n.v6)(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&(0,U.p)(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(e,t,r){const n=this.loadedExtentsRtree_,i=this.strategy_(e,t,r);for(let e=0,o=i.length;e<o;++e){const o=i[e];n.forEachInExtent(o,(function(e){return(0,ee.ms)(e.extent,o)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new Qd(Jd.FEATURESLOADSTART)),this.loader_.call(this,o,t,r,(e=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qd(Jd.FEATURESLOADEND,void 0,e))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Qd(Jd.FEATURESLOADERROR))})),n.insert(o,{extent:o.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_,r=t.forEachInExtent(e,(function(t){if((0,ee.aI)(t.extent,e))return t}));r&&t.remove(r)}removeFeatures(e){let t=!1;for(let r=0,n=e.length;r<n;++r)t=this.removeFeatureInternal(e[r])||t;t&&this.changed()}removeFeature(e){e&&this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=(0,n.v6)(e);if(!(t in this.uidIndex_))return!1;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const r=this.featureChangeKeys_[t];r?.forEach(v.JH),delete this.featureChangeKeys_[t];const i=e.getId();if(void 0!==i){const t=i.toString(),r=this.idIndex_[t];r===e?delete this.idIndex_[t]:Array.isArray(r)&&(r.splice(r.indexOf(e),1),1===r.length&&(this.idIndex_[t]=r[0]))}return delete this.uidIndex_[t],this.hasListener(Jd.REMOVEFEATURE)&&this.dispatchEvent(new Qd(Jd.REMOVEFEATURE,e)),!0}removeFromIdIndex_(e){for(const t in this.idIndex_)if(this.idIndex_[t]===e){delete this.idIndex_[t];break}}setLoader(e){this.loader_=e}setUrl(e){(0,B.v)(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(ta(e,this.format_))}setOverlaps(e){this.overlaps_=e,this.changed()}},tp="drawstart";class rp extends s.Ay{constructor(e,t){super(e),this.feature=t}}function np(e,t){return(0,z.hG)(e[0],e[1],t[0],t[1])}function ip(e,t){const r=e.length;return t<0?e[t+r]:t>=r?e[t-r]:e[t]}function op(e,t,r){let n,i;t<r?(n=t,i=r):(n=r,i=t);const o=Math.ceil(n),a=Math.floor(i);if(o>a)return np(hp(e,n),hp(e,i));let s=0;n<o&&(s+=np(hp(e,n),ip(e,o))),a<i&&(s+=np(ip(e,a),hp(e,i)));for(let t=o;t<a-1;++t)s+=np(ip(e,t),ip(e,t+1));return s}function ap(e,t,r){if(t instanceof jo.A)lp(e,t.getCoordinates(),!1,r);else if(t instanceof Vo.A){const n=t.getCoordinates();for(let t=0,i=n.length;t<i;++t)lp(e,n[t],!1,r)}else if(t instanceof re.Ay){const n=t.getCoordinates();for(let t=0,i=n.length;t<i;++t)lp(e,n[t],!0,r)}else if(t instanceof zo.A){const n=t.getCoordinates();for(let t=0,i=n.length;t<i;++t){const i=n[t];for(let t=0,n=i.length;t<n;++t)lp(e,i[t],!0,r)}}else if(t instanceof Jo.A){const n=t.getGeometries();for(let t=0;t<n.length;++t)ap(e,n[t],r)}}const sp={index:-1,endIndex:NaN};function lp(e,t,r,n){const i=e[0],o=e[1];for(let e=0,a=t.length-1;e<a;++e){const a=up(i,o,t[e],t[e+1]);if(0===a.squaredDistance){const i=e+a.along;return void n.push({coordinates:t,ring:r,startIndex:i,endIndex:i})}}}const cp={along:0,squaredDistance:0};function up(e,t,r,n){const i=r[0],o=r[1],a=n[0]-i,s=n[1]-o;let l=0,c=i,u=o;return 0===a&&0===s||(l=(0,z.qE)(((e-i)*a+(t-o)*s)/(a*a+s*s),0,1),c+=a*l,u+=s*l),cp.along=l,cp.squaredDistance=(0,z.Mg)((0,z.hG)(e,t,c,u),10),cp}function hp(e,t){const r=e.length;let n=Math.floor(t);const i=t-n;n>=r?n-=r:n<0&&(n+=r);let o=n+1;o>=r&&(o-=r);const a=e[n],s=a[0],l=a[1],c=e[o];return[s+(c[0]-s)*i,l+(c[1]-l)*i]}function dp(){const e=Wi();return function(t,r){return e[t.getGeometry().getType()]}}class pp extends s.Ay{constructor(e,t,r,n,i){super(e),this.features=t,this.coordinate=r,this.startCoordinate=n,this.mapBrowserEvent=i}}const gp="unsnap";class fp extends s.Ay{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature,this.segment=t.segment}}var mp=r(1374);const yp={Circle(e,t){let r=e;const n=(0,ne.Tf)();n&&(r=r.clone().transform(n,t));const i=(0,re.nD)(r);return n&&i.transform(t,n),yp.Polygon(i)},GeometryCollection(e,t){const r=[],n=e.getGeometriesArray();for(let e=0;e<n.length;++e){const i=yp[n[e].getType()];i&&r.push(i(n[e],t))}return r.flat()},LineString(e){const t=[],r=e.getFlatCoordinates(),n=e.getStride();for(let e=0,i=r.length-n;e<i;e+=n)t.push([r.slice(e,e+2),r.slice(e+n,e+n+2)]);return t},MultiLineString(e){const t=[],r=e.getFlatCoordinates(),n=e.getStride(),i=e.getEnds();let o=0;for(let e=0,a=i.length;e<a;++e){const a=i[e];for(let e=o,i=a-n;e<i;e+=n)t.push([r.slice(e,e+2),r.slice(e+n,e+n+2)]);o=a}return t},MultiPoint(e){const t=[],r=e.getFlatCoordinates(),n=e.getStride();for(let e=0,i=r.length-n;e<i;e+=n)t.push([r.slice(e,e+2)]);return t},MultiPolygon(e){const t=[],r=e.getFlatCoordinates(),n=e.getStride(),i=e.getEndss();let o=0;for(let e=0,a=i.length;e<a;++e){const a=i[e];for(let e=0,i=a.length;e<i;++e){const i=a[e];for(let e=o,a=i-n;e<a;e+=n)t.push([r.slice(e,e+2),r.slice(e+n,e+n+2)]);o=i}}return t},Point:e=>[[e.getFlatCoordinates().slice(0,2)]],Polygon(e){const t=[],r=e.getFlatCoordinates(),n=e.getStride(),i=e.getEnds();let o=0;for(let e=0,a=i.length;e<a;++e){const a=i[e];for(let e=o,i=a-n;e<i;e+=n)t.push([r.slice(e,e+2),r.slice(e+n,e+n+2)]);o=a}return t}};function vp(e){return e.feature?e.feature:e.element?e.element:null}const Ap=[],Sp=[],Ep=[];class wp extends s.Ay{constructor(e,t,r,n){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=n}}const _p={};class Lp extends Ue{constructor(e){let t;if(super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Ke,this.addCondition_=e.addCondition?e.addCondition:$e,this.removeCondition_=e.removeCondition?e.removeCondition:$e,this.toggleCondition_=e.toggleCondition?e.toggleCondition:Ze,this.multi_=!!e.multi&&e.multi,this.filter_=e.filter?e.filter:te.rT,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=void 0!==e.style?e.style:function(){const e=Wi();return(0,V.X$)(e.Polygon,e.LineString),(0,V.X$)(e.GeometryCollection,e.LineString),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}(),this.features_=e.features||new h,e.layers)if("function"==typeof e.layers)t=e.layers;else{const r=e.layers;t=function(e){return r.includes(e)}}else t=te.rT;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[(0,n.v6)(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[(0,n.v6)(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(i,this.boundAddFeature_),this.features_.addEventListener(o,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(i,this.boundAddFeature_),this.features_.removeEventListener(o,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find((function(e){if(e instanceof zd&&e.getSource()&&e.getSource().hasFeature(t))return e}));e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=(0,n.v6)(e);t in _p||(_p[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){const n=t[r];if(n!==this&&n instanceof Lp&&n.getStyle()&&-1!==n.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(n.getStyle())}const r=(0,n.v6)(e);e.setStyle(_p[r]),delete _p[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[(0,n.v6)(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),n=this.toggleCondition_(e),i=!t&&!r&&!n,o=e.map,a=this.getFeatures(),s=[],l=[];if(i){(0,U.I)(this.featureLayerAssociation_),o.forEachFeatureAtPixel(e.pixel,((e,t)=>{if(e instanceof Uo.A&&this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),l.push(e),!this.multi_}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=a.getLength()-1;e>=0;--e){const t=a.item(e),r=l.indexOf(t);r>-1?l.splice(r,1):(a.remove(t),s.push(t))}0!==l.length&&a.extend(l)}else{o.forEachFeatureAtPixel(e.pixel,((e,i)=>{if(e instanceof Uo.A&&this.filter_(e,i))return!t&&!n||a.getArray().includes(e)?(r||n)&&a.getArray().includes(e)&&(s.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,i),l.push(e)),!this.multi_}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=s.length-1;e>=0;--e)a.remove(s[e]);a.extend(l)}return(l.length>0||s.length>0)&&this.dispatchEvent(new wp("select",l,s,e)),!0}}const Cp=Lp,bp=[0,0,0,0],Tp=[],xp="modifyend";class Pp extends s.Ay{constructor(e,t,r){super(e),this.features=t,this.mapBrowserEvent=r}}function Mp(e,t){return e.index-t.index}function Ip(e,t,r){const n=t.geometry;if("Circle"===n.getType()){let i=n;if(1===t.index){const t=(0,ne.Tf)();t&&(i=i.clone().transform(t,r));const n=(0,K.hG)(i.getCenter(),(0,ne.Ad)(e,r)),o=Math.sqrt(n)-i.getRadius();return o*o}}const i=(0,ne.Ad)(e,r);return Tp[0]=(0,ne.Ad)(t.segment[0],r),Tp[1]=(0,ne.Ad)(t.segment[1],r),(0,K.$x)(i,Tp)}function Rp(e,t,r){const n=t.geometry;if("Circle"===n.getType()&&1===t.index){let t=n;const i=(0,ne.Tf)();return i&&(t=t.clone().transform(i,r)),(0,ne.te)(t.getClosestPoint((0,ne.Ad)(e,r)),r)}const i=(0,ne.Ad)(e,r);return Tp[0]=(0,ne.Ad)(t.segment[0],r),Tp[1]=(0,ne.Ad)(t.segment[1],r),(0,ne.te)((0,K.sG)(i,Tp),r)}function Op(){const e=Wi();return function(t,r){return e.Point}}class Dp extends s.Ay{constructor(e,t,r,n){super(e),this.features=r,this.file=t,this.projection=n}}const Np=class extends Ue{constructor(e){e=e||{},super({handleEvent:te.rT}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];const t=e.formatConstructors?e.formatConstructors:[];for(let e=0,r=t.length;e<r;++e){let r=t[e];"function"==typeof r&&(r=new r),this.formats_.push(r),this.readAsBuffer_=this.readAsBuffer_||"arraybuffer"===r.getType()}this.projection_=e.projection?(0,ne.Jt)(e.projection):null,this.dropListenKeys_=null,this.source_=e.source||null,this.target=e.target?e.target:null}handleResult_(e,t){const r=t.target.result,n=this.getMap();let i,o=this.projection_;o||(o=(0,ne.Tf)(),o)||(o=n.getView().getProjection());const a=this.formats_;for(let t=0,n=a.length;t<n;++t){const n=a[t];let s=r;this.readAsBuffer_&&"arraybuffer"!==n.getType()&&(void 0===i&&(i=(new TextDecoder).decode(r)),s=i);const l=this.tryReadFeatures_(n,s,{featureProjection:o});if(l&&l.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(l)),this.dispatchEvent(new Dp("addfeatures",e,l,o));break}}}registerListeners_(){const e=this.getMap();if(e){const t=this.target?this.target:e.getViewport();this.dropListenKeys_=[(0,v.KT)(t,f.A.DROP,this.handleDrop,this),(0,v.KT)(t,f.A.DRAGENTER,this.handleStop,this),(0,v.KT)(t,f.A.DRAGOVER,this.handleStop,this),(0,v.KT)(t,f.A.DROP,this.handleStop,this)]}}setActive(e){!this.getActive()&&e&&this.registerListeners_(),this.getActive()&&!e&&this.unregisterListeners_(),super.setActive(e)}setMap(e){this.unregisterListeners_(),super.setMap(e),this.getActive()&&this.registerListeners_()}tryReadFeatures_(e,t,r){try{return e.readFeatures(t,r)}catch{return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(v.JH),this.dropListenKeys_=null)}handleDrop(e){const t=e.dataTransfer.files;for(let e=0,r=t.length;e<r;++e){const r=t.item(e),n=new FileReader;n.addEventListener(f.A.LOAD,this.handleResult_.bind(this,r)),this.readAsBuffer_?n.readAsArrayBuffer(r):n.readAsText(r)}}handleStop(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}},kp=new Set;const Fp=function(e){const t=e.lastIndexOf(".");return t>=0?e.substr(0,t):e},Gp=function(e,t){if(Object.prototype.hasOwnProperty.call(e.getProperties(),"h4_Capa"))return e.getProperties().h4_Capa;const r=/(?<layer>[-_\p{Letter}.]+[\p{Letter}])?\.*(?<id>[\d]*)?/iu.exec(e.getId()||e.ol_uid).groups;return r.layer?r.layer:Fp(t.name)};Np.prototype.handleResult_=async function(e,t){const r=t.target.result,n=this.getMap();let i=this.projection_;i||(i=(0,ne.Tf)(),i)||(i=n.getView().getProjection());let o={},a=[];const s=e.name;let l,c;const u=this.formats_;for(let t=0,o=u.length;t<o;++t){l=u[t];let o=r;if(this.readAsBuffer_&&"arraybuffer"!==l.getType()&&(void 0===c&&(c=(new TextDecoder).decode(r)),o=c),a=await this.tryReadFeatures_(l,o,{featureProjection:i,fileName:e.name,fileNames:[...kp.values()]}),!0===a)return void(n?._wrap.parent||window).dropFilesCounter--;if(a?.length>0)break}a&&a.length>0?o=a.every((e=>Array.isArray(e)))?a.reduce((function(t,r){if(0===r.length)return t;const n=Gp(r[0],e);return t[n]??=[],t[n]=t[n].concat(r),t}),{}):l.groupFeatures?l.groupFeatures(a,(function(t){return Gp(t,e)})):a.reduce((function(t,r){var n=r._folders?.length?r._folders[r._folders.length-1]:null;return n||(n=Gp(r,e)),t[n]??=[],t[n].push(r),t}),{}):o[Fp(e.name)]=a;const h=Date.now(),d=Object.keys(o);if(d.length>1){const e=this.getMap()?._wrap.parent||window;e.dropFilesCounter=e.dropFilesCounter+d.length-1}for(var p=0;p<d.length;p++){const t=d[p],r=o[t];"undefined"!==t&&r&&r.forEach((e=>{d.length>1&&(e._group=t)})),this.source_&&(this.source_.clear(),this.source_.addFeatures(r));const n=r&&r.length&&r[0]._document,a=new File([e],n?n+" ("+s+")":s,{lastModified:h});e._fileSystemFile&&(a._fileSystemFile=e._fileSystemFile);const c=e._fileHandle;c&&(a._fileHandle=c);const u=new Dp("addfeatures",a,r,i);u._groupIndex=p,u._groupCount=d.length,u._groupName=t;const g=(e,t)=>l.getFeatureTypeMetadata?l.getFeatureTypeMetadata(e,t):e;if(r){const e=r.map((e=>l.featureMetadata.get(e))).filter((e=>!!e));if(e.length){const t=e[0];e.every((e=>e==t))&&(u._metadata=g(t,r))}}this.dispatchEvent(u)}},Np.prototype.handleDrop=async function(e){const t=e.dataTransfer.items;if(DataTransferItem.prototype.getAsFileSystemHandle){const e=[],r=async function(t){if(t instanceof window.FileSystemDirectoryHandle)for await(const e of t.values())await r(e);else t&&e.push(t)};for await(const e of[...t].map((e=>e.getAsFileSystemHandle())))await r(e);e.forEach(((e,t,r)=>{const n=r.slice();n.splice(t,1),e._siblings=n})),e.forEach((e=>this.processFile(e)))}else{const e=t=>{t.isDirectory?t.createReader().readEntries((function(t){t.forEach((function(t){e(t)}))})):this.processFile(t)};for(var r=0,n=t.length;r<n;++r){const n=t[r];"file"===n.kind&&e(n.getAsFile())}}kp.clear()},Np.prototype.processFile=async function(e){let t;if(kp.add(e.name),globalThis.FileSystemFileHandle&&e instanceof globalThis.FileSystemFileHandle){t=e;try{e=await t.getFile()}catch(e){return console.warn(e),void this.dispatchEvent(new Dp("error",t))}e._fileHandle=t}const n=this.getMap()?._wrap.parent||globalThis;if(n.dropFilesCounter??=0,n.dropFilesCounter++,"application/zip"===e.type||"application/x-zip-compressed"===e.type||"application/vnd.google-earth.kmz"===e.type||(!e.type||"application/octet-stream"===e.type)&&e.name.match(/\.kmz|\.zip$/gi)){kp.delete(e.name);const{default:o}=await r.e(1710).then(r.t.bind(r,1710,23));var i=new o;const a=await i.loadAsync(e);n.dropFilesCounter--;const s="application/vnd.google-earth.kmz"===e.type||(!e.type||"application/octet-stream"===e.type)&&e.name.match(/\.kmz$/gi),l=[];a.forEach((function(e,t){t.dir||(n.dropFilesCounter++,l.push({name:e,file:t}))})),(await Promise.all(l.map((async r=>{const i=await r.file.async("blob");n.dropFilesCounter--;const o={};s&&(o.type="application/vnd.google-earth.kml+xml");const a=new File([i],r.name,o);if(a._fileSystemFile=e._fileSystemFile||e,t)a._fileHandle=t;else{const t=e._fileHandle;t&&(a._fileHandle=t)}return a})))).forEach((e=>this.processFile(e)))}else{var o=new FileReader;o.addEventListener(f.A.LOAD,this.handleResult_.bind(this,e)),this.readAsBuffer_?o.readAsArrayBuffer(e):o.readAsText(e)}},Np.prototype.tryReadFeatures_=async function(e,t,r){let n;try{n=await e.readFeatures(t,r)}catch(e){return null}return!0===n||n?.length&&n.some((e=>Array.isArray(e)?e.some((e=>!!e.getGeometry())):!!e.getGeometry()))?n:null};const Bp=Np;class Up extends y.A{constructor(e,t,r){super(),r=r||{},this.tileCoord=e,this.state=t,this.key="",this.transition_=void 0===r.transition?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(f.A.CHANGE)}release(){this.setState(4)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(4!==this.state){if(3!==this.state&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}}load(){(0,n.b0)()}getAlpha(e,t){if(!this.transition_)return 1;let r=this.transitionStarts_[e];if(r){if(-1===r)return 1}else r=t,this.transitionStarts_[e]=r;const n=t-r+1e3/60;return n>=this.transition_?1:X(n/this.transition_)}inTransition(e){return!!this.transition_&&-1!==this.transitionStarts_[e]}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}const qp=Up;function Wp(e){return e instanceof Image||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageBitmap?e:null}const Hp=new Error("disposed"),jp=[256,256],Vp=class extends qp{constructor(e){super(e.tileCoord,0,{transition:e.transition,interpolate:e.interpolate}),this.loader_=e.loader,this.data_=null,this.error_=null,this.size_=e.size||null,this.controller_=e.controller||null}getSize(){if(this.size_)return this.size_;const e=Wp(this.data_);return e?[e.width,e.height]:jp}getData(){return this.data_}getError(){return this.error_}load(){if(0!==this.state&&3!==this.state)return;this.state=1,this.changed();const e=this;this.loader_().then((function(t){e.data_=t,e.state=2,e.changed()})).catch((function(t){e.error_=t,e.state=3,e.changed()}))}disposeInternal(){this.controller_&&(this.controller_.abort(Hp),this.controller_=null),super.disposeInternal()}},zp=class extends qp{constructor(e,t,r,n,i,o){super(e,t,o),this.crossOrigin_=n,this.src_=r,this.key=r,this.image_=new Image,null!==n&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=i}getImage(){return this.image_}setImage(e){this.image_=e,this.state=2,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=3,this.unlistenImage_(),this.image_=function(){const e=_e(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=2:this.state=4,this.unlistenImage_(),this.changed()}load(){3==this.state&&(this.state=0,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),0==this.state&&(this.state=1,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=function(e,t,r){const n=e;let i=!0,o=!1,a=!1;const s=[(0,v.Jz)(n,f.A.LOAD,(function(){a=!0,o||t()}))];return n.src&&C?(o=!0,n.decode().then((function(){i&&t()})).catch((function(e){i&&(a?t():r())}))):s.push((0,v.Jz)(n,f.A.ERROR,r)),function(){i=!1,s.forEach(v.JH)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}};class Yp{constructor(e,t,r,n){this.minX=e,this.maxX=t,this.minY=r,this.maxY=n}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function $p(e,t,r,n,i){return void 0!==i?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new Yp(e,t,r,n)}const Kp=Yp;let Xp;const Zp=[];function Jp(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function Qp(e,t){return Math.abs(e[4*t]-210)>2||Math.abs(e[4*t+3]-191.25)>2}function eg(e,t,r,n){const i=(0,ne.pd)(r,t,e);let o=(0,ne.hO)(t,n,r);const a=t.getMetersPerUnit();void 0!==a&&(o*=a);const s=e.getMetersPerUnit();void 0!==s&&(o/=s);const l=e.getExtent();if(!l||(0,ee.Ym)(l,i)){const t=(0,ne.hO)(e,o,i)/o;isFinite(t)&&t>0&&(o/=t)}return o}function tg(e,t,r,n,i,o,a,s,l,c,u,h,d,p){const g=_e(Math.round(r*e),Math.round(r*t),Zp);if(h||(g.imageSmoothingEnabled=!1),0===l.length)return g.canvas;function f(e){return Math.round(e*r)/r}g.scale(r,r),g.globalCompositeOperation="lighter";const m=(0,ee.S5)();let y;l.forEach((function(e,t,r){(0,ee.X$)(m,e.extent)}));const v=r/n,A=(h?1:1+Math.pow(2,-24))/v;if(!d||1!==l.length||0!==c){if(y=_e(Math.round((0,ee.RG)(m)*v),Math.round((0,ee.Oq)(m)*v),Zp),h||(y.imageSmoothingEnabled=!1),i&&p){const e=(i[0]-m[0])*v,t=-(i[3]-m[3])*v,r=(0,ee.RG)(i)*v,n=(0,ee.Oq)(i)*v;y.rect(e,t,r,n),y.clip()}l.forEach((function(e,t,r){if(e.image.width>0&&e.image.height>0){if(e.clipExtent){y.save();const t=(e.clipExtent[0]-m[0])*v,r=-(e.clipExtent[3]-m[3])*v,n=(0,ee.RG)(e.clipExtent)*v,i=(0,ee.Oq)(e.clipExtent)*v;y.rect(h?t:Math.round(t),h?r:Math.round(r),h?n:Math.round(t+n)-Math.round(t),h?i:Math.round(r+i)-Math.round(r)),y.clip()}const t=(e.extent[0]-m[0])*v,r=-(e.extent[3]-m[3])*v,n=(0,ee.RG)(e.extent)*v,i=(0,ee.Oq)(e.extent)*v;y.drawImage(e.image,c,c,e.image.width-2*c,e.image.height-2*c,h?t:Math.round(t),h?r:Math.round(r),h?n:Math.round(t+n)-Math.round(t),h?i:Math.round(r+i)-Math.round(r)),e.clipExtent&&y.restore()}}))}const S=(0,ee.Py)(a);return s.getTriangles().forEach((function(e,t,r){const n=e.source,i=e.target;let a=n[0][0],s=n[0][1],c=n[1][0],u=n[1][1],d=n[2][0],p=n[2][1];const v=f((i[0][0]-S[0])/o),E=f(-(i[0][1]-S[1])/o),w=f((i[1][0]-S[0])/o),_=f(-(i[1][1]-S[1])/o),L=f((i[2][0]-S[0])/o),C=f(-(i[2][1]-S[1])/o),b=a,T=s;a=0,s=0,c-=b,u-=T,d-=b,p-=T;const x=[[c,u,0,0,w-v],[d,p,0,0,L-v],[0,0,c,u,_-E],[0,0,d,p,C-E]],P=(0,z.KU)(x);if(!P)return;if(g.save(),g.beginPath(),function(){if(void 0===Xp){const e=_e(6,6,Zp);e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Jp(e,4,5,4,0),Jp(e,4,5,0,5);const t=e.getImageData(0,0,3,3).data;Xp=Qp(t,0)||Qp(t,4)||Qp(t,8),be(e),Zp.push(e.canvas)}return Xp}()||!h){g.moveTo(w,_);const e=4,t=v-w,r=E-_;for(let n=0;n<e;n++)g.lineTo(w+f((n+1)*t/e),_+f(n*r/(e-1))),n!=e-1&&g.lineTo(w+f((n+1)*t/e),_+f((n+1)*r/(e-1)));g.lineTo(L,C)}else g.moveTo(w,_),g.lineTo(v,E),g.lineTo(L,C);let M;if(g.clip(),g.transform(P[0],P[2],P[1],P[3],v,E),g.translate(m[0]-b,m[3]-T),y)M=y.canvas,g.scale(A,-A);else{const e=l[0],t=e.extent;M=e.image,g.scale((0,ee.RG)(t)/M.width,-(0,ee.Oq)(t)/M.height)}g.drawImage(M,0,0),g.restore()})),y&&(be(y),Zp.push(y.canvas)),u&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,s.getTriangles().forEach((function(e,t,r){const n=e.target,i=(n[0][0]-S[0])/o,a=-(n[0][1]-S[1])/o,s=(n[1][0]-S[0])/o,l=-(n[1][1]-S[1])/o,c=(n[2][0]-S[0])/o,u=-(n[2][1]-S[1])/o;g.beginPath(),g.moveTo(s,l),g.lineTo(i,a),g.lineTo(c,u),g.closePath(),g.stroke()})),g.restore()),g.canvas}const rg=class{constructor(e,t,r,n,i,o,a){this.sourceProj_=e,this.targetProj_=t;let s={};const l=a?(0,ne.HU)((e=>(0,So.Bb)(a,(0,ne.pd)(e,this.targetProj_,this.sourceProj_)))):(0,ne.RG)(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){const t=e[0]+"/"+e[1];return s[t]||(s[t]=l(e)),s[t]},this.maxSourceExtent_=n,this.errorThresholdSquared_=i*i,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&(0,ee.RG)(n)>=(0,ee.RG)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,ee.RG)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,ee.RG)(this.targetProj_.getExtent()):null;const c=(0,ee.Py)(r),u=(0,ee.WU)(r),h=(0,ee.k_)(r),d=(0,ee.R)(r),p=this.transformInv_(c),g=this.transformInv_(u),f=this.transformInv_(h),m=this.transformInv_(d),y=10+(o?Math.max(0,Math.ceil(Math.log2((0,ee.UG)(r)/(o*o*256*256)))):0);if(this.addQuad_(c,u,h,d,p,g,f,m,y),this.wrapsXInSource_){let e=1/0;this.triangles_.forEach((function(t,r,n){e=Math.min(e,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach((t=>{if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-e>this.sourceWorldWidth_/2){const r=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];r[0][0]-e>this.sourceWorldWidth_/2&&(r[0][0]-=this.sourceWorldWidth_),r[1][0]-e>this.sourceWorldWidth_/2&&(r[1][0]-=this.sourceWorldWidth_),r[2][0]-e>this.sourceWorldWidth_/2&&(r[2][0]-=this.sourceWorldWidth_);const n=Math.min(r[0][0],r[1][0],r[2][0]);Math.max(r[0][0],r[1][0],r[2][0])-n<this.sourceWorldWidth_/2&&(t.source=r)}}))}s={}}addTriangle_(e,t,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[e,t,r]})}addQuad_(e,t,r,n,i,o,a,s,l){const c=(0,ee.Tr)([i,o,a,s]),u=this.sourceWorldWidth_?(0,ee.RG)(c)/this.sourceWorldWidth_:null,h=this.sourceWorldWidth_,d=this.sourceProj_.canWrapX()&&u>.5&&u<1;let p=!1;if(l>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const i=(0,ee.Tr)([e,t,r,n]);p=(0,ee.RG)(i)/this.targetWorldWidth_>.25||p}!d&&this.sourceProj_.isGlobal()&&u&&(p=u>.25||p)}if(!p&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!(0,ee.HY)(c,this.maxSourceExtent_))return;let g=0;if(!(p||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])))if(l>0)p=!0;else if(g=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1),1!=g&&2!=g&&4!=g&&8!=g)return;if(l>0){if(!p){const t=[(e[0]+r[0])/2,(e[1]+r[1])/2],n=this.transformInv_(t);let o;o=d?((0,z.xP)(i[0],h)+(0,z.xP)(a[0],h))/2-(0,z.xP)(n[0],h):(i[0]+a[0])/2-n[0];const s=(i[1]+a[1])/2-n[1];p=o*o+s*s>this.errorThresholdSquared_}if(p){if(Math.abs(e[0]-r[0])<=Math.abs(e[1]-r[1])){const c=[(t[0]+r[0])/2,(t[1]+r[1])/2],u=this.transformInv_(c),h=[(n[0]+e[0])/2,(n[1]+e[1])/2],d=this.transformInv_(h);this.addQuad_(e,t,c,h,i,o,u,d,l-1),this.addQuad_(h,c,r,n,d,u,a,s,l-1)}else{const c=[(e[0]+t[0])/2,(e[1]+t[1])/2],u=this.transformInv_(c),h=[(r[0]+n[0])/2,(r[1]+n[1])/2],d=this.transformInv_(h);this.addQuad_(e,c,h,n,i,u,d,s,l-1),this.addQuad_(c,t,r,h,u,o,a,d,l-1)}return}}if(d){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&g||this.addTriangle_(e,r,n,i,a,s),14&g||this.addTriangle_(e,r,t,i,a,o),g&&(13&g||this.addTriangle_(t,n,e,o,s,i),7&g||this.addTriangle_(t,n,r,o,s,a))}calculateSourceExtent(){const e=(0,ee.S5)();return this.triangles_.forEach((function(t,r,n){const i=t.source;(0,ee.$C)(e,i[0]),(0,ee.$C)(e,i[1]),(0,ee.$C)(e,i[2])})),e}getTriangles(){return this.triangles_}},ng=class extends qp{constructor(e,t,r,n,i,o,a,s,l,c,u,h){super(i,0,h),this.renderEdges_=void 0!==u&&u,this.pixelRatio_=a,this.gutter_=s,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=n,this.wrappedTileCoord_=o||i,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const d=n.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent();let g=this.sourceTileGrid_.getExtent();const f=p?(0,ee._N)(d,p):d;if(0===(0,ee.UG)(f))return void(this.state=4);const m=e.getExtent();m&&(g=g?(0,ee._N)(g,m):m);const y=n.getResolution(this.wrappedTileCoord_[0]),v=function(e,t,r,n){const i=(0,ee.q1)(r);let o=eg(e,t,i,n);return(!isFinite(o)||o<=0)&&(0,ee.sB)(r,(function(r){return o=eg(e,t,r,n),isFinite(o)&&o>0})),o}(e,r,f,y);if(!isFinite(v)||v<=0)return void(this.state=4);const A=void 0!==c?c:.5;if(this.triangulation_=new rg(e,r,f,g,v*A,y),0===this.triangulation_.getTriangles().length)return void(this.state=4);this.sourceZ_=t.getZForResolution(v);let S=this.triangulation_.calculateSourceExtent();if(g&&(e.canWrapX()?(S[1]=(0,z.qE)(S[1],g[1],g[3]),S[3]=(0,z.qE)(S[3],g[1],g[3])):S=(0,ee._N)(S,g)),(0,ee.UG)(S)){let r=0,n=0;e.canWrapX()&&(r=(0,ee.RG)(m),n=Math.floor((S[0]-m[0])/r)),(0,ee.QJ)(S.slice(),e,!0).forEach((e=>{const i=t.getTileRangeForExtentAndZ(e,this.sourceZ_);for(let e=i.minX;e<=i.maxX;e++)for(let t=i.minY;t<=i.maxY;t++){const i=l(this.sourceZ_,e,t,a);if(i){const e=n*r;this.sourceTiles_.push({tile:i,offset:e})}}++n})),0===this.sourceTiles_.length&&(this.state=4)}else this.state=4}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach((t=>{const r=t.tile;if(r&&2==r.getState()){const n=this.sourceTileGrid_.getTileCoordExtent(r.tileCoord);n[0]+=t.offset,n[2]+=t.offset;const i=this.clipExtent_?.slice();i&&(i[0]+=t.offset,i[2]+=t.offset),e.push({extent:n,clipExtent:i,image:r.getImage()})}})),this.sourceTiles_.length=0,0===e.length)this.state=3;else{const t=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(t),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=tg(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=2}this.changed()}load(){if(0==this.state){this.state=1,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((({tile:t})=>{const r=t.getState();if(0==r||1==r){e++;const r=(0,v.KT)(t,f.A.CHANGE,(n=>{const i=t.getState();2!=i&&3!=i&&4!=i||((0,v.JH)(r),e--,0===e&&(this.unlistenSources_(),this.reproject_()))}));this.sourcesListenerKeys_.push(r)}})),0===e?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function({tile:e},t,r){0==e.getState()&&e.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(v.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&(be(this.canvas_.getContext("2d")),Zp.push(this.canvas_),this.canvas_=null),super.release()}},ig=class{constructor(e){this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const e=this.pop();e instanceof ot.A&&e.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const r=this.entries_[e];return(0,B.v)(void 0!==r,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(e){const t=this.entries_[e];return(0,B.v)(void 0!==t,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t,r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e}getValues(){const e=new Array(this.count_);let t,r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){return this.entries_[e]?.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){(0,B.v)(!(e in this.entries_),"Tried to set a value for a key that is used already");const r={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[e]=r,++this.count_}setSize(e){this.highWaterMark=e}};function og(e,t,r,n){return void 0!==n?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function ag(e,t,r,n){return`${e},${function(e,t,r){return e+"/"+t+"/"+r}(t,r,n)}`}function sg(e,t,r){if(!(r in e))return e[r]=new Set([t]),!0;const n=e[r],i=n.has(t);return i||n.add(t),!i}function lg(e,t,r){const n=e[r];return!!n&&n.delete(t)}function cg(e,t){const r=e.layerStatesArray[e.layerIndex];r.extent&&(t=(0,ee._N)(t,(0,ne.SD)(r.extent,e.viewState.projection)));const n=r.layer.getRenderSource();if(!n.getWrapX()){const r=n.getTileGridForProjection(e.viewState.projection).getExtent();r&&(t=(0,ee._N)(t,r))}return t}const ug=class extends jd{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision_,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=(0,ee.S5)(),this.tempTileRange_=new Kp(0,0,0,0),this.tempTileCoord_=og(0,0,0);const r=void 0!==t.cacheSize?t.cacheSize:512;this.tileCache_=new ig(r),this.maxStaleKeys=.5*r}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,r,n){const i=this.tileCache_,o=this.getLayer().getSource(),a=ag(o.getKey(),e,t,r);let s;if(i.containsKey(a))s=i.get(a);else{if(s=o.getTile(e,t,r,n.pixelRatio,n.viewState.projection),!s)return null;i.set(a,s)}return s}getTile(e,t,r,n){return this.getOrCreateTile(e,t,r,n)||null}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=(0,So.Bb)(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!(0,ee.Ym)(i,n))return null;const o=t.viewState,a=r.getRenderSource(),s=a.getTileGridForProjection(o.projection),l=a.getTilePixelRatio(t.pixelRatio);for(let e=s.getZForResolution(o.resolution);e>=s.getMinZoom();--e){const r=s.getTileCoordForCoordAndZ(n,e),i=this.getTile(e,r[1],r[2],t);if(!i||2!==i.getState())continue;const c=s.getOrigin(e),u=Cr(s.getTileSize(e)),h=s.getResolution(e);let d;if(i instanceof zp||i instanceof ng)d=i.getImage();else{if(!(i instanceof Vp))continue;if(d=Wp(i.getData()),!d)continue}const p=Math.floor(l*((n[0]-c[0])/h-r[1]*u[0])),g=Math.floor(l*((c[1]-n[1])/h-r[2]*u[1])),f=Math.round(l*a.getGutterForProjection(o.projection));return this.getImageData(d,p+f,g+f)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;const t=this.getLayer().getSource();if(!t)return!1;const r=t.getRevision();return this.renderedRevision_?this.renderedRevision_!==r&&(this.renderedRevision_=r,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedRevision_=r,!0}enqueueTiles(e,t,r,i,o){const a=e.viewState,s=this.getLayer(),l=s.getRenderSource(),c=l.getTileGridForProjection(a.projection),u=(0,n.v6)(l);u in e.wantedTiles||(e.wantedTiles[u]={});const h=e.wantedTiles[u],d=s.getMapInternal(),p=Math.max(r-o,c.getMinZoom(),c.getZForResolution(Math.min(s.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(s.getMinZoom(),0)):c.getResolution(0)),l.zDirection)),g=a.rotation,f=g?(0,ee.Yw)(a.center,a.resolution,g,e.size):void 0;for(let n=r;n>=p;--n){const r=c.getTileRangeForExtentAndZ(t,n,this.tempTileRange_),o=c.getResolution(n);for(let t=r.minX;t<=r.maxX;++t)for(let a=r.minY;a<=r.maxY;++a){if(g&&!c.tileCoordIntersectsViewport([n,t,a],f))continue;const r=this.getTile(n,t,a,e);if(!r)continue;if(!sg(i,r,n))continue;const s=r.getKey();if(h[s]=!0,0===r.getState()&&!e.tileQueue.isKeyQueued(s)){const i=og(n,t,a,this.tempTileCoord_);e.tileQueue.enqueue([r,u,c.getTileCoordCenter(i),o])}}}}findStaleTile_(e,t){const r=this.tileCache_,i=e[0],o=e[1],a=e[2],s=this.getStaleKeys();for(let e=0;e<s.length;++e){const l=ag(s[e],i,o,a);if(r.containsKey(l)){const e=r.peek(l);if(2===e.getState())return e.endTransition((0,n.v6)(this)),sg(t,e,i),!0}}return!1}findAltTiles_(e,t,r,n){const i=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!i)return!1;let o=!0;const a=this.tileCache_,s=this.getLayer().getRenderSource().getKey();for(let e=i.minX;e<=i.maxX;++e)for(let t=i.minY;t<=i.maxY;++t){const i=ag(s,r,e,t);let l=!1;if(a.containsKey(i)){const e=a.peek(i);2===e.getState()&&(sg(n,e,r),l=!0)}l||(o=!1)}return o}renderFrame(e,t){this.renderComplete=!0;const r=e.layerStatesArray[e.layerIndex],i=e.viewState,o=i.projection,a=i.resolution,s=i.center,l=e.pixelRatio,c=this.getLayer(),u=c.getSource(),h=u.getTileGridForProjection(o),d=h.getZForResolution(a,u.zDirection),p=h.getResolution(d),g=u.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let f=e.extent;const m=u.getTilePixelRatio(l);this.prepareContainer(e,t);const y=this.context.canvas.width,v=this.context.canvas.height,A=r.extent&&(0,ne.SD)(r.extent,o);A&&(f=(0,ee._N)(f,(0,ne.SD)(r.extent,o)));const S=p*y/2/m,E=p*v/2/m,w=[s[0]-S,s[1]-E,s[0]+S,s[1]+E],_={};this.renderedTiles.length=0;const L=c.getPreload();if(e.nextExtent){const t=h.getZForResolution(i.nextResolution,u.zDirection),r=cg(e,e.nextExtent);this.enqueueTiles(e,r,t,_,L)}const C=cg(e,f);if(this.enqueueTiles(e,C,d,_,0),L>0&&setTimeout((()=>{this.enqueueTiles(e,C,d-1,_,L-1)}),0),!(d in _))return this.container;const b=(0,n.v6)(this),T=e.time;for(const t of _[d]){const r=t.getState();if(4===r)continue;const n=t.tileCoord;if(2===r&&1===t.getAlpha(b,T)){t.endTransition(b);continue}if(3!==r&&(this.renderComplete=!1),this.findStaleTile_(n,_)){lg(_,t,d),e.animate=!0;continue}if(this.findAltTiles_(h,n,d+1,_))continue;const i=h.getMinZoom();for(let e=d-1;e>=i&&!this.findAltTiles_(h,n,e,_);--e);}const x=p/a*l/m,P=this.getRenderContext(e);(0,So.Zz)(this.tempTransform,y/2,v/2,x,x,0,-y/2,-v/2),r.extent&&this.clipUnrotated(P,e,A),u.getInterpolate()||(P.imageSmoothingEnabled=!1),this.preRender(P,e);const M=Object.keys(_).map(Number);let I;M.sort(V.V_);const R=[],O=[];for(let t=M.length-1;t>=0;--t){const r=M[t],n=u.getTilePixelSize(r,l,o),i=h.getResolution(r)/p,a=n[0]*i*x,s=n[1]*i*x,c=h.getTileCoordForCoordAndZ((0,ee.Py)(w),r),d=h.getTileCoordExtent(c),g=(0,So.Bb)(this.tempTransform,[m*(d[0]-w[0])/p,m*(w[3]-d[3])/p]),f=m*u.getGutterForProjection(o);for(const t of _[r]){if(2!==t.getState())continue;const n=t.tileCoord,i=c[1]-n[1],o=Math.round(g[0]-(i-1)*a),l=c[2]-n[2],h=Math.round(g[1]-(l-1)*s),d=Math.round(g[0]-i*a),p=Math.round(g[1]-l*s),m=o-d,y=h-p,v=1===M.length;let A=!1;I=[d,p,d+m,p,d+m,p+y,d,p+y];for(let e=0,t=R.length;e<t;++e)if(!v&&r<O[e]){const t=R[e];(0,ee.HY)([d,p,d+m,p+y],[t[0],t[3],t[4],t[7]])&&(A||(P.save(),A=!0),P.beginPath(),P.moveTo(I[0],I[1]),P.lineTo(I[2],I[3]),P.lineTo(I[4],I[5]),P.lineTo(I[6],I[7]),P.moveTo(t[6],t[7]),P.lineTo(t[4],t[5]),P.lineTo(t[2],t[3]),P.lineTo(t[0],t[1]),P.clip())}R.push(I),O.push(r),this.drawTile(t,e,d,p,m,y,f,v),A&&P.restore(),this.renderedTiles.unshift(t),this.updateUsedTiles(e.usedTiles,u,t)}}if(this.renderedResolution=p,this.extentChanged=!this.renderedExtent_||!(0,ee.aI)(this.renderedExtent_,w),this.renderedExtent_=w,this.renderedPixelRatio=l,this.postRender(this.context,e),r.extent&&P.restore(),P.imageSmoothingEnabled=!0,this.renderComplete){const t=(e,t)=>{const r=(0,n.v6)(u),i=t.wantedTiles[r],o=i?Object.keys(i).length:0;this.updateCacheSize(o),this.tileCache_.expireCache()};e.postRenderFunctions.push(t)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,2*e)}drawTile(e,t,r,i,o,a,s,l){let c;if(e instanceof Vp){if(c=Wp(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;const u=this.getRenderContext(t),h=(0,n.v6)(this),d=t.layerStatesArray[t.layerIndex],p=d.opacity*(l?e.getAlpha(h,t.time):1),g=p!==u.globalAlpha;g&&(u.save(),u.globalAlpha=p),u.drawImage(c,s,s,c.width-2*s,c.height-2*s,r,i,o,a),g&&u.restore(),p!==d.opacity?t.animate=!0:l&&e.endTransition(h)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,r){const i=(0,n.v6)(t);i in e||(e[i]={}),e[i][r.getKey()]=!0}},hg="preload",dg="useInterimTilesOnError",pg=class extends Bt{constructor(e){e=e||{};const t=Object.assign({},e),r=e.cacheSize;delete e.cacheSize,delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r,this.setPreload(void 0!==e.preload?e.preload:0),this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(hg)}setPreload(e){this.set(hg,e)}getUseInterimTilesOnError(){return this.get(dg)}setUseInterimTilesOnError(e){this.set(dg,e)}getData(e){return super.getData(e)}},gg=class extends jd{constructor(e){super(e),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],r=e.pixelRatio,n=e.viewState,i=n.resolution,o=this.getLayer().getSource(),a=e.viewHints;let s=e.extent;if(void 0!==t.extent&&(s=(0,ee._N)(s,(0,ne.SD)(t.extent,n.projection))),!a[0]&&!a[1]&&!(0,ee.Im)(s))if(o){const e=n.projection,t=o.getImage(s,i,r,e);t&&(this.loadImage(t)?this.image=t:4===t.getState()&&(this.image=null))}else this.image=null;return!!this.image}getData(e){const t=this.frameState;if(!t)return null;const r=this.getLayer(),n=(0,So.Bb)(t.pixelToCoordinateTransform,e.slice()),i=r.getExtent();if(i&&!(0,ee.Ym)(i,n))return null;const o=this.image.getExtent(),a=this.image.getImage(),s=(0,ee.RG)(o),l=Math.floor(a.width*((n[0]-o[0])/s));if(l<0||l>=a.width)return null;const c=(0,ee.Oq)(o),u=Math.floor(a.height*((o[3]-n[1])/c));return u<0||u>=a.height?null:this.getImageData(a,l,u)}renderFrame(e,t){const r=this.image,n=r.getExtent(),i=r.getResolution(),[o,a]=Array.isArray(i)?i:[i,i],s=r.getPixelRatio(),l=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,u=e.viewState,h=u.center,d=u.resolution,p=c*o/(d*s),g=c*a/(d*s);this.prepareContainer(e,t);const f=this.context.canvas.width,m=this.context.canvas.height,y=this.getRenderContext(e);let v=!1,A=!0;if(l.extent){const t=(0,ne.SD)(l.extent,u.projection);A=(0,ee.HY)(t,e.extent),v=A&&!(0,ee.ms)(t,e.extent),v&&this.clipUnrotated(y,e,t)}const S=r.getImage(),E=(0,So.Zz)(this.tempTransform,f/2,m/2,p,g,0,s*(n[0]-h[0])/o,s*(h[1]-n[3])/a);this.renderedResolution=a*c/s;const w=S.width*E[0],_=S.height*E[3];if(this.getLayer().getSource().getInterpolate()||(y.imageSmoothingEnabled=!1),this.preRender(y,e),A&&w>=.5&&_>=.5){const e=E[4],t=E[5],r=l.opacity;1!==r&&(y.save(),y.globalAlpha=r),y.drawImage(S,0,0,+S.width,+S.height,e,t,w,_),1!==r&&y.restore()}return this.postRender(this.context,e),v&&y.restore(),y.imageSmoothingEnabled=!0,this.container}},fg=class extends Bt{constructor(e){super(e=e||{})}};function mg(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}const yg=34962,vg=34963,Ag=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Sg(e,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!S},t);const r=Ag.length;for(let n=0;n<r;++n)try{const r=e.getContext(Ag[n],t);if(r)return r}catch{}return null}function Eg(e){switch(e){case yg:return Float32Array;case vg:return Uint32Array;default:return Float32Array}}const wg=class{constructor(e,t){this.array_=null,this.type_=e,(0,B.v)(e===yg||e===vg,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=void 0!==t?t:35044}ofSize(e){return this.array_=new(Eg(this.type_))(e),this}fromArray(e){return this.array_=Eg(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Eg(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Eg(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}},_g="webglcontextlost",Lg="webglcontextrestored",Cg=class{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||"\n  precision mediump float;\n\n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n\n  uniform vec2 u_screenSize;\n\n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),t.compileShader(r);const n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||"\n  precision mediump float;\n\n  uniform sampler2D u_image;\n  uniform float u_opacity;\n\n  varying vec2 v_texCoord;\n\n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach((r=>{this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})}))}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;const e=0,n=t.RGBA,i=0,o=t.RGBA,a=t.UNSIGNED_BYTE,s=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,e,n,r[0],r[1],i,o,a,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,i){const o=this.getGL(),a=e.size;if(o.bindFramebuffer(o.FRAMEBUFFER,t?t.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!t){const t=(0,n.v6)(o.canvas);if(!e.renderTargets[t]){const r=o.getContextAttributes();r&&r.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clearDepth(1),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)),e.renderTargets[t]=!0}}o.disable(o.DEPTH_TEST),o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),o.uniform1i(this.renderTargetTextureLocation_,0);const s=e.layerStatesArray[e.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,s),this.applyUniforms(e),r&&r(o,e),o.drawArrays(o.TRIANGLES,0,6),i&&i(o,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let r,n=1;this.uniforms_.forEach((function(i){if(r="function"==typeof i.value?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof ImageData)i.texture||(i.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,i.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(i.location,n++);else if(Array.isArray(r))switch(r.length){case 2:return void t.uniform2f(i.location,r[0],r[1]);case 3:return void t.uniform3f(i.location,r[0],r[1],r[2]);case 4:return void t.uniform4f(i.location,r[0],r[1],r[2],r[3]);default:return}else"number"==typeof r&&t.uniform1f(i.location,r)}))}},bg={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Tg=5126,xg={};function Pg(e){return"shared/"+e}let Mg=0;class Ig extends ot.A{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Pg(e.canvasCacheKey):function(){const e="unique/"+Mg;return Mg+=1,e}(),this.gl_=function(e){let t=xg[e];if(!t){const r=document.createElement("canvas");r.width=1,r.height=1,r.style.position="absolute",r.style.left="0",t={users:0,context:Sg(r)},xg[e]=t}return t.users+=1,t.context}(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(_g,this.boundHandleWebGLContextLost_),t.addEventListener(Lg,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=(0,So.vt)(),this.offsetScaleMatrix_=(0,So.vt)(),this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map((e=>new Cg({webGlContext:this.gl_,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms}))):[new Cg({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Pg(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,r=(0,n.v6)(e);let i=this.bufferCache_[r];i||(i={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[r]=i),t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=(0,n.v6)(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(_g,this.boundHandleWebGLContextLost_),e.removeEventListener(Lg,this.boundHandleWebGLContextRestored_),function(e){const t=xg[e];if(!t)return;if(t.users-=1,t.users>0)return;const r=t.context,n=r.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=r.canvas;i.width=1,i.height=1,delete xg[e]}(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){const n=this.gl_,i=this.getCanvas(),o=e.size,a=e.pixelRatio;i.width===o[0]*a&&i.height===o[1]*a||(i.width=o[0]*a,i.height=o[1]*a,i.style.width=o[0]+"px",i.style.height=o[1]+"px");for(let t=this.postProcessPasses_.length-1;t>=0;t--)this.postProcessPasses_[t].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA),r?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindFrameBuffer(e,t){const r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){const n=this.gl_;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){const n=this.getGL();this.bindBuffer(e);const i=this.getAttributeLocation(t);n.enableVertexAttribArray(i),n.vertexAttribPointer(i,r,n.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,n){const i=this.gl_,o=t.getSize();i.bindFramebuffer(i.FRAMEBUFFER,t.getFramebuffer()),i.bindRenderbuffer(i.RENDERBUFFER,t.getDepthbuffer()),i.viewport(0,0,o[0],o[1]),i.bindTexture(i.TEXTURE_2D,t.getTexture()),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}drawElements(e,t){const r=this.gl_;this.getExtension("OES_element_index_uint");const n=r.UNSIGNED_INT,i=t-e,o=4*e;r.drawElements(r.TRIANGLES,i,n,o)}finalizeDraw(e,t,r){for(let n=0,i=this.postProcessPasses_.length;n<i;n++)n===i-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,r=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(bg.TIME,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(bg.ZOOM,e.viewState.zoom),this.setUniformFloatValue(bg.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(bg.PIXEL_RATIO,n),this.setUniformFloatVec2(bg.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(bg.ROTATION,r)}applyHitDetectionUniform(e){const t=this.getUniformLocation(bg.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(bg.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let r,n=0;this.uniforms_.forEach((i=>{if(r="function"==typeof i.value?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!i.texture?(i.prevValue=void 0,i.texture=r):i.texture||(i.prevValue=void 0,i.texture=t.createTexture()),this.bindTexture(i.texture,n,i.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const e=!(r instanceof HTMLImageElement)||r.complete;r instanceof WebGLTexture||!e||i.prevValue===r||(i.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),n++}else if(Array.isArray(r)&&6===r.length)this.setUniformMatrixValue(i.name,mg(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:return void t.uniform2f(this.getUniformLocation(i.name),r[0],r[1]);case 3:return void t.uniform3f(this.getUniformLocation(i.name),r[0],r[1],r[2]);case 4:return void t.uniform4f(this.getUniformLocation(i.name),r[0],r[1],r[2],r[3]);default:return}else"number"==typeof r&&t.uniform1f(this.getUniformLocation(i.name),r)}))}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const r=this.gl_,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}getProgram(e,t){const r=this.gl_,n=this.compileShader(e,r.FRAGMENT_SHADER),i=this.compileShader(t,r.VERTEX_SHADER),o=r.createProgram();if(r.attachShader(o,n),r.attachShader(o,i),r.linkProgram(o),!r.getShaderParameter(n,r.COMPILE_STATUS)){const e=`Fragment shader compilation failed: ${r.getShaderInfoLog(n)}`;throw new Error(e)}if(r.deleteShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){const e=`Vertex shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(e)}if(r.deleteShader(i),!r.getProgramParameter(o,r.LINK_STATUS)){const e=`GL program linking failed: ${r.getProgramInfoLog(o)}`;throw new Error(e)}return o}getUniformLocation(e){const t=(0,n.v6)(this.currentProgram_);return void 0===this.uniformLocationsByProgram_[t]&&(this.uniformLocationsByProgram_[t]={}),void 0===this.uniformLocationsByProgram_[t][e]&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=(0,n.v6)(this.currentProgram_);return void 0===this.attribLocationsByProgram_[t]&&(this.attribLocationsByProgram_[t]={}),void 0===this.attribLocationsByProgram_[t][e]&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const r=e.size,n=e.viewState.rotation,i=e.viewState.resolution,o=e.viewState.center;return(0,So.Zz)(t,0,0,2/(i*r[0]),2/(i*r[1]),-n,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,r,n,i){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,r,!1,n,i))}enableAttributes(e){const t=function(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];t+=n.size*Rg(n.type)}return t}(e);let r=0;for(let n=0;n<e.length;n++){const i=e[n];this.enableAttributeArray_(i.name,i.size,i.type||5126,t,r),r+=i.size*Rg(i.type)}}handleWebGLContextLost(e){(0,U.I)(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,n){const i=this.gl_;r=r||i.createTexture();const o=n?i.NEAREST:i.LINEAR;i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,o),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);const a=i.RGBA,s=i.RGBA,l=i.UNSIGNED_BYTE;return t instanceof Uint8Array?i.texImage2D(i.TEXTURE_2D,0,a,e[0],e[1],0,s,l,t):t?i.texImage2D(i.TEXTURE_2D,0,a,s,l,t):i.texImage2D(i.TEXTURE_2D,0,a,e[0],e[1],0,s,l,null),r}}function Rg(e){switch(e){case 5121:return Uint8Array.BYTES_PER_ELEMENT;case 5123:return Uint16Array.BYTES_PER_ELEMENT;case 5125:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}const Og=Ig;y.A;class Dg extends qd{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=(0,So.vt)(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(Mt,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Ft.PRECOMPOSE)){const n=new Ao(Ft.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){const r=this.getLayer();if(r.hasListener(Ft.POSTCOMPOSE)){const n=new Ao(Ft.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t,r=!0,n=-1;for(let i=0,o=e.layerStatesArray.length;i<o;i++){const o=e.layerStatesArray[i].layer,a=o.getRenderer();if(!(a instanceof Dg)){r=!0;continue}const s=o.getClassName();if((r||s!==t)&&(n+=1,r=!1),t=s,a===this)break}const i="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(i)&&!this.helper.needsToBeRecreated()||(this.removeHelper(),this.helper=new Og({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:i}),t&&(this.helper.getCanvas().className=t),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(Mt,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){const n=this.getLayer();if(n.hasListener(e)){(0,So.Zz)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);const i=new Ao(e,this.inversePixelTransform_,r,t);n.dispatchEvent(i)}}preRender(e,t){this.dispatchRenderEvent_(Ft.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(Ft.POSTRENDER,e,t)}}const Ng=Dg,kg="u_tileTextures",Fg="u_texturePixelWidth",Gg="u_texturePixelHeight",Bg=class{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}};function Ug(e){const t=e.toString();return t.includes(".")?t:t+".0"}function qg(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${e.length}(${e.map(Ug).join(", ")})`}function Wg(e){const t=wr(e),r=t.length>3?t[3]:1;return qg([t[0]/255,t[1]/255,t[2]/255,r])}const Hg={};let jg=0;function Vg(e){return e in Hg||(Hg[e]=jg++),Hg[e]}function zg(e){return Ug(Vg(e))}function Yg(e){return"u_var_"+e}const $g="getBandValue",Kg="featureId",Xg="geometryType",Zg=-9999999;function Jg(e){return(t,r,n)=>{const i=r.args.length,o=new Array(i);for(let e=0;e<i;++e)o[e]=ef(r.args[e],n,t);return e(o,t)}}const Qg={[Hr]:(e,t)=>{const r=t.args[0].value;return r in e.properties||(e.properties[r]={name:r,type:t.type}),"a_prop_"+r},[Rn]:e=>(e.featureId=!0,"a_"+Kg),[zr]:e=>(e.geometryType=!0,"a_"+Xg),[Yr]:()=>"currentLineMetric",[jr]:(e,t)=>{const r=t.args[0].value;return r in e.variables||(e.variables[r]={name:r,type:t.type}),Yg(r)},[kn]:(e,t)=>{const r=t.args[0].value;return r in e.properties||(e.properties[r]={name:r,type:t.type}),`(a_prop_${r} != ${Ug(Zg)})`},[Zr]:()=>"u_resolution",[Jr]:()=>"u_zoom",[Qr]:()=>"u_time",[$r]:Jg((e=>`(${e.join(" || ")})`)),[Kr]:Jg((e=>`(${e.join(" && ")})`)),[Xr]:Jg((([e])=>`(!${e})`)),[en]:Jg((([e,t])=>`(${e} == ${t})`)),[tn]:Jg((([e,t])=>`(${e} != ${t})`)),[rn]:Jg((([e,t])=>`(${e} > ${t})`)),[nn]:Jg((([e,t])=>`(${e} >= ${t})`)),[on]:Jg((([e,t])=>`(${e} < ${t})`)),[an]:Jg((([e,t])=>`(${e} <= ${t})`)),[sn]:Jg((e=>`(${e.join(" * ")})`)),[ln]:Jg((([e,t])=>`(${e} / ${t})`)),[cn]:Jg((e=>`(${e.join(" + ")})`)),[un]:Jg((([e,t])=>`(${e} - ${t})`)),[hn]:Jg((([e,t,r])=>`clamp(${e}, ${t}, ${r})`)),[dn]:Jg((([e,t])=>`mod(${e}, ${t})`)),[pn]:Jg((([e,t])=>`pow(${e}, ${t})`)),[gn]:Jg((([e])=>`abs(${e})`)),[fn]:Jg((([e])=>`floor(${e})`)),[mn]:Jg((([e])=>`ceil(${e})`)),[yn]:Jg((([e])=>`floor(${e} + 0.5)`)),[vn]:Jg((([e])=>`sin(${e})`)),[An]:Jg((([e])=>`cos(${e})`)),[Sn]:Jg((([e,t])=>void 0!==t?`atan(${e}, ${t})`:`atan(${e})`)),[En]:Jg((([e])=>`sqrt(${e})`)),[wn]:Jg((e=>{const t=e[0],r=e[e.length-1];let n=null;for(let i=e.length-3;i>=1;i-=2)n=`(${t} == ${e[i]} ? ${e[i+1]} : ${n||r})`;return n})),[_n]:Jg((([e,t,r])=>`(${e} >= ${t} && ${e} <= ${r})`)),[Ln]:Jg((([e,t,...r])=>{let n="";for(let i=0;i<r.length-2;i+=2){const o=r[i],a=n||r[i+1],s=r[i+2],l=r[i+3];let c;c=e===Ug(1)?`(${t} - ${o}) / (${s} - ${o})`:`(pow(${e}, (${t} - ${o})) - 1.0) / (pow(${e}, (${s} - ${o})) - 1.0)`,n=`mix(${a}, ${l}, clamp(${c}, 0.0, 1.0))`}return n})),[bn]:Jg((e=>{const t=e[e.length-1];let r=null;for(let n=e.length-3;n>=0;n-=2)r=`(${e[n]} ? ${e[n+1]} : ${r||t})`;return r})),[Tn]:Jg((([e,...t],r)=>{const n=function(e,t){return`operator_in_${Object.keys(t.functions).length}`}(0,r),i=[];for(let e=0;e<t.length;e+=1)i.push(`  if (inputValue == ${t[e]}) { return true; }`);return r.functions[n]=`bool ${n}(float inputValue) {\n${i.join("\n")}\n  return false;\n}`,`${n}(${e})`})),[Mn]:Jg((e=>`vec${e.length}(${e.join(", ")})`)),[In]:Jg((e=>{if(1===e.length)return`vec4(vec3(${e[0]} / 255.0), 1.0)`;if(2===e.length)return`vec4(vec3(${e[0]} / 255.0), ${e[1]})`;const t=e.slice(0,3).map((e=>`${e} / 255.0`));if(3===e.length)return`vec4(${t.join(", ")}, 1.0)`;const r=e[3];return`vec4(${t.join(", ")}, ${r})`})),[On]:Jg((([e,t,r],n)=>{if(!($g in n.functions)){let e="";const t=n.bandCount||1;for(let r=0;r<t;r++){const n=Math.floor(r/4);let i=r%4;r===t-1&&1===i&&(i=3),e+=`  if (band == ${r+1}.0) {\n    return texture2D(${kg}[${n}], v_textureCoord + vec2(dx, dy))[${i}];\n  }\n`}n.functions[$g]=`float getBandValue(float band, float xOffset, float yOffset) {\n  float dx = xOffset / ${Fg};\n  float dy = yOffset / ${Gg};\n${e}\n}`}return`${$g}(${e}, ${t??"0.0"}, ${r??"0.0"})`})),[Dn]:(e,t)=>{const[r,...n]=t.args,i=n.length,o=new Uint8Array(4*i);for(let e=0;e<n.length;e++){const t=wr(n[e].value),r=4*e;o[r]=t[0],o[r+1]=t[1],o[r+2]=t[2],o[r+3]=255*t[3]}e.paletteTextures||(e.paletteTextures=[]);const a=`u_paletteTextures[${e.paletteTextures.length}]`,s=new Bg(a,o);return e.paletteTextures.push(s),`texture2D(${a}, vec2((${ef(r,xr,e)} + 0.5) / ${i}.0, 0.5))`}};function ef(e,t,r){if(e instanceof Ur){const n=Qg[e.operator];if(void 0===n)throw new Error(`No compiler defined for this operator: ${JSON.stringify(e.operator)}`);return n(r,e,t)}if((e.type&xr)>0)return Ug(e.value);if((e.type&Tr)>0)return e.value.toString();if((e.type&Pr)>0)return zg(e.value.toString());if((e.type&Mr)>0)return Wg(e.value);if((e.type&Ir)>0)return qg(e.value);if((e.type&Rr)>0)return qg(Cr(e.value));throw new Error(`Unexpected expression ${e.value} (expected type ${kr(t)})`)}const tf="#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\n#else\nprecision mediump float;\n#endif\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_screenToWorldMatrix;\nuniform vec2 u_viewportSizePx;\nuniform float u_pixelRatio;\nuniform float u_globalAlpha;\nuniform float u_time;\nuniform float u_zoom;\nuniform float u_resolution;\nuniform float u_rotation;\nuniform vec4 u_renderExtent;\nuniform vec2 u_patternOrigin;\nuniform float u_depth;\nuniform mediump int u_hitDetection;\n\nconst float PI = 3.141592653589793238;\nconst float TWO_PI = 2.0 * PI;\nfloat currentLineMetric = 0.; // an actual value will be used in the stroke shaders\n",rf="rgba(255,255,255,0.4)",nf="#3399CC",of=1.25,af=5,sf="rgba(255,255,255,0.4)",lf=1.25;class cf{constructor(){this.uniforms_=[],this.attributes_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Ug(af)} + ${Ug(.5*lf)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Wg(sf),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Ug(of),this.strokeColorExpression_=Wg(nf),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=zg("round"),this.strokeJoinExpression_=zg("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Wg(rf),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e,t,r,n){return this.attributes_.push({name:e,type:t,varyingName:e.replace(/^a_/,"v_"),varyingType:n??t,varyingExpression:r??e}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){return this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e),this}addFragmentShaderFunction(e){return this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e),this}getSymbolVertexShader(){return this.hasSymbol_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nattribute vec2 a_position;\nattribute float a_index;\nattribute vec4 a_hitColor;\n\nvarying vec2 v_texCoord;\nvarying vec2 v_quadCoord;\nvarying vec4 v_hitColor;\nvarying vec2 v_centerPx;\nvarying float v_angle;\nvarying vec2 v_quadSizePx;\n\n${this.attributes_.map((e=>`attribute ${e.type} ${e.name};\nvarying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.vertexShaderFunctions_.join("\n")}\nvec2 pxToScreen(vec2 coordPx) {\n  vec2 scaled = coordPx / u_viewportSizePx / 0.5;\n  return scaled;\n}\n\nvec2 screenToPx(vec2 coordScreen) {\n  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;\n}\n\nvoid main(void) {\n  v_quadSizePx = ${this.symbolSizeExpression_};\n  vec2 halfSizePx = v_quadSizePx * 0.5;\n  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};\n  vec2 offsetPx = centerOffsetPx;\n  if (a_index == 0.0) {\n    offsetPx -= halfSizePx;\n  } else if (a_index == 1.0) {\n    offsetPx += halfSizePx * vec2(1., -1.);\n  } else if (a_index == 2.0) {\n    offsetPx += halfSizePx;\n  } else {\n    offsetPx += halfSizePx * vec2(-1., 1.);\n  }\n  float angle = ${this.symbolRotationExpression_};\n  ${this.symbolRotateWithView_?"angle += u_rotation;":""}\n  float c = cos(-angle);\n  float s = sin(-angle);\n  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);\n  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);\n  vec4 texCoord = ${this.texCoordExpression_};\n  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;\n  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;\n  v_texCoord = vec2(u, v);\n  v_hitColor = a_hitColor;\n  v_angle = angle;\n  c = cos(-v_angle);\n  s = sin(-v_angle);\n  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); \n  v_centerPx = screenToPx(center.xy) + centerOffsetPx;\n${this.attributes_.map((e=>`  ${e.varyingName} = ${e.varyingExpression};`)).join("\n")}\n}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nvarying vec2 v_texCoord;\nvarying vec4 v_hitColor;\nvarying vec2 v_centerPx;\nvarying float v_angle;\nvarying vec2 v_quadSizePx;\n${this.attributes_.map((e=>`varying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.fragmentShaderFunctions_.join("\n")}\n\nvoid main(void) {\n${this.attributes_.map((e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`)).join("\n")}\n  if (${this.discardExpression_}) { discard; }\n  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center\n  float c = cos(v_angle);\n  float s = sin(v_angle);\n  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);\n  gl_FragColor = ${this.symbolColorExpression_};\n  gl_FragColor.rgb *= gl_FragColor.a;\n  if (u_hitDetection > 0) {\n    if (gl_FragColor.a < 0.05) { discard; };\n    gl_FragColor = v_hitColor;\n  }\n}`:null}getStrokeVertexShader(){return this.hasStroke_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nattribute vec2 a_segmentStart;\nattribute vec2 a_segmentEnd;\nattribute float a_measureStart;\nattribute float a_measureEnd;\nattribute float a_parameters;\nattribute float a_distance;\nattribute vec2 a_joinAngles;\nattribute vec4 a_hitColor;\n\nvarying vec2 v_segmentStart;\nvarying vec2 v_segmentEnd;\nvarying float v_angleStart;\nvarying float v_angleEnd;\nvarying float v_width;\nvarying vec4 v_hitColor;\nvarying float v_distanceOffsetPx;\nvarying float v_measureStart;\nvarying float v_measureEnd;\n\n${this.attributes_.map((e=>`attribute ${e.type} ${e.name};\nvarying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.vertexShaderFunctions_.join("\n")}\nvec2 worldToPx(vec2 worldPos) {\n  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);\n  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;\n}\n\nvec4 pxToScreen(vec2 pxPos) {\n  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;\n  return vec4(screenPos, u_depth, 1.0);\n}\n\nbool isCap(float joinAngle) {\n  return joinAngle < -0.1;\n}\n\nvec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {\n  float halfAngle = joinAngle / 2.0;\n  float c = cos(halfAngle);\n  float s = sin(halfAngle);\n  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);\n  float length = 1.0 / s;\n  return angleBisectorNormal * length;\n}\n\nvec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {\n  // if on a cap or the join angle is too high, offset the line along the segment normal\n  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {\n    return point - normal * offsetPx;\n  }\n  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)\n  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;\n}\n\nvoid main(void) {\n  v_angleStart = a_joinAngles.x;\n  v_angleEnd = a_joinAngles.y;\n  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);\n  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;\n  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)\n  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);\n\n  float lineWidth = ${this.strokeWidthExpression_};\n  float lineOffsetPx = ${this.strokeOffsetExpression_};\n\n  // compute segment start/end in px with offset\n  vec2 segmentStartPx = worldToPx(a_segmentStart);\n  vec2 segmentEndPx = worldToPx(a_segmentEnd);\n  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);\n  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);\n  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),\n  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);\n  \n  // compute current vertex position\n  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;\n  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;\n  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;\n  vec2 joinDirection;\n  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;\n  // if angle is too high, do not make a proper join\n  if (cos(angle) > 0.985 || isCap(angle)) {\n    joinDirection = normalPx * normalDir - tangentPx * tangentDir;\n  } else {\n    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);\n  }\n  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing\n  gl_Position = pxToScreen(positionPx);\n\n  v_segmentStart = segmentStartPx;\n  v_segmentEnd = segmentEndPx;\n  v_width = lineWidth;\n  v_hitColor = a_hitColor;\n  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);\n  v_measureStart = a_measureStart;\n  v_measureEnd = a_measureEnd;\n${this.attributes_.map((e=>`  ${e.varyingName} = ${e.varyingExpression};`)).join("\n")}\n}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nvarying vec2 v_segmentStart;\nvarying vec2 v_segmentEnd;\nvarying float v_angleStart;\nvarying float v_angleEnd;\nvarying float v_width;\nvarying vec4 v_hitColor;\nvarying float v_distanceOffsetPx;\nvarying float v_measureStart;\nvarying float v_measureEnd;\n${this.attributes_.map((e=>`varying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.fragmentShaderFunctions_.join("\n")}\n\nvec2 pxToWorld(vec2 pxPos) {\n  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;\n  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;\n}\n\nbool isCap(float joinAngle) {\n  return joinAngle < -0.1;\n}\n\nfloat segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {\n  vec2 tangent = normalize(end - start);\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 startToPoint = point - start;\n  return abs(dot(startToPoint, normal)) - width * 0.5;\n}\n\nfloat buttCapDistanceField(vec2 point, vec2 start, vec2 end) {\n  vec2 startToPoint = point - start;\n  vec2 tangent = normalize(end - start);\n  return dot(startToPoint, -tangent);\n}\n\nfloat squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {\n  return buttCapDistanceField(point, start, end) - width * 0.5;\n}\n\nfloat roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {\n  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment\n  return length(point - start) - width * 0.5 - onSegment;\n}\n\nfloat roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {\n  return roundCapDistanceField(point, start, end, width);\n}\n\nfloat bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {\n  vec2 startToPoint = point - start;\n  vec2 tangent = normalize(end - start);\n  float c = cos(joinAngle * 0.5);\n  float s = sin(joinAngle * 0.5);\n  float direction = -sign(sin(joinAngle));\n  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);\n  float radius = width * 0.5 * s;\n  return dot(startToPoint, bisector * direction) - radius;\n}\n\nfloat miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {\n  if (cos(joinAngle) > 0.985) { // avoid risking a division by zero\n    return bevelJoinField(point, start, end, width, joinAngle);\n  }\n  float miterLength = 1. / sin(joinAngle * 0.5);\n  float miterLimit = ${this.strokeMiterLimitExpression_};\n  if (miterLength > miterLimit) {\n    return bevelJoinField(point, start, end, width, joinAngle);\n  }\n  return -1000.;\n}\n\nfloat capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {\n   if (capType == ${zg("butt")}) {\n    return buttCapDistanceField(point, start, end);\n  } else if (capType == ${zg("square")}) {\n    return squareCapDistanceField(point, start, end, width);\n  }\n  return roundCapDistanceField(point, start, end, width);\n}\n\nfloat joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {\n  if (joinType == ${zg("bevel")}) {\n    return bevelJoinField(point, start, end, width, joinAngle);\n  } else if (joinType == ${zg("miter")}) {\n    return miterJoinDistanceField(point, start, end, width, joinAngle);\n  }\n  return roundJoinDistanceField(point, start, end, width);\n}\n\nfloat computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {\n  if (isCap(joinAngle)) {\n    return capDistanceField(point, start, end, width, capType);\n  }\n  return joinDistanceField(point, start, end, width, joinAngle, joinType);\n}\n\nfloat distanceFromSegment(vec2 point, vec2 start, vec2 end) {\n  vec2 tangent = end - start;\n  vec2 startToPoint = point - start;\n  // inspire by capsule fn in https://iquilezles.org/articles/distfunctions/\n  float h = clamp(dot(startToPoint, tangent) / dot(tangent, tangent), 0.0, 1.0);\n  return length(startToPoint - tangent * h);\n}\n\nvoid main(void) {\n${this.attributes_.map((e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`)).join("\n")}\n      \n  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  vec2 worldPos = pxToWorld(currentPoint);\n  if (\n    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (\n      worldPos[0] < u_renderExtent[0] ||\n      worldPos[1] < u_renderExtent[1] ||\n      worldPos[0] > u_renderExtent[2] ||\n      worldPos[1] > u_renderExtent[3]\n    )\n  ) {\n    discard;\n  }\n  #endif\n\n  float segmentLength = length(v_segmentEnd - v_segmentStart);\n  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;\n  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);\n  vec2 startToPoint = currentPoint - v_segmentStart;\n  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));\n  float currentLengthPx = lengthToPoint + v_distanceOffsetPx;\n  float currentRadiusPx = distanceFromSegment(currentPoint, v_segmentStart, v_segmentEnd);\n  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;\n  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPoint / segmentLength);\n\n  if (${this.discardExpression_}) { discard; }\n\n  float capType = ${this.strokeCapExpression_};\n  float joinType = ${this.strokeJoinExpression_};\n  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);\n  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);\n  float distanceField = max(\n    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),\n    max(segmentStartDistance, segmentEndDistance)\n  );\n  distanceField = max(distanceField, ${this.strokeDistanceFieldExpression_});\n\n  vec4 color = ${this.strokeColorExpression_};\n  color.a *= smoothstep(0.5, -0.5, distanceField);\n  gl_FragColor = color;\n  gl_FragColor.a *= u_globalAlpha;\n  gl_FragColor.rgb *= gl_FragColor.a;\n  if (u_hitDetection > 0) {\n    if (gl_FragColor.a < 0.1) { discard; };\n    gl_FragColor = v_hitColor;\n  }\n}`:null}getFillVertexShader(){return this.hasFill_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nattribute vec2 a_position;\nattribute vec4 a_hitColor;\n\nvarying vec4 v_hitColor;\n\n${this.attributes_.map((e=>`attribute ${e.type} ${e.name};\nvarying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.vertexShaderFunctions_.join("\n")}\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);\n  v_hitColor = a_hitColor;\n${this.attributes_.map((e=>`  ${e.varyingName} = ${e.varyingExpression};`)).join("\n")}\n}`:null}getFillFragmentShader(){return this.hasFill_?`${tf}\n${this.uniforms_.map((e=>`uniform ${e};`)).join("\n")}\nvarying vec4 v_hitColor;\n${this.attributes_.map((e=>`varying ${e.varyingType} ${e.varyingName};`)).join("\n")}\n${this.fragmentShaderFunctions_.join("\n")}\nvec2 pxToWorld(vec2 pxPos) {\n  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;\n  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;\n}\n\nvec2 worldToPx(vec2 worldPos) {\n  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);\n  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;\n}\n\nvoid main(void) {\n${this.attributes_.map((e=>`  ${e.varyingType} ${e.name} = ${e.varyingName}; // assign to original attribute name`)).join("\n")}\n  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;\n  vec2 pxOrigin = worldToPx(u_patternOrigin);\n  #ifdef GL_FRAGMENT_PRECISION_HIGH\n  vec2 worldPos = pxToWorld(pxPos);\n  if (\n    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (\n      worldPos[0] < u_renderExtent[0] ||\n      worldPos[1] < u_renderExtent[1] ||\n      worldPos[0] > u_renderExtent[2] ||\n      worldPos[1] > u_renderExtent[3]\n    )\n  ) {\n    discard;\n  }\n  #endif\n  if (${this.discardExpression_}) { discard; }\n  gl_FragColor = ${this.fillColorExpression_};\n  gl_FragColor.a *= u_globalAlpha;\n  gl_FragColor.rgb *= gl_FragColor.a;\n  if (u_hitDetection > 0) {\n    if (gl_FragColor.a < 0.1) { discard; };\n    gl_FragColor = v_hitColor;\n  }\n}`:null}}function uf(e,t,r){return function(e,t,r,n){return ef(Wr(e,t,r),t,n)}(t,r,qr(),e)}function hf(e){const t=wr(e);return[256*t[0]+t[1],256*t[2]+Math.round(255*t[3])]}function df(e){return e===Mr||e===Rr?2:e===Ir?4:1}function pf(e){const t=df(e);return t>1?`vec${t}`:"float"}function gf(e,t){for(const r in t.variables){const n=t.variables[r],i=Yg(n.name);let o=pf(n.type);n.type===Mr&&(o="vec4"),e.addUniform(`${o} ${i}`)}for(const r in t.properties){const n=t.properties[r],i=pf(n.type),o=`a_prop_${n.name}`;n.type===Mr?(e.addAttribute(o,i,`unpackColor(${o})`,"vec4"),e.addVertexShaderFunction("vec4 unpackColor(vec2 packedColor) {\n  return vec4(\n    fract(floor(packedColor[0] / 256.0) / 256.0),\n    fract(packedColor[0] / 256.0),\n    fract(floor(packedColor[1] / 256.0) / 256.0),\n    fract(packedColor[1] / 256.0)\n  );\n}")):e.addAttribute(o,i)}for(const r in t.functions)e.addVertexShaderFunction(t.functions[r]),e.addFragmentShaderFunction(t.functions[r])}function ff(e,t){const r={};for(const n in e.variables){const i=e.variables[n];r[Yg(i.name)]=()=>{const e=t[i.name];return"number"==typeof e?e:"boolean"==typeof e?e?1:0:i.type===Mr?wr(e||"#eee"):"string"==typeof e?Vg(e):e}}return r}function mf(e){const t={};for(const r in e.properties){const n=e.properties[r],i=e=>{const t=e.get(n.name);return n.type===Mr?hf([...wr(t||"#eee")]):"string"==typeof t?Vg(t):"boolean"==typeof t?t?1:0:t};t[`prop_${n.name}`]={size:df(n.type),callback:i}}return t}var yf=r(3402);class vf{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let r=0;r<e.length;r++)this.addFeature(e[r],t)}addFeature(e,t){let r=e.getGeometry();r&&(t&&(r=r.clone(),r.applyTransform(t)),this.addGeometry_(r,e))}clearFeatureEntryInPointBatch_(e){const t=(0,n.v6)(e),r=this.pointBatch.entries[t];if(r)return this.pointBatch.geometriesCount-=r.flatCoordss.length,delete this.pointBatch.entries[t],r}clearFeatureEntryInLineStringBatch_(e){const t=(0,n.v6)(e),r=this.lineStringBatch.entries[t];if(r)return this.lineStringBatch.verticesCount-=r.verticesCount,this.lineStringBatch.geometriesCount-=r.flatCoordss.length,delete this.lineStringBatch.entries[t],r}clearFeatureEntryInPolygonBatch_(e){const t=(0,n.v6)(e),r=this.polygonBatch.entries[t];if(r)return this.polygonBatch.verticesCount-=r.verticesCount,this.polygonBatch.ringsCount-=r.ringsCount,this.polygonBatch.geometriesCount-=r.flatCoordss.length,delete this.polygonBatch.entries[t],r}addGeometry_(e,t){const r=e.getType();switch(r){case"GeometryCollection":{const r=e.getGeometriesArray();for(const e of r)this.addGeometry_(e,t);break}case"MultiPolygon":{const i=e;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEndss(),t,(0,n.v6)(t),i.getStride());break}case"MultiLineString":{const i=e;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEnds(),t,(0,n.v6)(t),i.getStride());break}case"MultiPoint":{const i=e;this.addCoordinates_(r,i.getFlatCoordinates(),null,t,(0,n.v6)(t),i.getStride());break}case"Polygon":{const i=e;this.addCoordinates_(r,i.getFlatCoordinates(),i.getEnds(),t,(0,n.v6)(t),i.getStride());break}case"Point":{const i=e;this.addCoordinates_(r,i.getFlatCoordinates(),null,t,(0,n.v6)(t),i.getStride());break}case"LineString":case"LinearRing":{const i=e,o=i.getStride();this.addCoordinates_(r,i.getFlatCoordinates(),null,t,(0,n.v6)(t),o,i.getLayout?.());break}}}addCoordinates_(e,t,r,n,i,o,a){let s;switch(e){case"MultiPolygon":{const e=r;for(let r=0,s=e.length;r<s;r++){let s=e[r];const l=r>0?e[r-1]:null,c=l?l[l.length-1]:0,u=s[s.length-1];s=c>0?s.map((e=>e-c)):s,this.addCoordinates_("Polygon",t.slice(c,u),s,n,i,o,a)}break}case"MultiLineString":{const e=r;for(let r=0,s=e.length;r<s;r++){const s=r>0?e[r-1]:0;this.addCoordinates_("LineString",t.slice(s,e[r]),null,n,i,o,a)}break}case"MultiPoint":for(let e=0,r=t.length;e<r;e+=o)this.addCoordinates_("Point",t.slice(e,e+2),null,n,i,null,null);break;case"Polygon":{const e=r;if(n instanceof Qs.Ay){const r=(0,yf.yJ)(t,e);if(r.length>1)return void this.addCoordinates_("MultiPolygon",t,r,n,i,o,a)}this.polygonBatch.entries[i]||(this.polygonBatch.entries[i]=this.addRefToEntry_(i,{feature:n,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),s=t.length/o;const l=r.length,c=r.map(((e,t,r)=>t>0?(e-r[t-1])/o:e/o));this.polygonBatch.verticesCount+=s,this.polygonBatch.ringsCount+=l,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[i].flatCoordss.push(function(e,t){return 2===t?e:e.filter(((e,r)=>r%t<2))}(t,o)),this.polygonBatch.entries[i].ringsVerticesCounts.push(c),this.polygonBatch.entries[i].verticesCount+=s,this.polygonBatch.entries[i].ringsCount+=l;for(let r=0,s=e.length;r<s;r++){const s=r>0?e[r-1]:0;this.addCoordinates_("LinearRing",t.slice(s,e[r]),null,n,i,o,a)}break}case"Point":this.pointBatch.entries[i]||(this.pointBatch.entries[i]=this.addRefToEntry_(i,{feature:n,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[i].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[i]||(this.lineStringBatch.entries[i]=this.addRefToEntry_(i,{feature:n,flatCoordss:[],verticesCount:0})),s=t.length/o,this.lineStringBatch.verticesCount+=s,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[i].flatCoordss.push(function(e,t,r){return 3===t&&"XYM"===r?e:4===t?e.filter(((e,r)=>r%t!=2)):3===t?e.map(((e,r)=>r%t!=2?e:0)):new Array(1.5*e.length).fill(0).map(((t,r)=>r%3==2?0:e[Math.round(r/1.5)]))}(t,o,a)),this.lineStringBatch.entries[i].verticesCount+=s}}addRefToEntry_(e,t){const r=this.uidToRef_.get(e),n=r||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=n,r||(this.refToFeature_.set(n,t.feature),this.uidToRef_.set(e,n)),t}removeRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e){if(!this.uidToRef_.get((0,n.v6)(e)))return;this.removeFeature(e);const t=e.getGeometry();t&&this.addGeometry_(t,e)}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.removeRef_(t.ref,(0,n.v6)(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return 0===this.globalCounter_}filter(e){const t=new vf;t.globalCounter_=this.globalCounter_,t.uidToRef_=this.uidToRef_,t.refToFeature_=this.refToFeature_;let r=!0;for(const n of this.refToFeature_.values())e(n)&&(t.addFeature(n),r=!1);return r?new vf:t}}const Af=vf;function Sf(e,t,r,n){let i=0;for(const o in t){const a=t[o],s=a.callback.call(r,r.feature);let l=s?.[0]??s;l===Zg&&console.warn('The "has" operator might return false positives.'),void 0===l?l=Zg:null===l&&(l=0),e[n+i++]=l,a.size&&1!==a.size&&(e[n+i++]=s[1],a.size<3||(e[n+i++]=s[2],a.size<4||(e[n+i++]=s[3])))}return i}function Ef(e){return Object.keys(e).reduce(((t,r)=>t+(e[r].size||1)),0)}function wf(e){return(JSON.stringify(e).split("").reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0)>>>0).toString()}function _f(e,t,r,n){if(`${n}radius`in e&&"icon-"!==n){let i=uf(r,e[`${n}radius`],xr);`${n}radius2`in e&&(i=`max(${i}, ${uf(r,e[`${n}radius2`],xr)})`),`${n}stroke-width`in e&&(i=`(${i} + ${uf(r,e[`${n}stroke-width`],xr)} * 0.5)`),t.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in e){const i=uf(r,e[`${n}scale`],Rr);t.setSymbolSizeExpression(`${t.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in e&&t.setSymbolOffsetExpression(uf(r,e[`${n}displacement`],Ir)),`${n}rotation`in e&&t.setSymbolRotationExpression(uf(r,e[`${n}rotation`],xr)),`${n}rotate-with-view`in e&&t.setSymbolRotateWithView(!!e[`${n}rotate-with-view`])}function Lf(e,t,r,n,i){let o="vec4(0.)";null!==t&&(o=t),null!==r&&null!==n&&(o=`mix(${r}, ${o}, smoothstep(-${n} + 0.63, -${n} - 0.58, ${e}))`);let a=`${o} * vec4(1.0, 1.0, 1.0, (1.0 - smoothstep(-0.63, 0.58, ${e})))`;return null!==i&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function Cf(e,t,r,n,i){const o=new Image;o.crossOrigin=void 0===e[`${n}cross-origin`]?"anonymous":e[`${n}cross-origin`],(0,B.v)("string"==typeof e[`${n}src`],`WebGL layers do not support expressions for the ${n}src style property`),o.src=e[`${n}src`],r[`u_texture${i}_size`]=()=>o.complete?[o.width,o.height]:[0,0],t.addUniform(`vec2 u_texture${i}_size`);const a=`u_texture${i}_size`;return r[`u_texture${i}`]=o,t.addUniform(`sampler2D u_texture${i}`),a}function bf(e,t,r,n,i){let o=uf(r,e[`${t}offset`],Ir);if(`${t}offset-origin`in e)switch(e[`${t}offset-origin`]){case"top-right":o=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${o} * vec2(-1., 1.)`;break;case"bottom-left":o=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${o} * vec2(1., -1.)`;break;case"bottom-right":o=`${n} - ${i} - ${o}`}return o}const Tf=[];let xf;function Pf(){return xf||(xf=function(){const e='function t(t,n,x=2){const o=n&&n.length,i=o?n[0]*x:t.length;let u=e(t,0,i,x,!0);const l=[];if(!u||u.next===u.prev)return l;let c,h,y;if(o&&(u=function(t,n,r,x){const o=[];for(let r=0,i=n.length;r<i;r++){const u=e(t,n[r]*x,r<i-1?n[r+1]*x:t.length,x,!1);u===u.next&&(u.steiner=!0),o.push(a(u))}o.sort(f);for(let t=0;t<o.length;t++)r=s(o[t],r);return r}(t,n,u,x)),t.length>80*x){c=1/0,h=1/0;let e=-1/0,n=-1/0;for(let r=x;r<i;r+=x){const x=t[r],o=t[r+1];x<c&&(c=x),o<h&&(h=o),x>e&&(e=x),o>n&&(n=o)}y=Math.max(e-c,n-h),y=0!==y?32767/y:0}return r(u,l,x,c,h,y,0),l}function e(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=w(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=w(x/r|0,t[x],t[x+1],o);return o&&g(o,o.next)&&(A(o),o=o.next),o}function n(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!g(r,r.next)&&0!==v(r.prev,r,r.next))r=r.next;else{if(A(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function r(t,e,f,s,l,a,h){if(!t)return;!h&&a&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=c(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,s,l,a);let y=t;for(;t.prev!==t.next;){const c=t.prev,p=t.next;if(a?o(t,s,l,a):x(t))e.push(c.i,t.i,p.i),A(t),t=p.next,y=p.next;else if((t=p)===y){h?1===h?r(t=i(n(t),e),e,f,s,l,a,2):2===h&&u(t,e,f,s,l,a):r(n(t),e,f,s,l,a,1);break}}}function x(t){const e=t.prev,n=t,r=t.next;if(v(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let p=r.next;for(;p!==e;){if(p.x>=l&&p.x<=a&&p.y>=c&&p.y<=h&&y(x,u,o,f,i,s,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function o(t,e,n,r){const x=t.prev,o=t,i=t.next;if(v(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,a=o.y,h=i.y,p=Math.min(u,f,s),g=Math.min(l,a,h),b=Math.max(u,f,s),M=Math.max(l,a,h),m=c(p,g,e,n,r),Z=c(b,M,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=p&&d.x<=b&&d.y>=g&&d.y<=M&&d!==x&&d!==i&&y(u,l,f,a,s,h,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=p&&w.x<=b&&w.y>=g&&w.y<=M&&w!==x&&w!==i&&y(u,l,f,a,s,h,w.x,w.y)&&v(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function i(t,e){let r=t;do{const n=r.prev,x=r.next.next;!g(n,x)&&b(n,r,r.next,x)&&Z(n,x)&&Z(x,n)&&(e.push(n.i,r.i,x.i),A(r),A(r.next),r=t=x),r=r.next}while(r!==t);return n(r)}function u(t,e,x,o,i,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&p(f,t)){let s=d(f,t);return f=n(f,f.next),s=n(s,s.next),r(f,e,x,o,i,u,0),void r(s,e,x,o,i,u,0)}t=t.next}f=f.next}while(f!==t)}function f(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function s(t,e){const r=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(g(t,n))return n;do{if(g(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let c=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&h(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);Z(n,t)&&(e<c||e===c&&(n.x>o.x||n.x===o.x&&l(o,n)))&&(o=n,c=e)}n=n.next}while(n!==u);return o}(t,e);if(!r)return e;const x=d(r,t);return n(x,x.next),n(r,r.next)}function l(t,e){return v(t.prev,t,e.prev)<0&&v(e.next,t,t.next)<0}function c(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function h(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function y(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&h(t,e,n,r,x,o,i,u)}function p(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&b(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Z(t,e)&&Z(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(v(t.prev,t,e.prev)||v(t,e.prev,e))||g(t,e)&&v(t.prev,t,t.next)>0&&v(e.prev,e,e.next)>0)}function v(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function b(t,e,n,r){const x=m(v(t,e,n)),o=m(v(t,e,r)),i=m(v(n,r,t)),u=m(v(n,r,e));return x!==o&&i!==u||(!(0!==x||!M(t,n,e))||(!(0!==o||!M(t,r,e))||(!(0!==i||!M(n,t,r))||!(0!==u||!M(n,e,r)))))}function M(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function m(t){return t>0?1:t<0?-1:0}function Z(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function d(t,e){const n=E(t.i,t.x,t.y),r=E(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function w(t,e,n,r){const x=E(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function A(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function E(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function I(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function z(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const F=[],P={vertexPosition:0,indexPosition:0};function B(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function N(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=F;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return B(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,B(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,P.vertexPosition=l,P.indexPosition=c,P}function R(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=I(f,[...h]),b=I(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,I(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,I(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function S(e,n,r,x,o){const i=2+o;let u=n;const f=e.slice(u,u+o);u+=o;const s=e[u++];let l=0;const c=new Array(s-1);for(let t=0;t<s;t++)l+=e[u++],t<s-1&&(c[t]=l);const a=e.slice(u,u+2*l),h=t(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+r.length/i);for(let t=0;t<a.length;t+=2)r.push(a[t],a[t+1],...f);return u+2*l}const T="GENERATE_POLYGON_BUFFERS",_="GENERATE_POINT_BUFFERS",O="GENERATE_LINE_STRING_BUFFERS",U=self;U.onmessage=t=>{const e=t.data;switch(e.type){case _:{const t=3,n=2,r=e.customAttributesSize,x=n+r,o=new Float32Array(e.renderInstructions),i=o.length/x,u=4*i*(r+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=x)l=N(o,t,s,f,r,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},e);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case O:{const t=[],n=[],r=e.customAttributesSize,x=3,o=new Float32Array(e.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(z(u,e.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+r)),i+=r,f=o[i++];const e=i,l=i+(f-1)*x,c=o[e]===o[l]&&o[e+1]===o[l+1];let a=0,h=0;for(let r=0;r<f-1;r++){let y=null;r>0?y=i+(r-1)*x:c&&(y=l-x);let p=null;r<f-2?p=i+(r+2)*x:c&&(p=e+x);const v=R(o,i+r*x,i+(r+1)*x,y,p,t,n,s,u,a,h);a=v.length,h=v.angle}i+=f*x}const l=Uint32Array.from(n),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},e);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case T:{const t=[],n=[],r=e.customAttributesSize,x=new Float32Array(e.renderInstructions);let o=0;for(;o<x.length;)o=S(x,o,t,n,r);const i=Uint32Array.from(n),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:x.buffer},e);U.postMessage(f,[u.buffer,i.buffer,x.buffer]);break}}};';return new Worker("undefined"==typeof Blob?"data:application/javascript;base64,"+Buffer.from(e,"binary").toString("base64"):URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}()),xf}let Mf=0;const If="a_position",Rf=class{constructor(e,t,r,n,i){this.helper_,this.hitDetectionEnabled_=!!n;let o=e;if(!("builder"in e)){const r=e,n=function(e,t,r){const n={variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1},i=new cf,o={};if("icon-src"in e?function(e,t,r,n){let i="vec4(1.0)";"icon-color"in e&&(i=uf(n,e["icon-color"],Mr)),"icon-opacity"in e&&(i=`${i} * vec4(1.0, 1.0, 1.0, ${uf(n,e["icon-opacity"],xr)})`);const o=wf(e["icon-src"]),a=Cf(e,t,r,"icon-",o);if(t.setSymbolColorExpression(`${i} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in e&&"icon-height"in e&&t.setSymbolSizeExpression(`vec2(${uf(n,e["icon-width"],xr)}, ${uf(n,e["icon-height"],xr)})`),"icon-offset"in e&&"icon-size"in e){const r=uf(n,e["icon-size"],Ir),i=t.getSymbolSizeExpression();t.setSymbolSizeExpression(r);const o=bf(e,"icon-",n,"v_quadSizePx",r);t.setTextureCoordinateExpression(`(vec4((${o}).xyxy) + vec4(0., 0., ${r})) / (${i}).xyxy`)}if(_f(e,t,n,"icon-"),"icon-anchor"in e){const r=uf(n,e["icon-anchor"],Ir);let i,o="1.0";"icon-scale"in e&&(o=uf(n,e["icon-scale"],Rr)),i="pixels"===e["icon-anchor-x-units"]&&"pixels"===e["icon-anchor-y-units"]?`${r} * ${o}`:"pixels"===e["icon-anchor-x-units"]?`${r} * vec2(vec2(${o}).x, v_quadSizePx.y)`:"pixels"===e["icon-anchor-y-units"]?`${r} * vec2(v_quadSizePx.x, vec2(${o}).x)`:`${r} * v_quadSizePx`;let a=`v_quadSizePx * vec2(0.5, -0.5) + ${i} * vec2(-1., 1.)`;if("icon-anchor-origin"in e)switch(e["icon-anchor-origin"]){case"top-right":a=`v_quadSizePx * -0.5 + ${i}`;break;case"bottom-left":a=`v_quadSizePx * 0.5 - ${i}`;break;case"bottom-right":a=`v_quadSizePx * vec2(-0.5, 0.5) + ${i} * vec2(1., -1.)`}t.setSymbolOffsetExpression(`${t.getSymbolOffsetExpression()} + ${a}`)}}(e,i,o,n):"shape-points"in e?function(e,t,r,n){n.functions.round="float round(float v) {\n  return sign(v) * floor(abs(v) + 0.5);\n}",n.functions.starDistanceField="float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {\n  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle\n  float c = cos(startAngle);\n  float s = sin(startAngle);\n  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);\n  float alpha = TWO_PI / numPoints; // the angle of one sector\n  float beta = atan(pointRotated.y, pointRotated.x);\n  float gamma = round(beta / alpha) * alpha; // angle in sector\n  c = cos(-gamma);\n  s = sin(-gamma);\n  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));\n  vec2 tipToPoint = inSector + vec2(-radius, 0.);\n  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);\n  return dot(normalize(edgeNormal), tipToPoint);\n}",n.functions.regularDistanceField="float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {\n  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle\n  float c = cos(startAngle);\n  float s = sin(startAngle);\n  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);\n  float alpha = TWO_PI / numPoints; // the angle of one sector\n  float radiusIn = radius * cos(PI / numPoints);\n  float beta = atan(pointRotated.y, pointRotated.x);\n  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid\n  c = cos(-gamma);\n  s = sin(-gamma);\n  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));\n  return inSector.x - radiusIn;\n}",_f(e,t,n,"shape-");let i=null;"shape-opacity"in e&&(i=uf(n,e["shape-opacity"],xr));let o="coordsPx";"shape-scale"in e&&(o=`coordsPx / ${uf(n,e["shape-scale"],Rr)}`);let a=null;"shape-fill-color"in e&&(a=uf(n,e["shape-fill-color"],Mr));let s=null;"shape-stroke-color"in e&&(s=uf(n,e["shape-stroke-color"],Mr));let l=null;"shape-stroke-width"in e&&(l=uf(n,e["shape-stroke-width"],xr));const c=uf(n,e["shape-points"],xr);let u,h="0.";"shape-angle"in e&&(h=uf(n,e["shape-angle"],xr));let d=uf(n,e["shape-radius"],xr);if(null!==l&&(d=`${d} + ${l} * 0.5`),"shape-radius2"in e){let t=uf(n,e["shape-radius2"],xr);null!==l&&(t=`${t} + ${l} * 0.5`),u=`starDistanceField(${o}, ${c}, ${d}, ${t}, ${h})`}else u=`regularDistanceField(${o}, ${c}, ${d}, ${h})`;const p=Lf(u,a,s,l,i);t.setSymbolColorExpression(p)}(e,i,0,n):"circle-radius"in e&&function(e,t,r,n){n.functions.circleDistanceField="float circleDistanceField(vec2 point, float radius) {\n  return length(point) - radius;\n}",_f(e,t,n,"circle-");let i=null;"circle-opacity"in e&&(i=uf(n,e["circle-opacity"],xr));let o="coordsPx";"circle-scale"in e&&(o=`coordsPx / ${uf(n,e["circle-scale"],Rr)}`);let a=null;"circle-fill-color"in e&&(a=uf(n,e["circle-fill-color"],Mr));let s=null;"circle-stroke-color"in e&&(s=uf(n,e["circle-stroke-color"],Mr));let l=uf(n,e["circle-radius"],xr),c=null;"circle-stroke-width"in e&&(c=uf(n,e["circle-stroke-width"],xr),l=`(${l} + ${c} * 0.5)`);const u=Lf(`circleDistanceField(${o}, ${l})`,a,s,c,i);t.setSymbolColorExpression(u)}(e,i,0,n),function(e,t,r,n){if("stroke-color"in e&&t.setStrokeColorExpression(uf(n,e["stroke-color"],Mr)),"stroke-pattern-src"in e){const i=wf(e["stroke-pattern-src"]),o=Cf(e,t,r,"stroke-pattern-",i);let a=o,s="vec2(0.)";"stroke-pattern-offset"in e&&"stroke-pattern-size"in e&&(a=uf(n,e["stroke-pattern-size"],Ir),s=bf(e,"stroke-pattern-",n,o,a));let l="0.";"stroke-pattern-spacing"in e&&(l=uf(n,e["stroke-pattern-spacing"],xr)),n.functions.sampleStrokePattern="vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {\n  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;\n  float spacingScaled = spacingPx * sampleSize.y / lineWidth;\n  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));\n  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels\n  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);\n  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;\n  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;\n  return texture2D(texture, texCoord);\n}";const c=`u_texture${i}`;let u="1.";"stroke-color"in e&&(u=t.getStrokeColorExpression()),t.setStrokeColorExpression(`${u} * sampleStrokePattern(${c}, ${o}, ${s}, ${a}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in e&&t.setStrokeWidthExpression(uf(n,e["stroke-width"],xr)),"stroke-offset"in e&&t.setStrokeOffsetExpression(uf(n,e["stroke-offset"],xr)),"stroke-line-cap"in e&&t.setStrokeCapExpression(uf(n,e["stroke-line-cap"],Pr)),"stroke-line-join"in e&&t.setStrokeJoinExpression(uf(n,e["stroke-line-join"],Pr)),"stroke-miter-limit"in e&&t.setStrokeMiterLimitExpression(uf(n,e["stroke-miter-limit"],xr)),"stroke-line-dash"in e){n.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType, float lineWidth) {\n  float localDistance = mod(distance, dashLengthTotal);\n  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;\n  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);\n  if (capType == ${zg("square")}) {\n    distanceSegment -= lineWidth * 0.5;\n  } else if (capType == ${zg("round")}) {\n    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - lineWidth * 0.5);\n  }\n  return distanceSegment;\n}`;let r=e["stroke-line-dash"].map((e=>uf(n,e,xr)));r.length%2==1&&(r=[...r,...r]);let i="0.";"stroke-line-dash-offset"in e&&(i=uf(n,e["stroke-line-dash-offset"],xr));const o=`dashDistanceField_${wf(e["stroke-line-dash"])}`,a=r.map(((e,t)=>`float dashLength${t} = ${e};`)),s=r.map(((e,t)=>`dashLength${t}`)).join(" + ");let l="0.",c=`getSingleDashDistance(distance, radius, ${l}, dashLength0, totalDashLength, capType, lineWidth)`;for(let e=2;e<r.length;e+=2)l=`${l} + dashLength${e-2} + dashLength${e-1}`,c=`min(${c}, getSingleDashDistance(distance, radius, ${l}, dashLength${e}, totalDashLength, capType, lineWidth))`;n.functions[o]=`float ${o}(float distance, float radius, float capType, float lineWidth) {\n  ${a.join("\n  ")}\n  float totalDashLength = ${s};\n  return ${c};\n}`,t.setStrokeDistanceFieldExpression(`${o}(currentLengthPx + ${i}, currentRadiusPx, capType, v_width)`)}}(e,i,o,n),function(e,t,r,n){if("fill-color"in e&&t.setFillColorExpression(uf(n,e["fill-color"],Mr)),"fill-pattern-src"in e){const i=wf(e["fill-pattern-src"]),o=Cf(e,t,r,"fill-pattern-",i);let a=o,s="vec2(0.)";"fill-pattern-offset"in e&&"fill-pattern-size"in e&&(a=uf(n,e["fill-pattern-size"],Ir),s=bf(e,"fill-pattern-",n,o,a)),n.functions.sampleFillPattern="vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {\n  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);\n  vec2 pxRelativePos = pxPosition - pxOrigin;\n  // rotate the relative position from origin by the current view rotation\n  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));\n  // sample position is computed according to the sample offset & size\n  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);\n  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels\n  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));\n  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright\n  return texture2D(texture, (samplePos + textureOffset) / textureSize);\n}";const l=`u_texture${i}`;let c="1.";"fill-color"in e&&(c=t.getFillColorExpression()),t.setFillColorExpression(`${c} * sampleFillPattern(${l}, ${o}, ${s}, ${a}, pxOrigin, pxPos)`)}}(e,i,o,n),r){const e=uf(n,r,Tr);i.setFragmentDiscardExpression(`!${e}`)}const a={};function s(e,t,r,o){if(!n[e])return;const s=pf(r),l=df(r);i.addAttribute(`a_${t}`,s),a[t]={size:l,callback:o}}return s("geometryType",Xg,Pr,(e=>Vg(zn(e.getGeometry())))),s("featureId",Kg,Pr|xr,(e=>{const t=e.getId()??null;return"string"==typeof t?Vg(t):t})),gf(i,n),{builder:i,attributes:{...a,...mf(n)},uniforms:{...o,...ff(n,t)}}}(r.style,t,r.filter);o={builder:n.builder,attributes:n.attributes,uniforms:n.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!o.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=o.builder.getFillVertexShader(),this.fillFragmentShader_=o.builder.getFillFragmentShader()),this.hasStroke_=!!o.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=o.builder.getStrokeVertexShader(),this.strokeFragmentShader_=o.builder.getStrokeFragmentShader()),this.hasSymbol_=!!o.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=o.builder.getSymbolVertexShader(),this.symbolFragmentShader_=o.builder.getSymbolFragmentShader()),this.featureFilter_=null,i&&(this.featureFilter_=this.computeFeatureFilter(i));const a=this.hitDetectionEnabled_?{hitColor:{callback(){return function(e,t){const r=256,n=255;return(t=t||[])[0]=Math.floor(e/r/r/r)/n,t[1]=Math.floor(e/r/r)%r/n,t[2]=Math.floor(e/r)%r/n,t[3]=e%r/n,t}(this.ref,Tf)},size:4}}:{};this.customAttributes_=Object.assign({},a,o.attributes),this.uniforms_=o.uniforms;const s=Object.entries(this.customAttributes_).map((([e,t])=>({name:`a_${e}`,size:t.size||1,type:Tg})));this.polygonAttributesDesc_=[{name:If,size:2,type:Tg},...s],this.lineStringAttributesDesc_=[{name:"a_segmentStart",size:2,type:Tg},{name:"a_measureStart",size:1,type:Tg},{name:"a_segmentEnd",size:2,type:Tg},{name:"a_measureEnd",size:1,type:Tg},{name:"a_joinAngles",size:2,type:Tg},{name:"a_distance",size:1,type:Tg},{name:"a_parameters",size:1,type:Tg},...s],this.pointAttributesDesc_=[{name:If,size:2,type:Tg},{name:"a_index",size:1,type:Tg},...s],this.setHelper(r)}computeFeatureFilter(e){const t=qr();let r;try{r=Yn(e,Tr,t)}catch{return null}if(t.mapState||t.variables.size>0)return null;const n={variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""};return e=>{if(n.properties=e.getPropertiesInternal(),t.featureId){const t=e.getId();n.featureId=void 0!==t?t:null}return n.geometryType=zn(e.getGeometry()),r(n)}}async generateBuffers(e,t){let r=e;if(this.featureFilter_&&(r=r.filter(this.featureFilter_),r.isEmpty()))return null;const n=this.generateRenderInstructions_(r,t),[i,o,a]=await Promise.all([this.generateBuffersForType_(n.polygonInstructions,"Polygon",t),this.generateBuffersForType_(n.lineStringInstructions,"LineString",t),this.generateBuffersForType_(n.pointInstructions,"Point",t)]);return{polygonBuffers:i,lineStringBuffers:o,pointBuffers:a,invertVerticesTransform:(0,So.T9)((0,So.vt)(),t)}}generateRenderInstructions_(e,t){const r=this.hasFill_?function(e,t,r,n){const i=2*e.verticesCount+(1+Ef(r))*e.geometriesCount+e.ringsCount;t&&t.length===i||(t=new Float32Array(i));const o=[];let a=0;for(const i in e.entries){const s=e.entries[i];for(let e=0,i=s.flatCoordss.length;e<i;e++){o.length=s.flatCoordss[e].length,(0,Ko.Rc)(s.flatCoordss[e],0,o.length,2,n,o),a+=Sf(t,r,s,a),t[a++]=s.ringsVerticesCounts[e].length;for(let r=0,n=s.ringsVerticesCounts[e].length;r<n;r++)t[a++]=s.ringsVerticesCounts[e][r];for(let e=0,r=o.length;e<r;e+=2)t[a++]=o[e],t[a++]=o[e+1]}}return t}(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,n=this.hasStroke_?function(e,t,r,n){const i=3*e.verticesCount+(1+Ef(r))*e.geometriesCount;t&&t.length===i||(t=new Float32Array(i));const o=[];let a=0;for(const i in e.entries){const s=e.entries[i];for(let e=0,i=s.flatCoordss.length;e<i;e++){o.length=s.flatCoordss[e].length,(0,Ko.Rc)(s.flatCoordss[e],0,o.length,3,n,o,3),a+=Sf(t,r,s,a),t[a++]=o.length/3;for(let e=0,r=o.length;e<r;e+=3)t[a++]=o[e],t[a++]=o[e+1],t[a++]=o[e+2]}}return t}(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasSymbol_?function(e,t,r,n){const i=(2+Ef(r))*e.geometriesCount;t&&t.length===i||(t=new Float32Array(i));const o=[];let a=0;for(const i in e.entries){const s=e.entries[i];for(let e=0,i=s.flatCoordss.length;e<i;e++)o[0]=s.flatCoordss[e][0],o[1]=s.flatCoordss[e][1],(0,So.Bb)(n,o),t[a++]=o[0],t[a++]=o[1],a+=Sf(t,r,s,a)}return t}(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:r,lineStringInstructions:n,pointInstructions:i}}generateBuffersForType_(e,t,r){if(null===e)return null;const n=Mf++;let i;switch(t){case"Polygon":i="GENERATE_POLYGON_BUFFERS";break;case"LineString":i="GENERATE_LINE_STRING_BUFFERS";break;case"Point":i="GENERATE_POINT_BUFFERS"}const o={id:n,type:i,renderInstructions:e.buffer,renderInstructionsTransform:r,customAttributesSize:Ef(this.customAttributes_)},a=Pf();return a.postMessage(o,[e.buffer]),e=null,new Promise((e=>{const t=r=>{const i=r.data;if(i.id!==n)return;if(a.removeEventListener("message",t),!this.helper_.getGL())return;const o=new wg(yg,35048).fromArrayBuffer(i.vertexBuffer),s=new wg(vg,35048).fromArrayBuffer(i.indexBuffer);this.helper_.flushBufferData(o),this.helper_.flushBufferData(s),e([s,o])};a.addEventListener("message",t)}))}render(e,t,r){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,r),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,r),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,r)}renderInternal_(e,t,r,n,i,o){const a=e.getSize();0!==a&&(this.helper_.useProgram(r,i),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(n),o(),this.helper_.drawElements(0,a))}setHelper(e,t=null){this.helper_=e,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1])))}},Of=new Uint8Array(4),Df=class{constructor(e,t){this.helper_=e;const r=e.getGL();this.texture_=r.createTexture(),this.framebuffer_=r.createFramebuffer(),this.depthbuffer_=r.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){(0,V.aI)(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return Of[0]=0,Of[1]=0,Of[2]=0,Of[3]=0,Of;this.readAll();const r=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return Of[0]=this.data_[4*r],Of[1]=this.data_[4*r+1],Of[2]=this.data_[4*r+2],Of[3]=this.data_[4*r+3],Of}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}},Nf={...bg,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"},kf=class extends Ng{constructor(e,t){super(e,{uniforms:{[Nf.RENDER_EXTENT]:[0,0,0,0],[Nf.PATTERN_ORIGIN]:[0,0],[Nf.GLOBAL_ALPHA]:1},postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=(0,ee.S5)(),this.currentTransform_=(0,So.vt)(),this.tmpCoords_=[0,0],this.tmpTransform_=(0,So.vt)(),this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.currentFrameStateTransform_=(0,So.vt)(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new Af,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource(),r=(0,ne.Tf)();let n;r&&(n=(0,ne.FO)(r,e.viewState.projection)),this.batch_.addFeatures(t.getFeatures(),n),this.sourceListenKeys_=[(0,v.KT)(t,Jd.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,n)),(0,v.KT)(t,Jd.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,v.KT)(t,Jd.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,v.KT)(t,Jd.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=function(e){const t=Array.isArray(e)?e:[e];if("style"in t[0]){const e=[],r=t,n=[];for(const t of r){const r=Array.isArray(t.style)?t.style:[t.style];let i=t.filter;t.else&&n.length&&(i=["all",...n.map((e=>["!",e]))],t.filter&&i.push(t.filter),i.length<3&&(i=i[1])),t.filter&&n.push(t.filter);const o=r.map((e=>({style:e,...i&&{filter:i}})));e.push(...o)}return e}return"builder"in t[0]?t:t.map((e=>({style:e})))}(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map((e=>new Rf(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null)))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach(((e,t)=>e.setHelper(this.helper,this.buffers_[t]))):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Df(this.helper))}handleSourceFeatureAdded_(e,t){const r=t.feature;this.batch_.addFeature(r,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){(0,So.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,So.lw)(this.tmpTransform_,e),this.helper.setUniformMatrixValue(Nf.PROJECTION_MATRIX,mg(this.tmpMat4_,this.tmpTransform_)),(0,So.T9)(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(Nf.SCREEN_TO_WORLD_MATRIX,mg(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,(0,So.T9)(this.tmpTransform_,e),(0,So.Bb)(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(Nf.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[r,n,i]=function(e,t){const r=e.viewState.projection,n=t.getSource().getWrapX()&&r.canWrapX(),i=r.getExtent(),o=e.extent,a=n?(0,ee.RG)(i):null,s=n?Math.ceil((o[2]-i[2])/a)+1:1;return[n?Math.floor((o[0]-i[0])/a):0,s,a]}(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,r,n,i),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,r,n,i),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),r=t.getSource(),n=e.viewState,i=!e.viewHints[0]&&!e.viewHints[1],o=!(0,ee.aI)(this.previousExtent_,e.extent),a=this.sourceRevision_<r.getRevision();if(a&&(this.sourceRevision_=r.getRevision()),i&&(o||a)){const i=n.projection,o=n.resolution,a=t instanceof yo?t.getRenderBuffer():0,s=(0,ee.r)(e.extent,a*o),l=(0,ne.Tf)();l?r.loadFeatures((0,ne.JR)(s,l),(0,ne.vN)(o,i),l):r.loadFeatures(s,o,i),this.ready=!1;const c=this.helper.makeProjectionTransform(e,(0,So.vt)()),u=this.styleRenderers_.map(((e,t)=>e.generateBuffers(this.batch_,c).then((e=>{this.buffers_[t]&&this.disposeBuffers(this.buffers_[t]),this.buffers_[t]=e}))));Promise.all(u).then((()=>{this.ready=!0,this.getLayer().changed()})),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,r,n,i){let o=r;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),(0,So.Tl)(this.currentFrameStateTransform_,o*i,0);for(let r=0,n=this.styleRenderers_.length;r<n;r++){const n=this.styleRenderers_[r],i=this.buffers_[r];i&&n.render(i,e,(()=>{this.applyUniforms_(i.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)}))}}while(++o<n)}forEachFeatureAtCoordinate(e,t,r,n,i){if((0,B.v)(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=(0,So.Bb)(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),s=function(e){let t=0;const r=256,n=255;return t+=Math.round(e[0]*r*r*r*n),t+=Math.round(e[1]*r*r*n),t+=Math.round(e[2]*r*n),t+=Math.round(e[3]*n),t}([a[0]/255,a[1]/255,a[2]/255,a[3]/255]),l=this.batch_.getFeatureFromRef(s);return l?n(l,this.getLayer(),null):void 0}disposeBuffers(e){const t=e=>{for(const t of e)t&&this.helper.deleteBuffer(t)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach((e=>{e&&this.disposeBuffers(e)})),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach((function(e){(0,v.JH)(e)})),this.sourceListenKeys_=null),super.disposeInternal()}renderDeclutter(){}},Ff="blur",Gf="gradient",Bf="radius",Uf=["#00f","#0ff","#0f0","#ff0","#f00"];var qf=r(4350);const Wf=[0,0,0],Hf=class{constructor(e){let t;if(this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,(0,B.v)((0,V.WC)(this.resolutions_,((e,t)=>t-e),!0),"`resolutions` must be sorted in descending order"),!e.origins)for(let e=0,r=this.resolutions_.length-1;e<r;++e)if(t){if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}}else t=this.resolutions_[e]/this.resolutions_[e+1];this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,(0,B.v)(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const r=e.extent;void 0===r||this.origin_||this.origins_||(this.origin_=(0,ee.Py)(r)),(0,B.v)(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,(0,B.v)(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:256,(0,B.v)(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=void 0!==r?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map(((e,t)=>{const n=new Kp(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1));if(r){const e=this.getTileRangeForExtentAndZ(r,t);n.minX=Math.max(e.minX,n.minX),n.maxX=Math.min(e.maxX,n.maxX),n.minY=Math.max(e.minY,n.minY),n.maxY=Math.min(e.maxY,n.maxY)}return n})):r&&this.calculateTileRanges_(r)}forEachTileCoord(e,t,r){const n=this.getTileRangeForExtentAndZ(e,t);for(let e=n.minX,i=n.maxX;e<=i;++e)for(let i=n.minY,o=n.maxY;i<=o;++i)r([t,e,i])}forEachTileCoordParentTileRange(e,t,r,n){let i,o,a,s=null,l=e[0]-1;for(2===this.zoomFactor_?(o=e[1],a=e[2]):s=this.getTileCoordExtent(e,n);l>=this.minZoom;){if(void 0!==o&&void 0!==a?(o=Math.floor(o/2),a=Math.floor(a/2),i=$p(o,o,a,a,r)):i=this.getTileRangeForExtentAndZ(s,l,r),t(l,i))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,r){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){const r=2*e[1],n=2*e[2];return $p(r,r+1,n,n+1,t)}const n=this.getTileCoordExtent(e,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,r){if(t>this.maxZoom||t<this.minZoom)return null;const n=e[0],i=e[1],o=e[2];if(t===n)return $p(i,o,i,o,r);if(this.zoomFactor_){const e=Math.pow(this.zoomFactor_,t-n),a=Math.floor(i*e),s=Math.floor(o*e);return t<n?$p(a,a,s,s,r):$p(a,Math.floor(e*(i+1))-1,s,Math.floor(e*(o+1))-1,r)}const a=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,t,r)}getTileRangeForExtentAndZ(e,t,r){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Wf);const n=Wf[1],i=Wf[2];return this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Wf),$p(n,Wf[1],i,Wf[2],r)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),r=this.getResolution(e[0]),n=Cr(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*r,t[1]-(e[2]+.5)*n[1]*r]}getTileCoordExtent(e,t){const r=this.getOrigin(e[0]),n=this.getResolution(e[0]),i=Cr(this.getTileSize(e[0]),this.tmpSize_),o=r[0]+e[1]*i[0]*n,a=r[1]-(e[2]+1)*i[1]*n,s=o+i[0]*n,l=a+i[1]*n;return(0,ee.N)(o,a,s,l,t)}getTileCoordForCoordAndResolution(e,t,r){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,r)}getTileCoordForXYAndResolution_(e,t,r,n,i){const o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),l=Cr(this.getTileSize(o),this.tmpSize_);let c=a*(e-s[0])/r/l[0],u=a*(s[1]-t)/r/l[1];return n?(c=(0,z.mk)(c,5)-1,u=(0,z.mk)(u,5)-1):(c=(0,z.RI)(c,5),u=(0,z.RI)(u,5)),og(o,c,u,i)}getTileCoordForXYAndZ_(e,t,r,n,i){const o=this.getOrigin(r),a=this.getResolution(r),s=Cr(this.getTileSize(r),this.tmpSize_);let l=(e-o[0])/a/s[0],c=(o[1]-t)/a/s[1];return n?(l=(0,z.mk)(l,5)-1,c=(0,z.mk)(c,5)-1):(l=(0,z.RI)(l,5),c=(0,z.RI)(c,5)),og(r,l,c,i)}getTileCoordForCoordAndZ(e,t,r){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const r=(0,V.FT)(this.resolutions_,e,t||0);return(0,z.qE)(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return(0,qf.sj)(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,r=new Array(t);for(let n=this.minZoom;n<t;++n)r[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=r}};var jf=r(8673),Vf=r(5286),zf=r(7917),Yf=r(3158);let $f=null;function Kf(e){return Array.isArray(e)?Math.min(...e):e}const Xf=class extends ei{constructor(e,t,r,n,i,o,a){let s=e.getExtent();s&&e.canWrapX()&&(s=s.slice(),s[0]=-1/0,s[2]=1/0);let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);const c=l?(0,ee._N)(r,l):r,u=eg(e,t,(0,ee.q1)(c),n),h=new rg(e,t,c,s,.5*u,n),d=h.calculateSourceExtent(),p=(0,ee.Im)(d)?null:o(d,u,i),g=p?0:4,f=p?p.getPixelRatio():1;super(r,n,f,g),this.targetProj_=t,this.maxSourceExtent_=s,this.triangulation_=h,this.targetResolution_=n,this.targetExtent_=r,this.sourceImage_=p,this.sourcePixelRatio_=f,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){1==this.state&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(2==e){const e=(0,ee.RG)(this.targetExtent_)/this.targetResolution_,t=(0,ee.Oq)(this.targetExtent_)/this.targetResolution_;this.canvas_=tg(e,t,this.sourcePixelRatio_,Kf(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(0==this.state){this.state=1,this.changed();const e=this.sourceImage_.getState();2==e||3==e?this.reproject_():(this.sourceListenerKey_=(0,v.KT)(this.sourceImage_,f.A.CHANGE,(e=>{const t=this.sourceImage_.getState();2!=t&&3!=t||(this.unlistenSource_(),this.reproject_())})),this.sourceImage_.load())}}unlistenSource_(){(0,v.JH)(this.sourceListenerKey_),this.sourceListenerKey_=null}};class Zf extends s.Ay{constructor(e,t){super(e),this.image=t}}function Jf(e,t){e.getImage().src=t}function Qf(e,t,r,n){const i=t/r,o=(0,ee.q1)(e),a=(0,z.mk)((0,ee.RG)(e)/i,4),s=(0,z.mk)((0,ee.Oq)(e)/i,4),l=a+2*(0,z.mk)((n-1)*a/2,4),c=s+2*(0,z.mk)((n-1)*s/2,4);return(0,ee.Bg)(o,i,0,[l,c])}const em=class extends Zd{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:void 0===e.interpolate||e.interpolate}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=void 0!==e.resolutions?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!e.loader&&0===e.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();return t&&(e=t[(0,V.FT)(t,e,0)]),e}getImage(e,t,r,n){const i=this.getProjection();if(!i||!n||(0,ne.tI)(i,n))return i&&(n=i),this.getImageInternal(e,t,r,n);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,ne.tI)(this.reprojectedImage_.getProjection(),n)&&this.reprojectedImage_.getResolution()==t&&(0,ee.aI)(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Xf(i,n,e,t,r,((e,t,r)=>this.getImageInternal(e,t,r,i)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,r,n){if(this.loader){const i=Qf(e,t,r,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===n&&(this.wantedExtent_&&(0,ee.ms)(this.wantedExtent_,i)||(0,ee.ms)(this.image.getExtent(),i))&&(this.wantedResolution_&&Kf(this.wantedResolution_)===o||Kf(this.image.getResolution())===o)))return this.image;this.wantedProjection_=n,this.wantedExtent_=i,this.wantedResolution_=o,this.image=new ei(i,o,r,this.loader),this.image.addEventListener(f.A.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let r;switch(t.getState()){case 1:this.loading=!0,r="imageloadstart";break;case 2:this.loading=!1,r="imageloadend";break;case 3:this.loading=!1,r="imageloaderror";break;default:return}this.hasListener(r)&&this.dispatchEvent(new Zf(r,t))}};function tm(e,t){const r=[];Object.keys(t).forEach((function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))}));const n=r.join("&");return e=e.replace(/[?&]$/,""),(e+=e.includes("?")?"&":"?")+n}const rm=/\{z\}/g,nm=/\{x\}/g,im=/\{y\}/g,om=/\{-y\}/g;function am(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const n=r[1].charCodeAt(0),i=r[2].charCodeAt(0);let o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}const sm="1.3.0",lm=[101,101];function cm(e,t,r,n,i){i.WIDTH=r[0],i.HEIGHT=r[1];const o=n.getAxisOrientation(),a=(0,ko.Z)(i.VERSION,"1.3")>=0;i[a?"CRS":"SRS"]=n.getCode();const s=a&&o.startsWith("ne")?[t[1],t[0],t[3],t[2]]:t;return i.BBOX=s.join(","),tm(e,i)}function um(e,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:sm,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},e)}function hm(e){const t=void 0===e.hidpi||e.hidpi,r=(0,ne.Jt)(e.projection||"EPSG:3857"),n=e.ratio||1.5,i=e.load||Qn,o=e.crossOrigin??null;return(a,s,l)=>{a=Qf(a,s,l,n),1==l||t&&void 0!==e.serverType||(l=1);const c=function(e,t,r,n,i,o,a){o=Object.assign({REQUEST:"GetMap"},o);const s=t/r,l=[(0,z.LI)((0,ee.RG)(e)/s,4),(0,z.LI)((0,ee.Oq)(e)/s,4)];if(1!=r)switch(a){case"geoserver":const e=90*r+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+e:o.FORMAT_OPTIONS="dpi:"+e;break;case"mapserver":o.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":o.DPI=90*r;break;default:throw new Error("Unknown `serverType` configured")}return cm(i,e,l,n,o)}(a,s,l,r,e.url,um(e.params,"GetMap"),e.serverType),u=new Image;return u.crossOrigin=o,i(u,c).then((e=>({image:e,extent:a,pixelRatio:l})))}}class dm extends Hf{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}}function pm(e,t){return function(r,n,i){if(!r)return;let o;const a=r[0];if(t){const e=t.getFullTileRange(a);e&&(o=e.getHeight()-1)}return function(e,t,r,n,i){return e.replace(rm,t.toString()).replace(nm,r.toString()).replace(im,n.toString()).replace(om,(function(){if(void 0===i)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(i-n).toString()}))}(e,a,r[1],r[2],o)}}function gm(e){return 1===e.length?e[0]:function(t,r,n){if(!t)return;const i=function(e){return function(e,t,r){return(t<<e)+r}(e[0],e[1],e[2])}(t),o=(0,z.xP)(i,e.length);return e[o](t,r,n)}}function fm(e){let t=e.getDefaultTileGrid();return t||(t=function(e){return function(e,t,r,n){n=void 0!==n?n:"top-left";const i=function(e,t,r,n){t=void 0!==t?t:42,r=Cr(void 0!==r?r:ce);const i=(0,ee.Oq)(e),o=(0,ee.RG)(e);n=n>0?n:Math.max(o/r[0],i/r[1]);const a=t+1,s=new Array(a);for(let e=0;e<a;++e)s[e]=n/Math.pow(2,e);return s}(e,t,r);return new Hf({extent:e,origin:(0,ee.qF)(e,n),resolutions:i,tileSize:r})}(mm(e),void 0,void 0,void 0)}(e),e.setDefaultTileGrid(t)),t}function mm(e){let t=(e=(0,ne.Jt)(e)).getExtent();if(!t){const r=180*ne.Ig.degrees/e.getMetersPerUnit();t=(0,ee.N)(-r,-r,r,r)}return t}class ym extends s.Ay{constructor(e,t){super(e),this.tile=t}}const vm=class extends Zd{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1,this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;this.tileGrid&&Cr(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),[256,256]),this.tmpSize=[0,0],this.key_=e.key||(0,n.v6)(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,r,i,o){return(0,n.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:fm(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,r){const n=this.getTileGridForProjection(r),i=this.getTilePixelRatio(t),o=Cr(n.getTileSize(e),this.tmpSize);return 1==i?o:(a=o,s=i,void 0===(l=this.tmpSize)&&(l=[0,0]),l[0]=a[0]*s+.5|0,l[1]=a[1]*s+.5|0,l);var a,s,l}getTileCoordForTileUrlFunction(e,t){const r=void 0!==t?t:this.getProjection(),n=void 0!==t?this.getTileGridForProjection(r):this.tileGrid||this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(e=function(e,t,r){const n=t[0],i=e.getTileCoordCenter(t),o=mm(r);if(!(0,ee.Ym)(o,i)){const t=(0,ee.RG)(o),r=Math.ceil((o[0]-i[0])/t);return i[0]+=t*r,e.getTileCoordForCoordAndZ(i,n)}return t}(n,e,r)),function(e,t){const r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;const o=t.getFullTileRange(r);return!o||o.containsXY(n,i)}(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},Am={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class Sm extends vm{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Sm.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,r=(0,n.v6)(t),i=t.getState();let o;1==i?(this.tileLoadingKeys_[r]=!0,o=Am.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],o=3==i?Am.TILELOADERROR:2==i?Am.TILELOADEND:void 0),null!=o&&this.dispatchEvent(new ym(o,t))}setTileLoadFunction(e){this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,void 0!==t?this.setKey(t):this.changed()}setUrl(e){const t=am(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(function(e,t){const r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=pm(e[i],t);return gm(n)}(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,r){}}const Em=Sm;function wm(e,t){e.getImage().src=t}const _m=class extends Em{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:wm,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:void 0===e.interpolate||e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null,this.tileClass=void 0!==e.tileClass?e.tileClass:zp,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!(0,ne.tI)(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||(0,ne.tI)(t,e)))return this.tileGrid;const r=(0,n.v6)(e);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=fm(e)),this.tileGridForProjection[r]}createTile_(e,t,r,n,i,o){const a=[e,t,r],s=this.getTileCoordForTileUrlFunction(a,i),l=s?this.tileUrlFunction(s,n,i):void 0,c=new this.tileClass(a,void 0!==l?0:4,void 0!==l?l:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=o,c.addEventListener(f.A.CHANGE,this.handleTileChange.bind(this)),c}getTile(e,t,r,n,i){const o=this.getProjection();if(!o||!i||(0,ne.tI)(o,i))return this.getTileInternal(e,t,r,n,o||i);const a=[e,t,r],s=this.getKey(),l=this.getTileGridForProjection(o),c=this.getTileGridForProjection(i),u=this.getTileCoordForTileUrlFunction(a,i),h=new ng(o,l,i,c,a,u,this.getTilePixelRatio(n),this.getGutter(),((e,t,r,n)=>this.getTileInternal(e,t,r,n,o)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return h.key=s,h}getTileInternal(e,t,r,n,i){const o=this.getKey();return this.createTile_(e,t,r,n,i,o)}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,t){const r=(0,ne.Jt)(e);if(r){const e=(0,n.v6)(r);e in this.tileGridForProjection||(this.tileGridForProjection[e]=t)}}},Lm=class extends ei{constructor(e,t,r,n,i){super(e,t,r,void 0!==i?0:2),this.loader_=void 0!==i?i:null,this.canvas_=n,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=3):this.state=2,this.changed()}load(){0==this.state&&(this.state=1,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}};var Cm=r(8721),bm=r(8038),Tm=r(5637),xm=r(9566),Pm=r(2948),Mm=r(9439),Im=r(8370),Rm=r(3365),Om=r(4450),Dm=r(6031);bm.A.wrap=Tm.A;const Nm={};Nm.Point=ll.A,Nm.Marker=Pm.A,Nm.Polyline=cl.A,Nm.Polygon=_h.A,Nm.MultiPoint=wh.A,Nm.MultiMarker=Mm.A,Nm.MultiPolyline=ul.A,Nm.MultiPolygon=Lh.A,bm.A.Geometry=Oh.A,Uo.A.createStyleFunction=Uo.o,window.ol={VERSION:n.xv,Map:xo,View:ge,Overlay:No,Feature:Uo.A,Collection:h,MapEventType:O,MapBrowserEventType:m,Image:ei},ol.array={extend:V.X$},ol.asserts={assert:B.v},ol.color={asArray:wr,asString:dr},ol.math={toRadians:z.eh},ol.string={padNumber:ko.H},ol.control={OverviewMap:class extends Re{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=void 0===e.collapsed||e.collapsed,this.collapsible_=void 0===e.collapsible||e.collapsible,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=void 0!==e.rotateWithView&&e.rotateWithView,this.viewExtent_=void 0;const t=void 0!==e.className?e.className:"ol-overviewmap",r=void 0!==e.tipLabel?e.tipLabel:"Overview map",n=void 0!==e.collapseLabel?e.collapseLabel:"‹";"string"==typeof n?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const i=void 0!==e.label?e.label:"›";"string"==typeof i?(this.label_=document.createElement("span"),this.label_.textContent=i):this.label_=i;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=r,a.appendChild(o),a.addEventListener(f.A.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const s=new xo({view:e.view,controls:new h,interactions:new h});this.ovmap_=s,e.layers&&e.layers.forEach((function(e){s.addLayer(e)}));const l=document.createElement("div");l.className="ol-overviewmap-box",l.style.boxSizing="border-box",this.boxOverlay_=new No({position:[0,0],positioning:"center-center",element:l}),this.ovmap_.addOverlay(this.boxOverlay_);const c=t+" "+ye+" "+ve+(this.collapsed_&&this.collapsible_?" "+Ae:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=c,u.appendChild(this.ovmapDiv_),u.appendChild(a);const d=this.boxOverlay_,p=this.boxOverlay_.getElement(),g=function(e){const t={clientX:(r=e).clientX,clientY:r.clientY};var r;const n=s.getEventCoordinate(t);d.setPosition(n)},m=e=>{const t=s.getEventCoordinateInternal(e),r=this.getMap();r.getView().setCenterInternal(t);const n=r.getOwnerDocument();n.removeEventListener("pointermove",g),n.removeEventListener("pointerup",m)};this.ovmapDiv_.addEventListener("pointerdown",(e=>{const t=this.getMap().getOwnerDocument();e.target===p&&t.addEventListener("pointermove",g),t.addEventListener("pointerup",m)}))}setMap(e){const t=this.getMap();if(e!==t){if(t){const e=t.getView();e&&this.unbindView_(e),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push((0,v.KT)(e,G.A.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const t=e.getView();t&&this.bindView_(t),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===F){const t=e.oldValue;t&&this.unbindView_(t);const r=this.getMap().getView();this.bindView_(r)}else this.ovmap_.isRendered()||e.key!==k&&e.key!==N||this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new ge({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(j.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(j.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const r=e.getSize(),n=e.getView().calculateExtentInternal(r);if(this.viewExtent_&&(0,ee.aI)(n,this.viewExtent_))return;this.viewExtent_=n;const i=t.getSize(),o=t.getView().calculateExtentInternal(i),a=t.getPixelFromCoordinateInternal((0,ee.Py)(n)),s=t.getPixelFromCoordinateInternal((0,ee.k_)(n)),l=Math.abs(a[0]-s[0]),c=Math.abs(a[1]-s[1]),u=i[0],h=i[1];l<.1*u||c<.1*h||l>.75*u||c>.75*h?this.resetExtent_():(0,ee.ms)(o,n)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,r=e.getSize(),n=e.getView().calculateExtentInternal(r),i=t.getView(),o=Math.log(7.5)/Math.LN2,a=1/(.1*Math.pow(2,o/2));(0,ee.Af)(n,a),i.fitInternal((0,re.VY)(n))}recenter_(){const e=this.getMap(),t=this.ovmap_,r=e.getView();t.getView().setCenterInternal(r.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const r=e.getSize(),n=e.getView(),i=t.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,s=this.boxOverlay_.getElement(),l=n.getCenter(),c=n.getResolution(),u=i.getResolution(),h=r[0]*c/u,d=r[1]*c/u;if(a.setPosition(l),s){s.style.width=h+"px",s.style.height=d+"px";const e="rotate("+o+"rad)";s.style.transform=e}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=(0,v.Jz)(this.ovmap_,O.POSTRENDER,(e=>{delete this.ovmapPostrenderKey_,this.updateBox_()})))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(Ae),this.collapsed_?Pe(this.collapseLabel_,this.label_):Pe(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered())return this.viewExtent_=void 0,void e.render();e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,0!==this.getMap().getView().getRotation()&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}},ScaleLine:class extends Re{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const r=void 0!==e.className?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=r+"-inner",this.element.className=r+" "+ye,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=void 0!==e.minWidth?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(Fo,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(Fo)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(Fo,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const t=e.center,r=e.projection,n=this.getUnits(),i="degrees"==n?"degrees":"m";let o=(0,ne.hO)(r,e.resolution,t,i);const a=this.minWidth_*(this.dpi_||Bo)/Bo,s=void 0!==this.maxWidth_?this.maxWidth_*(this.dpi_||Bo)/Bo:void 0;let l=a*o,c="";if("degrees"==n){const e=ne.Ig.degrees;l*=e,l<e/60?(c="″",o*=3600):l<e?(c="′",o*=60):c="°"}else if("imperial"==n)l<.9144?(c="in",o/=.0254):l<1609.344?(c="ft",o/=.3048):(c="mi",o/=1609.344);else if("nautical"==n)o/=1852,c="NM";else if("metric"==n)l<1e-6?(c="nm",o*=1e9):l<.001?(c="μm",o*=1e6):l<1?(c="mm",o*=1e3):l<1e3?c="m":(c="km",o/=1e3);else{if("us"!=n)throw new Error("Invalid units");l<.9144?(c="in",o*=39.37):l<1609.344?(c="ft",o/=.30480061):(c="mi",o/=1609.3472)}let u,h,d,p,g,f=3*Math.floor(Math.log(a*o)/Math.log(10)),m=0;for(;;){d=Math.floor(f/3);const e=Math.pow(10,d);if(u=Go[(f%3+3)%3]*e,h=Math.round(u/o),isNaN(h))return this.element.style.display="none",void(this.renderedVisible_=!1);if(void 0!==s&&h>=s){u=m,h=p,d=g;break}if(h>=a)break;m=u,p=h,g=d,++f}const y=this.scaleBar_?this.createScaleBar(h,u,c):u.toFixed(d<0?-d:0)+" "+c;this.renderedHTML_!=y&&(this.innerElement_.innerHTML=y,this.renderedHTML_=y),this.renderedWidth_!=h&&(this.innerElement_.style.width=h+"px",this.renderedWidth_=h),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,r){const n=this.getScaleForResolution(),i=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),o=this.scaleBarSteps_,a=e/o,s=[this.createMarker("absolute")];for(let n=0;n<o;++n){const i=n%2==0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";s.push(`<div><div class="ol-scale-singlebar ${i}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(n%2==0||2===o?this.createStepText(n,e,!1,t,r):"")+"</div>")}return s.push(this.createStepText(o,e,!0,t,r)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+i+"</div>":"")+s.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${"absolute"===e?3:-10}px;"></div>`}createStepText(e,t,r,n,i){const o=(0===e?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(0===e?"":" "+i);return`<div class="ol-scale-step-text" style="margin-left: ${0===e?-3:t/this.scaleBarSteps_*-1}px;text-align: ${0===e?"left":"center"};min-width: ${0===e?0:t/this.scaleBarSteps_*2}px;left: ${r?t+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){return(0,ne.hO)(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m")*(1e3/25.4)*(this.dpi_||Bo)}render(e){const t=e.frameState;this.viewState_=t?t.viewState:null,this.updateElement_()}},Zoom:Ne,ZoomSlider:class extends Re{constructor(e){super({target:(e=e||{}).target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=0,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=void 0!==e.duration?e.duration:200;const t=void 0!==e.className?e.className:"ol-zoomslider",r=document.createElement("button");r.setAttribute("type","button"),r.className=t+"-thumb "+ye;const n=this.element;n.className=t+" "+ye+" "+ve,n.appendChild(r),n.addEventListener(P,this.handleDraggerStart_.bind(this),!1),n.addEventListener(x,this.handleDraggerDrag_.bind(this),!1),n.addEventListener(M,this.handleDraggerEnd_.bind(this),!1),n.addEventListener(f.A.CLICK,this.handleContainerClick_.bind(this),!1),r.addEventListener(f.A.CLICK,s.dG,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,r=e.offsetHeight;if(0===t&&0===r)return this.sliderInitialized_=!1;const n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),r-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);const i=e.firstElementChild,o=getComputedStyle(i),a=i.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),s=i.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,s],t>r?(this.direction_=1,this.widthLimit_=t-a):(this.direction_=0,this.heightLimit_=r-s),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),r=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(r),i=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:i,duration:this.duration_,easing:Z})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,0===this.dragListenerKeys_.length){const e=this.handleDraggerDrag_,t=this.handleDraggerEnd_,r=this.getMap().getOwnerDocument();this.dragListenerKeys_.push((0,v.KT)(r,x,e,this),(0,v.KT)(r,M,t,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,r=e.clientY-this.startY_,n=this.getRelativePosition_(t,r);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(v.JH),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),r=this.element.firstElementChild;1==this.direction_?r.style.left=this.widthLimit_*t+"px":r.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let r;return r=1===this.direction_?e/this.widthLimit_:t/this.heightLimit_,(0,z.qE)(r,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return(0,z.qE)(1-t(e),0,1)}render(e){if(!e.frameState)return;if(!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}},ZoomToExtent:class extends Re{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=void 0!==e.className?e.className:"ol-zoom-extent",r=void 0!==e.label?e.label:"E",n=void 0!==e.tipLabel?e.tipLabel:"Fit to extent",i=document.createElement("button");i.setAttribute("type","button"),i.title=n,i.appendChild("string"==typeof r?document.createTextNode(r):r),i.addEventListener(f.A.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+ye+" "+ve,a=this.element;a.className=o,a.appendChild(i)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const e=this.getMap().getView(),t=this.extent?(0,ne.SD)(this.extent,e.getProjection()):e.getProjection().getExtent();e.fitInternal((0,re.VY)(t))}}},ol.events={EventType:f.A,listen:v.KT,unlistenByKey:v.JH,condition:{shiftKeyOnly:Ze}},ol.extent={getWidth:ee.RG,getHeight:ee.Oq,containsCoordinate:ee.Ym,containsExtent:ee.ms,buffer:ee.r,extend:ee.X$},ol.geom={Geometry:qo.A,Point:Wo.A,MultiPoint:Ho.A,LineString:jo.A,MultiLineString:Vo.A,Polygon:re.Ay,MultiPolygon:zo.A,GeometryCollection:Jo.A,Circle:Zo,flat:{deflateCoordinates:$o.z2,inflateCoordinates:Qo.n2,linearRingLength:ea.K}},ol.featureloader={xhr:ta},ol.format={Feature:Uo.A,GMLBase:ra.A,GML:aa,GML2:cs.A,GML3:ia.A,GML32:Xh,GPX:Yl,KML:Ah,WFS:sa.A,WKT:wa,WKB:Ta,GeoJSON:il,WMSCapabilities:class extends Pa{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();return(0,xa.eY)({version:this.version},Da,e,[])||null}},WMSGetFeatureInfo:hs,WMTSCapabilities:class extends Pa{constructor(){super(),this.owsParser_=new Ts}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let r=this.owsParser_.readFromNode(e);return r?(r.version=t,r=(0,xa.eY)(r,Ms,e,[]),r||null):null}},TopoJSON:Zs,GeoPackage:Rh,Shapefile:Hh,xsd:{readDecimal:Ia.e4,readBoolean:Ia.Vf,readString:Ia.E3,readPositiveInteger:Ia.yg,readDateTime:Ia._I,writeStringTextNode:Ia.uB,writeCDATASection:Ia.Gc,writeDecimalTextNode:Ia.Ko,writeBooleanTextNode:Ia.Z3,writeNonNegativeIntegerTextNode:Ia.pE}},ol.format.Feature.transformGeometryWithOptions=la.hX,ol.interaction={defaults:St,Draw:class extends rt{constructor(e){const t=e;t.stopDown||(t.stopDown=te.W8),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(e){switch(e){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+e)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:te.rT,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let r=e.geometryFunction;if(!r){const e=this.mode_;if("Circle"===e)r=(e,t,r)=>{const n=t||new Zo([NaN,NaN]),i=(0,ne.Ad)(e[0],r),o=(0,K.hG)(i,(0,ne.Ad)(e[e.length-1],r));n.setCenterAndRadius(i,Math.sqrt(o),this.geometryLayout_);const a=(0,ne.Tf)();return a&&n.transform(r,a),n};else{let t;"Point"===e?t=Wo.A:"LineString"===e?t=jo.A:"Polygon"===e&&(t=re.Ay),r=(r,n,i)=>(n?"Polygon"===e?r[0].length?n.setCoordinates([r[0].concat([r[0][0]])],this.geometryLayout_):n.setCoordinates([],this.geometryLayout_):n.setCoordinates(r,this.geometryLayout_):n=new t(r,this.geometryLayout_),n)}}this.geometryFunction_=r,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new zd({source:new ep({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:dp(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:Xe,this.freehandCondition_,e.freehand?this.freehandCondition_=Ve:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Ze,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(Fe,this.updateState_)}setTrace(e){let t;t=e?!0===e?Ve:e:$e,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===f.A.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let t=e.type===m.POINTERMOVE,r=!0;return!this.freehand_&&this.lastDragTime_&&e.type===m.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===m.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),r=!1):this.freehand_&&e.type===m.POINTERDOWN?r=!1:t&&this.getPointerCount()<2?(r=e.type===m.POINTERMOVE,r&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===m.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e)):e.type===m.DBLCLICK&&(r=!1),super.handleEvent(e)&&r}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((()=>{this.handlePointerMove_(new g(m.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),r=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),i=(0,ee.Tr)([r,n]),o=this.traceSource_.getFeaturesInExtent(i);if(0===o.length)return;const a=function(e,t){const r=[];for(let n=0;n<t.length;++n)ap(e,t[n].getGeometry(),r);return r}(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const r=e.startIndex<=e.endIndex;r===e.startIndex<=t?r&&t>e.endIndex||!r&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(r&&t<e.endIndex||!r&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let r=0;if(e<t){const n=Math.ceil(e);let i=Math.floor(t);i===t&&(i-=1),r=i-n+1}else{const n=Math.floor(e);let i=Math.ceil(t);i===t&&(i+=1),r=n-i+1}r>0&&this.removeLastPoints_(r)}addTracedCoordinates_(e,t,r){if(t===r)return;const n=[];if(t<r){const i=Math.ceil(t);let o=Math.floor(r);o===r&&(o-=1);for(let t=i;t<=o;++t)n.push(ip(e.coordinates,t))}else{const i=Math.floor(t);let o=Math.ceil(r);o===r&&(o+=1);for(let t=i;t>=o;--t)n.push(ip(e.coordinates,t))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex&&(0,K.Io)(t.startPx,e.pixel)<this.snapTolerance_)return;const r=function(e,t,r,n){const i=e[0],o=e[1];let a=1/0,s=-1,l=NaN;for(let e=0;e<t.targets.length;++e){const r=t.targets[e],n=r.coordinates;let c,u=1/0;for(let e=0;e<n.length-1;++e){const t=up(i,o,n[e],n[e+1]);t.squaredDistance<u&&(u=t.squaredDistance,c=e+t.along)}u<a&&(a=u,r.ring&&t.targetIndex===e&&(r.endIndex>r.startIndex?c<r.startIndex&&(c+=n.length):r.endIndex<r.startIndex&&c>r.startIndex&&(c-=n.length)),l=c,s=e)}const c=t.targets[s];let u=c.ring;if(t.targetIndex===s&&u){const e=hp(c.coordinates,l),i=r.getPixelFromCoordinate(e);(0,K.Io)(i,t.startPx)>n&&(u=!1)}if(u){const e=c.coordinates,t=e.length,r=c.startIndex,n=l;if(r<n){const i=op(e,r,n);op(e,r,n-t)<i&&(l-=t)}else{const i=op(e,r,n);op(e,r,n+t)<i&&(l+=t)}}return sp.index=s,sp.endIndex=l,sp}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==r.index){if(-1!==t.targetIndex){const e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}const e=t.targets[r.index];this.addTracedCoordinates_(e,e.startIndex,r.endIndex)}else{const e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,r.endIndex)}t.targetIndex=r.index;const n=t.targets[t.targetIndex];n.endIndex=r.endIndex;const i=hp(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(i);e.coordinate=i,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const r=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():this.freehand_||n&&"Point"!==this.mode_||(this.atFinish_(e.pixel,r)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,r=e.pixel,n=t[0]-r[0],i=t[1]-r[1],o=n*n+i*i;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let r=!1;if(this.sketchFeature_){let n=!1,i=[this.finishCoordinate_];const o=this.mode_;if("Point"===o)r=!0;else if("Circle"===o)r=2===this.sketchCoords_.length;else if("LineString"===o)n=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===o){const e=this.sketchCoords_;n=e[0].length>this.minPoints_,i=[e[0][0],e[0][e[0].length-2]],i=t?[e[0][0]]:[e[0][0],e[0][e[0].length-2]]}if(n){const t=this.getMap();for(let n=0,o=i.length;n<o;n++){const o=i[n],a=t.getPixelFromCoordinate(o),s=e[0]-a[0],l=e[1]-a[1],c=this.freehand_?1:this.snapTolerance_;if(r=Math.sqrt(s*s+l*l)<=c,r){this.finishCoordinate_=o;break}}}}return r}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Uo.A(new Wo.A(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Uo.A);const t=e.getLinearRing(0);let r=this.sketchLine_.getGeometry();r?(r.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),r.changed()):(r=new jo.A(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(r))}startDrawing_(e){const t=this.getMap().getView().getProjection(),r=(0,Yo.dn)(this.geometryLayout_);for(;e.length<r;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Uo.A(new jo.A(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Uo.A,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new rp(tp,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),r=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),i=(0,Yo.dn)(this.geometryLayout_);let o,a;for(;e.length<i;)e.push(0);"Point"===this.mode_?a=this.sketchCoords_:"Polygon"===this.mode_?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,r,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),"Polygon"===r.getType()&&"Polygon"!==this.mode_?this.createOrUpdateCustomSketchLine_(r):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();let n,i;const o=this.mode_;return"LineString"===o||"Circle"===o?(this.finishCoordinate_=e.slice(),i=this.sketchCoords_,i.length>=this.maxPoints_&&(this.freehand_?i.pop():n=!0),i.push(e.slice()),this.geometryFunction_(i,t,r)):"Polygon"===o&&(i=this.sketchCoords_[0],i.length>=this.maxPoints_&&(this.freehand_?i.pop():n=!0),i.push(e.slice()),n&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,t,r)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection(),n=this.mode_;for(let i=0;i<e;++i){let e;if("LineString"===n||"Circle"===n){if(e=this.sketchCoords_,e.splice(-2,1),e.length>=2){this.finishCoordinate_=e[e.length-2].slice();const t=this.finishCoordinate_.slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}this.geometryFunction_(e,t,r),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===n){e=this.sketchCoords_[0],e.splice(-2,1);const n=this.sketchLine_.getGeometry();if(e.length>=2){const t=e[e.length-2].slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}n.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,r)}if(1===e.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const r=e.getGeometry(),n=this.getMap().getView().getProjection();return"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,r,n)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,r,n),t=r.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new Ho.A([t])):"MultiLineString"===this.type_?e.setGeometry(new Vo.A([t])):"MultiPolygon"===this.type_&&e.setGeometry(new zo.A([t])),this.dispatchEvent(new rp("drawend",e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new rp("drawabort",e))}appendCoordinates(e){const t=this.mode_,r=!this.sketchFeature_;let n;if(r&&this.startDrawing_(e[0]),"LineString"===t||"Circle"===t)n=this.sketchCoords_;else{if("Polygon"!==t)return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}r&&n.shift(),n.pop();for(let t=0;t<e.length;t++)this.addToDrawing_(e[t]);const i=e[e.length-1];this.sketchFeature_=this.addToDrawing_(i),this.modifyDrawing_(i)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new Uo.A(new Wo.A(r)),this.updateSketchFeatures_(),this.dispatchEvent(new rp(tp,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)}},Pointer:rt,Translate:class extends rt{constructor(e){let t;if(super(e=e||{}),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=void 0!==e.features?e.features:null,e.layers&&!this.features_)if("function"==typeof e.layers)t=e.layers;else{const r=e.layers;t=function(e){return r.includes(e)}}else t=te.rT;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:te.rT,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:Ve,this.lastFeature_=null,this.addChangeListener(Fe,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new h([this.lastFeature_]);return this.dispatchEvent(new pp("translatestart",t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new h([this.lastFeature_]);return this.dispatchEvent(new pp("translateend",t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate,r=e.map.getView().getProjection(),n=(0,ne.Ad)(t,r),i=(0,ne.Ad)(this.lastCoordinate_,r),o=n[0]-i[0],a=n[1]-i[1],s=this.features_||new h([this.lastFeature_]),l=(0,ne.Tf)();s.forEach((function(e){const t=e.getGeometry();l?(t.transform(l,r),t.translate(o,a),t.transform(r,l)):t.translate(o,a),e.setGeometry(t)})),this.lastCoordinate_=t,this.dispatchEvent(new pp("translating",s,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,((e,t)=>{if(e instanceof Uo.A&&this.filter_(e,t)&&(!this.features_||this.features_.getArray().includes(e)))return e}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const r=this.getActive();t&&r||(t=t||e,!t)||t.getViewport().classList.remove("ol-grab","ol-grabbing")}},Snap:class extends rt{constructor(e){const t=e=e||{};t.handleDownEvent||(t.handleDownEvent=te.rT),t.stopDown||(t.stopDown=te.W8),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=void 0===e.vertex||e.vertex,this.edge_=void 0===e.edge||e.edge,this.intersection_=void 0!==e.intersection&&e.intersection,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.rBush_=new $d,this.snapped_=null,this.segmenters_=Object.assign({},yp,e.segmenters)}addFeature(e,t){t=void 0===t||t;const r=(0,n.v6)(e),i=e.getGeometry();if(i){const t=this.segmenters_[i.getType()];if(t){this.indexedFeaturesExtents_[r]=i.getExtent((0,ee.S5)());const n=t(i,this.getMap().getView().getProjection());let o=n.length;for(let t=0;t<o;++t){const r=n[t];Sp[t]=(0,ee.Tr)(r),Ep[t]={feature:e,segment:r}}if(Sp.length=o,Ep.length=o,this.intersection_)for(let t=0,r=n.length;t<r;++t){const r=n[t];if(1===r.length)continue;const i=Sp[t];for(let a=0,s=n.length;a<s;++a){if(t===a||t-1===a||t+1===a)continue;const s=n[a];if(!(0,ee.HY)(i,Sp[a]))continue;const l=(0,mp.i)(r,s);if(!l)continue;const c=[l];Sp[o]=(0,ee.Tr)(c),Ep[o++]={feature:e,segment:c,isIntersection:!0}}const a=this.rBush_.getInExtent(Sp[t]);for(const{segment:t}of a){if(1===t.length)continue;const n=(0,mp.i)(r,t);if(!n)continue;const i=[n];Sp[o]=(0,ee.Tr)(i),Ep[o++]={feature:e,segment:i,isIntersection:!0}}}1===o?this.rBush_.insert(Sp[0],Ep[0]):this.rBush_.load(Sp,Ep)}}t&&(this.featureChangeListenerKeys_[r]=(0,v.KT)(e,f.A.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}areSnapDataEqual_(e,t){return e.segment===t.segment&&e.feature===t.feature}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t?(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.snapped_&&!this.areSnapDataEqual_(this.snapped_,t)&&this.dispatchEvent(new fp(gp,this.snapped_)),this.snapped_={vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment},this.dispatchEvent(new fp("snap",this.snapped_))):this.snapped_&&(this.dispatchEvent(new fp(gp,this.snapped_)),this.snapped_=null),super.handleEvent(e)}handleFeatureAdd_(e){const t=vp(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=vp(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const e=(0,n.v6)(t);e in this.pendingFeatures_||(this.pendingFeatures_[e]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);if(t.length)for(const e of t)this.updateFeature_(e);return!1}removeFeature(e,t){const r=void 0===t||t,i=(0,n.v6)(e),o=this.indexedFeaturesExtents_[i];if(o){const t=this.rBush_,r=[];t.forEachInExtent(o,(function(t){e===t.feature&&r.push(t)}));for(let e=r.length-1;e>=0;--e)t.remove(r[e])}r&&((0,v.JH)(this.featureChangeListenerKeys_[i]),delete this.featureChangeListenerKeys_[i])}setMap(e){const t=this.getMap(),r=this.featuresListenerKeys_;let n=this.getFeatures_();if(Array.isArray(n)||(n=n.getArray()),t&&(r.forEach(v.JH),r.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(v.JH),this.featureChangeListenerKeys_={}),super.setMap(e),e){this.features_?r.push((0,v.KT)(this.features_,i,this.handleFeatureAdd_,this),(0,v.KT)(this.features_,o,this.handleFeatureRemove_,this)):this.source_&&r.push((0,v.KT)(this.source_,Jd.ADDFEATURE,this.handleFeatureAdd_,this),(0,v.KT)(this.source_,Jd.REMOVEFEATURE,this.handleFeatureRemove_,this));for(const e of n)this.addFeature(e)}}snapTo(e,t,r){const n=r.getView().getProjection(),i=(0,ne.Ad)(t,n),o=(0,ne.JR)((0,ee.r)((0,ee.Tr)([i]),r.getView().getResolution()*this.pixelTolerance_),n),a=this.rBush_.getInExtent(o),s=a.length;if(0===s)return null;let l,c,u,h=1/0,d=null;const p=this.pixelTolerance_*this.pixelTolerance_,g=()=>{if(l){const t=r.getPixelFromCoordinate(l);if((0,K.hG)(e,t)<=p&&(u&&this.intersection_||!u&&(this.vertex_||this.edge_)))return{vertex:l,vertexPixel:[Math.round(t[0]),Math.round(t[1])],feature:c,segment:d}}return null};if(this.vertex_||this.intersection_){for(let e=0;e<s;++e){const t=a[e];if("Circle"!==t.feature.getGeometry().getType())for(const e of t.segment){const r=(0,ne.Ad)(e,n),o=(0,K.hG)(i,r);o<h&&(l=e,h=o,c=t.feature,u=t.isIntersection)}}const e=g();if(e)return e}if(this.edge_){for(let e=0;e<s;++e){let t=null;const r=a[e];if("Circle"===r.feature.getGeometry().getType()){let e=r.feature.getGeometry();const o=(0,ne.Tf)();o&&(e=e.clone().transform(o,n)),t=(0,K.hw)(i,e)}else{const[e,o]=r.segment;o&&(Ap[0]=(0,ne.Ad)(e,n),Ap[1]=(0,ne.Ad)(o,n),t=(0,K.sG)(i,Ap))}if(t){const e=(0,K.hG)(i,t);e<h&&(l=(0,ne.te)(t,n),d="Circle"===r.feature.getGeometry().getType()?null:r.segment,h=e,c=r.feature)}}const e=g();if(e)return e}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}},Select:Cp,Modify:class extends rt{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:et,this.defaultDeleteCondition_=function(e){return function(e){const t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey}(e)&&Ke(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Ve,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new $d,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new zd({source:new ep({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:Op(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new h(this.source_.getFeatures()),this.source_.addEventListener(Jd.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Jd.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(i,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(o,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(r.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(f.A.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new h;const r=this.featuresBeingModified_.getArray();for(let e=0,n=t.length;e<n;++e){const n=t[e].feature;n&&!r.includes(n)&&this.featuresBeingModified_.push(n)}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new Pp("modifystart",this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(f.A.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,r=[];t.forEach((function(t){e===t.feature&&r.push(t)}));for(let e=r.length-1;e>=0;--e){const n=r[e];for(let e=this.dragSegments_.length-1;e>=0;--e)this.dragSegments_[e][0]===n&&this.dragSegments_.splice(e,1);t.remove(n)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const r=t.getCoordinates(),n={feature:e,geometry:t,segment:[r,r]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const r=t.getCoordinates();for(let n=0,i=r.length;n<i;++n){const i=r[n],o={feature:e,geometry:t,depth:[n],index:n,segment:[i,i]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const r=t.getCoordinates();for(let n=0,i=r.length-1;n<i;++n){const i=r.slice(n,n+2),o={feature:e,geometry:t,index:n,segment:i};this.rBush_.insert((0,ee.Tr)(i),o)}}writeMultiLineStringGeometry_(e,t){const r=t.getCoordinates();for(let n=0,i=r.length;n<i;++n){const i=r[n];for(let r=0,o=i.length-1;r<o;++r){const o=i.slice(r,r+2),a={feature:e,geometry:t,depth:[n],index:r,segment:o};this.rBush_.insert((0,ee.Tr)(o),a)}}}writePolygonGeometry_(e,t){const r=t.getCoordinates();for(let n=0,i=r.length;n<i;++n){const i=r[n];for(let r=0,o=i.length-1;r<o;++r){const o=i.slice(r,r+2),a={feature:e,geometry:t,depth:[n],index:r,segment:o};this.rBush_.insert((0,ee.Tr)(o),a)}}}writeMultiPolygonGeometry_(e,t){const r=t.getCoordinates();for(let n=0,i=r.length;n<i;++n){const i=r[n];for(let r=0,o=i.length;r<o;++r){const o=i[r];for(let i=0,a=o.length-1;i<a;++i){const a=o.slice(i,i+2),s={feature:e,geometry:t,depth:[r,n],index:i,segment:a};this.rBush_.insert((0,ee.Tr)(a),s)}}}}writeCircleGeometry_(e,t){const r=t.getCenter(),n={feature:e,geometry:t,index:0,segment:[r,r]},i={feature:e,geometry:t,index:1,segment:[r,r]},o=[n,i];n.featureSegments=o,i.featureSegments=o,this.rBush_.insert((0,ee.dP)(r),n);let a=t;const s=(0,ne.Tf)();if(s&&this.getMap()){const e=this.getMap().getView().getProjection();a=a.clone().transform(s,e),a=(0,re.nD)(a).transform(e,s)}this.rBush_.insert(a.getExtent(),i)}writeGeometryCollectionGeometry_(e,t){const r=t.getGeometriesArray();for(let t=0;t<r.length;++t){const n=r[t];(0,this.SEGMENT_WRITERS_[n.getType()])(e,n)}}createOrUpdateVertexFeature_(e,t,r,n){let i=this.vertexFeature_;return i?i.getGeometry().setCoordinates(e):(i=new Uo.A(new Wo.A(e)),this.vertexFeature_=i,this.overlay_.getSource().addFeature(i)),i.set("features",t),i.set("geometries",r),i.set("existing",n),i}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=m.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=m.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==m.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;const r=this.getMap().getView().getProjection(),i=[],o=t.getGeometry().getCoordinates(),a=(0,ee.Tr)([o]),s=this.rBush_.getInExtent(a),l={};s.sort(Mp);for(let t=0,a=s.length;t<a;++t){const a=s[t],c=a.segment;let u=(0,n.v6)(a.geometry);const h=a.depth;if(h&&(u+="-"+h.join("-")),l[u]||(l[u]=new Array(2)),"Circle"!==a.geometry.getType()||1!==a.index)if(!(0,K.aI)(c[0],o)||l[u][0])if(!(0,K.aI)(c[1],o)||l[u][1])!((0,n.v6)(c)in this.vertexSegments_)||l[u][0]||l[u][1]||i.push(a);else{if(l[u][0]&&0===l[u][0].index){let e=a.geometry.getCoordinates();switch(a.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[h[1]];case"Polygon":if(a.index!==e[h[0]].length-2)continue}}this.dragSegments_.push([a,1]),l[u][1]=a}else this.dragSegments_.push([a,0]),l[u][0]=a;else{const t=Rp(e,a,r);(0,K.aI)(t,o)&&!l[u][0]&&(this.dragSegments_.push([a,0]),l[u][0]=a)}}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map((([e])=>e)));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],r=[],n=[];for(let i=0,o=this.dragSegments_.length;i<o;++i){const o=this.dragSegments_[i],a=o[0],s=a.feature;r.includes(s)||r.push(s);const l=a.geometry;n.includes(l)||n.push(l);const c=a.depth;let u;const h=a.segment,d=o[1];for(;t.length<l.getStride();)t.push(h[d][t.length]);switch(l.getType()){case"Point":u=t,h[0]=t,h[1]=t;break;case"MultiPoint":u=l.getCoordinates(),u[a.index]=t,h[0]=t,h[1]=t;break;case"LineString":u=l.getCoordinates(),u[a.index+d]=t,h[d]=t;break;case"MultiLineString":case"Polygon":u=l.getCoordinates(),u[c[0]][a.index+d]=t,h[d]=t;break;case"MultiPolygon":u=l.getCoordinates(),u[c[1]][c[0]][a.index+d]=t,h[d]=t;break;case"Circle":const r=l;if(h[0]=t,h[1]=t,0===a.index)this.changingFeature_=!0,r.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const n=e.map.getView().getProjection();let i=(0,K.Io)((0,ne.Ad)(r.getCenter(),n),(0,ne.Ad)(t,n));const o=(0,ne.Tf)();if(o){const e=r.clone().transform(o,n);e.setRadius(i),i=e.transform(n,o).getRadius()}r.setRadius(i),this.changingFeature_=!1}}u&&this.setGeometryCoordinates_(l,u)}this.createOrUpdateVertexFeature_(t,r,n,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,r=this.findInsertVerticesAndUpdateDragSegments_(t);if(r?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,r),this.vertexFeature_)){const e=this.vertexFeature_.getGeometry().getCoordinates();for(let t=r.length-1;t>=0;--t)this.insertVertex_(r[t],e);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const r=this.dragSegments_[t][0],n=r.geometry;if("Circle"===n.getType()){const t=n,i=t.getCenter(),o=r.featureSegments[0],a=r.featureSegments[1];o.segment[0]=i,o.segment[1]=i,a.segment[0]=i,a.segment[1]=i,this.rBush_.update((0,ee.dP)(i),o);let s=t;const l=(0,ne.Tf)();if(l){const t=e.map.getView().getProjection();s=s.clone().transform(l,t),s=(0,re.nD)(s).transform(t,l)}this.rBush_.update(s.getExtent(),a)}else this.rBush_.update((0,ee.Tr)(r.segment),r)}return this.featuresBeingModified_&&(this.dispatchEvent(new Pp(xp,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),r=t.getPixelFromCoordinate(e),i=t.getView().getProjection(),o=function(t,r){return Ip(e,t,i)-Ip(e,r,i)};let a,s;if(this.hitDetection_){const e="object"==typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;t.forEachFeatureAtPixel(r,((e,t,r)=>{r&&"Point"===r.getType()&&(r=new Wo.A((0,ne.te)(r.getCoordinates(),i)));const n=r||e.getGeometry();if(n&&"Point"===n.getType()&&e instanceof Uo.A&&this.features_.getArray().includes(e)){s=n;const t=e.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:e,geometry:s,segment:[t,t]}]}return!0}),{layerFilter:e})}if(!a){const r=(0,ne.SD)((0,ee.dP)(e,bp),i),n=t.getView().getResolution()*this.pixelTolerance_,o=(0,ne.JR)((0,ee.r)(r,n,bp),i);a=this.rBush_.getInExtent(o)}if(a&&a.length>0){const l=a.sort(o)[0],c=l.segment;let u=Rp(e,l,i);const h=t.getPixelFromCoordinate(u);let d=(0,K.Io)(r,h);if(s||d<=this.pixelTolerance_){const r={};if(r[(0,n.v6)(c)]=!0,this.snapToPointer_||(this.delta_[0]=u[0]-e[0],this.delta_[1]=u[1]-e[1]),"Circle"===l.geometry.getType()&&1===l.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry],this.snappedToVertex_);else{const e=t.getPixelFromCoordinate(c[0]),i=t.getPixelFromCoordinate(c[1]),o=(0,K.hG)(h,e),s=(0,K.hG)(h,i);if(d=Math.sqrt(Math.min(o,s)),this.snappedToVertex_=d<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_))return void(this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null));this.snappedToVertex_&&(u=o>s?c[1]:c[0]),this.createOrUpdateVertexFeature_(u,[l.feature],[l.geometry],this.snappedToVertex_);const p={};p[(0,n.v6)(l.geometry)]=!0;for(let e=1,t=a.length;e<t;++e){const t=a[e].segment;if(!((0,K.aI)(c[0],t[0])&&(0,K.aI)(c[1],t[1])||(0,K.aI)(c[0],t[1])&&(0,K.aI)(c[1],t[0])))break;{const i=(0,n.v6)(a[e].geometry);i in p||(p[i]=!0,r[(0,n.v6)(t)]=!0)}}}return void(this.vertexSegments_=r)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const r=e.segment,n=e.feature,i=e.geometry,o=e.depth,a=e.index;let s;for(;t.length<i.getStride();)t.push(0);switch(i.getType()){case"MultiLineString":case"Polygon":s=i.getCoordinates(),s[o[0]].splice(a+1,0,t);break;case"MultiPolygon":s=i.getCoordinates(),s[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":s=i.getCoordinates(),s.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(i,s);const l=this.rBush_;l.remove(e),this.updateSegmentIndices_(i,a,o,1);const c={segment:[r[0],t],feature:n,geometry:i,depth:o,index:a};l.insert((0,ee.Tr)(c.segment),c),this.dragSegments_.push([c,1]);const u={segment:[t,r[1]],feature:n,geometry:i,depth:o,index:a+1};return l.insert((0,ee.Tr)(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){const e=this.vertexFeature_?.getGeometry().getCoordinates();return e?(0,ne.te)(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_)return!1;if(this.vertexFeature_.get("geometries").every((e=>"Circle"===e.getType()||e.getType().endsWith("Point"))))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,ee.Tr)([e])).some((({segment:t})=>(0,K.aI)(t[0],e)||(0,K.aI)(t[1],e)))}removePoint(e){if(e&&(e=(0,ne.Ad)(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=m.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_.map((([e])=>e)));const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new Pp(xp,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let r,i,o,a,s,l,c,u,h,d,p,g=!1;for(s=e.length-1;s>=0;--s)o=e[s],d=o[0],p=(0,n.v6)(d.feature),d.depth&&(p+="-"+d.depth.join("-")),p in t||(t[p]={}),0===o[1]?(t[p].right=d,t[p].index=d.index):1==o[1]&&(t[p].left=d,t[p].index=d.index+1);for(p in t){switch(h=t[p].right,c=t[p].left,l=t[p].index,u=l-1,d=void 0!==c?c:h,u<0&&(u=0),a=d.geometry,i=a.getCoordinates(),r=i,g=!1,a.getType()){case"MultiLineString":i[d.depth[0]].length>2&&(i[d.depth[0]].splice(l,1),g=!0);break;case"LineString":i.length>2&&(i.splice(l,1),g=!0);break;case"MultiPolygon":r=r[d.depth[1]];case"Polygon":r=r[d.depth[0]],r.length>4&&(l==r.length-1&&(l=0),r.splice(l,1),g=!0,0===l&&(r.pop(),r.push(r[0]),u=r.length-1))}if(g){this.setGeometryCoordinates_(a,i);const t=[];if(void 0!==c&&(this.rBush_.remove(c),t.push(c.segment[0])),void 0!==h&&(this.rBush_.remove(h),t.push(h.segment[1])),void 0!==c&&void 0!==h){const e={depth:d.depth,feature:d.feature,geometry:d.geometry,index:u,segment:t};this.rBush_.insert((0,ee.Tr)(e.segment),e)}this.updateSegmentIndices_(a,l,d.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return g}canInsertPoint(){if(!this.vertexFeature_)return!1;if(this.vertexFeature_.get("geometries").every((e=>"Circle"===e.getType()||e.getType().endsWith("Point"))))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent((0,ee.Tr)([e])).some((({segment:t})=>!((0,K.aI)(t[0],e)||(0,K.aI)(t[1],e))))}insertPoint(e){const t=e?(0,ne.Ad)(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return!!t&&this.findInsertVerticesAndUpdateDragSegments_(t).reduce(((e,r)=>e||this.insertVertex_(r,t)),!1)}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,r,n){this.rBush_.forEachInExtent(e.getExtent(),(function(i){i.geometry===e&&(void 0===r||void 0===i.depth||(0,V.aI)(i.depth,r))&&i.index>t&&(i.index+=n)}))}},DragAndDrop:Bp,DoubleClickZoom:qe},ol.layer={Layer:Bt,Tile:class extends pg{constructor(e){super(e)}createRenderer(){return new ug(this,{cacheSize:this.getCacheSize()})}},Image:class extends fg{constructor(e){super(e)}createRenderer(){return new gg(this)}getData(e){return super.getData(e)}},Vector:zd,Heatmap:class extends yo{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.filter_=e.filter??!0,this.styleVariables_=e.variables||{},this.gradient_=null,this.addChangeListener(Gf,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:Uf),this.setBlur(void 0!==e.blur?e.blur:15),this.setRadius(void 0!==e.radius?e.radius:8);const r=e.weight?e.weight:"weight";this.weight_=r,this.setRenderOrder(null)}getBlur(){return this.get(Ff)}getGradient(){return this.get(Gf)}getRadius(){return this.get(Bf)}handleGradientChanged_(){this.gradient_=function(e){const t=_e(1,256),r=t.createLinearGradient(0,0,1,256),n=1/(e.length-1);for(let t=0,i=e.length;t<i;++t)r.addColorStop(t*n,e[t]);return t.fillStyle=r,t.fillRect(0,0,1,256),t.canvas}(this.getGradient())}setBlur(e){const t=this.get(Ff);this.set(Ff,e),"number"!=typeof e||"number"!=typeof t?this.clearRenderer():this.changed()}setGradient(e){this.set(Gf,e)}setRadius(e){const t=this.get(Bf);this.set(Bf,e),"number"!=typeof e||"number"!=typeof t?this.clearRenderer():this.changed()}setFilter(e){this.filter_=e,this.changed(),this.clearRenderer()}setWeight(e){this.weight_=e,this.changed(),this.clearRenderer()}createRenderer(){const e=new cf,t={variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1},r=uf(t,this.filter_,Tr);let n=uf(t,this.getRadius(),xr),i=uf(t,this.getBlur(),xr);const o={};"number"==typeof this.getBlur()&&(i="a_blur",o.a_blur=()=>this.getBlur(),e.addUniform("float a_blur")),"number"==typeof this.getRadius()&&(n="a_radius",o.a_radius=()=>this.getRadius(),e.addUniform("float a_radius"));const a={};let s=null;if("string"==typeof this.weight_||"function"==typeof this.weight_){const t="string"==typeof this.weight_?e=>e.get(this.weight_):this.weight_;a.prop_weight={size:1,callback:e=>{const r=t(e);return void 0!==r?(0,z.qE)(r,0,1):1}},s="a_prop_weight",e.addAttribute("a_prop_weight","float")}else s=uf(t,["clamp",this.weight_,0,1],xr);e.addFragmentShaderFunction(`float getBlurSlope() {\n  float blur = max(1., ${i});\n  float radius = ${n};\n  return radius / blur;\n}`).setSymbolSizeExpression(`vec2(${n} + ${i}) * 2.`).setSymbolColorExpression(`vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * getBlurSlope()) * ${s})`).setStrokeColorExpression(`vec4(smoothstep(0., 1., (1. - length(currentRadiusPx * 2. / v_width)) * getBlurSlope()) * ${s})`).setStrokeWidthExpression(`(${n} + ${i}) * 2.`).setFillColorExpression(`vec4(${s})`).setFragmentDiscardExpression(`!${r}`),gf(e,t);const l=mf(t),c=ff(t,this.styleVariables_);return new kf(this,{className:this.getClassName(),variables:this.styleVariables_,style:{builder:e,attributes:{...l,...a},uniforms:{...c,...o}},disableHitDetection:!1,postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n            uniform float u_opacity;\n\n            varying vec2 v_texCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a * u_opacity;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}renderDeclutter(){}}},ol.Observable={unByKey:Bd.e},ol.Object=a.A,ol.proj={METERS_PER_UNIT:ne.Ig,Projection:ne.MF,addEquivalentProjections:ne.O3,get:ne.Jt,transform:ne.pd,transformExtent:ne.DI,getTransform:ne.RG,proj4:{register:function(e){$f=e;const t=Object.keys(e.defs),r=t.length;let n,i;for(n=0;n<r;++n){const r=t[n];if(!(0,zf.Jt)(r)){const t=e.defs(r);let n=t.units;n||"longlat"!==t.projName||(n="degrees"),(0,ne.bF)(new Vf.A({code:r,axisOrientation:t.axis,metersPerUnit:t.to_meter,units:n}))}}for(n=0;n<r;++n){const o=t[n],a=(0,zf.Jt)(o);for(i=0;i<r;++i){const r=t[i],n=(0,zf.Jt)(r);if(!(0,Yf.Jt)(o,r))if(e.defs[o]===e.defs[r])(0,ne.O3)([a,n]);else{const t=e(o,r);(0,ne.hB)(a,n,(0,ne.wU)(a,n,t.forward),(0,ne.wU)(n,a,t.inverse))}}}}},EPSG4326:{METERS_PER_UNIT:jf.Ig,PROJECTIONS:jf.NU}},ol.render={getVectorContext:function(e){if(!(e.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const t=e.inversePixelTransform[0],r=e.inversePixelTransform[1],n=Math.sqrt(t*t+r*r),i=e.frameState,o=(0,So.lw)(e.inversePixelTransform.slice(),i.coordinateToPixelTransform),a=Nd(i.viewState.resolution,n);let s;const l=(0,ne.Tf)();return l&&(s=(0,ne.FO)(l,i.viewState.projection)),new Id(e.context,n,i.extent,o,i.viewState.rotation,a,s)},toContext:function(e,t){const r=e.canvas,n=(t=t||{}).pixelRatio||_,i=t.size;i&&(r.width=i[0]*n,r.height=i[1]*n,r.style.width=i[0]+"px",r.style.height=i[1]+"px");const o=[0,0,r.width,r.height],a=(0,So.hs)((0,So.vt)(),n,n);return new Id(e,n,o,a,0)},EventType:Ft},ol.source={Vector:ep,Cluster:class extends ep{constructor(e){super({attributions:(e=e||{}).attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=void 0!==e.distance?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(e){const t=e.getGeometry();return(0,B.v)(!t||"Point"===t.getType(),"The default `geometryFunction` can only handle `Point` or null geometries"),t},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,r){this.source?.loadFeatures(e,t,r),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(f.A.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(f.A.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const r=0===e?0:Math.min(t,e)/e,n=e!==this.distance||this.interpolationRatio!==r;this.distance=e,this.minDistance=t,this.interpolationRatio=r,n&&this.refresh()}cluster(){if(void 0===this.resolution||!this.source)return;const e=(0,ee.S5)(),t=this.distance*this.resolution,r=this.source.getFeatures(),i={};for(let o=0,a=r.length;o<a;o++){const a=r[o];if(!((0,n.v6)(a)in i)){const r=this.geometryFunction(a);if(r){const o=r.getCoordinates();(0,ee.dP)(o,e),(0,ee.r)(e,t,e);const a=this.source.getFeaturesInExtent(e).filter((function(e){const t=(0,n.v6)(e);return!(t in i)&&(i[t]=!0,!0)}));this.features.push(this.createCluster(a,e))}}}}createCluster(e,t){const r=[0,0];for(let t=e.length-1;t>=0;--t){const n=this.geometryFunction(e[t]);n?(0,K.WQ)(r,n.getCoordinates()):e.splice(t,1)}(0,K.hs)(r,1/e.length);const n=(0,ee.q1)(t),i=this.interpolationRatio,o=new Wo.A([r[0]*(1-i)+n[0]*i,r[1]*(1-i)+n[1]*i]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new Uo.A({geometry:o,features:e})}},ImageWMS:class extends em{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:Jf,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=void 0===e.hidpi||e.hidpi,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,r,n){const i=(0,ne.Jt)(r),o=this.getProjection();return o&&o!==i&&(t=eg(o,i,e,t),e=(0,ne.pd)(e,i,o)),function(e,t,r){if(void 0===e.url)return;const n=(0,ne.Jt)(e.projection||"EPSG:3857"),i=(0,ee.Bg)(t,r,0,lm),o={QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(o,um(e.params,"GetFeatureInfo"),e.params);const a=(0,z.RI)((t[0]-i[0])/r,4),s=(0,z.RI)((i[3]-t[1])/r,4),l=(0,ko.Z)(o.VERSION,"1.3")>=0;return o[l?"I":"X"]=a,o[l?"J":"Y"]=s,cm(e.url,i,lm,n,o)}({url:this.url_,params:{...this.params_,...n},projection:o||i},e,t)}getLegendUrl(e,t){return function(e,t){if(void 0===e.url)return;const r={SERVICE:"WMS",VERSION:sm,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0!==t){const n=(0,ne.Jt)(e.projection||"EPSG:3857").getMetersPerUnit()||1,i=28e-5;r.SCALE=t*n/i}if(Object.assign(r,e.params),void 0!==e.params&&void 0===r.LAYER){const e=r.LAYERS;if(Array.isArray(e)&&1===e.length)return;r.LAYER=e}return tm(e.url,r)}({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,r,n){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===n||(this.loaderProjection_=n,this.loader=hm({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(e,t)=>(this.image.setImage(e),this.imageLoadFunction_(this.image,t),Qn(e))})),super.getImageInternal(e,t,r,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}},WMTS:class extends _m{constructor(e){const t=void 0!==e.requestEncoding?e.requestEncoding:"KVP",r=e.tileGrid;let n=e.urls;void 0===n&&void 0!==e.url&&(n=am(e.url)),super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,urls:n,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition,zDirection:e.zDirection}),this.version_=void 0!==e.version?e.version:"1.0.0",this.format_=void 0!==e.format?e.format:"image/jpeg",this.dimensions_=void 0!==e.dimensions?e.dimensions:{},this.layer_=e.layer,this.matrixSet_=e.matrixSet,this.style_=e.style,this.requestEncoding_=t,this.setKey(this.getKeyForDimensions_()),n&&n.length>0&&(this.tileUrlFunction=gm(n.map(this.createFromWMTSTemplate.bind(this))))}setUrls(e){this.urls=e;const t=e.join("\n");this.setTileUrlFunction(gm(e.map(this.createFromWMTSTemplate.bind(this))),t)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const e=this.urls?this.urls.slice(0):[];for(const t in this.dimensions_)e.push(t+"-"+this.dimensions_[t]);return e.join("/")}updateDimensions(e){Object.assign(this.dimensions_,e),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(e){const t=this.requestEncoding_,r={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==t&&Object.assign(r,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e="KVP"==t?tm(e,r):e.replace(/\{(\w+?)\}/g,(function(e,t){return t.toLowerCase()in r?r[t.toLowerCase()]:e}));const n=this.tileGrid,i=this.dimensions_;return function(r,o,a){if(!r)return;const s={TileMatrix:n.getMatrixId(r[0]),TileCol:r[1],TileRow:r[2]};Object.assign(s,i);let l=e;return l="KVP"==t?tm(l,s):l.replace(/\{(\w+?)\}/g,(function(e,t){return encodeURIComponent(s[t])})),l}}},TileEventType:Am,VectorEventType:Jd,ImageCanvas:class extends em{constructor(e){super({attributions:(e=e||{}).attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=void 0!==e.ratio?e.ratio:1.5}getImageInternal(e,t,r,n){t=this.findNearestResolution(t);let i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==r&&(0,ee.ms)(i.getExtent(),e))return i;e=e.slice(),(0,ee.Af)(e,this.ratio_);const o=[(0,ee.RG)(e)/t*r,(0,ee.Oq)(e)/t*r],a=this.canvasFunction_.call(this,e,t,r,o,n);return a&&(i=new Lm(e,t,r,a)),this.canvas_=i,this.renderedRevision_=this.getRevision(),i}},Image:{defaultImageLoadFunction:Jf}},ol.source.WMTS.optionsFromCapabilities=function(e,t){const r=e.Contents.Layer,n=r?.find((function(e){return e.Identifier==t.layer}));if(!n)return null;const i=e.Contents.TileMatrixSet;let o;o=n.TileMatrixSetLink.length>1?"projection"in t?n.TileMatrixSetLink.findIndex((function(e){const r=i.find((function(t){return t.Identifier==e.TileMatrixSet})).SupportedCRS,n=(0,ne.Jt)(r),o=(0,ne.Jt)(t.projection);return n&&o?(0,ne.tI)(n,o):r==t.projection})):n.TileMatrixSetLink.findIndex((function(e){return e.TileMatrixSet==t.matrixSet})):0,o<0&&(o=0);const a=n.TileMatrixSetLink[o].TileMatrixSet,s=n.TileMatrixSetLink[o].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),o=n.Style.findIndex((function(e){return"style"in t?e.Title==t.style:e.isDefault})),o<0&&(o=0);const c=n.Style[o].Identifier,u={};"Dimension"in n&&n.Dimension.forEach((function(e,t,r){const n=e.Identifier;let i=e.Default;void 0===i&&(i=e.Value[0]),u[n]=i}));const h=e.Contents.TileMatrixSet.find((function(e){return e.Identifier==a}));let d;const p=h.SupportedCRS;if(p&&(d=(0,ne.Jt)(p)),"projection"in t){const e=(0,ne.Jt)(t.projection);e&&(d&&!(0,ne.tI)(e,d)||(d=e))}let g=!1;const f=d.getAxisOrientation().startsWith("ne");let m=h.TileMatrix[0],y={MinTileCol:0,MinTileRow:0,MaxTileCol:m.MatrixWidth-1,MaxTileRow:m.MatrixHeight-1};if(s){y=s[s.length-1];const e=h.TileMatrix.find((e=>e.Identifier===y.TileMatrix||h.Identifier+":"+e.Identifier===y.TileMatrix));e&&(m=e)}const v=28e-5*m.ScaleDenominator/d.getMetersPerUnit(),A=f?[m.TopLeftCorner[1],m.TopLeftCorner[0]]:m.TopLeftCorner,S=m.TileWidth*v,E=m.TileHeight*v;let w=h.BoundingBox;w&&f&&(w=[w[1],w[0],w[3],w[2]]);let _=[A[0]+S*y.MinTileCol,A[1]-E*(1+y.MaxTileRow),A[0]+S*(1+y.MaxTileCol),A[1]-E*y.MinTileRow];if(void 0!==w&&!(0,ee.ms)(w,_)){const e=n.WGS84BoundingBox,t=(0,ne.Jt)("EPSG:4326").getExtent();if(_=w,e)g=e[0]===t[0]&&e[2]===t[2];else{const e=(0,ne.DI)(w,h.SupportedCRS,"EPSG:4326");g=e[0]-1e-10<=t[0]&&e[2]+1e-10>=t[2]}}const L=function(e,t,r){const n=[],i=[],o=[],a=[],s=[];r=void 0!==r?r:[];const l="TileMatrix",c="Identifier",u="ScaleDenominator",h="TopLeftCorner",d=e.SupportedCRS,p=(0,ne.Jt)(d),g=p.getMetersPerUnit(),f=p.getAxisOrientation().startsWith("ne");return e[l].sort((function(e,t){return t[u]-e[u]})),e[l].forEach((function(t){let d;if(d=!(r.length>0)||r.find((function(r){return t[c]==r[l]||!t[c].includes(":")&&e[c]+":"+t[c]===r[l]})),d){i.push(t[c]);const e=28e-5*t[u]/g,r=t.TileWidth,l=t.TileHeight;f?o.push([t[h][1],t[h][0]]):o.push(t[h]),n.push(e),a.push(r==l?r:[r,l]),s.push([t.MatrixWidth,t.MatrixHeight])}})),new dm({extent:t,origins:o,resolutions:n,matrixIds:i,tileSizes:a,sizes:s})}(h,_,s),C=[];let b=t.requestEncoding;if(b=void 0!==b?b:"","OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata){const t=e.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let e=0,r=t.length;e<r;++e)if(t[e].Constraint){const r=t[e].Constraint.find((function(e){return"GetEncoding"==e.name})).AllowedValues.Value;if(""===b&&(b=r[0]),"KVP"!==b)break;r.includes("KVP")&&C.push(t[e].href)}else t[e].href&&(b="KVP",C.push(t[e].href))}return 0===C.length&&(b="REST",n.ResourceURL.forEach((function(e){"tile"===e.resourceType&&(l=e.format,C.push(e.template))}))),{urls:C,layer:t.layer,matrixSet:a,format:l,projection:d,requestEncoding:b,tileGrid:L,style:c,dimensions:u,wrapX:g,crossOrigin:t.crossOrigin}},ol.tilegrid={TileGrid:Hf},ol.style={Style:ji,RegularShape:Pi,Circle:Ii,Fill:Oi,Icon:ki,Stroke:Gi,Text:zi},ol.xml={parse:xa.qg,parseNode:xa.UN,createElementNS:xa.qq,pushParseAndPop:xa.eY,pushSerializeAndPop:xa.NQ,makeStructureNS:xa.Dm,getAllTextContent:xa.mT,makeChildAppender:xa.mm,makeReplacer:xa.Tb,makeSequence:xa.Gl,makeArrayPusher:xa.VT,makeArrayExtender:xa.Vh,makeArraySerializer:xa.gN,makeObjectPropertySetter:xa.kW,makeSimpleNodeFactory:xa.X1,OBJECT_PROPERTY_NODE_FACTORY:xa.OL,XML_SCHEMA_INSTANCE_URI:xa.pF};for(var km=0,Fm=["ms","moz","webkit","o"],Gm=0;Gm<Fm.length&&!window.requestAnimationFrame;++Gm)window.requestAnimationFrame=window[Fm[Gm]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Fm[Gm]+"CancelAnimationFrame"]||window[Fm[Gm]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var r=(new Date).getTime(),n=Math.max(0,16-(r-km)),i=window.setTimeout((function(){e(r+n)}),n);return km=r+n,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});const Bm="mousemove",Um="mouseover",qm=ol.events.EventType.DRAGENTER,Wm=ol.events.EventType.DRAGOVER,Hm=ol.events.EventType.DROP,jm=ol.events.EventType.CHANGE,Vm=ol.MapBrowserEventType.CLICK,zm=ol.MapBrowserEventType.SINGLECLICK,Ym=ol.MapBrowserEventType.POINTERMOVE,$m=ol.MapEventType.MOVEEND,Km=ol.render.EventType.POSTRENDER,Xm=ol.source.VectorEventType.ADDFEATURE,Zm=ol.source.VectorEventType.REMOVEFEATURE,Jm=ol.source.VectorEventType.CLEAR,Qm="bottom-left",ey="bottom-center",ty="bottom-right",ry="center-center",ny="center-right",iy="Point",oy="MultiPoint",ay="LineString",sy="MultiLineString",ly="Polygon",cy="MultiPolygon",uy=Eh.A.detectMouse()?3:10,hy="@",dy="#text";ol.View.prototype.getValueForResolutionFunction=function(e){const t=e||2,r=this.maxResolution_,n=this.minResolution_,i=Math.log(r/n)/Math.log(t);return function(e){var n=Math.log(r/e)/Math.log(t)/i;return Math.max(Math.min(1,n),0)}},ol.control.OverviewMap.prototype._validateExtent_=ol.control.OverviewMap.prototype.validateExtent_,ol.control.OverviewMap.prototype.validateExtent_=function(){var e=this;e._validateExtent_(),e._wrap&&e._wrap.parent.options.alwaysCentered&&e.recenter_()},ol.control.OverviewMap.prototype._bindView_=ol.control.OverviewMap.prototype.bindView_,ol.control.OverviewMap.prototype.bindView_=function(e){const t=this,r=t.getOverviewMap().getView(),n=ol.control.OverviewMap.prototype._bindView_.call(t,e),i=t.getOverviewMap().getView(),o=t._wrap.parent.map.wrap.map.getView();return i.getCenter()||i.setCenter(o.getCenter()),i.getResolution()||i.setResolution(r.getResolution()),n},ol.control.OverviewMap.prototype._resetExtent_=ol.control.OverviewMap.prototype.resetExtent_,ol.control.OverviewMap.prototype.resetExtent_=function(){var e=this;e._resetExtent_.call(e);var t=e._wrap;if(t.is3D){var r=e.getOverviewMap().getView(),n=r.calculateExtent(),i=t.get3DCameraLayer().getSource().getFeatures()[0];if(i){const e=i.getGeometry().getCoordinates();var o=e[0][0],a=e[0][1];if(!ol.extent.containsCoordinate(n,o)||!ol.extent.containsCoordinate(n,a)){var s=Math.max(n[0]-o[0],n[1]-o[1],o[0]-n[2],o[1]-n[3],n[0]-a[0],n[1]-a[1],a[0]-n[2],a[1]-n[3]);r.fit(ol.extent.buffer(n,s))}}}},ol.control.OverviewMap.prototype._updateBox_=ol.control.OverviewMap.prototype.updateBox_,ol.control.OverviewMap.prototype.updateBox_=function(){const e=this;e._updateBox_.call(e),e.boxOverlay_.handlePositionChanged()},ol.format.GML3CRS84=class extends Xh{constructor(){super({srsName:"CRS:84"})}};class py extends cs.A{constructor(){super({srsName:"CRS:84"})}}ol.format.GML2CRS84=py,ol.proj.addEquivalentProjections(ol.proj.EPSG4326.PROJECTIONS),ol.proj.proj4.register(Cm.A);const gy=ol.format.GeoJSON.prototype.readFeatureFromObject;ol.format.GeoJSON.prototype.readFeatureFromObject=function(e,t){const r=e=>{if(e)for(const t in e){const n=e[t];n&&"object"==typeof n&&(Object.prototype.hasOwnProperty.call(n,"simpleContent")&&null===n.simpleContent?e[t]=null:r(n))}},n={...e};return r(n.properties),gy.call(this,n,t)};const fy=Eh.A.detectMobile(),my=ol.source.WMTS.prototype.getTilePixelRatio;ol.source.WMTS.prototype.getTilePixelRatio=function(e){return fy?my.call(this,e):my.call(this,e)*(e||1)};const yy=ol.tilegrid.TileGrid.prototype.getZForResolution;ol.tilegrid.TileGrid.prototype.getZForResolution=function(e,t){let r=e;return fy||(r/=window.devicePixelRatio),yy.call(this,r,t)},ol.Overlay.prototype.updateRenderedPosition=function(e,t){const r=this.element.style,n=this.getOffset(),i=this.getPositioning();this.setVisible(!0);let o=n[0],a=n[1];if(i==ty||i==ny||"top-right"==i){""!==this.rendered.left_&&(this.rendered.left_=r.left="");const n=Math.round(t[0]-e[0]-o)+"px";this.rendered.right_!=n&&(this.rendered.right_=r.right=n)}else{""!==this.rendered.right_&&(this.rendered.right_=r.right=""),i!=ey&&i!=ry&&"top-center"!=i||(o-=this.element.offsetWidth/2);const t=Math.round(e[0]+o)+"px";this.rendered.left_!=t&&(this.rendered.left_=r.left=t)}if(i==Qm||i==ey||i==ty){""!==this.rendered.top_&&(this.rendered.top_=r.top="");const n=Math.round(t[1]-e[1]-a)+"px";this.rendered.bottom_!=n&&(this.rendered.bottom_=r.bottom=n)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=r.bottom=""),"center-left"!=i&&i!=ry&&i!=ny||(a-=this.element.offsetHeight/2);const t=Math.round(e[1]+a)+"px";this.rendered.top_!=t&&(this.rendered.top_=r.top=t)}};const vy=ol.source.ImageWMS.prototype.getRequestUrl_;ol.source.ImageWMS.prototype.getRequestUrl_=function(e,t,r,n,i){if(1!==r){const e=90*r+.5|0;i.MAP_RESOLUTION=e,i.DPI=e}return vy.call(this,e,t,r,n,i)};const Ay=ol.interaction.Snap.prototype.snapTo;ol.interaction.Snap.prototype.snapTo=function(e,t,r){const n=Ay.call(this,e,t,r);return this._snapData=n,n},la.Ay.prototype.featureMetadata=new WeakMap,na.A.prototype.getType=function(e){if(void 0===e)return al.A.dataType.STRING;switch(e.substring(e.indexOf(":")+1)){case"ID":return"ID";case"string":case"anyURI":return al.A.dataType.STRING;case"number":case"double":case"float":case"decimal":return al.A.dataType.FLOAT;case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":return al.A.dataType.INTEGER;case"boolean":return al.A.dataType.BOOLEAN;case"date":return al.A.dataType.DATE;case"time":return al.A.dataType.TIME;case"dateTime":return al.A.dataType.DATETIME;default:return"object"}},na.A.prototype.getFeatureTypeMetadata=function(e,t){const r={...e},n=t[0],i=n?.getGeometryName();r.attributes=[];const o=(e,t,...r)=>{const n={name:r[r.length-1]};if((0===t["@minOccurs"]||r[r.length-1].startsWith(hy))&&(n.optional=!0),(t["@maxOccurs"]>1||"unbounded"===t["@maxOccurs"])&&(n.multiple=!0),t["@nillable"]||(n.nonNullable=!0),"object"==typeof t.type){const i=t.type;n.value=[],n.type="object";const a=sl.default.getSchemaEntries(i);for(const[t,i]of a){const a=o(e,i,...r,t);a&&n.value.push(a)}return n}if(n.type=this.getType(t.type),"ID"===n.type)n.isId=!0,n.type=al.A.dataType.STRING;else if("object"===n.type){const n=this.getGeometryType(t.type);if(n)return e.geometries??=[],e.geometries.push({name:r,type:n,originalType:t.type}),null}return n},a=Object.keys(e.originalMetadata.featureTypes)[0];if(a&&!a.endsWith(":feature")){const t=e.originalMetadata.featureTypes[a],n=sl.default.getSchemaEntries(t);for(const[e,t]of n){const n=o(r,t,e);e===i||"string"==typeof n||null===n?(r.geometries??=[],r.geometries.push({name:e,type:this.constructor.getGeometryType(t.type),originalType:t.type})):r.attributes.push(n)}}const s=e=>{for(let t=e.length-1;t>=0;t--){const r=e[t];if(Array.isArray(r.value)){const n=r.value.filter((e=>e.name.startsWith(hy))),i=r.value.filter((e=>!e.name.startsWith(hy)&&e.name!==dy));if(!n.length||i.length||r.multiple)s(r.value);else{e.splice(t+1,0,...n.map((e=>({name:r.name+e.name,type:e.type,optional:e.optional}))));const i=r.value.find((e=>e.name===dy));i?(r.type=i.type,delete r.value):e.splice(t,1)}}}};return s(r.attributes),r.equals=(e,t)=>{const r=e=>e.split(hy).map((e=>(e=>{let[t,r]=function(e){let[t,r]=e.split(":");return r||([t,r]=[r,t]),[t,r]}(e);return[t??"gml",r]})(e))).flat(),n=r(e),i=r(t);return n.every(((e,t)=>e===i[t]))&&i.every(((e,t)=>e===n[t]))},r},na.A.prototype.getGeometryType=function(e){return!1};const Sy=function(e,t){var r;return r=e?(r=ol.color.asArray(e)).slice():[0,0,0,1],void 0!==t&&(r[3]=t),r},Ey=function(e,t,r){const n=e.map.getView(),i=n.getResolution(),o=Eh.A.detectMobile()?1:e.map.pixelRatio_,a={projection:n.getProjection(),center:n.getCenter(),resolution:i,enableRotation:!1,constrainResolution:!0,constrainOnlyCenter:!0,showFullExtent:!0,smoothExtentConstraint:!0};e.parent.maxExtent&&(a.extent=e.parent.maxExtent);var s=t;t.type===al.A.layerType.VECTOR&&e.parent.getBaseLayer()&&(s=e.parent.getBaseLayer());const l=s.getResolutions?s.getResolutions():[];var c,u;if(l&&l.length){c=s.maxResolution||r?.maxResolution||l[0]+l[0]/1e3,u=s.minResolution||r?.minResolution||l[l.length-1];let e=l.length-l.slice().reverse().findIndex((e=>e>=u))-1;e===l.length&&(e=-1);const t=l.findIndex((e=>e<=c));a.resolutions=l.slice(t,e+1),1!==o&&(a.resolutions=a.resolutions.map((e=>e*o)))}else c=s.maxResolution,u=s.minResolution;return u&&(u*=o,a.minResolution=u,i<u&&(a.resolution=u)),c&&(c*=o,a.maxResolution=c,i>c&&(a.resolution=c)),a};bm.A.wrap.Map.prototype.setMap=function(){var e=this,t=[(e.parent.initialExtent[0]+e.parent.initialExtent[2])/2,(e.parent.initialExtent[1]+e.parent.initialExtent[3])/2],r=(0,Cm.A)(e.parent.crs);!function(){var t=e.parent.crs.substr(e.parent.crs.lastIndexOf(":")+1),n={units:r.oProj.units},i=[];"4326"!==t&&(n.code="EPSG:"+t,i.push(new ol.proj.Projection(n)),n.code="urn:ogc:def:crs:EPSG::"+t,i.push(new ol.proj.Projection(n)),ol.proj.addEquivalentProjections(i)),ol.proj.proj4.register(Cm.A)}();var n={code:e.parent.crs,units:r.oProj.units};"EPSG:4326"===e.parent.crs&&(n.axisOrientation="neu");var i=new ol.proj.Projection(n),o=ol.interaction.defaults(),a={projection:i,center:t,enableRotation:!1,constrainResolution:!0,constrainOnlyCenter:!0,showFullExtent:!0,smoothExtentConstraint:!0};const s=e.parent.maxExtent||e.parent.initialExtent;e.parent.maxExtent&&(a.extent=e.parent.maxExtent);var l=e.parent.div.getBoundingClientRect(),c=s[2]-s[0],u=s[3]-s[1];let h;a.resolution=Math.max(c/l.width,u/l.height),e.map=new ol.Map({target:e.parent.div,view:new ol.View(a),controls:[],interactions:o}),e.map._wrap=e,e._promise=Promise.resolve(e.map),e.manageSize.call(e.map),e.parent.one(al.A.event.MAPLOAD,(function(){e.updateSize()})),e.map.on(zm,(function(t){if(e.parent.view!==al.A.view.PRINTING){e.parent.workLayers.forEach((function(e){delete e._noFeatureClicked}));var r=e.parent.workLayers.map((function(){return!1}));e.map.forEachFeatureAtPixel(t.pixel,(function(t,n){if(t._wrap&&t._wrap.parent.showsPopup){for(var i=0;i<e.parent.workLayers.length;i++)if(e.parent.workLayers[i].wrap.layer===n){r[i]=!0;break}return e.parent.trigger(al.A.event.FEATURECLICK,{feature:t._wrap.parent}),t}}),{hitTolerance:uy});for(var n=0;n<r.length;n++)r[n]||e.parent.trigger(al.A.event.NOFEATURECLICK,{layer:e.parent.workLayers[n]})}}));const d=function(t){const r=h.getResolution(),n=h.getProjection().getCode();e.parent.layers.filter((e=>e.type===al.A.layerType.WMS)).forEach((e=>{const t=e.getExtent({crs:n});if(t){const n=Dy(t,r,100);e.wrap.layer.setExtent(n)}else e.wrap.layer.setExtent()}))},p=function(){h=e.map.getView(),h.on("change:resolution",d),d()};e.map.on($m,(function(){e.parent.trigger(al.A.event.ZOOM)})),p(),h.on("change:resolution",(function(t){e.parent.trigger(al.A.event.BEFOREZOOM)}),e.parent),e.map.on("change:view",p);const g=function(t,r){if(t){var n=Ey(e,t,r),i=new ol.View(n);e.map.setView(i),e.map.render()}};e.parent.on(al.A.event.BEFOREBASELAYERCHANGE,(function(t){if(e.parent.crs===e.parent.options.crs&&!e.parent.on3DView&&t.newLayer.type!==al.A.layerType.VECTOR){const r=t.oldLayer.getResolutions();let n=t.newLayer;const i={};!t.newLayer.getResolutions()&&r&&(n=t.oldLayer,i.minResolution=t.newLayer.minResolution,i.maxResolution=t.newLayer.maxResolution),e.parent.one(al.A.event.BASELAYERCHANGE,(function(e){g(n,i)}))}})),e.parent.on(al.A.event.MAPLOAD,(function(t){g(e.parent.getBaseLayer())}));const f=e.map.getViewport();f.addEventListener(al.A.event.MOUSEMOVE,(function(t){var r=!1;if(!e.parent.activeControl||!e.parent.activeControl.isExclusive()){if(e.parent.view===al.A.view.PRINTING)return;var n=e.map.getEventPixel(t);r=e.map.forEachFeatureAtPixel(n,(function(t,r){var n=!0;return!t._wrap||t._wrap.parent.showsPopup||t._wrap.parent.options.selectable||(n=!1),n&&t._wrap&&e.parent.trigger(al.A.event.FEATUREOVER,{feature:t._wrap.parent}),n}),{hitTolerance:uy})}f.style.cursor=r?"pointer":""})),function t(){matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`).addEventListener("change",t,{once:!0}),e.map.pixelRatio_=window.devicePixelRatio,g(e.parent.baseLayer),e.manageSize()}()},bm.A.wrap.Map.prototype.updateSize=function(){this.map.updateSize()};var wy=function(e,t){var r=e.getUnits();return r&&r!==al.A.units.DEGREES?ol.proj.METERS_PER_UNIT[r]:Eh.A.getMetersPerDegree(t)};bm.A.wrap.Map.prototype.getMetersPerUnit=function(){return wy(ol.proj.get(this.parent.crs),this.getExtent())};var _y=function(e={}){var t=this.parent.options.crs||bm.A.Cfg.crs,r=ol.proj.get(t),n=ol.proj.get(e.crs);return wy(n,e.extentInDegrees)/wy(r,e.extentInDegrees)},Ly=function(e){var t;return(t=e.axisOrientation?new ol.proj.Projection({code:e.crs,axisOrientation:e.axisOrientation}):ol.proj.get(e.crs)).getUnits()||(t.units_=al.A.units.DEGREES),t};bm.A.wrap.Map.prototype.setProjection=function(e={}){const t=this,r=e.baseLayer||t.parent.baseLayer;var n;n=e.extent?e.extent:ol.proj.transformExtent(t.getExtent(),t.parent.crs,e.crs);const i=ol.proj.transformExtent(n,e.crs,"EPSG:4326"),o=_y.call(t,{crs:e.crs,extentInDegrees:i}),a=Ly(e),s=t.map.getView(),l={projection:a,enableRotation:!1,constrainResolution:!0,constrainOnlyCenter:!0,showFullExtent:!0,smoothExtentConstraint:!0},c=r.getResolutions();if(c&&c.length)l.resolutions=c;else{l.minZoom=s.getMinZoom(),l.maxZoom=s.getMaxZoom();const e=r.wrap.layer.getMinResolution(),n=r.wrap.layer.getMaxResolution();var u=1;0!==e&&n!==Number.POSITIVE_INFINITY||(u=_y.call(t,{crs:t.parent.crs,extentInDegrees:i})/o),l.minResolution=0===e?s.getMinResolution()*u:e,n===Number.POSITIVE_INFINITY?l.maxResolution=s.getMaxResolution()*u:l.maxResolution=n}t.parent.workLayers.forEach((t=>{t.type===al.A.layerType.WMS&&t.getExtent({crs:e.crs})&&t.wrap.layer.setExtent(t.getExtent())})),l.center=ol.proj.transform(t.getCenter(),t.parent.crs,e.crs),t.parent.initialExtent=1!==o?ol.proj.transformExtent(t.parent.initialExtent,t.parent.crs,e.crs):t.parent.options.initialExtent,t.parent.options.maxExtent&&(t.parent.maxExtent=1!==o?ol.proj.transformExtent(t.parent.maxExtent,t.parent.crs,e.crs):t.parent.options.maxExtent,l.extent=t.parent.maxExtent);var h=new ol.View(l);t.map.setView(h),h.fit(n,{nearest:!0})},bm.A.wrap.Map.prototype.insertLayer=function(e,t){const r=this,n=r.map.getLayers();let i;if("number"==typeof t)i=t;else{i=-1;const e=n.getArray();for(const r of t.previousLayers)i=Math.max(i,e.indexOf(r));i++}for(var o=!1,a=0;a<n.getLength();a++)if(n.item(a)===e){o=!0;break}const s=e._wrap;if(!s.parent.isBase&&s.parent.type===al.A.layerType.WMS){const t=s.parent.getExtent();t&&e.setExtent(Dy(t,r.getResolution(),100))}if(o&&n.remove(e),i<0?n.push(e):n.insertAt(n.getLength()<i?n.getLength():i,e),!o){const t=r.map.getView();if(r.parent.crs===r.parent.options.crs){if(e instanceof ol.layer.Tile){var l=e.getSource().getResolutions();t.maxResolution_=l[0],t.minResolution_=l[l.length-1]}}else e instanceof ol.layer.Tile&&(e.setMaxResolution(t.getMaxResolution()),e.setMinResolution(t.getMinResolution()));let n=0;const i=function(t){s.parent.state=Rm.A.state.LOADING,n<=0&&(n=0,r.parent.trigger(al.A.event.BEFORELAYERUPDATE,{layer:s.parent})),e._loadingTileCount=e._loadingTileCount+1};s.parent.state===Rm.A.state.LOADING&&s.parent.isRaster()&&i(),s.$events.on(al.A.event.BEFORETILELOAD,i),s.$events.on(al.A.event.TILELOAD+" "+al.A.event.TILELOADERROR,(function(e){n-=1,n<=0&&(n=0,s.parent.state=Rm.A.state.IDLE,r.parent.trigger(al.A.event.LAYERUPDATE,{layer:s.parent}))}))}},bm.A.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)},bm.A.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()},bm.A.wrap.Map.prototype.indexOfFirstVector=function(){var e=-1;return this.map.getLayerGroup().getLayers().forEach((function(t,r){t instanceof ol.layer.Vector&&-1===e&&(e=r)})),e},bm.A.wrap.Map.prototype.getLayerIndex=function(e){var t=-1;return this.map.getLayerGroup().getLayers().forEach((function(r,n){r===e&&(t=n)})),t},bm.A.wrap.Map.prototype.setLayerIndex=function(e,t){var r=this.map.getLayers().getArray().indexOf(e);r>-1&&r!==t&&(this.map.removeLayer(e),this.insertLayer(e,t))},bm.A.wrap.Map.prototype.setBaseLayer=function(e){var t=this;return new Promise((function(r,n){var i,o,a,s=function(n){if((n=n||t.parent.getBaseLayer())&&(t.map.removeLayer(n.wrap.layer),e instanceof ol.layer.Image&&e._wrap.setProjection({crs:t.parent.crs}),e._wrap.parent.type===al.A.layerType.WMTS)){var i={crs:t.parent.crs,oldCrs:e.getSource().getProjection().getCode()};i.oldCrs!==i.crs&&e._wrap.parent.setProjection(i)}t.insertLayer(e,0),t.map.getControls().forEach((function(e){e instanceof ol.control.ZoomSlider&&e.initSlider_()})),r()},l=Ey(t,e._wrap.parent),c=t.map.getView(),u=c.getResolution();if(!l.resolutions&&(l.minResolution||l.maxResolution)){const e=c.getResolutions();if(e){const t=e.filter((e=>!(l.minResolution&&e<l.minResolution||l.maxResolution&&e>l.maxResolution)));t.length<e.length&&(l.resolutions=t)}}if(l.resolutions){const e=new ol.View(l);var h=(i=u,o=l.resolutions,a=t.parent.options.maxResolutionError,o?o.slice().sort((function(e,t){return e-t})).reduce((function(e,t){return 0===e&&(t>i||Math.abs(1-i/t)<a)?t:e}),0):i);h!==u&&t.parent.isLoaded?c.animate({resolution:h,duration:al.A.ZOOM_ANIMATION_DURATION},(function(){t.map.setView(e),s(t.parent.getBaseLayer())})):(t.map.setView(e),e.setResolution(h),s())}else s()}))},bm.A.wrap.Map.prototype.setExtent=function(e,t,r){const n=this;return Eh.A.isFunction(t)?(r=t,t={}):t=t||{},Promise.resolve(n._setExtentPromise).finally((function(){!function(e){n._setExtentPromise=new Promise((function(i,o){clearTimeout(n._timeout),n._timeout=setTimeout((function(){const o={callback:function(){const e=n.getExtent();Eh.A.isFunction(r)&&r(e),i(e)},nearest:!t.contain};(void 0===t.animate||t.animate)&&(o.duration=al.A.ZOOM_ANIMATION_DURATION),n.map.getView().fit(e,o)}),50)}))}(e)})),n._setExtentPromise},bm.A.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())},bm.A.wrap.Map.prototype.setCenter=function(e,t={}){const r=this;return new Promise((function(n,i){const o=r.map.getView();t.animate?o.animate({center:e,duration:al.A.ZOOM_ANIMATION_DURATION},(function(){n()})):(o.setCenter(e),n())}))},bm.A.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()},bm.A.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()},bm.A.wrap.Map.prototype.setResolution=async function(e){return(await this.getMap()).getView().setResolution(e),e},bm.A.wrap.Map.prototype.setRotation=function(e){this.getMap().then((function(t){t.getView().setRotation(e)}))},bm.A.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()},bm.A.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]},bm.A.wrap.Map.prototype.getCoordinateFromPixel=function(e){return this.map.getCoordinateFromPixel(e)},bm.A.wrap.Map.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)},bm.A.wrap.Map.prototype.getViewport=function(e){const t=this;return(e||{}).synchronous?t.map.getViewport():new Promise((function(e,r){t.getMap().then((function(t){e(t.getViewport())}))}))},bm.A.wrap.Map.prototype.getCanvas=function(){const e=this;if(e.parent.on3DView){const t=e.parent.view3D.getScene(),r=document.createElementNS("http://www.w3.org/2000/svg","canvas");r.width=t.canvas.width,r.height=t.canvas.height;const n=r.getContext("2d");return t.canvas.getContext("webgl",{preserveDrawingBuffer:!0}),t.requestRenderMode=!1,t.render(),n.drawImage(t.canvas,0,0,t.canvas.width,t.canvas.height),t.requestRenderMode=!0,t.canvas.getContext("webgl",{preserveDrawingBuffer:!1}),[r]}return Array.from(e.parent.div.querySelectorAll(".ol-viewport canvas:not(.tc-ctl-ovmap canvas)"))},bm.A.wrap.Map.prototype.isNative=function(e){return e instanceof ol.Map},bm.A.wrap.Map.prototype.isGeo=function(){var e=this.map.getView().getProjection().getUnits();return!e||e===al.A.units.DEGREES},bm.A.wrap.Map.prototype.addPopup=async function(e){const t=this;var n=void 0===e.options.draggable||e.options.draggable;const i=await t.getMap();if(!e.wrap.popup){var o=new ol.Overlay({element:e.popupDiv,positioning:Qm});i.addOverlay(o),e.wrap.popup=o;const a=i.getViewport();if(n){const t=await r.e(5587).then(r.t.bind(r,5587,23)),n=e.popupDiv.parentElement;e.popupDiv.classList.add(al.A.classes.DRAGGABLE),n.addEventListener("touchmove",(function(e){var t=e.target;do{if(t.matches&&t.matches(".tc-ctl-finfo-layer-content")){e.stopPropagation();break}t=t.parentElement}while(t)}),{passive:!0});const a=t.default,s=new a(n,{not:"th,td, td *,input,sitna-button,select,.tc-ctl-finfo-coords,sitna-measurement, h3, h4"});s.handleEvent=function(e){const t=this.options.not;if(t){let r=e.target,n=!1;for(;r&&!n;)n=r.matches&&r.matches(t),r=r.parentElement;if(n)return}a.prototype.handleEvent.call(this,e)},s.on("pointerDown",(function(e,t){var r=e.target.getBoundingClientRect();if(r.left+e.target.clientWidth<t.pageX||r.top+e.target.clientHeight<t.pageY)return s._pointerCancel(e,t),!1})),s.on("dragStart",(function(t,r){if(e.setDragging(!0),e._currentOffset=o.getOffset(),e._previousContainerPosition){var n=i.getSize();o.setPosition(i.getCoordinateFromPixel([e._previousContainerPosition[0],n[1]-e._previousContainerPosition[1]])),e._currentOffset=[0,0],o.setOffset(e._currentOffset),delete e._previousContainerPosition}else e._currentOffset=o.getOffset()})),s.on("dragEnd",(function(t){e.setDragging(!1);var r=i.getCoordinateFromPixel([0,0]),a=i.getCoordinateFromPixel(o.getOffset()),s=[a[0]-r[0],a[1]-r[1]],l=o.getPosition();o.setPosition([l[0]+s[0],l[1]+s[1]]),o.setOffset([0,0]),e._currentOffset=[0,0];const c=n.getBoundingClientRect();e._previousContainerPosition=[c.left,c.bottom]}))}const s=function(e){const r=i.getViewport();var n=!1;if(!t.parent.activeControl||!t.parent.activeControl.isExclusive()){var o=i.getEventPixel(e);n=i.forEachFeatureAtPixel(o,(function(e,t){var r=!0;return e._wrap&&!e._wrap.parent.showsPopup&&(r=!1),r}),{hitTolerance:uy})}r.style.cursor=n?"pointer":""};a.removeEventListener(Bm,s),a.addEventListener(Bm,s)}},bm.A.wrap.Map.prototype.hidePopup=function(e){this.parent.currentFeature=null,e.popupDiv&&e.popupDiv.classList.remove(al.A.classes.VISIBLE)},bm.A.wrap.Map.prototype.manageSize=function(){const e=this;e.pixelRatio_=window.devicePixelRatio;const t=function(){e.updateSize()};Eh.A.detectMobile()||(t(),window.addEventListener("resize",t))};var Cy=function(e,t){switch(e){case al.A.layerType.KML:case al.A.mimeType.KML:case al.A.format.KMZ:return new ol.format.KML({showPointNames:!1,extractStyles:void 0===t||t});case al.A.layerType.GPX:case al.A.mimeType.GPX:return new ol.format.GPX;case al.A.layerType.GEOJSON:case al.A.mimeType.GEOJSON:case al.A.mimeType.JSON:case al.A.format.JSON:return new ol.format.GeoJSON;case al.A.format.GML2:return new ol.format.GML2;case al.A.format.GML3:return new ol.format.GML3;case al.A.format.GML32:case al.A.mimeType.GML:case al.A.format.GML:return new ol.format.GML32({featureNS:"http://www.opengis.net/gml/3.2",featureType:"feature"});case al.A.format.TOPOJSON:return new ol.format.TopoJSON;case al.A.format.WKT:return new ol.format.WKT;case al.A.format.WKB:return new ol.format.WKB;case al.A.format.GEOPACKAGE:return new ol.format.GeoPackage;case al.A.format.SHAPEFILE:return new ol.format.Shapefile;default:return null}};bm.A.wrap.Map.prototype.exportFeatures=async function(e,t={}){const r=this,n=Uy({styles:r.parent.options.styles}),i=new WeakMap,o=e.map((e=>e.wrap.feature));for(const e of o){const t=e.getStyle();i.set(e,t),e._originalStyle&&e.setStyle(e._originalStyle),t||e.setStyle(n)}let a;const s=e[0];e.length&&s.layer&&e.every((e=>e.layer===s.layer))&&(a=await s.layer.getFeatureTypeMetadata());const l=Cy(t.format);l.featureTypeMetadata=a,l.srsName=Eh.A.toURNCRS(r.parent.getCRS());const c=await l.writeFeatures(o,{featureProjection:r.parent.getCRS(),featureTypeMetadata:a,adaptNames:t.adaptNames,acceptTimeLoss:t.acceptTimeLoss});for(const e of o){const t=i.get(e);e.setStyle(t)}return c};var by=function(e){for(var t=0,r=e.dataTransfer.types.length;t<r;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1},Ty=function(e){by(e)&&(this.getMap()._wrap.parent.div.classList.add(al.A.classes.DROP),e.preventDefault(),e.stopPropagation())},xy=function(e){if(by(e)){var t=this.getMap()._wrap.parent;e.target===this.target&&t.div.classList.remove(al.A.classes.DROP)}};bm.A.wrap.Map.prototype.enableDragAndDrop=function(e={}){var t=this,r={formatConstructors:[ol.format.KML,ol.format.GPX,new ol.format.GML32({featureNS:"http://www.opengis.net/gml/3.2",featureType:"feature"}),ol.format.GML2,ol.format.GML3CRS84,ol.format.GML2CRS84,ol.format.GML3,ol.format.GeoJSON,new ol.format.WKT({splitCollection:!0}),new ol.format.WKB({splitCollection:!0}),ol.format.TopoJSON,ol.format.GeoPackage,ol.format.Shapefile]};e.dropTarget?r.target=Eh.A.getDiv(e.dropTarget):r.target=t.parent.div;var n=new ol.interaction.DragAndDrop(r);if(n.on("addfeatures",(function(e){const r=e.features?e.features.map((function(e){return e.getId()||e.setId(bm.A.getUID()),bm.A.wrap.Feature.createFeature(e)})):[],i=r.filter((e=>e.geometry));if(i.length){const o={features:i,file:e.file,fileHandle:e.file._fileHandle,fileName:e.file.name,dropTarget:e.target.target,timeStamp:e.file.lastModified,groupIndex:e._groupIndex,groupCount:e._groupCount,groupName:e._groupName,metadata:e._metadata};if("shp"===e.file.name.substring(e.file.name.lastIndexOf(".")+1).toLowerCase()){const t=e.file.name.substring(0,e.file.name.lastIndexOf(".")).toLowerCase();o.additionalFileHandles=[".dbf",".prj",".cst",".cpg",".shx"].map((r=>e.file._fileHandle?._siblings?.find((e=>e.name.toLowerCase()===t+r)))).filter((e=>!!e)).filter((e=>e!==o.fileHandle))}if(e.file._fileSystemFile&&(o.fileSystemFile=e.file._fileSystemFile,delete e.file._fileSystemFile),n._fileLayers?.length){const r=n._fileLayers.filter((t=>{const r=(!o.fileSystemFile&&t.file===e.file.name||t._fileHandle.name===o.fileSystemFile.name)&&(t.options.groupIndex===e._groupIndex||0===e._groupIndex&&!t.options.groupIndex);return r&&(t.file=e.file.name),r}));r.length?o.targetLayers=r:t.parent.getLoadingIndicator()?.removeWait(t.parent._featureImportWaitId)}let a;if(o.fileHandle){let e={mainHandle:o.fileHandle};o.additionalFileHandles&&(e.additionalHandles=o.additionalFileHandles),a=t.parent.addRecentFileEntry(e)}else a=Promise.resolve();a.then((()=>{o.targetLayers&&(n._fileLayers=n._fileLayers.filter((e=>!o.targetLayers.includes(e)))),t.parent.trigger(al.A.event.FEATURESIMPORT,o),r.some((e=>!e.geometry))&&t.parent.trigger(al.A.event.FEATURESIMPORTWARN,{file:e.file}),t.parent.getLoadingIndicator()?.removeWait(t.parent._featureImportWaitId)}))}else{let r=e.file;t.parent.getLoadingIndicator()?.removeWait(t.parent._featureImportWaitId),t.parent.trigger(al.A.event.FEATURESIMPORTERROR,{file:r})}})),n.on("error",(function(e){t.parent.getLoadingIndicator()?.removeWait(t.parent._featureImportWaitId),t.parent.trigger(al.A.event.FEATURESIMPORTERROR,{file:e.file})})),e.once)n.map_=t.map;else{t.map.addInteraction(n);var i=n.target?n.target:t.map.getViewport(),o=function(r){if(by(r)){const o=t.parent;if(n.target===r.target){if(!a(r.dataTransfer.items)){var i=o.getLoadingIndicator();i&&(o._featureImportWaitId=i.addWait(o._featureImportWaitId))}e(r.dataTransfer.items),r.stopPropagation()}else r.preventDefault();o.div.classList.remove(al.A.classes.DROP)}},a=function(e){for(var t=0,r=e.length;t<r;++t)if("file"===e[t].kind)return!(e[t].getAsFile()||e[t].webkitGetAsEntry()&&e[t].webkitGetAsEntry().isFile)&&a(e[t].webkitGetAsEntry());return!0};const e=function(e){const r=function(){const e=t.parent,r=e.getLoadingIndicator();r&&r.removeWait(t.parent._featureImportWaitId),e.toast(Eh.A.getLocaleString(e.options.locale,"fileImport.invalidObjects"),{type:al.A.msgType.WARNING})};DataTransferItem.prototype.getAsFileSystemHandle?Promise.all(Array.from(e).map((e=>e.getAsFileSystemHandle()))).then((function(e){e.every((e=>void 0===e))&&r()})):e.length||r()};n.dropListenKeys_.push(ol.events.listen(i,qm,Ty,n)),n.dropListenKeys_.push(ol.events.listen(document.body,qm,Ty,n)),n.dropListenKeys_.push(ol.events.listen(i,Wm,Ty,n)),n.dropListenKeys_.push(ol.events.listen(document.body,Wm,Ty,n)),n.dropListenKeys_.push(ol.events.listen(i,Hm,o,n)),n.dropListenKeys_.push(ol.events.listen(document.body,Hm,o,n)),n.dropListenKeys_.push(ol.events.listen(document.body,"dragleave",xy,n)),n.dropListenKeys_.push(ol.events.listen(document.body,"dragend",xy,n)),n.dropListenKeys_.push(ol.events.listen(document.body,"dragexit",xy,n)),document.addEventListener("mouseenter",(function(e){e.buttons||t.parent.div.classList.remove(al.A.classes.DROP)}),!1),t.ddEnabled=!0}return n},bm.A.wrap.Map.prototype.loadFiles=async function(e,t){const r=this;let n;if(e.length){if(r.ddEnabled?r.map.getInteractions().forEach((function(e){e instanceof ol.interaction.DragAndDrop&&(n=e)})):n=r.enableDragAndDrop({once:!0}),n&&t){var i=n.target;if(n.target=t.control,r.parent.one(al.A.event.FEATURESIMPORT,(function(e){n.target=i})),t.layers){const e=n._fileLayers||[];n._fileLayers=e.concat(t.layers.filter((t=>!e.includes(t))))}}var o=r.parent.getLoadingIndicator();o&&(r.parent._featureImportWaitId=o.addWait(r.parent._featureImportWaitId));for(var a=0,s=e.length;a<s;++a){const t=e[a];n.processFile(t)}}},bm.A.wrap.Map.prototype.linkTo=function(e){const t=this,r=function(){const r=t.map.getView(),n=e.wrap.map.getView();setTimeout((function(){r!==n&&t.map.setView(n)}),100)};e.wrap.map.on("change:view",r),t.map.on("change:view",r),r()},bm.A.wrap.Layer.prototype.getVisibility=function(){var e=!1;return this.layer&&(e=this.layer.getVisible()),e},bm.A.wrap.Layer.prototype.setVisibility=function(e){this.getLayer().then((function(t){t.setVisible(e)}))},bm.A.wrap.Layer.prototype.setOpacity=async function(e){(await this.getLayer()).setOpacity(e)},bm.A.wrap.Layer.prototype.isNative=function(e){return e instanceof ol.layer.Layer},bm.A.wrap.Layer.prototype.setProjection=function(e={}){const t=this,r=t.parent;if(r.map){const o=_y.call(t,{crs:e.crs,extentInDegrees:ol.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326")});var n=r.getResolutions();if(n&&n.length)n=n.map((function(e){return e/o})),r.wrap.layer.setMaxResolution(n[0]),r.wrap.layer.setMinResolution(n[n.length-1]);else if(!e.oldCrs||ol.proj.get(e.oldCrs).getUnits()!==al.A.units.METERS||ol.proj.get(e.crs).getUnits()&&ol.proj.get(e.crs).getUnits()!==al.A.units.DEGREES){if(e.oldCrs&&ol.proj.get(e.oldCrs).getUnits()===al.A.units.DEGREES&&ol.proj.get(e.crs).getUnits()===al.A.units.METERS){var i=Eh.A.getMetersPerDegree(ol.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326"));r.minResolution&&(r.minResolution=r.minResolution*i,t.layer.setMinResolution(r.minResolution)),r.maxResolution&&(r.maxResolution=r.maxResolution*i,t.layer.setMaxResolution(r.maxResolution))}}else r.minResolution&&(r.minResolution=r.minResolution/o,t.layer.setMinResolution(r.minResolution)),r.maxResolution&&(r.maxResolution=r.maxResolution/o,t.layer.setMaxResolution(r.maxResolution))}};const Py=function(e){const t=new Path2D,r=e[0];t.moveTo(r[0],r[1]);for(var n=1,i=e.length;n<i;n++){const r=e[n];t.lineTo(r[0],r[1])}return t.closePath(),t},My=function(e){const t=new Path2D;return t.addPath(e,new DOMMatrix("scale("+window.devicePixelRatio+")")),t},Iy=function(e,t,r,n){const i=this,o=`_${t}PrerenderHandler`,a=`_${t}PostrenderHandler`;i[o]&&(i.layer.un(ol.render.EventType.PRERENDER,i[o]),delete i[o],i.layer.un(ol.render.EventType.POSTRENDER,i[a]),delete i[a]),e&&(i[o]=r,i.layer.on(ol.render.EventType.PRERENDER,i[o]),i[a]=n,i.layer.on(ol.render.EventType.POSTRENDER,i[a])),i.parent.map.wrap.map.render()};bm.A.wrap.Layer.prototype.clip=function(e){const t=this;Iy.call(t,e,"clip",(function(r){let n=e;Eh.A.isFunction(e)&&(n=e.call(t._wrap)),n instanceof Path2D||(n=Py(n)),n=My(n);const i=r.context;i.save(),i.clip(n,"evenodd")}),(function(e){e.context.restore()}))},bm.A.wrap.Layer.prototype.stroke=function(e,t){const r=this;Iy.call(r,e,"stroke",(function(e){}),(function(n){let i=e;Eh.A.isFunction(e)&&(i=e.call(r._wrap)),i instanceof Path2D||(i=Py(i)),i=My(i);const o=n.context;t.strokeWidth&&(o.lineWidth=t.strokeWidth),t.strokeColor&&(o.strokeStyle=t.strokeColor),o.stroke(i)}))},bm.A.wrap.layer.Raster.prototype.WmsParser=ol.format.WMSCapabilities,bm.A.wrap.layer.Raster.prototype.WmtsParser=ol.format.WMTSCapabilities,bm.A.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.on("change:visible",(function(){t.parent.map&&t.parent.map.trigger(al.A.event.LAYERVISIBILITY,{layer:t.parent})}),t.parent.map)},bm.A.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null,t=this;switch(t.getServiceType()){case al.A.layerType.WMS:for(var r=t.parent.capabilities.Capability.Request.GetMap.DCPType,n=0;n<r.length;n++)if(r[n].HTTP&&r[n].HTTP.Get){e=r[n].HTTP.Get.OnlineResource;break}break;case al.A.layerType.WMTS:e=t.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}const i=document.createDocumentFragment(),o=document.createElement("textarea");return i.appendChild(o),o.innerHTML=e,o.textContent},bm.A.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Capability.Request.GetFeatureInfo&&(e=t.Capability.Request.GetFeatureInfo.Format),e},bm.A.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"],bm.A.wrap.layer.Raster.prototype.getWMTSLayer=function(e={}){var t=null,r=this,n=r.parent.capabilities;let i;if(e.crs&&(i=n.Contents.TileMatrixSet.filter((t=>Eh.A.CRSCodesEqual(e.crs,t.SupportedCRS)))),n&&n.Contents)for(var o=0;o<n.Contents.Layer.length;o++){var a=n.Contents.Layer[o];if(r.parent.options.layerNames===a.Identifier)for(var s=0;s<a.TileMatrixSetLink.length;s++)if(e.crs){if(i.filter((e=>e.Identifier===a.TileMatrixSetLink[s].TileMatrixSet)).length>0){t=a;break}}else if((e.matrixSetId||r.parent.options.matrixSet)===a.TileMatrixSetLink[s].TileMatrixSet){t=a;break}}return t},bm.A.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,r=this.parent.capabilities;if(r&&r.Contents&&r.Contents.TileMatrixSet)for(var n=0;n<r.Contents.TileMatrixSet.length;n++){var i=r.Contents.TileMatrixSet[n];if(i.Identifier===e){t=i.TileMatrix;break}}return t},bm.A.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[],r=this;if(e.ScaleDenominator?t=[e.ScaleDenominator,e.ScaleDenominator]:(e.MinScaleDenominator||e.MaxScaleDenominator)&&(t=[e.MaxScaleDenominator,e.MinScaleDenominator]),!t.length&&!r.getName(e)){for(var n=r.getLayerNodes(e),i=-1/0,o=1/0,a=0,s=n.length;a<s;a++){var l=r.getScaleDenominators(n[a]);l[0]>i&&(i=l[0]),l[1]<o&&(o=l[1])}i>-1/0&&o<1/0&&(t=[i,o])}return t},bm.A.wrap.layer.Raster.prototype.getAttribution=function(){const e={},t=bm.A.capabilities[this.parent.url];return t&&(t.ServiceProvider?(e.name=t.ServiceProvider.ProviderName.trim(),e.site=t.ServiceProvider.ProviderSite,e.site&&e.site.href&&e.site.href.trim().length>0?e.site=e.site.href:delete e.site):t.ServiceIdentification?e.name=t.ServiceIdentification.Title.trim():e.name=t.Service.Title.trim()),e},bm.A.wrap.layer.Raster.prototype.getInfo=function(e){var t,r=this,n={},i=r.parent.capabilities;if(i)if(i.Capability){var o=r.getAllLayerNodes();for(t=0;t<o.length;t++){var a=o[t];if(r.parent.compareNames(r.getName(a),e)){a.Title&&(n.title=a.Title),a.Abstract&&(n.abstract=a.Abstract),n.legend=[];var s=function(e,t){if(e.Layer&&e.Layer.length>0)for(var n in e.Layer)s(e.Layer[n],t);else t.apply(r,[e])};if(s(a,(function(e){this.getLegend(e).filter((e=>e.src)).forEach((t=>{n.legend.push({src:t.src,title:e.Title})}))})),a.MetadataURL&&a.MetadataURL.length){n.metadata=[];for(var l=0;l<a.MetadataURL.length;l++){var c=a.MetadataURL[l];n.metadata.push({format:c.Format,type:c.type,url:c.OnlineResource})}}n.queryable=a.queryable;break}}}else if(i.Contents){const e=r.parent.names[0];for(t=0;t<i.Contents.Layer.length;t++){const r=i.Contents.Layer[t];if(r.Identifier===e){n.abstract=r.Abstract;let e=r.Metadata;e&&(Array.isArray(e)||(e=[e]),n.metadata=e.map((e=>({format:e.format,url:e.href}))));break}}}return n},bm.A.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Capability.Request&&t.Capability.Request.GetMap?e=al.A.layerType.WMS:t.OperationsMetadata&&t.OperationsMetadata.GetTile&&(e=al.A.layerType.WMTS),e},bm.A.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;return t.Capability&&t.Service?e=t.Service.Title:t.ServiceIdentification&&(e=t.ServiceIdentification.Title),e},bm.A.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;return this.getServiceType()===al.A.layerType.WMS&&(e=this.parent.capabilities.Capability.Layer),e},bm.A.wrap.layer.Raster.prototype.getName=function(e,t){var r=e.Name;if(r&&t){var n=r.indexOf(":");n>=0&&(r=r.substr(n+1))}return r},bm.A.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.Identifier},bm.A.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.Layer;return Array.isArray(t)||(t=t?[t]:[]),t},bm.A.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this;if(!e._layerList)switch(e.getServiceType()){case al.A.layerType.WMS:var t=e.getRootLayerNode();e._layerList=t?function t(r){for(var n=[r],i=e.getLayerNodes(r),o=0;o<i.length;o++)n=n.concat(t(i[o]));return n}(t):[];break;case al.A.layerType.WMTS:e._layerList=e.parent.capabilities.Contents.Layer.slice();break;default:e._layerList=[]}return e._layerList},bm.A.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){return e},bm.A.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return e};const Ry=document.createDocumentFragment(),Oy=document.createElement("textarea");Ry.appendChild(Oy),bm.A.wrap.layer.Raster.prototype.getLegend=function(e){var t=[],r=e.Style;return r&&r.length&&r.length&&r[0].LegendURL&&r[0].LegendURL.length&&r[0].LegendURL.forEach((function(e){Oy.innerHTML=e.OnlineResource;const r={src:Oy.textContent};t.push(r)})),t},bm.A.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,r=!0,n=t.parent;switch(t.getServiceType()){case al.A.layerType.WMS:if(n.capabilities&&n.capabilities.Capability&&n.capabilities.Capability.Layer&&n.names.length>0)for(var i=n.names.slice(0),o=function(e){return e.parent?e.parent.CRS||e.parent.SRS||o(e.parent):null},a=function r(i,a,s){var l=!1;if(i)for(var c=0;c<i.length;c++){var u=i[c];const d=u.CRS||u.SRS||o(u),p=Array.isArray(d)?d:[d];var h=s||p.indexOf(e)>=0;if(n.compareNames(t.getName(u),a)){h&&(l=!0);break}if(r(u.Layer,a,h)){l=!0;break}}return l};i.length>0;)if(!a([n.capabilities.Capability.Layer],i.pop())){r=!1;break}break;case al.A.layerType.WMTS:if(r=!1,n.capabilities&&n.capabilities.Contents&&n.capabilities.Contents.TileMatrixSet)for(var s=n.capabilities.Contents.TileMatrixSet,l=0;l<s.length;l++)if(s[l].Identifier===n.options.matrixSet){r=Eh.A.CRSCodesEqual(e,s[l].SupportedCRS);break}}return r},bm.A.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var e=[],t=this.parent;switch(this.getServiceType()){case al.A.layerType.WMS:if(t.capabilities&&t.capabilities.Capability&&t.capabilities.Capability.Layer&&t.names.length>0){const r=t.names.map((function(e){return t.getNodePath(e).map((function(e){const t=e.CRS||e.SRS||[],r=Array.isArray(t)?t:[t];return Array.isArray(r)?r:[r]})).reduce((function(e,t){return 0===e.length?t:(t.forEach((function(t){e.indexOf(t)<0&&(e[e.length-1]=t)})),e)}),[])}));if(1===r.length)e=r[0];else{const t=r.slice(1);e=r[0].filter((function(e){return t.every((function(t){return t.indexOf(e)>=0}))}))}}break;case al.A.layerType.WMTS:t.capabilities&&t.capabilities.Contents&&t.capabilities.Contents.Layer.filter((function(e){return e.Identifier===t.layerNames})).forEach((function(r){const n=r.TileMatrixSetLink.map((function(e){return e.TileMatrixSet}));e=t.capabilities.Contents.TileMatrixSet.filter((function(e){return n.indexOf(e.Identifier)>=0})).map((function(e){return e.SupportedCRS}))}))}return e},bm.A.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],r=this.parent;switch(this.getServiceType()){case al.A.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer){var n=function(e,r,i){var o=e.CRS||e.SRS,a=Array.isArray(o)?o:[o],s=i||a.indexOf(r)>=0;if(s&&e.Name&&t.push(e.Name),e.Layer)for(var l=0;l<e.Layer.length;l++)n(e.Layer[l],r,s)};n(r.capabilities.Capability.Layer,e)}break;case al.A.layerType.WMTS:if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var i=r.capabilities.Contents.TileMatrixSet,o=0,a=i.length;o<a;o++){var s=i[o];if(Eh.A.CRSCodesEqual(e,s.SupportedCRS))for(var l=s.Identifier,c=r.capabilities.Contents.Layer,u=0,h=c.length;u<h;u++)for(var d=c[u].TileMatrixSetLink,p=0,g=d.length;p<g;p++)if(d[p].TileMatrixSet===l){t.push(c[u].Identifier);break}}}return t},bm.A.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(e){const t=[];Ly({crs:e});const r=this.parent;if(this.getServiceType()===al.A.layerType.WMTS)for(var n=r.capabilities.Contents.Layer,i=r.capabilities.Contents.TileMatrixSet,o=0,a=n.length;o<a;o++)if(r.layerNames===n[o].Identifier)for(var s=n[o].TileMatrixSetLink,l=0,c=s.length;l<c;l++)for(var u=s[l],h=0,d=i.length;h<d;h++){var p=i[h];if(p.Identifier===u.TileMatrixSet){Eh.A.CRSCodesEqual(e,p.SupportedCRS)&&t.push(p.Identifier);break}}return t},bm.A.wrap.layer.Raster.prototype.setWMTSUrl=function(){var e=this;e.getLayer().then((function(t){e.parent.options=e.parent.options||{};var r=t.getSource().getUrls();e.parent.options.urlPattern=r[r.length-1]}))};const Dy=function(e,t,r){const n=r*(t||1);return e.map(((e,t)=>t<2?e-n:e+n))};bm.A.wrap.layer.Raster.prototype.createWMSLayer=function(e,t,r){const n=this;var i=null,o=new ol.source.ImageWMS({url:e,crossOrigin:r.map?r.map.crossOrigin:void 0,params:t,ratio:bm.A.Cfg.imageRatio,imageLoadFunction:n.parent.getImageLoad.bind(n.parent),serverType:"geoserver"});const a=o.getImageInternal;o.getImageInternal=function(e,t,r,n){return this.loader&&this.loaderProjection_===n||(this.loader=hm({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:async(e,t)=>(this.image.setImage(e),await this.imageLoadFunction_(this.image,t),await Qn(e))})),a.call(this,e,t,r,n)};var s={visible:!!t.LAYERS.length||r&&r.method&&"POST"===r.method,source:o};return r.minResolution&&(s.minResolution=r.minResolution),r.maxResolution&&(s.maxResolution=r.maxResolution),(i=new ol.layer.Image(s))._wrap=n,n.addCommonEvents(i),i};var Ny=function(e){var t=this,r=null,n=ol.source.WMTS.optionsFromCapabilities(t.parent.capabilities,{layer:e.layerNames,matrixSet:e.matrixSet,crossOrigin:e.map?e.map.options.crossOrigin:void 0,requestEncoding:e.encoding,format:e.format});let i;n.wrapX=!0;const o=t.parent.capabilities.Contents.Layer.find((t=>t.Identifier===e.layerNames));if(!o)throw new Error(`Layer '${e.layerNames}' not found`);if(i=o.TileMatrixSetLink.find((t=>t.TileMatrixSet===e.matrixSet)),!i)throw new Error(`Matrix set '${e.matrixSet}' not found`);{const e=i.TileMatrixSetLimits;if(e){const t=n.tileGrid.getResolutions(),r=n.tileGrid.origins_,i=n.tileGrid.tileSizes_;n.tileGrid.fullTileRanges_.forEach((function(o,a){const s=e[a];o.minX=s.MinTileCol,o.minY=s.MinTileRow,o.maxX=s.MaxTileCol,o.maxY=s.MaxTileRow;const l=t[a]+i[a],c=r[a],u=c[0]+l*o.minX,h=c[1]+l*o.minY,d=c[0]+l*(o.maxX+1),p=c[1]+l*(o.maxY+1);ol.extent.extend(n.tileGrid.extent_,[u,h,d,p])}))}}var a="https:";if(n){n.cacheSize=2048,location.protocol===a&&(n.urls=n.urls.map((function(e){return e.replace("http:",a)}))),n.extent=t.parent.getExtent()||n.tileGrid?.getExtent(),n.crossOrigin=e.map?e.map.crossOrigin:void 0,(r=new ol.source.WMTS(n)).setTileLoadFunction(t.parent.getImageLoad.bind(t.parent));var s=r.getResolutions.bind(r);r.getResolutions=function(){var e=s(),r=t.parent.getLimitedMatrixSet();if(r&&r.length){var n=r[0].matrixIndex;void 0!==n&&(e=e.slice(n,r.length+n))}return e}}return r};bm.A.wrap.layer.Raster.prototype.createWMTSLayer=function(e){const t=this;var r=null,n=Ny.call(t,e);if(n){var i={source:n};e.minResolution&&(i.minResolution=e.minResolution),e.maxResolution&&(i.maxResolution=e.maxResolution),(r=new ol.layer.Tile(i))._wrap=t,t.addCommonEvents(r);var o=n.getResolutions();r.setMaxResolution(o[0]+1),r.setMinResolution(o[o.length-1])}return r},bm.A.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()},bm.A.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getSource().updateParams(e)},bm.A.wrap.layer.Raster.prototype.setMatrixSet=function(e){const t=this;if(t.parent.type===al.A.layerType.WMTS){const r=Ny.call(t,Eh.A.extend({},t.parent.options,{matrixSet:e})),n=r.getResolutions(),i=n[0]+n[0]/1e3,o=n[n.length-1];t.layer.setMaxResolution(i),t.layer.setMinResolution(o),t.parent.minResolution&&(t.parent.minResolution=o),t.parent.maxResolution&&(t.parent.maxResolution=i),t.layer.setSource(r)}},bm.A.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var e=this.layer.getSource();return e.getResolutions?e.getResolutions():[]}return[]},bm.A.wrap.layer.Raster.prototype.setResolutions=function(e){if(this.layer.getSource){var t=this.layer.getSource();t.resolutions_?t.resolutions_=e:t.tileGrid&&(t.tileGrid.resolutions_=e)}},bm.A.wrap.layer.Raster.prototype.reloadSource=function(){const e=this;return new Promise((function(t,r){e.layer.getSource?(e.layer.getSource().refresh(),t()):r()}))},bm.A.wrap.Geometry={getNearest:function(e,t){let r;return r=Oh.A.isRingCollection(t)?new ol.geom.MultiLineString(t):new ol.geom.LineString(t),r.getClosestPoint(e)}};var ky=function(e,t,r){if(e&&e instanceof ol.style.Icon){var n=function(n){var i=(r&&r._wrap?r._wrap.parent.options.width:null)||t;if(i<n){var o=i/n;e.setScale(o)}},i=e.getSize();if(i)n(i[0]);else{var o=e.getImage();if(!o.naturalWidth){const t=document.createDocumentFragment(),r=document.createElement("img");return r.src=e.getSrc(),t.appendChild(r),new Promise((function(e){r.addEventListener("load",(function(){n(this.naturalWidth),e(this)}))}))}n(o.naturalWidth)}}},Fy=function(e,t){var r=e,n=t&&t.wrap&&t.wrap.feature;if("string"==typeof e){var i=e.match(/^\$\{(.+)\}$/);if(i&&(r="",n)){for(var o=i[1].split("."),a=n.getProperties(),s=0;s<o.length&&void 0!==a;s++)a=a[o[s]];r=a??""}}else Eh.A.isFunction(e)&&(r=e(t));return r};const Gy=function(e){const t=Eh.A.extend(!0,{},bm.A.Cfg.styles);return e&&e.map&&Eh.A.extend(!0,t,e.map.options.styles),t},By=function(e){if(e)for(var t in e)if("point"==t||"line"==t||"polygon"==t||"marker"==t||"cluster"==t||Eh.A.isStyleOption(t)){const r=e[t];if("string"==typeof r){if(/^\$\{(.+)\}$/.test(r))return!0}else if("object"==typeof r&&By(r))return!0}return!1},Uy=function(e,t){if(Eh.A.isFunction(e))return function(t){return Uy(e(t._wrap.parent))};const r=function(t){const r=[];var n,i,o,a;if(t){const e=t.getGeometry();switch(e&&e.getType()){case"Point":case"MultiPoint":i=!0;break;case"LineString":case"MultiLineString":o=!0;break;case"Polygon":case"MultiPolygon":a=!0}n=t._wrap?t._wrap.parent:{id:bm.A.wrap.Feature.prototype.getId.call({feature:t}),features:t.get("features"),getData:function(){return bm.A.wrap.Feature.prototype.getData.call({feature:t})}}}let s=e.styles||{},l=n&&Array.isArray(n.features)&&n.features.length>1;const c=Gy(e.layer);l&&(s=bm.A.Util.extend(!0,{},c.cluster,e&&e.styles&&e.styles.cluster?e.styles.cluster:{}));let u={};return!s.line||!o&&t||(u=s.line,(u instanceof Array?u:[u]).forEach((function(e,t){r[t]=Object.assign(r[t]||{},{stroke:new ol.style.Stroke({color:Fy(e.strokeColor,n),width:Fy(e.strokeWidth,n),lineDash:e.lineDash})})}))),!s.polygon||!a&&t||(u=s.polygon,(u instanceof Array?u:[u]).forEach((function(e,t){const i={stroke:new ol.style.Stroke({color:Fy(e.strokeColor,n),width:Fy(e.strokeWidth,n),lineDash:e.lineDash})};e.fillColor&&(i.fill=new ol.style.Fill({color:Sy(Fy(e.fillColor,n),Fy(e.fillOpacity,n))})),r[t]=Object.assign(r[t]||{},i)}))),!s.point||!i&&t||(u=s.point,(u instanceof Array?u:[u]).forEach((function(e,t){var i={radius:Fy(e.radius,n)||(Fy(e.height,n)+Fy(e.width,n))/4};e.fillColor&&(i.fill=new ol.style.Fill({color:Sy(Fy(e.fillColor,n),Fy(e.fillOpacity,n))})),e.strokeColor&&(i.stroke=new ol.style.Stroke({color:Fy(e.strokeColor,n),width:Fy(e.strokeWidth,n),lineDash:e.lineDash})),Number.isNaN(i.radius)&&(i.radius=bm.A.Cfg.styles?.point?.radius),Number.isNaN(i.radius)||(r[t]=Object.assign(r[t]||{},{image:new ol.style.Circle(i)}))}))),(u.label||u.labelKey)&&(r[r.length]={text:qy(u,n)}),!s.marker||!i&&t||(u=s.marker,(u instanceof Array?u:[u]).forEach((function(e,t){const i=Eh.A.getFeatureStyleFromCss(e.cssClass),o=e.url||i?.url;var a="fraction";if(o){let l;i?.width?l=[i.width,i.height]:e.width&&e.height&&(l=[Fy(e.width,n),Fy(e.height,n)]),r[t]=Object.assign(r[t]||{},{image:new ol.style.Icon({crossOrigin:"anonymous",anchor:e.anchor||s.marker.anchor||[.5,1],anchorXUnits:e.anchorXUnits||a,anchorYUnits:e.anchorYUnits||a,src:o,width:l?.[0],height:l?.[1],rotation:e.rotation?e.rotation/180*Math.PI:void 0}),text:qy(e,n)})}}))),r.map((e=>{var t=new ol.style.Style(e);return u.balloon&&(t._balloon=new ol.style.Text({text:u.balloon})),t}))};return By(e.styles)?r:r(t)},qy=function(e,t){if(!e?.label&&!e?.labelKey)return;const r={text:""+Fy(e.labelKey||e.label,t),overflow:!0};if(e.fontSize?r.font=Fy(e.fontSize,t)+"pt sans-serif":e.font&&(r.font=e.font),e.labelRotationKey&&(r.rotation=-Math.PI*Fy(e.labelRotationKey,t)/180),e.fontColor){const n=Fy(e.fontColor,t);r.fill=new ol.style.Fill({color:Sy(n,(Array.isArray(n)?n[3]:1)||1)})}if(e.labelOutlineColor){const n=Fy(e.labelOutlineColor,t);r.stroke=new ol.style.Stroke({color:Sy(n,(Array.isArray(n)?n[3]:1)||1),width:Fy(e.labelOutlineWidth,t)})}return e.labelOffset&&(r.offsetX=e.labelOffset[0],r.offsetY=e.labelOffset[1]),e.textScale&&(r.scale=e.textScale),e.textAlign&&(r.textAlign=e.textAlign),new ol.style.Text(r)};var Wy=function(e){var t=e.toString(16);return 1===t.length&&(t="0"+t),t},Hy=function(e){return"#"+Wy(e[0])+Wy(e[1])+Wy(e[2])},jy=function(e,t){var r={};if(Eh.A.isFunction(e)&&t&&(e=e(t)),Array.isArray(e)&&(e=e[0]),!Eh.A.isFunction(e)){var n,i,o;if(t){const r=t.getGeometry();if(r){const t=r.getType();t!==iy&&t!==oy&&e.setImage(null)}}var a=e.getImage();if(a)if(a instanceof ol.style.RegularShape)(n=(i=a.getStroke()).getColor())&&(n=ol.color.asArray(n),r.strokeColor=Hy(n)),r.strokeWidth=i.getWidth(),(o=a.getFill())&&((n=o.getColor())&&(n=ol.color.asArray(n),r.fillColor=Hy(n)),r.fillOpacity=n[3]);else{r.url=a.getSrc();let e=a.getSize(),t=a.getScale();!e&&t&&(e=[32,32]),e&&(t??=[1,1],Array.isArray(t)||(t=[t,t]),r.width=e[0]*t[0],r.height=e[1]*t[1],r.anchor=a.getAnchor(),r.anchor&&(r.anchor[0]=r.anchor[0]/r.width,r.anchor[1]=r.anchor[1]/r.height))}else(i=e.getStroke())&&((n=i.getColor())&&(n=ol.color.asArray(n),r.strokeColor=Hy(n)),r.strokeWidth=i.getWidth(),r.lineDash=i.getLineDash()),(o=e.getFill())&&((n=o.getColor())&&(n=ol.color.asArray(n),r.fillColor=Hy(n)),r.fillOpacity=n[3])}return r};bm.A.wrap.layer.Vector.prototype.getStyle=function(){return jy(this.layer.getStyle())},bm.A.wrap.layer.Vector.prototype.reloadSource=function(){const e=this;return new Promise((function(t,r){const n=e.createVectorSource(e.parent,e.createStyles(e.parent));if(e.parent.type===al.A.layerType.WFS)var i=n.source.on("change",(function(e){"ready"===n.source.getState()&&(ol.Observable.unByKey(i),t())}));var o=e.layer.getSource().getFeatures();e.layer.setSource(n.source),n.style&&e.layer.setStyle(n.style),e.parent.type!==al.A.layerType.WFS&&(n.source.addFeatures(o),t())}))},bm.A.wrap.layer.Vector.prototype.import=function(e){var t=this,r=Eh.A.extend({},e);r.type=e.format;var n=t.layer.getSource().getFeatures(),i=t.createVectorSource(r,t.createStyles(t.parent));t.layer.setSource(i.source),i.style&&t.layer.setStyle(i.style),i.source.addFeatures(n)},bm.A.wrap.layer.Vector.prototype.createVectorSource=function(e,t){const r=this;var n,i,o=!1;const a=e.styles&&e.styles.heatmap;if(Array.isArray(e.url)||e.urls){var s=e.urls||e.url;s=s.map((function(e,t){return bm.A.proxify(e)})),i={url:s,format:new ol.format.KML({showPointNames:!1,extractStyles:!a}),projection:e.crs}}else if(e.url&&e.type!==al.A.layerType.WFS)(i={url:e.url,projection:e.crs}).format=Cy(e.format,!a)||Cy(Eh.A.getMimeTypeFromUrl(e.url),!a)||Cy(e.type,!a),i.loader=i.format instanceof ol.format.KML?function(e,t,n){const o=i.url,a=i.format;r.parent.state=Rm.A.state.LOADING,r.parent.map&&r.parent.map.trigger(al.A.event.BEFORELAYERUPDATE,{layer:r.parent}),r.parent.proxificationTool.fetch(o,{method:"GET",nomanage:!0}).then((async function(e){if(e.ok){const o=await e.text();var t=await a.readFeatures(o,{featureProjection:n});const s=(new DOMParser).parseFromString(o,"text/xml").querySelector("Document > name");if(r.addFeatures(t),r.parent.state=Rm.A.state.IDLE,e.headers.has("content-disposition")&&/(attachment);([^;]*)/gi.test(e.headers.get("content-disposition"))){const t=e.headers.get("content-disposition");var i;try{i=/filename\*?=\"?([\w|-]*\'\')?(.*\.\w*)\"?/gi.exec(t)[2]}catch(e){try{i=t.substring((t.lastIndexOf("'")||t.indexOf("="))+1)}catch(e){}}r.parent.title=(s?s.textContent:"")+(i?s&&s.textContent!=i?" ("+i+")":i:"")}else r.parent.title=(s?s.textContent:"")+(s&&s.textContent!=r.parent.title?" ("+r.parent.title+")":r.parent.title);r.parent.map&&r.parent.map.trigger(al.A.event.LAYERUPDATE,{layer:r.parent})}})).catch((function(e){r.parent.state=Rm.A.state.IDLE,r.parent.map&&r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:e})}))}:(u=i.url,h=i.format,d=ol.featureloader.xhr(u,h),function(e,t,n){r.parent.state=Rm.A.state.LOADING,r.parent.map&&r.parent.map.trigger(al.A.event.BEFORELAYERUPDATE,{layer:r.parent}),d.call(this,e,t,n)}),o=!0;else if(e.data)i={projection:e.crs,loader:function(t,n,i){r.parent.state=Rm.A.state.LOADING,r.parent.map&&r.parent.map.trigger(al.A.event.BEFORELAYERUPDATE,{layer:r.parent});var o=this.getFormat();try{var a=o.readFeatures(e.data,{featureProjection:i});this.addFeatures(a),r.parent.state=Rm.A.state.IDLE,r.parent.map&&r.parent.map.trigger(al.A.event.LAYERUPDATE,{layer:r.parent,newData:e.data})}catch(e){r.parent.state=Rm.A.state.IDLE,r.parent.map&&r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:e.message})}}},i.format=Cy(e.format)||Cy(e.type);else if(e.type===al.A.layerType.WFS){var l,c;switch(e.outputFormat){case al.A.format.JSON:l=new ol.format.GeoJSON({geometryName:e.geometryName}),c="json";break;case al.A.format.GML3:l=new ol.format.WFS({gmlFormat:new ol.format.GML3}),c=al.A.mimeType.GML;break;case al.A.format.GML32:l=new ol.format.WFS({gmlFormat:new ol.format.GML32}),c=al.A.mimeType.GML;break;default:l=new ol.format.WFS({gmlFormat:new ol.format.GML2}),c=al.A.mimeType.GML,e.outputFormat=al.A.format.GML2}i={format:l,loader:function(t,n,i){var o=this,a=e.url;if(a){r.parent.state=Rm.A.state.LOADING,r.parent.map.trigger(al.A.event.BEFORELAYERUPDATE,{layer:r.parent});const t=function(){return"string"==typeof e.properties},n=e=>{const t=e.data;let n;try{n=l.readFeatures(t)}catch(e){r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:e.message})}const i=function(){r.parent.map.trigger(al.A.event.LAYERUPDATE,{layer:r.parent,newData:t})},a=function(e){e.layer===r.parent&&(r.parent.map.off(al.A.event.FEATURESADD,a),i())};n&&n.length?(r.parent.map.on(al.A.event.FEATURESADD,a),o.addFeatures(n)):i(),r.parent.state=Rm.A.state.IDLE},s=e=>{e instanceof XMLDocument?r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:e.querySelector("ExceptionText").innerHTML}):r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:e})},u=e=>{let t;if(e.data)if("string"==typeof e.data)t=e.data;else if("object"==typeof e.data)if(e.contentType||"boolean"==typeof e.contentType)t=bm.A.Util.getParamString(e.data);else{const n=[];for(var r in e.data)n.push(r+"="+e.data[r].toString());t=n.join("&")}var n=e.url;return t&&(n=n+"?"+t),!1===e.cache&&(n+=(n.indexOf("?")<0?"?":"&")+"ts="+Date.now()),n.length},h=(t,n)=>{let o={},s=i.getCode(),l=e.version||n.version||"1.1.0";n.version=l;let h=a,d=Array.isArray(e.featureType)?e.featureType:[e.featureType];const p=e=>{const r={method:"POST"};return r.url=h,e.filter instanceof bm.A.filter.Filter?r.data=Eh.A.WFSQueryBuilder(d,e.filter,n,t?null:e.outputFormat,t,s,e.maxFeatures):e.filter instanceof Dm.B&&(o.data=e.filter.getGeatureText({outputFormat:e.outputFormat,srsName:s,version:l,propertyNames:e.properties?[...e.properties]:null,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:d,resultType:t?"hits":""})),r},g=Object.keys(n.Operations.GetFeature.DCP.HTTP).map((e=>e.toUpperCase()));return g.includes("GET")||!g.length?(o=(e=>{const n={method:"GET"};n.url=h,n.data={service:"WFS",request:"GetFeature",outputFormat:e.outputFormat,version:l,srsname:s},e.properties&&(n.data.propertyName=e.properties),e.filter&&(e.filter instanceof bm.A.filter.Filter?e.filter instanceof bm.A.filter.Bbox?n.data=Object.assign(n.data,{BBOX:Eh.A.formatTemplate("{0},{1},{2},{3},{4}",e.filter.extent.concat([s]))}):n.data=Object.assign(n.data,{filter:e.filter.getText(l).replace(/\<(fes\:|ogc\:)/g,"<").replace(/\<\/(fes\:|ogc\:)/g,"</")}):e.filter instanceof Dm.B?n.data.filter=e.filter.getFilterText({outputFormat:e.outputFormat,srsName:s,version:l,propertyNames:e.properties?[...e.properties]:null,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:d,resultType:t?"hits":""}):(new DOMParser).parseFromString(e.filter,"text/xml").querySelector("parsererror")?n.data.cql_filter=e.filter:n.data.filter=e.filter);let i=e.featurePrefix??e.featureNS??"";return i.length&&(i+=":"),n.data["typename"+("2.0.0"===l?"s":"")]=i+e.featureType,t&&(n.data=Object.assign(n.data,{resultType:"hits"})),!t&&e.filter&&r.parent.map.trigger(al.A.event.BEFOREAPPLYQUERY,{layer:r.parent,query:n.data}),e.maxFeatures&&(n.data=Object.assign(n.data,{maxFeatures:e.maxFeatures})),n})(e),g.includes("POST")&&u(o)>al.A.URL_MAX_LENGTH&&(o=p(e))):o=p(e),o.responseType="json"===(t?"":c)?al.A.mimeType.JSON:al.A.mimeType.XML,o.contentType=al.A.mimeType.XML,bm.A.ajax(o)};r.parent.getCapabilitiesPromise().then((i=>{const o=i;let a=o.Operations?.GetFeature?.CountDefault?.DefaultValue;if(a){e.maxFeatures||(e.maxFeatures=a);let i=t();h(!i,o).then((e=>{if(i)n(e);else{var t=e.data.children[0];if(t.tagName.toLowerCase().indexOf("exception")>=0)r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:t.querySelector("ExceptionText").innerHTML});else if(t.tagName.toLowerCase().indexOf("featurecollection")>=0){let e=parseInt((t.attributes.numberMatched||t.attributes.numberOfFeatures).value,10);if(Number.isNaN(e)||e>=parseInt(a,10))return void r.parent.map.trigger(al.A.event.LAYERERROR,{layer:r.parent,reason:al.A.WFSErrors.MAX_NUM_FEATURES,data:{limit:parseInt(a,10),founded:e}});if(!Number.isNaN(e)&&0===e)return void n({data:l instanceof ol.format.GeoJSON?{type:"FeatureCollection",totalFeatures:0,features:[],crs:null}:l.writeFeatures([])});h(!1,o).then(n).catch(s)}}})).catch(s)}else h(!1,o).then(n).catch(s)})),r._requestUrl=a}},projection:e.crs}}var u,h,d;e.features&&((i=i||{}).features=e.features.map((e=>e instanceof xm.A?e.wrap.feature:e))),n=new ol.source.Vector(i),o&&n.on(jm,(function(e){r.parent.map&&r.parent.map.trigger(al.A.event.LAYERUPDATE,{layer:r.parent})})),n._tcLayer=r.parent;var p=e.style&&e.style.marker?e.style.marker:bm.A.Cfg.styles.marker;if(e.style&&e.style.marker||(p=Eh.A.extend({},p,{anchor:bm.A.Cfg.styles.point.anchor})),e.cluster&&(n=new ol.source.Cluster({projection:e.crs,distance:e.cluster.distance,source:n}),e.cluster.animate)){var g=[];n.addEventListener(Zm,(function(e){var t=e.feature.get("features");t&&t.length>1&&g.push(e.feature)})),n.addEventListener(Xm,(function(e){var t=e.feature.get("features");if(t){var r=t[0].getGeometry().getCoordinates();if(t.length>1){var n=g.filter((function(e){var t=e.getGeometry().getCoordinates();return t[0]===r[0]&&t[1]===r[1]}));n.length&&g.splice(g.indexOf(n[0]),1)}var i=g.filter((function(e){var t=e.get("features");if(t&&t.length>0)return t.filter((function(e){var t=e.getGeometry().getCoordinates();return t[0]===r[0]&&t[1]===r[1]})).length>0}));i.length&&function(e,t){var r=Date.now(),n=e.getGeometry().getCoordinates(),i=t.getGeometry().getCoordinates();t.setGeometry(new ol.geom.Point(n)),requestAnimationFrame((function o(){var a=function(e,t,r,n){var i=Math.min((Date.now()-n)/r,1),o=(t[0]-e[0])*i,a=(t[1]-e[1])*i;return[e[0]+o,e[1]+a]}(n,i,al.A.CLUSTER_ANIMATION_DURATION,r);t.setGeometry(new ol.geom.Point(a)),a[0]!==i[0]&&a[1]!==i[1]?requestAnimationFrame(o):g.splice(g.indexOf(e),1)}))}(i[i.length-1],e.feature)}}))}var f=n;do{f.addEventListener(Xm,(function(e){var t=e.feature,r=nv(t,!0);if(r){const n=ky(r.getImage(),p.width,t);n&&n.then((function(){if(e.feature._wrap.parent._legend){const t=e.feature._wrap.parent.layer;delete e.feature._wrap.parent._legend,t.map.trigger(al.A.event.VECTORUPDATE,{layer:t})}}))}})),f=Eh.A.isFunction(f.getSource)?f.getSource():null}while(f);n.addEventListener(Xm,(function(e){const t=e.feature;if(!t._wrap||!t._wrap.parent.layer||!t._wrap.parent.layer.features.includes(t._wrap.parent)){const e=bm.A.wrap.Feature.createFeature(t);let i;switch(!0){case e instanceof ll.A:i=r.parent.addPoint;break;case e instanceof cl.A:i=r.parent.addPolyline;break;case e instanceof _h.A:i=r.parent.addPolygon;break;case e instanceof Lh.A:i=r.parent.addMultiPolygon;break;case e instanceof ul.A:i=r.parent.addMultiPolyline;break;default:i=r.parent.addFeature}var n;i&&i.call(r.parent,t).then((function(i){var o=t.get("features");Array.isArray(o)&&(i.features=o.map((function(t){return new e.constructor(t)}))),clearTimeout(n),n=setTimeout((function(){r.parent.tree=null,r.parent.map?.trigger(al.A.event.FEATURESADD,{layer:r.parent,features:[i]})}),50)}))}})),n.addEventListener(Xm,(function(e){const t=e.feature,r=t.getGeometry();switch(!0){case r instanceof ol.geom.Point:case r instanceof ol.geom.MultiPoint:case r instanceof ol.geom.Polygon:case r instanceof ol.geom.MultiPolygon:{const e=e=>{let t=e;return Array.isArray(t)||(t=[t]),t.some((e=>e.getFill()))||t[0].setFill(new ol.style.Fill({color:"rgba(0,0,0,0)"})),t},r=t.getStyle();let n;r&&(n=Eh.A.isFunction(r)?function(t,n){return e(r(t,n))}:e(r),t.setStyle(n));break}}})),n.addEventListener(Zm,(function(e){var t=e.feature;if(t._wrap){var n=r.parent.features.indexOf(t._wrap.parent);n>-1&&(r.parent.map.trigger(al.A.event.BEFOREFEATUREREMOVE,{layer:r.parent,feature:t._wrap.parent}),r.parent.features.splice(n,1),r.parent.tree=null,r.parent.map.trigger(al.A.event.FEATUREREMOVE,{layer:r.parent,feature:t._wrap.parent}))}})),n.addEventListener(Xm,(function(e){r.parent.map&&(r.parent.tree=null,r.parent.map.trigger(al.A.event.VECTORUPDATE,{layer:r.parent}))})),n.addEventListener(Zm,(function(){r.parent.map&&(r.parent.tree=null,r.parent.map.trigger(al.A.event.VECTORUPDATE,{layer:r.parent}))})),n.addEventListener(Jm,(function(){r.parent.map&&(r.parent.tree=null,r.parent.map.trigger(al.A.event.FEATURESCLEAR,{layer:r.parent}))}));var m={source:n};return e.minResolution&&(m.minResolution=e.minResolution),e.maxResolution&&(m.maxResolution=e.maxResolution),i&&i.format instanceof ol.format.KML&&!e.cluster||(m.style=t||e.styles),m},bm.A.wrap.layer.Vector.prototype.createStyles=function(e){var t=this,r=!1;if((e=Eh.A.extend({},e)).crs=e.crs||bm.A.Cfg.crs,Eh.A.isFunction(e.styles))r=!0,t.styleFunction=function(t){return Uy({styles:e.styles(t._wrap.parent)})};else{const n=Gy(t.parent),i=Eh.A.extend(!0,n,e.styles);r=!(!e.cluster||!e.cluster.styles)||function e(t){for(var r in t){var n=t[r];switch(typeof n){case"string":if(/^\$\{(.+)\}$/.test(n))return!0;break;case"object":if(e(n))return!0;break;case"function":return!0}}return!1}(i);const o={styles:Object.assign({},i)};t.parent.styles&&(o.styles=Object.assign(o.styles,t.parent.styles)),e.cluster&&e.cluster.styles&&(o.styles=Object.assign({},o.styles,{cluster:e.cluster.styles})),t.styleFunction=function(e){o.layer=t.parent;let r=Uy(o,e);return Eh.A.isFunction(r)&&(r=r(e)),r}}return r?t.styleFunction:t.styleFunction()},bm.A.wrap.layer.Vector.prototype.setStyles=function(e){const t=this;t.getLayer().then((function(r){if(e&&e.heatmap||r instanceof ol.layer.Heatmap){const n=r.getSource().getFeatures();n.forEach((e=>e.setStyle(null)));const i=Eh.A.extend(!0,{features:n},t.parent.options);if(delete i.styles,t.layer=t.createVectorLayer(Eh.A.extend(i,{styles:e})),t.parent.map){const e=t.parent.map.wrap;e.insertLayer(t.layer,e.getLayerIndex(r)),e.removeLayer(r)}}else r.setStyle(t.createStyles({styles:e}))}))},bm.A.wrap.layer.Vector.prototype.createVectorLayer=function(e){const t=this;var r=null;e=e||t.parent.options;const n=t.createVectorSource(e,t.createStyles(e));if(e.styles&&e.styles.heatmap){const t=Eh.A.extend({},e.styles.heatmap);if(Eh.A.isFunction(t.weight)){const e=t.weight;t.weight=function(t){return e(t._wrap.parent)}}r=new ol.layer.Heatmap(Eh.A.extend({source:n.source},t))}else r=new ol.layer.Vector(n);return r._wrap=t,t.addCommonEvents(r),r},bm.A.wrap.layer.Vector.prototype.addFeatures=function(e){const t=this,r=function(t){t instanceof ol.layer.Heatmap&&e.forEach((e=>e.setStyle(null)));for(var r=t;Eh.A.isFunction(r.getSource);)r=r.getSource();r.addFeatures(e)};t.layer?r(t.layer):t.getLayer().then(r)},bm.A.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();return e instanceof ol.layer.Layer?e.getSource().getFeatures():[]},bm.A.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.layer;return t instanceof ol.layer.Layer?t.getSource().getFeatureById(e):null},bm.A.wrap.layer.Vector.prototype.removeFeature=function(e){const t=this,r=function(t){if(e.wrap.feature){let r=t.getSource(),n=e.wrap.feature.getId();if(n&&r.getFeatureById(n)&&(r.removeFeature(e.wrap.feature),r.getSource&&Array.isArray(e.features))){const t=r.getSource();e.features.slice().forEach((e=>t.removeFeature(e.wrap.feature)))}}};t.layer?r(t.layer):t.getLayer().then(r)},bm.A.wrap.layer.Vector.prototype.clearFeatures=function(){const e=this,t=function(e){var t=e.getSource();t.clearFeatures?t.clearFeatures():t.clear()};e.layer?t(e.layer):e.getLayer().then(t)},bm.A.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var r=this,n={color:"rgba(0, 0, 0, 0)"},i={color:"rgba(0, 0, 0, 0)"},o=new ol.style.Style({image:new ol.style.Circle({radius:0,fill:new ol.style.Fill(n),stroke:new ol.style.Stroke(i)}),fill:new ol.style.Fill(n),stroke:new ol.style.Stroke(i)});if(r.parent.features.indexOf(e)>=0){var a=e.wrap.feature;r.getLayer().then((function(e){t&&a._originalStyle?a.setStyle(a._originalStyle):(a._originalStyle=a.getStyle()||e.getStyle(),a.setStyle(o)),r.parent.map.trigger(al.A.event.VECTORUPDATE,{layer:r.parent})}))}},bm.A.wrap.layer.Vector.prototype.getRGBA=function(e,t){return Sy(e,t)},bm.A.wrap.layer.Vector.prototype.findFeature=function(e){},bm.A.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl},bm.A.wrap.layer.Vector.prototype.sendTransaction=function(e,t,r){const n=this,i=function(e){return e.wrap.feature};return new Promise((function(o,a){const s=e.map(i),l=t.map(i),c=r.map(i);e.length||t.length||r.length?n.getLayer().then((function(){var e=new ol.format.WFS,t=n.parent.options,r=e.writeTransaction(s,l,c,{featurePrefix:t.featurePrefix,featureNS:t.featureNS,featureType:t.featureType[0]}),i={url:n.parent.url,method:"POST",contentType:al.A.mimeType.XML,responseType:al.A.mimeType.XML,data:r.outerHTML};bm.A.ajax(i).then((function(t){const r=t.data,n="http://www.opengis.net/ows";var i=r.getElementsByTagNameNS(n,"ExceptionReport")[0],s={reason:""};if(i){var l=i.getElementsByTagNameNS(n,"Exception")[0];if(l){s.code=l.getAttribute("exceptionCode");for(var c=l.getElementsByTagNameNS(n,"ExceptionText"),u=0,h=c.length;u<h;u++)s.reason+="\n"+c[u].innerHTML}a(s)}else{var d=e.readTransactionResponse(r);o(d)}})).catch((function(e){const t={code:e.status||"",reason:e.msg||"unknown"};a(t)}))})):o(n.parent)}))},bm.A.wrap.layer.Vector.prototype.setDraggable=function(e,t,r){var n=this;Promise.all([n.parent.map.wrap.getMap(),n.getLayer()]).then((function(i){const o=i[0],a=i[1];if(e){var s={layers:[a],features:new ol.Collection(a.getSource().getFeatures())};n.interaction=new ol.interaction.Translate(s),Eh.A.isFunction(t)&&n.interaction.on("translateend",(function(e){e.features.getLength()&&t(e.features.item(0)._wrap.parent)})),Eh.A.isFunction(r)&&n.interaction.on("translatestart",(function(e){e.features.getLength()&&r(e.features.item(0)._wrap.parent)})),o.addInteraction(n.interaction)}else n.interaction&&(o.removeInteraction(n.interaction),Eh.A.detectIE()&&n._handlerDraggablePointerMove&&Eh.A.isFunction(n._handlerDraggablePointerMove)&&(o.un("pointermove",n._handlerDraggablePointerMove),delete n._handlerDraggablePointerMove))}))},bm.A.wrap.layer.Vector.prototype.getFeaturesInExtent=function(e,t){var r=this,n=this.layer.getSource().getFeatures(),i=[];if(t){var o=r.parent.map.getPixelFromCoordinate([e[0],e[1]]),a=r.parent.map.getPixelFromCoordinate([e[2],e[3]]);o[0]-=t[0]/2,o[1]+=t[1],a[0]+=t[0]/2,e=r.parent.map.getCoordinateFromPixel(o).concat(r.parent.map.getCoordinateFromPixel(a))}for(var s=0;s<n.length;s++){var l=n[s],c=l.getGeometry().getCoordinates();ol.extent.containsCoordinate(e,c)&&i.push(l._wrap.parent)}return i},bm.A.wrap.layer.Vector.prototype.getAttribution=function(){return null},bm.A.wrap.layer.Vector.prototype.getGetMapUrl=function(){var e=null;if(this.getServiceType()===al.A.layerType.WFS)try{e=this.parent.capabilities.Operations.GetFeature.DCP.HTTP.Get.href}catch(e){}const t=document.createDocumentFragment(),r=document.createElement("textarea");return t.appendChild(r),r.innerHTML=e,r.textContent},bm.A.wrap.layer.Vector.prototype.getServiceType=function(){var e=null;return this.parent.capabilities&&(e=al.A.layerType.WFS),e},bm.A.wrap.control.Click.prototype.register=function(e){var t=this;t._trigger=function(r){if(e.view!==al.A.view.PRINTING){var n=0;return e.wrap.map.forEachFeatureAtPixel(r.pixel,(function(e,t){e._wrap&&e._wrap.parent.showsPopup&&n++}),{hitTolerance:uy}),n||(t.parent.map.trigger(al.A.event.CLICK,{coordinate:r.coordinate,pixel:r.pixel}),t.parent.callback(r.coordinate,r.pixel)),0===n}}},bm.A.wrap.control.Click.prototype.activate=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){t.on(zm,e._trigger)}))},bm.A.wrap.control.Click.prototype.deactivate=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){t.un(zm,e._trigger)}))},bm.A.wrap.control.ScaleBar.prototype.render=function(){var e=this;e.ctl?e.ctl.updateElement_():e.ctl=new ol.control.ScaleLine({target:e.parent.div})},bm.A.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_},bm.A.wrap.control.NavBar.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){const n=t.parent.div;t.zCtl=new ol.control.Zoom({target:n}),t.zsCtl=new ol.control.ZoomSlider({render:function(e){(!e.frameState||!e.frameState.viewState||r.getView().getMinResolution()<=e.frameState.viewState.resolution)&&ol.control.ZoomSlider.prototype.render.call(this,e)}}),t.zsCtl.setTarget(n),r.addControl(t.zsCtl),r.addControl(t.zCtl),n.querySelectorAll("button").forEach((function(e){e.classList.add("tc-ctl-btn","tc-float-btn",t.parent.CLASS+"-btn"),e.style.display="block",e.innerHTML="",e.matches(".ol-zoomslider-thumb")&&e.setAttribute("title","[[zoomBar]]"),e.matches(".ol-zoom-in")&&(e.classList.add(t.parent.CLASS+"-btn-zoomin"),e.setAttribute("title","[[zoomIn]]")),e.matches(".ol-zoom-out")&&(e.classList.add(t.parent.CLASS+"-btn-zoomout"),e.setAttribute("title","[[zoomOut]]"))}));const i=n.querySelector(".ol-zoomslider");i.classList.add(t.parent.CLASS+"-bar"),i.querySelector(".ol-zoomslider-thumb").classList.add(t.parent.CLASS+"-slider"),e.on(al.A.event.BASELAYERCHANGE,t.refresh.bind(t))}))},bm.A.wrap.control.NavBar.prototype.refresh=function(){var e=this,t=e.parent.map.wrap.map;e.parent.renderPromise().then((function(){if(e.zsCtl.sliderInitialized_){var r=t.getView().getResolution();e.zsCtl.setThumbPosition_(r)}else t.once(Km,(function(t){e.zsCtl.render(t)}))}))},bm.A.wrap.control.NavBarHome.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){const n=t.parent.div;t.z2eCtl=new ol.control.ZoomToExtent({target:n,extent:e.initialExtent,tipLabel:""}),r.addControl(t.z2eCtl),n.querySelectorAll("button").forEach((function(e){e.style.display="block",e.innerHTML=""}));const i=n.querySelector(".ol-zoom-extent button");i.classList.add("tc-ctl-btn","tc-float-btn",t.parent.CLASS+"-btn"),i.setAttribute("title","[[zoomToInitialExtent]]")}))},bm.A.wrap.control.NavBarHome.prototype.setInitialExtent=function(e){this.z2eCtl.extent=e},bm.A.wrap.control.Coordinates.prototype.register=async function(e){const t=this;if(t.map=e,t._coordsTrigger=function(e){t.parent.coordsToClick(e)},t.olMap=await e.wrap.getMap(),t.parent.map.on3DView)t.parent.crs=t.parent.map.view3D.crs,t.parent.units=al.A.units.DEGREES;else{var r=t.olMap.getView().getProjection();t.parent.crs=r.getCode(),t.parent.units=r.getUnits()}t.parent.isGeo=t.parent.units===al.A.units.DEGREES},bm.A.wrap.control.Coordinates.prototype.onMouseMove=function(e){var t=this;if(t.map.wrap.map){var r=t.map.wrap.map.getEventCoordinate(e);r&&(t.parent.isGeo?t.parent.latLon=r.reverse():t.parent.xy=r,t.parent.update.apply(t.parent,arguments))}},bm.A.wrap.control.Geolocation.prototype.register=function(e){var t=this;t.map=e,t._snapTrigger=function(e){e.dragging||t.initSnap(t.olMap.getEventCoordinate(e.originalEvent),e.pixel)},t._postrenderTrigger=function(e){t.duringTrackSnap(e)},e.wrap.getMap().then((function(e){t.olMap=e}))};var Vy=function(){return this.parent.geotrackingLayer.features.find((function(e){return e instanceof cl.A}))};bm.A.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.geotrackingLayer.features.length>0&&this.parent.geotrackingLayer.features[0].geometry.length>=1},bm.A.wrap.control.Geolocation.prototype.addWaypoint=function(e,t){var r=new ol.Feature({geometry:new ol.geom.Point([e[0],e[1],t.ele,t.time],"XYZM")});r.setProperties(t),this.parent.geotrackingLayer.wrap.layer.getSource().addFeature(r)},bm.A.wrap.control.Geolocation.prototype.addPosition=function(e,t,r,n,i,o,a){var s=this,l=e[0],c=e[1],u=Vy.call(this);if(s.parent.geotrackingLayer.features&&u){var h=u.geometry.length>0&&u.geometry[u.geometry.length-1];if(h&&0===h.length)s.parent.geotrackingLayer.features[0].geometry.push([l,c,a,r]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,r]);else{var d=h[0],p=h[1];l===d&&c===p||(s.parent.geotrackingLayer.features[0].geometry.push([l,c,a,r]),u.wrap.feature.getGeometry().appendCoordinate([l,c,a,r]))}Eh.A.storage.setSessionLocalValue(s.parent.const.localStorageKey.GEOTRACKINGTEMP,s.formattedToStorage(s.parent.geotrackingLayer).features)}s.parent.trigger(s.parent.const.event.STATEUPDATED,{moving:null!=t&&null!=n&&n>0&&t>0})},bm.A.wrap.control.Geolocation.prototype.positionChangehandler=async function(e){const t=this;var r,n,i,o,a;if(Vy.call(this)||t.parent.setGeotracking(!1),e&&e.coords&&(t.parent.gpsLayer.clearFeatures(),r=e.coords.accuracy/t.parent.map.getMetersPerUnit()||0,n=e.coords.heading||e[2]||0,i=e.coords.speed?3.6*e.coords.speed:0,o=e.coords.altitude,a=e.coords.altitudeAccuracy||0,t.parent.geotrackingLayer)){var s=[e.coords&&e.coords.longitude||e[0],e.coords&&e.coords.latitude||e[1]];if(!s.every((e=>e)))return null;var l=Eh.A.reproject(s,"EPSG:4326",t.parent.map.crs);t.addPosition(l,n,(new Date).getTime(),i,r,a,o);var c=Vy.call(t).geometry,u=c.length;u>=2&&(t.parent.deltaMean=(c[u-1][3]-c[0][3])/(u-1)),t.parent.trigger(t.parent.const.event.POSITIONCHANGE,{pd:{position:l,altitude:o,accuracy:r,heading:Eh.A.radToDeg(n),speed:i}});const d=await Promise.all([t.parent.gpsLayer.addPoint(l,{radius:6,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),t.parent.gpsLayer.addCircle({center:l,radius:r},{strokeColor:"#ffffff",strokeWidth:1,fillColor:"#00CED1",fillOpacity:.3,showsPopup:!1})]),p=d[0],g=d[1];if(t.parent.geotrackingPosition=!0,0==t.parent.firstPosition){if(t.parent.firstPosition=!0,!t.parent.trackCenterButton){t.parent.trackCenterButton=t.parent.div.querySelector("."+t.parent.CLASS+"-track-center"),t.parent.trackCenterButton.querySelector("button").addEventListener("click",(function(){this.classList.contains(al.A.classes.UNPLUGGED)?(t.parent.setFollowing(!0),t.parent.moveTo(t.parent.gpsLayer.features[0].geometry),t.parent.getTrackInfoPanel().then((function(e){e.isVisible()||e.doVisible(),e.isMinimized()&&e.maximize()}))):t.parent.setFollowing(!1)}));var h=t.parent.map.getControlsByClass("TC.control.ControlContainer")[0];h?t.parent.trackCenterButton=h.addElement({position:h.POSITION.LEFT,htmlElement:t.parent.trackCenterButton}):t.parent.map.div.appendChild(t.parent.trackCenterButton)}t.parent.trackCenterButton.classList.remove(al.A.classes.HIDDEN),t.parent.setFollowing(!0),t.parent.moveTo(t.parent.gpsLayer.features)}return{marker:p,accuracy:g}}return null},bm.A.wrap.control.Geolocation.prototype.setGeotracking=function(e){var t=this;if(e){t.parent.firstPosition=!1;var r,n=[];if(t.parent.geotrackingSession){var i=(new bm.A.wrap.parser.JSON).parser.readFeatures(t.parent.geotrackingSession);i&&t.parent.storageCrs!==t.parent.map.crs&&(i=i.map((function(e){var r=e.clone();return r.getGeometry().transform(t.parent.storageCrs,t.parent.map.crs),r})));var o=i.find((function(e){var t=e.getGeometry().getType().toLowerCase();return"point"===t&&n.push(e),"linestring"===t||"multilinestring"===t})).getGeometry().getCoordinates();r=new ol.Feature({geometry:new ol.geom.LineString(o,"XYZM"),tracking:!0})}else r=new ol.Feature({geometry:new ol.geom.LineString([],"XYZM"),tracking:!0});if(r){const e=bm.A.wrap.Feature.createFeature(r);var a;t.parent.geotrackingLayer.addFeature(e),e.geometry.length>1&&t.parent.map.zoomToFeatures(t.parent.geotrackingLayer.features),n.length>0&&n.map((e=>bm.A.wrap.Feature.createFeature(e))).forEach((e=>t.parent.geotrackingLayer.addFeature(e))),t.parent.currentPositionWaiting=t.parent.getLoadingIndicator().addWait(),t.currentPositionTrk||(t.currentPositionTrk=[]);var s=0,l=0,c=!1,u={enableHighAccuracy:!0,timeout:6e5};const i=function e(r){var n=s++;navigator.geolocation.getCurrentPosition((function(e){clearInterval(a),t.parent.getLoadingIndicator().removeWait(t.parent.currentPositionWaiting),t.positionChangehandler(e).then((function(e){1==t.parent.geotrackingPosition&&e&&e.marker&&e.accuracy&&t.currentPositionTrk.push(navigator.geolocation.watchPosition(t.positionChangehandler.bind(t),t.parent.onGeolocateError.bind(t.parent),u))}))}),r||function(r){r.code===r.TIMEOUT?l>10?(clearInterval(a),t.parent.onGeolocateError.call(t.parent,r)):(l++,e((function(){clearInterval(a),c||(c=!0,t.parent.onGeolocateError.call(t.parent,r))}))):(clearInterval(a),t.parent.onGeolocateError.call(t.parent,r))},{timeout:5e3+n,maximumAge:10,enableHighAccuracy:!0})};a=setInterval(i,1e3),setTimeout((function(){t.parent.geotrackingLayer&&t.parent.geotrackingLayer.features&&t.parent.geotrackingLayer.features.length>0&&0==t.parent.geotrackingLayer.features[0].geometry.length&&(clearInterval(a),t.parent.getLoadingIndicator().removeWait(t.parent.currentPositionWaiting),t.map.toast(t.parent.getLocaleString("geo.error.permission_denied"),{type:al.A.msgType.WARNING}),t.parent.track.activateButton.classList.remove(al.A.classes.HIDDEN),t.parent.track.deactivateButton.classList.add(al.A.classes.HIDDEN))}),u.timeout+1e3)}}else t.parent.firstPosition=!1,t.currentPositionTrk&&(t.currentPositionTrk=t.currentPositionTrk instanceof Array?t.currentPositionTrk:[t.currentPositionTrk],t.currentPositionTrk.forEach((function(e){navigator.geolocation.clearWatch(e)})),t.currentPositionTrk=[]),t.parent.trackCenterButton&&t.parent.trackCenterButton.classList.add(al.A.classes.HIDDEN)},bm.A.wrap.control.Geolocation.prototype.activateSnapping=function(){var e=this;Eh.A.detectMobile()||(e.olMap.on([Ym,zm],e._snapTrigger),e.parent.trackLayer.wrap.layer.on(Km,e._postrenderTrigger))},bm.A.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){Eh.A.detectMobile()||(t.un([Ym,zm],e._snapTrigger),e.parent.trackLayer.wrap.layer.un(Km,e._postrenderTrigger)),e.snapInfo&&t.removeOverlay(e.snapInfo),e.snapInfoElement&&(e.snapInfoElement.style.display="none"),e.snapLine&&(delete e.snapLine,t.render())}))},bm.A.wrap.control.Geolocation.prototype.clear=function(e){e&&e.clearFeatures(),this.deactivateSnapping.call(this)},bm.A.wrap.control.Geolocation.prototype.duringTrackSnap=function(e){const t=ol.render.getVectorContext(e);t&&this.snapLine&&("function"==typeof t.setFillStrokeStyle&&t.setFillStrokeStyle(null,new ol.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1})),"function"==typeof t.drawGeometry&&t.drawGeometry(this.snapLine.wrap.feature.getGeometry()))},bm.A.wrap.control.Geolocation.prototype.endSnap=function(){var e=this;e.parent.map.wrap.getMap().then((function(t){e.snapInfo&&t.removeOverlay(e.snapInfo),e.snapInfoElement&&(e.snapInfoElement.style.display="none"),e.snapLine&&delete e.snapLine}))},bm.A.wrap.control.Geolocation.prototype.initSnap=function(e,t){var r=this;if(r.parent.trackLayer){var n=r.parent.trackLayer.wrap.layer.getSource().getClosestFeatureToCoordinate(e,(e=>{const t=e.getGeometry();return t instanceof ol.geom.LineString||t instanceof Vo.A}));if(null!==n){var i=n.getGeometry().getClosestPoint(e);r.parent.setSecondaryElevationProfileCoordinates(n.getGeometry().getCoordinates());const u=r.parent.map.getPixelFromCoordinate(i);if(Math.sqrt(Math.pow(t[0]-u[0],2)+Math.pow(t[1]-u[1],2))>r.parent.snappingTolerance)r.endSnap();else{var o=[e,[i[0],i[1]]];r.snapLine?r.snapLine.wrap.feature.getGeometry().setCoordinates(o):r.snapLine=new cl.A(o,{}),r.snapInfoElement||(r.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]),r.snapInfoElement.style.display="block",r.snapInfo||(r.snapInfo=new ol.Overlay({element:r.snapInfoElement,offset:[5,18]}),r.olMap.addOverlay(r.snapInfo)),null==r.snapInfo.getMap()&&r.snapInfo.setMap(r.olMap),r.snapInfo.setPosition(e);var a={};const t=n.getGeometry().getType();"LineString"!=t&&"MultiLineString"!=t&&n.getKeys().indexOf("name")>-1&&(a.n=n.get("name"));var s=r.parent.map.options.locale&&r.parent.map.options.locale.replace("_","-")||void 0;a.x=r.map.wrap.isGeo()?i[0].toLocaleString(s,{minimumFractionDigits:5}):Math.round(i[0]).toLocaleString(s),a.y=r.map.wrap.isGeo()?i[1].toLocaleString(s,{minimumFractionDigits:5}):Math.round(i[1]).toLocaleString(s),r.map.wrap.isGeo()&&(a.isGeo=!0);var l=function(e){return i[e]?(Math.round(100*i[e])/100).toLocaleString(s):void 0},c=function(e){return i[e]>0?new Date(i[e]).toLocaleString(s):void 0};if("XYZM"===n.getGeometry().getLayout()?(a.z=l(2),a.m=c(3)):"XYZ"===n.getGeometry().getLayout()?a.z=l(2):"XYM"===n.getGeometry().getLayout()&&(a.m=c(2)),a){if(r.parent.elevationChartData?.secondaryElevationProfileChartData?.[0]?.coords){const t=bm.A.wrap.Geometry.getNearest(e,r.parent.elevationChartData.secondaryElevationProfileChartData[0].coords)[2];a.mdtz=(Math.round(100*t)/100).toLocaleString(s)}r.parent.getRenderedHtml(r.parent.CLASS+"-track-snapping-node",a,(function(e){r.snapInfoElement.innerHTML=e}))}}}}r.olMap.render()},bm.A.wrap.control.Geolocation.prototype.drawTrackData=async function(e){const t=this,r=(new bm.A.wrap.parser.JSON).parser.readFeatures(e.data);r.filter((function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()})).forEach((function(t){t.getGeometry().setCoordinates(t.getGeometry().getCoordinates(),e.layout)})),t.activateSnapping.call(t),r.map((e=>bm.A.wrap.Feature.createFeature(e))).forEach((function(e){e&&t.parent.trackLayer.addFeature(e)})),(!t.parent.toShare||t.parent.toShare&&t.parent.toShare.doZoom)&&t.parent.map.zoomToFeatures(t.parent.trackLayer.features)},bm.A.wrap.control.Geolocation.prototype.formattedFromStorage=function(e){const t=this;if(t.parent.storageCrs!==t.parent.map.crs){var r=(new ol.format.GeoJSON).readFeatures(e);if(r)return r=r.map((function(e){var r=e.clone();return r.getGeometry().transform(t.parent.storageCrs,t.parent.map.crs),r.setId(e.getId()),r})),(new ol.format.GeoJSON).writeFeatures(r)}return e},bm.A.wrap.control.Geolocation.prototype.formattedToStorage=function(e,t,r){var n=this,i=new bm.A.wrap.parser.JSON;i=i.parser;var o,a=e.wrap.layer.getSource().getFeatures();return a=a.map((function(e){const i=e.getGeometry();if((i instanceof ol.geom.LineString||i instanceof ol.geom.MultiLineString)&&(o=i.getLayout()),t&&e.getProperties().tracking&&e.unset("tracking"),!r&&n.parent.map.crs!==n.parent.storageCrs){var a=e.clone();return a.getGeometry().transform(n.parent.map.crs,n.parent.storageCrs),a.setId(e.getId()),a}return e})).sort((function(e,t){return e.getGeometry()instanceof ol.geom.Point&&!(t.getGeometry()instanceof ol.geom.Point)?-1:t.getGeometry()instanceof ol.geom.Point&&!(e.getGeometry()instanceof ol.geom.Point)?2:e.getProperties().name<t.getProperties().name?-1:e.getProperties().name>t.getProperties().name?1:0})),{features:i.writeFeatures(a),layout:o}},bm.A.wrap.control.Geolocation.prototype.export=function(e){const t=this;return new Promise((function(r,n){t.parent.getTrackData(e).then((function(i){if(i){var o=(new ol.format.GeoJSON).readFeatures(i.data);if(0===o.length){var a=t.parent.getTrackData(e);o=(new ol.format.GeoJSON).readFeatures(a)}r(o.map((e=>bm.A.wrap.Feature.createFeature(e))))}else n()}))}))};var zy,Yy,$y=function(e){var t=[],r=[];if(e.length>1){4===e[0].length&&(e=e.sort((function(e,t){return e[0][3]==t[0][3]?0:e[0][3]<t[0][3]?-1:1})));for(var n=0;n<e.length;n++){for(var i=e[n],o=-1,a=1/0,s=i.getLastCoordinate(),l=n+1;l<e.length;l++){var c=e[l].getFirstCoordinate(),u=Math.hypot(s[0]-c[0],s[1]-c[1]);u<a&&(o=l,a=u)}t.length<e.length&&(-1===t.indexOf(n)&&(t.push(n),r=r.concat(i.getCoordinates())),-1===t.indexOf(o)&&(t.push(o),r=r.concat(e[o].getCoordinates())))}return r}return e[0].getCoordinates()};bm.A.wrap.control.Geolocation.prototype.processImportedFeatures=async function(e={}){const t=this.parent.trackLayer.wrap.layer.getSource(),r=e.fileName,n=[],i=[],o=[],a=[],s=e.features?.map((e=>e.wrap.feature))??t.getFeatures(),l=[],c=[],u=function(e){const t=e.getProperties();Object.prototype.hasOwnProperty.call(t,"name")&&t.name.trim().length>0?n.push(t.name):n.push(r)};for(let e of s){e instanceof xm.A&&(e=e.wrap.feature);const t=e.getGeometry();if(t instanceof ol.geom.Point){const r=t.getCoordinates();r.length>2&&r[3]>1e5&&r.splice(2,0,0),c.push(r),a.push(e)}else if(t instanceof ol.geom.LineString){u(e);const r=new ol.Feature({geometry:new ol.geom.LineString(t.getCoordinates(),t.getLayout())});r.setId(e.getId()||bm.A.getUID()),r.setProperties(e.getProperties()),i.push(r),o.push(e)}else if(t instanceof ol.geom.MultiLineString){var h=e.clone();u(h);var d=h.getGeometry().getLineStrings();const r=$y(d),n=new ol.Feature({geometry:new ol.geom.LineString(r,t.getLayout())});n.setId(e.getId()||bm.A.getUID()),n.setProperties(e.getProperties()),i.push(n),o.push(e)}}if(l.length>0){const e=$y(l);i.push(new ol.Feature({geometry:new ol.geom.LineString(e)}))}c.length>0&&a.length==s.length&&i.push(new ol.Feature({geometry:new ol.geom.LineString(c)}));for(var p=0;p<o.length;p++)t.removeFeature(o[p]);for(let e=0;e<i.length;e++)t.addFeature(i[e]);return n},bm.A.wrap.control.Geolocation.prototype.simulateTrackEnd=function(e){var t=this;e||(t.hasElevation=!0),t.parent.clearChartProgress(),t.simulateMarker&&(window.cancelAnimationFrame(zy),t.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&t.simulateMarker.layer.removeFeature(t.simulateMarker),delete t.simulateMarker)},bm.A.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var e,t=this,n=t.parent.trackLayer.wrap.layer.getSource().getFeatures(),i=0;i<n.length;i++){const t=n[i].getGeometry();if(t instanceof ol.geom.LineString){e=n[i].getGeometry().getCoordinates();break}t instanceof ol.geom.MultiLineString&&(e=t.getLineStrings().map((e=>e.getCoordinates())).flat())}if(e&&e.length>0){var o=e[0];(async function(){return t.simulateMarker?t.simulateMarker.setCoords(o.slice(0,2)):t.simulateMarker=await t.parent.trackLayer.addPoint(o.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}),t.simulateMarker})().then((function(n){var i=function(){var r,n=!1;const i=function(e){return t.parent.map.crs!==t.parent.map.options.utmCrs?Eh.A.reproject(e,t.parent.map.crs,t.parent.map.options.utmCrs):e};var o=e;if(4===o[0].length&&o[0][3]>0)r=o[0][3],n=!0;else{o[0][3]=Date.now();for(var a=1;a<o.length;a++){let e;o[a][3]=0,e=a+1<o.length?new ol.geom.LineString(i(o.slice(a-1,a+1))).getLength():new ol.geom.LineString(i(o.slice(a-1))).getLength(),o[a][3]=o[a-1][3]+36e5*e/t.parent.walkingSpeed}r=o[0][3]}var s,l=new ol.geom.LineString(o),c=r;s=t.parent.map.crs!==t.parent.map.options.utmCrs?new ol.geom.LineString(i(JSON.parse(JSON.stringify(o)))).getLength():l.getLength();var u=function(){if(!t.parent.simulate_paused){var e=l.getCoordinateAtM(c),r=function(e){for(var t=0;t<o.length;t++)if(o[t][3]>e)return{d:new ol.geom.LineString(i(o.slice(0,t))).getLength(),p:o[t-1].slice(0,2)}}(c);if(!e||!r){var a=t.parent.getSelectedTrackItem();return a&&t.parent.uiSimulate(!1,a),t.parent.hasElevation&&t.parent.clearChartProgress(),void t.simulateTrackEnd()}t.parent.hasElevation&&t.parent.setChartProgress(r,e,s,!!n&&t.parent.getTimeInterval(o[0][3],e[3])),t.simulateMarker&&t.simulateMarker.setCoords(e),1!==t.parent.simulationSpeed?c+=t.parent.delta*t.parent.simulationSpeed:c+=t.parent.delta}zy=requestAnimationFrame(u)};zy=requestAnimationFrame(u)};(async function(){return!!window.d3||await r.e(7965).then(r.t.bind(r,7965,23))})().then((function(){zy=requestAnimationFrame(i)}))}))}},bm.A.wrap.control.Geolocation.prototype.headingChangehandler=function(e){var t=this;if(!t.parent.track.infoOnMap){t.parent.track.infoOnMap=document.createElement("div");const e=t.parent.track.infoOnMap.style;e.overFlowY="scroll",e.height="200px",e.width="200px",e.top="0",e.left="100px",e.backgroundColor="fuchsia",e.position="absolute",t.parent.map.div.appendChild(t.parent.track.infoOnMap)}t.parent.track.infoOnMap.style.display="",t.heading=e.target.getHeading(),t.parent.track.infoOnMap.innerHTML=t.parent.track.infoOnMap.innerHTML+"<br> <p> salta headingChangehandler </p> <br> <p> evt.target.getHeading(): "+t.heading+" </p>",t.map.wrap.getMap().then((function(e){e.getView().setRotation(-t.heading)})),t.parent.trigger(t.parent.const.event.STATEUPDATED,{moving:null!=t.heading&&t.heading>0})},bm.A.wrap.control.Geolocation.prototype.orientationChangehandler=function(e){var t=this,r=t.map.wrap.map.getView(),n=r.getCenter(),i=r.getResolution(),o=e.target.getBeta()||0,a=e.target.getGamma()||0;n[0]-=i*a*25,n[1]+=i*o*25,r.setCenter(r.constrainCenter(n)),t.parent.trigger(t.parent.const.event.STATEUPDATED,{moving:null!=t.heading&&t.heading>0})},bm.A.wrap.control.Geolocation.prototype.pulsate=function(e){this.pulsated=!0;var t,r=e.wrap.feature.getGeometry().getRadius(),n=(new Date).getTime();t=this.olMap.on(Km,(function(i){var o=i.vectorContext,a=i.frameState,s=a.time-n,l=e.wrap.feature.getGeometry().clone(),c=function(e){switch(!0){case e<=50:return r;case e>50&&e<=100:return 1.02*r;case e>100&&e<=150:return 1.05*r;case e>150&&e<=200:return 1.02*r;case e>200&&e<=300:return r;case e>300&&e<=350:return 1.02*r;case e>350&&e<=400:return 1.05*r;case e>400&&e<=450:return 1.02*r;case e>450&&e<=500:return 1*r;default:return r}}(s);l.setRadius(c),o.setFillStrokeStyle(new ol.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new ol.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1})),o.drawCircleGeometry(l),s>500?ol.Observable.unByKey(t):a.animate=!0}))},bm.A.wrap.control.ResultsPanel.prototype.register=function(e){const t=this;t.map=e,e.wrap.getMap().then((function(e){t.olMap=e}))},bm.A.wrap.control.ResultsPanel.prototype.showElevationMarker=function(e={}){const t=this,r=e.data,n=e.layer,i=e.coords;if(!t.elevationMarker){const e=document.createElement("div");e.style.display="none",e.classList.add(t.parent.CLASS+"-overlay","tc-elevation"),t.elevationMarker=new ol.Overlay({id:"ovElevationMarker",element:e,offset:[0,0],positioning:ry,stopEvent:!1})}if(!n||n.getVisibility()&&n.getOpacity()>0){let e=i[r[0].index];t.parent.map.crs!==t.parent.map.options.utmCrs&&(e=Eh.A.reproject(e,t.map.options.utmCrs,t.map.crs)),t.elevationMarker.getElement().style.display="",t.olMap.getOverlayById(t.elevationMarker.getId())||(t.olMap.addOverlay(t.elevationMarker),t.map.on3DView&&t.map.view3D.addElevationMarker(e,t.parent)),t.elevationMarker.setPosition(e),t.map.on3DView&&t.map.view3D.setElevationMarker(bm.A.Util.reproject(e,t.parent.map.options.utmCrs,t.parent.map.getCRS()),t.parent)}},bm.A.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){const e=this;e.elevationMarker&&(e.elevationMarker.getElement().style.display="none",e.map.on3DView&&e.map.view3D.hideElevationMarker(e.parent))},bm.A.wrap.control.Coordinates.prototype.coordsActivate=async function(){var e=this;(e.olMap||await e.map.wrap.getMap()).on(Vm,e._coordsTrigger)},bm.A.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(Vm,this._coordsTrigger)},bm.A.wrap.Parser=function(){},bm.A.wrap.Parser.prototype.read=function(e){var t=[];return this.parser&&(t=this.parser.readFeatures(e).map((function(e){return new xm.A(null,{id:e.getId(),data:e.getProperties()})}))),t},bm.A.wrap.Parser.prototype.readFeatures=function(e){var t=[];return this.parser&&(t=this.parser.readFeatures(e).map((function(e){let t=e.getGeometry().getCoordinates();const r={};let n;switch(e.getGeometry().getType()){case"LineString":n=new cl.A(t,r);break;case"Polygon":n=new _h.A(t,r);break;case"MultiPoint":n=new wh.A(t,r);break;case"MultiLineString":n=new ul.A(t,r);break;case"MultiPolygon":n=new Lh.A(t,r);break;default:n=new ll.A(t,r)}return n}))),t},bm.A.wrap.parser={WFS:function(e){this.parser=new ol.format.WFS(e)},JSON:function(e){this.parser=new ol.format.GeoJSON(e)}},bm.A.inherit(bm.A.wrap.parser.WFS,bm.A.wrap.Parser),bm.A.inherit(bm.A.wrap.parser.JSON,bm.A.wrap.Parser),bm.A.wrap.control.OverviewMap.prototype.register=async function(e){const t=this;await e.loaded();const n=await t.parent.layer.wrap.getLayer(),i=await e.wrap.getMap();t.ovMap&&i.removeControl(t.ovMap),t.ovMap=new ol.control.OverviewMap({target:t.parent.div,collapsed:!1,collapsible:!1,className:t.parent.CLASS+" ol-overviewmap",layers:[n]}),t.ovMap._wrap=t,t.ovMap.getOverviewMap().pixelRatio_=1,t.manageSize.call(t.ovMap.getOverviewMap()),t._boxElm=t.ovMap.boxOverlay_.getElement();const{default:o}=await r.e(5587).then(r.t.bind(r,5587,23));var a=t.ovMap.getOverviewMap();const s=new o(t._boxElm);s.positionDrag=function(){const e=this.element.style,t="translate3d( "+this.dragPoint.x+"px, "+this.dragPoint.y+"px, 0)";if(e.transform.length){const r=e.transform.indexOf("translate3d");if(r>=0){const n=e.transform.indexOf(")",r);e.transform=e.transform.replace(e.transform.substring(r,n+1),t)}else e.transform=t+" "+e.transform}else e.transform=t},s.on("pointerDown",(function(r){if(s.dragged=t._boxElm.cloneNode(),s.dragged.classList.add(al.A.classes.ACTIVE),s.dragged.style.position="absolute",t._boxElm.insertAdjacentElement("beforebegin",s.dragged),e.maxExtent){var n=a.getPixelFromCoordinate([e.maxExtent[0],e.maxExtent[1]]),i=a.getPixelFromCoordinate([e.maxExtent[2],e.maxExtent[3]]),o=a.getSize();const t=document.createElement("div");t.style.position="absolute",t.style.bottom=Math.round(o[1]-n[1])+"px",t.style.left=Math.round(n[0])+"px",t.style.top=Math.round(i[1])+"px",t.style.right=Math.round(o[0]-i[0])+"px";const r=a.getViewport();r.insertBefore(t,r.firstElementChild),s.options.containment=t}})),s.on("pointerUp",(function(t){s.dragged.parentElement.removeChild(s.dragged),e.maxExtent&&(a.getViewport().removeChild(s.options.containment),s.options.containment=null)})),s.on("dragMove",(function(e,t,r){s._delta=r})),s.on("dragEnd",(function(r,n){var i=t.ovMap.getMap().getView(),o=a.getPixelFromCoordinate(i.getCenter()),l=a.getCoordinateFromPixel([o[0]+s._delta.x,o[1]+s._delta.y]),c=e.getExtent(),u=(c[2]-c[0])/2,h=(c[3]-c[1])/2;l[0]+u>e.maxExtent[2]?l[0]=e.maxExtent[2]-u:l[0]-u<e.maxExtent[0]&&(l[0]=e.maxExtent[0]+u),l[1]+h>e.maxExtent[3]?l[1]=e.maxExtent[3]-h:l[1]-h<e.maxExtent[1]&&(l[1]=e.maxExtent[1]+h),s.setPosition(0,0),delete s._delta,e.setCenter(l,{animate:!0})})),t.reset();const l=t.parent.div.querySelector("."+t.parent.CLASS+"-load");return n._wrap.$events.on(al.A.event.BEFORETILELOAD,(function(){l.classList.remove(al.A.classes.HIDDEN),l.classList.add(al.A.classes.VISIBLE)})),n._wrap.$events.on(al.A.event.TILELOAD,(function(){l.classList.remove(al.A.classes.VISIBLE),l.classList.add(al.A.classes.HIDDEN)})),i.addControl(t.ovMap),t.parent.isLoaded=!0,t.parent.trigger(al.A.event.MAPLOAD),t},bm.A.wrap.control.OverviewMap.prototype.reset=async function(e={}){const t=this,r=async function(e,r){if(e.type===al.A.layerType.WMTS){var n={crs:r||t.parent.map.crs,oldCrs:e.wrap.layer.getSource().getProjection().getCode()};n.oldCrs!==n.crs&&e.setProjection(n)}const i=await e.wrap.getLayer();var o=new ol.View(Ey(t.parent.map.wrap,i._wrap.parent));const a=t.ovMap.getOverviewMap();if((o.getResolutions()||o.getProjection().getCode()!==a.getView().getProjection().getCode())&&a.setView(o),i._wrap.$events.one(al.A.event.TILELOAD,(function(){a.getLayers().getArray()[0].getSource().refresh()})),e!==t.parent.layer||-1===a.getLayers().getArray().indexOf(e)){t.parent.map.trigger(al.A.event.OVERVIEWBASELAYERCHANGE,{oldLayer:e!==t.parent.layer?t.parent.layer:null,newLayer:e}),a.getLayers().forEach((function(e){(e instanceof ol.layer.Image||e instanceof ol.layer.Tile)&&a.removeLayer(e)}));const r=t.parent.div.querySelector("."+t.parent.CLASS+"-load");i._wrap.$events.on(al.A.event.BEFORETILELOAD,(function(){r.classList.remove(al.A.classes.HIDDEN),r.classList.add(al.A.classes.VISIBLE)})),i._wrap.$events.on(al.A.event.TILELOAD,(function(){r.classList.remove(al.A.classes.VISIBLE),r.classList.add(al.A.classes.HIDDEN)})),a.getLayers().insertAt(0,i)}return e};var n=e.layer||t.parent.layer;if(t.parent.map&&n&&t.ovMap){await n.getCapabilitiesPromise();var i=n;if(n.isCompatible(t.parent.map.crs)||0!==n.wrap.getCompatibleMatrixSets(t.parent.map.crs).length)return await r(n);if(n=n.getFallbackLayer()||t.parent.defaultLayer,await n.getCapabilitiesPromise(),t.parent.map.on3DView&&!n.isCompatible(t.parent.map.crs)){const e=await t.parent.map.loadProjections({crsList:i.getCompatibleCRS(),orderBy:"name"});return await r(i,e[0].code)}if(n.isCompatible(t.parent.map.crs))return await r(n)}return null},bm.A.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var e,t=this,r=null,n="3DCamera";if(t.ovMap&&((e=t.ovMap.getOverviewMap()).getLayers().forEach((function(e){e.get("id")===n&&(r=e)})),!r)){const i={styles:{polygon:Object.assign({},t.parent.map.options.styles?.polygon)}};let o=Uy(i);Eh.A.isFunction(o)&&(o=o()),o[0].getFill().setColor([0,0,0,0]),r=new ol.layer.Vector({id:n,source:new ol.source.Vector,style:o}),e.addLayer(r)}return r},bm.A.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){var t=this;if(this.parent.map.isLoaded){t.is3D=!!e;var r=t.get3DCameraLayer();if(r){var n,i=(e=e||{}).fov,o=r.getSource();if(i&&i.length){var a=o.getFeatures();a.length?n=a[0]:(n=new ol.Feature,o.addFeature(n)),n.setGeometry(new ol.geom.Polygon([i]))}else o.clear();var s="number"==typeof e.heading?e.heading:0;t._boxElm.style.transform="rotate("+s+"rad)"}}},bm.A.wrap.control.OverviewMap.prototype.enable=function(){var e=this;if(e.parent.layer&&e.parent.layer.setVisibility){e.parent.layer.setVisibility(!0),e.parent.wrap.ovMap.getOverviewMap().updateSize();const t=document.createEvent("HTMLEvents");t.initEvent("resize",!1,!1),e.parent.map.div.dispatchEvent(t)}e.ovMap.resetExtent_(),e.ovMap.updateBoxAfterOvmapIsRendered_()},bm.A.wrap.control.OverviewMap.prototype.disable=function(){var e=this;e.parent.layer&&e.parent.layer.setVisibility&&e.parent.layer.setVisibility(!1)},bm.A.wrap.control.OverviewMap.prototype.manageSize=function(){bm.A.wrap.Map.prototype.manageSize.call(this)},bm.A.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){bm.A.wrap.control.Click.prototype.register.call(t,e);var n=t._trigger;t._trigger=function(r){var i=n.call(t,r);return i?t.parent.beforeRequest({xy:r.pixel}):e.trigger(al.A.event.NOFEATUREINFO,{control:t.parent}),i}}))};var Ky=function(e){var t=e.innerHTML||e.textContent;return(Yy=Yy||document.createElementNS("http://www.w3.org/1999/xhtml","textarea")).innerHTML=t,Yy.value},Xy={readFeatures:function(e){var t=[],r=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,o=n.length;i<o;i++)for(var a=n[i],s=a.getAttribute("layername"),l=a.getElementsByTagName("FeatureInfo"),c=0,u=l.length;c<u;c++){for(var h=l[c].getElementsByTagName("Field"),d={},p=0,g=h.length;p<g;p++){var f=h[p];d[Ky(f.getElementsByTagName("FieldName")[0])]=Ky(f.getElementsByTagName("FieldValue")[0])}var m=new ol.Feature(d);m.setId(s+"."+bm.A.getUID()),t.push(m)}return t}},Zy=function(e,t,r){var n=t.getPath(r);e.layers.push({name:r,title:n[n.length-1],path:n.slice(1),features:[],filter:t.filter})};bm.A.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,t,r={}){var n=this,i=n.parent.map;return new Promise((function(o,a){i.wrap.getMap().then((function(a){var s={},l={};const c=[],u=[],h=[];var d=[],p=a.getLayers().getArray();p=p.filter((function(e){return e instanceof ol.layer.Image&&e.getVisible()}));for(var g=0;g<p.length;g++){var f=p[g],m=f._wrap.parent;const e=f.getSource();if(e.getFeatureInfoUrl&&i.workLayers.indexOf(m)>=0&&m.names.length>0&&(!r.serviceUrl||r.serviceUrl===m.url)){let t;s[m.url]?(t=s[m.url],l[m.url].source.updateParams(Eh.A.extend(l[m.url].source.getParams(),e.getParams()))):(t={url:m.url,layers:[],mapLayers:[],title:m.title,request:null},s[m.url]=t,l[m.url]={source:new ol.source.ImageWMS({url:e.getUrl(),crossOrigin:e.crossOrigin_,params:{...e.getParams()},ratio:bm.A.Cfg.imageRatio,imageLoadFunction:m.getImageLoad.bind(m),serverType:e.serverType_}),layers:[]}),t.mapLayers.push(m);var y=m.getDisgregatedLayerNames();if(r.layerName)y.indexOf(r.layerName)>=0&&f._wrap.getInfo(r.layerName).queryable&&(Zy(t,m,r.layerName),l[m.url].layers.push(r.layerName));else{for(var v=0;v<y.length;v++){var A=y[v];f._wrap.getInfo(A).queryable?Zy(t,m,A):(Eh.A.consoleRegister('Capa "'+y[v]+'" no queryable, la eliminamos de la petición GFI'),y.splice(v,1),v-=1)}y.length>0&&(l[m.url].layers=l[m.url].layers.concat(y))}}}const S=function(e){return e&&(/<(Filter|fes:Filter|ogc:Filter).*<\/(Filter|fes:Filter|ogc:Filter)>/.test(e)||e instanceof bm.A.filter.Filter||e instanceof Dm.B)},E=function(e,t){return e instanceof bm.A.filter.Filter?e.getText():e instanceof Dm.B?t.filter:e};for(var w in s){d.push(s[w]);const r=s[w],n=l[w].source,o=l[w].layers;if(!o||0===o.length)continue;var _=n.getParams();_.filter&&(_.filter=r.layers.map((function(e){return"("+(S(e.filter)?E(e.filter,_):"")+")"})).join("")),_.cql_filter&&(_.cql_filter=r.layers.map((function(e){return!e.filter||S(e.filter)?"INCLUDE":e.filter})).join(";")),_.LAYERS=o.join(",");var L=n.getFeatureInfoUrl(e,t,i.crs,{QUERY_LAYERS:o.join(","),INFO_FORMAT:_.INFO_FORMAT,FEATURE_COUNT:1e3,radius:i.options.pixelTolerance,buffer:i.options.pixelTolerance}),C=L=L.replace(/sld_body=[a-zA-Z%0-9._]*/);const a={serviceUrl:w,requestedFormat:_.INFO_FORMAT,expandUrl:C};u.push(a),c.push(new Promise((function(e,t){const n=r.mapLayers[0];n.proxificationTool.fetch(L).then((function(t){n.proxificationTool.cacheHost.getAction(a.expandUrl).then((function(r){a.originalUrl=r.action.call(n.proxificationTool,a.expandUrl),e(Eh.A.extend({},t,a))}))})).catch((function(e){t(Error(e))}))}))),Eh.A.consoleRegister("Lanzamos GFI")}if(c.length>0)Promise.all(c).then((function(a){for(var l=!1,c=0,d=[],p=0;p<a.length;p++){var g,f=a[p],m=s[u[p].serviceUrl];l=!0,m.text=f.responseText;var y=f.contentType;if(y&&y.indexOf(";")>-1&&(y=y.substr(0,y.indexOf(";")).trim()),y||(y=f.requestedFormat),y===f.requestedFormat){switch(y){case"application/json":g=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":g=f.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:i.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":g=new ol.format.GML3({srsName:i.crs});break;case"application/vnd.esri.wms_featureinfo_xml":g=Xy;break;default:g=null}if(g){var v;try{v=g.readFeatures(f.responseText,{featureProjection:ol.proj.get(i.crs)})}catch(e){bm.A.error(n.parent.getLocaleString("featureInfo.error.badResponse",{url:f.serviceUrl})+": "+e.message),v=[];continue}c+=v.length;for(var A=function(e,t,r){var n=!1;if(t===r)n=!0;else{var i=e.getNodePath(t),o=e.getNodePath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(e.wrap.getName(i[a])!==e.wrap.getName(o[a])){n=!1;break}}}return n},S={},E=0;E<v.length;E++){var w=v[E];if(w instanceof ol.Feature){for(var _,L=w.getId()||bm.A.getUID(),C=!1,b=L.substr(0,L.lastIndexOf(".")),T=0;T<m.layers.length;T++){var x=m.layers[T],P=x.name.substr(x.name.indexOf(":")+1);if(m.mapLayers.some((e=>A(e,P,b)))){C=!0,r.featureId&&w.getId()!==r.featureId||(h.push(bm.A.wrap.Feature.createFeature(w,{showsPopup:!1})),d.push(x.features));break}}C||(S[b]?_=S[b]:(_={name:b,title:b,path:[b],features:[]},S[b]=_,m.layers.push(_)),r.featureId&&w.getId()!==r.featureId||(h.push(bm.A.wrap.Feature.createFeature(w,{showsPopup:!1})),d.push(_.features)))}}}else{const e={name:"layer"+bm.A.getUID(),title:"Datos en el punto",features:[{rawUrl:f.originalUrl,expandUrl:f.expandUrl,rawContent:f.responseText,rawFormat:y}]};m.layers.push(e),c+=1}}else Eh.A.consoleRegister("Respuesta GFI: lo más probable es que el servidor esté devolviendo una excepción"),Eh.A.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada"),n.parent.responseError({message:f.responseText,status:f.status}),i.toast(n.parent.getLocaleString("featureInfo.error"),{type:al.A.msgType.ERROR})}if(l){var M;h.forEach((function(t,r){for(var i in t.attributes=[],t.data){var o=t.data[i];"object"!=typeof o?t.attributes.push({name:i,value:"number"==typeof o?o.toLocaleString(Eh.A.getMapLocale(n.parent.map)):o}):t.attributes.push({name:i,value:o})}!M&&bm.A.Geometry.isInside(e,t.geometry)&&(M=t);const a=d[r];a.some((e=>e.id===t.id))||a.push(t)}));const r=[];for(let e in s)Object.prototype.hasOwnProperty.call(s,e)&&r.push(s[e]);n.parent.responseCallback({coords:e,resolution:t,services:r,featureCount:c,defaultFeature:M}),o()}else o()}),(function(r,a,l){if(d&&0===d.length)for(let e in s)d.push(s[e]);n.parent.responseCallback({coords:e,resolution:t,services:d,featureCount:0}),i.toast(n.parent.getLocaleString("featureInfo.error"),{type:al.A.msgType.ERROR}),o()}));else{if(i.workLayers.filter((function(e){return e instanceof Om.A})).length>0&&i.toast(n.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:al.A.msgType.INFO}),d&&0===d.length)for(let e in s)d.push(s[e]);i.on(al.A.event.BEFOREFEATUREINFO,(function(){n.parent.responseCallback({coords:e,resolution:t,services:d,featureCount:0})})),n.parent.responseCallback({coords:e,resolution:t,services:d,featureCount:0}),o()}}))}))},bm.A.wrap.control.GeometryFeatureInfo.prototype.register=function(e){var t=this;e.wrap.getMap().then((function(r){bm.A.wrap.control.Click.prototype.register.call(t,e);var n=t._trigger;t._trigger=function(e){t.hasSuitableLayers().then((function(r){r&&(t.parent._isSearching||e.type!==zm||t.parent._isDrawing||t.parent._isSearching||n.call(t,e))}))}}))},bm.A.wrap.control.GeometryFeatureInfo.prototype.hasSuitableLayers=async function(){const e=this.parent.map;var t=!1;return(await e.wrap.getMap()).getLayers().forEach((function(r){var n=r._wrap.parent;if(r.getSource().getFeatureInfoUrl&&e.workLayers.indexOf(n)>=0)return t=!0,!1})),t},bm.A.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(e={}){const t=this;var r=e.xy,n=e.layer||t.parent.filterLayer,i=e.callback,o=e.geometryType,a=!1;t.drawCtrl?(t.drawCtrl.setActive(!0),t.drawCtrl.startDrawing_(r)):n.wrap.getLayer().then((function(e){let n;n=o===al.A.geom.POLYLINE?ay:ly;const s=e.getStyle();t.drawCtrl=new ol.interaction.Draw({source:e.getSource(),type:n,style:function(e){return e&&e.getGeometry().getType()===n?Eh.A.isFunction(s)?s(e):s:null}}),e.getSource().on(Xm,(function(e){bm.A.wrap.Feature.createFeature(e.feature).showsPopup=!1})),t.drawCtrl.handleEvent=function(e){if(e.type===zm){var t=n===ly?this.sketchCoords_[0]:this.sketchCoords_;a&&2===t.length&&null!==this.sketchFeature_?this.addToDrawing_(e):a=!0}return ol.interaction.Draw.prototype.handleEvent.call(this,e)};const l=t.parent.map.wrap.map;l.addInteraction(t.drawCtrl),t.drawCtrl.on("drawstart",(function(e){t.parent._isDrawing=!0,l.getInteractions().forEach((function(e,t){e instanceof ol.interaction.DoubleClickZoom&&e.setActive(!1)}))})),t.drawCtrl.startDrawing_(r),t.drawCtrl.on("drawend",(function(r){t.parent._isDrawing=!1,l.getInteractions().forEach((function(e,t){e instanceof ol.interaction.DoubleClickZoom&&e.setActive(!1)})),l.removeInteraction(t.drawCtrl),this.setActive(!1),t.drawCtrl=null,e.getSource().clear(),t.parent._drawToken=!0,setTimeout((function(){t.parent._drawToken=!1}),500),r.feature.setId(t.parent.getUID());const n=bm.A.wrap.Feature.createFeature(r.feature,{showsPopup:!1});t.parent.filterFeature=n,n.layer=t.parent.filterLayer,i&&i(n)}))}))},bm.A.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(e,t,r){var n=this;n.drawCtrl&&n.parent._isDrawing&&(n.parent._isDrawing=!1,n.drawCtrl.setActive(!1),n.drawCtrl.source_.clear())};var Jy=function(e,t,r){var n,i=r;switch(i&&i.indexOf(";")>-1&&(i=i.substr(0,i.indexOf(";")).trim()),i||(i=t.requestedFormat),i){case"application/json":n=new ol.format.GeoJSON;break;case"application/vnd.ogc.gml":n=t.responseText.indexOf("FeatureCollection")>-1?new ol.format.WFS({gmlFormat:new ol.format.GML2({srsName:e.crs})}):new ol.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":n=new ol.format.GML3({srsName:e.crs});break;case"text/xml":case"application/xml":{const e=t.querySelector("ServiceException");e&&bm.A.error(e),n=null;break}default:n=null}return n?n.readFeatures(t,{featureProjection:ol.proj.get(e.crs)}):null},Qy=async function(e,t){const r=[];for(var n=[],i=function(e,t,r){var n=!1;if(t===r||0===t.indexOf(r))n=!0;else{var i=e.getPath(t),o=e.getPath(r);if(i.length>0&&o.length>=i.length){n=!0;for(var a=0;a<i.length;a++)if(i[a]!==o[a]){n=!1;break}}}return n},o={},a=0;a<e.length;a++){var s=e[a];if(s instanceof ol.Feature){for(var l,c=s.getId()||bm.A.getUID(),u=!1,h=c.substr(0,c.lastIndexOf(".")),d=0;d<t.layers.length;d++){var p=t.layers[d],g=p.name.substr(p.name.indexOf(":")+1);if(t.mapLayers.some((e=>i(e,g,h)))){u=!0,r.push(bm.A.wrap.Feature.createFeature(s)),n[s.id_]=p.features;break}}u||(o[h]?l=o[h]:(l={name:h,title:h,features:[]},o[h]=l,t.layers.push(l)),r.push(bm.A.wrap.Feature.createFeature(s)),n.push(s.id_))}}return r.forEach((function(e){for(var t in e.attributes=[],e.data){var r=e.data[t];e.attributes.push({name:t,value:r})}n[e.id].push(e)})),{service:t}};bm.A.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(e,t){var r=this;return new Promise((function(n,i){var o=r.parent.map;o.wrap.getMap().then((function(i){var a=e.wrap.feature.getGeometry(),s=a.stride,l=a.getFlatCoordinates();if(!t){for(var c=null,u=1,h=l.length;u<h;u+=s)(!c||c[1]<l[u])&&(c=[l[u-1],l[u]]);t=i.getPixelFromCoordinate(new ol.geom.Point(c).getCoordinates())}r.parent.beforeRequest({xy:t});var d=o.extractFeatures({filter:new bm.A.filter.intersects(e,o.crs),outputFormat:al.A.format.JSON});const p=[];Promise.all(d).then((function(e){for(var i=[],a=0,s=0;s<e.length;s++){const t=e[s];if(t){t.service&&(t.service.title=t.service.mapLayers[0].title),p.push(new Promise((function(e,n){if(t.errors&&t.errors.length){for(var i=0;i<t.errors.length;i++){var a,s=al.A.msgType.WARNING,l=t.errors[i];switch(l.key){case al.A.WFSErrors.MAX_NUM_FEATURES:a=r.parent.getLocaleString("wfs.tooManyFeatures",l.params);break;case al.A.WFSErrors.GETCAPABILITIES:a=r.parent.getLocaleString("wfsGFI.inValidService",l.params);break;case al.A.WFSErrors.NO_FEATURES:continue;case al.A.WFSErrors.INDETERMINATE:a=r.parent.getLocaleString("wfs.IndeterminateError"),bm.A.error(`Error:${l.params.err}\nDescripcion: ${l.params.errorThrown}\nServicio: ${l.params.serviceTitle}`,al.A.msgErrorMode.CONSOLE),s=al.A.msgType.ERROR;break;default:a=r.parent.getLocaleString("wfsGFI."+l.key,l.params)}o.toast(a,{type:s})}t.response||e()}})));var l=t.response?Jy(o,t.response.responseText,t.response.contentType):[];p[p.length-1]=Qy(l,t.service),t.service&&i.push(t.service),a+=l.length}}Promise.all(p).then((function(){r.parent.responseCallback({xy:t||null,services:i,featureCount:a}),n()}))}),(function(e){r.parent.responseCallback({}),n()}))}))}))},bm.A.wrap.control.Popup.prototype=function(){this.popup=null},al.A.event.PANANIMATIONSTART="pananimationstart.tc",al.A.event.PANANIMATIONEND="pananimationend.tc",bm.A.wrap.control.Popup.prototype.fitToView=function(){var e=this,t=e.parent.map,r=e.parent.map.wrap.map,n=e.parent.popupDiv.getBoundingClientRect(),i=t.div.getBoundingClientRect(),o=r.getCoordinateFromPixel([n.left-i.left,n.top-i.top]),a=r.getCoordinateFromPixel([n.right-i.left,n.bottom-i.top]);if(o){var s=o[0],l=o[1],c=a[0],u=[s,a[1],c,l],h=t.getExtent();if(!ol.extent.containsExtent(h,u)){var d={left:Math.max(h[0]-u[0],0),bottom:Math.max(h[1]-u[1],0),right:Math.max(u[2]-h[2],0),top:Math.max(u[3]-h[3],0)};if(e.parent.dragged){var p=e.popup.getPosition();d.right?p[0]=p[0]-d.right:d.left&&(p[0]=p[0]+d.left),d.top?p[1]=p[1]-d.top:d.bottom&&(p[1]=p[1]+d.bottom);var g=r.getPixelFromCoordinate(p);g[1]=r.getSize()[1]-g[1],e.parent._previousContainerPosition=g,(e.popup._oldUpdatePixelPosition||e.popup.updatePixelPosition).call(e.popup,p)}else if(e.parent.isVisible()){var f=r.getView(),m=f.getCenter().slice();d.top?m[1]+=d.top:d.bottom&&(m[1]-=d.bottom),d.right?m[0]+=d.right:d.left&&(m[0]-=d.left),f.animate({center:m,easing:function(t){return 0===t&&e.parent.map.trigger(al.A.event.PANANIMATIONSTART),1===t&&e.parent.map.trigger(al.A.event.PANANIMATIONEND),t}})}}}},bm.A.wrap.control.Popup.prototype.setDragged=function(e){const t=this;var r=t.popup;if(e)r._oldUpdatePixelPosition||(r._oldUpdatePixelPosition=r.updatePixelPosition,r.updatePixelPosition=function(){}),r._newHandleOffsetChanged||(r._newHandleOffsetChanged=function(){r._oldUpdatePixelPosition()},t._offsetChangeListenerKey&&ol.events.unlistenByKey(t._offsetChangeListenerKey),t._offsetChangeListenerKey=ol.events.listen(r,"change:offset",r._newHandleOffsetChanged,r));else{const e=r.getElement().parentElement.style;e.setProperty("top",r.rendered.top_),e.setProperty("bottom",r.rendered.bottom_),e.setProperty("left",r.rendered.left_),e.setProperty("right",r.rendered.right_),delete t.parent._previousContainerPosition,r._oldUpdatePixelPosition&&(r.updatePixelPosition=r._oldUpdatePixelPosition,delete r._oldUpdatePixelPosition),r._newHandleOffsetChanged&&(t._offsetChangeListenerKey&&ol.events.unlistenByKey(t._offsetChangeListenerKey),t._offsetChangeListenerKey=ol.events.listen(r,"change:offset",r.handleOffsetChanged,r),delete r._newHandleOffsetChanged)}},bm.A.wrap.Feature.prototype.getLegend=function(){var e=this,t={},r=nv(e.feature,!0);if(r){var n=r.getImage();if(n){if(n instanceof ol.style.Icon){t.src=n.getSrc();var i=n.getImage();i.width&&(t.width=i.width,t.height=i.height);var o=n.getScale();o&&(t.scale=o)}else n instanceof ol.style.Circle&&(t.src=n.getImage().toDataURL());e.parent.options.radius&&(t.height=t.width=2*e.parent.options.radius)}else{let n;switch(e.feature.getGeometry().getType()){case cy:case ly:n=al.A.geom.POLYGON;break;case sy:case ay:n=al.A.geom.POLYLINE;break;default:n=al.A.geom.POINT}t.src=Eh.A.getLegendImageFromStyle(jy(r),{geometryType:n})}}return t};const ev=function(e,t){const r=this;r.feature=new ol.Feature,r.parent.id&&r.feature.setId(r.parent.id),t.geometryName&&r.feature.setGeometryName(t.geometryName),r.feature._wrap=r,r.parent.setCoordinates(e),r.parent.setData(r.parent.data)};bm.A.wrap.Feature.prototype.createPoint=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{point:t}},r.feature))},bm.A.wrap.Feature.prototype.createMultiPoint=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{point:t}},r.feature))},bm.A.wrap.Feature.prototype.createMarker=function(e,t={}){const r=this;var n=Eh.A.getPointIconUrl(t);n?(t.url=n,ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{marker:t}},r.feature))):r.createPoint(e,t)},bm.A.wrap.Feature.prototype.createMultiMarker=function(e,t={}){const r=this;var n=Eh.A.getPointIconUrl(t);n?(t.url=n,ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{marker:t}},r.feature))):r.createMultiPoint(e,t)},bm.A.wrap.Feature.prototype.createPolyline=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{line:t}},r.feature))},bm.A.wrap.Feature.prototype.createPolygon=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{polygon:t}},r.feature))},bm.A.wrap.Feature.prototype.createMultiPolyline=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{line:t}},r.feature))},bm.A.wrap.Feature.prototype.createMultiPolygon=function(e,t={}){const r=this;ev.call(r,e,t),Eh.A.hasStyleOptions(t)&&r.feature.setStyle(Uy({styles:{polygon:t}},r.feature))},bm.A.wrap.Feature.prototype.createCircle=function(e,t={}){ev.call(this,e,t),this.feature.setStyle(new ol.style.Style({stroke:new ol.style.Stroke({color:t.strokeColor,width:t.strokeWidth,lineDash:t.lineDash}),fill:new ol.style.Fill({color:Sy(t.fillColor,t.fillOpacity)})}))},bm.A.wrap.Feature.createFeature=function(e,t={}){if(e._sitnaFeature)e._sitnaFeature.data=e._sitnaFeature.wrap.getData(),e._sitnaFeature.geometry=e._sitnaFeature.wrap.getGeometry();else{var r=e.getGeometry();t.id=e.getId();let a,s,l=e.getStyle();switch(l&&Eh.A.extend(t,jy(l,e)),!0){case r instanceof ol.geom.Point:case r instanceof ol.geom.MultiPoint:Eh.A.isFunction(l)&&(l=l(e));for(var n=l?Array.isArray(l)?l:[l]:[],i=0,o=n.length;i<o;i++)if(l=n[i],l.getImage()instanceof ol.style.Icon){a="Marker";break}a=a||"Point",r instanceof ol.geom.MultiPoint&&("Point"===a&&(a="MultiPoint"),"Marker"===a&&(a="MultiMarker"));break;case r instanceof ol.geom.LineString:a="Polyline";break;case r instanceof ol.geom.Polygon:a="Polygon";break;case r instanceof ol.geom.MultiLineString:a="MultiPolyline";break;case r instanceof ol.geom.MultiPolygon:a="MultiPolygon"}s=a?new Nm[a](e,t):new xm.A(e,t),s.data=s.wrap.getData(),e._sitnaFeature=s}return e._sitnaFeature},bm.A.wrap.Feature.prototype.cloneFeature=function(){const e=this.feature.clone();return this.feature._originalStyle&&(e._originalStyle=this.feature._originalStyle),e},bm.A.wrap.Feature.prototype.getStyle=function(){var e=this,t={},r=e.feature.getStyle();Eh.A.isFunction(r)&&(r=r(e.feature));var n=r?Array.isArray(r)?r:[r]:[];const i=function(e){return Number(e).toString(16).padStart(2,"0")},o=function(e){if(Array.isArray(e))return["#"+i(e[0])+i(e[1])+i(e[2]),parseFloat(e[3])];let t=e.match(/rgba\(([\d\.]+),([\d\.]+),([\d\.]+),([\d\.]+)\)/i);return t?o(t.slice(1,5)):(t=e.match(/rgb\(([\d\.]+),([\d\.]+),([\d\.]+)\)/i),t?o([...t.slice(1,4),1]):[e,1])},a=function(e,t){if(e){const r=e.getFill()||e.getImage()?.getFill?.call(e.getImage());if(r){const[e,n]=o(r.getColor());t.fillColor=e,1!==n&&(t.fillOpacity=n)}}},s=function(e,t){if(e){const r=e.getStroke();r&&(t.strokeColor=r.getColor(),t.strokeWidth=r.getWidth())}};for(var l=0,c=n.length;l<c;l++){a(r=n[l],t),s(r,t);const i=r.getImage();if(i instanceof ol.style.Icon){(!e.parent.options?.cssClass||e.parent.options?.cssClass&&!Eh.A.getFeatureStyleFromCss(e.parent.options?.cssClass)?.url)&&(t.url=i.getSrc());const r=i.getSize();let n=i.getScale();n||(n=[1,1]),Array.isArray(n)||(n=[n,n]),r&&(t.width=r[0]*n[0],t.height=r[1]*n[1]);const o=i.getRotation();o&&(t.rotation=180*o/Math.PI);var u=i.getAnchor();u&&(t.anchor=[u[0]*n[0],u[1]*n[1]],r&&(t.anchor[0]=t.anchor[0]/t.width,t.anchor[1]=t.anchor[1]/t.height))}else i instanceof ol.style.Circle?(a(i,t),s(i,t),t.radius=i.getRadius()):(a(i,t),s(i,t));var h=r.getText();if(h){t.label=h.getText();var d=h.getFont();d&&(t.fontSize=parseInt(d.match(/\d+pt/))||.75*parseInt(d.match(/\d+px/)),t.font=d);var p=h.getRotation();p&&(t.labelRotationKey=-180*p/Math.PI);var g=h.getScale();g&&(t.textScale=g);var f=h.getTextAlign();f&&(t.textAlign=f),t.labelOffset=[h.getOffsetX(),h.getOffsetY()];var m=h.getFill();m&&(t.fontColor=m.getColor());var y=h.getStroke();y&&(t.labelOutlineColor=y.getColor(),t.labelOutlineWidth=y.getWidth())}r._balloon&&r._balloon.getText()&&(t.balloon=r._balloon.getText())}return Eh.A.extend(e.parent.options,t),e.feature3D&&(t=Object.assign(t,e.feature3D.getStyle())),t},bm.A.wrap.Feature.prototype.getGeometry=function(){var e,t=this;if(t.feature&&t.feature.getGeometry){var r=t.feature.getGeometry();if(r)if(r instanceof ol.geom.Circle){const t=r.getCenter();e=[t,[t[0]+r.getRadius(),t[1]]]}else r.getCoordinates&&(e=r.getCoordinates())}return e},bm.A.wrap.Feature.prototype.setGeometry=function(e){const t=this;if(t.feature&&t.feature.getGeometry){var r=t.feature.getGeometry();let u;var n,i,o,a,s,l,c;switch(!0){case t.parent instanceof Lh.A:s=!0,u=ol.geom.MultiPolygon,a=e,Array.isArray(a)&&(o=e[0]);case t.parent instanceof _h.A||t.parent instanceof ul.A:l=!0,u=u||(t.parent instanceof _h.A?ol.geom.Polygon:ol.geom.MultiLineString),o=s?o:e,Array.isArray(o)&&(i=o[0]);case t.parent instanceof cl.A||t.parent instanceof wh.A:c=!0,u=u||(t.parent instanceof cl.A?ol.geom.LineString:ol.geom.MultiPoint),i=l?i:e,Array.isArray(i)&&(n=i[0]);case t.parent instanceof ll.A:if(u=u||ol.geom.Point,n=c?n:e,Array.isArray(n)&&"number"==typeof n[0]&&"number"==typeof n[1]){let i;switch(n.length){case 3:i="XYZ";break;case 4:i="XYZM";break;default:i="XY"}r?r.setCoordinates(e,i):(r=new u(e,i),t.feature.setGeometry(r))}break;case t.parent instanceof Im.A:{const n=Im.A.parseGeometry(e),i=n[0],o=n[1];let a;switch(i.length){case 3:a="XYZ";break;case 4:a="XYZM";break;default:a="XY"}const s=Math.hypot(o[0]-i[0],o[1]-i[1]);r?r.setCenterAndRadius(i,s,a):(r=new ol.geom.Circle(i,s,a),t.feature.setGeometry(r));break}}}},bm.A.wrap.Feature.prototype.getId=function(){var e;return this.feature&&(e=this.feature.getId()),e},bm.A.wrap.Feature.prototype.setId=function(e){this.feature&&this.feature.setId(e)};const tv=function(e){let t=0;return e.forEach((function(e){const r=new ol.geom.Polygon([e]).getLinearRing(0);t+=ol.geom.flat.linearRingLength(r.flatCoordinates,0,r.flatCoordinates.length,r.stride)})),t},rv=function(e){return new ol.geom.LineString(e).getLength()};bm.A.wrap.Feature.prototype.getLength=function(e={}){const t=this;let r=0;if(t.feature3D&&t.parent?.layer?.map.on3DView)return t.parent.layer.map.view3D.getLength(t.feature3D);const n=t.feature.getGeometry(),i=e.coordinates||n.getCoordinates();switch(!0){case n instanceof ol.geom.Polygon:r=tv(i);break;case n instanceof ol.geom.LineString:r=rv(i);break;case n instanceof ol.geom.MultiPolygon:i.forEach((function(e){r+=tv(e)}));break;case n instanceof ol.geom.MultiLineString:i.forEach((function(e){r+=rv(e)}))}return r},bm.A.wrap.Feature.prototype.getArea=function(e={}){const t=this;if(t.feature3D&&t.parent?.layer?.map.on3DView)return t.parent.layer.map.view3D.getArea(t.feature3D);const r=t.feature.getGeometry();let n;return r instanceof ol.geom.Polygon?n=ol.geom.Polygon:r instanceof ol.geom.MultiPolygon&&(n=ol.geom.MultiPolygon),n?new n(e.coordinates||r.getCoordinates()).getArea():0};const nv=function(e,t){var r=e.getStyle();return Eh.A.isFunction(r)&&(r=r(e)),Array.isArray(r)&&(r=r.reduce((function(e,t){return e.fill_=t.fill_||e.fill_,e.image_=t.image_||e.image_,e.stroke_=t.stroke_||e.stroke_,e.text_=t.text_||e.text_,e}),new ol.style.Style)),r||t||(r=new ol.style.Style,e.setStyle(r)),r};bm.A.wrap.Feature.prototype.setStyle=function(e){const t=this,r=t.feature;if(null===e)return void r.setStyle(null);const n=t.parent,i={styles:{}};i.styles[n.STYLETYPE]=e;let o=Uy(i,r);if(r.setStyle(o),n.layer&&t.feature3D){let i=r._originalStyle||o;Eh.A.isFunction(i)&&(i=i()),n.layer.map.view3D.setStyle(t.feature3D,e),n.layer.map.view3D.setLabel(t.feature3D,e.label?{outlineColor:"#FFFFFF",fontColor:e.fontColor,outlineWidth:2,font:e.font||e.fontSize+"pt sans-serif",text:e.label}:null)}r._originalStyle&&(delete r._originalStyle,t.toggleSelectedStyle(!0)),r.changed()},bm.A.wrap.Feature.prototype.toggleSelectedStyle=function(e){const t=this.feature;(void 0===e?!t._originalStyle:e)?cv(t):uv(t)},bm.A.wrap.Feature.prototype.getInnerPoint=function(e={}){var t,r=this.feature.getGeometry();let n,i=!1;switch(t=r.getFirstCoordinate(),r.getType()){case cy:e.clipBox&&(r=new ol.geom.MultiPolygon(r.getPolygons().map((t=>bm.A.Geometry.clipPolygon(t.getCoordinates(),e.clipBox))).filter((e=>e.length))),i=!0);var o=0;r=r.getPolygons().reduce((function(e,t){const r=t.getArea(),n=r>o?t:e;return o=r,n}));case ly:n=r.getCoordinates(),e.clipBox&&!i&&(n=bm.A.Geometry.clipPolygon(n,e.clipBox)),t=(r=new ol.geom.Polygon(n)).getInteriorPoint().getCoordinates();for(var a=r.getLinearRings(),s=1;s<a.length;s++)if(bm.A.Geometry.isInside(t,a[s].getCoordinates())){t=r.getClosestPoint(t);break}break;case sy:e.clipBox&&(r=new ol.geom.MultiLineString(r.getLineStrings().map((t=>bm.A.Geometry.clipPolyline(t.getCoordinates(),e.clipBox))).filter((e=>e.length))),i=!0);var l=0;r=r.getLineStrings().reduce((function(e,t){const r=t.getLength(),n=r>l?t:e;return l=r,n}));case ay:var c=[0,0];n=r.getCoordinates(),e.clipBox&&!i&&(n=bm.A.Geometry.clipPolyline(n,e.clipBox)),r=new ol.geom.LineString(n),n.forEach((e=>{c[0]+=e[0],c[1]+=e[1]})),c[0]/=n.length,c[1]/=n.length,t=r.getClosestPoint(c)}return t},bm.A.wrap.Feature.prototype.showPopup=function(e={}){const t=this,r=e instanceof bm.A.Control?e:e.control;var n=r.map;if(n){var i=t.feature;if(i){const p=t.parent;n.currentFeature=p;var o=n.getExtent();t._innerCentroid=t.getInnerPoint({clipBox:o}),r.contentDiv.innerHTML=e.html||t.parent.getInfo({locale:n.options.locale});var a,s=t.parent.options;if(Eh.A.isEmptyObject(s)&&t.parent.layer&&t.parent.layer.styles)switch(!0){case p instanceof ll.A:(s=t.parent.layer.styles.point)&&!Eh.A.isEmptyObject(s)||(s=t.parent.layer.styles.marker);break;case p instanceof Pm.A:s=t.parent.layer.styles.marker;break;case p instanceof Im.A:case p instanceof Lh.A:case p instanceof _h.A:s=t.parent.layer.styles.polygon;break;case p instanceof ul.A:case p instanceof cl.A:s=t.parent.layer.styles.line}if(s.anchor)a=Fy(s.anchor,t.parent);else{for(var l,c=i._wrap.parent,u=0;u<n.workLayers.length;u++){var h=n.workLayers[u];if(!h.isRaster()&&h.features.indexOf(c)>=0){l=h.wrap.styleFunction(i);break}}if(Array.isArray(l)){const e=l[0]?.getImage();a=!e||e instanceof ol.style.Icon?[.5,0]:[.5,.5]}}const g=[0,0];if(a)if(s.height)g[1]=-(Fy(s.height,t.parent)||0)*a[1];else{var d=nv(i,!0);if(d){const e=d.getImage();if(e instanceof ol.style.Icon){const t=e.getImageSize();if(t){const r=e.getScale(),n=Array.isArray(r)?r[1]:r;g[1]=t[1]*-n}}}}r.wrap.setDragged(!1),r.wrap.popup.setOffset(g),r.wrap.popup.setPosition(t._innerCentroid),r.popupDiv.classList.add(al.A.classes.VISIBLE);const f=r.popupDiv.parentElement;f.removeChild(r.popupDiv),f.appendChild(r.popupDiv)}else n.wrap.hidePopup(r)}},bm.A.wrap.Feature.prototype.isNative=function(e){return e instanceof ol.Feature},bm.A.wrap.Feature.prototype.getPath=function(){var e=[],t=this;return t.feature&&t.feature._folders&&(e=t.feature._folders),e},bm.A.wrap.Feature.prototype.getBounds=function(){var e=null;if(this.feature){const t=this.feature.getGeometry();if(!t)return null;e=t.getExtent()}return e},bm.A.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this,r=t.feature.getStyle();Eh.A.isFunction(r)&&(r=r(t.feature)),r&&(r=Array.isArray(r)?r.find((e=>e._balloon)):r)&&r._balloon&&(e=r._balloon.getText());const n=t.feature.getProperties();return!e&&Object.prototype.hasOwnProperty.call(n,"description")&&(e=n.description),e},bm.A.wrap.Feature.prototype.getData=function(){var e=this.feature.getProperties();Array.isArray(e.features)&&(e=1===e.features.length?e.features[0].getProperties():e.features.length+" elementos");var t=this.feature.getGeometryName();for(var r in e[t]&&delete e[t],e)if(e[r]&&e[r].getType){const t=e[r];let n;switch(t.getType()){case iy:n=ll.A;break;case oy:n=wh.A;break;case ly:n=_h.A;break;case cy:n=Lh.A;break;case ay:n=cl.A;break;case sy:n=ul.A}n&&(e[r]=new n(t.getCoordinates()))}return e},bm.A.wrap.Feature.prototype.setData=function(e){const t={...e};delete t[this.feature.getGeometryName()];for(let e in t){const r=t[e];let n;switch(!0){case r instanceof ll.A:n=ol.geom.Point;break;case r instanceof wh.A:n=ol.geom.MultiPoint;break;case r instanceof _h.A:n=ol.geom.Polygon;break;case r instanceof Lh.A:n=ol.geom.MultiPolygon;break;case r instanceof cl.A:n=ol.geom.LineString;break;case r instanceof ul.A:n=ol.geom.MultiLineString}n&&(t[e]=new n(r.getCoordinates()))}this.feature.setProperties(t)},bm.A.wrap.Feature.prototype.unsetData=function(e){this.feature.unset(e)},bm.A.wrap.Feature.prototype.clearData=function(){const e=this.feature,t=e.getGeometryName();e.getKeys().forEach((function(r){r!==t&&e.unset(r)}))},bm.A.wrap.control.Draw.prototype.mouseMoveHandler=function(e){const t=this;t.sketch&&t.parent.trigger(al.A.event.MEASUREPARTIAL,t.getMeasureData())},bm.A.wrap.control.Draw.prototype.mouseOverHandler=function(e){const t=this;t.sketch&&t.hoverCoordinate&&(t.pushCoordinate(t.hoverCoordinate),t.hoverCoordinate=null)};const iv=function(e){const t=e.getLayout().length;for(let r=0;r<e.flatCoordinates.length;r++)r%t>1&&(e.flatCoordinates[r]=null)};bm.A.wrap.control.Draw.prototype.clickHandler=function(e){const t=this;if(t.parent?.map?.view!==al.A.view.PRINTING){if(t._mdPx){const r=t._mdPx[0]-e.clientX,n=t._mdPx[1]-e.clientY;if(r*r+n*n>t.interaction.squaredClickTolerance_)return}if(t.sketch){iv(t.sketch.getGeometry());var r=t.sketch.getGeometry().getCoordinates();t.parent.trigger(al.A.event.POINT,{point:r[r.length-1]})}}},bm.A.wrap.control.Draw.prototype.pointerdownHandler=function(e){this._mdPx=[e.clientX,e.clientY]},bm.A.wrap.control.Draw.prototype.getMeasureData=function(){const e=this,t=function(r,n){const i=new r.constructor(Eh.A.reproject(r.getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs));if(i.getLineStrings?n.length=i.getLineStrings().reduce(((e,t)=>e+t.getLength()),0):n.length=i.getLength(),e._extendedFeature){const i=e._extendedFeature.getGeometry();if(i!==r){const e={};t(i,e),e.length&&(n.length+=e.length)}}},r=function(t,n){if(t instanceof ol.geom.MultiPolygon)t.getPolygons().forEach((e=>{r(e,n)})),t=t.getPolygon(0);else{const r=new ol.geom.Polygon([Eh.A.reproject(t.getLinearRing(0).getCoordinates(),e.parent.map.crs,e.parent.map.options.utmCrs)]);n.area??=0,n.area+=r.getArea();var i=r.getLinearRing(0);n.perimeter??=0,n.perimeter+=ol.geom.flat.linearRingLength(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)}},n={units:al.A.units.METERS};if(this.sketch){var i=this.sketch.getGeometry();i instanceof ol.geom.Polygon||i instanceof ol.geom.MultiPolygon?r(i,n):i instanceof ol.geom.LineString||i instanceof ol.geom.MultiLineString?t(i,n):i instanceof ol.geom.Point&&(n.coordinates=i.getCoordinates())}return n},bm.A.wrap.control.Draw.prototype.getSketch=function(){return this.sketch?bm.A.wrap.Feature.createFeature(this.sketch):null},bm.A.wrap.control.Draw.prototype.getExtendedFeature=function(){return this._extendedFeature?bm.A.wrap.Feature.createFeature(this._extendedFeature):null},bm.A.wrap.control.Draw.prototype.activate=function(e){var t,r=this;switch(e){case al.A.geom.POLYGON:t=ly;break;case al.A.geom.MULTIPOLYGON:t=cy;break;case al.A.geom.POINT:t=iy;break;case al.A.geom.MULTIPOINT:t=oy;break;case al.A.geom.MULTIPOLYLINE:t=sy;break;default:t=ay}r.parent.map&&Promise.all([r.parent.map.wrap.getMap(),r.parent.getLayer()]).then((function(n){const i=n[0],o=n[1];if(r.parent.map.on3DView)return r.interaction3D=new r.parent.map.view3D.UI.DrawControl(e,(function(e){return o.addFeature(e)})),r.setStyle(),r.interaction3D.activate(),void(r.redoStack=[]);o&&o.wrap.getLayer().then((function(n){if(r.viewport||(r.viewport=i.getViewport()),r.interaction&&(i.removeInteraction(r.interaction),r._pointerdownHandler&&(r.viewport.removeEventListener("pointerdown",r._pointerdownHandler),r._pointerdownHandler=null),r._clickHandler&&(r.viewport.removeEventListener("click",r._clickHandler),r._clickHandler=null),r._mouseMoveHandler&&r._mouseOverHandler&&(r.viewport.removeEventListener(Bm,r._mouseMoveHandler),r.viewport.removeEventListener(Um,r._mouseOverHandler))),e){r._pointerdownHandler=r.pointerdownHandler.bind(r),r._clickHandler=r.clickHandler.bind(r),r.viewport.addEventListener("pointerdown",r._pointerdownHandler),r.viewport.addEventListener("click",r._clickHandler),r.parent.measurer&&(r._mouseMoveHandler=r.mouseMoveHandler.bind(r),r._mouseOverHandler=r.mouseOverHandler.bind(r),r.viewport.addEventListener(Bm,r._mouseMoveHandler),r.viewport.addEventListener(Um,r._mouseOverHandler));const a=function(e){let t;return e.getSource().getFeatures().forEach((e=>{const r=e.getGeometry().getLayout();"XY"!==r&&(t=r)})),t};var o={type:t,snapTolerance:0,condition:function(){return ol.events.condition.shiftKeyOnly(arguments[0])&&i.forEachFeatureAtPixel(i.getPixelFromCoordinate(arguments[0].coordinate),(function(e){return ly===e.getGeometry().getType()||cy===e.getGeometry().getType()?e:null}),{hitTolerance:uy}),r.parent?.map?.view!==al.A.view.PRINTING||null},geometryLayout:a(n)};n&&(o.source=n.getSource()),e===al.A.geom.RECTANGLE&&(o.type=ay,o.maxPoints=2,o.geometryFunction=function(e,t){const r=e[0],n=e[1],i=[[r,[r[0],n[1]],n,[n[0],r[1]],r]];return t?t.setCoordinates(i):t=new ol.geom.Polygon(i),t}),r.interaction=new ol.interaction.Draw(o),r.setStyle(),r.interaction.on("drawstart",(function(e){r.sketch=e.feature,r._extending&&r.interaction.sketchCoords_[r.interaction.sketchCoords_.length-1].forEach(((e,t,r)=>{t>1&&(r[t]=null)}));const t={},n=r.parent.mode;if(r._extending)t.feature=r.interaction.sketchFeature_._sitnaFeature;else if(r.parent.extensibleSketch&&(n===al.A.geom.POLYLINE||n===al.A.geom.MULTIPOLYLINE)){const n=e.feature.getGeometry().getFirstCoordinate(),i=r.parent.layer.features.filter((e=>e instanceof cl.A||e instanceof ul.A)).find((e=>{const t=e.wrap.feature.getGeometry().getLastCoordinate();return n[0]===t[0]&&n[1]===t[1]}));if(i)return r._extendFeature(i),void(t.feature=i)}t.extending=r._extending,r.parent.trigger(al.A.event.DRAWSTART,t)}),this),r.interaction.on("drawend",(function(e){if(!e.feature.getStyle()){const t=ov(r.parent.mode,r.parent.getStyle());e.feature.setStyle(Uy(t))}r.parent.measurer&&r.parent.trigger(al.A.event.MEASURE,r.getMeasureData());const t=function(e){r.parent.trigger(al.A.event.DRAWEND,{feature:e}),r.sketch=null,r.interaction.setActive(!0)};if(r._extending&&r._extendedFeature){let i=r.sketch.getGeometry();const o=r._extendedFeature.getGeometry();i=new i.constructor(i.getCoordinates(),o.getLayout()),i instanceof ol.geom.MultiLineString&&(i=new ol.geom.LineString(i.getLineString(0).getCoordinates())),iv(i),o.appendLineString(i);const a=r._extendedFeature._wrap.parent;a.setStyle(r.parent.getStyle()),a.geometry=o.getCoordinates(),n&&setTimeout((()=>{n.getSource().removeFeature(e.feature)}),100),t(a)}else{const n=e.feature._wrap?.parent||bm.A.wrap.Feature.createFeature(e.feature);if(r.parent.mode===al.A.geom.RECTANGLE){const e=400,i=r.interaction.getMap().getInteractions().getArray().find((e=>e instanceof ol.interaction.DoubleClickZoom));i&&i.getActive()&&(i.setActive(!1),setTimeout((function(){i.setActive(!0)}),e)),r.interaction.setActive(!1),setTimeout((()=>t(n)),e)}else t(n)}delete r._extendedFeature,delete r._extending}),this),r._projectionChangeHandler=function(e){!function(e,t){if(e.sketch){const n=t.oldValue.getProjection(),i=t.target.get(t.key).getProjection();if(n.getCode()!==i.getCode()){const t=e.sketch.getGeometry();t.transform(n,i),e.interaction.sketchPoint_.getGeometry().transform(n,i);const o=[];var r;r=e.parent.mode===al.A.geom.POLYGON?e.interaction.sketchCoords_[0]:e.interaction.sketchCoords_,ol.geom.flat.deflateCoordinates(o,0,r,t.stride),ol.proj.getTransform(n,i)(o,o,t.stride),r=ol.geom.flat.inflateCoordinates(o,0,o.length,t.stride),e.parent.mode===al.A.geom.POLYGON?e.interaction.sketchCoords_=[r]:e.interaction.sketchCoords_=r}}}(r,e)},i.on("change:view",r._projectionChangeHandler),i.addInteraction(r.interaction);let s=r.parent.snapping;const l=!s&&r.parent.extensibleSketch,c=e=>{const t=e.getGeometry();return t instanceof jo.A||t instanceof Vo.A};if(l&&(s=n.getSource().getFeatures().filter(c).map((e=>e._wrap.parent))),r.setSnapping(s),l){const e=r.snapInteraction;n.getSource().on("addfeature",(function(t){c(t.feature)&&r.snapInteraction===e&&r.snapInteraction.addFeature(t.feature)}))}}r.redoStack=[]}))}))},bm.A.wrap.control.Draw.prototype.setSnapping=function(e){const t=this,r=t.parent.map.wrap.map;if(t.snapInteraction&&(r.removeInteraction(t.snapInteraction),t.snapInteraction=null),e){const n={};if(e instanceof Rm.A)n.source=e.wrap.layer.getSource();else if(Array.isArray(e))n.features=new h(e.map((e=>e.wrap?.feature)));else{const e=t.parent.layer.wrap.layer;n.source=e.getSource()}t.snapInteraction=new ol.interaction.Snap(n),r.addInteraction(t.snapInteraction),t.setStyle()}},bm.A.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.parent.map&&(e.sketch=null,e.viewport&&(e._pointerdownHandler&&(e.viewport.removeEventListener("pointerdown",e._pointerdownHandler),e._pointerdownHandler=null),e._clickHandler&&(e.viewport.removeEventListener("click",e._clickHandler),e._clickHandler=null)),Promise.all([e.parent.map.wrap.getMap(),e.parent.getLayer()]).then((function(t){const r=t[0],n=t[1];n&&e.parent.singleSketch&&n.clearFeatures(),e.interaction&&(r.removeInteraction(e.interaction),e.interaction=null),e._projectionChangeHandler&&r.un("change:view",e._projectionChangeHandler)}))),e.interaction3D&&e.interaction3D.deactivate()},bm.A.wrap.control.Draw.prototype._extendFeature=function(e){const t=this;t._extending=!0;const r=e.wrap.feature;e instanceof cl.A?(t.interaction.abortDrawing(),e.layer.removeFeature(e),t.interaction.extend(r)):t._extendedFeature=r},bm.A.wrap.control.Draw.prototype.popCoordinate=function(){const e=this;if(e.parent.mode===al.A.geom.RECTANGLE)throw Error("popCoordinate not allowed when drawing rectangles");var t=null;if(e.interaction){var r=e.interaction.sketchFeature_;if(r){var n,i=r.getGeometry();if(i instanceof ol.geom.Polygon?n=i.getCoordinates()[0]:i instanceof ol.geom.LineString&&(n=i.getCoordinates()),n.length>1){let c;i instanceof ol.geom.Polygon?c=e.interaction.sketchCoords_[0]:i instanceof ol.geom.LineString&&(c=e.interaction.sketchCoords_);var o,a=!1;if(e.interaction.sketchPoint_)for(var s=e.interaction.sketchPoint_.getGeometry().getCoordinates(),l=0;l<n.length;l++)if(n[l][0]==s[0]&&n[l][1]==s[1]){a=!0;break}t=c[o=a?c.length-2:c.length-1],c.splice(o,1),i instanceof ol.geom.Polygon?(i.setCoordinates([c]),e.interaction.sketchLine_.getGeometry().setCoordinates(c)):i.setCoordinates(c),r.setGeometry(i)}}}else e.interaction3D&&(t=e.interaction3D.popCoordinate());return t},bm.A.wrap.control.Draw.prototype.pushCoordinate=function(e){var t=this,r=!1;if(t.interaction){var n=t.interaction.sketchFeature_;if(n){var i,o,a=n.getGeometry();a instanceof ol.geom.Polygon?i=a.getCoordinates()[0]:a instanceof ol.geom.LineString&&(i=a.getCoordinates()),a instanceof ol.geom.Polygon?o=t.interaction.sketchCoords_[0]:a instanceof ol.geom.LineString&&(o=t.interaction.sketchCoords_);var s=!1;if(t.interaction.sketchPoint_)for(var l=t.interaction.sketchPoint_.getGeometry().getCoordinates(),c=0;c<i.length;c++)if(i[c][0]==l[0]&&i[c][1]==l[1]){s=!0;break}let u;u=s?o.length-1:o.length,o.splice(u,0,e),a instanceof ol.geom.LineString?a.setCoordinates(o,"XY"):(a.setCoordinates([o],"XY"),t.interaction.sketchLine_.getGeometry().setCoordinates(o)),r=!0}}else t.interaction3D&&(t.interaction3D.pushCoordinate(e),r=!0);return r},bm.A.wrap.control.Draw.prototype.undo=function(){var e=this,t=!1,r=e.popCoordinate();return r&&(e.redoStack.push(r),t=!0),e.parent.trigger(al.A.event.MEASUREPARTIAL,e.getMeasureData()),t},bm.A.wrap.control.Draw.prototype.redo=function(){var e=this,t=!1;return e.redoStack.length>0&&(e.pushCoordinate(e.redoStack.pop()),t=!0),e.parent.trigger(al.A.event.MEASUREPARTIAL,e.getMeasureData()),t},bm.A.wrap.control.Draw.prototype.end=function(){var e=this;e.interaction&&e.interaction.sketchFeature_?e.interaction.finishDrawing():e.interaction3D&&e.interaction3D.end()};const ov=function(e,t){const r={};switch(e){case al.A.geom.POLYGON:case al.A.geom.MULTIPOLYGON:r.styles={polygon:t,line:!1,point:!1};break;case al.A.geom.POINT:case al.A.geom.MULTIPOINT:r.styles={point:t,line:!1,polygon:!1};break;default:r.styles={line:t,point:!1,polygon:!1}}return r};bm.A.wrap.control.Draw.prototype.setStyle=function(){const e=this;if(e.interaction){let t;const r=e.parent.getStyle();if(r){const n=e.parent.mode,i=ov(n,r),o=Uy(i);let a,s;if(e.parent.styles.snapping?.point){if(e.parent.extensibleSketch&&(n===al.A.geom.POLYLINE||n===al.A.geom.MULTIPOLYLINE)){const t=Uy({styles:Object.assign({},i.styles,{point:Object.assign({},e.parent.styles.snapping.point,{label:"+",fontSize:12,labelOffset:[8,-8]})})});s=r=>{if(!e.sketch&&e.parent.layer.wrap.layer.getSource().getFeatures().map((e=>e.getGeometry())).filter((e=>e instanceof ol.geom.LineString||e instanceof ol.geom.MultiLineString)).some((e=>{const t=e.getLastCoordinate();return r[0]===t[0]&&r[1]===t[1]})))return t}}if(e.parent.snapping||e.parent.extensibleSketch){const t=Uy({styles:Object.assign({},i.styles,{point:Object.assign({},e.parent.styles.snapping.point)})});a=()=>t}(a||s)&&(t=function(){if(e.snapInteraction?._snapData){const t=e.snapInteraction._snapData.vertex,r=s?.(t)||a(t);if(r)return r}return o})}t||(t=o),e.interaction.overlay_.setStyle(t)}}else e.interaction3D&&e.interaction3D.setStyle(e.parent.getStyle())},bm.A.wrap.control.Draw.prototype.setVisibility=function(e){const t=this;t.interaction&&t.interaction.getOverlay().setVisible(e),t.interaction3D&&t.interaction3D.visibility(e)},bm.A.wrap.control.OfflineMapMaker.prototype.getRequestSchemas=function(e){for(var t=e.extent,r=e.layers,n=new Array(r.length),i=0,o=n.length;i<o;i++){var a=r[i],s={layerId:a.id,tileMatrixSet:a.matrixSet},l=a.wrap.layer.getSource();if(l.getUrls&&(s.url=l.getUrls()[0]),l.getTileGrid){for(var c=l.getTileGrid(),u=c.getResolutions(),h=c.getMatrixIds(),d=a.getLayerNodeByName(a.layerNames),p=null,g=0,f=d.TileMatrixSetLink.length;g<f;g++){var m=d.TileMatrixSetLink[g];if(m.TileMatrixSet===a.matrixSet){p=m.TileMatrixSetLimits;break}}s.tileMatrixLimits=[],u.forEach((function(e,r){var n=c.getOrigin(r),i=c.getTileSize(r),o=i*e,a={mId:h[r],res:e,origin:n,tSize:i,cl:Math.floor((t[0]-n[0])/o),cr:Math.floor((t[2]-n[0])/o),rt:Math.floor((n[1]-t[3])/o),rb:Math.floor((n[1]-t[1])/o)};if(p){var l=p[r];l&&(a.cl=Math.max(a.cl,l.MinTileCol),a.cr=Math.min(a.cr,l.MaxTileCol),a.rt=Math.max(a.rt,l.MinTileRow),a.rb=Math.min(a.rb,l.MaxTileRow))}a.cl<=a.cr&&a.rt<=a.rb&&s.tileMatrixLimits.push(a)}))}n[i]=s}return n},bm.A.wrap.control.OfflineMapMaker.prototype.getGetTilePattern=function(e){var t="",r=e.wrap.layer.getSource();return r.getUrls&&(t=r.getUrls()[0]),e.options.encoding!==al.A.WMTSEncoding.RESTFUL&&(t.indexOf("?")<0&&(t+="?"),t.indexOf("?")===t.length-1&&(t=t+"layer="+e.layerNames+"&style=default&tilematrixset="+encodeURIComponent(e.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(e.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")),t};const av=function(e){return new ol.style.Stroke({color:"#ffffff",width:e+4})},sv=function(e){return new ol.style.Stroke({color:"#000000",width:e+6})},lv=function(e){e||(e=[]),e instanceof ol.style.Style&&(e=[e]);const t=(e=e.slice())[0];if(t){const n=t.getImage();var r;if(n instanceof ol.style.RegularShape){r=n.getStroke()?.getWidth()||0;const i=n.getRadius(),o=t.clone();o.setImage(new ol.style.Circle({radius:i,stroke:av(r)})),e.unshift(o);const a=t.clone();a.setImage(new ol.style.Circle({radius:i,stroke:sv(r)})),e.unshift(a)}const i=t.getStroke();return i&&(r=i.getWidth(),e.unshift(new ol.style.Style({stroke:av(r)})),e.unshift(new ol.style.Style({stroke:sv(r)}))),e}return null},cv=function(e){hv.call(e),e.changed()},uv=function(e){Object.prototype.hasOwnProperty.call(e,"_originalStyle")&&e._originalStyle&&e.setStyle(e._originalStyle),delete e._originalStyle},hv=function(){this.style_=function(e){let t=e._originalStyle=e._originalStyle||e.getStyle();return!e._originalStyle&&e._wrap.parent.layer&&(t=e._originalStyle=e._wrap.parent.layer.wrap.layer.getStyle()),t||(t=e._originalStyle=Uy({styles:{}},e)),Eh.A.isFunction(t)?function(e,r){return lv(t(e,r)).map((e=>(e.setZIndex((e.getZIndex()||0)+1),e)))}:lv(t)?.map((e=>(e.setZIndex((e.getZIndex()||0)+1),e)))}(this),this.styleFunction_=this.style_?ol.Feature.createStyleFunction(this.style_):void 0};bm.A.wrap.control.Modify.prototype.activate=function(){const e=this;e.parent.map&&Promise.all([e.parent.map.wrap.getMap(),e.parent.layer.wrap.getLayer()]).then((function(t){const r=t[0],n=t[1],i=e.parent.mode===e.parent.constructor.mode.VERTEX_DELETE,o={layers:[n],hitTolerance:uy,style:null};e.selectInteraction&&(o.features=e.selectInteraction.getFeatures(),i&&(o.condition=$e),r.removeInteraction(e.selectInteraction));var a=null;e.parent.map.on3DView?((a=e.selectInteraction||new e.parent.map.view3D.UI.SelectControl).activate(i),e.selectInteraction=a):(a=new ol.interaction.Select(o),e.selectInteraction=a,r.addInteraction(a));var s=function(e){return e._wrap.parent};a.on("select",(function(t){t.selected.length>0&&e.parent.trigger(al.A.event.FEATURESSELECT,{ctrl:e,features:t.selected.map(s)}),t.deselected.length>0&&0===t.selected.length&&e.parent.trigger(al.A.event.FEATURESUNSELECT,{ctrl:e.parent,features:t.deselected.map(s)})})),e.modifyInteraction&&r.removeInteraction(e.modifyInteraction);const l={features:a.getFeatures()};i&&(l.deleteCondition=ze);var c=new ol.interaction.Modify(l);if(i){let t;c.on("modifystart",(function(e){"click"===e.mapBrowserEvent.type&&(t=e.features.item(0).getRevision())})),c.on("modifyend",(function(r){"click"===r.mapBrowserEvent.type&&r.features.item(0).getRevision()===t&&e.parent.map.toast(e.parent.getLocaleString("verticesCannotBeDeleted"),{type:al.A.msgType.ERROR})}))}if(e._modifiedGeometries=e._modifiedGeometries||new WeakMap,c.on("modifystart",(function(t){t.features.forEach((function(t){e._modifiedGeometries.set(t,t.getGeometry().getFlatCoordinates().slice())}))})),c.on("modifyend",(function(t){t.features.forEach((function(t){const r=t.getGeometry();if(r.stride>2){const i=e._modifiedGeometries.get(t);if(i){const e=r.getFlatCoordinates();if(i.length<=e.length)for(var n=0;n<e.length;n+=r.stride){const t=n+1;if(e[n]!==i[n]||e[t]!==i[t]){e[t+1]=null;break}}}}t._wrap.parent.geometry=t._wrap.getGeometry(),e.parent.trigger(al.A.event.FEATUREMODIFY,{feature:t._wrap.parent,layer:e.parent.layer,geometryChanged:!0})}))})),e.modifyInteraction=c,r.addInteraction(c),e.snapInteraction&&r.removeInteraction(e.snapInteraction),e.parent.snapping){if(e.snapInteraction=new ol.interaction.Snap({source:n.getSource()}),e.parent.styles.snapping?.point){const t=Uy({styles:Object.assign({point:Object.assign({},e.parent.styles.snapping.point)})}),r=function(){return e.snapInteraction?._snapData?t:null};e.modifyInteraction.getOverlay().setStyle(r)}r.addInteraction(e.snapInteraction)}e._onMouseMove||(e._onMouseMove=function(t){const n=r.getViewport();var i,o=r.getEventPixel(t);i=r.forEachFeatureAtPixel(o,(function(t,r){return!(!e.parent.layer||r!==e.parent.layer.wrap.layer)}),{hitTolerance:uy}),n.style.cursor=i?"pointer":""}),r.getViewport().addEventListener(Bm,e._onMouseMove)}))},bm.A.wrap.control.Modify.prototype.deactivate=function(){const e=this;if(e.modifyInteraction){e.modifyInteraction.setActive(!1),e.selectInteraction.setActive(!1);const t=e.modifyInteraction.getMap();t.getViewport().removeEventListener(Bm,e._onMouseMove),t.removeInteraction(e.modifyInteraction),t.removeInteraction(e.selectInteraction),e.modifyInteraction=null,e.selectInteraction=null}},bm.A.wrap.control.Modify.prototype.getSelectedFeatures=function(){var e=[];return this.selectInteraction&&this.selectInteraction.getFeatures().forEach((function(t){e.push(t._wrap.parent)})),e},bm.A.wrap.control.Modify.prototype.setSelectedFeatures=function(e){var t=this;t.selectInteraction&&(t.selectInteraction.features_.clear(),t.selectInteraction.features_.extend(e.map((e=>e.wrap.feature))))},bm.A.wrap.control.Modify.prototype.unselectFeatures=function(e){e=e||[];const t=this,r=t.selectInteraction?t.selectInteraction.getFeatures():null;if(r){const n=[];r.getArray().slice().forEach((function(t){(!e.length||e.indexOf(t)>=0)&&(r.remove(t),n.push(t._wrap.parent))})),n.length&&t.parent.trigger(al.A.event.FEATURESUNSELECT,{features:n})}},bm.A.wrap.control.Edit.prototype.cancel=function(e,t){var r=this;if(r.points=[],r.histPoints=[],r.selectInteraction){var n=r.selectInteraction.getFeatures();r.parent.trigger(al.A.event.FEATURESUNSELECT,{ctrl:r.parent,feature:n.get(0)}),n.clear(),r.selectInteraction.setActive(!1)}},bm.A.wrap.control.Edit.prototype.deleteFeatures=function(e){var t=this;if(Array.isArray(e)){var r=e.map((function(e){return e.wrap.feature}));t.parent.layer.wrap.getLayer().then((function(e){for(var n=t.selectInteraction?t.selectInteraction.getFeatures():null,i=0,o=r.length;i<o;i++){var a=r[i];n&&(n.remove(a),t.parent.trigger(al.A.event.FEATURESUNSELECT,{feature:a._wrap.parent})),e.getSource().removeFeature(a),t.parent.trigger(al.A.event.FEATUREREMOVE,{feature:a._wrap.parent})}}))}},bm.A.wrap.Feature.prototype.toGML=function(e,t){var r=new ol.format.GML({srsName:t}).writeGeometryNode(this.feature.getGeometry()),n=r.querySelector("MultiSurface,MultiPolygon,Polygon");return n&&n.querySelectorAll("Polygon,LinearRing").forEach((e=>e.removeAttribute("srsName"))),r.firstChild.setAttribute("gml:id",r.firstChild.tagName+"."+bm.A.getUID()),(new XMLSerializer).serializeToString(r.firstChild).replace(/\<\/?\w/gm,(function(e){var t=e.indexOf("/")>0?e.indexOf("/")+1:1;return e.substring(0,t)+"gml:"+e.substring(t)}))},bm.A.wrap.Feature.prototype.toGeoJSON=function(){return(new ol.format.GeoJSON).writeGeometry(this.feature.getGeometry())},bm.A.wrap.Geometry.write=function(e={}){var t;switch(e.format,e.parser=new ol.format.GeoJSON,e.type){case al.A.geom.POLYLINE:t=new ol.geom.LineString(e.coordinates);break;case al.A.geom.POLYGON:t=new ol.geom.Polygon(e.coordinates);break;case al.A.geom.MULTIPOINT:t=new ol.geom.MultiPoint(e.coordinates);break;case al.A.geom.MULTIPOLYLINE:t=new ol.geom.MultiLineString(e.coordinates);break;case al.A.geom.MULTIPOLYGON:t=new ol.geom.MultiPolygon(e.coordinates);break;case al.A.geom.POINT:default:t=new ol.geom.Point(e.coordinates)}return e.parser.writeGeometry(t)},bm.A.wrap.Geometry.toGeoJSON=function(e){return bm.A.wrap.Geometry.write(e)};const dv=Tm.A},1217:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var n=r(6514),i=r(915),o=r(2096),a=r(3953),s=r(2497),l=r(6361),c=r(9969),u=r(4350),h=r(904),d=r(1374),p=r(3671);class g extends o.Ay{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}appendCoordinate(e){(0,n.X$)(this.flatCoordinates,e),this.changed()}clone(){const e=new g(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,n){return n<(0,i.Ld)(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,a.MD)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,a.n)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,r,n))}forEachSegment(e){return(0,d.j)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return"XYM"!=this.layout&&"XYZM"!=this.layout?null:(t=void 0!==t&&t,(0,c.gr)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return(0,l.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return(0,c.SH)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return(0,h.k)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=(0,p.P4)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new g(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return(0,u.gp)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,this.getExtent())}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,s.z2)(this.flatCoordinates,0,e,this.stride),this.changed()}}const f=g},1256:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(8038),i=r(797),o=r(3301),a=r(187),s=r(3408),l=r(153),c=r(7585);n.A.i18n=n.A.i18n||l.A,n.A._hbs=c.A,n.A.control=n.A.control||{},n.A.Control=function(){const e=this;s.A.call(e),e.map=null,e.isActive=!1,e.isDisabled=!1;var t=arguments.length;e.options=e.mergeOptions(t>1?arguments[1]:arguments[0]),e.id=e.options.id||n.A.getUID({prefix:e.CLASS.substr(n.A.Control.prototype.CLASS.length+1)+"-"}),e.div=o.A.getDiv(e.options.div?e.options.div:arguments[0]),e.div.classList.add(u.prototype.CLASS,e.CLASS),e.template=e.options.template||e.template,e.exportsState=!1},n.A.inherit(n.A.Control,s.A),function(){const e=n.A.Control.prototype;e.CLASS="tc-ctl",e.template=void 0,e.show=function(){this.div.style.display=""},e.hide=function(){this.div.style.display="none",this.unhighlight()},e.render=function(e){const t=this;return t.renderData(null,(function(){t.addUIEventListeners(),"function"==typeof e&&e()}))},e.loadTemplates=async function(){},e.mergeOptions=function(...e){return o.A.extend({},...e)},e.renderData=async function(e,t){const r=this;let n;r.map&&r.trigger(i.A.event.BEFORECONTROLRENDER,{dataObject:e}),r.div.classList.toggle(i.A.classes.DISABLED,r.isDisabled),r.template||await r.loadTemplates(),"object"!=typeof r.template||r.template.compiler?(n=r.template,r.template={},r.template[r.CLASS]=n):n=r.template[r.CLASS];const a=r.getRenderedHtml(r.CLASS,e);r._firstRender??=a;const s=await a;r.div.innerHTML=s,r.map&&r.trigger(i.A.event.CONTROLRENDER),o.A.isFunction(t)&&t()},e.getRenderedHtml=async function(e,t,r){const i=this,a=function(e){if(void 0===e)return"";const n=e(t);return o.A.isFunction(r)&&r(n),n};i.template||await i.loadTemplates();const s=i.template[e];return"function"!=typeof s?(await async function(e,t={}){const r=[];for(var i in e){const t=i;let o=e[t];"string"==typeof o?r.push(new Promise((function(r,i){n.A.ajax({url:o,method:"GET",responseType:"text"}).then((function(n){e[t]=o=c.A.compile(n.data),r(o)})).catch((function(e){console.log("Error fetching template: "+e),i(e)}))}))):"object"==typeof o&&(e[i]=o=c.A.template(o))}for(var o in await Promise.all(r),e)e[o]&&o!==t.className&&c.A.registerPartial(o,e[o])}(i.template,{locale:i.map&&i.map.options.locale,className:i.CLASS}),a(i.template[e])):a(s)},e.register=async function(e){const t=this;return t.map=e,await t.render(),t.options.active&&t.activate(),t},e.activate=function(){const e=this;e.map&&e.map.activeControl&&e.map.activeControl!==e&&(e.map.previousActiveControl=e.map.activeControl,e.map.activeControl.deactivate()),e.isActive=!0,e.map&&(e.map.activeControl=e,e.map.trigger(i.A.event.CONTROLACTIVATE,{control:e}),e.trigger(i.A.event.CONTROLACTIVATE,{control:e}))},e.deactivate=function(e){0===arguments.length&&(e=!1);const t=this;if(t.isActive=!1,t.map){if(t.map.activeControl=null,!e){var r=t.map.getDefaultControl();r===t||t.map.previousActiveControl===t?r=null:r||(r=t.map.previousActiveControl),r&&r.activate()}t.map.trigger(i.A.event.CONTROLDEACTIVATE,{control:t}),t.trigger(i.A.event.CONTROLDEACTIVATE,{control:t})}},e.enable=function(){const e=this;e.isDisabled=!1,e.div&&(e.div.classList.remove(i.A.classes.DISABLED),delete e.div.dataset.tcMessage),e.containerControl&&e.containerControl.onControlEnable&&e.containerControl.onControlEnable(e)},e.disable=function(e={}){const t=this;if(t.isDisabled=!0,t.div){t.div.classList.add(i.A.classes.DISABLED);let r=t.getLocaleString("disabledControl");e.reason&&(r=`${r} - ${e.reason}`),t.div.dataset.tcMessage=r}t.containerControl&&t.containerControl.onControlDisable&&t.containerControl.onControlDisable(t)},e.highlight=function(){const e=this;e.div&&e.div.classList.add(i.A.classes.HIGHLIGHTED),e.map&&e.map.trigger(i.A.event.CONTROLHIGHLIGHT,{control:e})},e.unhighlight=function(){const e=this;e.div&&e.div.classList.remove(i.A.classes.HIGHLIGHTED),e.map&&e.map.trigger(i.A.event.CONTROLUNHIGHLIGHT,{control:e})},e.isHighlighted=function(){return!!this.div&&this.div.classList.contains(i.A.classes.HIGHLIGHTED)},e.renderPromise=function(){const e=this;return e._firstRender||new Promise((function(t,r){e.one(i.A.event.CONTROLRENDER,(function(){t(e)}))}))},e.addUIEventListener=function(e,t,r){(e?this.div.querySelectorAll(e):[this.div]).forEach((function(e){e.addEventListener(t,r)}))},e.addUIEventListeners=function(){return this},e.isExclusive=function(){return!1},e.getLocaleString=function(e,t){var r=this.map?this.map.options.locale:a.A.locale;return o.A.getLocaleString(r,e,t)},e.getId=function(){return this.id},e.getUID=function(){return n.A.getUID({prefix:this.id+"-"})},e.exportState=function(){return this.exportsState?{}:null},e.importState=function(e){},e.getDownloadDialog=async function(){const e=this;return e._downloadDialog=e._downloadDialog||e.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],e._downloadDialog||(e._downloadDialog=await e.map.addControl("FeatureDownloadDialog")),e._downloadDialog.caller=e,e._downloadDialog},e.getElevationTool=async function(){const e=this;if(!e.displayElevation&&!e.options.displayElevation)return null;if(e.elevation)return e.elevation;if(n.A.tool.Elevation||await Promise.resolve().then(r.bind(r,4363)),"boolean"==typeof e.options.displayElevation)if(e.map){const t=await e.map.getElevationTool();e.elevation=t||new n.A.tool.Elevation}else e.elevation=new n.A.tool.Elevation;else if(e.map){const t=await e.map.getElevationTool();e.elevation=t?new n.A.tool.Elevation(o.A.extend(!0,{},t.options,e.options.displayElevation)):new n.A.tool.Elevation(e.options.displayElevation)}else e.elevation=new n.A.tool.Elevation(e.options.displayElevation);return e.elevation},e.updateLanguage=async function(){return!0}}(),n.A.Control.create=async function(e,t){const i=e.substr(0,1).toUpperCase()+e.substr(1);if(!n.A.control[i]){const e=await r(9797)("./"+i);n.A.control[i]=e.default}return new n.A.control[i](void 0,t)};var u=n.A.Control;const h=u},1302:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(1256),a=r(3301),s=r(5777),l=r(3791);n.A.control=n.A.control||{};const c="undefined"!=typeof window&&void 0!==window.document?window.document:{};class u{constructor(){this["fscreen.tip"]=""}}class h extends o.A{#L=!1;async register(e){const t=this;await super.register.call(t,e),t.model=new u;const r=t.div.querySelector("."+t.CLASS+"-btn");if(c.fullscreenEnabled){const e=()=>{const e=r.classList.toggle(i.A.classes.ACTIVE,t.isFullScreen()||t.isElementFullScreen())?t.isElementFullScreen()?"fscreen.tip.return":"fscreen.tip.keyboard":"fscreen.tip";r.setAttribute("title",t.getLocaleString(e))};c.addEventListener("fullscreenchange",e,!1),r.addEventListener("click",(function(){t.#L=!0,t.isFullScreen()?c.exitFullscreen():c.body.requestFullscreen()}),!1),a.A.detectMobile()||window.addEventListener("resize",(()=>{if(t.#L)return void(t.#L=!1);e();let n=c.body.getElementsByTagName("header");t.isFullScreen()?(t.isElementFullScreen()||(r.disabled=!0),n.length>0&&n[0].classList.add(t.CLASS+"-to-header"),t.map.div.classList.add(t.CLASS+"-to-map"),t.map.view3D&&t.map.view3D.container.classList.add(t.CLASS+"-to-map")):(r.disabled=!1,n.length>0&&n[0].classList.remove(t.CLASS+"-to-header"),t.map.div.classList.remove(t.CLASS+"-to-map"),t.map.view3D&&t.map.view3D.container.classList.remove(t.CLASS+"-to-map"));const i=c.createEvent("HTMLEvents");i.initEvent("resize",!1,!1),t.map.div.dispatchEvent(i)}))}else t.disable();return t.renderPromise().then((function(){t.controller=new s.A(t.model,new l.A(t.div)),t.updateModel()})),t}isFullScreen(){const e=window.innerWidth*window.devicePixelRatio,t=window.innerHeight*window.devicePixelRatio,r=window.screen.width,n=window.screen.height;return e/r>=.95&&t/n>=.95}isElementFullScreen(){return null!==c.fullscreenElement}async loadTemplates(){const e=await r.e(9871).then(r.bind(r,9871));this.template=e.default}updateModel(){this.model["fscreen.tip"]=this.getLocaleString("fscreen.tip")}async updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-fscreen",n.A.control.FullScreen=h;const d=h},1374:(e,t,r)=>{"use strict";function n(e,t,r,n,i){let o;for(t+=n;t<r;t+=n)if(o=i(e.slice(t-n,t),e.slice(t,t+n)),o)return o;return!1}function i(e,t){const[r,n]=e,[i,o]=t,a=((r[0]-i[0])*(i[1]-o[1])-(r[1]-i[1])*(i[0]-o[0]))/((r[0]-n[0])*(i[1]-o[1])-(r[1]-n[1])*(i[0]-o[0])),s=((r[0]-i[0])*(r[1]-n[1])-(r[1]-i[1])*(r[0]-n[0]))/((r[0]-n[0])*(i[1]-o[1])-(r[1]-n[1])*(i[0]-o[0]));if(0<=a&&a<=1&&0<=s&&s<=1)return[r[0]+a*(n[0]-r[0]),r[1]+a*(n[1]-r[1])]}r.d(t,{i:()=>i,j:()=>n})},1386:(e,t,r)=>{"use strict";r.d(t,{A:()=>S,M:()=>y});var n=r(6717),i=r(6514),o=r(7430),a=r(1217),s=r(2809),l=r(6702),c=r(503),u=r(2871),h=r(4294),d=r(4142),p=r(7947),g=r(3942),f=r(8217),m=r(4165);const y="http://www.opengis.net/gml",v=/^\s*$/;class A extends m.A{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:(0,g.VT)(this.readFeaturesInternal),featureMembers:(0,g.Tb)(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const r=e.localName;let n=null;if("FeatureCollection"==r)n=(0,g.eY)([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==r||"featureMember"==r||"member"==r){const i=t[0];let o=i.featureType,a=i.featureNS;const s="p",l="p0";if(!o&&e.childNodes){o=[],a={};for(let t=0,r=e.childNodes.length;t<r;++t){const r=e.childNodes[t];if(1===r.nodeType){const e=r.nodeName.split(":").pop();if(!o.includes(e)){let t="",n=0;const i=r.namespaceURI;for(const e in a){if(a[e]===i){t=e;break}++n}t||(t=s+n,a[t]=i),o.push(t+":"+e)}}}"featureMember"!=r&&(i.featureType=o,i.featureNS=a)}if("string"==typeof a){const e=a;a={},a[l]=e}const c={},u=Array.isArray(o)?o:[o];for(const e in a){const t={};for(let n=0,i=u.length;n<i;++n)(u[n].includes(":")?u[n].split(":")[0]:l)===e&&(t[u[n].split(":").pop()]="featureMembers"==r?(0,g.VT)(this.readFeatureElement,this):(0,g.Tb)(this.readFeatureElement,this));c[a[e]]=t}n="featureMember"==r||"member"==r?(0,g.eY)(void 0,c,e,t):(0,g.eY)([],c,e,t)}return null===n&&(n=[]),n}readGeometryOrExtent(e,t){const r=t[0];return r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),(0,g.eY)(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const r=t[0],n=this.readGeometryOrExtent(e,t);return n?(0,f.zU)(n,r):void 0}readGeometryElement(e,t){const r=t[0],n=this.readGeometryOrExtent(e,t);return n?(0,f.hX)(n,!1,r):void 0}readFeatureElementInternal(e,t,r){let i;const a={};for(let n=e.firstElementChild;n;n=n.nextElementSibling){let e;const s=n.localName;0===n.childNodes.length||1===n.childNodes.length&&(3===n.firstChild.nodeType||4===n.firstChild.nodeType)?(e=(0,g.mT)(n,!1),v.test(e)&&(e=void 0)):(r&&(e="boundedBy"===s?this.readExtentElement(n,t):this.readGeometryElement(n,t)),e?"boundedBy"!==s&&(i=s):e=this.readFeatureElementInternal(n,t,!1));const l=n.attributes.length;if(l>0&&!(e instanceof o.A)){e={_content_:e};for(let t=0;t<l;t++)e[n.attributes[t].name]=n.attributes[t].value}a[s]?(a[s]instanceof Array||(a[s]=[a[s]]),a[s].push(e)):a[s]=e}if(!r)return a;const s=new n.A(a);i&&s.setGeometryName(i);const l=e.getAttribute("fid")||(0,g.I8)(e,this.namespace,"id");return l&&s.setId(l),s}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new h.A(r,"XYZ")}readMultiPoint(e,t){const r=(0,g.eY)([],this.MULTIPOINT_PARSERS,e,t,this);if(r)return new c.A(r)}readMultiLineString(e,t){const r=(0,g.eY)([],this.MULTILINESTRING_PARSERS,e,t,this);if(r)return new l.A(r)}readMultiPolygon(e,t){const r=(0,g.eY)([],this.MULTIPOLYGON_PARSERS,e,t,this);if(r)return new u.A(r)}pointMemberParser(e,t){(0,g.UN)(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){(0,g.UN)(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){(0,g.UN)(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new a.A(r,"XYZ")}readFlatLinearRing(e,t){const r=(0,g.eY)(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(r)return r}readLinearRing(e,t){const r=this.readFlatCoordinatesFromNode(e,t);if(r)return new s.A(r,"XYZ")}readPolygon(e,t){const r=(0,g.eY)([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(r&&r[0]){const e=r[0],t=[e.length];let n,o;for(n=1,o=r.length;n<o;++n)(0,i.X$)(e,r[n]),t.push(e.length);return new d.Ay(e,"XYZ",t)}}readFlatCoordinatesFromNode(e,t){return(0,g.eY)(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){return this.readGeometryElement(e,[this.getReadOptions(e,t||{})])||null}readFeaturesFromNode(e,t){const r={featureType:this.featureType,featureNS:this.featureNS};return r&&Object.assign(r,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[r])||[]}readProjectionFromNode(e){return(0,p.Jt)(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}A.prototype.namespace=y,A.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}},A.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}},A.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}},A.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:(0,g.VT)(A.prototype.pointMemberParser),pointMembers:(0,g.VT)(A.prototype.pointMemberParser)}},A.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:(0,g.VT)(A.prototype.lineStringMemberParser),lineStringMembers:(0,g.VT)(A.prototype.lineStringMemberParser)}},A.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:(0,g.VT)(A.prototype.polygonMemberParser),polygonMembers:(0,g.VT)(A.prototype.polygonMemberParser)}},A.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:(0,g.VT)(A.prototype.readFlatCoordinatesFromNode)}},A.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:(0,g.VT)(A.prototype.readLineString)}},A.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:(0,g.VT)(A.prototype.readPolygon)}},A.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:(0,g.Tb)(A.prototype.readFlatLinearRing)}};const S=A},1421:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(8991);n.A.control=n.A.control||{};class l extends a.A{async register(e){return await super.register.call(this,e),this.QR_MAX_URL_LENGTH=150,this.SHORTEN_URL_LENGTH=16e3,this.exportsState=!1,this.includeControls=void 0===this.options.includeControls||this.options.includeControls,this}exportControlStates(){return this.map?this.map.exportControlStates():[]}importControlStates(e){this.map&&this.map.importControlStates(e)}exportState(){if(this.exportsState){const e={};if(this.featureToShare||this.sharedFeaturesLayer){let t;if(e.id=this.id,this.featureToShare){const e=this.featureToShare.clone();e.showsPopup=!0,t=this.featureToShare.layer.exportState({features:[e]})}else t=this.sharedFeaturesLayer.exportState();e.features=t.features,t.crs&&(e.crs=t.crs)}return e}return null}async importState(e){if(this.map&&e.features.length){const t=await this.map.addLayer({id:this.getUID(),owner:this,type:i.A.layerType.VECTOR,title:this.getLocaleString("foi"),stealth:!0});this.sharedFeaturesLayer=t,await t.importState({features:e.features,crs:e.crs}),this.map.zoomToFeatures(t.features)}}manageMaxLengthExceed(){throw"Falta implementación del método manageMaxLengthExceed"}async generateLink(){var e=window.location.href,t=e.indexOf("#");if(t>0&&(e=e.substring(0,t)),this.extraParams){var r=o.A.getQueryStringParams(e);o.A.extend(r,this.extraParams);var n=e.indexOf("?");n>=0&&(e=e.substring(0,n)),e=e.concat("?",o.A.getParamString(r))}else{var a=e.indexOf("?");a>0&&(e=e.replace(e.substring(a),""))}const s=this.includeControls?this.exportControlStates():[];!this.includeControls&&this.exportsState&&(this.featureToShare||this.sharedFeaturesLayer||this.caller&&this.caller.toShare)&&(this.caller&&this.caller.toShare?s.push(this.caller.exportState()):s.push(this.exportState()));const l=s.length?{ctl:s}:void 0;var c=await this.map.getMapState({extraStates:l,cacheResult:this.includeControls}),u=e.concat("#",c);return this.manageMaxLengthExceed({browser:u.length>i.A.URL_MAX_LENGTH,qr:u.length>this.SHORTEN_URL_LENGTH}),u}async shortenedLink(){const e=()=>(this.map.toast(this.getLocaleString("urlTooLongForShortener"),{type:i.A.msgType.ERROR}),"");return await(this.map?.wait((async()=>{const t=await this.generateLink();if(t.length>this.QR_MAX_URL_LENGTH&&t.length<this.SHORTEN_URL_LENGTH){const r=await function(e){var t=new FormData;return t.append("url",e),new s.default(n.A.proxify,{allowedMixedContent:!1}).fetch("https://tinyurl.com/api-create.php",{type:"POST",data:t}).then((function(e){return e})).catch((function(e){return null}))}(t);return r&&r.responseText?r.responseText.replace("http://","https://"):e()}return t.length>=this.SHORTEN_URL_LENGTH?e():""})))}async makeQRCode(e,t){const n=r.e(7583).then(r.t.bind(r,7583,19)),i=await this.shortenedLink()||"";if(i.length>0){const r={text:i,margin:2};t&&(r.width=t),e.innerHTML="";const o=document.createElement("img"),{default:a}=await n;return o.src=await a.toDataURL(i,r),e.appendChild(o),o.src}}drawScaleBarIntoCanvas(e={}){let t,r=this.map.getControlsByClass(n.A.control.ScaleBar);if(0===r.length)return null;t=e.canvas?e.canvas:document.createElement("CANVAS");var i=t.getContext("2d");i.save();var a,s,l=document.getElementsByClassName("ol-scale-line-inner").item(0),c=o.A.extend({},l.getBoundingClientRect()),u=l.textContent;i.beginPath(),i.strokeStyle=window.getComputedStyle(l).borderColor,c.width>c.height?(a=c.width,s=c.height):(a=c.height,s=c.width),e.setSize&&(t.width=a,t.height=s),c.left=void 0!==e.left?e.left:15,c.top=void 0!==e.top?e.top:15,i.moveTo(c.left,c.top),i.lineTo(c.left,c.top+s),i.lineTo(c.left+a,c.top+s),i.lineTo(c.left+a,c.top),i.stroke();var h={x:c.left+a/2,y:c.top+s/2};return e.fill&&function(t,n,i){var a=document.getElementsByClassName(r[0].CLASS).item(0),s=o.A.extend({},a.getBoundingClientRect());s.left=(e.left||15)-2,s.top=e.top||15,s.top--,t.globalAlpha=.5,t.fillStyle=window.getComputedStyle(a).backgroundColor,n+=4,i+=4,t.fillRect(s.left,s.top,n,i)}(i,a,s),i.globalAlpha=1,i.fillStyle=void 0!==e.textColor?e.textColor:window.getComputedStyle(l).color,i.font=void 0!==e.font?e.font:window.getComputedStyle(l).fontSize+" "+window.getComputedStyle(l).fontFamily,i.textAlign="center",i.textBaseline="middle",i.fillText(u,h.x,h.y),t}registerListeners(){const e=this;if(!e.registeredListeners){let t;const r=function(r){clearTimeout(t),t=setTimeout((function(){delete e.map._controlStatesCache,e.renderPromise().then((function(){e.generateLink()}))}),100)};e.map.on(i.A.event.LAYERADD,r).on(i.A.event.LAYERREMOVE,r).on(i.A.event.FEATUREADD,r).on(i.A.event.FEATUREREMOVE+" "+i.A.event.FEATURESCLEAR,r),e.registeredListeners=!0}}async generateImage(e,t,r){const n=this;var i=n.map.wrap.getCanvas(),a=i.length>1?o.A.mergeCanvases(i):o.A.cloneCanvas(i[0]);if(r){const e="qrcode";var s=document.getElementById(e);s?s.innerHTML="":((s=document.createElement("div")).setAttribute("id",e),document.body.appendChild(s)),s.style.top="-200px",s.style.left="-200px",s.style.position="absolute";const t=await n.makeQRCode(s,87);if(!t)throw"Error generando QR";var l=a.getContext("2d");l.fillStyle="#ffffff",l.fillRect(a.width-91,a.height-91,91,91),a=await o.A.addToCanvas(a,t,{x:a.width-88,y:a.height-88})}return t?o.C.getBlobPromise(a,e):o.C.getDataURL(a,e)}}l.prototype.CLASS="tc-ctl-mi",n.A.control.MapInfo=l;const c=l},1535:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _TC__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8038),_Consts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(797),_Util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3301),_InfoDisplay__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9105),_SITNA_feature_Point__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7018),_itemToolContainer__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(575),_SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4370),_Controller__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5777),_Observer__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(3791);!function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e}(),_TC__WEBPACK_IMPORTED_MODULE_0__.A.control=_TC__WEBPACK_IMPORTED_MODULE_0__.A.control||{},_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.DRAWCHART="drawchart.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.DRAWTABLE="drawtable.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELMIN="resultspanelmin.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELMAX="resultspanelmax.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELCLOSE="resultspanelclose.tc",_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELRESIZE="resultspanelresize.tc";const isElementVisible=function(e){const t=getComputedStyle(e);return e&&!e.hidden&&"none"!==t.display&&"hidden"!==t.visibility},hideResizeHandlers=function(e){document.querySelectorAll("."+e.CLASS+"-resize-handler").forEach((e=>{e.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN)}))},formatYAxis=function(e,t){return(parseInt(e.toFixed(0))||0).toLocaleString(t)+" m"},collidingManagement={add:function(e){const t=e.div.querySelector(".tc-ctl-rpanel-sidebar-body");t.style.bottom="";const r=e.map.getControlsByClass(ResultsPanel).filter((t=>t.content===t.contentType.TABLE&&t!==e)).filter((e=>t.colliding(e.div.querySelector(".tc-ctl-rpanel-sidebar-body")))).reduce(((e,t)=>e+t.div.querySelector(".tc-ctl-rpanel-sidebar-body").clientHeight),0);r&&(t.style.bottom=r+"px")},remove:function(e){e.map.getControlsByClass(ResultsPanel).filter((t=>t.content===t.contentType.TABLE&&t!==e)).forEach((e=>{e.div.querySelector(".tc-ctl-rpanel-sidebar-body").style.bottom=""}))}},getTime=function(e,t){var r=t-e,n={},i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60,n.h=o+24*i;var a=Math.floor(r/1e3/60);return r-=1e3*a*60,n.m=a,n.s=Math.floor(r/1e3),_Util__WEBPACK_IMPORTED_MODULE_2__.A.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})};class ResultsPanelModel{constructor(){this.title="",this.close="",this.hide="",this.expand="",this.download="",this.shareQuery=""}}class ChartModel{constructor(){this["geo.trk.chart.elevationGain"]=""}}class ResultsPanel extends _InfoDisplay__WEBPACK_IMPORTED_MODULE_3__.default{COLLIDING_PRIORITY={IGNORE:0,LOW:1,MEDIUM:2,HIGH:3};CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};contentType={TABLE:{fnOpen:ResultsPanel.prototype.openTable,collapsedClass:`.${ResultsPanel.prototype.CLASS}-minimized-max-table`},CHART:{fnOpen:ResultsPanel.prototype.openChart,collapsedClass:`.${ResultsPanel.prototype.CLASS}-minimized-max-chart`}};#C;constructor(){super(...arguments);const e=this;e.#C=e.options.titles,e.wrap=new _TC__WEBPACK_IMPORTED_MODULE_0__.A.wrap.control.ResultsPanel(e),e.data={},e.classes={SHOW_IN:"tc-show-in",SHOW_OUT:"tc-show-out",RESIZABLE:"tc-resizable",POSITION_BOTTOM:"tc-pos-bottom",POSITION_TOP:"tc-pos-top"},e.content=e.contentType.TABLE,e._toolContainerSelector=`.${e.CLASS}-tools`,_Util__WEBPACK_IMPORTED_MODULE_2__.A.isEmptyObject(e.options)&&(e.options={content:"table"}),e.options,e.options.content&&(e.content=e.contentType[e.options.content.toUpperCase()]),e.options.chart&&(e.chart=e.options.chart),e.options.table&&(e.table=e.options.table),e.options.save&&(e.save=e.options.save),e.options.share&&(e.share=e.options.share),e.model=new ResultsPanelModel}isVisible(){const e=this.div.querySelector(".tc-ctl-rpanel-sidebar-body"),t=this.div.querySelector(".tc-ctl-rpanel-minimized-max");return isElementVisible(e)||isElementVisible(t)}isMinimized(){const e=this.div.querySelector(".tc-ctl-rpanel-sidebar-body"),t=this.div.querySelector(".tc-ctl-rpanel-minimized-max");return isElementVisible(t)&&!isElementVisible(e)}#b(e,t,r){const n=this.div.querySelector("."+e);n&&(n.classList.add(t),n.classList.remove(r))}show(e){const t=this.div.querySelector("."+e);t&&"none"===t.style.display&&(t.style.display=""),this.#b(e,this.classes.SHOW_IN,this.classes.SHOW_OUT)}hide(e){this.#b(e,this.classes.SHOW_OUT,this.classes.SHOW_IN);const t=this.div.querySelector("."+e);t&&(t.style.display="none")}doVisible(){this.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),this.show("tc-ctl-rpanel-sidebar-body")}async loadTemplates(){const e=this,t=__webpack_require__.e(935).then(__webpack_require__.bind(__webpack_require__,935)),r=__webpack_require__.e(756).then(__webpack_require__.bind(__webpack_require__,756)),n=__webpack_require__.e(2644).then(__webpack_require__.bind(__webpack_require__,2644)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-table"]=(await r).default,i[e.CLASS+"-chart"]=(await n).default,e.template=i}#T(e,t,r){const n=this;n.addItemTool({renderFn:function(r){const i=n.CLASS+e;let o=r.querySelector("sitna-button."+i);o&&(o.remove(),o=null);const a=n.getLocaleString(t);return o=new _SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_6__.A,o.variant=_SITNA_ui_Button__WEBPACK_IMPORTED_MODULE_6__.A.variant.MINIMAL,o.text=a,o.classList.add(i),n.model&&(o.text="[["+t+"]]",n.controller.add(o),n.model[t]=n.getLocaleString(t)),o},actionFn:r})}async render(e){const t=this;if(t.div.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),await super.render.call(t),t.minimizeButton=t.div.querySelector(".tc-ctl-rpanel-btn-min")||t.div.querySelector(".prcollapsed-slide-submenu-min"),t.minimizeButton.addEventListener("click",(function(){t.minimize()})),t.closeButton=t.div.querySelector(".tc-ctl-rpanel-btn-close")||t.div.querySelector(".prcollapsed-slide-submenu-close"),t.closeButton.addEventListener("click",(function(){t.close();const e=t.div.querySelector(`.${t.classes.RESIZABLE}.tc-ctl-rpanel-main`);e&&(e.style.removeProperty("width"),e.style.removeProperty("height"),delete e.dataset.chartSizeWidth,delete e.dataset.chartSizeHeight,delete e.dataset.panelSizeWidth,delete e.dataset.panelSizeHeight)})),t.maximizeButton=t.div.querySelector(".tc-ctl-rpanel-minimized-max")||t.div.querySelector(".prcollapsed-max"),t.maximizeButton.addEventListener("click",(function(){t.maximize()})),t.save&&t.#T("-btn-csv","export.excel",(function(){t.exportToExcel()})),t.options.download&&"table"===t.options.content&&t.#T("-btn-dwn","download",(function(){_Util__WEBPACK_IMPORTED_MODULE_2__.A.isFunction(t.options.download)&&t.options.download.apply(t,[])})),t.options.share&&t.#T("-btn-share","shareQuery",(function(){t.caller&&t.caller.showShareDialog()})),t.content&&(t.content=t.content,t.#C?t.setTitles(t.#C):t.model.title=t.getLocaleString("rsp.title")),t.infoDiv=t.div.querySelector(".tc-ctl-rpanel-info")||t.div.querySelector(".tc-ctl-p-result-info"),t.tableDiv=t.div.querySelector(".tc-ctl-rpanel-table")||t.div.querySelector(".tc-ctl-p-result-table"),t.menuDiv=t.div.querySelector(".tc-ctl-rpanel-menu")||t.div.querySelector(".tc-ctl-p-result-menu"),_TC__WEBPACK_IMPORTED_MODULE_0__.A.browserFeatures.touch()&&_Util__WEBPACK_IMPORTED_MODULE_2__.A.swipe(t.div,{left:function(){t.minimize()}}),_Util__WEBPACK_IMPORTED_MODULE_2__.A.detectMobile())hideResizeHandlers(t);else{const e=!(Object.prototype.hasOwnProperty.call(t.options,"resize")&&!t.options.resize);switch(!0){case"chart"===t.options.content&&e:case t.options.resize:case"table"===t.options.content&&t.infoDiv&&t.infoDiv.childElementCount>0&&e:t.resizable=!0,t.div.classList.add(t.classes.RESIZABLE);break;default:t.resizable=!1}}return e&&"function"==typeof e&&e(),t.controller=new _Controller__WEBPACK_IMPORTED_MODULE_7__.A(t.model,new _Observer__WEBPACK_IMPORTED_MODULE_8__.A(t.div)),t.updateModel(),t}setTitles(e={}){return e.main&&(this.model.title=e.main,this.#C.main=e.main),e.max&&(this.maximizeButton.setAttribute("title",e.max),this.#C.max=e.max),this}renderPanelResizable(e={}){const t=this;__webpack_require__.e(2617).then(__webpack_require__.t.bind(__webpack_require__,2617,23)).then((function(r){const n=r.default,i="."+t.classes.RESIZABLE,o=".tc-ctl-rpanel-main",a=e.target&&e.target.querySelector(o)||document.querySelector(o);if(a.classList.add(t.classes.RESIZABLE),a.closest(".tc-ctl-rpanel").classList.add(t.classes.RESIZABLE),!n.isSet(i)){const r=document.querySelector(".tc-chart.c3 svg");r&&(r.parentElement.style.maxHeight="unset",r.removeAttribute("max-height"),r.removeAttribute("max-width"),r.removeAttribute("min-height"),r.removeAttribute("min-width")),n(i).resizable({preserveAspectRatio:e.preserveAspectRatio||!0,edges:{right:".tc-ctl-rpanel-resize-handler",bottom:".tc-ctl-rpanel-resize-handler"},cursorChecker(e,t,r,n){let i="";return r.querySelectorAll(":hover").forEach((function(e){switch(!0){case e.classList.value.indexOf("tc-resizable-grid-handlerRight")>-1:i="w-resize";break;case e.classList.value.indexOf("tc-resizable-grid-handlerBottom")>-1:i="n-resize";break;case e.classList.value.indexOf("tc-resizable-grid-handlerDiagonal")>-1:i="nw-resize";break;default:i="pointer"}})),i},listeners:{end:function(e){t.onResize(e)},move(e){switch(!0){case"w-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.rect.width}px`,height:`${e.target.getBoundingClientRect().height}px`});break;case"nw-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.rect.width}px`,height:`${e.rect.height}px`});break;case"n-resize"===e.target.style.cursor:Object.assign(e.target.style,{width:`${e.target.getBoundingClientRect().width}px`,height:`${e.rect.height}px`})}e.target.querySelector(".tc-chart.c3")&&e.target.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.LOADING)}},modifiers:[n.modifiers.restrict({restriction:"body"})]}),e.callback&&_Util__WEBPACK_IMPORTED_MODULE_2__.A.isFunction(e.callback)&&e.callback()}}))}getResizableChartSize(e){if(e){let t=e.querySelector(".tc-chart.c3").getBoundingClientRect();return{width:t.width,height:t.height}}}getResultsPanelFromElement(e){let t=this.map.getControlsByClass(ResultsPanel);for(var r=0;r<t.length;r++)if(t[r].div.querySelector(`.${this.classes.RESIZABLE}.tc-ctl-rpanel-main`)===e)return t[r];return null}onResize(e){const t=this,r=e.target;if(r.querySelector(".tc-chart.c3")){r.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.LOADING);const e=t.getResizableChartSize(r);if(e){let n=t.getResultsPanelFromElement(r);if(n){n.chart.chart.resize(e);const r=t.div.querySelector(`.${t.classes.RESIZABLE}.tc-ctl-rpanel-main`);r.dataset.chartSizeWidth=e.width,r.dataset.chartSizeHeight=e.height}}}t.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELRESIZE,{control:t,size:{width:r.getBoundingClientRect().width,height:r.getBoundingClientRect().height}})}minimize(){const e=this,t=e.div.querySelector(e.content.collapsedClass);return t.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN)&&(t.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),e.hide("tc-ctl-rpanel-sidebar-body"),e.show("tc-ctl-rpanel-minimized-max"),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELMIN,{control:e}),collidingManagement.remove(e)),e}maximize(){const e=this,t=e.div.querySelector(e.content.collapsedClass);return t.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN)||(t.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),e.show("tc-ctl-rpanel-sidebar-body"),e.hide("tc-ctl-rpanel-minimized-max"),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELMAX,{control:e}),collidingManagement.add(e)),e}close(){const e=this;if(e.div.classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),e.chart&&e.chart.chart){const t=e.div.querySelector(`.${e.classes.RESIZABLE}.tc-ctl-rpanel-main`);if(t&&t.style&&t.style.width&&t.style.height){const e=t.querySelector(".tc-chart").getBoundingClientRect();parseInt(e.width)>0&&parseInt(e.height)>0&&(t.dataset.chartSizeWidth=e.width,t.dataset.chartSizeHeight=e.height),t.dataset.panelSizeWidth=t.style.width,t.dataset.panelSizeHeight=t.style.height}e.chart.chart=e.chart.chart.destroy()}const t=e.getContainerElement();if(t){t.style.display="none",e.div.querySelector(".tc-ctl-rpanel-minimized-max").style.display="none",t.querySelectorAll("video,audio,iframe").forEach((e=>e.remove())),e.div.querySelector(e.content.collapsedClass).classList.add(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN);let r=document.querySelector("."+e.classes.RESIZABLE);r&&(r.style=""),e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.RESULTSPANELCLOSE,{control:e,feature:e.currentFeature}),collidingManagement.remove(e)}return e}openChart(e){const t=this;return t.onOpen(),t.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN),t.map.getControlsByClass(ResultsPanel).filter((function(e){return e!==t})).filter((function(e){return"chart"===e.options.content})).forEach((function(e){e.close()})),e&&(e.msg?(t.map.toast(e.msg),t.isVisible()&&t.hide("tc-ctl-rpanel-sidebar-body")):(t.elevationProfileChartData=e,t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+t.CLASS+"-chart")}))),t}async renderElevationProfileChart(options={}){const self=this,c3=(await __webpack_require__.e(7965).then(__webpack_require__.t.bind(__webpack_require__,7965,23))).default,data=options.data;data.ele=data.ele.map((e=>null===e?0:e));const div=options.div;let locale=_Util__WEBPACK_IMPORTED_MODULE_2__.A.getMapLocale(self.map);const titleBar=self.div.querySelector(".tc-ctl-rpanel-title");self.getItemTools().forEach((e=>self.addItemToolUI(titleBar,e)));var templateData={upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"};const hasSecondaryElevationProfileChartData=data.secondaryElevationProfileChartData&&Array.isArray(data.secondaryElevationProfileChartData)&&data.secondaryElevationProfileChartData.length>0&&data.secondaryElevationProfileChartData[0];hasSecondaryElevationProfileChartData&&(templateData.min=formatYAxis(data.min,locale),templateData.max=formatYAxis(data.max,locale),templateData.secondChart={upHill:data.secondaryElevationProfileChartData[0].upHill?data.secondaryElevationProfileChartData[0].upHill.toLocaleString(locale):"0",downHill:data.secondaryElevationProfileChartData[0].downHill?data.secondaryElevationProfileChartData[0].downHill.toLocaleString(locale):"0",min:formatYAxis(data.secondaryElevationProfileChartData[0].min,locale),max:formatYAxis(data.secondaryElevationProfileChartData[0].max,locale)});const out=await self.getRenderedHtml(self.CLASS+"-chart",templateData);div.innerHTML=out,div.style.display="",self.chartController=new _Controller__WEBPACK_IMPORTED_MODULE_7__.A(new ChartModel,new _Observer__WEBPACK_IMPORTED_MODULE_8__.A(div)),self.chartController.model["geo.trk.chart.elevationGain"]=self.getLocaleString("geo.trk.chart.elevationGain");var legendOptions={show:!1};hasSecondaryElevationProfileChartData&&(legendOptions={position:"inset",inset:{anchor:"bottom-left",x:-55,y:-30,step:1}});let chartOptions=_Util__WEBPACK_IMPORTED_MODULE_2__.A.extend({bindto:div.querySelector(".tc-chart"),padding:{top:13,right:15,bottom:0,left:45},legend:legendOptions},self.createChartOptions(data));const resizedTarget=self.div.querySelector(`.${self.classes.RESIZABLE}.tc-ctl-rpanel-main`);resizedTarget&&resizedTarget.dataset.chartSizeWidth&&parseInt(resizedTarget.dataset.chartSizeWidth)>0&&resizedTarget.dataset.chartSizeHeight&&parseInt(resizedTarget.dataset.chartSizeHeight)>0&&(_Util__WEBPACK_IMPORTED_MODULE_2__.A.extend(chartOptions.size,{width:resizedTarget.dataset.chartSizeWidth,height:resizedTarget.dataset.chartSizeHeight}),resizedTarget.dataset.panelSizeWidth&&parseInt(resizedTarget.dataset.panelSizeWidth)>0&&resizedTarget.dataset.panelSizeHeight&&parseInt(resizedTarget.dataset.panelSizeHeight)>0&&(resizedTarget.style.width=resizedTarget.dataset.panelSizeWidth,resizedTarget.style.height=resizedTarget.dataset.panelSizeHeight)),self.chart.tooltip&&(chartOptions.tooltip={position:function(e,t,r,n){let i=document.querySelector(".c3-tooltip-container"),o=document.querySelector(".c3").getBoundingClientRect().left,a=document.querySelector(".c3 g.c3-axis-y").getBoundingClientRect().right,s=i.clientWidth,l=parseInt(d3.mouse(n)[0])+a-o-Math.floor(s/2),c=document.querySelector(".c3 g.c3-axis-x").getBoundingClientRect().height+2,u=i.querySelector(`.${self.classes.POSITION_BOTTOM}`);return u&&c&&(u.style.height=c+"px"),{top:0,left:l}},contents:function(d){var fn=self.chart.tooltip;return"function"!=typeof fn&&(fn=_Util__WEBPACK_IMPORTED_MODULE_2__.A.getFnFromString(self.chart.tooltip)),fn.call(eval(self.chart.ctx),d)}}),self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=_Util__WEBPACK_IMPORTED_MODULE_2__.A.getFnFromString(self.chart.onmouseout)),fn.call(eval(self.chart.ctx))}),chartOptions.onrendered=function(){_Util__WEBPACK_IMPORTED_MODULE_2__.A.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this),self.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})},c3._isOverriden||(c3.chart.internal.fn.generateDrawLine=function(e,t){var r=this,n=r.config,i=r.d3.svg.line(),o=r.generateGetLinePoints(e,t),a=t?r.getSubYScale:r.getYScale,s=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:a.call(r,e.id)(e.value)};return i=n.axis_rotated?i.x(l).y(s):i.x(s).y(l),n.line_connectNull||(i=i.defined((function(e){return null!=e.value}))),function(e){var o,s=n.line_connectNull?r.filterRemoveNull(e.values):e.values,l=t?r.x:r.subX,c=a.call(r,e.id),u=0,h=0;return r.isLineType(e)?n.data_regions[e.id]?o=r.lineWithRegions(s,l,c,n.data_regions[e.id]):(r.isStepType(e)&&(s=r.convertValuesToStep(s)),o=i.interpolate("linear")(s)):(s[0]&&(u=l(s[0].x),h=c(s[0].value)),o=n.axis_rotated?"M "+h+" "+u:"M "+u+" "+h),o||"M 0 0"}},c3.chart.internal.fn.generateDrawArea=function(e,t){var r=this,n=r.config,i=r.d3.svg.area(),o=r.generateGetAreaPoints(e,t),a=t?r.getSubYScale:r.getYScale,s=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?o(e,t)[0][1]:a.call(r,e.id)(0)},c=function(e,t){return n.data_groups.length>0?o(e,t)[1][1]:a.call(r,e.id)(e.value)};return i=n.axis_rotated?i.x0(l).x1(c).y(s):i.x(s).y0(l).y1(c),n.line_connectNull||(i=i.defined((function(e){return null!==e.value}))),function(e){var t,o=n.line_connectNull?r.filterRemoveNull(e.values):e.values,a=0,s=0;return r.isAreaType(e)?(r.isStepType(e)&&(o=r.convertValuesToStep(o)),t=i.interpolate("linear")(o)):(o[0]&&(a=r.x(o[0].x),s=r.getYScale(e.id)(o[0].value)),t=n.axis_rotated?"M "+s+" "+a:"M "+a+" "+s),t||"M 0 0"}},c3._isOverriden=!0),self.chart.chart=c3.generate(chartOptions)}#x(){this.map.getControlsByClass(ResultsPanel).filter((e=>e!==this&&e.isVisible())).filter((e=>"chart"!==e.options.content)).forEach((e=>e.close()))}openTable(){const e=this;e.onOpen(),e.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN);var t=arguments[0];if(t){var r;t.css&&(r=t.css);var n=t.callback,i=t.columns;if(t.data&&t.data.length>0){if(!i)for(var o in i=[],t.data[0])i.push(o);e.tableData={columns:i,results:t.data,css:r,callback:n,sort:t.sort?{}:null};var a=null;const s=(t,r,n)=>{var i=t;if(r){const o=e.tableData.results.map((function(e,t){return{index:t,properties:e}}));o.sort(((e,t)=>{const i=e.properties[r]||"",o=t.properties[r]||"";return n?"string"==typeof i?i.localeCompare(o):i<o?-1:i==o?0:1:"string"==typeof o?o.localeCompare(i):i<o?1:i==o?0:-1})),(i=Object.assign({},t,{results:o.map((function(e){return Object.assign({},e.properties,{index:e.index})}))})).sort={field:r,order:n}}e.getRenderedHtml(e.CLASS+"-table",i).then((function(r){const n=e.div.querySelector(".tc-ctl-rpanel-table"),o=n.parentElement;o.removeChild(n),n.innerHTML=r,o.appendChild(n),t.callback&&t.callback(n),i.sort&&n.querySelectorAll("thead th").forEach((e=>{e.addEventListener("click",(e=>{a=e.target.offsetParent.scrollLeft;const r=e.target.dataset.orderField||e.target.innerText;i.sort.field===r&&i.sort.order?s(t,r,!1):(i.sort.field!==r||i.sort.order,s(t,r,!0))}))})),e.#x();const l=e.div.querySelector(".tc-ctl-rpanel-title");e.getItemTools().forEach((t=>e.addItemToolUI(l,t))),e.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.DRAWTABLE,{control:e}),a&&(n.scrollLeft=a)}))};s(e.tableData),e.div.querySelector(".tc-ctl-rpanel-chart").style.display="none",e.div.querySelector(".tc-ctl-rpanel-info").style.display="none",e.show("tc-ctl-rpanel-sidebar-body")}}}open(e,t){const r=this;r.onOpen(),r.div.classList.remove(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN);const n=t||r.div.querySelector(".tc-ctl-rpanel-table");r.requestIsRendered=window.requestAnimationFrame(function(){var e=n.getBoundingClientRect();if(e&&e.width>30&&e.height>0){const e=r.div.querySelector(".tc-ctl-rpanel-title");r.getItemTools().forEach((t=>r.addItemToolUI(e,t))),this.map.trigger(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.DRAWTABLE,{control:r})}}.bind(r));const i=r.div.querySelector(".tc-ctl-rpanel-chart"),o=r.div.querySelector(".tc-ctl-rpanel-table"),a=r.div.querySelector(".tc-ctl-rpanel-info");e?t?(r.getTableContainer=function(){return t},t.innerHTML=e,t.style.display=""):(o.innerHTML=e,o.style.display=""):i.childElementCount?i.style.display="":o.childElementCount?o.style.display="":a.childElementCount&&(a.style.display="");const s=r.div.querySelector(".tc-ctl-rpanel-minimized-max");r.#C&&(r.#C.main&&r.setTitles(r.#C),r.#C.max&&s.setAttribute("title",r.#C.max)),r.options.classes&&r.options.classes.collapsed&&s.querySelector("span.tc-ctl-rpanel-minimized-max-table").classList.add(r.options.classes.collapsed);const l=r.div.querySelector(r.content.collapsedClass);return isElementVisible(l)&&r.maximize(),r.show("tc-ctl-rpanel-sidebar-body"),r.hide("tc-ctl-rpanel-minimized-max"),collidingManagement.add(r),r}onOpen(){const e=this;e.resizable?e.renderPanelResizable({target:e.div,preserveAspectRatio:!0}):hideResizeHandlers(e)}loadDataOnChart(e){const t=this,r=function(){t.elevationProfileChartData=e,t.renderElevationProfileChart({data:e,div:t.div.querySelector("."+t.CLASS+"-chart")})};t.chart&&t.chart.chart?t.chart.chart.unload({done:r}):r()}createChartOptions(e={}){const t=this;var r={};const n=e.locale||_Util__WEBPACK_IMPORTED_MODULE_2__.A.getMapLocale(t.map);if(e.chartType,null!=e.ele){const o=function(){const r=getComputedStyle(t.getContainerElement()),n=document.documentElement.clientWidth/100*40,i={height:n>445?e.maxHeight||t.CHART_SIZE.MAX_HEIGHT:e.minHeight||t.CHART_SIZE.MIN_HEIGHT};return r.width===getComputedStyle(t.map.div).width?i.width=.95*parseFloat(r.width):i.width=n>445?e.maxWidth||t.CHART_SIZE.MAX_WIDTH:n>310?e.mediumWidth||t.CHART_SIZE.MEDIUM_WIDTH:e.minWidth||t.CHART_SIZE.MIN_WIDTH,i},a=["grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.A.getUID()];let s=Number.NEGATIVE_INFINITY,l=Number.POSITIVE_INFINITY;e.ele.forEach((function(e){"number"==typeof e&&(s=Math.max(e,s),l=Math.min(e,l))}));let c=[...e.x],u=[...e.ele];r={data:{x:"x",columns:[["x"].concat(c),["ele"].concat(u)],types:{ele:"area-spline"},colors:{ele:"url(#"+a[0]+")"}},size:o(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(e){var t,r;return(e/=1e3)<1?(t=Math.round(1e3*e),r=" m"):(t=Math.round(100*e)/100,r=" km"),(t=t.toLocaleString(n))+r}}},y:{padding:{top:0,bottom:0},max:s,min:l,tick:{count:2,format:function(e){return formatYAxis(e,n)}}}},onresize:function(){let e,r=this.config.bindto.closest(`.${t.classes.RESIZABLE}.tc-ctl-rpanel-main`);e=r?t.getResizableChartSize(r):o(),e&&this.api.resize(e)}};const h=e.secondaryElevationProfileChartData&&Array.isArray(e.secondaryElevationProfileChartData)&&e.secondaryElevationProfileChartData.length>0&&e.secondaryElevationProfileChartData[0];h&&(r.data.names={ele:t.getLocaleString("geo.profile.fromTrack"),ele2:t.getLocaleString("mdt")},r.data.columns.push(["ele2"].concat(e.secondaryElevationProfileChartData[0].ele)),r.data.types.ele2=r.data.types.ele,a.push("grad"+_TC__WEBPACK_IMPORTED_MODULE_0__.A.getUID()),r.data.colors.ele2="url(#"+a[a.length-1]+")",r.data.axes={ele:"y"},u.every((e=>0===e))?(r.axis.y.min=e.secondaryElevationProfileChartData[0].min,r.axis.y.max=e.secondaryElevationProfileChartData[0].max):e.secondaryElevationProfileChartData[0].ele.every((e=>0===e))?(r.axis.y.min=Math.min(...u),r.axis.y.max=Math.max(...u)):(r.axis.y.min=Math.min(...u.concat(e.secondaryElevationProfileChartData[0].min)),r.axis.y.max=Math.max(...u.concat(e.secondaryElevationProfileChartData[0].max)))),e.time&&(r.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));var i=!1;r._onrendered=function(){if(i||(i=!0,h&&(document.querySelectorAll(".c3-legend-item-tile").forEach((e=>{e.setAttribute("rx",5),e.setAttribute("ry",1)})),document.querySelectorAll(".c3-legend-item").forEach((e=>{var r=document.createElementNS("http://www.w3.org/2000/svg","title");r.textContent=t.getLocaleString("hide"),e.appendChild(r),e.addEventListener(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.CLICK,(function(){e.classList.contains(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN)?e.querySelector("title").textContent=t.getLocaleString("hide"):e.querySelector("title").textContent=t.getLocaleString("show"),e.classList.toggle(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.classes.HIDDEN)}),{passive:!0})})))),!this.svg)return;const r=this.svg[0][0];var n=r.getElementsByTagName("defs")[0],o="http://www.w3.org/2000/svg";const s=function(e,t){var r=document.createElementNS(o,"linearGradient");r.setAttributeNS(null,"id",e),r.setAttributeNS(null,"x1","0%"),r.setAttributeNS(null,"x2","0%"),r.setAttributeNS(null,"y1","0%"),r.setAttributeNS(null,"y2","100%"),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const i=document.createElementNS(o,"stop");i.setAttributeNS(null,"offset","0%"),i.setAttributeNS(null,"stop-color",t[0]),i.setAttributeNS(null,"stop-opacity","0.7"),r.appendChild(i);const a=document.createElementNS(o,"stop");a.setAttributeNS(null,"offset","50%"),a.setAttributeNS(null,"stop-color",t[1]),a.setAttributeNS(null,"stop-opacity","0.9"),r.appendChild(a);const s=document.createElementNS(o,"stop");s.setAttributeNS(null,"offset","100%"),s.setAttributeNS(null,"stop-color",t[2]),s.setAttributeNS(null,"stop-opacity","1"),r.appendChild(s),n.appendChild(r)};s(a[0],["red","orange","green"]),e.secondaryElevationProfileChartData&&s(a[a.length-1],["blue","cian","green"]);const l=d3.select(".c3-brush").node();l&&l.parentNode.removeChild(l),d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",(function(e){d3.event.stopPropagation();let r=t.elevationProfileChartData.coords[e.index];r&&(r=r.slice(0,2),t.map.crs!==t.map.options.utmCrs&&(r=_Util__WEBPACK_IMPORTED_MODULE_2__.A.reproject(r,t.map.options.utmCrs,t.map.crs)),t.map.zoomToFeatures([new _SITNA_feature_Point__WEBPACK_IMPORTED_MODULE_4__.A(r,{})]))}));const c=d3.select(".c3-axis.c3-axis-x").select("path");if(!c.empty()){let e=c.attr("d");/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(e)?(e=e.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10"),c.attr("d",e)):/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(e)&&(e=e.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10"),c.attr("d",e))}const u=r.getBoundingClientRect(),d={width:u.width,height:u.height};var p=function(){var e=d3.scale.ordinal().rangeRoundBands([0,d.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call((function(e,t){e.each((function(){e.each((function(e,t){if(0===t)return;const r=d3.select(this);if(1===r.node().childNodes.length){var n=r.select("tspan").node().cloneNode(),i=r.text().split(" ");r.select("tspan").text(i[0]),n.textContent=i[1];var o=n.getAttribute("dy");o=(o=o?parseFloat(n.getAttribute("dy")):.71)+.18+"em",n.setAttribute("dy",o),r.node().appendChild(n)}}))}))}),e.rangeBand())};const g=d3.select(".c3-axis-x").node().getBoundingClientRect();if(g.width){const e=d3.select(".c3-axis-y").node().getBoundingClientRect();(g.width>=d.width-e.width||100*g.width/(d.width-e.width)>90)&&p()}else{t.elevationChartLabelsRAF&&(window.cancelAnimationFrame(t.elevationChartLabelsRAF),t.elevationChartLabelsRAF=void 0);const e=function(){const r=d3.select(".c3-axis-x"),n=r.node();if(r.length&&!n)t.elevationChartLabelsRAF=requestAnimationFrame(e);else if(r.length&&n&&!n.getBoundingClientRect().width)t.elevationChartLabelsRAF=requestAnimationFrame(e);else{window.cancelAnimationFrame(t.elevationChartLabelsRAF),t.elevationChartLabelsRAF=void 0;const e=n.getBoundingClientRect(),r=d3.select(".c3-axis-y").node().getBoundingClientRect();(e.width>=d.width-r.width||100*e.width/(d.width-r.width)>90)&&p()}};t.elevationChartLabelsRAF=requestAnimationFrame(e)}d3.select("svg").select(".c3-chart-lines").selectAll(".c3-target-ele").each((function(){this.parentNode.appendChild(this)})),t.isMinimized()||(t.show("tc-ctl-rpanel-sidebar-body"),t.hide("tc-ctl-rpanel-minimized-max")),t.div.querySelector(".tc-ctl-rpanel-table").style.display="",t.div.querySelector(".tc-ctl-rpanel-info").style.display=""}}else r={msg:t.getLocaleString("geo.trk.chart.chpe.empty")};return r}getElevationChartTooltip(e){const t=this,r=t.map.options.locale&&t.map.options.locale.replace("_","-")||void 0,n=t.elevationProfileChartData.coords,i=function(e){return e.value?parseInt(e.value.toFixed(0)).toLocaleString(r):"0"},o=n[e[0].index];let a;4===n[0].length&&n[0][3]>0&&o&&(a=getTime(n[0][3],o[3]));let s=e[0].x/1e3,l=(s<1?Math.round(1e3*s):Math.round(100*s)/100).toLocaleString(r)+(s<1?" m":" km");return`<div class="${t.classes.POSITION_TOP}"><span>`+e.map(((e,t)=>e?0===t?'<span data-isNumber class="'+("ele"===e.id?"tc-original":"tc-mdt")+'">'+i(e)+" m</span>":'<span data-isNumber class="'+("ele"===e.id?"tc-original":"tc-mdt")+'">'+i(e)+" m </span>":"")).join("")+`</span ></div><div class="${t.classes.POSITION_BOTTOM}"><span>${l} </span>`+(a?"<span>"+a.toString+"</span><div/>":"<div/>")}getTableContainer(){return this.tableDiv}getInfoContainer(){return this.infoDiv}getMenuElement(){return this.menuDiv}getContainerElement(){return this.div.querySelector(".tc-ctl-rpanel-sidebar-body")}async register(e){const t=this;return await super.register.call(t,e),t.wrap.register(e),t.openOn&&t.map.one(t.openOn,(function(e,r){t.content.fnOpen.call(t,e.data)})),t.closeOn&&t.map.one(t.closeOn,(function(e,r){t.close()})),t.options.openOn&&t.map.on(t.options.openOn,(function(e,r){t.content.fnOpen.call(t,e.data)})),t.options.closeOn&&t.map.on(t.options.closeOn,(function(e,r){t.close()})),e.on(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.FEATUREREMOVE,(function(e){t.currentFeature===e.feature&&t.isVisible()&&t.close()})).on(_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.FEATURESCLEAR+" "+_Consts__WEBPACK_IMPORTED_MODULE_1__.A.event.LAYERREMOVE,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.close()})),t}exportToExcel(){const e=this;var t=[e.tableData.columns];e.tableData.results.forEach((function(e){var r=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&"Id"!==n&&"Geom"!==n&&r.push(e[n]);t.push(r)})),Promise.resolve().then(__webpack_require__.bind(__webpack_require__,4921)).then((function(r){const n=new(0,r.default);var i=e.save.fileName?e.save.fileName:"resultados.xls",o=e.#C&&e.#C.main?e.#C.main:null;n.Save(i,t,o)}))}updateModel(){this.model.title=this?.#C?.main||this.getLocaleString("rsp.title"),this.model.close=this.getLocaleString("close"),this.model.hide=this.getLocaleString("hide"),this.model.expand=this.getLocaleString("expand"),this.options.save&&(this.model["export.excel"]=this.getLocaleString("export.excel")),this.model.download=this.getLocaleString("download"),this.options.share&&(this.model.shareQuery=this.getLocaleString("shareQuery")),this.chartController&&(this.chartController.model["geo.trk.chart.elevationGain"]=this.getLocaleString("geo.trk.chart.elevationGain"))}async updateLanguage(){this.updateModel()}}ResultsPanel.prototype.CLASS="tc-ctl-rpanel",_TC__WEBPACK_IMPORTED_MODULE_0__.A.control.ResultsPanel=ResultsPanel,_TC__WEBPACK_IMPORTED_MODULE_0__.A.mix(ResultsPanel,_itemToolContainer__WEBPACK_IMPORTED_MODULE_5__.default);const __WEBPACK_DEFAULT_EXPORT__=ResultsPanel},1580:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16}},1597:(e,t,r)=>{"use strict";function n(e,t,r){return Math.min(Math.max(e,t),r)}function i(e,t,r,n,i,a){const s=i-r,l=a-n;if(0!==s||0!==l){const o=((e-r)*s+(t-n)*l)/(s*s+l*l);o>1?(r=i,n=a):o>0&&(r+=s*o,n+=l*o)}return o(e,t,r,n)}function o(e,t,r,n){const i=r-e,o=n-t;return i*i+o*o}function a(e){const t=e.length;for(let r=0;r<t;r++){let n=r,i=Math.abs(e[r][r]);for(let o=r+1;o<t;o++){const t=Math.abs(e[o][r]);t>i&&(i=t,n=o)}if(0===i)return null;const o=e[n];e[n]=e[r],e[r]=o;for(let n=r+1;n<t;n++){const i=-e[n][r]/e[r][r];for(let o=r;o<t+1;o++)r==o?e[n][o]=0:e[n][o]+=i*e[r][o]}}const r=new Array(t);for(let n=t-1;n>=0;n--){r[n]=e[n][t]/e[n][n];for(let i=n-1;i>=0;i--)e[i][t]-=e[i][n]*r[n]}return r}function s(e){return 180*e/Math.PI}function l(e){return e*Math.PI/180}function c(e,t){const r=e%t;return r*t<0?r+t:r}function u(e,t,r){return e+r*(t-e)}function h(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}function d(e,t){return Math.round(h(e,t))}function p(e,t){return Math.floor(h(e,t))}function g(e,t){return Math.ceil(h(e,t))}function f(e,t,r){if(e>=t&&e<r)return e;const n=r-t;return((e-t)%n+n)%n+t}r.d(t,{Cc:()=>u,KU:()=>a,LI:()=>d,LV:()=>f,Mg:()=>h,Q1:()=>i,RI:()=>p,eh:()=>l,hG:()=>o,mk:()=>g,qE:()=>n,xP:()=>c,xW:()=>s})},1651:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(9566),i=r(797);class o extends n.A{STYLETYPE=i.A.geom.POINT;constructor(e,t){super(e,t),this.wrap.isNative(e)||(this.wrap.feature=e,this.wrap.createMultiPoint(e,t))}getCoordinates(e){return super.getCoordinates.call(this,e)}setCoordinates(e){if(e){if(!Array.isArray(e))throw new TypeError("Coordinates not valid for multipoint");Array.isArray(e[0])||(e=[e])}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}getGeometryType(){return i.A.geom.MULTIPOINT}}const a=o},1667:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(9566),i=r(797);class o extends n.A{STYLETYPE=i.A.geom.POLYGON;constructor(e,t){super(e,t),this.wrap.isNative(e)||this.wrap.createMultiPolygon(e,t)}getCoordinates(e){const t=super.getCoordinates.call(this,e);return e?.pointArray?[].concat.apply([],[].concat.apply([],t)):t}setCoordinates(e){if(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new TypeError("Coordinates not valid for multipolygon");Array.isArray(e[0][0])?Array.isArray(e[0][0][0])||(e=[e]):e=[[e]],e.forEach((function(e){e.forEach((function(e){const t=e[0],r=e[e.length-1];t[0]===r[0]&&t[1]===r[1]||(e[e.length]=t)}))}))}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat(2)}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}getArea(e){return this.wrap.getArea({coordinates:this.getCoordinates(e)})}getGeometryType(){return i.A.geom.MULTIPOLYGON}}const a=o},1685:(e,t,r)=>{"use strict";function n(e){e.stopPropagation()}r.d(t,{Ay:()=>i,dG:()=>n});const i=class{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}},1783:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(7612),l=r(3791),c=r(5777);n.A.control=n.A.control||{},n.A.view=n.A.view||{},n.A.view.ThreeD=s.default;class u{constructor(){this["threed.tip"]=""}}class h extends a.A{register(e){const t=this;return e.on(i.A.event.VIEWCHANGE,(function(e){e.view===i.A.view.THREED&&t.set3D()})),super.register.call(t,e)}async loadTemplates(){const e=await Promise.resolve().then(r.bind(r,8202));this.template=e.default}renderData(e,t){const r=this;return r.model=new u,super.renderData.call(r,e,(function(){r.button=r.div.querySelector("."+r.CLASS+"-btn"),r.addUIEventListeners(),o.A.isFunction(t)&&t(),r.controller=new c.A(r.model,new l.A(r.div)),r.updateModel()}))}addUIEventListeners(){const e=this;e.button.addEventListener(i.A.event.CLICK,(function(){e.button.disabled||(e.map.on3DView?e.unset3D():e.set3D())}),{passive:!0})}set3D(){const e=this;e.map.on3DView||(e.button.disabled=!0),e.browserSupportWebGL.call(e);e.map.view3D&&e.map.on3DView||n.A.view.ThreeD.apply({map:e.map,options:e.options,getRenderedHtml:e.getRenderedHtml,callback:function(){e.button.disabled=!1}}),e.button.setAttribute("title",e.getLocaleString("threed.two.tip")),e.button.classList.add(i.A.classes.CHECKED)}unset3D(){const e=this;e.button.disabled=!0,n.A.view.ThreeD.unapply({callback:function(){e.button.setAttribute("title",e.getLocaleString("threed.tip")),e.button.classList.remove(i.A.classes.CHECKED),e.button.disabled=!1}})}browserSupportWebGL(){const e=this;let t=!1;if(window.WebGLRenderingContext){const a=document.createElement("canvas");var r={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var n=a.getContext("webgl",r)||a.getContext("experimental-webgl",r)||a.getContext("webkit-3d",r)||a.getContext("moz-webgl",r);n?t=!0:(r.failIfMajorPerformanceCaveat=!1,(n=a.getContext("webgl",r)||a.getContext("experimental-webgl",r)||a.getContext("webkit-3d",r)||a.getContext("moz-webgl",r))?(t="slow",e.isSlower=!0):t=!1)}catch(e){console.log(e)}if("slow"===t||!t){var o="slow"===t?"threed.slowSupport.supported":"threed.not.supported";e.map.toast(e.getLocaleString(o),{type:i.A.msgType.WARNING,duration:1e4})}return t}t=!1}updateModel(){this.model["threed.tip"]=this.getLocaleString("threed.tip")}updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-3d",n.A.control.ThreeD=h;const d=h},1845:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(9669),o=r(3301),a=r(797),s=r(187),l=r(153),c=r(7585);n.A.control=n.A.control||{},n.A.i18n=n.A.i18n||l.A;const u="sitna-control";class h extends HTMLElement{template;control;#P;#M=new WeakMap;#I;#R={};constructor(){super();const e=this;e.map=null,e.isActive=!1,e.isDisabled=!1;var t=arguments.length;e.options=e.mergeOptions(t>1?arguments[1]:arguments[0]),e.#P=e.options.id||n.A.getUID({prefix:e.CLASS.substr(h.prototype.CLASS.length+1)+"-"});const r=e.options.div||arguments[0];if(r){const t=o.A.getDiv(r);e.div=t}else e.div=e.parentElement;e.template=e.options.template||e.template,e.exportsState=!1}connectedCallback(){const e=this;if(e.id||(e.id=e.#P),e.classList.add(h.prototype.CLASS,e.CLASS),e.map instanceof i.A)return;const t=e.getAttribute("for");let r;if(t){const n=document.getElementById(t);n&&(r=i.A.get(n),r?r.addControl(e):new MutationObserver((function(t,o){for(const a of t)"childList"===a.type&&(r=i.A.get(n),r&&(r.addControl(e),o.disconnect()))})).observe(n,{childList:!0}))}else{let t=e;do{t=t.parentElement,!e.containerControl&&t instanceof h&&(e.containerControl=t)}while(t&&!t.classList.contains(a.A.classes.MAP));r=i.A.get(t),r?r.addControl(e):e.renderPromise()}}disconnectedCallback(){this.unregister()}getId(){return this.#P}mergeOptions(...e){return o.A.extend({},...e)}initProperty(e){const t=this;return Object.prototype.hasOwnProperty.call(t.options,e)&&(t[e]=t.options[e]),t}show(){return this.style.display="",this}hide(){const e=this;return e.style.display="none",e.unhighlight(),e}render(e){const t=this;return t.id||(t.id=t.#P),t.renderData(null,(function(){t.addUIEventListeners(),"function"==typeof e&&e()}))}async loadTemplates(){}async renderData(e,t){const r=this;let n;r.map&&r.trigger(a.A.event.BEFORECONTROLRENDER,{dataObject:e}),r.classList.toggle(a.A.classes.DISABLED,r.isDisabled),r.template||await r.loadTemplates(),"object"!=typeof r.template||r.template.compiler?(n=r.template,r.template={},r.template[r.CLASS]=n):n=r.template[r.CLASS];const i=r.getRenderedHtml(r.CLASS,e);r._firstRender??=i;const s=await i;r.innerHTML=s,!r.parentElement&&r.div&&r.div.appendChild(r),r.map&&r.trigger(a.A.event.CONTROLRENDER),o.A.isFunction(t)&&t()}async getRenderedHtml(e,t,r){const n=this,i=function(e){if(void 0===e)return"";const n=e(t);return o.A.isFunction(r)&&r(n),n};n.template||await n.loadTemplates();const a=n.template[e];return"function"!=typeof a?(await n.#O({locale:n.map&&n.map.options.locale,className:n.CLASS}),i(n.template[e])):i(a)}async#O(e={}){const t=this.template,r=[];for(let e in t){const i=e;let o=t[i];"string"==typeof o?r.push(new Promise((function(e,r){n.A.ajax({url:o,method:"GET",responseType:"text"}).then((function(r){t[i]=o=c.A.compile(r.data),e(o)})).catch((function(e){console.log("Error fetching template: "+e),r(e)}))}))):"object"==typeof o&&(t[e]=o=c.A.template(o))}await Promise.all(r);for(let r in t)t[r]&&r!==e.className&&c.A.registerPartial(r,t[r])}async register(e){const t=this;return t.map=e,await t.render(),t.parentElement||(e.div.appendChild(t),t.div=e.div),t.options.active&&t.activate(),t}unregister(){const e=this;if(e.map){e.map.layers.slice().forEach((t=>{t.owner===e&&e.map.removeLayer(t)}));const t=e.map.controls.indexOf(e);t>=0&&e.map.controls.splice(t,1),e.map=null}return e}activate(){const e=this;return e.map&&e.map.activeControl&&e.map.activeControl!==e&&(e.map.previousActiveControl=e.map.activeControl,e.map.activeControl.deactivate()),e.isActive=!0,e.map&&(e.map.activeControl=e,e.map.trigger(a.A.event.CONTROLACTIVATE,{control:e}),e.trigger(a.A.event.CONTROLACTIVATE,{control:e})),e}deactivate(e=!1){const t=this;if(t.isActive=!1,t.map){if(t.map.activeControl=null,!e){var r=t.map.getDefaultControl();r===t||t.map.previousActiveControl===t?r=null:r||(r=t.map.previousActiveControl),r&&r.activate()}t.map.trigger(a.A.event.CONTROLDEACTIVATE,{control:t}),t.trigger(a.A.event.CONTROLDEACTIVATE,{control:t})}return t}enable(){const e=this;return e.isDisabled=!1,e.classList.remove(a.A.classes.DISABLED),delete e.dataset.tcMessage,e.containerControl&&e.containerControl.onControlEnable&&e.containerControl.onControlEnable(e),e}disable(e={}){const t=this;t.isDisabled=!0,t.classList.add(a.A.classes.DISABLED);let r=t.getLocaleString("disabledControl");return e.reason&&(r=`${r} - ${e.reason}`),t.dataset.tcMessage=r,t.containerControl&&t.containerControl.onControlDisable&&t.containerControl.onControlDisable(t),t}highlight(){const e=this;return e.div&&e.div.classList.add(a.A.classes.HIGHLIGHTED),e.map&&e.map.trigger(a.A.event.CONTROLHIGHLIGHT,{control:e}),e}unhighlight(){const e=this;return e.div&&e.div.classList.remove(a.A.classes.HIGHLIGHTED),e.map&&e.map.trigger(a.A.event.CONTROLUNHIGHLIGHT,{control:e}),e}isHighlighted(){return!!this.div&&this.div.classList.contains(a.A.classes.HIGHLIGHTED)}renderPromise(){const e=this;return e._firstRender||new Promise((function(t,r){e.one(a.A.event.CONTROLRENDER,(function(){t(e)}))}))}addUIEventListener(e,t,r){const n=this;return(e?n.querySelectorAll(e):[n]).forEach((function(e){e.addEventListener(t,r)})),n}addUIEventListeners(){return this}isExclusive(){return!1}getLocaleString(e,t){const r=this.map?this.map.options.locale:s.A.locale;return o.A.getLocaleString(r,e,t)}getUID(){return n.A.getUID({prefix:this.#P+"-"})}exportState(){return this.exportsState?{}:null}importState(e){return this}async getDownloadDialog(){const e=this;return e.#I??=e.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0],e.#I||(e.#I=await e.map.addControl("FeatureDownloadDialog")),e.#I.caller=e,e.#I}async getElevationTool(){const e=this;if(!e.displayElevation&&!e.options.displayElevation)return null;if(e.elevation)return e.elevation;if(n.A.tool.Elevation||await Promise.resolve().then(r.bind(r,4363)),"boolean"==typeof e.options.displayElevation)if(e.map){const t=await e.map.getElevationTool();e.elevation=t||new n.A.tool.Elevation}else e.elevation=new n.A.tool.Elevation;else if(e.map){const t=await e.map.getElevationTool();e.elevation=t?new n.A.tool.Elevation(o.A.extend(!0,{},t.options,e.options.displayElevation)):new n.A.tool.Elevation(e.options.displayElevation)}else e.elevation=new n.A.tool.Elevation(e.options.displayElevation);return e.elevation}#D(e,t){const r=this,n=function(e){const n={type:e.type,target:r,currentTarget:r};return e.detail&&Object.keys(e.detail).forEach((function(t){t in n||(n[t]=e.detail[t])})),t.call(r,n)}.bind(this);return(r.#R[e]=r.#R[e]||new Map).set(t,n),n}#N(e,t,r){const n=this;return e.split(" ").forEach((function(e){n.addEventListener(e,n.#D(e,t),r)})),n}on(e,t){return this.#N(e,t)}one(e,t){return this.#N(e,t,{once:!0})}off(e,t){const r=this,n=e.split(" ");return t?n.forEach((function(e){const n=r.#R[e];n&&n.has(t)&&r.removeEventListener(e,n.get(t))})):n.forEach((function(e){const t=r.#R[e];t&&(t.forEach((function(t){r.removeEventListener(e,t)})),t.clear())})),r}trigger(e,t){let r;t&&(r={detail:t});const n=new CustomEvent(e,r);this.dispatchEvent(n)}listenerBySelector(e,t){const r=this;return function(n){const i=this,o=n.type;var a=r.#M.get(i);a||(a={},r.#M.set(i,a));var s=a[o];if(s||(a[o]=s={}),s[e]||(s[e]=t),!n._listenerBySelectorCalled)for(var l,c=!1,u=n.target;u&&u!==i;){for(e in s)u.matches&&u.matches(e)&&(c=!0,l=s[e].call(i,n),n._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}}static async create(e,t){const i=e.substr(0,1).toUpperCase()+e.substr(1);if(!n.A.control[i]){const e=await r(9797)("./"+i);n.A.control[i]=e.default}return new n.A.control[i](void 0,t)}}h.prototype.CLASS="tc-ctl",customElements.get(u)||customElements.define(u,h),n.A.control.WebComponentControl=h;const d=h},1854:(e,t,r)=>{"use strict";r.d(t,{A:()=>l,e:()=>s});var n=r(6837),i=r(9332),o=r(9438);class a extends i.A{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(n.A.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=(0,o.KT)(this,e[i],t);return n}return(0,o.KT)(this,e,t)}onceInternal(e,t){let r;if(Array.isArray(e)){const n=e.length;r=new Array(n);for(let i=0;i<n;++i)r[i]=(0,o.Jz)(this,e[i],t)}else r=(0,o.Jz)(this,e,t);return t.ol_key=r,r}unInternal(e,t){const r=t.ol_key;if(r)s(r);else if(Array.isArray(e))for(let r=0,n=e.length;r<n;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}function s(e){if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)(0,o.JH)(e[t]);else(0,o.JH)(e)}a.prototype.on,a.prototype.once,a.prototype.un;const l=a},1976:function(e,t){var r,n;void 0===(n="function"==typeof(r=function(){var e=function(){},t={},r={},n={};function i(e,t){if(e){var i=n[e];if(r[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function o(t,r){t.call&&(t={success:t}),r.length?(t.error||e)(r):(t.success||e)(t)}function a(t,r,n,i){var o,s,l,c=document,u=n.async,h=(n.numRetries||0)+1,d=n.before||e,p=t.replace(/[\?|#].*$/,""),g=t.replace(/^(css|img|module|nomodule)!/,"");if(i=i||0,/(^css!|\.css$)/.test(p))(l=c.createElement("link")).rel="stylesheet",l.href=g,(o="hideFocus"in l)&&l.relList&&(o=0,l.rel="preload",l.as="style");else if(/(^img!|\.(png|gif|jpg|svg|webp)$)/.test(p))(l=c.createElement("img")).src=g;else if((l=c.createElement("script")).src=g,l.async=void 0===u||u,s="noModule"in l,/^module!/.test(p)){if(!s)return r(t,"l");l.type="module"}else if(/^nomodule!/.test(p)&&s)return r(t,"l");l.onload=l.onerror=l.onbeforeload=function(e){var s=e.type[0];if(o)try{l.sheet.cssText.length||(s="e")}catch(e){18!=e.code&&(s="e")}if("e"==s){if((i+=1)<h)return a(t,r,n,i)}else if("preload"==l.rel&&"style"==l.as)return l.rel="stylesheet";r(t,s,e.defaultPrevented)},!1!==d(t,l)&&c.head.appendChild(l)}function s(e,r,n){var s,l;if(r&&r.trim&&(s=r),l=(s?n:r)||{},s){if(s in t)throw"LoadJS";t[s]=!0}function c(t,r){!function(e,t,r){var n,i,o=(e=e.push?e:[e]).length,s=o,l=[];for(n=function(e,r,n){if("e"==r&&l.push(e),"b"==r){if(!n)return;l.push(e)}--o||t(l)},i=0;i<s;i++)a(e[i],n,r)}(e,(function(e){o(l,e),t&&o({success:t,error:r},e),i(s,e)}),l)}if(l.returnPromise)return new Promise(c);c()}return s.ready=function(e,t){return function(e,t){e=e.push?e:[e];var i,o,a,s=[],l=e.length,c=l;for(i=function(e,r){r.length&&s.push(e),--c||t(s)};l--;)o=e[l],(a=r[o])?i(o,a):(n[o]=n[o]||[]).push(i)}(e,(function(e){o(t,e)})),s},s.done=function(e){i(e,[])},s.reset=function(){t={},r={},n={}},s.isDefined=function(e){return e in t},s})?r.apply(t,[]):r)||(e.exports=n)},1979:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=(r(5121),r(5777)),l=r(3791);n.A.control=n.A.control||{};class c{constructor(){this.measure="",this.length="",this.areaAndPerimeter=""}}class u extends a.A{constructor(){super(...arguments);const e=this;e.snapping=e.options.snapping,e.drawControls=[],e.persistentDrawControls=!1,e.NOMEASURE="-",e.exportsState=!0,this.renderPromise().then((function(){e.measureMode=e.options.mode,e.history=[],e.historyIndex=0,e.reset=!0,e.wrap=new n.A.wrap.control.Measure(e)})),e.model=new c}async loadTemplates(){const e=await r.e(4009).then(r.bind(r,4009));this.template=e.default}async render(e){const t=this;await super.renderData.call(t,{controlId:t.id,displayElevation:t.options.displayElevation,singleSketch:!t.persistentDrawControls,extensibleSketch:t.persistentDrawControls,stylable:t.persistentDrawControls}),t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(i.A.classes.HIDDEN),t.lineMeasurementControl=t.div.querySelector('sitna-measurement[mode="polyline"]'),t.polygonMeasurementControl=t.div.querySelector('sitna-measurement[mode="polygon"]'),t.lineMeasurementControl.containerControl=t,t.lineMeasurementControl.displayElevation=t.options.displayElevation,t.polygonMeasurementControl.containerControl=t,t.div.querySelectorAll(".tc-ctl-meas-select sitna-tab").forEach((function(e){e.callback=function(){const e=this.target;e&&t.setMode(e.id.substr(e.id.indexOf("-mode-")+6),!0)}}));const r=await Promise.all([t.getLineDrawControl(),t.getPolygonDrawControl()]);t.lineDrawControl=r[0],t.polygonDrawControl=r[1],t.lineDrawControl.id=t.drawLinesId,t.polygonDrawControl.id=t.drawPolygonsId,t.lineDrawControl.setLayer(t.layer),t.polygonDrawControl.setLayer(t.layer),t.lineDrawControl.snapping=t.snapping,t.polygonDrawControl.snapping=t.snapping,r.forEach((function(e){e.containerControl=t,t.drawControls.push(e),e.on(i.A.event.DRAWSTART,(function(e){t.resetValues()})).on(i.A.event.MEASURE+" "+i.A.event.MEASUREPARTIAL,(function(e){t.displayMeasurements(e)})).on(i.A.event.DRAWCANCEL,(function(e){setTimeout((function(){t.cancel()}),100)})),e.exportsState=!1})),o.A.isFunction(e)&&e(),t.controller=new s.A(t.model,new l.A(t.div))}async register(e){const t=this,r=t.getUID();return t.drawLinesId=t.getUID(),t.drawPolygonsId=t.getUID(),t.units=t.options.units?t.options.units:["m","km"],t.options.layerLess?t.layerPromise=Promise.resolve(null):t.layerPromise=e.addLayer({id:r,title:t.getLocaleString("measure"),owner:t,stealth:!0,type:i.A.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}}),t.layer=await t.layerPromise,await super.register.call(t,e),t.map.on(i.A.event.VIEWCHANGE,(function(){t.map.view===i.A.view.PRINTING&&t.trigger(i.A.event.DRAWEND)})),await t.renderPromise(),t.layer&&e.putLayerOnTop(t.layer),t.setMode(t.options.mode),t.updateModel(),t}displayMode(e){const t=this,r=[];switch(t.div.querySelectorAll(".tc-ctl-meas-mode").forEach((function(e){r.push(e)})),e){case i.A.geom.POLYLINE:t._activeMode=r.find((function(e){return e.matches(".tc-ctl-meas-len")}));break;case i.A.geom.POLYGON:t._activeMode=r.find((function(e){return e.matches(".tc-ctl-meas-area")}));break;case null:case void 0:t._activeMode=null}const n=r.filter((function(e){return e!==t._activeMode}));return e?t.div.querySelector(`sitna-tab[group="${t.id}-mode"][for="${t.id}-mode-${e}"]`).selected=!0:t.div.querySelectorAll(`sitna-tab[group="${t.id}-mode"]`).forEach((function(e){e.selected=!1})),t._activeMode&&(t._activeMode.classList.remove(i.A.classes.HIDDEN),t._activeMode.querySelector(".tc-ctl").classList.remove(i.A.classes.COLLAPSED)),n.forEach((function(e){e.classList.add(i.A.classes.HIDDEN)})),t}setMode(e){const t=this;var r;switch(t.mode=e,t.displayMode(e),e){case i.A.geom.POLYLINE:t.lineDrawControl.activate(),r=i.A.event.CONTROLACTIVATE;break;case i.A.geom.POLYGON:t.polygonDrawControl.activate(),r=i.A.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach((function(e){e.isActive&&e.deactivate()})),r=i.A.event.CONTROLDEACTIVATE;break;default:r=i.A.event.CONTROLACTIVATE}t.resetValues(),r&&t.map&&t.map.trigger(r,{control:t})}cancel(){return this.setMode(null,!1),this}displayMeasurements(e={}){const t=this;return Object.prototype.hasOwnProperty.call(e,"area")&&t.polygonMeasurementControl.displayMeasurement(e),Object.prototype.hasOwnProperty.call(e,"length")&&t.lineMeasurementControl.displayMeasurement(e),t}async getLineMeasurementControl(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="polyline"]')}async getPolygonMeasurementControl(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="polygon"]')}resetValues(){const e=this;return e.getLineMeasurementControl().then((e=>e.clearMeasurement())),e.getPolygonMeasurementControl().then((e=>e.clearMeasurement())),e}getDrawLines(){}getLayer(){const e=this;return e.layer?Promise.resolve(e.layer):e.layerPromise}async setLayer(e){const t=this;t.layer=e;for await(const e of[t.getLineDrawControl(),t.getPolygonDrawControl()])e.setLayer(t.layer)}async getLineDrawControl(){return await this.renderPromise(),this.div.querySelector(".tc-ctl-meas-len sitna-draw")}async getPolygonDrawControl(){return await this.renderPromise(),this.div.querySelector(".tc-ctl-meas-area sitna-draw")}exportState(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null}importState(e){this.layerPromise.then((function(t){t.importState(e.layer)}))}updateModel(){this.model.length=this.getLocaleString("length"),this.model.areaAndPerimeter=this.getLocaleString("areaAndPerimeter"),this.model.measure=this.getLocaleString("measure")}async updateLanguage(){this.updateModel()}}u.prototype.CLASS="tc-ctl-meas",n.A.control.Measure=u;const h=u},1993:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(3301),a=r(8848);n.A.control=n.A.control||{};class s extends a.default{constructor(){super(...arguments)}async loadTemplates(){const e=await r.e(2454).then(r.bind(r,2454));this.template=e.default}render(e){const t=this;return t.renderData({controlId:t.getId(),title:t.title,deselectableTabs:t.options.deselectableTabs,controls:t.controlOptions},(function(){t.div.querySelectorAll("sitna-tab").forEach(((e,t)=>{const r=e.target;new MutationObserver((function(e){e.forEach((function(e){e.target.classList.contains(i.A.classes.COLLAPSED)&&e.target.classList.remove(i.A.classes.COLLAPSED)}))})).observe(r,{attributes:!0}),e.callback=function(){this.selected&&r.classList.remove(i.A.classes.COLLAPSED)}})),"number"==typeof t.defaultSelection&&t.div.querySelectorAll("sitna-tab")[t.defaultSelection].onClick(),"function"==typeof e&&e()}))}async onRender(){const e=this;e.title=e.title||e.getLocaleString(e.options.title||"moreControls"),e.controlOptions.forEach(((t,r)=>{let n="",i={};void 0!==t.name&&void 0!==t.options?(console.log("Gestionamos config de tabContainer antiguo"),n=t.name,i=t.options):(n=Object.keys(t).find((e=>"title"!==e)),i=t[n]),e._ctlPromises[r]=e.map.addControl(n,o.A.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r)},i))}));const t=`.${e.CLASS}`,r=async function(r,n){await r.renderPromise();var i=r.div;do{i=i.parentElement}while(i&&!i.matches(t));r.controller.setAttribute(e.controlOptions[n].title,"text",i.querySelector(`sitna-tab[for="${e.getId()}-sel-${n}"]`))},n=await Promise.all(e._ctlPromises);for(var i=0,a=n.length;i<a;i++){const t=n[i];t.containerControl=e,await r(t,i)}return e}selectTab(e){const t=this.div.querySelectorAll("sitna-tab")[e];t&&(t.selected=!0)}onControlDisable(e){const t=this;t.getControls().then((r=>{const n=r.indexOf(e);if(n>=0){let i=n,o=e;do{i=(i+1)%r.length,o=r[i]}while(o.isDisabled&&o!==e);i!==n&&t.selectTab(i)}}))}async updateModel(){const e=this,t=await Promise.all(e._ctlPromises);for(var r=0,n=t.length;r<n;r++){const n=t[r],i=e.controlOptions[r].title;n.model[i]=e.getLocaleString(i)}}async updateLanguage(){this.updateModel()}}s.prototype.CLASS="tc-ctl-tctr",n.A.control.TabContainer=s;const l=s},2096:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>h,dn:()=>c,p0:()=>l,v7:()=>u});var n=r(915),i=r(4087),o=r(7430),a=r(7622);class s extends o.A{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return(0,n.Vy)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return(0,i.b0)()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=c(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){(0,i.b0)()}setLayout(e,t,r){let n;if(e)n=c(e);else{for(let e=0;e<r;++e){if(0===t.length)return this.layout="XY",void(this.stride=2);t=t[0]}n=t.length,e=l(n)}this.layout=e,this.stride=n}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(e,t){const r=this.getFlatCoordinates();if(r){const n=this.getStride();(0,a.e$)(r,0,r.length,n,e,t,r),this.changed()}}scale(e,t,r){void 0===t&&(t=e),r||(r=(0,n.q1)(this.getExtent()));const i=this.getFlatCoordinates();if(i){const n=this.getStride();(0,a.hs)(i,0,i.length,n,e,t,r,i),this.changed()}}translate(e,t){const r=this.getFlatCoordinates();if(r){const n=this.getStride();(0,a.Tl)(r,0,r.length,n,e,t,r),this.changed()}}}function l(e){let t;return 2==e?t="XY":3==e?t="XYZ":4==e&&(t="XYZM"),t}function c(e){let t;return"XY"==e?t=2:"XYZ"==e||"XYM"==e?t=3:"XYZM"==e&&(t=4),t}function u(e,t,r){const n=e.getFlatCoordinates();if(!n)return null;const i=e.getStride();return(0,a.Rc)(n,0,n.length,i,t,r)}const h=s},2151:e=>{var t={utf8:{stringToBytes:function(e){return t.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(t.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}};e.exports=t},2180:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(8038),i=r(1256);n.A.control=n.A.control||{};class o extends i.A{render(){const e=this;e.wrap||(e.wrap=new n.A.wrap.control.ScaleBar(e)),e.wrap.render();const t=Promise.resolve();return e._firstRender??=t,t}async register(e){const t=this;return(await Promise.all([super.register.call(t,e),e.wrap.getMap()]))[1].addControl(t.wrap.ctl),t}getText(){return this.wrap.getText()}}o.prototype.CLASS="tc-ctl-sb",n.A.control.ScaleBar=o;const a=o},2189:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(6378);n.A.control=n.A.control||{},n.A.control.ListTOC=i.default;const o=n.A.control.ListTOC},2268:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(3301),o=r(797),a=r(1421),s=r(5777),l=r(3791);n.A.control=n.A.control||{};class c{constructor(){this.share="",this.shareLink="",this.embedMap="",this.image="",this.shareMapAsImage="",this["shareLink.tip.1"]="",this["shareLink.tip.2"]="",this["shareLink.tip.3"]="",this.shareURL="",this.sendMapByEmail="",this.createQrCode="",this.shareMapToWhatsapp="",this.shareMapToTwitter="",this.shareMapToFacebook="",this.addToBookmarks="",this["embedMap.tip.1"]="",this["embedMap.tip.2"]="",this.createQrCodeToImage="",this.appendQRCode="",this.sharePNG="",this.shareJPG="",this.tooManyLayersLoaded="",this.shorten=""}}class u{constructor(){this.qrCode="",this.qrAdvice="",this.close=""}}class h extends a.default{MAILTO_MAX_LENGTH=256;IFRAME_WIDTH="600px";IFRAME_HEIGHT="450px";FEATURE_PARAM="showfeature";MOBILEFAV;NAVALERT;#k;#F;constructor(){super(...arguments);const e=this;e.#k=i.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e.#k),e.model=new c,e.dialogModel=new u}async register(e){const t=this;return await super.register.call(t,e),t.map.crossOrigin="anonymous",t.exportsState=!0,t.map.on(o.A.event.MAPCHANGE,function(e){const t=this.div.querySelector(".tc-url input[type=text]");t&&(t.dataset.update=!0),delete this.map._controlStatesCache}.bind(t)),e.loaded((()=>{t.div.classList.contains(o.A.classes.COLLAPSED)||t.update()})),t}async loadTemplates(){const e=this,t=r.e(2864).then(r.bind(r,2864)),n=r.e(7349).then(r.bind(r,7349)),i=r.e(7908).then(r.bind(r,7908)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-dialog"]=(await n).default,o[e.CLASS+"-confirm-dialog"]=(await i).default,e.template=o}async render(e){const t=this;t.#k.innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null),await super.renderData.call(t,{controlId:t.id,native:!!navigator.share},(function(){document.queryCommandSupported&&document.queryCommandSupported("copy")&&(t.div.querySelectorAll("button").forEach((function(e){e.classList.remove("hide")})),t.div.querySelectorAll("input[type=text]").forEach((function(e){delete e.dataset.dataOriginalTitle}))),t.addUIEventListeners(),i.A.isFunction(e)&&e(),t.controller=new s.A(t.model,new l.A(t.div)),t.dialogController=new s.A(t.dialogModel,new l.A(t.#k)),t.updateModel()}))}addUIEventListeners(){const e=this;e.div.querySelector("h2").addEventListener("click",(function(t){e.update()})),e.div.querySelector(`.${e.CLASS}-url-box sitna-toggle.${e.CLASS}-btn-shorten`).addEventListener("change",(function(t){const r=t.target;r.disabled=!0,r.checked||(e.div.querySelector("input.tc-textbox.tc-url").dataset.update=!0),e.#G(r,r.checked).then((()=>{r.disabled=!1}))})),e.div.querySelectorAll(`.${e.CLASS}-url-box sitna-button.${e.CLASS}-btn-copy`).forEach((t=>{t.addEventListener("click",(async function(t){const r=t.target,i=r.closest(".tc-ctl-share-url-box").querySelector("input.tc-textbox"),a=e.div.querySelector(`.${e.CLASS}-url-box sitna-toggle.${e.CLASS}-btn-shorten`);a&&(a.checked=!!i.dataset.shortened),navigator.clipboard?.writeText?(t.target.classList.add(o.A.classes.LOADING),await e.#G(r,a?.checked,i),navigator.clipboard?.writeText(i.value).then((()=>{t.target.classList.remove(o.A.classes.LOADING),e.map.toast(e.getLocaleString("copied"),{type:o.A.msgType.INFO})})).catch((e=>{"AbortError"!==e.name&&n.A.error(e),t.target.classList.remove(o.A.classes.LOADING)}))):(await e.#G(r,a?.checked,i),document.execCommand("copy"),t.target.classList.add(o.A.classes.LOADING),setTimeout((function(){t.target.classList.remove(o.A.classes.LOADING),e.#B()}),1e3))}))})),e.div.querySelector("input[type=text]").addEventListener("click",(function(t){const r=e.div.querySelector(`.${e.CLASS}-url-box sitna-toggle.${e.CLASS}-btn-shorten`);r.checked&&t.target.dataset.update&&(r.checked=!1),e.#G(t.target)})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-email`).addEventListener("click",(async function(t){const r=await e.shortenedLink();if(r){const t=encodeURIComponent(r+"\n");t.length>e.MAILTO_MAX_LENGTH&&e.map.toast(e.getLocaleString("urlTooLongForMailto"),{type:o.A.msgType.WARNING}),window.location.href="mailto:?body="+t}})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-qr`).addEventListener("click",(function(t){const r=e.#k.querySelector(`.${e.CLASS}-qrcode`);r.innerHTML="",e.#k.querySelector(`.${e.CLASS}-qr-alert`).classList.contains(o.A.classes.HIDDEN)?e.makeQRCode(r,256).then((function(t){t&&i.A.showModal(e.#k.querySelector(`.${e.CLASS}-qr-dialog`))})):i.A.showModal(e.#k.querySelector(`.${e.CLASS}-qr-dialog`))}));const t=function(t,r,i){r&&r.trim().length>0?t.location.href=i(r):(n.A.error(e.getLocaleString("urlTooLongForShortener")),t.close())};e.div.querySelector(`sitna-button.${e.CLASS}-btn-facebook`).addEventListener("click",(function(r){const n=window.open();e.shortenedLink().then((function(e){t(n,e,(function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)}))}))})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-twitter`).addEventListener("click",(function(r){const n=window.open();e.shortenedLink().then((function(e){t(n,e,(function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&url="+encodeURIComponent(e)}))}))})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-whatsapp`).addEventListener("click",(function(t){e.shortenedLink().then((async function(t){if(i.A.detectMobile()){const r="whatsapp://send?text=";location.href=void 0!==t?r+encodeURIComponent(t):r+encodeURIComponent(await e.generateLink())}else{const r="https://wa.me/?text=";void 0!==t?window.open(r+encodeURIComponent(t),"_blank"):window.open(r+encodeURIComponent(await e.generateLink()),"_blank")}}))})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-bookmark`).addEventListener("click",(async function(t){var r=await e.generateLink(),n=document.title;i.A.detectMobile()?alert(e.MOBILEFAV):window.sidebar&&window.sidebar.addPanel?window.sidebar.addPanel(n,r,""):window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print?(window.location.href=r,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)):window.external&&"AddFavorite"in window.external?window.external.AddFavorite(r,n):(window.location.href=r,alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT))})),e.div.querySelector(`sitna-button.${e.CLASS}-btn-native`)?.addEventListener("click",(async function(t){t.target.classList.add(o.A.classes.LOADING),e.shortenedLink().then((async function(r){try{const t={title:document.title,url:r};t.text=document.querySelector("meta[name='description'][lang='"+e.map.options.locale+"'],meta[name='description'][lang='"+e.map.options.locale.substring(0,2)+"']")?.getAttribute("content"),navigator.userActivation?.isActive||await e.confirmDialog(e.getLocaleString("shareURLConfirm")),await navigator.share(t)}catch(e){e&&"AbortError"!==e.name&&n.A.error(e)}t.target.classList.remove(o.A.classes.LOADING)}))})),e.div.querySelector(`button.${e.CLASS}-btn-png-native`)?.addEventListener("click",(async function(t){t.target.classList.add(o.A.classes.LOADING);try{e.#U("image/png").then((()=>{t.target.classList.remove(o.A.classes.LOADING)}))}catch(e){"AbortError"!==e.name&&n.A.error(e)}t.target.classList.remove(o.A.classes.LOADING),t.target.active=!1})),e.div.querySelector(`button.${e.CLASS}-btn-jpg-native`)?.addEventListener("click",(async function(t){t.target.classList.add(o.A.classes.LOADING);try{await e.#U("image/jpeg").then((()=>{t.target.classList.remove(o.A.classes.LOADING)}))}catch(e){"AbortError"!==e.name&&n.A.error(e)}t.target.classList.remove(o.A.classes.LOADING),t.target.active=!1}))}async#G(e,t,r=null){const n=this,i=r||n.div.querySelector("input.tc-textbox.tc-url");if(t){if(i.dataset.update||!i.dataset.shortened){const t=await n.shortenedLink();if(t&&t.trim().length>0){const r=e.title;e.title=n.getLocaleString("shortened"),setTimeout((function(){e.title=r,n.#B()}),1e3),delete i.dataset.update,i.dataset.shortened=!0,i.value=t,i.select()}else delete i.dataset.update,delete i.dataset.shortened,i.value=await n.generateLink()}}else i.classList.contains("tc-url")?i.dataset.update&&(delete i.dataset.update,delete i.dataset.shortened,i.value=await n.generateLink()):i.value=await n.generateIframe(),i.select()}async#U(e){const t=this,r=t.div.querySelector(`.${t.CLASS}-chk-qr`).checked,i=await t.generateImage(e,!0,r),a=document.title+"."+e.substr(e.indexOf("/")+1),s={title:a,files:[new File([i],a,{type:e})]};if(navigator.canShare(s)){if(navigator.userActivation?.isActive)return navigator.share(s);try{return await t.confirmDialog(t.getLocaleString("shareImageConfirm")),navigator.share(s)}catch(e){e&&e.name&&n.A.error(e)}}else t.map.toast(t.getLocaleString("shareFileNotsupported"),{type:o.A.msgType.ERROR})}#B(){document.getSelection().removeAllRanges(),document.getSelection().addRange(document.createRange())}getLocation(){var e=window.location.href;return window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash))),e}manageMaxLengthExceed(e){const t=this;t.div.querySelector(`.${t.CLASS}-alert`).classList.toggle(o.A.classes.HIDDEN,!e.browser),t.#k.querySelector(`.${t.CLASS}-qr-alert`).classList.toggle(o.A.classes.HIDDEN,!e.qr)}async generateIframe(e){const t=this,r=e||await t.generateLink();return r?'<iframe style="width:'+t.IFRAME_WIDTH+";height:"+t.IFRAME_HEIGHT+';" src="'+r+'"></iframe>':""}loadParamFeature(){const e=this;let t=null;const r=i.A.getParameterByName(e.FEATURE_PARAM);if(r){let i;try{i=JSON.parse(decodeURIComponent(escape(window.atob(r))))}catch(t){n.A.error(e.getLocaleString("sharedFeatureNotValid"),o.A.msgErrorMode.TOAST)}i&&e.map&&(i.geom?e.map.addLayer({id:e.getUID(),type:o.A.layerType.VECTOR,title:e.getLocaleString("foi"),owner:e,stealth:!0}).then((function(t){e.paramFeatureLayer=t,t.importState({features:[i]}).then((function(){e.map.zoomToFeatures(t.features)}))})):t=i)}return t}async update(){const e=this,t=e.div.querySelector(".tc-url input[type=text]");if(0===t.value.trim().length){e.updateUI();const r=await e.generateLink();e.registerListeners(),t.value=r,e.div.querySelector(".tc-iframe input[type=text]").value=await e.generateIframe(r)}}updateUI(){const e=this,t=e.div.querySelector(`.${e.CLASS}-icons`),r=e.div.querySelectorAll(`.${e.CLASS}-url-box tc-textbox`),n=e.div.querySelectorAll(`.${e.CLASS}-url-box button`),i=e.div.querySelector("."+e.CLASS+"-alert");t.classList.add(o.A.classes.LOADING),r.forEach((e=>e.disabled=!0)),n.forEach((e=>{e.classList.add(o.A.classes.LOADING),e.disabled=!0})),i.classList.add(o.A.classes.LOADING),r.forEach((e=>e.disabled=!1)),n.forEach((e=>{e.disabled=!1,e.classList.remove(o.A.classes.LOADING)})),t.classList.remove(o.A.classes.LOADING),i.classList.remove(o.A.classes.LOADING)}async generateLink(){return await a.default.prototype.generateLink.call(this)}async confirmDialog(e){const t=this;return t.#F||(t.#F=i.A.getDiv(),document.body.appendChild(t.#F)),t.#F.innerHTML=await t.getRenderedHtml(t.CLASS+"-confirm-dialog",{message:e}),new Promise(((e,r)=>{const n=()=>{i.A.closeModal(),e()},o=t.#F.querySelector(".tc-modal-ok");o.addEventListener("click",n),i.A.showModal(t.#F.querySelector(`.${t.CLASS}-confirm-dialog`),{closeCallback:()=>{o.removeEventListener("click",n),r()}})}))}updateModel(){this.model.share=this.getLocaleString("share"),this.model.shareLink=this.getLocaleString("shareLink"),this.model.embedMap=this.getLocaleString("embedMap"),this.model.image=this.getLocaleString("image"),this.model.shareMapAsImage=this.getLocaleString("shareMapAsImage"),this.model["shareLink.tip.1"]=this.getLocaleString("shareLink.tip.1"),this.model["shareLink.tip.2"]=this.getLocaleString("shareLink.tip.2"),this.model["shareLink.tip.3"]=this.getLocaleString("shareLink.tip.3"),this.model.shareURL=this.getLocaleString("shareURL"),this.model.sendMapByEmail=this.getLocaleString("sendMapByEmail"),this.model.createQrCode=this.getLocaleString("createQrCode"),this.model.shareMapToWhatsapp=this.getLocaleString("shareMapToWhatsapp"),this.model.shareMapToTwitter=this.getLocaleString("shareMapToTwitter"),this.model.shareMapToFacebook=this.getLocaleString("shareMapToFacebook"),this.model.addToBookmarks=this.getLocaleString("addToBookmarks"),this.model["embedMap.tip.1"]=this.getLocaleString("embedMap.tip.1"),this.model["embedMap.tip.2"]=this.getLocaleString("embedMap.tip.2"),this.model.createQrCodeToImage=this.getLocaleString("createQrCodeToImage"),this.model.appendQRCode=this.getLocaleString("appendQRCode"),this.model.sharePNG=this.getLocaleString("sharePNG"),this.model.shareJPG=this.getLocaleString("shareJPG"),this.model.tooManyLayersLoaded=this.getLocaleString("tooManyLayersLoaded"),this.model.shorten=this.getLocaleString("shorten"),this.dialogModel.qrCode=this.getLocaleString("qrCode"),this.dialogModel.qrAdvice=this.getLocaleString("qrAdvice"),this.dialogModel.close=this.getLocaleString("close"),this.MOBILEFAV=this.getLocaleString("mobileBookmarks.instructions"),this.NAVALERT=this.getLocaleString("bookmarks.instructions")}async updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-share",n.A.control.Share=h;const d=h},2283:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(4087),i=r(8217);class o extends i.Ay{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(a(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(a(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return(0,n.b0)()}readFeaturesFromObject(e,t){return(0,n.b0)()}readGeometry(e,t){return this.readGeometryFromObject(a(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return(0,n.b0)()}readProjection(e){return this.readProjectionFromObject(a(e))}readProjectionFromObject(e){return(0,n.b0)()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return(0,n.b0)()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return(0,n.b0)()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return(0,n.b0)()}}function a(e){if("string"==typeof e){return JSON.parse(e)||null}return null!==e?e:null}const s=o},2335:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(4450),l=r(3791),c=r(5777);n.A.control=n.A.control||{};class u{constructor(){this.addMaps="",this.writeAddressOrSelect="",this["addService.title"]="",this.addService="",this.addWMS=""}}class h extends a.A{#q=[];constructor(){super(...arguments);const e=this;e.count=0,e.allowReprojection=!Object.prototype.hasOwnProperty.call(e.options,"allowReprojection")||e.options.allowReprojection,e.model=new u}async register(e){const t=this;return await super.register.call(t,e),e.on(i.A.event.LAYERADD,(function(e){const r=e.layer;if(r&&!r.isBase){var n=r.url;if(n){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[],0===t.div.querySelectorAll("select option").length&&n&&-1===t.pending_markServicesAsSelected.indexOf(n)&&t.pending_markServicesAsSelected.push(n);const e=[];t.div.querySelectorAll("select option").forEach((function(t){t.value.replace(/https?:\/\/|\/\//,"")===n.replace(/https?:\/\/|\/\//,"")&&e.push(t)})),t.markServicesAsSelected(e),t.#q.push(n)}}})),t}async loadTemplates(){const e=await r.e(5600).then(r.bind(r,5600));this.template=e.default}render(e){const t=this;return t.renderData(t.options,(function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[],t.pending_markServicesAsSelected.forEach((function(e){const r=[];t.div.querySelectorAll("select option").forEach((function(t){o.A.addProtocol(t.value)===o.A.addProtocol(e)&&r.push(t)})),t.markServicesAsSelected(r),t.#q.push(e)})),t.pending_markServicesAsSelected=[],t.addUIEventListeners(),"function"==typeof e&&e(),t.controller=new c.A(t.model,new l.A(t.div)),t.updateModel()}))}addUIEventListeners(){const e=this;e.div.querySelector("select").addEventListener("change",(function(t){if(""!==t.target.value){var r=t.target.value;0===r.indexOf("//")&&(r=location.protocol+r),e.div.querySelector("input").value=r,t.target.value=""}})),e.div.querySelector('sitna-button[name="agregar"]').addEventListener("click",(function(t){e.addWMS()})),e.div.querySelector("input").addEventListener("keyup",(t=>{t.key&&"enter"===t.key.toLowerCase()&&e.div.querySelector("input").value.trim().length>0&&e.addWMS()}))}addWMS(e){const t=this;let r=e??t.div.querySelector("input").value.trim();if(r)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(r)){const e=function(e,t){for(var r=0;r<t.length;r++)e=o.A.removeURLParameter(e,t[r]);return e.match(/\?$/)&&(e=e.substr(0,e.length-1)),e};t.#q.some((function(e){return e.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")}))?n.A.alert(t.getLocaleString("serviceAlreadyAdded")):t.map.wait((async()=>{var a=o.A.getQueryStringParams(r);/https?:\/\/|\/\//i.test(r)||(r="//"+r);var l=["version","service","request"],c=e(r,Object.keys(a));for(var u in a)l.indexOf(u.toLowerCase())>=0&&delete a[u];const h=t.div.querySelector("sitna-button");h.disabled=!0;for(var d={id:"xwms"+ ++t.count,type:"WMS",url:c,hideTree:!1,queryParams:a},p=0;p<t.options.suggestions.length;p++){var g=t.options.suggestions[p].items.filter((e=>e.url===r));if(g.length>0&&g[0].layerNames){d.layerNames=g[0].layerNames;break}}var f=new s.A(d);try{const e=await f.getCapabilitiesPromise();if(void 0===e.Capability)return n.A.alert(t.getLocaleString("noLayersFoundInService")),void(h.disabled=!1);{var m=e.Capability.Layer;if(m.CRS&&-1===m.CRS.indexOf(t.map.crs)&&!t.allowReprojection)return n.A.alert(t.getLocaleString("serviceSrsNotCompatible")),void(h.disabled=!1);t.map.trigger(i.A.event.EXTERNALSERVICEADDED,{layer:f}),t.div.querySelector("input").value="";const o=[];t.div.querySelectorAll("select option").forEach((function(e){e.value.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")&&o.push(e)})),t.markServicesAsSelected(o),t.#q.push(r),h.disabled=!1}}catch(e){n.A.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e),h.disabled=!1}}))}else n.A.alert(t.getLocaleString("typeAValidAddress"));else n.A.alert(t.getLocaleString("typeAnAddress"));return t}markServicesAsSelected(e){if(e.length>0){const t=e[0];t.disabled=!0,t.classList.add("tc-ctl-xwms-option-selected")}}updateModel(){const e=this;e.model.addMaps=e.getLocaleString("addMaps"),e.model.writeAddressOrSelect=e.getLocaleString("writeAddressOrSelect"),e.model["addService.title"]=e.getLocaleString("addService.title"),e.model.addService=e.getLocaleString("addService"),e.model.addWMS=e.getLocaleString("addWMS")}async updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-xwms",n.A.control.ExternalWMS=h;const d=h},2376:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(1845),i=r(797),o=r(3301),a=r(8038),s=r(3791),l=r(5777);const c="sitna-language-option";class u{constructor(){this.selectLanguage=""}}class h extends HTMLElement{#W;constructor(e){super();const t=this;t.#W=t.querySelector(`a.${t.CLASS}`),t.#W||(t.#W=document.createElement("a"),t.#W.classList.add(t.CLASS),t.appendChild(t.#W)),e&&(t.fullCode=e.fullCode,t.shortCode=e.shortCode,t.description=e.description)}connectedCallback(){this.#H(),this.#j()}static get observedAttributes(){return["full-code","short-code","description","href"]}attributeChangedCallback(e,t,r){t!==r&&("short-code"===e?this.#H():"description"===e&&this.#j())}get fullCode(){return this.getAttribute("full-code")}set fullCode(e){this.setAttribute("full-code",e)}get shortCode(){return this.getAttribute("short-code")}set shortCode(e){this.setAttribute("short-code",e)}#H(){const e=this.shortCode;this.#W.dataset.langCode=e;let t=this;do{t=t.parentElement}while(t&&!(t instanceof p));this.#W.href=t?.getUrl(e),this.#W.innerHTML=e}get description(){return this.getAttribute("description")}set description(e){this.setAttribute("description",e)}#j(){this.#W.setAttribute("title",this.description)}get href(){return this.#W.getAttribute("href")}set href(e){this.#W.setAttribute("href",e)}}h.prototype.CLASS="tc-ctl-lang-link",customElements.get(c)||customElements.define(c,h);const d="sitna-language-select";class p extends n.default{static PARAMETER_NAME="lang";static COOKIE_NAME="SITNA.language";static#V;constructor(){super(...arguments);const e=this;e.languages=[],e.options.static&&(e.static=!0),e.options.noReload&&(e.noReload=!0),e.tagAttributeName=e.options.tagAttributeName||"data-sitna-i18n",e.model=new u}connectedCallback(){const e=this;if(super.connectedCallback(),e.languages=Array.from(e.querySelectorAll("sitna-language-option")),!e.languages.length){const t=e.options.languages||[{fullCode:"es-ES",shortCode:"es",description:"Ver en castellano"},{fullCode:"eu-ES",shortCode:"eu",description:"Euskaraz ikusi"},{fullCode:"en-US",shortCode:"en",description:"View in English"}];e.languages=t.map((e=>new h(e))),e.render()}e.static||(e.collapsed=e.collapsed||!0);const t=Array.from(e.querySelectorAll("sitna-language-option"));t.length&&(e.languages=t)}static get observedAttributes(){return["static","collapsed","noreload"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"static"===e&&(n.static=n.hasAttribute(e)),"collapsed"===e&&(n.collapsed=n.hasAttribute(e)),"noreload"===e&&(n.noReload=n.hasAttribute(e))}get static(){return this.hasAttribute("static")}set static(e){e?this.setAttribute("static",""):this.removeAttribute("static")}get noReload(){return this.hasAttribute("noreload")}set noReload(e){e?this.setAttribute("noreload",""):this.removeAttribute("noreload")}get collapsed(){return this.hasAttribute("collapsed")}set collapsed(e){e?this.setAttribute("collapsed",""):this.removeAttribute("collapsed")}register(e){const t=super.register.call(this,e);return e.ready((()=>p.setDocumentTexts())),t}async loadTemplates(){const e=await r.e(4352).then(r.bind(r,4352));this.template=e.default}async render(){const e=this;await e.renderData({languages:e.languages});const t=e.querySelector(`.${e.CLASS}-links`);let r;e.languages.forEach((e=>{t.appendChild(e);const n=e.querySelector(`a.${e.CLASS}`);p.currentLocale===e.fullCode&&(r=n)})),r??=(e.languages.find((e=>e.fullCode===p?.currentLocale))||e.languages[0])?.querySelector(`a.${e.languages[0].CLASS}`),r?.classList.add(i.A.classes.ACTIVE),e.toggle=e.querySelector(`.${e.CLASS}-toggle`),e.addUIEventListeners(),e.controller=new l.A(e.model,new s.A(e)),e.model.selectLanguage=e.getLocaleString("selectLanguage")}addUIEventListeners(){const e=this;e.languages.forEach((t=>{t.querySelector(`a.${t.CLASS}`).addEventListener(i.A.event.CLICK,(function(t){t.preventDefault(),e.setLanguage(t.target.dataset.langCode)}))})),e.toggle.addEventListener(i.A.event.CLICK,(function(t){e.collapsed=!e.collapsed}))}getUrl(e){return o.A.addURLParameters(window.location.href,{[p.PARAMETER_NAME]:e})}setLanguage(e){const t=this,r=t.languages.map((e=>e.querySelector(`a.${e.CLASS}`)));if(r.forEach((e=>e.classList.remove(i.A.classes.ACTIVE))),r.find((t=>t.dataset.langCode===e))?.classList.add(i.A.classes.ACTIVE),t.noReload){const r=t.languages.find((t=>t.shortCode===e)).fullCode;p.currentLocale=r,t.map.setLanguage(r).then((()=>{console.log("language changed")}),(e=>{console.log("language not changed: "+e)}))}else window.location.href=t.getUrl(e)}static setDocumentTexts(){document.querySelectorAll(`[${self.tagAttributeName}]`).forEach((function(e){let t=e.innerHTML;const r=t.match(/\{\{([^\{\}]+)\}\}/g);if(r)for(var n=0,i=r.length;n<i;n++){const e=r[n],i=e.match(/[^\{\}]+/)[0];t=t.replace(e,o.A.getLocaleString(p.currentLocale,i))}e.innerHTML!==t&&(e.innerHTML=t)}))}static get currentLocale(){return p.#V||(p.#V=o.A.getLocaleUserChoice({cookieName:p.COOKIE_NAME,paramName:p.PARAMETER_NAME})),p.#V}static set currentLocale(e){var t=new Date((new Date).getTime()+31536e6),r=e.indexOf("-");r>=0&&(e=e.substr(0,r)),o.A.storage.setCookie(p.COOKIE_NAME,e,{expires:t})}static get cookieName(){return p.COOKIE_NAME}static set cookieName(e){p.COOKIE_NAME,p.COOKIE_NAME=e,p.#V=null}}p.currentLocale,a.A.control=a.A.control||{},a.A.control.LanguageSelector=p,p.prototype.CLASS="tc-ctl-lang-select",customElements.get(d)||customElements.define(d,p);const g=p},2484:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(8038),i=r(1993),o=r(3791),a=r(5777);n.A.control=n.A.control||{};class s{constructor(){this.title=""}}class l extends i.default{constructor(){super(...arguments);const e=this;e.controlOptions=[{title:"addWMS",externalWMS:{suggestions:e.options.wmsSuggestions}},{title:"openFile",fileImport:{enableDragAndDrop:e.options.enableDragAndDrop}}],e.defaultSelection=0,e.model=new s}async register(e){this.map=e;const t=await super.register.call(this,e);return t.div.classList.add(i.default.prototype.CLASS+"-datldr"),t}async render(e){const t=this;t.title=t.getLocaleString("addMaps"),await super.render(e),new a.A(t.model,new o.A(t.div)),t.updateModel()}updateModel(){this.model.title=this.getLocaleString("addMaps"),super.updateModel()}async updateLanguage(){this.updateModel()}}n.A.control.DataLoader=l;const c=l},2497:(e,t,r)=>{"use strict";function n(e,t,r,n){for(let n=0,i=r.length;n<i;++n)e[t++]=r[n];return t}function i(e,t,r,n){for(let i=0,o=r.length;i<o;++i){const o=r[i];for(let r=0;r<n;++r)e[t++]=o[r]}return t}function o(e,t,r,n,o){o=o||[];let a=0;for(let s=0,l=r.length;s<l;++s){const l=i(e,t,r[s],n);o[a++]=l,t=l}return o.length=a,o}function a(e,t,r,n,i){i=i||[];let a=0;for(let s=0,l=r.length;s<l;++s){const l=o(e,t,r[s],n,i[a]);0===l.length&&(l[0]=t),i[a++]=l,t=l[l.length-1]}return i.length=a,i}r.d(t,{KG:()=>o,_n:()=>n,d6:()=>a,z2:()=>i})},2616:(e,t,r)=>{"use strict";r.d(t,{J:()=>o,p:()=>a});var n=r(6514),i=r(2845);function o(e,t,r,o,a,s,l){let c,u,h,d,p,g,f;const m=a[s+1],y=[];for(let n=0,i=r.length;n<i;++n){const i=r[n];for(d=e[i-o],g=e[i-o+1],c=t;c<i;c+=o)p=e[c],f=e[c+1],(m<=g&&f<=m||g<=m&&m<=f)&&(h=(m-g)/(f-g)*(p-d)+d,y.push(h)),d=p,g=f}let v=NaN,A=-1/0;for(y.sort(n.V_),d=y[0],c=1,u=y.length;c<u;++c){p=y[c];const n=Math.abs(p-d);n>A&&(h=(d+p)/2,(0,i.zb)(e,t,r,o,h,m)&&(v=h,A=n)),d=p}return isNaN(v)&&(v=a[s]),l?(l.push(v,m,A),l):[v,m,A]}function a(e,t,r,n,i){let a=[];for(let s=0,l=r.length;s<l;++s){const l=r[s];a=o(e,t,l,n,i,2*s,a),t=l[l.length-1]}return a}},2639:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(9566),c=r(6792),u=r(5264),h=r(6631),d=r(5246),p=r(5777),g=r(3791);n.A.control=n.A.control||{},n.A.filter=h.A,n.A.UI=n.A.UI||{},n.A.UI.autocomplete=d.A,n.A.Defaults=o.H,window.performance?window.performance&&!window.performance.now&&(window.performance.offset=Date.now(),window.performance.now=function(){return Date.now()-window.performance.offset}):window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}};class f{#z=[];#Y=new Map;constructor(e,t,r){const o=this;if(o.parent=r,a.A.extend(o,t),o.version=o.version||"1.1.0",!o.searchFunction&&o.parser){const e=o,t=o.#$;o.searchFunction=async function(r){const n=this,i=e.parser(r);if(!i)throw"Search: no pattern match with "+e.typeName;n.resultsList.innerHTML=e.getSuggestionListHeader()+'<li data-role="'+e.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+n.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',n.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete"));const o=e.getFeatureTypes();for(var a=0,s=o.length;a<s;a++)await e.describeFeatureType(o[a]);return await t.call(e,e.filter.getParams(i),n.searchRequestsAbortController.signal)}}if(!o.queryFactory){const e=o;o.queryFactory=function(t){const r={};return r.params={type:i.A.layerType.WFS,url:e.url,version:e.version,geometryName:e.geometryName,featurePrefix:e.featurePrefix,featureType:e.getFeatureTypes(),maxFeatures:3e3,filter:e.filter.getGoToFilter(t),outputFormat:e.outputFormat,styles:e.styles},r}}o.typeName=e,o.filter=function(e){const r=function(t,r){var n=[];if(r!=e.parent.rootCfg.active.root)if(-1!==r.indexOf("#")||e.parent.rootCfg.active.limit){const t=r.split("#");e.parent.rootCfg.active.dataIdProperty.length>1?n.push(new h.A.And(...e.parent.rootCfg.active.dataIdProperty.map(((r,n)=>e.filter.getFilterNode(r,t.length>n?t[n]:t[0]))))):n.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[0],t[0]))}else{const t=e.parent.rootCfg.active.queryProperties.firstQueryWord.map((function(t){return e.filter.getFilterNode(t,r)}));t.length>1?n.push(new h.A.And(...t)):n.push(t[0])}else{const t=e.parent.rootCfg.active.root.map((function(t){return e.parent.rootCfg.active.dataIdProperty.length>1?new h.A.And(...e.parent.rootCfg.active.dataIdProperty.map(((r,n)=>e.filter.getFilterNode(r,t.length>n?t[n]:t[0])))):e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[0],t[0])}));t.length>1?n.push(new h.A.Or(...t)):n.push(t[0])}return t.concat(n)},o=function(t,r){const n=e.getFeatureTypes(),i=e.#Y.get(n[0])?.[t];return"xsd:string"===i?.["@type"]&&r.indexOf(e.parent._LIKE_PATTERN)<0?e.parent._LIKE_PATTERN+r+e.parent._LIKE_PATTERN:r};return{getPropertyValue:function(t,r){return e.getSearchTypeByRole(t)[r]},getIsLikeNode:function(t,r){r=o(t,r);var n=/([\-\"\.\xba\(\)\/])/g;if(n.test(r)&&(r=r.replace(n,"\\$1")),r.toString().indexOf(e.parent._LIKE_PATTERN)>-1){const e=[];return e.push(new h.A.IsLike(t,r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;"),"*","_","\\",!1)),e.push(new h.A.IsLike(t,r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;"),"*","_","\\",!1)),new h.A.Or(...e)}return new h.A.EqualTo(t,r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;"))},getFunctionStrMatches:function(t,r){r=o(t,r);var n=/([\-\"\xba\(\)\/])/g;if(n.test(r)&&(r=r.replace(n,"\\$1")),r.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var i=r;return i=(i=(i=(i=(i=i.replace(/a/gi,"[aáà]")).replace(/e/gi,"[eéè]")).replace(/i/gi,"[iíì]")).replace(/o/gi,"[oóò]")).replace(/u/gi,"[uúüù]"),new h.A.EqualTo(new h.A.Function("strMatches",{PropertyName:t,Literal:"(?i)"+i.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")}),!0)}return new h.A.EqualTo(t,r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;"))},getFilterNode:function(r,n){var i=e.filter.getIsLikeNode;if(e.filterByMatch){i=e.filter.getFunctionStrMatches;var a=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");n=n.replace(a,e.parent._MATCH_PATTERN)}if(r instanceof Array||"string"==typeof r)return r instanceof Array&&r.length>1?new h.A.Or(...r.map((e=>i(e.trim(),o(e.trim(),n),t)))):i(r instanceof Array&&1===r.length?r[0].trim():r.trim(),n);{const e=[];for(var s in r)if(r[s]instanceof Array&&r[s].length>1)e.push(new h.A.Or(...r[s].map((e=>i(e.trim(),n,t)))));else{var l=r[s];r[s]instanceof Array&&1===r[s].length&&(l=r[s][0]),e.push(i(l.trim(),n))}return new h.A.Or(...e)}},getFilter:function(t){var n,o={f:""};switch(!0){case e.typeName===i.A.searchType.POSTALADDRESS:if(n=[],e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(t[0])&&!/(\<|\>|\<\>)/gi.exec(t[1]))e.parent.rootCfg.active?n=r(n,t[0]):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0])),n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1]));else{let i=/(\<|\>|\<\>)/gi.exec(t[0]);i?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0].substring(0,t[0].indexOf(i[0])).trim())):e.parent.rootCfg.active?n=r(n,t[0]):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0])),i=/(\<|\>|\<\>)/gi.exec(t[1]),i?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1].substring(0,t[1].indexOf(i[0])).trim())):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1]))}n.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,t[2]+e.parent._LIKE_PATTERN)),n=new h.A.And(...n),o.f=n.getText();break;case e.typeName===i.A.searchType.STREET:if(n=[],e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(t[0])&&!/(\<|\>|\<\>)/gi.exec(t[1]))e.parent.rootCfg.active?n=r(n,t[0]):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0])),n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1]));else{let i=/(\<|\>|\<\>)/gi.exec(t[0]);i?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0].substring(0,t[0].indexOf(i[0])).trim())):e.parent.rootCfg.active?n=r(n,t[0]):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0])),i=/(\<|\>|\<\>)/gi.exec(t[1]),i?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1].substring(0,t[1].indexOf(i[0])).trim())):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1]))}n=new h.A.And(...n),o.f=n.getText();break;case Object.prototype.hasOwnProperty.call(e.queryProperties,"secondQueryWord"):n=new h.A.And(e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0]),e.filter.getFilterNode(e.queryProperties.secondQueryWord,t[1])),o.f=n.getText();break;default:n=e.filter.getFilterNode(e.queryProperties.firstQueryWord,t[0]),o.f=n.getText()}return o},getParams:function(t){var r=e.filter.getFilter(t),n={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},i=e.getFeatureTypes(!0);if(i instanceof Array){var o=i.map((t=>e.featurePrefix?e.featurePrefix+":"+t.trim():t.trim()));n.TYPENAME=o.join(",")}else n.TYPENAME=e.featurePrefix?e.featurePrefix+":"+i.trim():i.trim();var s=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var r in e){var n=e[r][0];e[r].length>1&&(n=e[r].join(",")),t.push(n)}return t}},l=s(e.outputProperties),c=s(e.dataIdProperty);const u=e=>{const t=e.split(",");return t.filter(((e,r)=>t.indexOf(e)===r)).join(",")};if(l instanceof Array&&c instanceof Array){n.PROPERTYNAME="";for(var h=0;h<l.length;h++)n.PROPERTYNAME+="("+u(l[h]+","+c[h])+")"}else n.PROPERTYNAME=u(l+","+c);return n.FILTER=r.f,a.A.getParamString(n)},getGoToFilter:function(t){var r=[],n=t.split("#"),i=e.dataIdProperty,o=e.getFeatureTypes();if(i&&o)if(t.indexOf("#")>-1&&o instanceof Array&&o.length>1)o.forEach((e=>{i[e].forEach(((e,t)=>{r.push({name:e,value:n[t]})}))}));else if(-1===t.indexOf("#")&&o instanceof Array){let e=i;o.forEach((t=>{Object.prototype.hasOwnProperty.call(r,t)||(e instanceof Object&&Object.prototype.hasOwnProperty.call(i,t)&&(e=i[t]),e.forEach(((e,t)=>{t<n.length&&r.push({name:e,value:n[t]})})))}))}else i instanceof Object&&Object.prototype.hasOwnProperty.call(i,o)&&(i=i[o]),i.forEach(((e,t)=>{r.push({name:e,value:n[t]})}));return e.filter.transformFilter(r)},transformFilter:function(e){if(e&&e instanceof Array){var t=e.map((function(e){return Object.prototype.hasOwnProperty.call(e,"type")?1==(e.type===i.A.comparison.EQUAL_TO)?new n.A.filter.equalTo(e.name,e.value):void 0:new n.A.filter.equalTo(e.name,e.value)}));return t.length>1?n.A.filter.and.apply(null,t):t[0]}}}}(o)}#K(){throw new Error("Error en la configuración de la búsqueda: "+this.typeName)}getFeatureTypes(e){const t=this;if(e)return t.featureType instanceof Array?t.featureType:[t.featureType];if(0===t.#z.length){var r=t.featureType instanceof Array?t.featureType:[t.featureType],n=t.renderFeatureType?t.renderFeatureType instanceof Array?t.renderFeatureType:[t.renderFeatureType]:[];t.#z=r.concat(n)}return t.#z}async describeFeatureType(e){const t=this;if(t.#z.includes(e)){let r=t.#Y.get(e);if(!r){const n=new c.A({url:t.url,type:i.A.layerType.WFS,featureType:e});r=await n.describeFeatureType(),t.#Y.set(e,r)}return r}return null}isFeatureOfThisType(e){return this.getFeatureTypes().indexOf(e)>-1}getStyleByFeatureType(e){const t=this;return t.getFeatureTypes().indexOf(e)>-1?t.styles[t.getFeatureTypes().indexOf(e)]:null}getColor(e,t,r){const n=this;var i=function(e,t,r){if(t){if(Object.prototype.hasOwnProperty.call(e,t)&&Object.prototype.hasOwnProperty.call(e[t],r))return e[t][r]}else for(var n in e)if(Object.prototype.hasOwnProperty.call(e[n],r))return e[n][r]};if(r)return i(n.getStyleByFeatureType(r),t,e);for(var o=0;o<n.styles.length;o++){const r=i(n.styles[o],t,e);if(r)return r}}getSuggestionListHeader(){const e=this;var t,r,n;if(Object.prototype.hasOwnProperty.call(e,"suggestionListHead"))if("function"==typeof e.suggestionListHead)t=e.suggestionListHead(),r=t.label,n=[{color:t.color,title:r}];else if(t=e.suggestionListHead,r=e.parent.getLocaleString(t.label),"string"==typeof t.color)n=[{color:e.getColor(t.color),title:r}];else if(t.color instanceof Array){const i=e.getFeatureTypes();t.color.length===i.length?n=t.color.map((function(t,n){return{color:e.getColor(t[i[n]].color.css,t[i[n]].color.geomType,i[n]),title:e.parent.getLocaleString(t[i[n]].title)||r}})):e.#K()}else"object"==typeof t.color&&(n=[{color:e.getColor(t.color.css,t.color.geomType),title:r}]);else if("function"==typeof e.suggestionListHeader)t=e.suggestionListHeader(),r=t.labelKey,n=[{color:t.colorSource,title:r}];else{const i=(t=e.suggestionListHeader).colorSource;if(r=e.parent.getLocaleString(t.labelKey),"string"==typeof i)n=[{color:e.getColor(i),title:r}];else if(i instanceof Array){const t=e.getFeatureTypes();i.length===t.length?n=i.map((function(t){return{color:e.getColor(t.colorSource.propertyName,t.colorSource.geometryType,t.featureType),title:e.parent.getLocaleString(t.tooltipKey)||r}})):e.#K()}else"object"==typeof i&&(n=[{color:e.getColor(i.propertyName,i.geometryType),title:r}])}if(r&&n)return'<li class="tc-header"><span class="tc-header">'+r+"</span>"+(n.map((function(e){if(e.color)return'<span class="tc-header-color" title="'+e.title+'" style="background-color: '+e.color+';"></span>'})).join("")+"</li>");e.#K()}getSuggestionListElements(e){const t=this;var r=[],n=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(Number.isNaN(e)&&Number.isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},i=function(e){for(var t=[],r=0;r<e.length;r++)-1===t.indexOf(e[r])&&t.push(e[r]);return t};return t.parseFeatures(e).forEach((function(e){var o=[],s=[],l="",c=t.outputProperties,u=t.dataIdProperty,h=t.suggestionTemplate,d=e.id.split(".").slice(0,1).shift();t.outputProperties instanceof Array||(c=t.outputProperties[d],u=t.dataIdProperty[d],h=h[d]);for(var p=0;p<c.length;p++)o.push(e.data[c[p]]);for(p=0;p<u.length;p++)s.push(e.data[u[p]]);for(var g={},f=0;f<t.outputProperties.length;f++)g[t.outputProperties[f]]=o[f];Array.isArray(o)&&h&&i(o).length>1?l=a.A.formatIndexedTemplate(h,...o):o instanceof Array&&1===i(o).length&&(l=o[0]);var m=L(l);(function(e){for(var t=0;t<r.length;t++){var i=0,o=[];for(var a in e)o.push(n(e[a],r[t].properties[a])),i++;if(o.filter((function(e){return e})).length===i)return!0}return!1})(g)||r.push({text:m,label:m,id:s.join("#"),dataRole:t.typeName,dataLayer:d,properties:g})})),r}getSuggestionListExamplesElement(){let e=null;if(this.examples){e=document.createElement("li"),e.dataset.role=this.typeName,e.classList.add(this.parent.CLASS+"-examples"),e.textContent=this.parent.getLocaleString("examples")+": ";for(const t of this.examples){const r=document.createElement("sitna-button");r.classList.add(this.parent.CLASS+"-example"),r.textContent=t,r.addEventListener(i.A.event.CLICK,(()=>{this.parent.resultsList.replaceChildren(),this.parent.textInput.value=t,this.parent.hideExamples(),this.parent.button.dispatchEvent(new Event(i.A.event.CLICK))})),e.appendChild(r)}}return e}parseFeatures(e){const t=this;return(t.outputFormat===i.A.format.JSON?new n.A.wrap.parser.JSON:new n.A.wrap.parser.WFS({featureNS:t.featurePrefix,featureType:t.featureType})).read(e)}getParser(){const e=this;return"function"==typeof e.parser?e.parser():e.parser}async#$(e,t){const r=this;let i;try{i=await fetch(r.url+"?"+e,{signal:t})}catch(t){if("AbortError"!==t.name)throw n.A.error(t),t;console.log(`Search: petición abortada [${r.typeName}] ${e}`)}if(!i.ok)throw"Search: error fetch "+r.typeName;const o=await i.text();let s=[],l=r.parseFeatures(o);if(!l.length)throw"Search: no results with "+r.typeName;return l.map((function(e){var t=r.outputProperties;if(!s.some((function(t){let r=!0;for(var n in t.properties)if(e.data[n]!=t.properties[n]){r=!1;break}return r}))){var n=a.A.formatIndexedTemplate(r.suggestionTemplate,...t.map((function(t){return e.data[t]})));const i={};t.forEach((t=>{i[t]=e.data[t]})),s.push({id:r.dataIdProperty.map((function(t){return e.data[t]})).join("#"),label:n,properties:i,dataLayer:e.id.split(".")[0],dataRole:r.typeName})}})),s}}class m{constructor(){this.search1="",this.searchPlaceholder="",this.searchInstructions="",this.share="",this.search2="",this.dialogHeader=""}}i.A.event.TOOLSCLOSE=i.A.event.TOOLSCLOSE||"toolsclose.tc",i.A.event.SEARCHQUERYEMPTY=i.A.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";class y extends s.A{_LIKE_PATTERN="*";_MATCH_PATTERN=".*";UTMX="X";UTMY="Y";LON="Lon";LAT="Lat";UTMX_LABEL="X: ";UTMY_LABEL="Y: ";LON_LABEL="Lon: ";LAT_LABEL="Lat: ";MUN="Mun";POL="Pol";PAR="Par";MUN_LABEL="Mun: ";POL_LABEL="Pol: ";PAR_LABEL="Par: ";UTMX_LEN=6;UTMX_MIN_LEN=6;UTMX_MAX_LEN=7;UTMY_LEN=7;availableSearchTypes={};allowedSearchTypes=[];queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};#X={data:[]};stringPatternValidators={tsp:function(e,t,r,n){const i=this;var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(o&&o[1]&&o[2]){var a=function(){return i.formatStreetNumber((o[3]||o[4]||o[5]||o[6]).trim())};return/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim())?(t.push([o[1].trim(),o[2].trim(),a()]),t.push([o[2].trim(),o[1].trim(),a()])):/^([^0-9]+)$/i.test(o[1].trim())?t.push([o[1].trim(),o[2].trim(),a()]):t.push([o[2].trim(),o[1].trim(),a()]),i.bindRoot(t,r,n),!0}return!1},spt:function(e,t,r,n){const i=this;var o=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(o&&o[6]&&o[1]){var a=function(){return i.formatStreetNumber((o[2]||o[3]||o[4]||o[5]).trim())};return/^([^0-9]+)$/i.test(o[6].trim())&&/^([^0-9]+)$/i.test(o[1].trim())?(t.push([o[6].trim(),o[1].trim(),a()]),t.push([o[1].trim(),o[6].trim(),a()])):/^([^0-9]+)$/i.test(o[6].trim())?t.push([o[6].trim(),o[1].trim(),a()]):t.push([o[1].trim(),o[6].trim(),a()]),i.bindRoot(t,r,n),!0}return!1},tnsp:function(e,t,r,n){var i=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);return!!(i&&i[1]&&i[2])&&(t.push([i[2].trim(),i[1].trim(),this.formatStreetNumber((i[3]||i[4]||i[5]||i[6]).trim())]),this.bindRoot(t,r,n),!0)},ts:function(e,t,r,n){const i=this;var o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!o&&/^[^0-9]*$/i.test(e.trim())){var a=e.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(o&&o[1]&&o[2]){if(/^([^0-9]+)$/i.test(o[1].trim())&&/^([^0-9]+)$/i.test(o[2].trim()))t.push([o[1].trim(),o[2].trim()]),t.push([o[2].trim(),o[1].trim()]),i.bindRoot(t,r,n);else{var s=function(e){for(var t=e.split(" ").reverse(),r=[],n=0;n<t.length;n++)1===t[n].length&&(r.push(t[n]),t[n]="");return r.length>0?t.reverse().join(" ").trim()+i._LIKE_PATTERN+r.reverse().join(i._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(o[1].trim())?t.push([o[1].trim(),s(o[2].trim())]):t.push([o[2].trim(),s(o[1].trim())]),i.bindRoot(t,r,n,!0)}return!0}return!1},st:function(e,t,r,n){const i=this;var o=/^(?:([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!o){const t=e.split(",").reverse();o=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-zñáéíóúüàèìòù"\s*\-\.\(\)\/0-9]+))$/i.exec(t.join(","))}if(o){var a=[];const o=e.split(",").reverse();for(var s=0;s<o.length;s++)if(/^([^0-9\,]+)$/i.test(o[s].trim()))a[0]=o[s].trim();else if(/(\s*\d+)/i.test(o[s].trim()))if(-1===o[s].trim().indexOf(" "))a[1]=o[s].trim();else{for(var l=o[s].trim().split(" ").reverse(),c=function(e){return!!/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())&&(a[2]=i.formatStreetNumber(e.trim()),!0)},u=0,h=l[u].trim();u<l.length&&!c(h);)++u<l.length&&(h+=l[u]);if(a[2]){for(var d=l,p=0;p<d.length;p++){for(var g=!1,f=0;f<d[p].split("").length;f++)a[2].indexOf(d[p][f])>-1&&(g=!0);if(g&&(d[p]="",a[2]==i.formatStreetNumber(h)))break}if(/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9]+)$/i.test(l.reverse().join(" ").trim())){for(var m=[],y=l.reverse(),v=0;v<y.length;v++)1===y[v].trim().length&&(m.push(y[v].trim()),y[v]="");a[1]=m.length>0?y.reverse().join(" ").trim()+i._LIKE_PATTERN+m.reverse().join(i._LIKE_PATTERN):y.reverse().join(" ").trim()}t.push([a[0],a[1]+" "+a[2]])}else a[1]=o[s].trim()}return t.push(a),i.bindRoot(t,r,n),!0}return!1},s_or_t:function(e,t,r,n){var i=/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);return!(!i||!i[1]||(r?(t.push([i[1].trim()]),t.push([r,i[1].trim()])):t.push([i[1].trim()]),0))},sp:function(e,t,r,n){var i=/^([^\,][a-zñáéíóúüàèìòù\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);return!!(i&&i[1]&&i[2])&&(r?t.push([r,i[1].trim(),this.formatStreetNumber(i[2].trim())]):t.push([i[1].trim(),i[2].trim()]),!0)},snp:function(e,t,r,n){var i=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return!!(i&&i[1]&&i[2]&&r)&&(t.push([r,i[1].trim(),this.formatStreetNumber(i[2].trim())]),!0)}};constructor(){super(...arguments),this._dialogDiv=a.A.getDiv(this.options.dialogDiv),this.options.dialogDiv||document.body.appendChild(this._dialogDiv),this.exportsState=!0,this.url=this.options.url||"//idena.navarra.es/ogc/wfs",this.version=this.options.version||"1.1.0",this.featurePrefix=this.options.featurePrefix||"IDENA",this.mimimumPatternLength=this.options.minimumPatternLength??3,this.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","filter","outputFormat"],this.queryableFeatures=this.options.queryableFeatures||!1,this.wrap=new n.A.wrap.control.Search(this),this.interval=500,this.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi},this.model=new m}async reloadLocaleString(){const e=this;e.EMPTY_RESULTS_LABEL=e.getLocaleString("noResults"),e.EMPTY_RESULTS_TITLE=e.getLocaleString("checkCriterion"),e.OUTBBX_LABEL=e.getLocaleString("outsideOfLimits")}updateModel(){this.model.search1=this.getLocaleString("search.1"),this.model.searchPlaceholder=this.getLocaleString("search.placeholder"),this.model.searchInstructions=this.getLocaleString("search.instructions"),this.model.share=this.getLocaleString("share"),this.model.search2=this.getLocaleString("search.2"),this.model.dialogHeader=this.getLocaleString("search.1")+" - "+this.getLocaleString("share")}async updateLanguage(){this.updateModel()}async register(e){const t=this;return await super.register.call(t,e),t.options&&t.options.share&&await t.getShareDialog(),t.reloadLocaleString(),t.#Z(),t.rootCfg={},t.rootCfg[i.A.searchType.MUNICIPALITY]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],suggestionTemplate:"{0}",getRootLabel:async function(){if(t.rootCfg.active&&!t.rootCfg[i.A.searchType.MUNICIPALITY].rootLabel){var e={};let r;e.SERVICE="WFS",e.VERSION=t.rootCfg[i.A.searchType.MUNICIPALITY].version,e.REQUEST="GetFeature",e.TYPENAME=t.rootCfg[i.A.searchType.MUNICIPALITY].featurePrefix+":"+t.rootCfg[i.A.searchType.MUNICIPALITY].featureType,e.OUTPUTFORMAT=t.rootCfg[i.A.searchType.MUNICIPALITY].outputFormat,e.PROPERTYNAME=["CMUNICIPIO"].concat(t.rootCfg[i.A.searchType.MUNICIPALITY].outputProperties).join(","),e.CQL_FILTER=t.rootCfg[i.A.searchType.MUNICIPALITY].root.map((function(e){return["CMUNICIPIO"].map((function(t,r){return t+"="+e[r]})).join(" AND ")})),e.CQL_FILTER=e.CQL_FILTER.join(" OR ");try{r=await n.A.ajax({url:t.rootCfg[i.A.searchType.MUNICIPALITY].url+"?"+a.A.getParamString(e),method:"GET",responseType:i.A.mimeType.JSON})}catch(e){return[]}const o=r.data;o.totalFeatures>0?t.rootCfg[i.A.searchType.MUNICIPALITY].rootLabel=o.features.map((function(e){return{id:["CMUNICIPIO"].map((function(t){return e.properties[t]})).join("#"),label:e.properties[t.rootCfg[i.A.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}})):t.rootCfg[i.A.searchType.MUNICIPALITY].rootLabel=[]}return t.rootCfg[i.A.searchType.MUNICIPALITY].rootLabel}},t.rootCfg[i.A.searchType.TOWN]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:async function(){if(t.rootCfg.active&&!t.rootCfg[i.A.searchType.TOWN].rootLabel){var e={};let r;e.SERVICE="WFS",e.VERSION=t.rootCfg[i.A.searchType.TOWN].version,e.REQUEST="GetFeature",e.TYPENAME=t.rootCfg[i.A.searchType.TOWN].featurePrefix+":"+t.rootCfg[i.A.searchType.TOWN].featureType,e.OUTPUTFORMAT=t.rootCfg[i.A.searchType.TOWN].outputFormat,e.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(t.rootCfg[i.A.searchType.TOWN].outputProperties).join(","),e.CQL_FILTER=t.rootCfg[i.A.searchType.TOWN].root.map((function(e){return["CMUNICIPIO","CENTIDAD"].map((function(t,r){return t+"="+e[r]})).join(" AND ")})),e.CQL_FILTER=e.CQL_FILTER.join(" OR ");try{r=await n.A.ajax({url:t.rootCfg[i.A.searchType.TOWN].url+"?"+a.A.getParamString(e),method:"GET",responseType:i.A.mimeType.JSON})}catch(e){return[]}const o=r.data;o.totalFeatures>0?t.rootCfg[i.A.searchType.TOWN].rootLabel=o.features.map((function(e){return{id:["CMUNICIPIO","CENTIDAD"].map((function(t){return e.properties[t]})).join("#"),label:e.properties[t.rootCfg[i.A.searchType.TOWN].outputProperties[0]].toLowerCase()}})):t.rootCfg[i.A.searchType.TOWN].rootLabel=[]}return t.rootCfg[i.A.searchType.TOWN].rootLabel}},t.rootCfg.active&&t.rootCfg.active.getRootLabel(),t.#J(),t.updateModel(),t}async loadTemplates(){const e=this,t=r.e(1255).then(r.bind(r,1255)),n=r.e(4376).then(r.bind(r,4376)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(){const e=this;e.controller=new AbortController,e._dialogDiv.innerHTML=await e.getRenderedHtml(e.CLASS+"-dialog",{}),await e.renderData(),e.controller=new p.A(e.model,new g.A(e.div)),e.dialogController=new p.A(e.model,new g.A(e._dialogDiv))}async renderData(e,t){const r=this;var s;if(r.#X=r.#X||{},r.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}return function(t,n,s,c){c instanceof l.A||this.map.trigger(i.A.event.FEATURESADD,{layer:this.layer,geom:c.geom});var u=function(t,n,i){var a=r.getSearchTypeByFeature(i);if(a){var s=a.getStyleByFeatureType(e(i));if(s&&Object.prototype.hasOwnProperty.call(s,n))return s[n][t]}return o.A.styles[n][t]}(n,t,e(c.id));if(s){if(u instanceof Array){var h=u.map((function(e){const t=c.getData();return Object.prototype.hasOwnProperty.call(t,e)?t[e]:""})),d=this.getSearchTypeByFeature(e(c.id));return d?a.A.formatIndexedTemplate(d.suggestionTemplate,...h):h.join(" ")}{const e=c.getData();return Object.prototype.hasOwnProperty.call(e,u)?e[u]:""}}return u}}(),await super.renderData.call(r,Object.assign(e||{},{share:r.options.share})),r.textInput=r.div.querySelector("input."+r.CLASS+"-txt"),r.options&&r.options.placeHolder&&r.textInput.setAttribute("placeHolder",r.options.placeHolder.trim()),r.examplesList=r.div.querySelector("."+r.CLASS+"-examples"),r.resultsList=r.div.querySelector("."+r.CLASS+"-results"),r.button=r.div.querySelector("."+r.CLASS+"-btn"),r.options.instructions&&(r.textInput.setAttribute("title",r.options.instructions.trim()),r.button.setAttribute("title",r.options.instructions.trim())),r.options.share&&(r.shareButton=r.div.querySelector("."+r.CLASS+"-share-btn"),r.shareButton.addEventListener(i.A.event.CLICK,(function(){r.showShareDialog()}),{passive:!0})),r.lastPattern="",r.retryTimeout=null,n.A.UI.autocomplete.call(r.textInput,{link:"#",target:r.resultsList,minLength:2,ctx:r,source:function(e,t){if(r.lastpress=performance.now(),!s){const e=function(){r.doSearch(t)?(window.cancelAnimationFrame(s),s=void 0):s=requestAnimationFrame(e)};s=requestAnimationFrame(e)}},callback:function(e){r.#Q(e)},buildHTML:v.bind(r)}),!r.map)throw new Error("Control not registered to map");r.layerPromise||(r.layerPromise=r.map.addLayer({id:r.getUID(),title:"Búsquedas",owner:r,stealth:!0,declutter:!0,type:i.A.layerType.VECTOR,styles:{polygon:{fillColor:r.layerStyleFN.bind(r,"polygon","fillColor",!1),fillOpacity:r.layerStyleFN.bind(r,"polygon","fillOpacity",!1),strokeColor:r.layerStyleFN.bind(r,"polygon","strokeColor",!1),strokeOpacity:r.layerStyleFN.bind(r,"polygon","strokeOpacity",!1),strokeWidth:r.layerStyleFN.bind(r,"polygon","strokeWidth",!1)},line:{strokeColor:r.layerStyleFN.bind(r,"line","strokeColor",!1),strokeOpacity:r.layerStyleFN.bind(r,"line","strokeOpacity",!1),strokeWidth:r.layerStyleFN.bind(r,"line","strokeWidth",!1)},marker:{anchor:n.A.Defaults.styles.marker.anchor,height:n.A.Defaults.styles.marker.height,width:n.A.Defaults.styles.marker.width},point:{radius:r.layerStyleFN.bind(r,"point","radius",!1),height:r.layerStyleFN.bind(r,"point","height",!1),width:r.layerStyleFN.bind(r,"point","width",!1),fillColor:r.layerStyleFN.bind(r,"point","fillColor",!1),fillOpacity:r.layerStyleFN.bind(r,"point","fillOpacity",!1),strokeColor:r.layerStyleFN.bind(r,"point","strokeColor",!1),strokeWidth:r.layerStyleFN.bind(r,"point","strokeWidth",!1),fontSize:r.layerStyleFN.bind(r,"point","fontSize",!1),fontColor:r.layerStyleFN.bind(r,"point","fontColor",!1),labelOutlineColor:r.layerStyleFN.bind(r,"point","labelOutlineColor",!1),labelOutlineWidth:r.layerStyleFN.bind(r,"point","labelOutlineWidth",!1),labelKey:r.layerStyleFN.bind(r,"point","labelKey",!0),labelRotationKey:r.layerStyleFN.bind(r,"point","labelRotationKey",!0)}}}),r.layer=await r.layerPromise),r.addUIEventListeners(),a.A.isFunction(t)&&t()}addUIEventListeners(){const e=this,t=function(){e.search(e.textInput.value,(function(t){1===t.length?(e.textInput.value=t[0].label,e.#ee(t[0].id,e.resultsList.querySelector("li:not(.tc-header)").dataset.role),e.resultsList.classList.add(i.A.classes.HIDDEN)):0===t.length&&e.resultsList.classList.add(i.A.classes.HIDDEN)}))},r=function(){e.textInput.value=e.resultsList.label||e.resultsList.querySelector("li:not(.tc-header) > a > span").textContent,e.lastPattern=e.textInput.value,e.#ee(e.resultsList.id||unescape(e.resultsList.querySelector("li:not(.tc-header) > a").getAttribute("href")).substring(1),e.resultsList.querySelector("li:not([header])").dataset.role),e.resultsList.classList.add(i.A.classes.HIDDEN)};e.button.addEventListener(i.A.event.CLICK,(function(){e.getLayer().then((function(t){const n=e.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)");n.length<=1&&(t.features.length>0?t.map.zoomToFeatures(t.features):1===n.length?r():e.textInput.dispatchEvent(new Event("keyup")))}))}),{passive:!0,signal:e.controller.signal}),e.resultsList.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector("a."+e.CLASS+"-li-empty",(function(){e.resultsList.classList.add(i.A.classes.HIDDEN),e.textInput.focus()})),{passive:!0,signal:e.controller.signal}),e.textInput.addEventListener("keypress",(function(n){if("Enter"===n.key)return n.preventDefault(),n.stopPropagation(),e.lastPattern="",1===e.resultsList.querySelectorAll("li > a:not(.tc-ctl-search-li-loading):not(.tc-ctl-search-li-empty)").length?r():t(),!1}),{signal:e.controller.signal}),e.textInput.addEventListener("keyup",(function(r){switch(r.key){case"Clear":case"Delete":case"Backspace":0===e.textInput.value.length&&(e.shareButton&&e.shareButton.classList.add(i.A.classes.HIDDEN),e.showExamples(),t())}}),{signal:e.controller.signal}),e.textInput.addEventListener("search",(function(){0===e.textInput.value.length&&(delete e.toShare,e.shareButton&&e.shareButton.classList.add(i.A.classes.HIDDEN),e.resultsList.classList.add(i.A.classes.HIDDEN),t())}),{signal:e.controller.signal}),e.textInput.addEventListener("input",(function(){0===e.textInput.value.length?(e.shareButton&&e.shareButton.classList.add(i.A.classes.HIDDEN),e.showExamples(),t()):e.hideExamples()}),{signal:e.controller.signal});const o=()=>{0===e.textInput.value.length&&e.showExamples()},a=t=>{e.div.contains(t.relatedTarget)||t.relatedTarget===e.textInput||e.hideExamples()};e.textInput.addEventListener("focus",o,{signal:e.controller.signal}),e.textInput.addEventListener("focusin",o,{signal:e.controller.signal}),e.textInput.addEventListener("focusout",a,{signal:e.controller.signal}),e.textInput.addEventListener("blur",a,{signal:e.controller.signal}),e.textInput.addEventListener("targetCleared.autocomplete",(function(){e.shareButton&&e.shareButton.classList.add(i.A.classes.HIDDEN),e.resultsList.classList.add(i.A.classes.HIDDEN)})),e.textInput.addEventListener("targetUpdated.autocomplete",(function(){e.resultsList.querySelectorAll("li").length>0&&e.resultsList.classList.remove(i.A.classes.HIDDEN)}),{signal:e.controller.signal}),e.examplesList.addEventListener("focusout",a,{signal:e.controller.signal}),e.examplesList.addEventListener("blur",a,{signal:e.controller.signal});const s=function(t){t.ctrlKey||t.altKey||t.shiftKey||(40===t.keyCode?(e.textInput==document.activeElement&&e.resultsList.querySelector("li:not(.tc-header) a")?e.resultsList.querySelector("li:not(.tc-header) a").focus():e.resultsList.querySelector("li:not(.tc-header):last-child a")===document.activeElement?e.textInput.focus():function(e,t){var r=document.activeElement.parentElement.nextElementSibling;for(0;r;){if(r.matches(t))return r;r=r.nextElementSibling}}(0,"li:not(.tc-header)").querySelector("a").focus(),t.preventDefault(),t.stopPropagation()):38===t.keyCode&&(e.textInput==document.activeElement||document.activeElement==e.resultsList.querySelector("li:not(.tc-header) a")?e.resultsList.querySelector("li:not(.tc-header):last-child a").focus():function(e,t){var r=document.activeElement.parentElement.previousElementSibling;for(0;r;){if(r.matches(t))return r;r=r.previousElementSibling}}(0,"li:not(.tc-header)").querySelector("a").focus(),t.preventDefault(),t.stopPropagation())),t.stopPropagation()};e.textInput.addEventListener("keydown",s,{signal:e.controller.signal}),e.resultsList.addEventListener("keydown",s,{signal:e.controller.signal})}showExamples(){this.examplesList.replaceChildren();const e=this.allowedSearchTypes.filter((e=>e.examples)).sort(((e,t)=>t.searchWeight-e.searchWeight)),t=e.length>0;for(const t of e)this.examplesList.insertAdjacentHTML("beforeend",t.getSuggestionListHeader()),this.examplesList.insertAdjacentElement("beforeend",t.getSuggestionListExamplesElement());this.examplesList.classList.toggle(i.A.classes.HIDDEN,!t)}hideExamples(){this.examplesList.classList.add(i.A.classes.HIDDEN)}#Z(){const e=this;return e.availableSearchTypes[i.A.searchType.CADASTRALPARCEL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHeader:{labelKey:"search.list.cadastral",colorSource:[{featureType:"CATAST_Pol_ParcelaUrba",tooltipKey:"search.list.cadastral.urban",colorSource:{geometryType:"polygon",propertyName:"strokeColor"}},{featureType:"CATAST_Pol_ParcelaRusti",tooltipKey:"search.list.cadastral.rustic",colorSource:{geometryType:"polygon",propertyName:"strokeColor"}},{featureType:"CATAST_Pol_ParcelaMixta",tooltipKey:"search.list.cadastral.mixed",colorSource:{geometryType:"polygon",propertyName:"strokeColor"}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],searchFunction:e.getCadastralRef,queryFactory:e.getCadastralRefQuery,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#",examples:["olite, 16, 1934","191, 16, 1934"]},e.availableSearchTypes[i.A.searchType.COORDINATES]={searchFunction:e.getCoordinates,queryFactory:e.getCoordinatesQuery,searchWeight:4,label:null,suggestionListHeader:function(t){return{labelKey:e.availableSearchTypes[i.A.searchType.COORDINATES].labelKey||e.getLocaleString("search.list.coordinates")}},examples:["42,21022 -1,51577","42,21022, -1,51577","42.21022 -1.51577","42.21022, -1.51577","622513 4674183","622513, 4674183"]},e.availableSearchTypes[i.A.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHeader:{labelKey:"search.list.municipality",colorSource:"strokeColor"},outputProperties:["MUNICIPIO"],suggestionTemplate:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternValidators.s_or_t,examples:["egüés","eguesibar"]},e.availableSearchTypes[i.A.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],suggestionTemplate:"{1} ({0})",searchWeight:4,searchFunction:e.getStringPattern.bind(this,[i.A.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternValidators.s_or_t,idPropertiesIdentifier:"#",suggestionListHeader:{labelKey:"search.list.council",colorSource:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]},e.availableSearchTypes[i.A.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHeader:{labelKey:"search.list.street",colorSource:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],suggestionTemplate:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{labelKey:"VIA",labelRotationKey:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.STREET]),examples:["roncesvalles, burguete","orreaga, auritz","burguete, roncesvalles","auritz, orreaga"]},e.availableSearchTypes[i.A.searchType.POSTALADDRESS]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHeader:{labelKey:"search.list.number",colorSource:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],suggestionTemplate:"{1} {2}, {0}",styles:[{point:{radius:0,labelKey:"PORTAL",labelRotationKey:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.POSTALADDRESS]),examples:["roncesvalles, burguete, 12","orreaga, auritz, 12","roncesvalles, 12, burguete","orreaga, 12, auritz","burguete, 12, roncesvalles","auritz, 12, orreaga"]},e.availableSearchTypes[i.A.searchType.TOWN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHeader:{labelKey:"search.list.urban",colorSource:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],suggestionTemplate:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.TOWN]),stringPatternToCheck:e.stringPatternValidators.s_or_t,examples:["hiriberri","villanueva"]},e.availableSearchTypes[i.A.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHeader:{labelKey:"search.list.placeName",colorSource:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],suggestionTemplate:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,labelKey:"TOPONIMO",labelRotationKey:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternValidators.s_or_t},e.availableSearchTypes[i.A.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHeader:{labelKey:"search.list.placeName",colorSource:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],suggestionTemplate:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,labelKey:"TOPONIMO",labelRotationKey:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],searchFunction:e.getStringPattern.bind(this,[i.A.searchType.PLACENAMEMUNICIPALITY]),stringPatternToCheck:[e.stringPatternValidators.ts,e.stringPatternValidators.st]},e.availableSearchTypes[i.A.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],suggestionTemplate:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]},e.availableSearchTypes[i.A.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHeader:{labelKey:"search.list.road",colorSource:"strokeColor"},outputProperties:["DCARRETERA"],suggestionTemplate:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],queryFactory:e.getRoadQuery,regEx:new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i"),parser:function(e){const t=this;if((e=e.trim()).length<2)return null;{var r=t.regEx.exec(e);if(!r||!r[3])return null;let n=r[2]?r[2].trim()+"-"+r[3].trim():r[3].trim();return r[4]&&r[4].length>0&&(n=n+"-"+r[4].trim()),[n]}},examples:["n121a","n-121-a"]},e.availableSearchTypes[i.A.searchType.ROADMILESTONE]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:i.A.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHeader:{labelKey:"search.list.milestone.larger",colorSource:"fontColor"},outputProperties:["DCARRETERA","PK"],suggestionTemplate:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.milestone")+": {1}",searchWeight:11,styles:[{point:{labelKey:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],queryFactory:e.getMilestoneQuery,regEx:new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.milestone")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i"),parser:function(e){if((e=e.trim()).length<3)return null;var t=this.regEx.exec(e);if(!t||!t[3]||!t[5])return null;var r=t[2]?t[2].trim()+"-"+t[3].trim():t[3].trim();return t[4]&&t[4].length>0&&(r=r+"-"+t[4].trim()),[r,t[5].trim()]},examples:["n121 3","n-121 3","n121, 3","n-121, 3"]},e}getAvailableSearchTypes(){const e=this;return Object.keys(e.availableSearchTypes).length||e.#Z(),e.availableSearchTypes}#J(){const e=this;let t={...e.options};delete t.allowedSearchTypes,Object.assign(t,e.options.allowedSearchTypes);const r=function(e,r){Object.prototype.hasOwnProperty.call(t,e)&&(Object.prototype.hasOwnProperty.call(t,r)||(t[r]=t[e]),delete t[e])};if(r("cadastral",i.A.searchType.CADASTRALPARCEL),r("number",i.A.searchType.POSTALADDRESS),r("urban",i.A.searchType.TOWN),r("locality",i.A.searchType.TOWN),r("roadmilestone",i.A.searchType.ROADMILESTONE),r("placename",i.A.searchType.PLACENAME),r("placenamemunicipality",i.A.searchType.PLACENAMEMUNICIPALITY),t=Object.fromEntries(Object.entries(t).filter((([e])=>Object.values(i.A.searchType).find((t=>t===e))))),Object.keys(t).length||(t=o.H.controls.search?.allowedSearchTypes||{}),e.options.customSearchTypes&&e.options.customSearchTypes.forEach((t=>{e.addAllowedSearchType(e.getUID(),t)})),Object.keys(t).forEach((function(e){if(("boolean"==typeof t[e]||a.A.isPlainObject(t[e]))&&t[e])switch(!0){case e===i.A.searchType.PLACENAME:case e===i.A.searchType.PLACENAMEMUNICIPALITY:case e===i.A.searchType.POSTALADDRESS:case e===i.A.searchType.CADASTRALPARCEL:case e===i.A.searchType.TOWN:t[e]=a.A.isPlainObject(t[e])?t[e]:{}}})),t)for(var n in t){const r=e.availableSearchTypes[n],o=t[n];if(r&&!a.A.isEmptyObject(o)){r.renderFeatureType?.length>0&&o.featureType&&!o.renderFeatureType&&(delete r.renderFeatureType,r.styles=r.styles.slice(0,r.styles.length-1)),a.A.extend(r,o),r.suggestionTemplate||(r.suggestionTemplate=r.outputFormatLabel);let t=o.rootType;"locality"===t&&(t=i.A.searchType.TOWN),(o.root&&n!==i.A.searchType.MUNICIPALITY&&t===i.A.searchType.MUNICIPALITY||n!==i.A.searchType.TOWN&&t===i.A.searchType.TOWN)&&(e.rootCfg.active=e.rootCfg[t],e.rootCfg.active.root=o.root,e.rootCfg.active.limit=o.limit,e.availableSearchTypes[i.A.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[i.A.searchType.POSTALADDRESS].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty)}o&&e.addAllowedSearchType(n,r||o,e)}}addAllowedSearchType(e,t){const r=this;return r.allowedSearchTypes.push(new f(e,t,r)),r}getSearchTypeByRole(e){return this.allowedSearchTypes.find((t=>t.typeName.toLowerCase()==e.toLowerCase()))}getSearchTypeByFeature(e){return this.allowedSearchTypes.find((t=>t.isFeatureOfThisType(e)))??null}getElementOnSuggestionList(e,t){const r=this;for(var n=0;n<r.searchRequestsResults.length;n++)if(r.searchRequestsResults[n].id==e&&(!t||r.searchRequestsResults[n].dataRole===t))return r.searchRequestsResults[n]}getLayer(){return this.layerPromise}getFeatures(){return this.layer.features}cleanMap(){const e=this;if(e.layer){const r=e.layer,n=r.features.slice();r.clearFeatures(),n?.length>0&&e.map.trigger(i.A.event.FEATUREREMOVE,{layer:r,feature:n[0]});for(var t=0;t<e.WFS_TYPE_ATTRS.length;t++)Object.prototype.hasOwnProperty.call(r,e.WFS_TYPE_ATTRS[t])&&delete r[e.WFS_TYPE_ATTRS[t]]}}async getMunicipalities(){const e=this;if(n.A.cache.search=n.A.cache.search||{},!n.A.cache.search.municipalities){var t=e.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL);if(!(t.municipality?.featureType&&t.municipality.labelProperty&&t.municipality.idProperty))throw new Error("Error en la configuración de la búsqueda: "+t.typeName+". Error en el objeto municipality");var r={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:t.municipality.featureType,VERSION:t.version,PROPERTYNAME:t.municipality.labelProperty+","+t.municipality.idProperty,OUTPUTFORMAT:t.outputFormat};t.featurePrefix&&(r.TYPENAME=t.featurePrefix+":"+r.TYPENAME);var o=t.url+"?"+a.A.getParamString(r);let u;try{u=await n.A.ajax({url:o,method:"GET",responseType:"text"})}catch(e){return null}const h=u.data;var s=(t.outputFormat===i.A.format.JSON?new n.A.wrap.parser.JSON:new n.A.wrap.parser.WFS({featureNS:t.municipality.featurePrefix,featureType:t.municipality.featureType})).read(h);n.A.cache.search.municipalities=[];for(var l=0;l<s.length;l++){var c=s[l];n.A.cache.search.municipalities.push({label:c.data[t.municipality.labelProperty],id:c.data[t.municipality.idProperty]})}return n.A.cache.search.municipalities.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})),n.A.cache.search.municipalities}return n.A.cache.search.municipalities}async getCoordinates(e){const t=this,r=new RegExp("^"+t.UTMX_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+t.UTMX_MIN_LEN+","+t.UTMX_MAX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+t.UTMY_LABEL.trim().toLowerCase()+"*\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"),n=new RegExp("^"+t.LAT_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LON_LABEL.trim().toLowerCase()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"),o=new RegExp("^([-+]?[0-9]{"+t.UTMX_MIN_LEN+","+t.UTMX_MAX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"),s=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/;var l=e.match(r);if(l&&(e=l[1]+" "+l[2]),(l=e.match(n))&&(e=l[1]+" "+l[3]),/\d/.test(e)&&(o.test(e)||s.test(e))&&((l=s.exec(e))&&(l[1].indexOf(",")>-1||l[3].indexOf(",")>-1)&&(l[1]=l[1].replace(",","."),l[3]=l[3].replace(",","."),e=l[1]+" "+l[3]),!l||l&&(l[1].indexOf(",")>-1?l[1].replace(",","."):l[1])<=180&&(l[3].indexOf(",")>-1?l[3].replace(",","."):l[3])<=90)){(l=o.exec(e))&&(l[1].indexOf(",")>-1||l[2].indexOf(",")>-1)&&(l[1]=l[1].replace(",","."),l[2]=l[2].replace(",","."),e=l[1]+" "+l[2]),e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var c=a.A.parseCoords(e);if(c){var u=c[0].value,h=c[1].value,d=c[0].type===i.A.UTM?t.UTMX:t.LAT,p=c[1].type===i.A.UTM?t.UTMY:t.LON,g=d+u+p+h,f=t.getPoint(g);if(f&&!t.insideLimit(f)&&(u=c[1].value,h=c[0].value,g=(d=c[1].type===i.A.UTM?t.UTMX:t.LAT)+u+(p=c[0].type===i.A.UTM?t.UTMY:t.LON)+h,f=t.getPoint(g)),f)return t.availableSearchTypes[i.A.searchType.COORDINATES].label=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.test(g)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo"),[{id:g,label:t.getLabel(g),dataRole:i.A.searchType.COORDINATES}]}}throw"Search: Not a coordinates search"}async getCadastralRef(e){const t=this;let r=e.match(new RegExp(t.MUN_LABEL.trim().toLowerCase()+"?\\s(.*)\\,\\s?"+t.POL_LABEL.trim().toLowerCase()+"?\\s(\\d{1,2})\\,\\s?"+t.PAR_LABEL.trim().toLowerCase()+"?\\s(\\d{1,4})"));r&&(e=r[1]+", "+r[2]+", "+r[3]);var n=e;if(!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL).suggestionRoot&&(n=t.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL).suggestionRoot+", "+e),/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(n)&&!new RegExp("^([-+]?[0-9]{"+t.UTMX_MIN_LEN+","+t.UTMX_MAX_LEN+"})\\s*\\,\\s*([-+]?[0-9]{"+t.UTMY_LEN+"})$").test(e)){const e=await t.getMunicipalities();if(r=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(n),r){var o=new RegExp(r[1].trim().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),a=[];const n=function(e,r,n,o){var a=[];return a.push[t.MUN]=e,a.push[t.POL]=n,a.push[t.PAR]=o,{id:t.MUN+e+t.POL+n+t.PAR+o,label:t.getLabel(t.MUN+r+t.POL+n+t.PAR+o),dataRole:i.A.searchType.CADASTRALPARCEL,properties:a}};if((a=e.filter((function(e){return e=e.label||e.id||e,o.test(e)||o.test(t.removePunctuation(e))}))).length>0)for(var s=0;s<a.length;s++)a[s]=n(a[s].id,a[s].label,r[2].trim(),r[3].trim());if(/^[0-9]*$/g.test(r[1])){if(r[1].trim()===t.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL).suggestionRoot){const o=e.find((function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL).suggestionRoot)}));if(o)return[n(o.id,o.label,r[2].trim(),r[3].trim())]}a.push(n(r[1].trim(),r[1].trim(),r[2].trim(),r[3].trim()))}return a}}throw"Search: Not a cadastral reference"}#te(e,t){const r=this,o=r.rootCfg.active&&r.rootCfg.active.root||"",a=r.rootCfg.active&&r.rootCfg.active.limit||!1;var s=[];if(","===(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1)),function(){var e=[e=>e.length>=r.mimimumPatternLength,e=>!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)];for(const r of e)if(!r(t))return!1;return!0}()){var l=[];0===(l=e.map((function(e){return r.getSearchTypeByRole(e)})).filter((function(e){return e.stringPatternToCheck})).map((function(e){return e.stringPatternToCheck})).flat()).length&&(l=[r.stringPatternValidators.tsp,r.stringPatternValidators.spt,r.stringPatternValidators.tnsp,r.stringPatternValidators.ts,r.stringPatternValidators.st],l=o&&t.split(",").length<3?[r.stringPatternValidators.sp,r.stringPatternValidators.snp,r.stringPatternValidators.s_or_t].concat(l):l.concat([r.stringPatternValidators.sp,r.stringPatternValidators.snp,r.stringPatternValidators.s_or_t]));var c=0;try{for(;c<l.length&&!l[c].call(r,t,s,o,a);)c++}catch(e){n.A.error("Error según el patrón: "+t,i.A.msgErrorMode.EMAIL,"Error en la búsqueda del callejero")}return s}return null}async getStringPattern(e,t){const r=this;let n=[],i=[];t=w.call(r,t);let o=/(.*)\((.*)\)?/.exec(t);if(o&&o.length>2){n=r.#te(e,o[1])||[];let t=r.#te(e,o[1]+","+o[2])||[];n=n.concat(t)}else n=r.#te(e,t)||[];if(n.length>0){let t=[],o=t=>e.filter((function(e){return Object.keys(r.getSearchTypeByRole(e).queryProperties).length===Object.keys(t).length})),l=[];for(var a=0;a<n.length;a++){let e=n[a],c=o(e);for(var s=0;s<c.length;s++){let n=r.getSearchTypeByRole(c[s]);l.indexOf(n.typeName)<0&&(t.push(n.getSuggestionListHeader()),t.push('<li data-role="'+n.typeName+'"><a class="tc-ctl-search-li-loading" href="#">'+r.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>'),l.push(n.typeName));let o=e=>n.getSuggestionListElements(e);i.push(_(n,r.searchRequestsAbortController.signal,o,e))}}if(i.length>0)return r.resultsList.innerHTML+=t.join(""),r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),(await Promise.allSettled(i)).filter((e=>"fulfilled"===e.status)).map((e=>e.value)).flat()}throw"Search: Pattern not matched"}doSearch(e){const t=this;let r=t.textInput.value.trim();return r.length>0&&r!==t.lastPattern&&performance.now()-t.lastpress>t.interval&&(t.resultsList.classList.add(i.A.classes.HIDDEN),t.lastPattern=r,t.search(r,e),!0)}search(e,t){const r=this;if((e=e.trim()).length>0){e=e.toLowerCase(),r.searchRequestsAbortController&&r.searchRequestsAbortController.abort(),r.searchRequestsAbortController=new AbortController,r.resultsList.innerHTML="",r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),r.searchRequestsResults=[];let n,i=0,o=!1,a=t=>{if(i--,t&&(o=!0),0===i){if(e!==r.textInput.value.trim().toLowerCase())return;0===r.searchRequestsResults.length&&(r.cleanMap(),!o||r.layer&&0!==r.layer.features.length||(r.resultsList.innerHTML='<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>",r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")))),r.lastPattern=""}},s=()=>{r.searchRequestsResults&&(r.searchRequestsResults=r.searchRequestsResults.sort((function(e,t){var r,n=/(\d+)/,i="";return n.test(e.label)&&n.test(t.label)?(r=e.label.match(n)[1],i=t.label.match(n)[1]):(r=e.label,i=t.label),r>i?1:r<i?-1:0})),r.#X.data=r.searchRequestsResults,t&&t(r.searchRequestsResults))};n=r.rootCfg.active?r.rootCfg.active.getRootLabel():Promise.resolve(),n.then((()=>{for(const t of r.allowedSearchTypes)t.searchFunction?(i++,t.searchFunction.call(r,e).then(function(e,t){let n=()=>{let t=r.resultsList.querySelector('li[data-role="'+e+'"]');if(t){let e=Array.prototype.indexOf.call(t.parentElement.childNodes,t),n=r.resultsList.childNodes[e-1];r.resultsList.removeChild(n),r.resultsList.removeChild(t)}};if(t&&t.length>0){let e=t.filter((e=>-1===r.searchRequestsResults.findIndex((t=>t.id===e.id))));e.length===t.length?(r.searchRequestsResults=r.searchRequestsResults.concat(e),s()):1===t.length&&n()}else n();a(!0)}.bind(r,t.typeName)).catch(function(e){a(!1);const t=r.resultsList.querySelector("[data-role='"+e+"']");t&&(t.parentElement.removeChild(t.previousElementSibling),t.parentElement.removeChild(t))}.bind(r,t.typeName))):console.log("Falta implementación del método searchFunction en el tipo "+t.typeName)}))}else r.lastPattern="",r.cleanMap()}#re(e){const t=this;if(e&&e.length>0){const r=function(e){for(var r=0;r<e.length;r++)e[r].showsPopup!=t.queryableFeatures&&(e[r].showsPopup=t.queryableFeatures)};r(e),r(t.layer.features)}}#ee(e,t){const r=this;return r.toShare={id:e,dataRole:t},r.searchRequestsAbortController&&r.searchRequestsAbortController.abort(),new Promise((function(n,o){var a;r.loading||(r.loading=r.map.getLoadingIndicator()),a=r.loading.addWait(),matchMedia("(max-width: 30em)").matches&&(r.textInput.blur(),r.map.trigger(i.A.event.TOOLSCLOSE)),r.cleanMap();var s=null;const l=t||r.getElementOnSuggestionList.call(r,e).dataRole,c=r.getSearchTypeByRole(l),u=!Object.prototype.hasOwnProperty.call(r.availableSearchTypes,l);c.queryFactory?s=c.queryFactory.call(r,e,l):console.log("Falta implementación del método queryFactory"),r.loading.removeWait(a),s?r.getLayer().then((function(e){var t;switch(!0){case s.params.type===i.A.layerType.VECTOR:for(t=0;t<r.WFS_TYPE_ATTRS.length;t++)Object.prototype.hasOwnProperty.call(e,r.WFS_TYPE_ATTRS[t])&&delete e[r.WFS_TYPE_ATTRS[t]];break;case s.params.type===i.A.layerType.WFS:for(t=0;t<r.WFS_TYPE_ATTRS.length;t++)e[r.WFS_TYPE_ATTRS[t]]=s.params[r.WFS_TYPE_ATTRS[t]]}e.type=s.params.type;const o=function(e){e.layer===r.layer&&(r.map.off(i.A.event.FEATURESADD,o),r.#re(e.features))};r.map.on(i.A.event.FEATURESADD,o);const l=function(t){t.layer===e&&(r.map.off(i.A.event.LAYERUPDATE,l),r.map.one(i.A.event.FEATURESADD,(function(t){if(t.layer===e)if(!t.layer.features||0===t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){r.resultsList.classList.add(i.A.classes.HIDDEN);var n=t.layer.wrap.layer.getSource().getExtent(),o=t.layer.map.options.pointBoundsRadius;n[2]-n[0]==0&&(n[0]=n[0]-o,n[2]=n[2]+o),n[3]-n[1]==0&&(n[1]=n[1]-o,n[3]=n[3]+o),t.layer.map.setExtent(n),r.map.on3DView&&!r.loadingState&&r.map._on3DZoomTo({extent:n,layer:t.layer})}else t.layer.features&&t.layer.features.length>0?(r.resultsList.classList.add(i.A.classes.HIDDEN),r.loadingState||r.layer.map.zoomToFeatures(t.layer.features),r.map.trigger(i.A.event.FEATURESADD,{layer:r.layer,features:r.layer.features})):t.layer.features&&0===t.layer.features.length&&s.params.type===i.A.layerType.WFS&&(r.resultsList.inner=s.emptyResultHTML,r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),r.map.trigger(i.A.event.SEARCHQUERYEMPTY));r.loading.removeWait(a)})),t.layer.features&&t.layer.features.length>0?(r.resultsList.classList.add(i.A.classes.HIDDEN),r.loadingState||r.layer.map.zoomToFeatures(r.layer.features),r.map.trigger(i.A.event.FEATURESADD,{layer:r.layer,features:r.layer.features}),r.loading.removeWait(a)):t.layer.features&&0===t.layer.features.length&&s.params.type===i.A.layerType.WFS&&(r.resultsList.innerHTML=s.emptyResultHTML,r.textInput.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")),t.newData&&t.newData.features&&t.newData.features.length>0||r.map.trigger(i.A.event.SEARCHQUERYEMPTY),r.loading.removeWait(a)),n(s))};r.map.on(i.A.event.LAYERUPDATE,l),e.wrap.reloadSource()})):(o(Error("Method queryFactory has no implementation")),u||r.map.trigger(i.A.event.SEARCHQUERYEMPTY))}))}goToResult(e,t){var r=this;return r.getSearchTypeByRole(t)?r.#ee(e,t):r.availableSearchTypes[t]?(r.addAllowedSearchType(t,r.availableSearchTypes[t],r),r.#ee(e,t)):void alert("No se reconoce el tipo de búsqueda: "+t)}#ne(e){this.map?.wait((async()=>{let t,r,n=this.getPoint(e);if(n)t=this.getLabel(e),r=this.layer.addMarker(n,a.A.extend({},this.map.options.styles.point,{title:t,group:t}));else{var o=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=this.LAT+o[2]+this.LON+o[1],n=this.getPoint(e),n&&(t=this.getLabel(e),r=this.layer.addMarker(n,a.A.extend({},this.map.options.styles.point,{title:t,group:t})),this.textInput.value=t)}const[s]=await Promise.all([r,a.A.getTimedPromise(null,100)]);this.map.trigger(i.A.event.LAYERUPDATE,{layer:this.layer,newData:s}),this.map.trigger(i.A.event.FEATURESADD,{layer:this.layer,features:[s]}),this.map.zoomToFeatures([s])}))}getCoordinatesQuery(e){const t=this,r={};return/^X([-+]?\d+(?:[\.\,]\d+)?)Y([-+]?\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)?(r.params={type:i.A.layerType.VECTOR,styles:{marker:{url:t.layerStyleFN.bind(t,"marker","url",!0)}}},r.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+t.OUTBBX_LABEL+"</a></li>",t.#ne(e),r):null}getCadastralRefQuery(e){const t=this,r={},o=new RegExp("^"+t.MUN+"(\\d+)"+t.POL+"(\\d{1,2})"+t.PAR+"{1}(\\d{1,4})");if(o.test(e)){var a=o.exec(e),s=t.getSearchTypeByRole(i.A.searchType.CADASTRALPARCEL);return r.params={type:i.A.layerType.WFS,url:s.url,version:s.version,geometryName:s.geometryName,featurePrefix:s.featurePrefix,featureType:s.featureType,filter:new n.A.filter.and(new n.A.filter.equalTo(s.queryProperties.firstQueryWord,a[1].trim()),new n.A.filter.equalTo(s.queryProperties.secondQueryWord,a[2].trim()),new n.A.filter.equalTo(s.queryProperties.thirdQueryWord,a[3].trim())),outputFormat:s.outputFormat,styles:s.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r}return null}getRoadQuery(e){const t=this,r={},n=t.getSearchTypeByRole(i.A.searchType.ROAD);return r.params={type:i.A.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,filter:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r}getMilestoneQuery(e){const t=this,r={},n=t.getSearchTypeByRole(i.A.searchType.ROADMILESTONE);return r.params={type:i.A.layerType.WFS,url:n.url,version:n.version,geometryName:n.geometryName,featurePrefix:n.featurePrefix,featureType:n.getFeatureTypes(),maxFeatures:3e3,filter:n.filter.getGoToFilter(e),outputFormat:n.outputFormat,styles:n.styles},r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>",r}getPoint(e){const t=this;var r,n=t.map.wrap.isGeo(),i=/^X([-+]?\d+(?:\.\d+)?)Y([-+]?\d+(?:\.\d+)?)$/.exec(e);if(i&&3===i.length)r=[parseFloat(i[1]),parseFloat(i[2])],n&&(r=a.A.reproject(r,t.map.options.utmCrs,t.map.crs));else{if((i=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===i.length&&(r=[parseFloat(i[2]),parseFloat(i[1])],!n))return a.A.reproject(r,t.map.options.geoCrs,t.map.crs);if((i=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===i.length&&(r=[parseFloat(i[2]),parseFloat(i[1])],!n))return a.A.reproject(r,t.map.options.geoCrs,t.map.crs)}return r}insideLimit(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)}getPattern(){return this.textInput.value}getLabel(e){const t=this;var r=e,n=a.A.getMapLocale(t.map);const o=function(e,t){let r=a.A.parseCoords(t[1]+","+t[3]);return(e=e.replace(t[1],r[0].value.toLocaleString(n,{minimumFractionDigits:i.A.DEGREE_PRECISION,maximumFractionDigits:i.A.DEGREE_PRECISION}))).replace(t[3],r[1].value.toLocaleString(n,{minimumFractionDigits:i.A.DEGREE_PRECISION,maximumFractionDigits:i.A.DEGREE_PRECISION}))};if(e.match(new RegExp("^(?:"+t.LAT+"[-\\d])|(?:"+t.UTMX+"[-+]?[\\d])"))){let e=(r=r.replace(t.LAT,t.LAT_LABEL).replace(t.LON," "+t.LON_LABEL).replace(t.UTMX,t.UTMX_LABEL).replace(t.UTMY," "+t.UTMY_LABEL)).match(new RegExp("^"+t.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));e&&(r=o(r,e));var s=1.1.toLocaleString(n).substring(1,2);e=r.match(new RegExp("^"+t.UTMX_LABEL.trim()+"*\\s*([-+]?[0-9]{"+t.UTMX_MIN_LEN+","+t.UTMX_MAX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+t.UTMY_LABEL.trim()+"*\\s*([-+]?[0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$")),e&&(Number.isInteger(parseFloat(e[1]))||(r=r.replace(e[1],e[1].replace(".",s))),Number.isInteger(parseFloat(e[2]))||(r=r.replace(e[2],e[2].replace(".",s))))}else if(e.match(new RegExp("^(?:"+t.LON+"[-\\d])"))){const e=(r=r.replace(t.LON,t.LON_LABEL).replace(t.LAT," "+t.LAT_LABEL)).match(new RegExp("^"+t.LON_LABEL.trim()+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+t.LAT_LABEL.trim()+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));e&&(r=o(r,e))}else if(e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"))){const n=e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"));r=t.MUN_LABEL+n[2]+", "+t.POL_LABEL+n[4]+", "+t.PAR_LABEL+n[6]}return r}removePunctuation(e){e=e||"";for(var t=new Array(e.length),r=new Map([["á","a"],["à","a"],["Á","A"],["À","A"],["é","e"],["è","e"],["É","E"],["È","E"],["í","i"],["ì","i"],["Í","I"],["Ì","I"],["ó","o"],["ò","o"],["Ó","O"],["Ò","O"],["ú","u"],["ù","u"],["ü","u"],["Ú","U"],["Ù","U"],["Ü","U"]]),n=0,i=e.length;n<i;n++)t[n]=r.get(e.charAt(n))||e.charAt(n);return t.join("")}highlightResult(e){const t=this;var r=e.label,n=[];0===t.lastPattern.trim().length&&t.textInput.value.trim().length>0&&(t.lastPattern=t.textInput.value.trim());var o=t.lastPattern,a=[],s=",";if(-1===(o=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(o)?o.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):o.replace(t.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(s)&&(s=" "),a=o.trim().split(s),e.label.indexOf(t.LAT_LABEL)>-1&&e.label.indexOf(t.LON_LABEL)>-1||e.label.indexOf(t.UTMX_LABEL)>-1&&e.label.indexOf(t.UTMY_LABEL)>-1){a=t.lastPattern.split(" ");for(var l=0;l<a.length;l++)","===a[l].trim().slice(-1)&&(a[l]=a[l].slice(0,-1))}for(var c=0;c<a.length;c++)if(a[c].trim().length>0&&(n.push("("+a[c].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")"),/((\<)|(\>)|(\<\>))/gi.exec(a[c].trim())))for(var u=a[c].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),h=0;h<u.length;h++)u[h].trim().length>0&&n.push("("+u[h].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")");if(e.dataRole===i.A.searchType.ROAD||e.dataRole===i.A.searchType.ROADMILESTONE){const r=t.getSearchTypeByRole(e.dataRole).regEx.exec(t.lastPattern);r&&(n=[],r[2]&&r[3]&&r[4]?n.push("("+r[2]+"-"+r[3]+"-"+r[4]+")"):r[2]&&r[3]?n.push("("+r[2]+"-"+r[3]+")"):r[3]&&r[4]?n.push("("+r[3]+"-"+r[4]+")"):(r[2]||r[3])&&n.push("("+(r[2]||r[3])+")"),r[5]&&n.push("(?:"+t.getLocaleString("search.list.milestone")+"\\:\\s\\d*)("+r[5]+")\\d*"))}var d="("+n.join("|")+")";d=(d=(d=(d=(d=(d=(d=(d=(d=(d=(d=d.replace(/á|à/gi,"a")).replace(/é|è/gi,"e")).replace(/í|ì/gi,"i")).replace(/ó|ò/gi,"o")).replace(/ú|ù/gi,"u")).replace(/ü/gi,"u")).replace(/a/gi,"[a|á|à]")).replace(/e/gi,"[e|é|è]")).replace(/i/gi,"[i|í|ì]")).replace(/o/gi,"[o|ó|ò]")).replace(/u/gi,"[u|ú|ü|ù]");var p=new RegExp(d,"gi"),g=e.label;return r=e.dataRole!==i.A.searchType.ROAD||e.dataRole!==i.A.searchType.ROADMILESTONE?g.replace(p,(function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"})):g.replace(p,"<b>$1</b>"),r}formatStreetNumber(e){const t=this;for(var r=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],n=[function(e){var r=[],n=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},function(e){var r=[],n=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e),e}],i=0;i<n.length&&!r[i].call(t,e);)i++;return i<n.length?n[i].call(t,e):e}#Q(e){const t=this;var r=e.target;if("a"!==r.tagName.toLowerCase()){let t=e.target;const n=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector;for(;t;){if(n.call(t,"a")){r=t;break}t=t.parentElement}}r.querySelector("span[hidden]")&&(t.textInput.value=r.querySelector("span[hidden]").textContent,t.lastPattern=t.textInput.value,t.#ee(unescape(r.getAttribute("href")).substring(1),r.parentNode.dataset.role),n.A.UI.autocomplete.call(t.textInput,"clear"),t.shareButton&&t.shareButton.classList.remove(i.A.classes.HIDDEN))}bindRoot(e,t,r,n){const i=this;if(t)for(var o=e.length;o--;)if(n)e.push(a.A.extend({},e[o],{t}));else if(e[o][0]){var s=i.rootCfg.active.rootLabel?.filter(function(t){return t.label.indexOf(i.removePunctuation(e[o][0]).toLowerCase())>-1}.bind(i))||[];1===s.length?e[o][0]=s[0].id:s.length>1?s.map((function(t){var r=a.A.extend({},e[o]);r[0]=t.id,e.push(r)})):0===s.length&&r&&e.splice(o,1)}}exportState(){const e=this;return e.toShare?{id:e.id,searchText:e.textInput&&e.textInput.value,searchResult:JSON.stringify(e.toShare)}:null}importState(e){const t=this;if(e.searchResult){let r=JSON.parse(e.searchResult);r.id&&r.dataRole?(r.doZoom&&t.map.one(i.A.event.FEATURESADD,(function(e){e.layer===t.layer&&t.layer.map.zoomToFeatures(e.layer.features)})),t.loadingState=!0,t.goToResult(r.id,r.dataRole).then((function(){delete t.loadingState,t.textInput.value=e.searchText,t.shareButton&&t.shareButton.classList.remove(i.A.classes.HIDDEN),t.loading.reset()}))):alert("shared results error")}}}n.A.mix(y,u.default);const v=function(e){const t=this;var r=[],n=[],i=e.results.sort(A.bind(t));t.rootCfg.active&&(i=i.sort(S.bind(t)));for(var o=0;o<i.length;o++){var a=i[o];-1===n.indexOf(a.dataRole)&&(r.push(t.getSearchTypeByRole(a.dataRole).getSuggestionListHeader()),n.push(a.dataRole)),r.push(`<li data-role="${a.dataRole}"><a href="#${encodeURIComponent(a.id)}"><span hidden>${a.label}</span>${t.highlightResult(a)}</a></li>`)}return Array.prototype.map.call(t.resultsList.querySelectorAll("li[data-role]"),(e=>e.dataset.role)).filter(((e,t,r)=>r.indexOf(e)===t&&!n.includes(e))).forEach((e=>{r.push(t.getSearchTypeByRole(e).getSuggestionListHeader()),r.push(`<li data-role="${e}"><a class="tc-ctl-search-li-loading" href="#">${t.getLocaleString("searching")}<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>`)})),r.join("")},A=function(e,t){const r=this.getSearchTypeByRole(e.dataRole),n=this.getSearchTypeByRole(t.dataRole);return r.searchWeight&&n.searchWeight?r.searchWeight>n.searchWeight?1:r.searchWeight<n.searchWeight?-1:E(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:E(e.label,t.label)},S=function(e,t){const r=this,n=function(){var n,i,o=r.rootCfg.active.root[0]instanceof Array?r.rootCfg.active.root[0].join("-"):r.rootCfg.active.root[0];return e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0?(n=r.rootCfg.active.dataIdProperty.map((function(t){return e.properties[t].toString()})).join("-"),i=r.rootCfg.active.dataIdProperty.map((function(e){return t.properties[e].toString()})).join("-")):(n=e.id,i=t.id),n!==o&&i===o?1:n===o&&i!==o?-1:E(e.label,t.label)}.bind(this),i=r.getSearchTypeByRole(e.dataRole),o=r.getSearchTypeByRole(t.dataRole);return i.searchWeight&&o.searchWeight?i.searchWeight>o.searchWeight?1:i.searchWeight<o.searchWeight?-1:n():n()},E=function(e,t){const r=/[^a-zA-Z]/g,n=/[^0-9]/g;var i=parseInt(e,10),o=parseInt(t,10);if(Number.isNaN(i)&&Number.isNaN(o)){var a=e.replace(r,""),s=t.replace(r,"");if(a===s){var l=parseInt(e.replace(n,""),10),c=parseInt(t.replace(n,""),10);return l===c?0:l>c?1:-1}return a>s?1:-1}return Number.isNaN(i)?1:Number.isNaN(o)?-1:i>o?1:-1},w=function(e){const t=this;return e=t.removePunctuation(e),(e=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(t.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()},_=async function(e,t,r,i){const o=e.getFeatureTypes();for(var a=0,s=o.length;a<s;a++)await e.describeFeatureType(o[a]);return await fetch(e.url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:e.filter.getParams(i),signal:t}).then((function(e){if(e.ok)return e.text();throw"Search: error requestToWFS"})).then(r).catch((function(t){if("AbortError"===t.name)return console.log(`Search: petición abortada [${e.typeName}] ${i}`),[];throw n.A.error(t),t}))},L=function(e){let t=e.toLowerCase();const r=t.match(/[^A-ZÁÉÍÓÚÜÀÈÌÒÙáéíóúüàèìòùa-z0-9_]+(.)/g);if(r)for(var n=0;n<r.length;n++)/[-;:.<>\{\}\[\]\/\s()]/g.test(r[n])&&(t=t.replace(r[n],r[n].toUpperCase()));return t.charAt(0).toUpperCase()+t.substring(1)};y.prototype.CLASS="tc-ctl-search",n.A.control.Search=y;const C=y},2773:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(3967),l=r(4450),c=r(6792),u=r(5777),h=r(3791);n.A.control=n.A.control||{};class d{constructor(){this.worklayers="",this.noData=""}}class p extends s.default{constructor(){super(...arguments),this.model=new d}register(e){const t=this;return e.on(i.A.event.EXTERNALSERVICEADDED,(function(e){t.onExternalServiceAdded(e)})),super.register.call(t,e)}async loadTemplates(){const e=this,t=r.e(8635).then(r.bind(r,8635)),n=r.e(5212).then(r.bind(r,5212)),i=r.e(7024).then(r.bind(r,7024)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-branch"]=(await n).default,o[e.CLASS+"-node"]=(await i).default,e.template=o}render(e){const t=this;return a.A.prototype.render.call(t,(function(){var r=t.options.controls||[];if(r.length>0){var n=r[0],i=document.createElementNS("http://www.w3.org/1999/xhtml","div");t.div.appendChild(i),t.map.addControl(n.name,o.A.extend({div:i},n.options))}o.A.isFunction(e)&&e(),t.controller=new u.A(t.model,new h.A(t.div)),t.updateModel()}))}onExternalServiceAdded(e){const t=this;e&&e.layer&&(e.layer.map=t.map,t.map.addLayer(e.layer).then((function(r){t.updateLayerTree(e.layer)})))}addUIEventListeners(){const e=this;return e.div.addEventListener("change",n.A.EventTarget.listenerBySelector("sitna-toggle",(function(t){const r=t.target;var n=r;if(r.parentElement.dataset.layerId){const n=e.map.getLayer(r.parentElement.dataset.layerId);if(r.checked&&r.parentElement.querySelectorAll("ul sitna-toggle:not([checked]").length>0){const i="ul "+(n instanceof l.A?"li."+e.CLASS+"-leaf ":"")+"sitna-toggle:not([checked])",o=Array.from(t.target.parentElement.querySelectorAll(i)).map((e=>e.parentElement.dataset.layerUid));n.setNodeVisibility(o,r.checked)}}for(;n&&!n.matches("ul."+e.CLASS+"-wl");)n=n.parentElement;const i=[];var o;for(o=0;o<n.children.length;o++){const e=n.children[o];"LI"===e.tagName&&i.push(e)}for(o=0;o<i.length;o++){const t=i[o];if(t.contains(r)){const n=e.map.getLayer(t.dataset.layerId);var a=r;do{a=a.parentElement}while(a&&"LI"!==a.tagName&&!n.getNodeVisibility(a.dataset.layerUid));const i=a.dataset.layerUid;!n.getVisibility()&&r.checked&&n.setVisibility(r.checked),n.setNodeVisibility(i,r.checked);break}}t.stopPropagation()}))),e.div.addEventListener(i.A.event.MOUSEUP,n.A.EventTarget.listenerBySelector("button."+e.CLASS+"-collapse-btn",(function(t){t.target.blur();const r=t.target.parentElement;r.classList.contains(e.CLASS+"-leaf")||(r.classList.toggle(i.A.classes.COLLAPSED),r.querySelector("ul").classList.toggle(i.A.classes.COLLAPSED),t.stopPropagation())}))),e}update(e){const t=this;var r=function(e){for(var t=0,r=e.children.length;t<r;t++){const r=e.children[t];if(r.matches("sitna-toggle"))return r}return null};const n=t.getLayerUIElements().find((t=>t.dataset.layerId===e.id));if(!n)return;e.tree=null;const o=e.getTree(!1),a=r(n);return a.checked=e.getVisibility(),a.checked&&e.getNodeVisibility(o.uid,o)===i.A.visibility.HAS_VISIBLE&&(a.checked=!1,a.indeterminate=!0),a.checked&&e.getNodeVisibility(o.uid,o)===i.A.visibility.NOT_VISIBLE&&(a.checked=a.indeterminate=!1),n.querySelectorAll("li").forEach((function(t){const n=r(t),a=t.dataset.layerUid;switch(e.getNodeVisibility(a,o)){case i.A.visibility.VISIBLE:n.checked=!0,n.indeterminate=!1;break;case i.A.visibility.NOT_VISIBLE:n.checked=!1,n.indeterminate=!1;break;case i.A.visibility.NOT_VISIBLE_AT_RESOLUTION:n.checked=!0,n.indeterminate=!1;break;case i.A.visibility.HAS_VISIBLE:case null:n.checked=!1,n.indeterminate=!0;break;default:{const t=e.findNode(a,o),r=!Object.prototype.hasOwnProperty.call(t,"isVisible")||t.isVisible;if(!t.children||!t.children.length||e instanceof c.A)n.checked=r,n.indeterminate=!1;else{const e=t.children.every((e=>e.isVisible||e.visibilityState&&e.visibilityState===i.A.visibility.VISIBLE)),r=t.children.every((e=>!e.isVisible||e.visibilityState&&e.visibilityState===i.A.visibility.NOT_VISIBLE));n.checked=e,n.indeterminate=!e&&!r}}}})),Array.from(n.parentElement.querySelectorAll("li:not(."+t.CLASS+"-leaf)")).reverse().forEach((e=>{const t=!!n.parentElement.querySelector("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > sitna-toggle[checked]"),r=!!n.parentElement.querySelector("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > sitna-toggle:not([checked])"),i=Array.from(n.parentElement.querySelectorAll("li[data-layer-uid='"+e.dataset.layerUid+"'] > ul > li > sitna-toggle")).some((e=>e.indeterminate));e.querySelector("sitna-toggle").indeterminate=t&&r||i,e.querySelector("sitna-toggle").checked=t&&!r&&!i})),t}updateScale(e){const t=this,r=function(e,r){e&&e.querySelectorAll("li").forEach((function(e){const n=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!r.isVisibleByScale(n))}))};return e?r(t.getLayerUIElements().find((t=>t.dataset.layerId===e.id)),e):t.getLayerUIElements().forEach((function(e){r(e,t.map.getLayer(e.dataset.layerId))})),t}updateLayerTree(e){const t=this;return e.isBase||e.options.stealth||(super.updateLayerTree.call(t,e),t.div.querySelector("."+t.CLASS+"-empty").classList.add(i.A.classes.HIDDEN),t.getRenderedHtml(t.CLASS+"-branch",t.layerTrees[e.id]).then((function(r){const n=(new DOMParser).parseFromString(r,"text/html").body.firstChild,o=n.dataset.layerUid,a=t.div.querySelector("."+t.CLASS+'-wl li[data-layer-uid="'+o+'"]')||t.div.querySelector("."+t.CLASS+'-wl li[data-layer-id="'+e.id+'"]');if(a){if(e instanceof c.A){const r="ul."+t.CLASS+"-wl",o="ul."+t.CLASS+"-branch",s="li."+t.CLASS+"-node",l="li."+t.CLASS+"-leaf",c=Array.from(a.querySelectorAll("li.tc-ctl-toc-node:not(.tc-ctl-toc-leaf):not(.tc-collapsed)")).reduce((function(e,t){return e.push(t.dataset.layerUid),e}),[]);a.innerHTML=n.innerHTML,a.setAttribute("class",n.getAttribute("class")),a.dataset.layerId||(a.dataset.layerId=e.id),a.querySelectorAll(r+" "+o+" "+o+","+r+" "+o+" "+s).forEach((function(e){e.matches(l)||"LI"===e.tagName&&c.some((t=>t===e.dataset.layerUid))||"UL"===e.tagName&&c.some((t=>t===e.parentElement.dataset.layerUid))||e.classList.add(i.A.classes.COLLAPSED)}))}}else{n.dataset.layerId=e.id;const r=t.div.querySelector("."+t.CLASS+"-wl"),o=t.map.workLayers.indexOf(e);o?r.children[o-1].insertAdjacentElement("afterend",n):r.insertAdjacentElement("afterbegin",n);const a="ul."+t.CLASS+"-wl",s="ul."+t.CLASS+"-branch",c="li."+t.CLASS+"-node",u="li."+t.CLASS+"-leaf";n.querySelectorAll(a+" "+s+" "+s+","+a+" "+s+" "+c).forEach((function(e){e.matches(u)||e.classList.add(i.A.classes.COLLAPSED)})),e instanceof l.A&&n.querySelector("sitna-toggle").classList.add(i.A.classes.HIDDEN)}t.update(e),t.updateScale(e)})).catch((function(e){n.A.error(e)}))),t}removeLayer(e){return e.isBase||super.removeLayer.call(this,e),this}updateLayerVisibility(e){const t=this;return t.getLayerUIElements().forEach((function(r){if(r.dataset.layerId===e.id){var n=!e.getVisibility();n?(r.querySelectorAll("sitna-toggle").forEach((function(t){t.checked=!n,e instanceof c.A&&e.setNodeVisibility(t.parentElement.dataset.layerUid,!1)})),e instanceof l.A&&t.map.getLayer("idena").setLayerNames("")):e instanceof l.A&&r.querySelector("sitna-toggle.tc-ctl-toc-branch-cb[checked]")&&e.setLayerNames(Array.from(r.querySelectorAll("li."+t.CLASS+"-leaf")).reduce(((e,t)=>e.concat(t.dataset.layerName)),[]))}})),t}updateLayerOrder(e,t,r){return this}getLayerUIElements(){const e=[],t=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var r=0,n=t.length;r<n;r++){const n=t[r];"LI"===n.tagName&&e.push(n)}return e}exportState(){}importState(e){}updateModel(){this.model.worklayers=this.getLocaleString("worklayers"),this.model.noData=this.getLocaleString("noData")}async updateLanguage(){this.updateModel()}}p.prototype.CLASS="tc-ctl-toc",n.A.control.TOC=p;const g=p},2806:(e,t,r)=>{"use strict";function n(e,t,r){const n=void 0!==r?e.toFixed(r):""+e;let i=n.indexOf(".");return i=-1===i?n.length:i,i>t?n:new Array(1+t-i).join("0")+n}function i(e,t){const r=(""+e).split("."),n=(""+t).split(".");for(let e=0;e<Math.max(r.length,n.length);e++){const t=parseInt(r[e]||"0",10),i=parseInt(n[e]||"0",10);if(t>i)return 1;if(i>t)return-1}return 0}r.d(t,{H:()=>n,Z:()=>i})},2809:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n=r(915),i=r(2096),o=r(8609),a=r(3953),s=r(2497),l=r(6361),c=r(3671);class u extends i.Ay{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,void 0===t||Array.isArray(e[0])?this.setCoordinates(e,t):this.setFlatCoordinates(t,e)}clone(){return new u(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,r,i){return i<(0,n.Ld)(this.getExtent(),e,t)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,a.MD)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,a.n)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,r,i))}getArea(){return(0,o.eN)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return(0,l.n2)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=(0,c.P4)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new u(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,s.z2)(this.flatCoordinates,0,e,this.stride),this.changed()}}const h=u},2845:(e,t,r)=>{"use strict";r.d(t,{Gd:()=>s,a_:()=>o,t7:()=>i,zb:()=>a});var n=r(915);function i(e,t,r,i,a){return!(0,n.sB)(a,(function(n){return!o(e,t,r,i,n[0],n[1])}))}function o(e,t,r,n,i,o){let a=0,s=e[r-n],l=e[r-n+1];for(;t<r;t+=n){const r=e[t],n=e[t+1];l<=o?n>o&&(r-s)*(o-l)-(i-s)*(n-l)>0&&a++:n<=o&&(r-s)*(o-l)-(i-s)*(n-l)<0&&a--,s=r,l=n}return 0!==a}function a(e,t,r,n,i,a){if(0===r.length)return!1;if(!o(e,t,r[0],n,i,a))return!1;for(let t=1,s=r.length;t<s;++t)if(o(e,r[t-1],r[t],n,i,a))return!1;return!0}function s(e,t,r,n,i,o){if(0===r.length)return!1;for(let s=0,l=r.length;s<l;++s){const l=r[s];if(a(e,t,l,n,i,o))return!0;t=l[l.length-1]}return!1}},2871:(e,t,r)=>{"use strict";r.d(t,{A:()=>A});var n=r(6514),i=r(915),o=r(503),a=r(4142),s=r(2096),l=r(8609),c=r(4049),u=r(3953),h=r(2845),d=r(2497),p=r(6361),g=r(2616),f=r(4350),m=r(3402),y=r(3671);class v extends s.Ay{constructor(e,t,r){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){const i=e,o=[],a=[];for(let e=0,t=i.length;e<t;++e){const t=i[e],r=o.length,s=t.getEnds();for(let e=0,t=s.length;e<t;++e)s[e]+=r;(0,n.X$)(o,t.getFlatCoordinates()),a.push(s)}t=0===i.length?this.getLayout():i[0].getLayout(),e=o,r=a}void 0!==t&&r?(this.setFlatCoordinates(t,e),this.endss_=r):this.setCoordinates(e,t)}appendPolygon(e){let t;if(this.flatCoordinates){const r=this.flatCoordinates.length;(0,n.X$)(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let e=0,n=t.length;e<n;++e)t[e]+=r}else this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const r=new v(this.flatCoordinates.slice(),this.layout,t);return r.applyProperties(this),r}closestPointXY(e,t,r,n){return n<(0,i.Ld)(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,u.c)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,u.te)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,r,n))}containsXY(e,t){return(0,h.Gd)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return(0,l.Cs)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),(0,m.NK)(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,(0,p.Dz)(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=(0,c.C)(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=(0,g.p)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new o.A(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;(0,m.mb)(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=(0,m.NK)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],r=[];return t.length=(0,y.sx)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,r),new v(t,"XY",r)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(0===e)t=0;else{const r=this.endss_[e-1];t=r[r.length-1]}const r=this.endss_[e].slice(),n=r[r.length-1];if(0!==t)for(let e=0,n=r.length;e<n;++e)r[e]-=t;return new a.Ay(this.flatCoordinates.slice(t,n),this.layout,r)}getPolygons(){const e=this.layout,t=this.flatCoordinates,r=this.endss_,n=[];let i=0;for(let o=0,s=r.length;o<s;++o){const s=r[o].slice(),l=s[s.length-1];if(0!==i)for(let e=0,t=s.length;e<t;++e)s[e]-=i;const c=new a.Ay(t.slice(i,l),e,s);n.push(c),i=l}return n}getType(){return"MultiPolygon"}intersectsExtent(e){return(0,f.Wp)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const r=(0,d.d6)(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{const e=r[r.length-1];this.flatCoordinates.length=0===e.length?0:e[e.length-1]}this.changed()}}const A=v},2875:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(3301),a=r(5909);n.A.control=n.A.control||{};class s extends a.default{constructor(){super(...arguments);const e=this;e.geometryType=i.A.geom.POLYLINE,e.style=o.A.extend(!0,{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2},e.options.style)}}n.A.control.LineFeatureInfo=s;const l=s},2902:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(3327);const i="sitna-toggle";class o extends n.A{#ie;#oe;constructor(){super(),this.#ie=document.createElement("input"),this.#ie.setAttribute("type","checkbox"),this.#ie.setAttribute("id","cb"),this.#ie.addEventListener("change",(e=>{this.checked=this.#ie.checked;const t=new Event("change",{bubbles:!0});this.dispatchEvent(t)})),this.shadowRoot.appendChild(this.#ie),this.#oe=document.createElement("label"),this.#oe.setAttribute("for","cb"),this.shadowRoot.appendChild(this.#oe),this.createTemplate();const e=this.getTemplate();this.#oe.appendChild(e.content.cloneNode(!0))}connectedCallback(){this.#ae(),this.#se(),this.#le(),this.#d(),this.#ce()}static get observedAttributes(){return["disabled","checked","checked-icon-text","unchecked-icon-text","value"]}attributeChangedCallback(e,t,r){t!==r&&("disabled"===e?this.#d():"checked"===e&&this.#ae(),t!==r&&("checked-icon-text"===e&&this.#se(),"unchecked-icon-text"===e&&this.#le(),"value"===e&&this.#ce()))}get elementName(){return i}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}#d(){this.#ie.disabled=this.disabled}get checked(){return this.hasAttribute("checked")}set checked(e){this.toggleAttribute("checked",!!e)}get indeterminate(){return this.#ie.indeterminate}set indeterminate(e){const t=!!e;this.#ie.classList.toggle("indeterminate",t),this.#ie.indeterminate=t}click(){this.#ie.click()}#ae(){this.#ie.checked=this.checked,this.indeterminate=!1}get checkedIconText(){return this.getAttribute("checked-icon-text")}set checkedIconText(e){this.#ue("checked-icon-text",e)}#se(){this.#he("checked-icon-text",this.checkedIconText)}get uncheckedIconText(){return this.getAttribute("unchecked-icon-text")}set uncheckedIconText(e){this.#ue("unchecked-icon-text",e)}get title(){return this.getAttribute("title")}set title(e){this.setAttribute("title",e)}#de(){this.#ie.setAttribute("title",this.title)}#le(){this.#he("unchecked-icon-text",this.uncheckedIconText)}get value(){return this.#ie.value}set value(e){this.setAttribute("value",e)}#ce(){this.#ie.value=this.getAttribute("value")}#ue(e,t){t?this.setAttribute(e,t):this.removeAttribute(e)}#he(e,t){t?this.#ie.setAttribute("data-"+e,t):this.#ie.removeAttribute("data-"+e)}}customElements.get(i)||(n.A.preloadStyle(i),customElements.define(i,o));const a=o},2935:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(797);const o={getLayers:function(){const e=this;return e.layers||(e.layers=[]),e.layers},registerLayerAdd:function(){const e=this;e.map.on(i.A.event.LAYERADD,(function(t){const r=e.getIdCount(t.layer.id);r&&(n.A.setUIDStart(r+1,{prefix:e.getId()+"-"}),t.layer.owner=e)}))},getIdCount:function(e){const t=new RegExp(`^${this.getId()}(-(\\d+))*$`),r=e.match(t);return r?parseInt(r[2]):0}}},2948:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(8038),i=r(7018),o=r(797),a=r(187),s=r(153);n.A.i18n=n.A.i18n||s.A;class l extends i.A{STYLETYPE="marker";constructor(e,t){if(super(e,t),!this.wrap.isNative(e)){const r=this.layer?.map?this.layer.map.options.locale:a.A.locale;this.title=this.options.title||n.A.i18n[r][o.A.MARKER],this.wrap.createMarker(e,t)}}}const c=l},2978:(e,t,r)=>{"use strict";r.d(t,{A:()=>y});var n=r(1386),i=r(7430),o=r(8217),a=r(3942),s=r(797),l=r(5101);const c="@",u="#text",h=function(e){let[t,r]=e.split(":");return r||([t,r]=[r,t]),[t,r]},d=function(e){let[t,r]=e.split(c);const[n,i]=h(t);if(!r)return[n,i];const[o,a]=h(r);return 0===t.length?[o,c+a]:n!==o&&o?[n,i+c+o+":"+a]:[n,i+c+a]},p="http://www.opengis.net/gml",g="http://www.opengis.net/gml/3.2";n.A.prototype.MULTIPOINT_PARSERS[g]=n.A.prototype.MULTIPOINT_PARSERS[p],n.A.prototype.MULTILINESTRING_PARSERS[g]=n.A.prototype.MULTILINESTRING_PARSERS[p],n.A.prototype.MULTIPOLYGON_PARSERS[g]=n.A.prototype.MULTIPOLYGON_PARSERS[p],n.A.prototype.POINTMEMBER_PARSERS[g]=n.A.prototype.POINTMEMBER_PARSERS[p],n.A.prototype.LINESTRINGMEMBER_PARSERS[g]=n.A.prototype.LINESTRINGMEMBER_PARSERS[p],n.A.prototype.POLYGONMEMBER_PARSERS[g]=n.A.prototype.POLYGONMEMBER_PARSERS[p],n.A.prototype.RING_PARSERS[g]=n.A.prototype.RING_PARSERS[p],n.A.prototype.readFeaturesInternal=function(e,t){const r=e.localName;let i=null;if("FeatureCollection"==r){[...e.attributes].forEach((e=>{e.name.startsWith("xmlns:")&&(this.featureTypeMetadata??={origin:s.A.format.GML,originalMetadata:{namespaces:[],featureTypes:{}}},this.featureTypeMetadata.originalMetadata.namespaces.push({prefix:e.name.substring(e.name.indexOf(":")+1),value:e.value}))})),e.getAttribute("xsi:schemaLocation")?.replace(/\s+/g," ").split(" ").forEach(((e,t,r)=>{if(t%2==0){const n=this.featureTypeMetadata?.originalMetadata.namespaces.find((t=>t.value===e));n&&(n.schemaLocation=r[t+1])}}));var o=this.FEATURE_COLLECTION_PARSERS[n.A.prototype.namespace]||this.FEATURE_COLLECTION_PARSERS[this.namespace];o.member||(o.member=ol.xml.makeArrayPusher(n.A.prototype.readFeaturesInternal));const r=Object.keys(this.FEATURE_COLLECTION_PARSERS)[0];this.FEATURE_COLLECTION_PARSERS[e.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[r],this.FEATURE_COLLECTION_PARSERS["http://www.opengis.net/gml"]=this.FEATURE_COLLECTION_PARSERS[r],i=(0,a.eY)([],this.FEATURE_COLLECTION_PARSERS,e,t,this),this.featureTypeMetadata&&i.forEach((e=>this.featureMetadata.set(e,this.featureTypeMetadata)))}else if("featureMembers"==r||"featureMember"==r||"member"==r){const n=t[0];let o=n.featureType,s=n.featureNS;const l="p",c="p0";if(e.childNodes){o=[],s={};for(let r=0,n=e.childNodes.length;r<n;++r){const n=e.childNodes[r];if(1===n.nodeType){const[e,r]=h(n.nodeName);if("FeatureCollection"==r)return(0,a.eY)([],this.FEATURE_COLLECTION_PARSERS,n,t,this);if(-1===o.indexOf(r)){let t="",i=0;const a=n.namespaceURI;for(let e in s){if(s[e]===a){t=e;break}++i}t||(t=e??l+i,s[t]=a),o.push(t+":"+r)}}}"featureMember"!=r&&(n.featureType=o,n.featureNS=s)}if("string"==typeof s){const e=s;s={},s[c]=e}const u={},d=Array.isArray(o)?o:[o];for(let e in s){const t={};for(let n=0,i=d.length;n<i;++n)(-1===d[n].indexOf(":")?c:d[n].split(":")[0])===e&&(t[d[n].split(":").pop()]="featureMembers"==r?ol.xml.makeArrayPusher(this.readFeatureElement,this):ol.xml.makeReplacer(this.readFeatureElement,this));u[s[e]]=t}i="featureMember"==r?(0,a.eY)(void 0,u,e,t):(0,a.eY)([],u,e,t);const p=this.featureTypeMetadata?.originalMetadata;p&&d.forEach((e=>{Object.prototype.hasOwnProperty.call(p.featureTypes,e)||(p.featureTypes[e]={})}))}return null===i&&(i=[]),i},n.A.prototype.readGeometryElement=function(e,t){var r=t[0];if(r.srsName=e.firstElementChild.getAttribute("srsName"),r.srsDimension=e.firstElementChild.getAttribute("srsDimension"),(this instanceof ol.format.GML2CRS84||this instanceof ol.format.GML3CRS84)&&("EPSG:4326"!==r.srsName||!r.srsName))throw new Error("Conflicto de CRS");r.srsName||(r.srsName=this.srsName),r.dataProjection=ol.proj.get(r.srsName);let n=(0,a.eY)(null,this.GEOMETRY_PARSERS,e,t,this);return n?Array.isArray(n)?(0,o.zU)(n,r):(n.getStride()>2&&n.getFlatCoordinates().every(((e,t)=>(t+1)%3!=0||0===e))&&(n=new n.constructor(n.getCoordinates(),"XY")),(0,o.hX)(n,!1,r)):void 0};const f=/^[\s\xa0]*$/,m=(e,t,r)=>{if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];void 0===n?e[t]=[]:n instanceof Array||(e[t]=[n]),void 0!==r&&e[t].push(r)}else e[t]=r};n.A.prototype.readFeatureElementInternal=function(e,t,r){let n,i={};for(let r=e.firstElementChild;r;r=r.nextElementSibling){let e,o=!1;const a=r.localName,s=r.tagName;0===r.childNodes.length||1===r.childNodes.length&&(3===r.firstChild.nodeType||4===r.firstChild.nodeType)?(e=ol.xml.getAllTextContent(r,!1),f.test(e)&&(e=void 0)):(e=this.readGeometryElement(r,t),e?"boundedBy"!==a&&"referencePoint"!==a&&(n=s.substring(s.indexOf(":")+1),o=!0):e=this.readFeatureElementInternal(r,t,!1));const l=o?n:s,h="xsi:nil";"true"===r.getAttribute(h)&&(e=null);const d=r.attributes.length;if(d>0&&(1!==d||!r.hasAttribute(h))){e&&"object"==typeof e||(e={[u]:e});for(let t=0;t<d;t++){const n=r.attributes[t].name;n!==h&&(e[c+n]=r.attributes[t].value)}}m(i,l,e)}const o={};for(const e in i){const t=i[e];if(t&&"object"==typeof t&&Object.prototype.hasOwnProperty.call(t,u)){o[e]=t[u];for(const r in t)r!==u&&(o[e+r]=t[r])}else o[e]=t}if(i=o,r){const t=new ol.Feature(i);n&&t.setGeometryName(n);const r=e.getAttribute("fid")||e.getAttributeNS(this.namespace,"id");return r&&t.setId(r),t}return i},n.A.prototype.readFeatures=async function(e,t){if(delete this.featureTypeMetadata,!e)return[];let r,n;if("string"==typeof e?(n=(0,a.qg)(e),r=this.readFeaturesFromDocument(n,t)):(n=e,r=(0,a.wz)(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)),r.length){if(this.featureTypeMetadata){const e=this.featureTypeMetadata.originalMetadata,t=new l.default;for(let r in e.featureTypes){if(r.endsWith(":feature"))continue;const i=e.featureTypes[r],o=await t.parseSchemas(n,r);Object.assign(i,Object.values(o)[0])}const[o]=h(Object.keys(e.featureTypes)[0]),a=(e,t,r)=>{const n=(e,t,r,n)=>{e?e.set(r,n,!0):t[r]=n};for(let i in t){let l=r[i];if(!l){const[e,t]=d(i);e===o&&(l=r[t])}if(l){const r=l.type[u]?.type??l.type;if("string"==typeof r)switch(this.getType(r)){case s.A.dataType.FLOAT:case s.A.dataType.INTEGER:{let r=parseFloat(t[i]);Number.isNaN(r)&&(r=void 0),n(e,t,i,r);break}case s.A.dataType.BOOLEAN:n(e,t,i,"true"===t[i])}else a(null,t[i],r)}}},c=Object.values(e.featureTypes)[0],p=function(e,t){if(!(t instanceof i.A))for(let r in t){const n=t[r],[i,a]=d(r);i&&(e?r===e.getGeometryName()?(e.setGeometryName(a),e.unset(r,!0),e.set(a,n,!0)):i===o&&(e.unset(r,!0),e.set(a,n,!0)):i===o&&(t[a]=n,delete t[r])),n&&"object"==typeof n&&(i&&i!==o||p(null,n))}},g=function(e,t,r){if(!t||"object"!=typeof t)return;const n=Object.keys(t);for(let i of n){let n=r[i];if(!n){const[e,t]=d(i);e===o&&(n=r[t])}if(n){const r=n.type;if(r&&"object"==typeof r)if(Object.prototype.hasOwnProperty.call(r,u))g(null,t[i],r);else{const o=n["@maxOccurs"];if((parseInt(o)>1||"unbounded"===o)&&Array.isArray(t[i])){for(const e of t[i])e[u]||delete e[u];break}Object.prototype.hasOwnProperty.call(t,i)?g(null,t[i],r):e&&e.unset(i,!0)}}}};for(const e of r){let t=e.getProperties();a(e,t,c),p(e,t),g(e,t,c)}}const e=(t,r)=>{for(const n in r){const o=r[n];if(o instanceof i.A)return t.setGeometry(o),delete r[n],!0;if(o&&"object"==typeof o&&Object.keys(o).length&&e(t,o))return!0}return!1};r.forEach((t=>{t.getGeometry()||e(t,t.getProperties())}))}return r},n.A.prototype.getGeometryType=function(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"LinearRingPropertyType":case"PolygonPropertyType":case"gml:Polygon":case"Polygon":return s.A.geom.POLYGON;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"MultiPolygonPropertyType":case"MultiSurfacePropertyType":case"gml:MultiPolygon":case"MultiPolygon":return s.A.geom.MULTIPOLYGON;case"gml:LineStringPropertyType":case"gml:CurvePropertyType":case"LineStringPropertyType":case"CurvePropertyType":case"gml:LineString":case"LineString":return s.A.geom.POLYLINE;case"gml:MultiLineStringPropertyType":case"gml:MultiCurvePropertyType":case"MultiLineStringPropertyType":case"MultiCurvePropertyType":case"gml:MultiLineString":case"MultiLineString":return s.A.geom.MULTIPOLYLINE;case"gml:PointPropertyType":case"PointPropertyType":case"gml:Point":case"Point":return s.A.geom.POINT;case"gml:MultiPointPropertyType":case"MultiPointPropertyType":case"gml:MultiPoint":case"MultiPoint":return s.A.geom.MULTIPOINT;case"gml:BoxPropertyType":case"BoxPropertyType":return s.A.geom.RECTANGLE;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:AbstractGeometryType":case"GeometryCollectionPropertyType":case"GeometryAssociationType":case"GeometryPropertyType":return s.A.geom.GEOMETRY;default:return!1}},n.A.getGeometryType=function(e){return n.A.prototype.getGeometryType(e)};const y=n.A},2994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var n=r(8038),i=r(797),o=r(3301),a=r(187),s=r(4128),l=r(3503),c=r.n(l),u=r(3791),h=r(5777);n.A.control=n.A.control||{},i.A.classes.CONNECTION_OFFLINE=i.A.classes.CONNECTION_OFFLINE||"tc-conn-offline",i.A.classes.CONNECTION_WIFI=i.A.classes.CONNECTION_WIFI||"tc-conn-wifi",i.A.classes.CONNECTION_MOBILE=i.A.classes.CONNECTION_MOBILE||"tc-conn-mobile",i.A.classes.OFFLINE=i.A.classes.OFFLINE||"tc-offline",i.A.event.MAPCACHEDOWNLOAD=i.A.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc",i.A.event.MAPCACHEDELETE=i.A.event.MAPCACHEDELETE||"mapcachedelete.tc",i.A.event.MAPCACHEPROGRESS=i.A.event.MAPCACHEPROGRESS||"mapcacheprogress.tc",i.A.event.MAPCACHEERROR=i.A.event.MAPCACHEERROR||"mapcacheerror.tc";const d=function(e){return decodeURIComponent(e).split(",").map((function(e){return parseFloat(e)}))},p=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")};class g{constructor(){this.offlineMaps="",this["cb.filter.plhr"]="",this["cb.noMaps"]="",this.noMatches="",this.newOfflineMap="",this.cancel="",this["cb.DownloadingMap"]="",this.save="",this.editMapName="",this.viewMapExtent="",this.deleteMap="",this.nameRequired="",this.close="",this.availableOfflineMaps="",this.selectAtLeastOne="",this.maxRes="",this.ok="",this.cancel=""}}class f{constructor(){this.offlineMap="",this.returnToOnlineMaps=""}}class m extends s.default{MAP_DEFINITION_PARAM_NAME="map-def";MAP_EXTENT_PARAM_NAME="map-extent";LOCAL_STORAGE_KEY_PREFIX="SITNA.offline.map.";ROOT_CACHE_NAME="root";SERVICE_WORKER_FLAG="sw";static state={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};static action={CREATE:"create",DELETE:"delete"};offlineControls=["attribution","basemapSelector","offlineMapMaker","click","coordinates","dataLoader","draw","edit","fileImport","fullScreen","geolocation","loadingIndicator","measure","modify","navBar","popup","print","scale","scaleBar","scaleSelector","state","workLayerManager"];#pe;#ge;#fe;#me;constructor(){super(...arguments);const e=this,t="."+e.CLASS;e.#fe={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",RESOLUTIONPANEL:t+"-res-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"},e.storedMaps=[],e.model=new g,e.offlineModel=new f;const r=o.A.getParameterByName(e.MAP_DEFINITION_PARAM_NAME),s=o.A.getParameterByName(e.MAP_EXTENT_PARAM_NAME);e.mapIsOffline=!!r,r&&(e.currentMapDefinition=JSON.parse(window.atob(decodeURIComponent(r)))),s&&(e.currentMapExtent=d(s));try{e.localStorage=window.localStorage;const t="__delete_me__";e.localStorage.setItem(t,t),e.localStorage.removeItem(t)}catch(t){e.localStorage=null,n.A.error(e.getLocaleString("couldNotAccessLocalStorage"))}if(e.localStorage){for(var l=0,c=e.localStorage.length;l<c;l++){var u=e.localStorage.key(l);if((0===u.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)||0===u.indexOf("TC.offline.map."))&&u!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var h=e.localStorage.getItem(u).split(" "),p=d(h.shift()),m={name:h.join(" "),extent:p,url:decodeURIComponent(u.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(m)}}e.storedMaps.sort((function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}))}var y=o.A.extend({},arguments.length>1?arguments[1]:arguments[0]);e._dialogDiv=o.A.getDiv(y.dialogDiv),y.dialogDiv||document.body.appendChild(e._dialogDiv),e.mapIsOffline&&document.querySelectorAll(e.#fe.OFFLINEHIDDEN).forEach((function(e){e.classList.add(i.A.classes.HIDDEN)})),e.wrap=new n.A.wrap.control.OfflineMapMaker(e),e.isDownloading=!1,e.baseLayers=[],e.options.averageTileSize=e.options.averageTileSize||a.A.averageTileSize,e.requestSchemas=[],e.minResolution=0,e.currentMap=null,e.#pe=0;var v=history.pushState;history.pushState=function(t){var r;return r=v.apply(history,arguments),e.#ge&&e.#ge.querySelector(e.#fe.EXIT).setAttribute("href",e.getOnlineMapUrl()),r};var A=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{};const S=function(){if(e.#ge){const t=e.#ge.querySelector(e.#fe.OFFPANEL);switch(t.classList.remove(i.A.classes.CONNECTION_OFFLINE,i.A.classes.CONNECTION_MOBILE,i.A.classes.CONNECTION_WIFI),A.type){case 1:case 2:case void 0:t.classList.add(i.A.classes.CONNECTION_WIFI);break;default:t.classList.add(i.A.classes.CONNECTION_MOBILE)}}},E=function(){if(e.#ge){const t=e.#ge.querySelector(e.#fe.OFFPANEL);t.classList.add(i.A.classes.CONNECTION_OFFLINE),t.classList.remove(i.A.classes.CONNECTION_MOBILE,i.A.classes.CONNECTION_WIFI)}};A.addEventListener&&A.addEventListener("typechange",S),window.addEventListener("online",S),window.addEventListener("offline",E),e.renderPromise().then((()=>{navigator.onLine||E()}))}async register(e){const t=this,r=super.register.call(t,e);t.getServiceWorker().then((function(){navigator.serviceWorker.ready.then((function(){navigator.serviceWorker.addEventListener("message",(function(e){switch(e.data.event){case"progress":t.trigger(i.A.event.MAPCACHEPROGRESS,{url:e.data.name,requestId:e.data.requestId,loaded:e.data.count,total:e.data.total});break;case"cached":t.trigger(i.A.event.MAPCACHEDOWNLOAD,{url:e.data.name,requestId:e.data.requestId});break;case"deleted":t.trigger(i.A.event.MAPCACHEDELETE,{url:e.data.name});break;case"error":e.data.action===m.action.CREATE&&n.A.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}}))})),navigator.onLine&&async function(){const e=document.documentElement.getAttribute("manifest")||"manifest.appcache";let t=(await n.A.ajax({url:o.A.addURLParameters(e,{ts:Date.now()}),method:"GET",responseType:"text"})).data.normalize();var r=c()(t),i=t.indexOf("NETWORK:");i>=0&&(t=t.substr(0,i)),(i=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,i)),(i=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,i));var a=t.split(/[\n\r]/).filter((function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e}));return a.shift(),{hash:r,urls:a}}().then((function(e){const r=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var o;if(t.localStorage&&(o=t.localStorage.getItem(r)),o!==e.hash){const a=!o,s=t.cacheUrlList(e.urls),l=function(o){o.requestId===s&&(t.localStorage&&t.localStorage.setItem(r,e.hash),a||n.A.confirm(t.getLocaleString("newAppVersionAvailable"),(function(){location.reload()})),t.off(i.A.event.MAPCACHEDOWNLOAD,l))};t.on(i.A.event.MAPCACHEDOWNLOAD,l)}}))}),(function(e){t.renderPromise().then((function(){const r=t.div.querySelector(`.${t.CLASS}-new`),n=document.createElement("div");n.classList.add("tc-alert","tc-alert-warning");const o=document.createElement("p"),a=document.createElement("strong");a.innerHTML=t.getLocaleString("offlineMap.error"),o.appendChild(a);const s=document.createElement("p");s.innerHTML=e.message,n.appendChild(o),n.appendChild(s),r.querySelector(t.#fe.NEWBTN).classList.add(i.A.classes.HIDDEN),r.appendChild(n)}))})).catch((()=>console.log("No SW available: no events handled"))),t.mapIsOffline&&(e.div.classList.add(i.A.classes.OFFLINE),t.getRenderedHtml(t.CLASS+"-off-panel",{url:t.getOnlineMapUrl()},(function(r){if(t.#ge=o.A.getDiv(t.options.offlineMapHintDiv),t.options.offlineMapHintDiv||e.div.appendChild(t.#ge),t.#ge.innerHTML=r,!navigator.onLine){const e=t.#ge.querySelector(t.#fe.OFFPANEL);e.classList.add(i.A.classes.CONNECTION_OFFLINE),e.classList.remove(i.A.classes.CONNECTION_MOBILE,i.A.classes.CONNECTION_WIFI)}t.#ge.querySelector(t.#fe.EXIT).addEventListener(i.A.event.CLICK,(function(e){n.A.confirm(t.getLocaleString("offlineMapExit.confirm"),null,(function(){e.preventDefault()}))})),t.offlineController=new h.A(t.offlineModel,new u.A(t.#ge))})));const a=t.getUID(),s=t.getUID();t.layerPromise=e.addLayer({id:s,type:i.A.layerType.VECTOR,stealth:!0,owner:t,styles:{line:e.options.styles.line}}),t.layer=null;const l=await Promise.all([t.layerPromise,t.renderPromise()]),d=t.layer=l[0];t.boxDraw=await e.addControl("draw",{id:a,div:t.div.querySelector(t.#fe.DRAW),mode:i.A.geom.RECTANGLE,singleSketch:!0}),t.boxDraw.setLayer(d),t.boxDraw.on(i.A.event.DRAWSTART,(function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:i.A.msgType.INFO})})).on(i.A.event.DRAWEND,(function(r){var n=r.feature.geometry[0],a=n[0],s=n[2],l=Math.min(a[0],s[0]),c=Math.max(a[0],s[0]),u=Math.min(a[1],s[1]),h=Math.max(a[1],s[1]);t.setExtent([l,u,c,h]);const d=t._dialogDiv.querySelectorAll("input[type=checkbox]");d.forEach((function(r){const n=t.map.getLayer(r.value);for(var o=r;o&&"LI"!==o.tagName;)o=o.parentElement;if(n.wrap.getCompatibleMatrixSets(e.crs).includes(n.matrixSet)){const e=t.wrap.getRequestSchemas({extent:t.extent,layers:[n]})[0].tileMatrixLimits;o.classList.toggle(i.A.classes.HIDDEN,!e.length)}else o.classList.add(i.A.classes.HIDDEN)}));const p=t._dialogDiv.querySelector(t.#fe.BLLISTITEM+":not(."+i.A.classes.HIDDEN+")");t._dialogDiv.querySelector(t.#fe.BLLISTTEXT).innerHTML=t.getLocaleString(p?"selectAtLeastOne":"cb.noMapsAtSelectedExtent"),t.#ye(),t.#ve(),o.A.showModal(t._dialogDiv.querySelector(`.${t.CLASS}-dialog`),{openCallback:function(){var e;if(setTimeout((function(){d.forEach((function(e){e.disabled=!1}))}),100),Date.prototype.toLocaleString){var r={};r.year=r.month=r.day=r.hour=r.minute=r.second="numeric",e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),r)}else e=(new Date).toString();t._dialogDiv.querySelector(t.#fe.NAMETB).value=e,t.#Ae()},closeCallback:function(){d.forEach((function(e){e.disabled=!0})),t.boxDraw.layer.clearFeatures()}})})),e.on(i.A.event.CONTROLDEACTIVATE,(function(e){t.boxDraw===e.control&&t.#me===m.state.EDITING&&t.setReadyState()}));var p=function(e){var r=!1;const n=t._dialogDiv.querySelector(t.#fe.BLLIST),a=function(){return!!n.querySelector('li[data-layer-uid="'+e.id+'"]')};var s=e.type===i.A.layerType.WMTS&&!e.mustReproject;return o.A.detectSafari()&&o.A.detectIOS()&&(s=s&&o.A.isSameOrigin(e.url)),s&&!a()&&(r=!0,t.getRenderedHtml(t.CLASS+"-bl-node",e,(function(e){if(!a()){const t=new DOMParser;n.appendChild(t.parseFromString(e,"text/html").body.firstChild)}}))),r};const g=function(e){if(e.isBase&&t.mapIsOffline){const r=e.getResolutions();if(r){const n=r.filter((e=>e>=t.currentMapDefinition.res));n.length&&e.setResolutions(n)}}t.renderPromise().then((function(){p(e)}))};return e.on(i.A.event.LAYERADD,(function(e){g(e.layer)})).on(i.A.event.LAYERREMOVE,(function(e){t.renderPromise().then((function(){const r=e.layer;if(r.type===i.A.layerType.WMTS){const e=t._dialogDiv.querySelector(t.#fe.BLLIST).querySelector('li[data-layer-uid="'+r.id+'"]');e.parentElement.removeChild(e)}}))})).on(i.A.event.PROJECTIONCHANGE,(function(t){e.baseLayers.forEach((e=>g(e)))})),e.ready((function(){if(t.mapIsOffline){var r=[];t.offlineControls.forEach((function(t){t=t.substr(0,1).toUpperCase()+t.substr(1),r=r.concat(e.getControlsByClass("TC.control."+t))}));const n=t.getLocaleString("thisControlCannotBeUsedInOfflineMode");e.controls.forEach((function(e){r.indexOf(e)<0&&e.disable({reason:n})})),document.querySelectorAll(t.#fe.OFFLINEHIDDEN).forEach((function(e){e.classList.add(i.A.classes.HIDDEN)}))}})),e.loaded((function(){if(t.layerPromise.then((function(t){e.putLayerOnTop(t)})),t.renderPromise().then((function(){t.div.querySelector(t.#fe.NEWBTN).disabled=!1,e.baseLayers.forEach(p)})),t.mapIsOffline){const r=t.currentMapDefinition,n=function(e,t){return(0===e.url.indexOf("//")?location.protocol+e.url:e.url)===r.url[t.urlIdx]&&e.layerNames===t.id&&e.matrixSet===r.tms[t.tmsIdx]},a=e.availableBaseLayers.filter((e=>e.type===i.A.layerType.WMTS)).filter((e=>r.layers.some((t=>n(e,t))))).filter((t=>!e.baseLayers.some((e=>e.id===t.id))));Promise.all(a.map((t=>e.addLayer(o.A.extend({},t,{isBase:!0}))))).finally((function(){const o=[];for(var a=0,s=r.layers.length;a<s;a++)for(var l=0,c=e.baseLayers.length;l<c;l++){const t=e.baseLayers[l];if(t&&t.type===i.A.layerType.WMTS&&n(t,r.layers[a])){o.push(t);break}}o.length&&e.setBaseLayer(o[0],(function(){for(var r=e.baseLayers.length-1;r>=0;r--){const t=e.baseLayers[r];t&&t.type!==i.A.layerType.VECTOR&&!o.includes(t)&&e.removeLayer(t)}e.setExtent(t.currentMapExtent,{animate:!1,contain:!0})}))}))}})),t.on(i.A.event.MAPCACHEDOWNLOAD,(function(r){t.isDownloading=!1;const o=function(e){const t=e.indexOf("#");return t>=0?e.substr(0,t):e}(r.url),a=t.#Se(o);a&&!t.serviceWorkerEnabled?(a.classList.remove(i.A.classes.DISABLED),n.A.alert(t.getLocaleString("cb.delete.error"))):t.currentMap&&o===t.currentMap.url&&(t.#Ee(),e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))),t.currentMap=null,t.setReadyState()})).on(i.A.event.MAPCACHEDELETE,(function(r){t.isDownloading=!1;var n=t.#we(r.url)||t.currentMap&&t.currentMap.name;t.currentMap=null,n&&e.toast(t.getLocaleString("mapDeleted",{mapName:n})),t.setReadyState()})).on(i.A.event.MAPCACHEPROGRESS,(function(e){var r=e.total;!r&&t.requestSchemas&&(r=t.requestSchemas[0].tileCount);var n=e.loaded;n?t.#pe=n:(t.#pe+=1,n=t.#pe),t.showDownloadProgress(n,r)})).on(i.A.event.MAPCACHEERROR,(function(e){t.isDownloading=!1,t.setReadyState();var r=t.getLocaleString("cb.mapCreation.error"),i=!0;switch(e.reason){case"quota":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&t.#we(e.url),i=!1;break;case"already_exists":r+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}i&&(o.A.detectIE()?(n.A.error(r),n.A.alert(t.getLocaleString("cb.mapCreation.error.reasonEdge"))):n.A.alert(r)),t.currentMap=null})),await r,t}async loadTemplates(){const e=this,t=r.e(8264).then(r.bind(r,8264)),n=r.e(6078).then(r.bind(r,6078)),i=r.e(6420).then(r.bind(r,6420)),o=r.e(5373).then(r.bind(r,5373)),a=r.e(1665).then(r.bind(r,1665)),s={};s[e.CLASS]=(await t).default,s[e.CLASS+"-map-node"]=(await n).default,s[e.CLASS+"-bl-node"]=(await i).default,s[e.CLASS+"-dialog"]=(await o).default,s[e.CLASS+"-off-panel"]=(await a).default,e.template=s}async render(e){const t=this;t._dialogDiv.innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null),t._dialogDiv.querySelector(t.#fe.NAMETB).addEventListener(i.A.event.CLICK,(function(e){e.preventDefault(),this.selectionStart=0,this.selectionEnd=this.value.length,this.focus()}));const r={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+n.A.getUID()};await t.renderData(r,(function(){const r=t.#Se(location.href);r&&r.classList.add(i.A.classes.ACTIVE),t.addUIEventListeners(),o.A.isFunction(e)&&e(),t.controller=new h.A(t.model,new u.A(t.div)),t.controller.add(t._dialogDiv),t.updateModel()})),window.addEventListener("beforeunload",(function(e){if(t.isDownloading){var r=t.getLocaleString("cb.mapDownloading.warning");return e.returnValue=r,r}}),!0)}addUIEventListeners(){const e=this;e._dialogDiv.querySelector(e.#fe.OKBTN).addEventListener(i.A.event.CLICK,(function(){e.generateCache()}),{passive:!0}),e._dialogDiv.querySelector(e.#fe.NAMETB).addEventListener("input",(function(){e.#Ae()})),e.div.querySelector(e.#fe.NEWBTN).addEventListener(i.A.event.CLICK,(function(){e.setEditState()}),{passive:!0}),e.div.querySelector(`.${e.CLASS}-btn-cancel-draw`).addEventListener(i.A.event.CLICK,(function(){e.setReadyState()}),{passive:!0}),e.div.querySelector(`.${e.CLASS}-btn-cancel-dl`).addEventListener(i.A.event.CLICK,(function(){e.cancelCacheRequest()}),{passive:!0});const t=e.div.querySelector(e.#fe.LIST);t.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(e.#fe.DELETEBTN,(function(t){e.startDeleteMap(t.target.parentElement.querySelector("a").innerHTML)})),{passive:!0}),t.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(e.#fe.EDITBTN,(function(t){e.#_e(t.target.parentElement)})),{passive:!0}),t.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(e.#fe.CANCELBTN,(function(t){const r=t.target.parentElement;r.querySelector(e.#fe.TEXTBOX).value=r.querySelector("a").innerHTML,e.#Le(r)})),{passive:!0}),t.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(e.#fe.SAVEBTN,(function(t){const r=t.target.parentElement;e.#Le(r);const n=r.querySelector("a"),i=r.querySelector(e.#fe.TEXTBOX).value,o=e.findStoredMap({url:n.getAttribute("href")});o&&(o.name=i,n.innerHTML=i,n.setAttribute("title",i),e.#Ce(o))})),{passive:!0}),t.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(e.#fe.VIEWBTN,(function(t){const r=t.target;var n=!r.classList.contains(i.A.classes.ACTIVE);e.div.querySelectorAll(e.#fe.VIEWBTN).forEach((e=>e.classList.remove(i.A.classes.ACTIVE)));const o=r.parentElement.querySelector("a").innerHTML;if(o){var a=e.findStoredMap({name:o});if(a){var s=d(a.extent);e.layer.clearFeatures(),n&&(e.layer.addPolygon([[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]]],{showsPopup:!1,data:{map:a.name}}).then((function(){e.layer.map.zoomToFeatures(e.layer.features)})),r.classList.add(i.A.classes.ACTIVE),r.setAttribute("title",e.getLocaleString("removeMapExtent")))}}})),{passive:!0});const r=e.div.querySelector(e.#fe.SEARCH),o=function(){!function(t){t=t.toLowerCase();const r=e.div.querySelectorAll(e.#fe.LISTITEM);r.forEach((function(e){e.style.display="none"}));const n=[];if(r.forEach((function(e){e.matches("li:not([class]),li."+i.A.classes.ACTIVE)&&n.push(e)})),0===t.length)n.forEach((function(e){e.style.removeProperty("display")})),e.div.querySelector(`.${e.CLASS}-map-search-icon`).style.visibility="visible";else{e.div.querySelector(`.${e.CLASS}-map-search-icon`).style.visibility="hidden";var o=new RegExp(t,"i");n.forEach((function(e){e.style.display=o.test(e.querySelector("a").textContent)?"":"none"})),n.some((function(e){return!e.hidden}))||r.forEach((function(e){e.matches('[class^="tc-ctl-omm-map-not"]')&&e.style.removeProperty("display")}))}}(this.value.toLowerCase().trim())};r.addEventListener("keyup",o),r.addEventListener("search",o),e._dialogDiv.querySelector(e.#fe.BLLIST).addEventListener("change",n.A.EventTarget.listenerBySelector("input[type=checkbox]",(function(t){const r=t.target;if(r.checked)e.baseLayers.push(e.map.getLayer(r.value));else for(var n=0,i=e.baseLayers.length;n<i;n++)if(e.baseLayers[n].id===r.value){e.baseLayers.splice(n,1);break}e.updateRequestSchemas(),e.#be(),e.#ye(),e.#Ae(),e.#ve()})));const a=e._dialogDiv.querySelector(e.#fe.RNGMAXRES),s=function(t){e.#be({rangeValue:t.target.value}),e.#ye(),e.#ve()};a.addEventListener("input",s),a.addEventListener("change",s)}#Te(){const e=this;e.#me=m.state.DOWNLOADING,o.A.closeModal(),e.showDownloadProgress(0,1),e.div.querySelector(e.#fe.NEW).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.DRAWING).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.PROGRESS).classList.remove(i.A.classes.HIDDEN),e._dialogDiv.querySelector(e.#fe.OKBTN).disabled=!0,e.div.querySelector(e.#fe.NEWBTN).disabled=!0,e.layer.clearFeatures(),e.boxDraw.cancel()}#xe(){const e=this;e.#me=m.state.DELETING,e.showDownloadProgress(0,1),e.div.querySelector(e.#fe.DRAWING).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.PROGRESS).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.NEW).classList.remove(i.A.classes.HIDDEN),e.div.querySelectorAll(e.#fe.LISTITEM).forEach((function(e){e.classList.add(i.A.classes.DISABLED)})),e._dialogDiv.querySelector(e.#fe.OKBTN).disabled=!0,e.div.querySelector(e.#fe.NEWBTN).disabled=!1,e._dialogDiv.querySelector(e.#fe.TILECOUNT).innerHTML="",e.boxDraw.cancel()}#_e(e){const t=this;e.querySelector("span").classList.add(i.A.classes.HIDDEN);const r=e.querySelector(t.#fe.TEXTBOX);r.classList.remove(i.A.classes.HIDDEN),r.value=e.querySelector("span a").innerHTML,r.focus(),e.querySelector(t.#fe.SAVEBTN).classList.remove(i.A.classes.HIDDEN),e.querySelector(t.#fe.CANCELBTN).classList.remove(i.A.classes.HIDDEN),e.querySelector(t.#fe.EDITBTN).classList.add(i.A.classes.HIDDEN),e.querySelector(t.#fe.VIEWBTN).classList.add(i.A.classes.HIDDEN),e.querySelector(t.#fe.DELETEBTN).classList.add(i.A.classes.HIDDEN)}#Le(e){const t=this;e.querySelector("span").classList.remove(i.A.classes.HIDDEN),e.querySelector(t.#fe.TEXTBOX).classList.add(i.A.classes.HIDDEN),e.querySelector(t.#fe.SAVEBTN).classList.add(i.A.classes.HIDDEN),e.querySelector(t.#fe.CANCELBTN).classList.add(i.A.classes.HIDDEN),e.querySelector(t.#fe.EDITBTN).classList.remove(i.A.classes.HIDDEN),e.querySelector(t.#fe.VIEWBTN).classList.remove(i.A.classes.HIDDEN),e.querySelector(t.#fe.DELETEBTN).classList.remove(i.A.classes.HIDDEN)}#be(e={}){const t=this,r=t._dialogDiv.querySelector(`.${t.CLASS}-res`),n=t._dialogDiv.querySelector(t.#fe.RNGMAXRES);var o,s,l,c=t.getResolutions();if(c.length){if(n.setAttribute("max",c.length-1),t.minResolution){if(void 0===e.rangeValue)for(var u=0,h=c.length;u<h;u++)if(t.minResolution>=c[u]){n.value=u;break}}else if(void 0===e.rangeValue){const e=t.map.getResolution();n.value=c.filter((t=>t>e)).length}s=parseInt(n.value);var d=Math.floor(1e3*new Number(c[s]))/1e3;o=t.getLocaleString("metersPerPixel",{value:d.toLocaleString((t.map?t.map.options.locale:a.A.locale).replace("_","-"))}),l=100*(s+1)/(c.length+1)+"%",n.disabled=!1,t.minResolution=c[n.value]}else s=0,o="",n.value=0,l="0",t.minResolution=0,n.disabled=!0;t._dialogDiv.querySelector(t.#fe.RESOLUTIONPANEL).classList.toggle(i.A.classes.HIDDEN,!!n.disabled),t._dialogDiv.querySelector(t.#fe.TILECOUNT).classList.toggle(i.A.classes.HIDDEN,!!n.disabled),r.style.left=l,r.innerHTML=o}#ye(){const e=this;e._dialogDiv.querySelectorAll(`.${e.CLASS}-bl-node input[type=checkbox]`).forEach((function(t,r){if(t.checked){var n=e.requestSchemas.find((function(e){return e.layerId===t.value}));if(n){var i=function(e,t){for(var r=null,n=0,i=e.tileMatrixLimits.length;n<i&&!((r=e.tileMatrixLimits[n]).res<=t);n++);return r}(n,e.minResolution);if(i){const r="{TileMatrixSet}",u="{TileMatrix}",h="{TileRow}",d="{TileCol}";var o=n.url;if(o.indexOf(u)<0){var a=o.indexOf("?");a>=0&&(o=o.substr(0,a));for(var s=0,l=e.baseLayers.length;s<l;s++){var c=e.baseLayers[s];if(c.id===n.layerId){o=o+"?layer="+c.layerNames+"&style=default&tilematrixset="+r+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix="+u+"&TileRow="+h+"&TileCol="+d;break}}}for(;t&&"LABEL"!==t.tagName;)t=t.parentElement;t&&(t.style.backgroundSize="auto",t.style.backgroundPosition="left bottom",t.style.backgroundImage="url("+o.replace(r,n.tileMatrixSet).replace(u,i.mId).replace(h,i.rt).replace(d,i.cl)+")")}}}}))}#Pe(e){let t;return t=e<1?this.getLocaleString("lessThan1Mb"):this.getLocaleString("approxXMb",{quantity:p(e)}),t}#ve(){const e=this;let t="";e.tileCount=0;for(var r=0,n=e.requestSchemas.length;r<n;r++)for(var i=e.requestSchemas[r],o=0,a=i.tileMatrixLimits.length;o<a;o++){var s=i.tileMatrixLimits[o];if(s.res<e.minResolution)break;e.tileCount+=(s.cr-s.cl+1)*(s.rb-s.rt+1)}e.tileCount&&(e.estimatedMapSize=Math.round(e.tileCount*e.options.averageTileSize/1048576),t=e.getLocaleString("xTiles",{quantity:p(e.tileCount)})+" ("+e.#Pe(e.estimatedMapSize)+")"),e._dialogDiv.querySelector(e.#fe.TILECOUNT).innerHTML=t}#Me(e){const t=this.div.querySelectorAll(this.#fe.LISTITEM);for(var r=0,n=t.length;r<n;r++){const n=t[r],i=n.querySelector("a");if(i&&i.innerHTML===e)return n}return null}#Se(e){var t=e.indexOf("#");t>=0&&(e=e.substr(0,t));const r=this.div.querySelectorAll(this.#fe.LISTITEM);for(var n=0,i=r.length;n<i;n++){const t=r[n],i=t.querySelector("a");if(i&&i.getAttribute("href")===e)return t}return null}#Ce(e){const t=this;var r=!1;return t.localStorage&&(t.localStorage.setItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e.url),e.extent+" "+e.name),r=!0),r}#Ie(e){const t=this;var r=!1;return t.localStorage&&(t.localStorage.removeItem(t.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(e)),r=!0),r}#Ee(){const e=this,t=e.currentMap;e.#Ce(t)&&(e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},(function(t){const r=new DOMParser;e.div.querySelector(e.#fe.LIST).appendChild(r.parseFromString(t,"text/html").body.firstChild),e.controller.add(e.div.querySelector(e.#fe.LIST).lastChild),e.div.querySelector(e.#fe.EMPTYLIST).setAttribute("hidden","hidden"),e.div.querySelector(e.#fe.SEARCH).disabled=!1})),e.storedMaps.push(t))}#we(e){const t=this,r=t.findStoredMap({url:e});if(r){if(t.#Ie(e)){const e=t.#Me(r.name);e&&e.parentElement.removeChild(e)}var n=t.storedMaps.indexOf(r);return t.storedMaps.splice(n,1),t.storedMaps.length||(t.div.querySelector(t.#fe.SEARCH).disabled=!0,t.div.querySelector(t.#fe.EMPTYLIST).removeAttribute("hidden")),t.layer.features.filter((e=>e.data.map===r.name)).forEach((e=>t.layer.removeFeature(e))),r.name}return null}setExtent(e){Array.isArray(e)&&e.length>=4&&(this.extent=e,this.updateRequestSchemas())}#Ae(){const e=this;e._dialogDiv.querySelector(e.#fe.OKBTN).disabled=!e.extent||0===e._dialogDiv.querySelector(e.#fe.NAMETB).value.length||e._dialogDiv.querySelector(e.#fe.RNGMAXRES).disabled}setReadyState(){const e=this;e.#me=m.state.READY,e.showDownloadProgress(0,1),e.div.querySelector(e.#fe.DRAWING).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.PROGRESS).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.NEW).classList.remove(i.A.classes.HIDDEN),e.div.querySelectorAll(e.#fe.LISTITEM).forEach((function(e){e.classList.remove(i.A.classes.DISABLED)})),e._dialogDiv.querySelector(e.#fe.OKBTN).disabled=!0,e.div.querySelector(e.#fe.NEWBTN).disabled=!1,e._dialogDiv.querySelector(e.#fe.TILECOUNT).innerHTML="",e.extent=null,e.#pe=0,e.boxDraw&&e.boxDraw.cancel().deactivate()}setEditState(){const e=this;e.#me=m.state.EDITING,e.showDownloadProgress(0,1),e.div.querySelector(e.#fe.NEW).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.PROGRESS).classList.add(i.A.classes.HIDDEN),e.div.querySelector(e.#fe.DRAWING).classList.remove(i.A.classes.HIDDEN),e.map.toast(e.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:i.A.msgType.INFO}),e._dialogDiv.querySelector(e.#fe.OKBTN).disabled=!0,e.div.querySelector(e.#fe.NEWBTN).disabled=!0,e._dialogDiv.querySelector(e.#fe.NAMETB).value="",e.boxDraw.activate()}generateCache(){const e=this,t={mapName:e._dialogDiv.querySelector(e.#fe.NAMETB).value};if(e.findStoredMap({name:t.mapName}))n.A.alert(e.getLocaleString("cb.mapNameAlreadyExists.error",t));else{var r=function(){e.div.querySelector(`.${e.CLASS}-name`).innerHTML=t.mapName,e.map.toast(e.getLocaleString("downloadingMap",{mapName:t.mapName})),e.#Te(),e.requestCache(t)};navigator.storage&&navigator.storage.estimate?navigator.storage.estimate().then((function(i){const o=(i.quota-i.usage)/1048576;e.estimatedMapSize<o?r():n.A.confirm(e.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:t.mapName,mapSize:e.#Pe(e.estimatedMapSize),availableStorage:e.#Pe(Math.round(o))}),r)})):r()}}cacheUrlList(e,t={}){const r=this,n=Date.now().toString();return r.createCache(t.name||r.LOCAL_STORAGE_KEY_PREFIX+r.ROOT_CACHE_NAME,{requestId:n,urlList:e,silent:t.silent}),n}requestCache(e={}){const t=this;if(t.map){var r=e.extent||t.extent||t.map.getExtent();if(t.updateRequestSchemas({extent:r}),t.requestSchemas){var n=function(e,r,n){var i=e.res>=t.minResolution;return!i&&r>0&&(i=n[r-1].res>t.minResolution),i},a=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},s=t.requestSchemas.map((function(e){return{layerId:e.layerId,tileMatrixSet:e.tileMatrixSet,tileMatrixLimits:e.tileMatrixLimits.filter(n)}})),l=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];s.forEach((function(e){const t=e.tileMatrixLimits[e.tileMatrixLimits.length-1],r=t.res*t.tSize;l[0]=Math.min(l[0],t.origin[0]+r*t.cl),l[1]=Math.min(l[1],t.origin[1]-r*(t.rb+1)),l[2]=Math.max(l[2],t.origin[0]+r*(t.cr+1)),l[3]=Math.max(l[3],t.origin[1]-r*t.rt),e.tileMatrixLimits=e.tileMatrixLimits.map(a)}));var c=Math.pow(10,t.map.wrap.isGeo()?i.A.DEGREE_PRECISION:i.A.METER_PRECISION),u={bBox:l=l.map((function(e,t){return(t<3?Math.ceil:Math.floor)(e*c)/c})),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};t.baseLayers.forEach((function(e,t){var r=0===e.url.indexOf("//")?location.protocol+e.url:e.url,n=u.url.indexOf(r);n<0&&(n=u.url.push(r)-1);var i=u.tms.indexOf(e.matrixSet);i<0&&(i=u.tms.push(e.matrixSet)-1);var o=e.format.substr(e.format.indexOf("/")+1),a=u.format.indexOf(o);a<0&&(a=u.format.push(o)-1),u.layers[t]={urlIdx:n,id:e.layerNames,tmsIdx:i,formatIdx:a}}));var h=o.A.getQueryStringParams(),d=h[t.MAP_EXTENT_PARAM_NAME]=l.toString();h[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(u)),t.serviceWorkerEnabled&&(h[t.SERVICE_WORKER_FLAG]=1);const r=location.origin+location.pathname+"?"+o.A.getParamString(h);if(t.currentMap={name:e.mapName,extent:d,url:r},t.isDownloading=!0,t.serviceWorkerEnabled){const e=[];for(var p=0,g=s.length;p<g;p++){for(var f=s[p],m=null,y=0,v=t.baseLayers.length;y<v;y++){var A=t.baseLayers[y];if(A.id===f.layerId){m=t.wrap.getGetTilePattern(A),A.getFallbackLayer&&A.getFallbackLayer(),A.thumbnail&&e.push(A.thumbnail);break}}if(m)for(var S=0,E=f.tileMatrixLimits.length;S<E;S++){const t=f.tileMatrixLimits[S];for(var w=t.rt;w<=t.rb;w++)for(var _=t.cl;_<=t.cr;_++)e.push(m.replace("{TileMatrixSet}",f.tileMatrixSet).replace("{TileMatrix}",t.mId).replace("{TileCol}",_).replace("{TileRow}",w))}}e.push(r),t.cacheUrlList(e,{name:r})}}}}cancelCacheRequest(){const e=this;e.currentMap&&e.deleteCache(e.currentMap.url).then((function(t){t||(e.currentMap=null)})),e.isDownloading=!1,e.setReadyState()}deleteMap(e){const t=this.findStoredMap({name:e});t&&this.deleteCache(t.url)}startDeleteMap(e){const t=this;if(navigator.onLine){if(e){var r=t.getLocaleString("cb.delete.confirm",{mapName:e});t.serviceWorkerEnabled||(r=r+" "+t.getLocaleString("cb.delete.confirm.connect.warning")),confirm(r)&&(navigator.onLine?(t.#xe(),t.deleteMap(e)):n.A.alert(t.getLocaleString("cb.delete.conn.alert")))}}else n.A.alert(t.getLocaleString("cb.delete.conn.alert"))}findStoredMap(e){return this.storedMaps.find((function(t){var r=!0;return e.name&&e.name!==t.name&&(r=!1),r&&e.url&&e.url!==t.url&&(r=!1),r}))}showDownloadProgress(e,t){const r=this,n=r.div.querySelector(`.${r.CLASS}-progress-count`);if(t){var o=Math.min(Math.round(100*e/t),100)+"%";const i=r.div.querySelector(`.${r.CLASS}-progress-ratio`);i&&(i.style.width=o),n&&(n.innerHTML=o)}else{const t=r.div.querySelector(`.${r.CLASS}-progress-bar`);t&&t.classList.add(i.A.classes.HIDDEN),n&&(n.innerHTML=r.getLocaleString("xFiles",{quantity:e}))}}updateRequestSchemas(e={}){const t=this,r={...e};return r.extent=r.extent||t.extent,r.layers=r.layers||t.baseLayers,t.requestSchemas=t.wrap.getRequestSchemas(r),t.requestSchemas}getResolutions(){var e=[];const t=function(e){return e.res},r=this.requestSchemas.map((function(e){return e.tileMatrixLimits.map(t)}));return e.concat.apply(e,r).sort(((e,t)=>t-e)).filter(((e,t,r)=>0===t||r[t-1]!==e))}getOnlineMapUrl(){const e=this,t=o.A.getQueryStringParams();delete t[e.MAP_DEFINITION_PARAM_NAME],delete t[e.MAP_EXTENT_PARAM_NAME],delete t[e.SERVICE_WORKER_FLAG];var r=o.A.getParamString(t);return r.length&&(r="?"+r),location.pathname+r+location.hash}updateModel(){const e=this;e.model.offlineMaps=e.getLocaleString("offlineMaps"),e.model["cb.filter.plhr"]=e.getLocaleString("cb.filter.plhr"),e.model["cb.noMaps"]=e.getLocaleString("cb.noMaps"),e.model.noMatches=e.getLocaleString("noMatches"),e.model.newOfflineMap=e.getLocaleString("newOfflineMap"),e.model.cancel=e.getLocaleString("cancel"),e.model["cb.DownloadingMap"]=e.getLocaleString("cb.DownloadingMap"),e.model.save=e.getLocaleString("save"),e.model.editMapName=e.getLocaleString("editMapName"),e.model.viewMapExtent=e.getLocaleString("viewMapExtent"),e.model.deleteMap=e.getLocaleString("deleteMap"),e.model.nameRequired=e.getLocaleString("nameRequired"),e.model.close=e.getLocaleString("close"),e.model.availableOfflineMaps=e.getLocaleString("availableOfflineMaps"),e.model.selectAtLeastOne=e.getLocaleString("selectAtLeastOne"),e.model.maxRes=e.getLocaleString("maxRes"),e.model.ok=e.getLocaleString("ok"),e.model.cancel=e.getLocaleString("cancel"),e.offlineController&&(e.offlineModel.offlineMap=e.getLocaleString("offlineMap"),e.offlineModel.returnToOnlineMaps=e.getLocaleString("returnToOnlineMaps"))}async updateLanguage(){this.updateModel()}}m.prototype.CLASS="tc-ctl-omm",n.A.control.OfflineMapMaker=m;const y=m},3093:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>O});var n=r(3790),i=r.n(n),o=r(8038),a=r(797),s=r(1256),l=r(5874),c=r(3301),u=r(5264),h=r(575),d=r(4128),p=r(9566),g=r(8606),f=r(6257),m=r(7018),y=r(2948),v=r(3791),A=r(5777);o.A.control=o.A.control||{},a.A.event.TOOLSCLOSE=a.A.event.TOOLSCLOSE||"toolsclose.tc",a.A.event.TOOLSOPEN=a.A.event.TOOLSOPEN||"toolsopen.tc",a.A.event.DIALOG=a.A.event.DIALOG||"dialog.tc",a.A.classes.UNPLUGGED="tc-unplugged";const S=e=>e instanceof f.A,E=e=>(e=>e instanceof g.A)(e)||S(e);let w=null,_=!1;const L=function(){(!w||w[0]!==this.getCenter()[0]&&w[1]!==this.getCenter()[1])&&(w=this.getCenter(),_||this.getControlsByClass(R)[0].setFollowing(!1))},C="wakeLock"in navigator;let b=null,T=null;const x=function(e){var t=[];for(var r in e)e[r]&&"object"==typeof e[r]&&(t.push(e[r]),t.sort((function(e,t){return"string"==typeof e.name&&c.A.isFunction(e.name.localeCompare)?e.name.localeCompare(t.name):0})));return t};class P{constructor(){this.save="",this["tr.lst.cancel"]="",this["tr.lst.edit"]="",this["tr.lst.share"]="",this["tr.lst.download"]="",this["tr.lst.delete"]="",this["tr.lst.stop"]="",this["tr.lst.start"]="",this["tr.lst.backward"]="",this["tr.lst.velocity"]="",this["tr.lst.forward"]="",this["tr.lst.view"]=""}}class M{constructor(){this.geo="",this["geo.trk.panel.help.1"]="",this["geo.trk.panel.help.2"]="",this["geo.trk.panel.help.3"]="",this["geo.gps"]="",this["geo.track.title"]="",this["geo.tracks"]="",this["geo.tracks.title"]="",this["geo.noTracks"]="",this.noMatches="",this["geo.trk.delete.all.tooltip"]="",this["geo.trk.delete.all"]="",this["geo.trk.import.upload"]="",this["geo.trk.import.lbl"]="",this["geo.trk.panel.1"]="",this["geo.trk.panel.2"]="",this["geo.trk.panel.3"]="",this["geo.trk.panel.4"]="",this["geo.trk.panel.5"]="",this["geo.trk.render"]="",this["geo.track.activate.title"]="",this["geo.track.activate"]="",this["geo.track.deactivate.title"]="",this["geo.track.deactivate"]="",this["geo.trk.name.plhr"]="",this["geo.filter.plhr"]="",this["geo.trk.name.save"]="",this["geo.trk.wyp.plhr"]="",this["geo.trk.wyp.save"]="",this["geo.trk.center"]="",this["geo.gps"]="",this.close="",this["geo.trk.dialog.cnt"]="",this["geo.trk.dialog.new"]="",this["geo.trk.dialog.cancel"]="",this["geo.track.activate.title"]="",this["geo.trk.page.blur"]="",this["geo.trk.dialog.doNotShow"]="",this.ok="",this["geo.profile.fromTrack"]="",this["mdt.title"]="",this.mdt="",this.getFromDtm="",this["geo.track"]="",this.share=""}}class I{constructor(){this.lon="",this["geo.trk.accuracy"]="",this.lat="",this["geo.trk.speed"]="",this.ele="",this["mdt.title"]="",this.mdt=""}}class R extends s.A{const={className:{DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated",PLAY:"tc-play",PAUSE:"tc-pause"},selector:{ACTIVATOR:'sitna-button[variant="link"]',EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",DELETEALL:".tc-btn-delete-all",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",SHARE:".tc-btn-share",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed",VISIBILITY:"sitna-toggle.tc-chk-track-visibility"},localStorageKey:{GEOTRACKING:"trk",GEOTRACKINGTEMP:"trktemp",GEOTRACKING_SHOW_WARNING:"trkWarning",GPS_SHOW_WARNING:"gpsWarning",TEST:"test"},event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},supportedFileExtensions:[".gpx",".kml",".kmz"],layer:{GPS:"gps",TRACK:"track",GEOTRACKING:"geotracking"}};markerStyle={radius:10,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};delta=500;walkingSpeed=5e3;notificationConfig={};storageCrs="EPSG:4326";snappingTolerance;currentTrackUid;#k;#Re;#Oe;#De;#Ne=!0;#ke=!0;#Fe;#Ge;#Be;#Ue=new Map;#qe=[];#We;#He;#je;constructor(){super(...arguments);const e=this;e.#k=c.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e.#k),e.#Re=c.A.getDiv({}),document.body.appendChild(e.#Re),e.snappingTolerance=e.options.snappingTolerance||50,e.exportsState=!0,e.simulationStopped=!0,e._uiElementSelector="ol > li[data-id]",e._toolContainerSelector=`.${e.CLASS}-tools-active`,e.wrap=new o.A.wrap.control.Geolocation(e),e.model=new M,e.trackModel=new P,e.infoPanelModel=new I}async register(e){const t=this;await super.register(e),t.wrap.register(e),t.options.fileEditing&&await e.addControl("trackEdit",{caller:t,snapping:!0}),e._bufferFeatures=[],t.hillDeltaThreshold=t.options&&t.options.hillDeltaThreshold||t.map.options.elevation&&t.map.options.elevation.hillDeltaThreshold||20;const r=e.addLayer({id:t.getUID(),type:a.A.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.GPS"}),n=e.addLayer({id:t.getUID(),type:a.A.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Geotracking",styles:function(e){let r=e.getData().name;return r=r&&(r+"").trim().length>0?(r+"").trim().toLowerCase():"",{point:{radius:6,fillColor:"#00ced1",fillOpacity:t.track.renderTrack.checked?1:0,strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:r},line:[{strokeOpacity:t.track.renderTrack.checked?1:0,strokeWidth:8,strokeColor:"#ffffff"},{strokeOpacity:t.track.renderTrack.checked?1:0,strokeWidth:4,strokeColor:"#00ced1"}]}}}),i=e.addLayer({id:t.getUID(),type:a.A.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:6,fillColor:"#C52737",fillOpacity:.5,strokeColor:"#27C537",strokeWidth:2,fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,labelOffset:[0,-12],label:"${name}"}}}),o=e.addLayer({id:t.getUID(),type:a.A.layerType.VECTOR,owner:t,stealth:!0,title:"Posicionar.Extremos"});e.on(a.A.event.FEATURESIMPORT,function(e){const t=this,r=async function(e){const r=e.fileName,n=e.dropTarget;var i="."+a.A.format.KML.toLowerCase(),o="."+a.A.format.GPX.toLowerCase();if(r.toLowerCase().indexOf(o)===r.length-o.length||r.toLowerCase().indexOf(i)===r.length-i.length&&n===t){t.clear(t.const.layer.TRACK);const n=function(){setTimeout((function(){if(t.map._bufferFeatures=t.map._bufferFeatures.concat(e.features),t.map.dropFilesCounter--,0===t.map.dropFilesCounter){t.map._bufferFeatures=[],delete t.map.dropFilesCounter;var r=t.map.getLoadingIndicator();r&&r.removeWait(t.map._fileDropLoadingIndicator),t.off(t.const.event.IMPORTEDTRACK,n)}}),0)};t.on(t.const.event.IMPORTEDTRACK,n);for(let r=0;r<e.features.length;r++){const n=e.features[r];await t.importTrack({...e,features:[n],trackIndex:e.features.length>1?r:void 0,trackCount:e.features.length})}/.kml$/g.test(r.toLowerCase())&&t.trackLayer&&t.trackLayer.styles&&t.trackLayer.features.forEach((function(e){e.getStyle()||(e instanceof m.A&&t.trackLayer.styles.point?e.setStyle(t.trackLayer.styles.point):E(e)&&t.trackLayer.styles.line&&e.setStyle(t.trackLayer.styles.line))}))}};t.#je?t.#je.then(r(e)):r(e)}.bind(t)),e.on(a.A.event.PROJECTIONCHANGE,(function(e){t.elevationChartData&&(t.elevationChartData.coords=c.A.reproject(t.elevationChartData.coords,e.oldCrs,e.newCrs),t.elevationChartData.secondaryElevationProfileChartData&&t.elevationChartData.secondaryElevationProfileChartData.length&&t.elevationChartData.secondaryElevationProfileChartData.forEach((t=>{t.coords=c.A.reproject(t.coords,e.oldCrs,e.newCrs)})))})),e.on(a.A.event.DIALOG,(function(e){if(e.control)switch(e.action){case"share":e.control.caller!==t&&t.#Ve(e.control.caller);break;case"download":t.#ze(e.control.caller)}})),e.on(a.A.event.FILESAVE,(function(e){const r=Object.prototype.hasOwnProperty.call(e,"oldFileHandle");t.trackLayer._fileHandle&&t.trackLayer._fileHandle.isSameEntry(e.fileHandle).then((n=>{if(n){const n=t.getSelectedTrackItem(),i={uid:n.dataset.uid};r&&(i.fileHandle=e.fileHandle),t.saveTrack(i).then((function(){r&&(t.availableTracks=null,n.querySelector("input").value===e.oldFileHandle?.name&&t.editTrackName(i.uid,i.fileHandle.name))}))}}))})),e.on(a.A.event.FEATUREREMOVE,(function(e){e.layer===t.trackLayer&&E(e.feature)&&t.updateEndMarkers()})),e.on(a.A.event.POPUP+" "+a.A.event.DRAWTABLE,(function(e){const r=e.control;if(r.currentFeature instanceof m.A&&r.currentFeature.layer===t.trackLayer){const e=r.getInfoContainer(),t=document.createElement("sitna-measurement");t.mode=a.A.geom.POINT,t.geographic=!0,e.insertAdjacentElement("afterbegin",t),t.displayMeasurement(r.currentFeature)}})),t.notificationConfig=Object.assign(t.options.notification||{},{tag:"Geolocation Track",vibrate:[200],renotify:!0,requireInteraction:!0,body:t.getLocaleString("geo.trk.notification.body")},{title:t.options.notification&&t.options.notification.title?t.getLocaleString(t.options.notification.title):document.title}),t.gpsLayer=await r,t.geotrackingLayer=await n,t.trackLayer=await i,t.endPointLayer=await o;const s=t.map.layers.indexOf(t.trackLayer);return t.map.insertLayer(t.gpsLayer,s),t}async loadTemplates(){const e=r.e(2519).then(r.bind(r,2519)),t=r.e(2998).then(r.bind(r,2998)),n=r.e(2419).then(r.bind(r,2419)),i=r.e(1768).then(r.bind(r,1768)),o=r.e(9173).then(r.bind(r,9173)),a=r.e(6720).then(r.bind(r,6720)),s=r.e(3690).then(r.bind(r,3690)),l={};l[this.CLASS]=(await e).default,l[this.CLASS+"-track-node"]=(await t).default,l[this.CLASS+"-track-snapping-node"]=(await n).default,l[this.CLASS+"-dialog"]=(await i).default,l[this.CLASS+"-tracking-toast"]=(await o).default,l[this.CLASS+"-ext-dldlog"]=(await a).default,l[this.CLASS+"-share-dialog"]=(await s).default,this.template=l}async render(e){this.#k.innerHTML=await this.getRenderedHtml(this.CLASS+"-dialog",null),await this.getDownloadDialog();const t=document.createElement("template");t.innerHTML=await this.getRenderedHtml(this.CLASS+"-ext-dldlog",{controlId:this.id}),this._downloadDialogExtNode=t.content?t.content.firstChild:t.firstChild,this.#Re.innerHTML=await this.getRenderedHtml(this.CLASS+"-share-dialog",{}),await this.renderData({controlId:this.id}),this.addUIEventListeners(),c.A.isFunction(e)&&e(),this.controller=new A.A(this.model,new v.A(this.div)),this.controller.add(this.#k),this.controller.add(this._downloadDialogExtNode),this.controller.add(this.#Re),this.updateModel()}addUIEventListeners(){const e=this;e.div.querySelector(e.const.selector.DELETEALL).addEventListener("click",(function(t){e.removeAllTracks(t.target),t.stopPropagation()})),e.div.querySelector("."+e.CLASS+"-track-panel-help").addEventListener("click",(function(){e.#Ye()})),globalThis.File&&globalThis.FileReader&&globalThis.FileList&&globalThis.Blob&&(e.track.trackImportFile.addEventListener(a.A.event.CLICK,(async function(t){if(c.A.isFunction(window.showOpenFilePicker)){let r;t.preventDefault();try{r=await window.showOpenFilePicker({types:e.const.supportedFileExtensions.map((e=>{const t={accept:{}};return t.accept[a.A.mimeType[e.substr(1).toUpperCase()]]=[e],t}))})}catch(t){if(t instanceof DOMException&&window.parent!==window){let t=e.getLocaleString("cannotOpenFileIfEmbedded");e.map.toast(t,{type:a.A.msgType.WARNING})}else if("AbortError"!==t.name)throw t}r&&e.loadFile(r[0],{control:e})}const r=this,n=document.createElement("form"),i=r.parentElement;i.insertBefore(n,r),n.appendChild(r),n.insertAdjacentElement("afterend",r),i.removeChild(n)})),e.track.trackImportFile.addEventListener("change",(function(t){e.loadFile(t.target.files[0])}))),e.track.activateButton.addEventListener("click",(function(){e.activateGeotracking()})),e.track.deactivateButton.addEventListener("click",(function(){e.deactivateGeotracking()}));const t=function(){!function(t){t=t.toLowerCase();const r=Array.from(e.track.trackList.querySelectorAll("li"));r.forEach((function(e){e.style.display="none"}));const n=r.filter((function(e){return e.matches("li:not([class]),li."+a.A.classes.CHECKED)})),i=e.div.querySelector(`.${e.CLASS}-track-search-icon`);if(0===t.length)n.forEach((function(e){e.style.display=""})),i.style.visibility="visible";else{i.style.visibility="hidden";var o=new RegExp(t,"i");n.forEach((function(t){t.style.display=o.test(t.querySelector(e.const.selector.ACTIVATOR).text)?"":"none"})),n.some((function(e){return""===e.style.display}))||r.forEach((function(e){e.matches('[class^="tc-ctl-geolocation-track-not"]')&&(e.style.display="")}))}}(this.value.toLowerCase().trim())};e.track.trackSearch.addEventListener("keyup",t),e.track.trackSearch.addEventListener("search",t),e.track.trackSave.addEventListener("click",e.saveTrack.bind(e)),e.track.trackAdd.addEventListener("click",e.addWaypoint.bind(e));const r=e.div.querySelector(`.${e.CLASS}-track-available-lst`),n=e.const.selector;r.addEventListener("click",o.A.EventTarget.listenerBySelector(n.ACTIVATOR,(function(t){e.map?.wait(e.#$e(t.target))})));const s=function(e){let t=e;for(;"LI"!==t.tagName;)t=t.parentElement;return t};r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.EDIT}`,(function(t){e.#Ke(!0,t.target)}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.DELETE}`,(function(t){e.removeTrack(s(t.target)).then((function(t){t&&!e.availableTracks.length&&(e.div.querySelector(e.const.selector.DELETEALL).disabled=!0)}))}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.SAVE}`,(function(t){const r=s(t.target);0===r.querySelector("input").value.trim().length?o.A.alert(e.getLocaleString("geo.trk.edit.alert")):(e.editTrackName(r.dataset.uid,r.querySelector("input").value),e.#Ke(!1,t.target))}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.CANCEL}`,(function(t){e.#Ke(!1,t.target)}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.SHARE}`,(function(t){e.#Xe(s(t.target)).then((function(){e.showShareDialog(e.#Re)}))}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.EXPORT}`,(function(t){const r=s(t.target);t.target.setAttribute("disabled",""),e.export(r).then((n=>{e.getDownloadDialog().then((function(i){const o=e.getDownloadDialogOptions(e.#Ze(r));i.open(n.map((e=>(e.uid=r.dataset.uid,e))),o),t.target.removeAttribute("disabled")}))}))}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.STOP}`,(function(t){e.wrap.simulateTrackEnd();const r=t.target.parentElement.querySelector(n.PAUSE);r.classList.add(e.const.className.PLAY),r.textContent=e.getLocaleString("tr.lst.start"),e.simulationStopped||(t.target.parentElement.querySelector(n.SPEED).textContent="x 1"),e.simulationSpeed=1,e.simulationStopped=!0}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.PAUSE}`,(function(t){e.simulate_paused=!t.target.classList.contains(e.const.className.PLAY),e.simulate_paused?e.simulate_pausedElapse=-1:e.simulationStopped&&(t.target.parentElement.querySelector(n.SPEED).textContent="x 1",e.map?.wait(e.#Je(t.target).then((()=>{e.simulationStopped=!1})))),t.target.textContent=e.getLocaleString(e.simulate_paused?"tr.lst.play":"tr.lst.pause"),t.target.classList.toggle(e.const.className.PLAY,!!e.simulate_paused)}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.BACKWARD}`,(function(t){1===e.simulationSpeed?e.simulationSpeed=.5:e.simulationSpeed=e.simulationSpeed/2,t.target.parentElement.querySelector(`.${e.CLASS} ${n.FORWARD}`).disabled=!1,t.target.parentElement.querySelector(n.SPEED).textContent=e.simulationSpeed<1?"/ "+1/e.simulationSpeed:"x "+e.simulationSpeed,.000244140625===e.simulationSpeed&&(t.target.disabled=!0)}))),r.addEventListener("click",o.A.EventTarget.listenerBySelector(`.${e.CLASS} ${n.FORWARD}`,(function(t){e.simulationSpeed=e.simulationSpeed/.5,t.target.parentElement.querySelector(n.SPEED).textContent=e.simulationSpeed<1?"/ "+1/e.simulationSpeed:"x "+e.simulationSpeed,t.target.parentElement.querySelector(`.${e.CLASS} ${n.BACKWARD}`).disabled=!1,4096===e.simulationSpeed&&(t.target.disabled=!0)}))),e.track.trackContinue.addEventListener("click",(function(){c.A.closeModal(),e.setGeotracking()})),e.track.trackRenew.addEventListener("click",(function(){delete e.geotrackingSession,c.A.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,void 0),i().removeItem(e.const.localStorageKey.GEOTRACKINGTEMP).catch((e=>console.warn(e))),c.A.closeModal(),e.setGeotracking()})),e.track.trackClose.addEventListener("click",(function(){e.#Qe()})),e.track.trackWarningOk.addEventListener("click",(function(){const e=document.body.querySelectorAll('sitna-toggle[name*="Warning"][checked]');e.length>0&&i().setItem(e[0].getAttribute("name"),!1).catch((e=>console.warn(e))),c.A.closeModal()})),e.track.renderTrack=e.div.querySelector(".tc-ctl-geolocation-track-render"),e.track.renderTrack.addEventListener("change",(function(){e.track.activateButton.classList.contains(a.A.classes.HIDDEN)&&e.geotrackingLayer.setVisibility(this.checked),e.#Ne=this.checked}))}#Ze=function(e){var t=e.querySelector(this.const.selector.ACTIVATOR).text,r=new RegExp(this.const.supportedFileExtensions.join("|"),"gi");return t.replace(r,"")+"_"+c.A.getFormattedDate(new Date,!0)};async#et(e){const t=this;let r=t.#tt(e);if(r)return console.log("Tengo datos en cache"),r.data;{console.log("NO tengo datos en cache");const r=await t.getElevationTool();if(r){let n=e.clone();try{let i=await r.setGeometry({features:[n],crs:t.map.crs});return t.#rt(e,i[0]),i[0]}catch(e){return null}}}}async getElevationControl(){const e=this;if(!e.elevationControl){let t={};!e.options.displayElevation&&e.options.displayOn?t.displayOn=e.options.displayOn:e.options.displayElevation&&(t=e.options.displayElevation),Object.prototype.hasOwnProperty.call(e.options,"resolution")?t.resolution=e.options.resolution:t.resolution=0,e.elevationControl=await e.map.addControl("elevation",t),e.elevationControl._decorateChartPanel=function(){this.resultsPanel.setCurrentFeature=function(t){const r=this;r.currentFeature=e.trackLayer.features.find((e=>!(e instanceof y.A||e instanceof m.A)));const n=e.getSelectedTrackItem();n&&r.currentFeature&&(r.currentFeature.uid=n.dataset.uid,r.currentFeature.fileName=e.#Ze(n))}}}return e.elevationControl}async importTrack(e){const t=this;t.isDisabled?/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:a.A.msgType.WARNING}):e.fileName&&e.features&&e.features.length>0&&await(t.map?.wait((async()=>{const r=e.uid||t.currentTrackUid;let n=e.fileName;const i=[];t.clear(this.const.layer.TRACK);for(var s=0,l=e.features.length;s<l;s++)i.push(t.trackLayer.addFeature(e.features[s]));t.trackLayer.setFeatureTypeMetadata(e.metadata),await Promise.all(i);const c=await t.wrap.processImportedFeatures({fileName:e.fileName,features:e.features,notReproject:e.notReproject,fileHandle:e.fileHandle});if(c.length){var u=function(e,t){for(var r=[],n=e.indexOf(t);-1!==n;)if(r.push(n),n=e.indexOf(t,n+1),r.length>1)return!0;return r.length>1};let i;const o=(e,t)=>"["+(parseInt(t)+1)+"] "+e;for(let r=0;r<c.length;r++){let a=c[r];u(c,a)?(a=o(a,r),n=a):void 0!==e.trackIndex&&(a=o(a,e.trackIndex),n=a);const s=await t.saveTrack({message:t.getLocaleString("geo.trk.upload.ok",{trackName:a||n}),importedFileName:n,notReproject:e.notReproject,fileHandle:e.fileHandle,trackIndex:e.trackIndex,trackCount:e.trackCount});0===r&&(i=s)}t.trackLayer.setVisibility(!1),t.trackLayer.clearFeatures(),(void 0===e.trackCount||e.trackIndex===e.trackCount-1)&&t.trigger(t.const.event.IMPORTEDTRACK,{selectedTrackUid:r,uid:i})}else t.trackLayer&&(t.map.removeLayer(t.trackLayer),t.trackLayer=void 0),o.A.alert(t.getLocaleString("geo.trk.upload.error4"));t.trackLayer&&(t.highlight(),e.fileHandle&&(t.trackLayer._fileHandle=e.fileHandle,t.trackLayer.file=e.fileHandle.name),t.div.querySelector(`sitna-tab[for="${t.id}-tracks-panel"]`).selected=!0,e.isShared||t.map.trigger(a.A.event.TOOLSOPEN),t.map.addControlState(t))})))}async#nt(e){const t=this;let r=e.uid;if(r){const e=(await t.getAvailableTracks()).find((function(e){return e.uid.toString()===r.toString()})).data;return(new ol.format.GeoJSON).readFeatures(e).map((e=>o.A.wrap.Feature.createFeature(e))).map((function(e){const t={};switch(!0){case e instanceof y.A:t.type=a.A.geom.MARKER;break;case e instanceof m.A:t.type=a.A.geom.POINT;break;case e instanceof g.A:t.type=a.A.geom.POLYLINE;break;case e instanceof f.A:t.type=a.A.geom.MULTIPOLYLINE}return t.id=e.id,t.geom=e.geometry,t.data=e.getData(),t}))}throw Error("No track uid")}#Ve(e){const t=this;return e instanceof Element||e instanceof HTMLDocument?e.classList.contains(t.CLASS+"-share-dialog")?u.default.onShowShareDialog.call(t):Promise.resolve():e===t?u.default.onShowShareDialog.call(t):void(e!==t&&e.toShare&&e.toShare.feature&&e.toShare.feature.layer===t.trackLayer&&c.A.closeModal((function(){u.default.onCloseShareDialog.call(e);const r=t.getSelectedTrackItem();return r?t.#Xe(r).then((function(){const e=t.#Re.querySelector("."+t.CLASS+"-share-dialog");c.A.showModal(e,{openCallback:function(){return u.default.onShowShareDialog.call(t)},closeCallback:function(){u.default.onCloseShareDialog.call(t)}})})):Promise.resolve()})))}async#ze(e){const t=await this.getDownloadDialog(),r=t.getFeatures();if(e!==this&&r.every((e=>e&&e.layer===this.trackLayer))){let e=t.getOptions(),n=this.getDownloadDialogOptions();e.elevation=n.elevation,delete e.openCallback,t.open(r,e)}r.length>0&&r.every((e=>e&&e.layer===this.trackLayer&&e.fileName))&&t.setOptions({fileName:r[0].fileName}),this.options.displayElevation}getDownloadDialogOptions(e){const t=this,r={title:t.getLocaleString("download"),fileName:e,openCallback:function(){t.#ze(t)}};return t.options.displayElevation?r.elevation={resolution:t.options.displayElevation&&t.options.displayElevation.resolution||t.map.options.elevation&&t.map.options.elevation.resolution||20,sampleNumber:t.options.displayElevation&&t.options.displayElevation.sampleNumber||t.map.options.elevation&&t.map.options.elevation.sampleNumber||0,checked:!0}:r.elevation={checked:!0},r}#Ye=function(){this.map.toast(this.div.querySelector(".tc-alert-warning").innerHTML,{duration:1e4})};#it(){this.track.activateButton.classList.add(a.A.classes.HIDDEN),this.track.deactivateButton.classList.remove(a.A.classes.HIDDEN)}#Qe(){this.track.activateButton.classList.remove(a.A.classes.HIDDEN),this.track.deactivateButton.classList.add(a.A.classes.HIDDEN)}async renderData(e,t){const r=this,n=r.const.selector;await super.renderData(e),r.track={activateButton:r.div.querySelector(`.${r.CLASS}-track-ui-activate`),deactivateButton:r.div.querySelector(`.${r.CLASS}-track-ui-deactivate`),trackSearch:r.div.querySelector(`.${r.CLASS}-track-available-srch`),trackImportFile:r.div.querySelector(`.${r.CLASS}-track-import`),trackSave:r.div.querySelector(`.${r.CLASS}-track-save`),trackAdd:r.div.querySelector(`.${r.CLASS}-track-add-wpt`),trackContinue:r.#k.querySelector(`.${r.CLASS}-track-continue`),trackRenew:r.#k.querySelector(`.${r.CLASS}-track-new`),trackClose:r.#k.querySelector(`.${r.CLASS}-continue-track-dialog sitna-button.tc-modal-close`),trackWarningOk:r.#k.querySelector(`.${r.CLASS}-track-warning-ok`)},r.track.trackList=r.div.querySelector(`.${r.CLASS}-track-available-lst`),r.track.trackToolPanelOpened=r.div.querySelector(`.${r.CLASS}-track-panel-block sitna-toggle`),r.track.trackName=r.div.querySelector(`.${r.CLASS}-track-title`),r.track.trackWPT=r.div.querySelector(`.${r.CLASS}-track-waypoint`),c.A.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(r.track.trackToolPanelOpened.checked=!1),globalThis.File&&globalThis.FileReader&&globalThis.FileList&&globalThis.Blob?r.track.trackImportFile.disabled=!1:console.log("no es posible la importación"),r.uiSimulate=function(e,t){if(t){const e=("LI"===t.tagName?t:t.parentNode).querySelector(n.PAUSE);e.classList.add(r.const.className.PLAY),e.setAttribute("title",r.getLocaleString("tr.lst.start")),r.simulationStopped=!0}},r.on(r.const.event.IMPORTEDTRACK,(async function(e){if(r.isDisabled)r.map.toast(r.getLocaleString("geo.trk.import.disabled"),{type:a.A.msgType.WARNING});else{let t=e.uid;if(r.currentTrackUid){const n=await r.getAvailableTracks(),i=n.find((e=>e.uid==r.currentTrackUid)),o=n.find((t=>t.uid==e.uid));await(i?.fileHandle?.isSameEntry(o?.fileHandle))&&(t=r.currentTrackUid)}const n=r.track.trackList.querySelector('li[data-uid="'+t+'"]');r.#$e(n.querySelector(r.const.selector.ACTIVATOR)).then((function(){r.loadingState&&(delete r.loadingState,r.toShare=null)}));const i=function(e){n.scrollIntoView({behavior:"smooth",block:"end"}),n.removeEventListener("transitionend",i,!1)};n.addEventListener("transitionend",i,!1)}})),r.#ot(),c.A.isFunction(t)&&t()}#Je(e){return c.A.getTimedPromise((()=>{const t=e.closest("li"),r=this.getSelectedTrackItem();this.#at(t.dataset.id),r&&t.dataset.id!==r.dataset.id&&this.clear(this.const.layer.TRACK),this.simulate_paused=!1,this.simulateTrack(t)}),0)}async#$e(e){const t=e.parentElement.parentElement;t.classList.contains(a.A.classes.CHECKED)?(this.clear(this.const.layer.TRACK),e.removeAttribute("title")):(this.getSelectedTrackItem()&&this.#at(t.dataset.id),this.#je=this.drawTrack(t),await this.#je),t.classList.contains(a.A.classes.CHECKED)&&await this.#nt({uid:t.dataset.uid})}#at(e){this.track.trackList.querySelectorAll("li[data-id]").forEach((t=>{if(t.dataset.id!==e){const e=t.querySelector(this.const.selector.PAUSE);this.simulationStopped=!0,e.classList.add(this.const.className.PLAY),e.setAttribute("title",this.getLocaleString("tr.lst.start")),this.#Ke(!1,t)}}))}#Ke(e,t){"LI"!==t.tagName&&(t=t.parentElement.parentElement);const r=t.querySelector("input"),n=this.const.selector,i=t.querySelector(n.ACTIVATOR);e?(r.classList.remove(a.A.classes.HIDDEN),r.focus(),r.value=i.text,i.classList.add(a.A.classes.HIDDEN),t.dataset.title=t.title,t.title="",t.querySelector(n.EDIT).classList.add(a.A.classes.HIDDEN),t.querySelector(n.DELETE).classList.add(a.A.classes.HIDDEN),t.querySelector(n.ACTIVATOR).classList.add(a.A.classes.HIDDEN),t.querySelector(n.EXPORT).classList.add(a.A.classes.HIDDEN),t.querySelector(n.SHARE).classList.add(a.A.classes.HIDDEN),t.querySelector(n.SAVE).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.CANCEL).classList.remove(a.A.classes.HIDDEN)):(r.classList.add(a.A.classes.HIDDEN),i.classList.remove(a.A.classes.HIDDEN),t.title=t.dataset.title,delete t.dataset.title,t.querySelector(n.EDIT).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.DELETE).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.ACTIVATOR).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.EXPORT).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.SHARE).classList.remove(a.A.classes.HIDDEN),t.querySelector(n.SAVE).classList.add(a.A.classes.HIDDEN),t.querySelector(n.CANCEL).classList.add(a.A.classes.HIDDEN))}#st=function(){return this.trackLayer.features.filter((e=>e instanceof m.A))};async#Xe(e){await this.getShareDialog(this.#Re);const t=await this.#nt({uid:e.dataset.uid});this.toShare={trackName:e.querySelector(this.const.selector.ACTIVATOR).text,features:t}}activate(){}deactivate(){c.A.closeModal(),this.clearSelection(),this.deactivateGeotracking()}#lt(e){const t=this,r={},n=c.A.getMapLocale(t.map);if(t.map.on3DView){var i=t.map.crs!==t.map.view3D.crs?c.A.reproject(e.position,t.map.crs,t.map.view3D.crs):e.position;r.x=i[0].toLocaleString(n),r.y=i[1].toLocaleString(n),r.mdt=Math.round(t.map.view3D.getHeightFromMDT(i)).toLocaleString(n),r.isGeo=!0}else r.x=e.position[0].toLocaleString(n),r.y=e.position[1].toLocaleString(n);return r.z=Math.round(e.altitude).toLocaleString(n),r.accuracy=Math.round(e.accuracy).toLocaleString(n),r.speed=e.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1}),r}getTrackInfoPanel(){const e=this;return e.track._infoPanelPromise||(e.track._infoPanelPromise=new Promise((function(t,r){if(e.track.infoPanel)t(e.track.infoPanel);else{const r={content:"table",resize:!1,titles:{main:e.getLocaleString("geo.mylocation"),max:e.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tc-tracking"}};let n;const i=function(e){r.position=e.POSITION.RIGHT,n=e.addControl("resultsPanel",r)};let o;if(!e.options.displayElevation&&e.options.displayOn?o=e.options.displayOn:e.options.displayElevation&&(o=e.options.displayElevation.displayOn),o){const t=e.map.getControlsByClass("TC.control."+o[0].toUpperCase()+o.substring(1))[0];t?i(t):e.map.addControl(o).then(i)}else r.div=document.createElement("div"),e.map.div.appendChild(r.div),n=e.map.addControl("resultsPanel",r);n.then((function(r){e.track.infoPanel=r,t(r)}))}}))),e.track._infoPanelPromise}renderInfoNewPosition(e){const t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",t.#lt(e.pd),(function(e){t.getTrackInfoPanel().then((function(r){r.isMinimized()||r.renderPromise().then((function(){r.options.collidingPriority=r.COLLIDING_PRIORITY.IGNORE,r.open(e),t.infoPanelController=new A.A(t.infoPanelModel,new v.A(r.getTableContainer()))}))}))}))}#ct(){this.track.trackToolPanelOpened.checked||this.map.trigger(a.A.event.TOOLSCLOSE)}setFollowing(e){const t=this;if(t.#ke=e,t.trackCenterButton){const r=t.trackCenterButton.querySelector("button");r.classList.toggle(a.A.classes.UNPLUGGED,!e),r.title=t.getLocaleString(e?"geo.trk.notCenter":"geo.trk.center")}!e&&t.trackCenterButton&&t.trackCenterButton.querySelector("button").classList.add(a.A.classes.UNPLUGGED),e&&t.trackCenterButton&&t.trackCenterButton.querySelector("button").classList.remove(a.A.classes.UNPLUGGED)}async moveTo(e){e&&Array.isArray(e)&&e.length>0&&(_=!0,e[0]instanceof p.A?await this.map.zoomToFeatures(e,{animate:!1}):await this.map.setCenter(e,{animate:!1}),setTimeout((function(){_=!1}),300))}setGeotracking(){const e=this;e.activate(),e.#ke=!0,e.#it(),e.#ct(),e.map.on(a.A.event.ZOOM,L),e.on(e.const.event.POSITIONCHANGE,(function(t){e.currentPoint&&e.currentPoint.position[0]!==t.pd.position[0]&&e.currentPoint.position[1]!==t.pd.position[1]&&e.#ke&&e.moveTo(t.pd.position),e.currentPoint=t.pd,e.renderInfoNewPosition(t),e.track.trackName.disabled=!1,e.track.trackSave.disabled=!1,e.track.trackWPT.disabled=!1,e.track.trackAdd.disabled=!1,c.A.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,e.wrap.formattedToStorage(e.geotrackingLayer).features)})),e.on(e.const.event.STATEUPDATED,(function(e){})),e.clear(e.const.layer.GEOTRACKING),e.#ut(e.const.localStorageKey.GEOTRACKING_SHOW_WARNING),e.wrap.setGeotracking(!0)}#ht(){C?(async()=>{try{b=await navigator.wakeLock.request("screen"),console.log("Wake Lock active"),b.addEventListener("release",(()=>{console.log("Wake Lock released")}))}catch(e){console.error(e)}})():this.#dt()}#pt(){C?b.release().then((()=>{b=null})):this.#gt()}#dt(){const e=this;if(!e.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};e.videoScreenOn=document.createElement("video"),e.videoScreenOn.setAttribute("loop",""),e.videoScreenOn.setAttribute("muted",""),e.videoScreenOn.setAttribute("webkit-playsinline",""),e.videoScreenOn.setAttribute("playsinline",""),e.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var r=document.createElement("source");r.src=t.WebM,r.type="video/webm",e.videoScreenOn.appendChild(r);var n=document.createElement("source");n.src=t.MP4,n.type="video/mp4",e.videoScreenOn.appendChild(n)}e.videoScreenOn.play()}#gt(){this.videoScreenOn&&this.videoScreenOn.pause()}#ft(e){const t="onpagehide"in window?"pagehide":"blur";window.addEventListener(t,(()=>this.#mt()),{signal:e})}#yt(e){this.#Ge??=()=>{this.videoScreenOn&&this.videoScreenOn.paused&&this.videoScreenOn.play(),this.#vt()};const t="onpageshow"in window?"pageshow":"focus";window.addEventListener(t,this.#Ge,{signal:e})}#At(e){const t=this;window.addEventListener("visibilitychange",(async()=>{var e=function(){const e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();if(document[e]){if(T)if(navigator.serviceWorker&&(navigator.serviceWorker.controller||t.map.getControlsByClass(d.default).length&&"activated"===(await t.map.getControlsByClass(d.default)[0].getServiceWorker()).state))try{(await navigator.serviceWorker.ready).showNotification(t.notificationConfig.title,Object.assign(t.notificationConfig,{actions:[{action:"back",title:t.getLocaleString("geo.trk.notification.backButton")}],data:{url:document.location.href}}))}catch(e){new Notification(t.notificationConfig.title,t.notificationConfig)}else new Notification(t.notificationConfig.title,t.notificationConfig)}else null!==b?t.#ht():t.#Ge();!b&&t.videoScreenOn&&console.log("video is: "+t.videoScreenOn.paused)}),{signal:e})}#St(){this.#Fe?.abort(),this.#Fe=new AbortController;const{signal:e}=this.#Fe;this.#At(e),this.#ft(e),this.#yt(e)}#Et=function(){this.#Fe?.abort(),this.#Fe=null};#mt(){var e=c.A.storage.getSessionLocalValue(this.const.localStorageKey.GEOTRACKINGTEMP);e&&e.length>0&&i().setItem(this.const.localStorageKey.GEOTRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e)).catch((e=>console.warn(e)))}#vt(){const e=this;i().getItem(e.const.localStorageKey.GEOTRACKINGTEMP).then((function(t){null!==t&&"null"!==t&&t.length>0&&c.A.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,t)}),(e=>console.warn(e)))}#ut(e){const t=this;i().getItem(e).then((function(r){if(null==r){const r=t.#k.querySelector(".tc-ctl-geolocation-track-warning-dialog"),n=r.querySelector("sitna-toggle");n.setAttribute("name",e),n.checked=!1,document.querySelector("#pageBlurMsg").textContent=c.A.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),r.querySelector("h3").textContent=e===t.const.localStorageKey.GPS_SHOW_WARNING?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title"),c.A.showModal(t.#k.querySelector(".tc-ctl-geolocation-track-warning-dialog"))}}),(e=>console.warn(e))),t.map.toast(c.A.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),{type:a.A.msgType.WARNING})}#wt(e){return c.A.showModal(this.#k.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){c.A.isFunction(e)&&e()}}),!0}activateGeotracking(){const e=this;e.#it();var t=!0;e.isActive||e.activate(),e.clear(e.const.layer.GEOTRACKING);try{c.A.storage.setSessionLocalValue(e.const.localStorageKey.TEST,e.const.localStorageKey.TEST)}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?o.A.alert(e.getLocaleString("geo.error.trackinglocalstorage")):o.A.error(r),t=!1}if(t){if(window.Notification||window.webkitNotifications){const e=window.Notification||window.webkitNotifications;"denied"===e.permission?T=null:"granted"===e.permission?T=e:e.requestPermission((function(t){"granted"===t&&(T=e)}))}e.#ht(),e.#St(),e.geotrackingSession=c.A.storage.getSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP),e.geotrackingSession?e.#wt((function(){e.#Qe()}))||e.track.trackRenew.click():e.setGeotracking()}else e.#Qe()}deactivateGeotracking(){const e=this,t=function(){return e.getTrackInfoPanel().then((e=>e.close())),e.#mt(),e.wrap.setGeotracking(!1),delete e.geotrackingPosition,e.#Ne||e.div.querySelector(`.${e.CLASS}-track-render`).querySelector("sitna-toggle").click(),e.#pt(),e.#Et(),e.off(e.const.event.POSITIONCHANGE),e.off(e.const.event.STATEUPDATED),e.#Qe(),e.track.trackName.value="",e.track.trackName.disabled=!0,e.track.trackSave.disabled=!0,e.track.trackWPT.value="",e.track.trackWPT.disabled=!0,e.track.trackAdd.disabled=!0,e.clear(e.const.layer.GEOTRACKING),e.clear(e.const.layer.GPS),e.map.off(a.A.event.ZOOM,L),!0};return e.wrap.hasCoordinates()?(e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4}),t()):t()}async getStoredTracks(){const e=this;let t=[];const r=function(t){return 0===e.#Ue.size&&t.filter((e=>e.profile)).forEach((t=>e.#Ue.set(t.uid,JSON.parse(t.profile)))),t};let n;try{n=await i().keys()}catch(t){console.log("Capturamos error que se produce por configuración del navegador."),o.A.error(e.getLocaleString("couldNotAccessLocalStorage"))}if(n=n?.filter((function(t){return 0!==t.indexOf(e.const.localStorageKey.GEOTRACKINGTEMP)&&0===t.indexOf(e.const.localStorageKey.GEOTRACKING)&&/trk#\d/i.exec(t)})),!n||0===n.length)return e.availableTracks=t,r(t);const a=new Array(n.length);n.forEach((function(e,t){a[t]=i().getItem(e)}));const s=await Promise.all(a);if(s&&s.length){s.forEach((function(e){"string"==typeof e&&(e=JSON.parse(e)),e instanceof Array?t=t.concat(e):t.push(e)}));const n=t.length>1?x(t):t;return e.availableTracks=n,r(n)}}async setStoredTracks(e){const t=this,r=[];e.forEach((function(e){r.push(i().setItem(t.const.localStorageKey.GEOTRACKING+"#"+e.uid,e).catch((e=>{console.warn(e)})))})),await Promise.all(r),await t.getStoredTracks(),t.#ot()}async getAvailableTracks(){const e=this;return e.availableTracks?e.availableTracks:await e.getStoredTracks()}async#ot(){const e=this;e.track.trackList.querySelectorAll("li").forEach((function(e){e.style.display="none"}));const t=await e.getAvailableTracks();if((o=t)&&0!==o.length){const o=e.getSelectedTrackItem();var r;o&&(r=o.dataset.uid),e.track.trackList.querySelectorAll("li[data-id]").forEach((function(t){e.track.trackList.removeChild(t)}));const a=new DOMParser;for(var n=0;n<t.length;n++){var i=t[n];if(i&&"object"==typeof i){const t=await e.getRenderedHtml(e.CLASS+"-track-node",{id:n,uid:i.uid,name:i.name?i.name.trim():""}),r=a.parseFromString(t,"text/html").body.firstChild;e.getItemTools().forEach((t=>e.addItemToolUI(r,t))),e.track.trackList.appendChild(r),e.trackController?e.trackController.add(r):e.trackController=new A.A(e.trackModel,new v.A(r)),r.querySelector(e.const.selector.VISIBILITY).addEventListener("change",(function(t){e.trackLayer.setVisibility(t.target.checked),e.endPointLayer.setVisibility(t.target.checked)}))}}e.div.querySelector(e.const.selector.DELETEALL).disabled=!1,r&&e.setSelectedTrack(e.track.trackList.querySelector('li[data-uid="'+r+'"]')),e.track.trackSearch.disabled=!1}else e.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach((function(e){e.style.display=""})),e.track.trackSearch.disabled=!0;var o}clearChartProgress(){this.getElevationControl().then((e=>e&&e.removeElevationTooltip()))}setChartProgress=function(e,t,r,n){const i=this;if(!i.elevationControl||!i.elevationControl.resultsPanel||i.elevationControl.resultsPanel.isVisible()&&!i.elevationControl.resultsPanel.isMinimized()){var o=e.d;if(i.elevationChartData){i.setSecondaryElevationProfileCoordinates(i.elevationChartData.coords);let e=0;for(;i.elevationChartData.x[e]<=o;)e++;i.getElevationControl().then((t=>t&&t.getProfilePanel().then((function(t){t&&(t.chart.chart.tooltip.show({x:i.elevationChartData.x[0===e?0:e-1]}),t.wrap.hideElevationMarker())}))))}}};setSecondaryElevationProfileCoordinates(e){const t=this.elevationChartData?.secondaryElevationProfileChartData?.[0];if(t?.ele&&!t?.coords){let r=-2,n=e;do{r++,n=n[0]}while(Array.isArray(n));t.coords=e.flat(r).map(((e,r)=>[e[0],e[1],t.ele[r]]))}}getTimeInterval(e,t){let r=t-e;const n={};var i=Math.floor(r/1e3/60/60/24);r-=1e3*i*60*60*24;var o=Math.floor(r/1e3/60/60);r-=1e3*o*60*60,n.h=o+24*i;var a=Math.floor(r/1e3/60);return r-=1e3*a*60,n.m=a,n.s=Math.floor(r/1e3),c.A.extend({},n,{toString:("00000"+n.h).slice(-2)+":"+("00000"+n.m).slice(-2)+":"+("00000"+n.s).slice(-2)})}async simulateTrack(e){const t=this,r=await t.getElevationControl();r.removeElevationTooltip(),t.simulationSpeed=1,t.getSelectedTrackItem()===e&&r.resultsPanel&&r.resultsPanel.chart&&r.resultsPanel.chart.chart?(t.hasElevation||(t.hasElevation=0!==r.elevationProfileChartData.min||0!==r.elevationProfileChartData.max),t.wrap.simulateTrack()):t.drawTrack(e,!1).then((function(){t.elevationChartData&&0===t.elevationChartData.min&&0===t.elevationChartData.max?(t.map.toast(t.getLocaleString("geo.trk.simulate.empty"),{duration:1e4}),t.hasElevation=!1):0===t.elevationChartData.min&&0===t.elevationChartData.max||(t.hasElevation=!0),t.wrap.simulateTrack()}))}async drawTrack(e,t){this.clear(this.const.layer.TRACK),this.#ct(),this.setSelectedTrack(e),await this.drawTrackData(e),this.map.addControlState(this),await this.displayTrackProfile(e),this.activate()}#_t(e){return this.#Ue.get(e)}#Lt(e,t){const r=this;let n=r.#_t(t);return n||(r.#Ue.set(t,e),r.getAvailableTracks().then((function(n){if(n){let i=n.findIndex((e=>e.uid.toString()===t));i>-1&&(n[i].profile=JSON.stringify(e),r.setStoredTracks(n))}})),n=e),n}#Ct(e){this.#Ue.delete(e)}#tt(e){const t=this,r=t.#qe.find((function(t){return t.feature===e}));if(!r){const r=function(e,t){for(var r=[],n=[],i=0;i<e.length;i++)r[e[i]]=!0;for(i=0;i<t.length;i++)r[t[i]]?delete r[t[i]]:r[t[i]]=!0;for(var o in r)n.push(o);return n};return t.#qe.find((function(t){return 0===r(t.feature.geometry,e.geometry).length}))}return r}#rt=function(e,t){let r=this.#tt(e);return r||(r={feature:e},this.#qe.push(r)),r.data=t,r};async displayTrackProfile(e,t){const r=this;if(t?.resized)return void r.wrap.simulateTrackEnd(t.resized);r.#Be||(r.#Be=r.displayTrackProfile.bind(r,e,{resize:!0}),window.addEventListener("resize",r.#Be,!1));const n=await r.getElevationControl();var i;if(!n)throw Error("No elevation control");{let o;if(t?.forceRefresh?r.#Ct(e.dataset.uid):o=r.#_t(e.dataset.uid),o){r.options.displayElevation||delete o.secondaryElevationProfileChartData[0],r.elevationChartData=o;const e=await n.getProfilePanel();await e.renderPromise(),e.doVisible(),n.renderElevationProfile(r.elevationChartData),e.setCurrentFeature()}else{const o=await r.getTrackData(e);if(!r.trackLayer?.features)throw Error("No features available");{const s="XYZM"===o.layout||"XYM"===o.layout,l=s||r.options.displayElevation;let u=r.trackLayer.features.filter((e=>l&&E(e))),h=t?.feature||u[0];if(r.map.on3DView&&r.map.view3D.view2DCRS!==r.map.view3D.crs&&h.setCoordinates(c.A.reproject(h.getCoordinates(),r.map.view3D.view2DCRS,r.map.view3D.crs)),!h)throw Error("No features have compatible geometry layout");{let t={};if(s){let e=0;const r=S(i=h)?i.geometry[0][0]:i.geometry[0],n=(e=>S(e)?e.geometry[0][e.geometry[0].length-1]:e.geometry[e.geometry.length-1])(h);e="XYZM"===o.layout?n[3]-r[3]:n[2]-r[2],t={s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}let l={originalElevation:!0,onlyOriginalElevation:!r.options.displayElevation,ignoreCaching:!0,time:t,callback:function(){r.elevationChartData=n.elevationProfileChartData,r.hasElevation=0!==n.elevationProfileChartData.min||0!==n.elevationProfileChartData.max,r.#Lt(n.elevationProfileChartData,e.dataset.uid),r.resultsPanelChart.div.addEventListener("mouseover",(function(e){r.trackLayer&&r.trackLayer.getVisibility()&&r.trackLayer.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)})),r.resultsPanelChart.div.addEventListener("mouseout",(function(e){r.trackLayer&&!r.trackLayer.getVisibility()&&0==r.trackLayer.getOpacity()&&r.wrap.deactivateSnapping.call(r.wrap)})),r.map.on(a.A.event.RESULTSPANELMIN,(function(){r.clearChartProgress()})).on(a.A.event.RESULTSPANELCLOSE,(function(){r.clearChartProgress()})),n.getProfilePanel().then((function(e){let t=r.getSelectedTrackItem();t&&(e.currentFeature.fileName=r.#Ze(t))}))}};n.displayElevationProfile(h,l)}}}}}clear(e){return this.#Be&&(window.removeEventListener("resize",this.#Be,!1),this.#Be=void 0),e===this.const.layer.TRACK?(this.map?.removeControlState(this),this.trackLayer.clearFeatures(),this.endPointLayer.clearFeatures(),this.#We=null,this.#He=null,delete this.trackLayer._fileHandle,delete this.trackLayer.file,delete this.trackLayer.fileSystemFile,this.getElevationControl().then((e=>e&&e.closeElevationProfile())),delete this.elevationChartData,this.wrap.simulateTrackEnd(),this.wrap.clear(),this.track.trackList.querySelectorAll("li").forEach((function(e){e.classList.remove(a.A.classes.CHECKED)})),this.map.trigger(this.const.event.CLEARTRACK),this.loadingState||(this.toShare=null)):(this.geotrackingLayer.clearFeatures(),this.gpsLayer.clearFeatures()),this}#bt(){const e=this;e.map.off(a.A.event.LAYERERROR,e.#bt),e.clearFileInput(e.track.trackImportFile),o.A.alert(e.getLocaleString("geo.trk.upload.error3"))}loadFile(e){const t=this;return t._cleaning||(t.clear(t.const.layer.TRACK),t.map&&(t.map.on(a.A.event.LAYERERROR,t.#bt),t.map.wrap.loadFiles([e],{control:t}))),t}async saveTrack(e){const t=this;let r=e.message||t.getLocaleString("geo.trk.save.alert");const n=async function(n){let i,a,s=e.importedFileName||t.track.trackName.value.trim(),l=await t.getAvailableTracks(),c=t.wrap.formattedToStorage(n,!0,e.notReproject),u=function(){t.track.trackName.value="",t.track.trackName.disabled=!0,t.track.trackSave.disabled=!0,t.track.trackWPT.value="",t.track.trackWPT.disabled=!0,t.track.trackAdd.disabled=!0,t.#ct()},h=!1;if(e.uid)i=l.find((t=>t.uid==e.uid));else if(e.fileHandle){const t=await Promise.all(l.map((t=>t.fileHandle.isSameEntry(e.fileHandle)))),r=l.filter(((e,r)=>t[r]));void 0!==e.trackIndex?i=r[e.trackIndex]:1===r.length&&(i=r[0])}if(i||(h=!0,i={name:s,layout:c.layout,crs:t.storageCrs}),i.data=c.features,e.fileHandle&&(i.fileHandle=e.fileHandle),h&&(a=await t.#Tt(i)),a)return console.log("Ya existe un track con ese mismo hash"),u(),a.uid;h&&(i.uid=e.uid||t.createTrackUID(),l.push(i)),l=x(l);try{return await t.setStoredTracks(l),t.map.toast(r,{duration:3e3}),u(),i.uid}catch(e){throw o.A.alert(t.getLocaleString("geo.error.savelocalstorage")+": "+e.message),u(),e}};return e.importedFileName||e.uid?await t.map.wait(n(t.trackLayer)):(0===t.track.trackName.value.trim().length&&(t.track.trackName.value=(new Date).toLocaleString()),await t.map.wait(n(t.geotrackingLayer)))}async#Tt(e){const t=new ol.format.GeoJSON,r=function(e){let r=Math.pow(10,a.A.DEGREE_PRECISION+1);return e.forEach((function(e){let t=c.A.explodeGeometry(c.A.compactGeometry(e.getGeometry().getCoordinates(),r));e.getGeometry().setCoordinates(t)})),t.writeFeatures(e)},n=r(t.readFeatures(e.data));return(await this.getAvailableTracks()).find((i=>e.name===i.name&&n===r(t.readFeatures(i.data))))}addWaypoint(){const e=this;let t=e.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString()),e.map?.wait((async()=>{e.#ct(),e.wrap.addWaypoint(e.currentPoint.position,{name:t,ele:e.currentPoint.heading,time:(new Date).getTime()}),e.track.trackWPT.value="",e.track.trackWPT.disabled=!0,e.track.trackAdd.disabled=!0,c.A.storage.setSessionLocalValue(e.const.localStorageKey.GEOTRACKINGTEMP,e.wrap.formattedToStorage(e.geotrackingLayer).features)}))}async editTrackName(e,t){const r=this,n=await r.getAvailableTracks();if(n){const i=n.find((t=>t.uid==e));i&&(i.name=t,await r.setStoredTracks(n))}}removeTrack(e,t){const r=this;return new Promise((function(n,a){r.getAvailableTracks().then((function(a){if(a){var s=e.dataset.id;if(a[s]){var l=a[s].uid;const e=function(){const e=r.getSelectedTrackItem();e&&e.dataset.id===s&&r.clear(r.const.layer.TRACK),i().removeItem(r.const.localStorageKey.GEOTRACKING+"#"+l).then((function(){r.getStoredTracks().then((function(){r.#ot().then((()=>n(!0)))}))})).catch((function(e){console.warn(e),n(!1)}))};t?.silent?e():o.A.confirm(r.getLocaleString("geo.trk.delete.alert"),e,(()=>n(!1)))}}}))}))}removeAllTracks(e){const t=this;o.A.confirm(t.getLocaleString("geo.trk.delete.all.alert"),(function(){t.div.querySelectorAll(`.${t.CLASS}-track-available-lst li[data-id]`).forEach((function(r){t.removeTrack(r,{silent:!0}),e.disabled=!0}))}))}setSelectedTrack(e){const t=this;t.currentTrackUid=e.dataset.uid,t.isActive||t.activate(),t.track.trackList.querySelectorAll("li").forEach((function(e){e.classList.remove(a.A.classes.CHECKED),e.querySelector(t.const.selector.ACTIVATOR)?.removeAttribute("title")})),e.classList.add(a.A.classes.CHECKED);const r=e.querySelector(t.const.selector.ACTIVATOR),n=function(t){e.classList.contains(a.A.classes.CHECKED)&&e.scrollIntoView({behavior:"smooth",block:"end"}),e.removeEventListener("transitionend",n,!1)};e.addEventListener("transitionend",n,!1),r.setAttribute("title",t.getLocaleString("tr.lst.clear")+": "+r.text),t.loadingState||(t.toShare=null)}getSelectedTrackItem(){return this.track.trackList.querySelector("li."+a.A.classes.CHECKED)}clearSelectedTrack(){const e=this.getSelectedTrackItem();e&&(this.#Be&&(window.removeEventListener("resize",this.#Be,!1),this.#Be=void 0),e.classList.remove(a.A.classes.CHECKED),e.querySelector(this.const.selector.ACTIVATOR).removeAttribute("title"),this.toShare=null,this.map?.removeControlState(this))}clearSelection(){this.wrap.deactivateSnapping(),this.getSelectedTrackItem()&&this.clearSelectedTrack(),this.resultsPanelChart&&(this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping),this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping),this.resultsPanelChart.close()),this.clear(this.const.layer.TRACK)}async drawTrackData(e){const t=this;t.wrap.clear();const r=await t.getTrackData(e);r&&r.data&&(await t.wrap.drawTrackData(r),t.updateEndMarkers(),r.fileHandle&&(t.trackLayer._fileHandle=r.fileHandle,t.trackLayer.file=r.fileHandle.name),t.trackLayer.setVisibility(!0))}async getTrackData(e){const t=this,r=await t.getAvailableTracks();if(r){const n=r[e.dataset.id];if(n){let e=n.data;return e=t.wrap.formattedFromStorage(e),{data:e,layout:n.layout,fileHandle:n.fileHandle}}}return null}async updateEndMarkers(){const e=this;var t=e.trackLayer.features;if(t&&t.length>0){t.forEach((e=>{e.showsPopup=e instanceof m.A}));const r=t.find(E),n=t.reverse().find(E);let i,o;const a=function(e){let t;return t=S(e)?e.geometry.flat():e.geometry,t};if(n){const t=a(n);if(o=t[t.length-1],o){const t=o.slice().splice(0,2);e.#He?e.#He.setCoordinates(t):e.#He=await e.endPointLayer.addMarker(t,{showsPopup:!1,width:32,height:32,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],noExport:!0})}}else e.#He&&(e.endPointLayer.removeFeature(e.#He),e.#He=null);if(r){if(i=a(r)[0],i&&i!==o){const t=i.slice().splice(0,2);e.#We?e.#We.setCoordinates(t):e.#We=await e.endPointLayer.addMarker(t,{showsPopup:!1,width:32,height:32,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],noExport:!0})}}else e.#We&&(e.endPointLayer.removeFeature(e.#We),e.#We=null)}}export(e){return this.wrap.export(e)}clearFileInput(e){const t=document.createElement("form"),r=e.parentElement;r.insertBefore(t,e),t.appendChild(e),t.reset(),t.insertAdjacentElement("afterend",e),r.removeChild(t)}createTrackUID(){return Date.now()+Math.random()}getLoadingIndicator(){const e=this;return e.loading||(e.loading=e.map.getControlsByClass(l.default),e.loading&&e.loading.length>0&&(e.loading=e.loading[0])),e.loading}onGeolocateError(e){const t=this;var r;switch(navigator.geolocation&&(t.currentPosition&&navigator.geolocation.clearWatch(t.currentPosition),t.currentPositionTrk&&(t.currentPositionTrk=t.currentPositionTrk instanceof Array?t.currentPositionTrk:[t.currentPositionTrk],t.currentPositionTrk.forEach((function(e){navigator.geolocation.clearWatch(e)})),t.currentPositionTrk=[])),t.currentPositionWaiting&&t.getLoadingIndicator().removeWait(t.currentPositionWaiting),e.code){case e.PERMISSION_DENIED:r=t.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:r=t.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:r=t.getLocaleString("geo.error.timeout");break;default:r=t.getLocaleString("geo.error.default")}t.map.toast(r,{type:a.A.msgType.WARNING}),!t.geotrackingPosition&&t.track&&(t.track.activateButton.classList.remove(a.A.classes.HIDDEN),t.track.deactivateButton.classList.add(a.A.classes.HIDDEN)),t.#Et()}exportState(){const e=this;if(e.trackLayer&&e.track||e.toShare){const t={id:e.id};if(e.toShare)t.trackResult=JSON.stringify(e.toShare);else{const r=e.getSelectedTrackItem();r&&(t.trackResult=JSON.stringify({trackName:r.querySelector(e.const.selector.ACTIVATOR).text,trackId:r.dataset.uid}))}return t}return null}importState(e){const t=this;if(t.map&&e.trackResult?.length){t.enable();let r=JSON.parse(e.trackResult);const n=e=>t.track.trackList.querySelector('li[data-uid="'+e.uid+'"]');t.map.wait((async()=>{if(r.features){const i=new Array(r.features.length);r.features.forEach((function(e,t){const r={data:e.data,id:e.id,showsPopup:e.showsPopup};var n=e.geom;switch(e.type){case a.A.geom.POLYLINE:i[t]=new g.A(n,r);break;case a.A.geom.MULTIPOLYLINE:i[t]=new f.A(n,r);break;case a.A.geom.MARKER:i[t]=new y.A(n,r);break;case a.A.geom.POINT:i[t]=new m.A(n,r)}})),Object.prototype.hasOwnProperty.call(r,"doZoom")&&(t.loadingState=!0);const o=await Promise.all(i),s={data:(new ol.format.GeoJSON).writeFeatures(o.map((e=>e.wrap.feature))),name:r.trackName,uid:r.trackId},l=await t.#Tt(s);if(l)await t.drawTrack(n(l));else{var e={features:o,fileName:r.trackName,uid:r.trackId,notReproject:!0,isShared:!0};await t.getAvailableTracks(),t.importTrack(e)}}else{const e=(await t.getAvailableTracks()).find((e=>e.name===r.trackName));if(e&&(await t.#ot(),await t.drawTrack(n(e)),e.fileHandle)){let r=await e.fileHandle.queryPermission();"prompt"===r&&(navigator.userActivation?.isActive||o.A.confirm(t.getLocaleString("fileAccessPrompt")))&&(r=await e.fileHandle.requestPermission()),"granted"===r&&t.map.loadFiles([e.fileHandle],{control:t})}}}))}}updateModel(){const e=this;e.model.geo=e.getLocaleString("geo"),e.model["geo.trk.panel.help.1"]=e.getLocaleString("geo.trk.panel.help.1"),e.model["geo.trk.panel.help.2"]=e.getLocaleString("geo.trk.panel.help.2"),e.model["geo.trk.panel.help.3"]=e.getLocaleString("geo.trk.panel.help.3"),e.model["geo.gps"]=e.getLocaleString("geo.gps"),e.model["geo.track.title"]=e.getLocaleString("geo.track.title"),e.model["geo.tracks"]=e.getLocaleString("geo.tracks"),e.model["geo.tracks.title"]=e.getLocaleString("geo.tracks.title"),e.model["geo.noTracks"]=e.getLocaleString("geo.noTracks"),e.model.noMatches=e.getLocaleString("noMatches"),this.noMatches="",e.model["geo.trk.delete.all.tooltip"]=e.getLocaleString("geo.trk.delete.all.tooltip"),e.model["geo.trk.delete.all"]=e.getLocaleString("geo.trk.delete.all"),e.model["geo.trk.import.upload"]=e.getLocaleString("geo.trk.import.upload"),e.model["geo.trk.import.lbl"]=e.getLocaleString("geo.trk.import.lbl"),e.model["geo.trk.panel.1"]=e.getLocaleString("geo.trk.panel.1"),e.model["geo.trk.panel.2"]=e.getLocaleString("geo.trk.panel.2"),e.model["geo.trk.panel.3"]=e.getLocaleString("geo.trk.panel.3"),e.model["geo.trk.panel.4"]=e.getLocaleString("geo.trk.panel.4"),e.model["geo.trk.panel.5"]=e.getLocaleString("geo.trk.panel.5"),e.model["geo.trk.render"]=e.getLocaleString("geo.trk.render"),e.model["geo.track.activate.title"]=e.getLocaleString("geo.track.activate.title"),e.model["geo.track.activate"]=e.getLocaleString("geo.track.activate"),e.model["geo.track.deactivate.title"]=e.getLocaleString("geo.track.deactivate.title"),e.model["geo.track.deactivate"]=e.getLocaleString("geo.track.deactivate"),e.model["geo.trk.name.plhr"]=e.getLocaleString("geo.trk.name.plhr"),e.model["geo.trk.name.save"]=e.getLocaleString("geo.trk.name.save"),e.model["geo.trk.wyp.plhr"]=e.getLocaleString("geo.trk.wyp.plhr"),e.model["geo.trk.wyp.save"]=e.getLocaleString("geo.trk.wyp.save"),e.model["geo.filter.plhr"]=e.getLocaleString("geo.filter.plhr"),e.model["geo.trk.center"]=e.getLocaleString("geo.trk.center"),e.model["geo.gps"]=e.getLocaleString("geo.gps"),e.model.close=e.getLocaleString("close"),e.model["geo.trk.dialog.cnt"]=e.getLocaleString("geo.trk.dialog.cnt"),e.model["geo.trk.dialog.new"]=e.getLocaleString("geo.trk.dialog.new"),e.model["geo.trk.dialog.cancel"]=e.getLocaleString("geo.trk.dialog.cancel"),e.model["geo.track.activate.title"]=e.getLocaleString("geo.track.activate.title"),e.model["geo.trk.page.blur"]=e.getLocaleString("geo.trk.page.blur"),e.model["geo.trk.dialog.doNotShow"]=e.getLocaleString("geo.trk.dialog.doNotShow"),e.model.ok=e.getLocaleString("ok"),e.model.keepFromGeometry=e.getLocaleString("keepFromGeometry"),e.model["mdt.title"]=e.getLocaleString("mdt.title"),e.model.getFromDtm=e.getLocaleString("getFromDtm"),e.model["geo.track"]=e.getLocaleString("geo.track"),e.model.share=e.getLocaleString("share"),e.trackModel.save=e.getLocaleString("save"),e.trackModel["tr.lst.cancel"]=e.getLocaleString("tr.lst.cancel"),e.trackModel["tr.lst.edit"]=e.getLocaleString("tr.lst.edit"),e.trackModel["tr.lst.share"]=e.getLocaleString("tr.lst.share"),e.trackModel["tr.lst.download"]=e.getLocaleString("tr.lst.download"),e.trackModel["tr.lst.delete"]=e.getLocaleString("tr.lst.delete"),e.trackModel["tr.lst.stop"]=e.getLocaleString("tr.lst.stop"),e.trackModel["tr.lst.start"]=e.getLocaleString("tr.lst.start"),e.trackModel["tr.lst.backward"]=e.getLocaleString("tr.lst.backward"),e.trackModel["tr.lst.velocity"]=e.getLocaleString("tr.lst.velocity"),e.trackModel["tr.lst.forward"]=e.getLocaleString("tr.lst.forward"),e.trackModel["tr.lst.view"]=e.getLocaleString("tr.lst.view"),e.infoPanelModel.lon=e.getLocaleString("lon"),e.infoPanelModel["geo.trk.accuracy"]=e.getLocaleString("geo.trk.accuracy"),e.infoPanelModel.lat=e.getLocaleString("lat"),e.infoPanelModel["geo.trk.speed"]=e.getLocaleString("geo.trk.speed"),e.infoPanelModel.ele=e.getLocaleString("ele"),e.infoPanelModel["mdt.title"]=e.getLocaleString("mdt.title"),e.infoPanelModel.mdt=e.getLocaleString("mdt")}async updateLanguage(){const e=this;e.updateModel(),e?.track?.infoPanel&&e.track.infoPanel.setTitles({main:e.getLocaleString("geo.mylocation"),max:e.getLocaleString("geo.mylocation.show")})}}o.A.mix(R,u.default),o.A.mix(R,h.default),R.prototype.CLASS="tc-ctl-geolocation",o.A.control.Geolocation=R;const O=R},3126:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(8038),i=r(797),o=r(3967),a=(r(9239),r(5777)),s=r(3791);n.A.control=n.A.control||{};const l=[];class c{constructor(){this.legend="",this.noData=""}}class u extends o.default{register(e){const t=this;return e.on(i.A.event.VIEWCHANGE,(function(r){const n=r.view,o=t.loadGraphics.bind(t);n===i.A.view.THREED?e.on(i.A.event.LAYERADD,o):n===i.A.view.DEFAULT&&e.off(i.A.event.LAYERADD,o)})),t.model=new c,t.renderPromise().then((function(){t.controller=new a.A(t.model,new s.A(t.div)),t.updateModel()})),super.register.call(t,e)}async loadTemplates(){const e=this,t=r.e(8296).then(r.bind(r,8296)),n=r.e(585).then(r.bind(r,585)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-node"]=(await n).default,e.template=i}loadGraphics(){const e=this;return e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);r&&t.querySelectorAll("li."+e.CLASS+"-node-visible").forEach((function(t){t.querySelectorAll("img").forEach((function(t){t&&t.hasAttribute("src")&&0===t.getAttribute("src").length&&e.styleLegendImage(t,r)}))}))})),e}updateScale(){const e=this,t=e.CLASS+"-node-inscale",r=e.CLASS+"-node-outofscale";return e.getLayerUIElements().forEach((function(n){const i=e.map.getLayer(n.dataset.layerId);if(i&&!i.customLegend){let o=!1;const a=n.querySelectorAll("li."+e.CLASS+"-leaf");a.forEach((function(n){if(n.classList.contains(e.CLASS+"-node-visible")&&n.querySelectorAll("img").length){const a=n.dataset.layerUid;i.isVisibleByScale(a)?(o=!0,n.classList.remove(r),n.classList.add(t),n.querySelectorAll("img").forEach((function(t){e.styleLegendImage(t,i)}))):(n.classList.add(r),n.classList.remove(t))}})),o=o||!a.length,a.length||n.querySelectorAll("img").forEach((function(t){e.styleLegendImage(t,i)})),n.classList.toggle(t,o),n.classList.toggle(r,!o)}})),e}update(){const e=this;return e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);if(r&&(!r.customLegend||!r.getVisibility())){const n=r.getTree(!1,!0);t.querySelectorAll("li").forEach((function(t){const o=e.CLASS+"-node-visible",a=e.CLASS+"-node-notvisible",s=e.CLASS+"-node-hasvisible";switch(r.getNodeVisibility(t.dataset.layerUid,n)){case i.A.visibility.VISIBLE:t.classList.remove(a,s),t.classList.add(o);break;case i.A.visibility.NOT_VISIBLE:t.classList.remove(o,s),t.classList.add(a);break;case i.A.visibility.HAS_VISIBLE:t.classList.remove(o,a),t.classList.add(s);break;case null:t.classList.remove(o,s),t.classList.add(a);break;default:t.classList.remove(a,s),t.classList.add(o)}})),e.updateLayerVisibility(r)}})),e.updateScale(),e}async updateLayerTree(e,t){const r=this;if(!e.isBase&&!e.options.stealth&&(!e.availableNames||e.availableNames?.some((t=>e.getInfo(t).legend.length)))){if(e.hideTree||e.options.hideTree,r.div.querySelector("."+r.CLASS+"-empty")?.classList.add(i.A.classes.HIDDEN),e.features&&!e.features.length)return;let t;t=r.div.querySelector("sitna-layer-legend#stl-"+e.id),t||(t=document.createElement("sitna-layer-legend"),t.id="stl-"+e.id,t.dataset.layerId=e.id,t.containerControl=r,l.push(e.id));var o=e.type===i.A.layerType.WMS?{customLegend:t.innerHTML}:e.getNestedTree?e.getNestedTree():e.getTree();e._title&&e._title!==e.title&&(o=Object.assign(o,{title:e._title}));try{const i=await r.getRenderedHtml(r.CLASS+"-node",o);t.innerHTML=i;const a=t.dataset.layerUid||t.dataset.layerId,s=r.div.querySelector("ul."+r.CLASS+"-branch"),c=s?.querySelectorAll('li[data-layer-uid="'+a+'"]');if(c&&1===c.length){const e=c[0];e.innerHTML!==t.innerHTML&&(e.innerHTML=t.innerHTML,e.setAttribute("class",t.getAttribute("class"))),r.update()}else{t.dataset.layerId=e.id;const i=r.map.workLayers.filter((e=>l.includes(e.id))).map((e=>e.id)).reverse(),o=e=>{if(0===e)return s.firstChild;if(i.length-1===e)return s.lastElementChild;const t=i[e+1];return s.querySelector('*[data-layer-id="'+t+'"]')||o(++e)};s.insertBefore(t,o(i.indexOf(e.id))),e instanceof n.A.layer.Raster?t.addEventListener("update",(e=>{r.map?.magnifier?.addNode(e.srcElement.querySelectorAll(".tc-ctl-legend-watch img"),4),r.update()})):r.update()}}catch(e){n.A.error(e)}}return r}removeLayer(e){return e.isBase||(super.removeLayer.call(this,e),l.splice(l.indexOf(e.id),1)),this}updateLayerVisibility(e){const t=this;return t.getLayerUIElements().forEach((function(r){r.dataset.layerId===e.id&&r.classList.toggle(t.CLASS+"-node-notvisible",!e.getVisibility())})),t}getLayerUIElements(){const e=this;return e.div.querySelector("ul."+e.CLASS+"-branch").querySelectorAll("sitna-layer-legend, li."+e.CLASS+"-node")}updateModel(){this.model.legend=this.getLocaleString("legend"),this.model.noData=this.getLocaleString("noData")}async updateLanguage(){const e=this;e.updateModel(),e.map?.magnifier?.model&&(e.map.magnifier.model.textToOpen=e.getLocaleString("clickToEnlarge"),e.map.magnifier.model.textToClose=e.getLocaleString("clickToClose"))}}u.prototype.CLASS="tc-ctl-legend",n.A.control.Legend=u;const h=u},3158:(e,t,r)=>{"use strict";r.d(t,{Jt:()=>o,WQ:()=>i});let n={};function i(e,t,r){const i=e.getCode(),o=t.getCode();i in n||(n[i]={}),n[i][o]=r}function o(e,t){return e in n&&t in n[e]?n[e][t]:null}},3301:(e,t,r)=>{"use strict";r.d(t,{A:()=>C,C:()=>L});var n=r(8038),i=r(797),o=r(153),a=r(8721),s=r(7232),l=r.n(s),c=r(7585);n.A.i18n=n.A.i18n||o.A;var u=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(e,t){if("eu-ES"!==e||E.detectIE())return u.apply(this,arguments);var r=u.apply(this,arguments);return r=r.replace(/,/g,"."),Math.floor(this)===this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1")),r};var h={},d=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],p=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],g=function(e,t,r){return r<t.length-1?Object.prototype.hasOwnProperty.call(e,t[r])?g(e[t[r]],t,++r):null:e[t[r]]};const f=new WeakMap,m=new WeakMap,y={}.hasOwnProperty,v=new Map,A=e=>Math.floor(e)!==e&&e.toString().split(".")[1]?.length||0,S=new Set(["strokeColor","strokeWidth","fillColor","strokeOpacity","fillOpacity","url","radius","anchor","width","height","label","labelKey","labelOutlineWidth","labelOutlineColor","labelOffset","fontColor","fontSize"]);var E={getElevationGain:function(e={}){const t=e.coords;if(t&&t.length>0&&t[0].length>2){var r=0,n=0;const h=e.hillDeltaThreshold||0;for(var i,o,a,s=!0,l=0;l<t.length;l++){var c=t[l][2];if(null!==c){void 0===i&&(i=c,o=c,a=c),o=Math.min(o,c),a=Math.max(a,c);var u=c-i;u>h||u>0&&l===t.length-1?(s?r+=u:(n-=o-i,r+=c-o,s=!0),i=c,o=c,a=c):(u<-h||u<0&&l===t.length-1)&&(s?(r+=a-i,n-=c-a,s=!1):n-=u,i=c,o=c,a=c)}}return{upHill:Math.round(r),downHill:Math.round(n)}}return null},isPlainObject:function(e){return!("object"!=typeof e||e.nodeType||e.window===e||e.constructor&&!y.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isFunction:function(e){return"function"==typeof e},extend:function(){var e,t=arguments[0]||{},r=1,n=!1,i=!1;"boolean"==typeof t&&(n=t,t=arguments[r]??{},r++,"boolean"==typeof t&&(i=t,t=arguments[r]??{},r++)),"object"==typeof t||E.isFunction(t)||(t={});for(var o=arguments.length;r<o;r++){const o=arguments[r];if(null!=o)for(var a in o){const r=t[a],s=o[a];if(t===s)continue;const l=Array.isArray(s);n&&s&&(E.isPlainObject(s)||l)?(e=l?r&&Array.isArray(r)?r:[]:r&&E.isPlainObject(r)?r:{},t[a]=E.extend(n,i,e,s)):(i||void 0!==s)&&(t[a]=s)}}return t},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],r=t?e:e.replace(E.regex.PROTOCOL,"");let i;if(t){if(n.A.capabilities[r])return e}else for(i in n.A.capabilities)if(i.replace(E.regex.PROTOCOL,"")==r)return i;for(i in n.A.capabilities){var o=g(n.A.capabilities[i],d,0)||g(n.A.capabilities[i],p,0);if(o&&t&&e==o)return o;if(o&&e.replace(E.regex.PROTOCOL,"")==o.replace(E.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t,r,i=2!==arguments.length||arguments[1];return n.A.capabilities[e]?(t=n.A.capabilities[e],(r=g(t,d,0)||g(t,p,0))?i?r.split("?")[0]:r.split("?")[0].replace(E.regex.PROTOCOL,""):null):null},getFnFromString:function(e){for(var t=window,r=e.split("."),n=0;n<r.length-1;n++)if(null==(t=t[r[n]]))return;return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto):\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(i.A.url.SPLIT_REGEX);if(r){var n=window.location,o=r[1];t=(o==n.protocol||null==o)&&r[3]==n.hostname;var a=r[4],s=n.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(t=t&&a==s)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t,{maximumFractionDigits:Math.min(6,A(e))});if("string"===r){const r=parseFloat(e);if(r===new Number(e).valueOf())return r.toLocaleString(t,{maximumFractionDigits:Math.min(6,A(r))})}else if("undefined"===r)return"";return e},getTextFromCssVar:function(e,t=document.documentElement){const r=getComputedStyle(t).getPropertyValue(e),n=r.match(/\\([a-f0-9]{1,6})/i);return n?String.fromCharCode(parseInt(n[1],16)):r.replace(/['"]/g,"")},addProtocol:function(e){var t=e;return e&&0===e.indexOf("//")&&(t=location.protocol+e),t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:e&&"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getFeatureStyleFromCss:function(e){let t=null;if(e){const r=document.createElement("div");r.style.display="none",r.classList.add(e),document.body.appendChild(r);const n=window.getComputedStyle(r,null),i=/^url\(['"]?(.*?)['"]?\)$/gi.exec(n.backgroundImage);if(i?.length>1){t={url:i[i.length-1]};const e=/^(\d+)px(?: (\d+)px)?$/gi.exec(n.backgroundSize);e?.length>2&&(t.width=parseInt(e[1]),e[2]?t.height=parseInt(e[2]):t.height=t.width)}r.parentElement.removeChild(r)}return t},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url,/Firefox/.test(navigator.userAgent)&&"https:"===location.protocol&&r.startsWith("http:")&&(r=r.replace("http:","https:"));else{var i;if("string"==typeof t.cssClass)i=t.cssClass;else{var o=t.classes||n.A.Cfg.styles.marker.classes;if(i=o[0],t.group){if(!Object.prototype.hasOwnProperty.call(h,t.group)){let e=Object.keys(h).length;e%=o.length,h[t.group]=o[e]}i=h[t.group]}}r=E.getFeatureStyleFromCss(i)?.url}return r||t===n.A.Cfg.styles.point||""===t.cssClass||(r=e(n.A.Cfg.styles.point)),r},getLegendImageFromStyle:function(e,t={}){let r=null;if(e.url)r=e.url;else{let n=t.width||32,o=t.height||16;const a=e.strokeWidth||0,s=a/2,l=e.fillColor||"transparent",c=e.fillOpacity||1,u=2*(e.radius||0)+a,h=e.lineDash?`stroke-dasharray="${e.lineDash.join(" ")}" `:"";let d;switch(n=Math.max(n,u),o=Math.max(o,u),t.geometryType){case i.A.geom.POINT:d=`<circle cx="${n/2}" cy="${o/2}" r="${e.radius}" stroke="${e.strokeColor}" stroke-width="${a}" fill="${l}" fill-opacity="${c}" ${h}/>`;break;case i.A.geom.POLYLINE:d=`<polyline points="${s},${o-s} ${n-s},${s}" style="stroke:${e.strokeColor};stroke-width:${a}" ${h}/>`;break;case i.A.geom.POLYGON:d=`<polygon points="${s},${o-s} ${s},${s} ${s+.8*n},${s} ${n-s},${o-s}" style="stroke:${e.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${h}/>`;break;default:d=`<rect x="${s}" x="${s}" width="${n-a}" height="${o-a}" style="stroke:${e.strokeColor};stroke-width:${a};fill:${l};fill-opacity:${c}" ${h}/>`}r="data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}">${d}</svg>`)}return r},addArrayToTree:function e(t,r,n){var i=null,o=!1,a=t[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){if(o=!0,n===t.length-1)i=s;else{const r=e(t,s,n+1);r&&(i=r)}break}if(!o){s={name:a,title:a,uid:"/"+t.slice(0,n+1).join("/"),children:[]};i=e(t,s,n+1)||s,s.parent=r,r.children.push(s)}}return i},parseNumber:function(e,t){const r=new Intl.NumberFormat(t),n=r.formatToParts(12345.6),i=Array.from({length:10}).map(((e,t)=>r.format(t))),o=new Map(i.map(((e,t)=>[e,t]))),a=new RegExp(`[${n.find((e=>"group"===e.type)).value}]`,"g"),s=new RegExp(`[${n.find((e=>"decimal"===e.type)).value}]`),l=new RegExp(`[${i.join("")}]`,"g"),c=e.trim().replace(a,"").replace(s,".").replace(l,(e=>o.get(e)));return c?+c:Number.NaN},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=i.A.GEOGRAPHIC;var n=t.indexOf("°");if(r.value=parseFloat(t.substr(0,n)),(n=(t=t.substr(n+1)).indexOf("'"))>=0){var o=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=o:r.value-=o,(n=(t=t.substr(n+1)).indexOf("'"))>=0&&(o=parseFloat(t.substr(0,n).replace(",","."))/3600,r.value>=0?r.value+=o:r.value-=o)}return r},n=function(e){var t=e.trim();if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}return t=t.substr(0,t.length-1),r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:i.A.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};return t.match(/[SsWwOo]$/)&&(n.value=-n.value),n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:i.A.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^[-+]?\d{6,7}([.,]\d+)?$/g)?{type:i.A.UTM,value:parseFloat(t.replace(",","."))}:null},o=(e=e.trim().toUpperCase()).split(",");if(4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:1!==o.length&&3!==o.length||(o=e.split(" ")),2===o.length){var a=n(o[0]),s=n(o[1]);null!==a&&null!==s&&(t=[a,s])}return t},reproject:function(e,t,r){var i,o=!0,s=!0,l=!0;Array.isArray(e[0])?Array.isArray(e[0][0])?Array.isArray(e[0][0][0])||(l=!1,e=[e]):(s=!1,e=[[e]]):(o=!1,s=!1,l=!1,e=[[[e]]]);const c=function(e){let t;const r=a.A.defs[e];return r&&(t=(0,a.A)(r)),t||(n.A.loadProjDef({crs:e,sync:!0}),t=(0,a.A)(a.A.defs[e])),t};var u=c(t),h=c(r);return i=new Array(e.length),e.forEach((function(e,t){const r=i[t]=[];e.forEach((function(e,t){const n=r[t]=[];e.forEach((function(e,t){if(Array.isArray(e)&&e.length>1){var r=(0,a.A)(u,h,{x:e[0],y:e[1]});if(n[t]=[r.x,r.y],e.length>2)for(var i=2;i<e.length;i++)n[t][i]=e[i]}else n[t]=e}))}))})),o?s?l||(i=i[0]):i=i[0][0]:i=i[0][0][0],i},reprojectExtent:function([e,t,r,n],i,o){const a=10,s=(r-e)/a,l=(n-t)/a,c=[];let u,h;var d;for(u=e,d=0;d<a;d++)c.push([u,n]),u+=s;for(h=n,d=0;d<a;d++)c.push([r,h]),h-=l;for(u=r,d=0;d<a;d++)c.push([u,t]),u-=s;for(h=t,d=0;d<a;d++)c.push([e,h]),h+=l;const p=E.reproject(c,i,o),g=p.map((e=>e[0])),f=p.map((e=>e[1]));return[Math.min(...g),Math.min(...f),Math.max(...g),Math.max(...f)]},getMetersPerDegree:function(e){let t;if(Array.isArray(e)&&e.length>=4){const r=(e[1]+e[3])/2;t=6370997*Math.PI*Math.cos(this.degToRad(r))/180}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){const t=2*Math.PI;return(e%t+t)%t},getCRSCode:function(e){var t=null;if(e=e.trim(),/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var r=e.trim().match(/^.+[:#](\d{4,6})$/);r&&(t=r[1])}return t},toURNCRS:function(e){return e.replace(/^(?<epsg>EPSG):(?<code>\d{4,6})$/g,"urn:ogc:def:crs:$<epsg>::$<code>")},CRSCodesEqual:function(e,t){if(e===t)return!0;var r=this.getCRSCode(e),n=this.getCRSCode(t);return null!==r&&null!==n&&r===n},getLocaleString:function(e,t,r){var i=t;if(n.A.i18n&&n.A.i18n[e]){var o=n.A.i18n[e][t];if(o&&(i=o,r))for(var a in r)i=i.replace("{"+a+"}",r[a])}return i},getRenderedHtml:async function(e,t,r){const i=async function(e){let t=v.get(e);if(t)return t;{let t;v.set(e,!0);try{t=await n.A.ajax({url:n.A.apiLocation+`TC/templates/${e}.hbs`,method:"GET",responseType:"text"})}catch(e){throw console.log("Error fetching template: "+e.message),e}const r=t.data.match(/{{> ([a-zA-Z\-]+)(?:(?:\s[a-zA-Z]+)\s*)?}}/);return r&&await Promise.all(r.slice(1).map((e=>i(e.trim())))),function(e,t){const r=c.A.compile(t);return c.A.registerPartial(e,r),v.set(e,r),r}(e,t.data)}},o=function(e){const n=e(t);return E.isFunction(r)&&r(n),n};return E.isFunction(e)?o(e):o(await i(e))},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r)),t=e}return t},getMimeTypeFromUrl:function(e){let t=e.indexOf("?");switch(t>=0?e=e.substr(0,t):(t=e.indexOf("#"),t>=0&&(e=e.substr(0,t))),e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"kml":return i.A.mimeType.KML;case"kmz":return i.A.mimeType.KMZ;case"json":case"geojson":return i.A.mimeType.GEOJSON;case"gml":return i.A.mimeType.GML;case"gpx":return i.A.mimeType.GPX;case"gpkg":return i.A.mimeType.GEOPACKAGE;case"shp":case"dbf":case"prj":case"cst":case"cpg":return i.A.mimeType.SHAPEFILE;case"wkt":case"wkb":return"text/plain";case"zip":return i.A.mimeType.ZIP;default:return null}},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){var n=(t=e.substr(r)).indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var i=t.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];return delete i[""],i},getParamString:function(e){const t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var r=e.length;r;)e[r]=e[r-1],r--;e[0]=t},storage:{getCookie:function(e){return n.A.cookie(e)},setCookie:function(e,t,r){return n.A.cookie(e,t,r)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):E.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),E.storage.setCookie(e,"",{expires:r})}else E.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):E.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),E.storage.setCookie(e,"",{expires:r})}else E.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const e=matchMedia("(pointer:coarse)").matches,t=matchMedia("(pointer:fine)").matches;return!(!e||!t)||(e&&!t?(i="(hover: hover)",o=!n.A.browserFeatures.touch(),(r=window.matchMedia(i)).media===i&&(o=r.matches),!!o):!(e||!t)||!matchMedia("(pointer:none)").matches&&(!n.A.browserFeatures.touch()||void 0));var r,i,o},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return E.detectAndroid()||E.detectIOS()||E.detectMobileWindows()||E.detectBlackBerry()},getBrowser:function(){var e=(new(l())).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),i=e.getElementsByTagNameNS("*",n),o=0;o<i.length;o++)if(i[o].nodeName==t)return i},addURLParameters:function(e,t){if(!t)return e;let r,n=!1;try{r=new URL(e)}catch(t){t instanceof TypeError&&(n=!0,r=new URL(e,window.location.href))}for(var i in t){const e=t[i];r.searchParams.set(i,e)}const o=r.href;return n?o.substr(o.indexOf(r.host)+r.host.length):o},removeURLParameter:function(e,t){var r=e.split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",i=r[1].toLowerCase().split(/[&;]/g),o=i.length;o-- >0;)-1!==i[o].lastIndexOf(n,0)&&i.splice(o,1);return r[0]+"?"+i.join("&")}return e},showModal:function(e,t={}){e.hidden=!1,e.classList.add(i.A.classes.VISIBLE);const r=e.querySelectorAll(".tc-modal-close");if(r&&r.length>0)for(var n=0;n<r.length;n++){var o=m.get(r[n]);o?m.delete(r[n]):(o=function(e){return e.stopPropagation(),E.closeModal(t.closeCallback,e.target)},m.set(r[n],o)),m.set(r[n],o),r[n].addEventListener("click",o)}E.isFunction(t.openCallback)&&t.openCallback()},closeModal:function(e,t){const r=function(e){e.classList.remove(i.A.classes.VISIBLE)};var n;if(t){for(n=t;n&&!n.matches(".tc-modal");)n=n.parentElement;r(n)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),(function(e){r(e)}));e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t={}){const r=function(t){e.addEventListener("mousedown",t.start),e.addEventListener("touchstart",t.start,{passive:!0}),e.addEventListener("mouseup",t.end),e.addEventListener("touchend",t.end,{passive:!0})};if("disable"===t){const t=f.get(e);return void(t&&(e.removeEventListener("mousedown",t.start),e.removeEventListener("touchstart",t.start),e.removeEventListener("mouseup",t.end),e.removeEventListener("touchend",t.end)))}if("enable"===t){const t=f.get(e);return void(t&&r(t))}const n=t.minDistance||30,i=t.maxCrossDistance||30,o=t.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const c={start:function(r){(function(r){if(t.noSwipe)for(var n=r.target;n&&n!==e;){if(n.matches&&n.matches(t.noSwipe))return!1;n=n.parentNode}return!0})(r)&&(r="changedTouches"in r?r.changedTouches[0]:r,a.x=r.pageX,a.y=r.pageY,l=(new Date).getTime())},end:function(r){if(l){if(r="changedTouches"in r?r.changedTouches[0]:r,s.x=r.pageX,s.y=r.pageY,(new Date).getTime()-l<=o){const r=t[function(e,t){const r=t.x-e.x,o=t.y-e.y,a=Math.abs(r),s=Math.abs(o);return a>s&&a>n&&s<=i?r<0?"left":"right":s>a&&s>n&&a<=i?o<0?"up":"down":"none"}(a,s)];r&&r.call(e)}l=0}}};f.set(e,c),r(c)},getParameterByName:function(e){const t=new URLSearchParams(location.search),r=Array.from(t).find((([t,r])=>t.toLowerCase()===e.toLowerCase()));return r?r[1]:""},getLocaleUserChoice:function(e={}){var t="en-US",r=e.cookieName||"SITNA.language",n=e.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,o=E.getParameterByName(n)||E.storage.getCookie(r)||i,a=o.indexOf("-");a>=0&&(o=o.substr(0,a));var s=new Date((new Date).getTime()+31536e6);switch(E.storage.setCookie(r,o,{expires:s}),o){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[/\\?%*:|"<>]/g,"-")},getFormatFromFileExtension:function(e){switch(e){case".kml":return i.A.format.KML;case".kmz":return i.A.format.KMZ;case".gpx":return i.A.format.GPX;case".json":case".geojson":return i.A.format.GEOJSON;case".gml":return i.A.format.GML;case".wkt":return i.A.format.WKT;case".wkb":return i.A.format.WKB;case".topojson":return i.A.format.TOPOJSON;case".gpkg":return i.A.format.GEOPACKAGE;case".shp":return i.A.format.SHAPEFILE;default:return null}},getFileExtensionFromFormat:function(e){switch(e){case i.A.format.KML:return".kml";case i.A.format.KMZ:return".kmz";case i.A.format.GPX:return".gpx";case i.A.format.GEOJSON:return".geojson";case i.A.format.GML:return".gml";case i.A.format.WKT:return".wkt";case i.A.format.WKB:return".wkb";case i.A.format.TOPOJSON:return".topojson";case i.A.format.GEOPACKAGE:return".gpkg";case i.A.format.SHAPEFILE:return".shp";default:return null}},downloadBlob:function(e,t){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(t);r.setAttribute("href",n),r.setAttribute("download",E.getValidFilename(e)),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},downloadFile:function(e,t,r){var n=new Blob([r],{type:t});e=E.getValidFilename(e),navigator.msSaveBlob?navigator.msSaveBlob(n,e):E.downloadBlob(e,n)},downloadDataURI:function(e,t,r){for(var n=atob(r.split(",")[1]),i=[],o=0;o<n.length;o++)i.push(n.charCodeAt(o));var a=new Blob([new Uint8Array(i)],{type:t});e=E.getValidFilename(e),navigator.msSaveBlob?navigator.msSaveBlob(a,e):E.downloadBlob(e,a)},shortenUrl:function(e){return new Promise((function(t,r){n.A.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}}).then((function(e){t(e.data)})).catch((function(e){r(e)}))}))},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){return Array.isArray(e)&&(e=e.slice(0,3).reduce((function(e,t){const r=t.toString(16);return e+"00".substring(0,2-r.length)+r}),"#")),e},operation:function(e,t,r,n){for(var i=[],o=0;o<e.length;o++){for(var a=e[o],s=!1,l=0;l<t.length;l++)if(r(a,t[l])){s=!0;break}s===n&&i.push(a)}return i},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},n=r.type,i=r.encoderOptions,o=e.getContext("2d");if(!o)return"";var a=e.width,s=e.height,l=o.getImageData(0,0,a,s),c=o.globalCompositeOperation;t&&(o.globalCompositeOperation="destination-over",o.fillStyle=t,o.fillRect(0,0,a,s));var u=e.toDataURL(n,i);return t&&(o.clearRect(0,0,a,s),o.putImageData(l,0,0),o.globalCompositeOperation=c),u},imgToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t};return new Promise((function(i,o){if(!t)switch(e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"svg":t="image/svg+xml";break;case"png":t="image/png";break;case"gif":t="image/gif";break;default:t="image/jpeg"}var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var o,s=r(a);try{o=E.toDataUrl(s,"#ffffff",{type:t,encoderOptions:1}),i({dataUrl:o,canvas:s})}catch(t){a.src=n.A.proxify(e)}},a.onerror=function(s){var l=new XMLHttpRequest;l.open("GET",n.A.proxify(e),!0),l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.responseType="arraybuffer",l.onload=function(e){if(200===this.status){for(var n=new Uint8Array(this.response),o=n.length,s=new Array(o);o--;)s[o]=String.fromCharCode(n[o]);var c=s.join(""),u=l.getResponseHeader("content-type");0===u.indexOf("image")&&(a.src="data:"+u+";base64,"+window.btoa(c),a.onload=function(){const e=r(a),n=E.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});i({dataUrl:n,canvas:e})})}},l.onreadystatechange=function(){4===l.readyState&&200!==l.status&&o(Error("HTTP error "+l.status))},l.send()},a.src=e,(a.complete||void 0===a.complete)&&(a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a.src=e)}))},imgTagToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t}(e);try{return{base64:E.toDataUrl(r,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:r}}catch(e){return null}},addToCanvas:function(e,t,r,n){var i=E.cloneCanvas(e),o=i.getContext("2d");return new Promise((function(e,a){var s=new Image;s.crossOrigin="anonymous",s.src=t,s.onload=function(){n?o.drawImage(s,r.x||0,r.y||0,n.width,n.height):o.drawImage(s,r.x||0,r.y||0),e(i)}}))},cloneCanvas:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),t},mergeCanvases:function(e){const t=e.map((e=>e.parentElement?e.getBoundingClientRect():{top:0,left:0,bottom:e.height,right:e.width})),r=t.reduce((function(e,t){return[Math.min(e[0],t.left),Math.min(e[1],t.top),Math.max(e[2],t.right),Math.max(e[3],t.bottom)]}),[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]),n=r[0],i=r[1],o=document.createElement("canvas"),a=o.getContext("2d");return o.width=r[2]-n,o.height=r[3]-i,e.forEach((function(e,r){const o=t[r];a.drawImage(e,o.left-n,o.top-i,o.right-o.left,o.bottom-o.top)})),o},calculateAspectRatioFit:function(e,t,r,n){var i=Math.min(r/e,n/t);return{width:e*i,height:t*i}},getFormattedDate:function(e,t){function r(e){return e<10?"0"+e:e}var n=new Date(e);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(t?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceSpecialCharacters:function(e){var t=new Map([["ä","a"],["ö","o"],["ü","u"],["Ä","A"],["Ö","O"],["Ü","U"],["á","a"],["é","e"],["í","i"],["ó","o"],["ú","u"],["Á","A"],["É","E"],["Í","I"],["Ó","O"],["Ú","U"],["ñ","n"],["Ñ","N"],["ç","c"],["Ç","C"]]);return e.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑçÇ]/g,(function(e){return t.get(e)}))},downloadFileForm:async function(e,t){var r,o=async function(e,t){var r=await new Promise((function(r,n){const i=new XMLHttpRequest;i.responseType="blob",i.open("POST",e),i.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),i.onreadystatechange=function(t){if(4===i.readyState)if(200!==i.status)n({status:i.status,msg:i.statusText,url:e});else try{const e=i.getResponseHeader("Content-disposition");var o="";e&&(o=e.split("; ")[1].substring(9),"attachment"!==e.split("; ")[0]&&(o=o.substring(0,o.lastIndexOf("."))));const t=i.getResponseHeader("Content-type");r({data:i.response,contentType:t||("blob"===i.responseType?"application/zip":""),filename:o})}catch(e){n(e)}};try{i.send(t)}catch(e){n(e)}})),o="";if(r.data.type.indexOf("kml")>=0)o=".kml";else if(r.data.type.indexOf("json")>=0)o=".geojson";else if(r.data.type.indexOf("xml")>=0&&(o=".gml",/outputFormat="\S{1,}"/.exec(t)[0].includes(".kml")||/outputFormat="\S{1,}"/.exec(t)[0].includes("shape-zip")))throw{key:i.A.DownloadError.MIMETYPE_NOT_SUPORTED,url:e,data:t,format:/outputFormat="\S{1,}"/.exec(t)[0]};E.downloadFile((r.filename?r.filename:n.A.getUID())+o,r.contentType,r.data)};if(Array.isArray(e)){for(var a=e,s=0;s<a.length;s++)try{await o(a[s].url,a[s].data)}catch(e){r=e}if(r)throw r}else await o(e,t)},WFSQueryBuilder:function(e,t,r,i,o,a,s,l){const c=function(){return a?' srsName="'+a+'"':""},u=function(){if(!l)return"";var e="";switch(r.version){case"1.0.0":e="ogc:PropertyName";break;case"1.1.0":case"2.0.0":e="wfs:PropertyName"}return(l instanceof Array?l:[l]).reduce((function(t,r){return t+"<"+e+">"+r+"</"+e+">"}),"")};Array.isArray(e)||e instanceof Object||(e=[e]);let h,d="<wfs:GetFeature "+E.formatTemplate(w(r),{resultType:o?'resultType="hits"':"",format:'outputFormat="'+i+'"'})+("2.0.0"!==r.version&&s?' maxFeatures="'+s+'"':"")+">",p="";if(Array.isArray(e))h="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>",e.forEach((function(e){p+=E.formatTemplate(h,{typeName:e,filter:t&&t instanceof n.A.filter.Filter?t.getText(r.version):"",fields:u()})}));else for(var g in h="",e){h="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+c()+">{fields}{filter}</wfs:Query>";let t=e[g];p+=E.formatTemplate(h,{typeName:g,filter:t&&t instanceof n.A.filter.Filter?t.getText(r.version):"",fields:u()})}return d+=p+"</wfs:GetFeature>",d},WFGetPropertyValue:function(e,t,r,n){return E.WFSQueryBuilder([e],r,n,"JSON",!1,null,null,t)},WFSFilterBuilder:function(e,t,r){var i="";if(E.isPlainObject(e))i=E.formatTemplate('<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>',{prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case Array.isArray(e):var o=E.formatTemplate("<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>",{lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:i+="<ogc:Filter><ogc:BBOX>"+o+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:i+="<fes:Filter><fes:BBOX>"+o+"</fes:BBOX></fes:Filter>"}break;case e instanceof n.A.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:i+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+E.writeGMLGeometry(e,{version:"2.0",srsName:r})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:i+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+E.writeGMLGeometry(e,{version:"3.2",srsName:r})+"</fes:Intersects></fes:Filter>"}break;default:n.A.error("Geometría no válida")}return i},writeGMLGeometry:function(e,t={}){const r=t.version,i=function(){return t.srsName?' srsName="'+t.srsName+'"':""};var o=function(e){var t;if(0===r.indexOf("3"))for(t=e.toString();t.indexOf(",")>=0;)t=t.replace(","," ");else t=e.map((function(e){return e.join(",")})).join(" ");return t};switch(r){case"3.1.1":break;case"3.2":return!0===(n.A.feature.Polyline&&e instanceof n.A.feature.Polyline)?'<gml:LineString srsDimension="2"'+i()+"><gml:posList>"+o(e.geometry)+"</gml:posList></gml:LineString>":'<gml:Polygon srsDimension="2"'+i()+"><gml:exterior><gml:LinearRing><gml:posList>"+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>";default:return!0===(n.A.feature.Polyline&&e instanceof n.A.feature.Polyline)?"<gml:LineString"+i()+"><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>":"<gml:Polygon"+i()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(i.A.url.SPLIT_REGEX);if(n){var o=n[1];r=(o==t.protocol||null==o)&&n[3]==t.hostname;var a=n[4],s=t.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(r=r&&a==s)}return r},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var i=t.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},consoleRegister:function(e){n.A.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,r){return t[e]>r[e]?1:t[e]<r[e]?-1:0}},getSoundexDifference:function(e,t){for(var r=0,n=0;n<e.length;n++)e.charAt(n)===t.charAt(n)&&r++;return r},toAbsolutePath:function(e){var t=document.createElement("a");return t.href=e,t.href},explodeGeometry:function(e){const t=e.origin,r=function(e,n,i){Array.isArray(e)?e.forEach(r):(0===n&&(i[0]=e+t[0]),1===n&&(i[1]=e+t[1]))};return e.geom.forEach(r),e.geom},cloneMappingFunction:function(e){return Array.isArray(e)?e.map(E.cloneMappingFunction):e},isGeometry:function(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"gml:LineStringPropertyType":case"gml:MultiLineStringPropertyType":case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"gml:BoxPropertyType":case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:MultiCurvePropertyType":case"gml:CurvePropertyType":case"gml:AbstractGeometryType":return!0;default:return!1}},compactGeometry:function(e,t){const r=[Number.MAX_VALUE,Number.MAX_VALUE],n=e.map(E.cloneMappingFunction),i=function(e,t){Array.isArray(e)?e.forEach(i):0===t&&e<r[0]?r[0]=e:1===t&&e<r[1]&&(r[1]=e)};n.forEach(i);const o=function(e){return Math.round(e*t)/t};r[0]=o(r[0]),r[1]=o(r[1]);const a=function(e,t,n){Array.isArray(e)?e.forEach(a):(0===t&&(n[0]=o(e-r[0])),1===t&&(n[1]=o(e-r[1])))};return n.forEach(a),{origin:r,geom:n}},isStyleOption:function(e){return S.has(e)},hasStyleOptions:function(e){for(let t of S.values())if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1},mergeStyles(){const e=Array.from(arguments);return e.some((e=>E.isFunction(e)))?function(t){return Object.assign({},...e.map((e=>E.isFunction(e)?e(t):e)))}:Object.assign({},...e)},formatCoord:function(e,t){return e.toLocaleString(E.getLocaleUserChoice(),{maximumFractionDigits:t})},formatTemplate:function(e,t){var r=e.toString();if(!t)return r;for(var n in t)r=r.replace(RegExp("\\{"+n+"\\}","gi"),t[n]);return r},formatIndexedTemplate:function(e,...t){const r=t.length?t:[""];return e.replace(/{(\d+)}/g,(function(e,t){return void 0!==r[t]?r[t]:e}))},getWebWorkerCrossOriginURL:function(e){return new Promise((function(t,r){Object.prototype.hasOwnProperty.call(window,"Worker")?E.isSameOrigin(e)?t(e):n.A.ajax({url:e,method:"GET",responseType:"text"}).then((function(e){const r=e.data;var n=new Blob([r],{type:"text/javascript"}),i=window.URL.createObjectURL(n);t(i)}),(function(e){r(Error(e))})):r(new Error("No support for service workers"))}))},createSemaphore:function(e=1){let t=0,r=[];return{acquire:function(){return t<e?(t++,Promise.resolve()):new Promise(((e,t)=>{r.push({resolve:e,reject:t})}))},release:function(){return t--,r.length>0&&t<e&&(t++,r.shift().resolve()),r.length},purge:function(){let e=r.length;for(let t=0;t<e;t++)r[t].reject("Task has been purged.");return t=0,r=[],e}}},getPromiseFromEvent:function(e,t,r={}){return new Promise((function(n,i){E.isFunction(r.resolvedPredicate)&&r.resolvedPredicate.call(e)?n():e.addEventListener(t,(function o(a){E.isFunction(r.rejectPredicate)&&r.rejectPredicate.call(this,a)&&(e.removeEventListener(t,o),i(a)),E.isFunction(r.resolvePredicate)?r.resolvePredicate.call(this,a)&&(e.removeEventListener(t,o),n(a)):(e.removeEventListener(t,o),n(a))}))}))},getTimedPromise:function(e,t){return new Promise(((r,n)=>{setTimeout((async()=>{if(e)try{await e()}catch(e){n(e)}r()}),t)}))},patternFn:function(e){return(e=(e=(e=(e=(e=(e=e.replace(/[^a-z\dáéíóúüñ]/gi,(e=>"\\"+e))).replace(/(a|á)/gi,"(a|á)")).replace(/(e|é)/gi,"(e|é)")).replace(/(i|í)/gi,"(i|í)")).replace(/(o|ó)/gi,"(o|ó)")).replace(/(u|ú|ü)/gi,"(u|ú|ü)")).replace(/n/gi,"(n|ñ)")},fontSupported:function(e){var t,r=document.body,n=document.createElement("span");n.innerHTML=Array(100).join("wi"),n.style.cssText=["position:absolute","width:auto","font-size:128px","left:-99999px"].join(" !important;");var i=function(e){return n.style.fontFamily=e,r.appendChild(n),t=n.clientWidth,r.removeChild(n),t},o=i("monospace"),a=i("serif"),s=i("sans-serif");return o!==i(e+",monospace")||s!==i(e+",sans-serif")||a!==i(e+",serif")},htmlToText:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent}};const w=function(e){var t='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"  service="WFS" {resultType} {format} ';switch(e.version){case"1.0.0":case"1.1.0":t+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":t+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var r in e)"string"==typeof e[r]&&r.indexOf("gml")<0&&e[r].indexOf("wfs")<0&&(t+=r+'="'+e[r]+'" ');return t};var _=function(e,t,r){return r(e.getBoundingClientRect(),t.getBoundingClientRect())};window.HTMLElement&&(HTMLElement.prototype.colliding=function(e){return _(this,e,(function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)}))},HTMLElement.prototype.containing=function(e){_(this,e,(function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)}))},HTMLElement.prototype.inside=function(e){return _(this,e,(function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right}))});class L{static getDataURL(e,t){return e.toDataURL(t)}static getBlobPromise(e,t){return new Promise((r=>e.toBlob((e=>r(e)),t)))}}n.A.Util=E;const C=E},3327:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(8038);class i extends HTMLElement{static#xt=new Map;constructor(){super(),this.attachShadow({mode:"open"});const e=i.#xt.get(this.elementName);if(e){const t=document.createElement("style");t.textContent=e,this.shadowRoot.appendChild(t)}else{const e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.href=`${i.#Pt()}${this.elementName}.css`,this.shadowRoot.appendChild(e)}}get elementName(){return"sitna-component"}createTemplate(){const e=`for-${this.tagName.toLowerCase()}`;let t=document.querySelector(`template[id="${e}"]`);return!t&&(t=document.createElement("template"),t.setAttribute("id",e),t.innerHTML="<slot></slot>",document.body.appendChild(t),!0)}getTemplate(){return document.querySelector(`template[id="for-${this.tagName.toLowerCase()}"]`)}static#Pt(){return`${n.A.apiLocation}css/ui/`}static async preloadStyle(e){const t=await n.A.ajax({url:`${i.#Pt()}${e}.css`});i.#xt.set(e,t.data)}}const o=i},3333:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(8038),i=r(797),o=r(3301),a=r(187),s=r(1845),l=r(7018),c=r(1651),u=r(8606),h=r(6257),d=r(6546),p=r(1667),g=(r(1092),r(3791)),f=r(5777);n.A.control=n.A.control||{},i.A.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc",i.A.event.FEATUREMODIFY="featuremodify.tc",i.A.event.FEATURESSELECT="featuresselect.tc",i.A.event.FEATURESUNSELECT="featuresunselect.tc",i.A.event.CHANGE="change";const m=function(e){var t=!1;return(e instanceof p.A||e instanceof h.A)&&e.geometry.length>1&&(t=!0),t},y=function(e){return e instanceof d.A||e instanceof u.A||e instanceof p.A||e instanceof h.A},v="sitna-modify";class A{constructor(){this.select="",this.deleteSelectedFeatures="",this.deleteVertices="",this["joinGeometries.tooltip"]="",this.joinGeometries="",this.splitGeometry="",this.addText="",this.writeTextForFeature="",this.textColor="",this.fontSize=""}}class S extends s.default{#t=".tc-ctl-mod";#Mt;#It;#Rt;#Ot;#Dt;#Nt;#kt;#Ft;#Gt;#Bt;#Ut;#qt;static mode={SELECT:"select",VERTEX_DELETE:"vertex_delete"};constructor(){super(...arguments);const e=this;e.wrap=new n.A.wrap.control.Modify(e),e.initProperty("mode").initProperty("snapping").initProperty("stylable"),e.model=new A}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;"stylable"===e&&this.#Wt(),"mode"===e&&this.#h()}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}get mode(){return this.hasAttribute("mode")?this.getAttribute("mode"):S.mode.SELECT}set mode(e){this.setAttribute("mode",e||S.mode.SELECT)}async#h(){const e=this;await e.renderPromise(),e.#Ht(e.getSelectedFeatures())}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}#Wt(){const e=this;e.#jt()?.classList.toggle(i.A.classes.HIDDEN,!(e.stylable&&e.getSelectedFeatures().length))}#jt(){return this.querySelector(`.${this.CLASS}-style`)}#Vt(e){const t=this;t.#Mt.disabled=0===e.length,t.#Rt.disabled=!e.some(y),t.#Ot.disabled=e.length<2,t.#Dt.disabled=!e.some(m),t.displayLabelText(),t.#Wt(),t.getStyler().then((t=>t.setFeature(e[0])))}#Ht(e){const t=this;t.#Rt.disabled=!e.some(y);const r=t.mode;t.#Rt.active=r===S.mode.VERTEX_DELETE,t.#It.active=t.isActive&&r!==S.mode.VERTEX_DELETE}register(e){const t=this;t.styles=o.A.extend(!0,{},a.A.styles.selection,e.options.styles?.selection,t.options.styles),t.styles.snapping=o.A.extend(!0,{},a.A.styles.snapping,e.options.styles?.snapping,t.options.styles?.snapping),t.styles.text=t.styles.text||{fontSize:t.styles.line.fontSize,fontColor:t.styles.line.fontColor,labelOutlineColor:t.styles.line.labelOutlineColor,labelOutlineWidth:t.styles.line.labelOutlineWidth};const r=super.register.call(t,e);return t.options.layer&&t.setLayer(t.options.layer),e.on(i.A.event.FEATUREADD+" "+i.A.event.FEATURESADD,(function(e){Promise.all([t.getLayer(),t.renderPromise()]).then((function(r){const n=r[0];e.layer===n&&t.setSelectableState(!0)}))})).on(i.A.event.FEATUREREMOVE+" "+i.A.event.FEATURESCLEAR,(function(e){const r=e.layer,n=e.feature;Promise.all([t.getLayer(),t.renderPromise()]).then((function(e){r===e[0]&&(n?t.unselectFeatures([n]):t.unselectFeatures(),t.#Vt(t.getSelectedFeatures()),0===r.features.length&&(t.setSelectableState(!1),t.setTextMode(!1)))}))})).on(i.A.event.LAYERUPDATE,(function(e){const r=e.layer;Promise.all([t.getLayer(),t.renderPromise()]).then((function(e){r===e[0]&&t.#Vt(t.getSelectedFeatures())}))})),t.on(i.A.event.FEATURESSELECT+" "+i.A.event.FEATURESUNSELECT,(function(){const e=t.getSelectedFeatures();t.#Vt(e),t.layer.features.filter((function(t){return e.indexOf(t)<0})).forEach((function(e){e.toggleSelectedStyle(!1)})),e.forEach((function(e){e.toggleSelectedStyle(!0)}))})),r}async loadTemplates(){const e=r.e(6237).then(r.bind(r,6237)),t={};t[this.CLASS]=(await e).default,this.template=t}async render(e){const t=this,r=t.styles||{};await t.renderData({stylable:t.stylable,fontSize:r.text?.fontSize,fontColor:r.text?.fontColor,labelOutlineColor:r.text?.labelOutlineColor,labelOutlineWidth:r.text?.labelOutlineWidth},(function(){t.#It=t.querySelector("."+t.CLASS+"-btn-select"),t.#Mt=t.querySelector("."+t.CLASS+"-btn-delete"),t.#Rt=t.querySelector("."+t.CLASS+"-btn-del-vertex"),t.#Nt=t.querySelector("."+t.CLASS+"-btn-text"),t.#Ot=t.querySelector("."+t.CLASS+"-btn-join"),t.#Dt=t.querySelector("."+t.CLASS+"-btn-split"),t.#kt=t.querySelector("input."+t.CLASS+"-txt"),t.#Gt=t.querySelector("."+t.CLASS+"-style-label"),t.#Ft=t.querySelector(t.#t+"-fnt-c"),t.#Ut=t.querySelector("."+t.CLASS+"-fnt-s"),t.addUIEventListeners(),o.A.isFunction(e)&&e(),t.controller=new f.A(t.model,new g.A(t)),t.updateModel()}))}addUIEventListeners(){const e=this;e.#It.addEventListener(i.A.event.CLICK,(function(t){t.target.disabled||(e.isActive?e.mode!==S.mode.VERTEX_DELETE?e.deactivate():e.setMode(S.mode.SELECT,!0):e.activate())}),{passive:!0}),e.#Mt.addEventListener(i.A.event.CLICK,(function(){e.deleteSelectedFeatures()}),{passive:!0}),e.#Rt.addEventListener(i.A.event.CLICK,(function(){const t=e.mode===S.mode.VERTEX_DELETE?S.mode.SELECT:S.mode.VERTEX_DELETE;e.setMode(t,!0)}),{passive:!0}),e.#Nt.addEventListener(i.A.event.CLICK,(function(){e.setTextMode(!e.textActive)}),{passive:!0}),e.#kt.addEventListener("input",(function(t){e.labelFeatures(t.target.value)})),e.#Ft.addEventListener(i.A.event.CHANGE,(function(t){e.setFontColor(t.target.value)})),e.#Ut.addEventListener(i.A.event.CHANGE,(function(t){e.setFontSize(t.target.value)})),e.getStyler().then((t=>t.addEventListener(i.A.event.STYLECHANGE,(t=>{e.getSelectedFeatures().forEach((e=>{const r={};r[t.detail.property]=t.detail.value;const n=Object.assign({},e.getStyle(),r);e.setStyle(n)}))}))))}activate(){const e=this;e.#It.active=!0,super.activate.call(e),e.wrap.activate(e.mode),e.#Ht(e.getSelectedFeatures())}deactivate(){const e=this;super.deactivate.call(e),e.#It&&e.#Vt([]),e.#It&&(e.#It.active=!1,e.layer&&e.unselectFeatures(e.getSelectedFeatures())),e.wrap&&e.wrap.deactivate(),e.mode=S.mode.SELECT}clear(){const e=this;return e.layer&&e.layer.clearFatures(),e}isExclusive(){return!0}end(){return this.wrap.end(),this}setMode(e,t){const r=this;return e&&(r.mode=e),t&&e?(r.layer&&r.layer.map.putLayerOnTop(r.layer),r.activate()):r.deactivate(),r}getLayer(){var e=this;return e.options&&"boolean"==typeof e.options.layer&&!e.options.layer?Promise.resolve(null):e.layer?Promise.resolve(e.layer):e.#qt}setLayer(e){const t=this;t.map&&(t.setSelectedFeatures([]),t.#qt=new Promise((function(r,n){"string"==typeof e?t.map.loaded((function(){t.layer=t.map.getLayer(e),r(t.layer)})):(!e&&t.isActive&&t.deactivate(),t.layer=e,r(t.layer))})),Promise.all([t.#qt,t.renderPromise()]).then((function(e){const r=e[0];t.setSelectableState(r&&r.features.length>0)})))}setSelectableState(e){this.#It.disabled=!e,this.setLabelableState(e)}setLabelableState(e){this.#Nt.disabled=!e}getSelectedFeatures(){return this.wrap.getSelectedFeatures()}setSelectedFeatures(e){const t=this.wrap.setSelectedFeatures(e);return this.displayLabelText(),t}getActiveFeatures(){const e=this.getSelectedFeatures();if(!e.length){if(this.map?.activeControl?.getSketch){const t=this.map.activeControl.getSketch();t&&e.push(t)}!e.length&&this.layer?.features.length&&e.push(this.layer.features[this.layer?.features.length-1])}return e}unselectFeatures(e){return e=e||[],this.wrap.unselectFeatures(e.map((function(e){return e.wrap.feature}))),this}deleteSelectedFeatures(){const e=this,t=e.getSelectedFeatures();return e.wrap.unselectFeatures(t),t.forEach((function(t){e.layer.removeFeature(t),e.trigger(i.A.event.FEATUREREMOVE,{feature:t})})),e}styleFunction(e,t){var r;const n=this.map.options.styles.selection;switch(!0){case e instanceof d.A:case e instanceof p.A:r=o.A.extend({},n.polygon);break;case e instanceof l.A:case e instanceof c.A:r=o.A.extend({},n.point);break;default:r=o.A.extend({},n.line)}const i=e.getStyle();return i.label&&(r.label=i.label,r.fontSize=i.fontSize,r.fontColor=i.fontColor,r.labelOutlineColor=i.labelOutlineColor,r.labelOutlineWidth=i.labelOutlineWidth),r}setTextMode(e){const t=this;return t.textActive=e,e?(t.#Nt.active=!0,t.#Gt.classList.remove(i.A.classes.HIDDEN)):(t.#Nt.active=!1,t.#Gt.classList.add(i.A.classes.HIDDEN)),t.displayLabelText(),t}setFontColorWatch(e,t){const r=this;return void 0===e&&(e=r.styles.text.fontColor),e=o.A.colorArrayToString(e),t=t||r.getLabelOutlineColor(e),r.renderPromise().then((function(){r.#Ft.value=e,r.#kt.style.color=e,r.#kt.style.textShadow="0 0 "+r.styles.text.labelOutlineWidth+"px "+t,n.A.browserFeatures.inputTypeColor()||(r.#Ft.style.backgroundColor=e,r.#Ft.blur())})),r}setFontColor(e){const t=this;return t.styles.text.fontColor=e,t.styles.text.labelOutlineColor=t.getLabelOutlineColor(e),t.setFontColorWatch(e,t.styles.text.labelOutlineColor),t.getActiveFeatures().forEach((function(r){const n=r.getStyle();n.fontColor=e,n.labelOutlineColor=t.styles.text.labelOutlineColor,r.setStyle(n)})),t}setFontSizeWatch(e){const t=this;void 0===e&&(e=t.styles.text.fontSize);const r=parseInt(e);return Number.isNaN(r)||t.renderPromise().then((function(){t.#Ut.value=r,t.#kt.style.fontSize=r+"pt"})),t}setFontSize(e){const t=this,r=parseInt(e);return Number.isNaN(r)||(t.styles.text.fontSize=r,t.setFontSizeWatch(r),t.getActiveFeatures().forEach((function(e){const t=e.getStyle();t.fontSize=r,t.font&&(t.font=t.font.replace(/^\d+/,r)),e.setStyle(t)}))),t}getLabelOutlineColor(e){if(e){const t=(e=o.A.colorArrayToString(e)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const r=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(r&&r.length)return(parseInt(r[1],16)+parseInt(r[2],16)+parseInt(r[3],16))/3<128?"#ffffff":"#000000"}return"#ffffff"}displayLabelText(){const e=this,t=e.getActiveFeatures();var r,n,i;if(t.length){const e=t[t.length-1].getStyle();r=e.label,i=e.fontColor,n=e.fontSize}else r="",i=e.styles.text.fontColor,n=e.styles.text.fontSize;return e.renderPromise().then((function(){e.setFontSizeWatch(n).setFontColorWatch(i).#kt.value=r||""})),e}labelFeatures(e){const t=this,r=t.getActiveFeatures();if(r.length){const n=r[0].getStyle();r.forEach((function(r){const i=o.A.extend({},t.styles.text,n);n.label=e,n.labelOffset=i.labelOffset,n.fontColor=i.fontColor,n.fontSize=i.fontSize,n.labelOutlineColor=i.labelOutlineColor,n.labelOutlineWidth=i.labelOutlineWidth,r.setStyle(n)}))}return t}async getStyler(){const e=this;return await e.renderPromise(),e.#Bt=e.querySelector("sitna-feature-styler"),e.#Bt}joinFeatures(e){const t=this;if(t.geometryType===i.A.geom.MULTIPOLYLINE||t.geometryType===i.A.geom.MULTIPOLYGON||t.geometryType===i.A.geom.MULTIPOINT){let s;if(t._joinedFeatureAttributes=[],e.length>1){var r=e.map((function(e){return t._joinedFeatureAttributes.push(e.getData()),e.geometry})).reduce((function(e,t){return e.concat(t)}));s=new e[0].constructor(r);for(var n=0,o=e.length;n<o;n++){var a=e[n];t.layer.removeFeature(a),t.trigger(i.A.event.FEATUREREMOVE,{feature:a})}t.layer.addFeature(s).then((function(e){t.setSelectedFeatures([s]),t.trigger(i.A.event.FEATUREADD,{feature:e}),e.showPopup(t.attributeEditor)}))}t.#Vt([s])}}updateModel(){this.model.select=this.getLocaleString("select"),this.model.deleteSelectedFeatures=this.getLocaleString("deleteSelectedFeatures"),this.model.deleteVertices=this.getLocaleString("deleteVertices"),this.model["joinGeometries.tooltip"]=this.getLocaleString("joinGeometries.tooltip"),this.model.joinGeometries=this.getLocaleString("joinGeometries"),this.model.splitGeometry=this.getLocaleString("splitGeometry"),this.model.addText=this.getLocaleString("addText"),this.model.writeTextForFeature=this.getLocaleString("writeTextForFeature"),this.model.textColor=this.getLocaleString("textColor"),this.model.fontSize=this.getLocaleString("fontSize")}async updateLanguage(){this.updateModel()}}S.prototype.CLASS="tc-ctl-mod",customElements.get(v)||customElements.define(v,S),n.A.control.Modify=S;const E=S},3343:(e,t,r)=>{"use strict";r.r(t),r.d(t,{circle:()=>o,line:()=>n,polygon:()=>i,square:()=>a,triangle:()=>s});const n='<line x1="{x1}" y1="{y1}" x2="{x2}" y2="{y2}" {style} shape-rendering="crispEdges" >Sorry, your browser does not support inline SVG.</line>',i='<polygon points="0,0 {width},0 {width},{height} 0,{height} 0,0" {style} >Sorry, your browser does not support inline SVG.</polygon>',o='<circle cx="{x}" cy="{y}" r="{radius}" {style} >Sorry, your browser does not support inline SVG.</circle>',a='<rect  x="{x}" y="{y}" width="{width}" height="{height}" {style} {transform}>Sorry, your browser does not support inline SVG.</rect >',s='<polygon points="{points}" {style} >Sorry, your browser does not support inline SVG.</polygon>'},3365:(e,t,r)=>{"use strict";r.d(t,{A:()=>d});var n=r(8038),i=r(797),o=r(3301),a=r(3790),s=r.n(a),l=r(8991);const c=new Blob([String.raw`
/**
 * @author: Tobias Nickel
 * @created: 06.04.2015
 * I needed a small xmlparser chat can be used in a worker.
 */

/**
 * parseXML / html into a DOM Object. with no validation and some failur tolerance
 * @params S {string} your XML to parse
 * @param options {object} all other options:
 * searchId {string} the id of a single element, that should be returned. using this will increase the speed rapidly
 * filter {function} filter method, as you know it from Array.filter. but is goes throw the DOM.
 * simplify {bool} to use tXml.simplify.
 */


function tXml(S, options) {
    "use strict";
    options = options || {};

    var pos = 0;

    var openBracket = "<";
    var openBracketCC = "<".charCodeAt(0);
    var closeBracket = ">";
    var closeBracketCC = ">".charCodeAt(0);
    //var minus = "-";
    var minusCC = "-".charCodeAt(0);
    //var slash = "/";
    var slashCC = "/".charCodeAt(0);
    //var exclamation = '!';
    var exclamationCC = '!'.charCodeAt(0);
    //var singleQuote = "'";
    var singleQuoteCC = "'".charCodeAt(0);
    //var doubleQuote = '"';
    var doubleQuoteCC = '"'.charCodeAt(0);
    //var openSquareBracket = "[";
    var openSquareBracketCC = "[".charCodeAt(0);
    //var closeSquareBracket = "]";
    var closeSquareBracketCC = "]".charCodeAt(0);

    /**
     * parsing a list of entries
     */

    function parseChildren() {
        var children = [];
        while (S[pos]) {
            if (S.charCodeAt(pos) == openBracketCC) {
                if (S.charCodeAt(pos + 1) === slashCC) {
                    pos = S.indexOf(closeBracket, pos);
                    return children;
                } else if (S.charCodeAt(pos + 1) === exclamationCC) {
                    var char2 = S.charCodeAt(pos + 2);
                    if (char2 == openSquareBracketCC) {
                        // cdata support
                    }
                    else {
                        if (char2 == minusCC) {
                            //comment support
                            while (pos !== -1 && !(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) == minusCC && S.charCodeAt(pos - 2) == minusCC && pos != -1)) {
                                pos = S.indexOf(closeBracket, pos + 1);
                            }
                            if (pos === -1)
                                pos = S.length
                        } else {
                            // doctypesupport
                            pos += 2;
                            while (S.charCodeAt(pos) !== closeBracketCC) {
                                pos++;
                            }
                        }
                        pos++;
                        continue;
                    }
                }
                var node = parseNode();
                children.push(node);
            } else {
                var text = parseText()
                if (text.trim().length > 0)
                    children.push(text);
            }
            pos++;
        }
        return children;
    }

    /**
     *    returns the text outside of texts until the first '<'
     */

    function parseText() {
        var start = pos;
        pos = S.indexOf(openBracket, pos) - 1;
        if (pos === -2)
            pos = S.length;
        return S.slice(start, pos + 1);
    }
    /**
     *    returns text until the first nonAlphebetic letter
     */
    var nameSpacer = '\n\t>/= ';

    function parseName() {
        var start = pos;
        var c = S[pos];
        while (nameSpacer.indexOf(c) === -1) {
            c = S[++pos];
            // flacunza: Ignoramos los prefijos
            if (c === ':') {
                pos++;
                start = pos;
            }
        }
        return S.slice(start, pos);
    }
    /**
     *    is parsing a node, including tagName, Attributes and its children,
     * to parse children it uses the parseChildren again, that makes the parsing recursive
     */
    var NoChildNodes = ['img', 'br', 'input', 'meta', 'link'];

    function parseNode() {
        var node = {};
        pos++;
        if (S.charCodeAt(pos) === exclamationCC && S.charCodeAt(pos + 1) === openSquareBracketCC) {
            // parse cdata
            var start = pos + 8;
            while (!(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) === closeSquareBracketCC && S.charCodeAt(pos - 2) === closeSquareBracketCC)) {
                pos++;
            }
            return S.slice(start, pos - 2);
        }

        node.tagName = parseName();

        // parsing attributes
        var attrFound = false;
        let name;
        while (S.charCodeAt(pos) !== closeBracketCC) {
            var c = S.charCodeAt(pos);
            if ((c > 64 && c < 91) || (c > 96 && c < 123)) {
                //if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(S[pos])!==-1 ){
                name = parseName();
                // search beginning of the string
                var code = S.charCodeAt(pos);
                while (code !== singleQuoteCC && code !== doubleQuoteCC && !((code > 64 && code < 91) || (code > 96 && code < 123)) && code !== closeBracketCC) {
                    pos++;
                    code = S.charCodeAt(pos);
                }
                if (!attrFound) {
                    node.attributes = {};
                    attrFound = true;
                }
                let value;
                if (code === singleQuoteCC || code === doubleQuoteCC) {
                    value = parseString();
                } else {
                    value = null;
                    pos--;
                }
                node.attributes[name] = value;
            }
            pos++;

        }
        // optional parsing of children
        if (S.charCodeAt(pos - 1) !== slashCC) {
            if (node.tagName == "script") {
                const start = pos + 1;
                pos = S.indexOf('</script>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 8;
            } else if (node.tagName == "style") {
                const start = pos + 1;
                pos = S.indexOf('</style>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 7;
            } else if (NoChildNodes.indexOf(node.tagName) == -1) {
                pos++;
                node.children = parseChildren(name);
            }
        }
        return node;
    }

    /**
     *    is parsing a string, that starts with a char and with the same usually  ' or "
     */

    function parseString() {
        var startChar = S[pos];
        var startpos = ++pos;
        pos = S.indexOf(startChar, startpos)
        return S.slice(startpos, pos);
    }

    /**
     *
     */

    function findElements() {
        var r = new RegExp('\\s' + options.attrName + '\\s*=[\'"]' + options.attrValue + '[\'"]').exec(S)
        if (r) {
            return r.index;
        } else {
            return -1;
        }
    }

    var out = null;
    if (options.attrValue !== undefined) {
        options.attrName = options.attrName || 'id';
        out = [];

        while ((pos = findElements()) !== -1) {
            pos = S.lastIndexOf('<', pos);
            if (pos !== -1) {
                out.push(parseNode());
            }
            S = S.substr(pos);
            pos = 0;
        }
    } else {
        out = parseChildren();
    }

    if (options.filter) {
        out = tXml.filter(out, options.filter);
    }

    if (options.simplify) {
        out = tXml.simplify(out);
    }
    return out;
}
/**
 * transform the DomObject to an object that is like the object of PHPs simplexmp_load_*() methods.
 * this format helps you to write that is more likely to keep your programm working, even if there a small changes in the XML schema.
 * be aware, that it is not possible to reproduce the original xml from a simplified version, because the order of elements is not saved.
 * therefore your programm will be more flexible and easyer to read.
 *
 * @param {array} the childrenList
 */
tXml.simplify = function simplify(children) {
    var out = {};
    if (!children || !children.length) {
        return '';
    }

    if (children.length === 1 && typeof children[0] == 'string') {
        return children[0];
    }
    // map each object
    children.forEach(function (child) {
        if (typeof child !== 'object') {
            return;
        }
        if (!out[child.tagName])
            out[child.tagName] = [];
        var kids = tXml.simplify(child.children);
        out[child.tagName].push(kids);
        if (child.attributes) {
            kids._attributes = child.attributes;
        }
    });

    for (var i in out) {
        if (out[i].length == 1) {
            out[i] = out[i][0];
        }
    }

    return out;
};

/**
 * behaves the same way as Array.filter, if the filter method return true, the element is in the resultList
 * @params children{Array} the children of a node
 * @param f{function} the filter method
 */
tXml.filter = function (children, f) {
    var out = [];
    children.forEach(function (child) {
        if (typeof (child) === 'object' && f(child)) out.push(child);
        if (child.children) {
            var kids = tXml.filter(child.children, f);
            out = out.concat(kids);
        }
    });
    return out;
};

/**
 * stringify a previously parsed string object.
 * this is useful,
 *  1. to remove whitespaces
 * 2. to recreate xml data, with some changed data.
 * @param O{tXMLDomObject} the object to Stringify
 */
tXml.stringify = function TOMObjToXML(O) {
    var out = '';

    function writeChildren(O) {
        if (O)
            for (var i = 0; i < O.length; i++) {
                if (typeof O[i] == 'string') {
                    out += O[i].trim();
                } else {
                    writeNode(O[i]);
                }
            }
    }

    function writeNode(N) {
        out += "<" + N.tagName;
        for (var i in N.attributes) {
            if (N.attributes[i] === null) {
                out += ' ' + i;
            } else if (N.attributes[i].indexOf('"') === -1) {
                out += ' ' + i + '="' + N.attributes[i].trim() + '"';
            } else {
                out += ' ' + i + "='" + N.attributes[i].trim() + "'";
            }
        }
        out += '>';
        writeChildren(N.children);
        out += '</' + N.tagName + '>';
    }
    writeChildren(O);

    return out;
};


/**
 * use this method to read the textcontent, of some node.
 * It is great if you have mixed content like:
 * this text has some <b>big</b> text and a <a href=''>link</a>
 */
tXml.toContentString = function (tDom) {
    if (Array.isArray(tDom)) {
        var out = '';
        tDom.forEach(function (e) {
            out += ' ' + tXml.toContentString(e);
            out = out.trim();
        });
        return out;
    } else if (typeof tDom === 'object') {
        return tXml.toContentString(tDom.children)
    } else {
        return ' ' + tDom;
    }
};

tXml.getElementById = function (S, id, simplified) {
    var out = tXml(S, {
        attrValue: id,
        simplify: simplified
    });
    return simplified ? out : out[0];
};
/**
 * A fast parsing method, that not realy finds by classname,
 * more: the class attribute contains XXX
 * @param
 */
tXml.getElementsByClassName = function (S, classname, simplified) {
    return tXml(S, {
        attrName: 'class',
        attrValue: '[a-zA-Z0-9\-\s ]*' + classname + '[a-zA-Z0-9\-\s ]*',
        simplify: simplified
    });
};

if ('object' === typeof module) {
    module.exports = tXml;
}

//console.clear();
//console.log('here:',tXml.getElementById('<some><xml id="test">dada</xml><that id="test">value</that></some>','test'));
//console.log('here:',tXml.getElementsByClassName('<some><xml id="test" class="sdf test jsalf">dada</xml><that id="test">value</that></some>','test'));

/*
console.clear();
tXml(d,'content');
 //some testCode
var s = document.body.innerHTML.toLowerCase();
var start = new Date().getTime();
var o = tXml(s,'content');
var end = new Date().getTime();
//console.log(JSON.stringify(o,undefined,'\t'));
console.log("MILLISECONDS",end-start);
var nodeCount=document.querySelectorAll('*').length;
console.log('node count',nodeCount);
console.log("speed:",(1000/(end-start))*nodeCount,'Nodes / second')
//console.log(JSON.stringify(tXml('<html><head><title>testPage</title></head><body><h1>TestPage</h1><p>this is a <b>test</b>page</p></body></html>'),undefined,'\t'));
var p = new DOMParser();
var s2='<body>'+s+'</body>'
var start2= new Date().getTime();
var o2 = p.parseFromString(s2,'text/html').querySelector('#content')
var end2=new Date().getTime();
console.log("MILLISECONDS",end2-start2);
// */


(function () {

    var simplify = function simplify(children, attributes) {
        var out = {};
        if ((!children || !children.length) && !attributes) {
            return '';
        }
        children = children || [];

        if (children.length === 1 && typeof children[0] == 'string') {
            return children[0];
        }
        // map each object
        children.forEach(function (child) {
            if (typeof child !== 'object') {
                return;
            }
            var prefixIdx = child.tagName.indexOf('ows:');
            var tagName = prefixIdx < 0 ? child.tagName : child.tagName.substr(prefixIdx + 4);
            if (!out[tagName])
                out[tagName] = [];
            var kids = simplify(child.children, child.attributes);
            out[tagName].push(kids);
            if (child.attributes) {
                for (var key in child.attributes) {
                    kids[key] = child.attributes[key];
                }
            }
        });

        for (var i in out) {
            if (out[i].length == 1) {
                out[i] = out[i][0];
            }
        }

        return out;
    };

    var flattenOnlineResource = function (olr) {
        return olr.href;
    };

    var flattenLayerUrls = function (layer, tag) {
        if (Object.prototype.hasOwnProperty.call(layer, tag)) {
            var tagObj = layer[tag];
            var urls = tagObj.length ? tagObj : [tagObj];
            for (var i = 0, len = urls.length; i < len; i++) {
                var url = urls[i];
                url.OnlineResource = flattenOnlineResource(url.OnlineResource);
            }
            layer[tag] = urls;
        }
    };

    var processDCPType = function (node) {
        if (node) {
            var dcpts = node.DCPType.length ? node.DCPType : [node.DCPType];
            for (var i = 0, len = dcpts.length; i < len; i++) {
                var dcpt = dcpts[i];
                for (var protocol in dcpt) {
                    var dcptp = dcpt[protocol];
                    for (var verb in dcptp) {
                        var dcptpv = dcptp[verb];
                        dcptpv.OnlineResource = flattenOnlineResource(dcptpv.OnlineResource);
                    }
                }
            }
            node.DCPType = dcpts;
        }
    };

    var booleanValues = [false, true];
    var processWMSLayer = function processWMSLayer(layer, crsList) {
        // Transformamos booleanos
        if (Object.prototype.hasOwnProperty.call(layer, 'queryable')) {
            layer.queryable = booleanValues[layer.queryable];
        }
        var bbox;
        // Convertimos EX_GeographicBoundingBox a array
        if (Object.prototype.hasOwnProperty.call(layer, 'EX_GeographicBoundingBox')) {
            bbox = layer.EX_GeographicBoundingBox;
            layer.EX_GeographicBoundingBox = [
                parseFloat(bbox.westBoundLongitude),
                parseFloat(bbox.southBoundLatitude),
                parseFloat(bbox.eastBoundLongitude),
                parseFloat(bbox.northBoundLatitude)
            ]
        }
        // Convertimos BoundingBox a array
        if (Object.prototype.hasOwnProperty.call(layer, 'BoundingBox')) {
            bbox = layer.BoundingBox;
            bbox = layer.BoundingBox.length ? layer.BoundingBox : [layer.BoundingBox];
            layer.BoundingBox = bbox.map(function (elm) {
                return {
                    crs: elm.CRS || elm.SRS,
                    extent: [
                        parseFloat(elm.minx),
                        parseFloat(elm.miny),
                        parseFloat(elm.maxx),
                        parseFloat(elm.maxy)
                    ],
                    res: new Array(2)
                }
            });
        }
        // Convertimos OnlineResource a string
        if (Object.prototype.hasOwnProperty.call(layer, 'Attribution') && layer.Attribution.OnlineResource) {
            layer.Attribution.OnlineResource = flattenOnlineResource(layer.Attribution.OnlineResource);
        }
        flattenLayerUrls(layer, 'AuthorityURL');
        flattenLayerUrls(layer, 'MetadataURL');
        // Convertimos Style a array
        if (layer.Style) {
            if (!layer.Style.length) {
                layer.Style = [layer.Style];
            }
            // Convertimos OnlineResource a string
            for (var i = 0, len = layer.Style.length; i < len; i++) {
                flattenLayerUrls(layer.Style[i], 'LegendURL');
            }
        }
        // Hacemos heredar la lista de CRS
        var newCrsList = typeof layer.CRS === 'string' ? [layer.CRS] : layer.CRS;
        if (crsList) {
            if (layer.CRS) {
                layer.CRS = newCrsList.concat(crsList);
            }
        }
        if (layer.Layer) {
            var children = layer.Layer[1] ? layer.Layer : [layer.Layer];
            layer.Layer = children;
            for (const child of children) {
                child.parent = layer;
                processWMSLayer(child, newCrsList);
            }
        }
    };

    var cornerSeparator = ' ';
    var parseCorner = function (cornerString) {
        return cornerString.split(cornerSeparator).map(function (elm) {
            return parseFloat(elm);
        });
    };

    var processWMTSLayers = function (contents) {
        if (!contents.Layer.length) {
            contents.Layer = [contents.Layer];
        }
        var layers = contents.Layer;
        for (var i = 0, len = layers.length; i < len; i++) {
            var layer = layers[i];
            if (typeof layer.Format === 'string') {
                layer.Format = [layer.Format];
            }
            if (layer.ResourceURL && !layer.ResourceURL.length) {
                layer.ResourceURL = [layer.ResourceURL];
            }
            if (layer.Style && !Array.isArray(layer.Style)) {
                layer.Style = [layer.Style];
            }
            if (!layer.TileMatrixSetLink.length) {
                layer.TileMatrixSetLink = [layer.TileMatrixSetLink];
            }
            for (var j = 0, lenj = layer.TileMatrixSetLink.length; j < lenj; j++) {
                var tmsl = layer.TileMatrixSetLink[j];
                if (tmsl.TileMatrixSetLimits) {
                    tmsl.TileMatrixSetLimits = tmsl.TileMatrixSetLimits.TileMatrixLimits;
                    for (var k = 0, lenk = tmsl.TileMatrixSetLimits.length; k < lenk; k++) {
                        var tmslm = tmsl.TileMatrixSetLimits[k];
                        tmslm.MaxTileCol = parseInt(tmslm.MaxTileCol);
                        tmslm.MaxTileRow = parseInt(tmslm.MaxTileRow);
                        tmslm.MinTileCol = parseInt(tmslm.MinTileCol);
                        tmslm.MinTileRow = parseInt(tmslm.MinTileRow);
                    }
                }
            }
            if (layer.WGS84BoundingBox) {
                var lowerCorner = parseCorner(layer.WGS84BoundingBox.LowerCorner);
                var upperCorner = parseCorner(layer.WGS84BoundingBox.UpperCorner);
                layer.WGS84BoundingBox = [
                    lowerCorner[0],
                    lowerCorner[1],
                    upperCorner[0],
                    upperCorner[1]
                ];
            }
        }
    };

    var processTMS = function (contents) {
        if (!contents.TileMatrixSet.length) {
            contents.TileMatrixSet = [contents.TileMatrixSet];
        }
        var tileMatrixSets = contents.TileMatrixSet;
        tileMatrixSets.forEach(function (tileMatrixSet) {
            tileMatrixSet.SupportedCRS = tileMatrixSet.SupportedCRS.trim();
            if (tileMatrixSet.BoundingBox) {
                var lowerCorner = parseCorner(tileMatrixSet.BoundingBox.LowerCorner);
                var upperCorner = parseCorner(tileMatrixSet.BoundingBox.UpperCorner);
                tileMatrixSet.BoundingBox = [
                    lowerCorner[0],
                    lowerCorner[1],
                    upperCorner[0],
                    upperCorner[1]
                ];
            }
            tileMatrixSet.TileMatrix.forEach(function (tileMatrix) {
                tileMatrix.MatrixHeight = parseInt(tileMatrix.MatrixHeight);
                tileMatrix.MatrixWidth = parseInt(tileMatrix.MatrixWidth);
                tileMatrix.TileHeight = parseInt(tileMatrix.TileHeight);
                tileMatrix.TileWidth = parseInt(tileMatrix.TileWidth);
                tileMatrix.ScaleDenominator = parseFloat(tileMatrix.ScaleDenominator);
                tileMatrix.TopLeftCorner = parseCorner(tileMatrix.TopLeftCorner);
            });
        });
    };

    var processDCPVerb = function (dcpVerb) {
        var verbs = dcpVerb.length ? dcpVerb : [dcpVerb];
        var result = new Array(verbs.length);
        for (var i = 0, len = verbs.length; i < len; i++) {
            var verb = verbs[i];
            if (!verb.Constraint.length) {
                verb.Constraint = [verb.Constraint];
                for (var j = 0, lenj = verb.Constraint.length; j < lenj; j++) {
                    var allowedValues = verb.Constraint[j].AllowedValues;
                    if (typeof allowedValues.Value === 'string') {
                        allowedValues.Value = [allowedValues.Value];
                    }
                }
            }
            result[i] = {
                Constraint: verb.Constraint,
                href: verb.href
            };
        }
        return result;
    };

    var processOM = function (om) {
        var operations = om.Operation.length ? om.Operation : [om.Operation];
        for (var i = 0, len = operations.length; i < len; i++) {
            var operation = operations[i];
            for (var protocol in operation.DCP) {
                var protocolProp = operation.DCP[protocol];
                for (var verb in protocolProp) {
                    protocolProp[verb] = processDCPVerb(protocolProp[verb]);
                }
            }
            om[operation.name] = {
                DCP: operation.DCP
            }
        }
        delete om.Operation;
    };

    var wfsParser = function () {
        var keys = ["name", "Name"],
            parameters = ["Parameter", "Constraint"],
            a2o = function (a) {
                return a.reduce(function (result, item, index) {
                    if (keys.some(k => { return Object.prototype.hasOwnProperty.call(item, k); })) {
                        var key = keys.find(k => { return Object.prototype.hasOwnProperty.call(item, k); });
                        var objName = (item[key].substring(item[key].indexOf(":") + 1));
                        delete item[key];
                        result[objName] = Object.prototype.hasOwnProperty.call(item, "AllowedValues") && item.AllowedValues.Value || item
                        return result;
                    }
                    else {
                        return (index === 0 ? [] : result).concat(item);
                    }
                }, {});
            },
            pp = function (p) {
                var o = {};
                if (p instanceof Array) {
                    o = a2o(p);
                }
                else {
                    o = Object.prototype.hasOwnProperty.call(p, "AllowedValues") &&
                        p.AllowedValues.Value && keys.find(k => { return Object.prototype.hasOwnProperty.call(p, k) }) &&
                        (o[p[keys.find(k => { return Object.prototype.hasOwnProperty.call(p, k) })]] = p.AllowedValues.Value) && o || p
                }
                return o;

            },
            e = {
                V1_0_0: "1.0.0",
                V1_1_0: "1.1.0",
                V2_0_0: "2.0.0"
            },
            r = function () {
                var r, n = [],
                    u = [],
                    p = [],
                    capabilites = arguments[0];
                switch (capabilites.version) {
                    case e.V1_0_0:
                        r = e.V1_0_0;
                        break;
                    case e.V1_1_0:
                        r = e.V1_1_0;
                        break;
                    case e.V2_0_0:
                        r = e.V2_0_0
                }
                n = t(capabilites, r), u = a(capabilites, r), p = i(capabilites, r);
                var o = s(capabilites, r),
                    l = {
                        Operations: n,
                        FeatureTypes: u,
                        Filters: p
                    };
                return Object.assign(l, o), l
            },
            t = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        var a = r.Capability.Request;
                        if (a.GetFeature) {
                            var i = [];
                            for (var s in a.GetFeature.ResultFormat) i.push(s.toLowerCase());
                            a.GetFeature.outputFormat = i, delete a.GetFeature.ResultFormat, a.GetFeature.Operations = r.FeatureTypeList.Operations
                        }
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var n = {};
                        for (var s in r.OperationsMetadata) {
                            var u = {};
                            if (!(r.OperationsMetadata[s] instanceof Array)) continue;
                            u[s] = a2o(r.OperationsMetadata[s]);
                            for (var p in u[s]) {
                                u[s][p] = ((o) => {
                                    var r = {};
                                    if (o instanceof Array)
                                        return a2o(o);
                                    for (var k in o) {
                                        if (parameters.find((i) => { return k === i })) {
                                            r = Object.assign(r, pp(o[parameters.find((i) => { return k === i })]));
                                        }
                                        else
                                            r[k] = o[k];
                                    } return r;
                                })(u[s][p]);
                            }
                            n = Object.assign(n, u[s]);
                        }
                        return n
                }
                return null
            },
            a = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        r.FeatureTypeList.FeatureType = (r.FeatureTypeList.FeatureType instanceof Array) ? r.FeatureTypeList.FeatureType : [r.FeatureTypeList.FeatureType];
                        for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) {
                            var s = r.FeatureTypeList.FeatureType[i].Name;
                            a[s.substring(s.indexOf(":") + 1)] = r.FeatureTypeList.FeatureType[i]
                        }
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        r.FeatureTypeList.FeatureType = (r.FeatureTypeList.FeatureType instanceof Array) ? r.FeatureTypeList.FeatureType : [r.FeatureTypeList.FeatureType];
                        for (var a = {}, i = 0; i < r.FeatureTypeList.FeatureType.length; i++) {
                            var s = r.FeatureTypeList.FeatureType[i].Name;
                            a[s.substring(s.indexOf(":") + 1)] = r.FeatureTypeList.FeatureType[i]
                        }
                        return a
                }
                return null
            },
            i = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        return r.Filter_Capabilities;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var a = r.Filter_Capabilities;
                        return a
                }
                return null
            },
            s = function (r, t) {
                switch (t) {
                    case e.V1_0_0:
                        var a = {};
                        for (var i in r) "string" == typeof r[i] && (a[i] = r[i]);
                        return a;
                    case e.V1_1_0:
                        return {};
                    case e.V2_0_0:
                        var a = {};
                        for (var i in r) "string" == typeof r[i] && (a[i] = r[i]);
                        return a
                }
                return {}
            }
        return {
            Parse: r
        }
    }();

    var postprocessWMS = function (xml) {
        var capabilities = xml.WMS_Capabilities || (xml['?xml'] && (xml['?xml'].WMS_Capabilities || xml['?xml'].WMT_MS_Capabilities));
        if (capabilities) {
            processWMSLayer(capabilities.Capability.Layer);
            var request = capabilities.Capability.Request;
            processDCPType(request.GetMap);
            if (request.GetFeatureInfo) {
                request.GetFeatureInfo.Format = typeof request.GetFeatureInfo.Format === 'string' ? [request.GetFeatureInfo.Format] : request.GetFeatureInfo.Format;
            }
        }
        return capabilities;
    };

    var postprocessWMTS = function (xml) {
        var capabilities = xml['?xml'] && xml['?xml'].Capabilities;
        if (capabilities) {
            processWMTSLayers(capabilities.Contents);
            processTMS(capabilities.Contents);
            processOM(capabilities.OperationsMetadata);
        }
        return capabilities;
    };
    var postprocessWFS = function (xml) {
        var capabilities = xml.WFS_Capabilities || (xml['?xml'] && (xml['?xml'].WFS_Capabilities));
        if (capabilities) {
            capabilities = wfsParser.Parse(capabilities);
            //añadir prefijo a los atributos simples y pue empiecen por http
            for (var attr in capabilities) {
                if (typeof (capabilities[attr]) === "string" && capabilities[attr].indexOf("http") === 0) {
                    capabilities["xmlns:" + attr] = capabilities[attr];
                    delete capabilities[attr];
                }
            }
            delete capabilities.updateSequence;
        }
        return capabilities;
    };

    onmessage = function (e) {

        //if (e.data.url)
        //    this.importScripts(e.data.url + 'TC/workers/tXml.js');
        //else
        //    this.importScripts('tXml.js');
        var xml = simplify(tXml(e.data.text));
        var capabilities;
        switch (e.data.type) {
            case "WMS":
                capabilities = postprocessWMS(xml);
                break;
            case "WMTS":
                capabilities = postprocessWMTS(xml);
                break;
            case "WFS":
                capabilities = postprocessWFS(xml);
                break;
        }
        postMessage({
            state: capabilities ? 'success' : 'error',
            capabilities: capabilities
        });
    };

})();
`],{type:"text/javascript; charset=utf-8"}),u=Object.prototype.hasOwnProperty.call(window,"Worker"),h=function(e){const t=document.createElement("a");if(t.href=e,!t.origin){if(!t.protocol||!t.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);if(t.protocol=r[1],r[4].indexOf(":")>-1){var n=r[4].split(":");t.hostname=n[0],t.port=n[1]}else t.hostname=r[4]}t.origin=0===t.protocol.length?window.location.protocol:t.protocol+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t},d=class{id;map;type;url;capabilities=null;tree=null;wrap=null;#zt="TC.capabilities.";#Yt;#$t;static state={IDLE:"idle",LOADING:"loading"};constructor(e={}){const t=this;this.options=e,o.A.extend(t,t.options),t.id=t.options.id||n.A.getUID(),t.type=t.options.type||i.A.layerType.WMS;const r=t.options.isBase?i.A.mimeType.JPEG:i.A.mimeType.PNG;t.format=t.options.format||r,Object.prototype.hasOwnProperty.call(t.options,"hideTree")||(t.hideTree=!0),Object.prototype.hasOwnProperty.call(t.options,"hideTitle")||(t.hideTitle=!1),t.proxificationTool=new l.default(n.A.proxify)}setVisibility(e){return this.wrap.setVisibility(e),this}getVisibility(){const e=this;return!(!e.map||e.isBase&&e.map.getBaseLayer()!==e)&&e.wrap.getVisibility()}getOpacity(){const e=this;return!e.map||e.isBase&&e.map.getBaseLayer()!==e?1:e.wrap.layer.getOpacity()}async setOpacity(e,t){const r=this;await r.wrap.setOpacity(e),r.opacity=e,r.map&&!t&&r.map.trigger(i.A.event.LAYEROPACITY,{layer:r,opacity:e})}isCompatible(e){return!0}isValidFromNames(){return!0}isRaster(){switch(this.type){case i.A.layerType.VECTOR:case i.A.layerType.KML:case i.A.layerType.WFS:case i.A.layerType.GROUP:return!1;default:return!0}}isVisibleByScale(){return!0}isVisibleByName(e){return!0}getTree(){return{name:this.name,title:this.title}}findNode(e,t){const r=this;let n=null;if(t.uid==e)n=t;else for(var i=0;i<t.children.length;i++){const o=r.findNode(e,t.children[i]);if(o){n=o;break}}return n}setNodeVisibility(e,t){const r=this,n=r.getTree(!0),o=r.findNode(e,n);if(!r.isRoot(o)){const e=function(t,r){t.visibilityState=r,t.children&&t.children.forEach((t=>e(t,r)))};if(t){e(o,i.A.visibility.VISIBLE);let t=o.parent;do{t.visibilityState!==i.A.visibility.VISIBLE&&(t.visibilityState=i.A.visibility.HAS_VISIBLE),t=t.parent}while(t)}else{e(o,i.A.visibility.NOT_VISIBLE);let t=o.parent;do{t.visibilityState===i.A.visibility.HAS_VISIBLE&&t.children.every((e=>e.visibilityState===i.A.visibility.NOT_VISIBLE))&&(t.visibilityState=i.A.visibility.NOT_VISIBLE),t=t.parent}while(t)}}return o}isRoot(e){const t=this.tree||this.getTree(!0);return e.uid===t.uid}getNodeVisibility(e,t){const r=this;let n=t||r.tree;n||(n=r.getTree(!0));const i=r.findNode(e,n);return i?i.visibilityState:i}getResolutions(){return this.wrap.getResolutions?this.wrap.getResolutions():[]}setProjection(){}clone(){const e=this,t=o.A.extend(!0,{},e.options,{id:e.id+"_clone"});return new e.constructor(t)}getBySSL_(e){return e.replace(/^(f|ht)tp?:\/\//i,"https://")}clip(e){this.wrap.clip(e)}stroke(e,t){this.wrap.stroke(e,t)}#Kt(e){const t=this;let r;if(e.documentElement){const n=e.getElementsByTagName("ServiceException")[0];if(n)r={error:n.textContent};else{var a=t.type===i.A.layerType.WMTS?new t.wrap.WmtsParser:new t.wrap.WmsParser;if(r=a.read(e),t.type===i.A.layerType.WMTS&&r.Contents&&r.Contents.Layer){const t=e.getElementsByTagName("Layer");for(var s=0,l=t.length;s<l;s++){const e=t[s];var h=o.A.getElementByNodeName(e,"ows:Identifier")[0].firstChild.data,d=r.Contents.Layer.filter((function(e){return e.Identifier==h}));if(d.length){d=d[0];for(var p=0;p<d.TileMatrixSetLink.length;p++){var g=d.TileMatrixSetLink[p];let t=g.TileMatrixSet;var f;const r=e.getElementsByTagName("TileMatrixSetLink");for(var m=0,y=r.length;m<y;m++){const e=r[m];if(e.querySelector("TileMatrixSet:first").textContent==t){f=e;break}}f&&(g.TileMatrixSetLimits=[],Array.from(f.getElementsByTagName("TileMatrixLimits")).forEach((e=>{g.TileMatrixSetLimits.push({TileMatrix:e.getElementsByTagName("TileMatrix")[0].textContent,MinTileRow:parseInt(e.getElementsByTagName("MinTileRow")[0].textContent),MinTileCol:parseInt(e.getElementsByTagName("MinTileCol")[0].textContent),MaxTileRow:parseInt(e.getElementsByTagName("MaxTileRow")[0].textContent),MaxTileCol:parseInt(e.getElementsByTagName("MaxTileCol")[0].textContent)})})))}}}}}return t.#Xt(r),Promise.resolve(r)}return new Promise((function(i,o){if(u&&"string"==typeof e){const s=URL.createObjectURL(c);var a=new Worker(s);a.onmessage=function(e){"success"===e.data.state?(r=e.data.capabilities,t.#Xt(r)):(r={error:"Web worker error: "+t.url},o(r.error)),i(r),a.terminate()},a.postMessage({type:t.type,text:e,url:n.A.apiLocation.indexOf("http")>=0?n.A.apiLocation:document.location.protocol+n.A.apiLocation})}else r=e,i(r)}))}#Zt(e){return"No se pudo obtener el documento de capacidades del servicio "+this.url+": ["+e+"]"}getCapabilitiesOnline(){const e=this;return e.#Yt=e.#Yt||new Promise((function(t,r){const n=e.getGetCapabilitiesUrl();e.proxificationTool.fetch(n,{retryAttempts:2}).then((function(n){e.#Kt(n.responseText).then((function(n){n.error?r(Error(e.#Zt(n.error))):t(n)})).catch((function(t){delete e._onlineCapabilitesPromise,r(Error(t))}))})).catch((function(t){delete e._onlineCapabilitesPromise,r(Error(e.#Zt(t)))}))}))}async getCapabilitiesFromStorage(){const e=this,t=h(e.url),r=await s().getItem(e.#zt+e.type+"."+t.href);if(r)return r;throw Error("Capabilities not in storage: "+t.href)}#Xt(e){const t=this,r=h(t.options.url);var n=t.#zt+t.type+"."+r.href,i=function(){Object.prototype.hasOwnProperty.call(e,"error")||t.getCapabilitiesPromise().then((function(){s().setItem(n,e).catch((e=>console.warn(e)))}))};t.map?t.map.loaded(i):i()}getGetMapUrl(){return function(e){var t=e;if(e){var r=e.match(/\??SERVICE=\w+&/i);r&&(t=t.replace(r[0],""))}return t}(this.wrap.getGetMapUrl())}getMetadata(){return this.#$t}setMetadata(e,t={}){t.replace?this.#$t=e:this.#$t={...this.#$t,...e}}}},3387:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(8038),i=r(797),o=r(3301),a=r(1421),s=r(6631),l=r(6546),c=r(3791),u=r(5777);n.A.control=n.A.control||{},n.A.filter=s.A;const h=function(e){let t=e.toFixed(20);return t.indexOf(".")>=0&&(t=t.replace(/0+$/,"").replace(/\.$/,"")),t};class d{constructor(){this.download="",this["dl.export.map"]="",this["dl.export.vector"]="",this.format="",this.createQrCodeToImage="",this.appendQRCode="",this["appendWorldFile.explanation"]="",this.appendWorldFile="",this.copyImageFromCurrentMap="",this.copyClipboard="",this.downloadImageFromCurrentMap="",this.qrAdvice="",this.showDownloadHelp="",this.downloadLayersFromCurrentExtent="",this.tooManyFeatures="",this["tooManyFeatures.instructions"]="",this.noLayersLoaded="",this["noLayersLoaded.instructions"]="",this.tooManySelectedLayers="",this["tooManySelectedLayers.instructions"]="",this.noData="",this["noData.instructions"]="",this.noValidService="",this["noValidService.instructions"]="",this.formatImageTitle="",this.formatVectorTitle=""}}class p{constructor(){this.downloadData="",this["dl.instructions.1"]="",this["dl.instructions.2"]="",this["dl.instructions.3"]="",this["dl.instructions.4"]="",this["dl.instructions.5"]="",this["dl.instructions.6"]="",this.close=""}}class g extends a.default{#Jt;constructor(e={}){super(...arguments);const t=this;t._dialogDiv=o.A.getDiv(e.dialogDiv),e.dialogDiv||document.body.appendChild(t._dialogDiv),t.model=new d,t.dialogModel=new p}async loadTemplates(){const e=this,t=r.e(2443).then(r.bind(r,2443)),n=r.e(2396).then(r.bind(r,2396)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(e){const t=this;await super.renderData.call(t,{controlId:t.id,deselectableTabs:t.options.deselectableTabs,clipboard:!!navigator?.clipboard?.write},(function(){const r=t.div.querySelector(".tc-ctl-tctr-select sitna-tab:first-of-type");r&&r.attributes.for&&(t.#Jt=document.getElementById(r.attributes.for.value)),t.addUIEventListeners(),o.A.isFunction(e)&&e(),t.controller=new u.A(t.model,new c.A(t.div)),t.updateModel()})),t._dialogDiv.innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog"),t.dialogController=new u.A(t.dialogModel,new c.A(t._dialogDiv))}addUIEventListeners(){const e=this;e.div.querySelectorAll(".tc-ctl-tctr-select sitna-tab").forEach((function(t){t.callback=function(){const t=this.target;t&&(e.#Jt=t)}})),e.div.querySelector("."+e.CLASS+"-image select").addEventListener("change",(function(t){e.div.querySelector(".tc-ctl-clipboard-btn").disabled=!ClipboardItem.supports(t.target.value)}))}async register(e){const t=this;return await super.register.call(t,e),t.map.crossOrigin="anonymous",t.div.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(".tc-ctl-download-btn",(()=>t.#Qt())),{passive:!0}),t.div.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(".tc-ctl-download-help",(e=>t.#er(e))),{passive:!0}),t.div.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector(".tc-ctl-clipboard-btn",(()=>t.#tr())),{passive:!0}),t.div.addEventListener("change",n.A.EventTarget.listenerBySelector(`.${t.CLASS}-image-qr`,(function(e){e.target.checked?t.generateLink():t.div.querySelector("."+t.CLASS+"-alert").classList.add(i.A.classes.HIDDEN)}))),t.div.addEventListener("click",n.A.EventTarget.listenerBySelector("h2",(function(e){t.registeredListeners||t.generateLink(),t.registerListeners()}))),t}async#rr(e){const t=this,a=t.map.getLoadingIndicator(),s=a&&a.addWait(),l=!t.#Jt.querySelector(`.${t.CLASS}-image-qr[disabled]`)&&t.#Jt.querySelector(`.${t.CLASS}-image-qr[checked]`),c=window.location.hostname+"_"+t.map.crs.replace(":","")+"_"+o.A.getFormattedDate((new Date).toString(),!0),u="."+e.split("/")[1];if(t.#Jt.querySelector(`.${t.CLASS}-image-wld[checked]`)&&!t.map.on3DView){const d=e===i.A.mimeType.JPEG?".jgw":".pgw",p=await t.generateImage(e,!0,l),g=t.map.getExtent();r.e(1710).then(r.t.bind(r,1710,23)).then((async e=>{const r=e.default;var i=t.map.wrap.getCanvas(),l=i.length>1?o.A.mergeCanvases(i):i[0];const f=(g[2]-g[0])/l.width,m=(g[1]-g[3])/l.height,y=g[0],v=g[3],A=new r;A.file(c+u,p),A.file(c+d,`${h(f)}\n${(0).toFixed(1)}\n${(0).toFixed(1)}\n${h(m)}\n${h(y)}\n${h(v)}`),A.generateAsync({type:"blob"}).then((function(e){o.A.downloadBlob(c+".zip",e),a&&a.removeWait(s)}),(function(e){n.A.error(t.getLocaleString("dl.export.map.error")+": "+e.message),a&&a.removeWait(s)}))}))}else{try{const r=await t.generateImage(e,!1,l);o.A.downloadDataURI(c+u,e,r)}catch(e){n.A.error(t.getLocaleString("dl.export.map.error")+": "+e.message)}a&&a.removeWait(s)}}#nr(e){this.map?.wait((async()=>{const t=this.map.extractFeatures({filter:(()=>this.map.on3DView?new s.A.Within(null,new l.A(this.map.view3D.getFovCoords(this.map.view3D.crs)),this.map.view3D.crs):new s.A.bbox(this.map.getExtent(),this.map.getCRS()))(),outputFormat:e,download:!0}),r=await Promise.all(t);var n=r.filter((e=>!!e));if(0!==n.length){for(var a=[],c=0;c<n.length;c++)if(n[c].errors&&n[c].errors.length)for(var u=0;u<n[c].errors.length;u++){var h=n[c].errors[u];this.#Ye(h)}else{var d=n[c].data,p=n[c].url;d&&p&&a.push({url:p+"?download=zip",data:d})}try{await o.A.downloadFileForm(a)}catch(t){if(t.key===i.A.DownloadError.MIMETYPE_NOT_SUPORTED){const n=r.find((e=>e.data===t.data)).service,a={plural:n.layers.length>1?this.getLocaleString("dl.format.notSupported.plural"):"",layerNames:n.layers.reduce(((e,t,r,n)=>(e instanceof Array?e:[e]).concat([t.title]).join(r<n.length-1?", ":" "+this.getLocaleString("dl.format.notSupported.conjunction")+" ")),[]),serviceTitle:n.mapLayers[0].title,format:e};this.map.toast(o.A.formatTemplate(this.getLocaleString("dl.format.notSupported"),a),{type:i.A.msgType.ERROR})}}}else this.#Ye({key:i.A.WFSErrors.NO_LAYERS})}))}async#tr(){const e=this,t=e.map.getLoadingIndicator(),r=t&&t.addWait(),o=this.#Jt.querySelector("select").value,a=!e.#Jt.querySelector(`.${e.CLASS}-image-qr[disabled]`)&&e.#Jt.querySelector(`.${e.CLASS}-image-qr[checked]`),s=await e.generateImage(o,!0,a),l={[s.type]:s},c=new ClipboardItem(l);try{await navigator.clipboard.write([c]),t&&t.removeWait(r),e.map.toast(e.getLocaleString("copiedClipboard"),{type:i.A.msgType.INFO})}catch(e){n.A.error(e.message),t&&t.removeWait(r)}}#Qt(){let e="";this.#Jt&&(e=this.#Jt.querySelector("select").value),e.indexOf("image")>-1?this.#rr(e):this.#nr(e)}#Ye(e){const t=this,r=t.div.querySelector(".tc-alert-warning:not(."+t.CLASS+"-alert)");var a;switch(e.key){case i.A.WFSErrors.MAX_NUM_FEATURES:a=o.A.formatTemplate(r.querySelector("#zoom-msg-"+t.id).innerHTML,{serviceName:e.params.serviceTitle});break;case i.A.WFSErrors.NO_LAYERS:a=t.getLocaleString("noLayersLoaded");break;case i.A.WFSErrors.GETCAPABILITIES:a=o.A.formatTemplate(r.querySelector("#novalid-msg-"+t.id).innerHTML,{serviceName:e.params.serviceTitle});break;case i.A.WFSErrors.NO_FEATURES:a=r.querySelector("#noFeatures-msg-"+t.id).innerHTML;break;case i.A.WFSErrors.INDETERMINATE:return a=t.getLocaleString("wfs.IndeterminateError"),t.map.toast(a,{type:i.A.msgType.ERROR}),void n.A.error(o.A.formatTemplate("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}",{error:e.params.err,descripcion:e.params.errorThrown,serviceName:e.params.serviceTitle}),i.A.msgErrorMode.CONSOLE);case i.A.WFSErrors.NO_VALID_FORMAT:a=t.getLocaleString("wfs.NoValidFormat",{serviceTitle:e.params.serviceTitle,format:e.params.format.toUpperCase()});break;default:a=t.getLocaleString("wfs."+e.key,e.params)}t.map.toast(a,{type:i.A.msgType.WARNING})}#er=function(e){e.stopPropagation(),o.A.showModal(this._dialogDiv.querySelector(`.${this.CLASS}-help-dialog`))};manageMaxLengthExceed(e){const t=this,r=t.div.querySelector("."+t.CLASS+"-alert"),n=t.div.querySelector(`.${t.CLASS}-image-qr`);n.disabled=e.qr,n.checked?r.classList.toggle(i.A.classes.HIDDEN,!e.qr):r.classList.add(i.A.classes.HIDDEN)}async generateLink(){const e=this,t=e.div.querySelector(`.${e.CLASS}-div .${e.CLASS}-image-qr`);t.disabled=!0,t.classList.add(i.A.classes.LOADING);const r=await super.generateLink.call(e);return t.classList.remove(i.A.classes.LOADING),r}updateModel(){const e=this;e.model.download=e.getLocaleString("download"),e.model["dl.export.map"]=e.getLocaleString("dl.export.map"),e.model["dl.export.vector"]=e.getLocaleString("dl.export.vector"),e.model.format=e.getLocaleString("format"),e.model.createQrCodeToImage=e.getLocaleString("createQrCodeToImage"),e.model.appendQRCode=e.getLocaleString("appendQRCode"),e.model["appendWorldFile.explanation"]=e.getLocaleString("appendWorldFile.explanation"),e.model.appendWorldFile=e.getLocaleString("appendWorldFile"),e.model.copyImageFromCurrentMap=e.getLocaleString("copyImageFromCurrentMap"),e.model.copyClipboard=e.getLocaleString("copyClipboard"),e.model.downloadImageFromCurrentMap=e.getLocaleString("downloadImageFromCurrentMap"),e.model.qrAdvice=e.getLocaleString("qrAdvice"),e.model.showDownloadHelp=e.getLocaleString("showDownloadHelp"),e.model.downloadLayersFromCurrentExtent=e.getLocaleString("downloadLayersFromCurrentExtent"),e.model.tooManyFeatures=e.getLocaleString("tooManyFeatures"),e.model["tooManyFeatures.instructions"]=e.getLocaleString("tooManyFeatures.instructions"),e.model.noLayersLoaded=e.getLocaleString("noLayersLoaded"),e.model["noLayersLoaded.instructions"]=e.getLocaleString("noLayersLoaded.instructions"),e.model.tooManySelectedLayers=e.getLocaleString("tooManySelectedLayers"),e.model["tooManySelectedLayers.instructions"]=e.getLocaleString("tooManySelectedLayers.instructions"),e.model.noData=e.getLocaleString("noData"),e.model["noData.instructions"]=e.getLocaleString("noData.instructions"),e.model.noValidService=e.getLocaleString("noValidService"),e.model["noValidService.instructions"]=e.getLocaleString("noValidService.instructions"),e.model.formatImageTitle=e.getLocaleString("format"),e.model.formatVectorTitle=e.getLocaleString("format"),e.dialogModel.downloadData=e.getLocaleString("downloadData"),e.dialogModel["dl.instructions.1"]=e.getLocaleString("dl.instructions.1"),e.dialogModel["dl.instructions.2"]=e.getLocaleString("dl.instructions.2"),e.dialogModel["dl.instructions.3"]=e.getLocaleString("dl.instructions.3"),e.dialogModel["dl.instructions.4"]=e.getLocaleString("dl.instructions.4"),e.dialogModel["dl.instructions.5"]=e.getLocaleString("dl.instructions.5"),e.dialogModel["dl.instructions.6"]=e.getLocaleString("dl.instructions.6"),e.dialogModel.close=e.getLocaleString("close")}async updateLanguage(){this.updateModel()}}g.prototype.CLASS="tc-ctl-download",n.A.control.Download=g;const f=g},3402:(e,t,r)=>{"use strict";function n(e,t,r,n){for(;t<r-n;){for(let i=0;i<n;++i){const o=e[t+i];e[t+i]=e[r-n+i],e[r-n+i]=o}t+=n,r-=n}}function i(e,t,r,n){let i=0,o=e[r-n],a=e[r-n+1];for(;t<r;t+=n){const r=e[t],n=e[t+1];i+=(r-o)*(n+a),o=r,a=n}return 0===i?void 0:i>0}function o(e,t,r,n,o){o=void 0!==o&&o;for(let a=0,s=r.length;a<s;++a){const s=r[a],l=i(e,t,s,n);if(0===a){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;t=s}return!0}function a(e,t,r,n,i){for(let a=0,s=r.length;a<s;++a){const s=r[a];if(!o(e,t,s,n,i))return!1;s.length&&(t=s[s.length-1])}return!0}function s(e,t,r,o,a){a=void 0!==a&&a;for(let s=0,l=r.length;s<l;++s){const l=r[s],c=i(e,t,l,o);(0===s?a&&c||!a&&!c:a&&!c||!a&&c)&&n(e,t,l,o),t=l}return t}function l(e,t,r,n,i){for(let o=0,a=r.length;o<a;++o)t=s(e,t,r[o],n,i);return t}function c(e,t){const r=[];let n,o=0,a=0;for(let s=0,l=t.length;s<l;++s){const l=t[s],c=i(e,o,l,2);if(void 0===n&&(n=c),c===n)r.push(t.slice(a,s+1));else{if(0===r.length)continue;r[r.length-1].push(t[a])}a=s+1,o=l}return r}r.d(t,{yJ:()=>c,PA:()=>o,mb:()=>a,ug:()=>s,NK:()=>l})},3408:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});const n=new WeakMap,i=function(e,t){const r=function(e){const r={type:e.type,target:this,currentTarget:this};return e.detail&&Object.keys(e.detail).forEach((function(t){t in r||(r[t]=e.detail[t])})),t.call(this,r)}.bind(this);return(this._listeners[e]=this._listeners[e]||new Map).set(t,r),r},o=function(e,t,r){const n=this;return e.split(" ").forEach((function(e){n.$events.addEventListener(e,i.call(n,e,t),r)})),n},a=function(){const e=this;e._listeners={},e.$events=document.createDocumentFragment();const t=["addEventListener","dispatchEvent","removeEventListener"];t.forEach((function(t){this[t]=e.$events[t].bind(e.$events)}),e),t.push("on"),t.push("one"),t.push("off"),t.push("trigger"),t.forEach((function(t){e.$events[t]=e[t].bind(e)}),e)},s=a.prototype;s.on=function(e,t,r){const i=this;var a=null;r?.signal&&(a=n.has(r.signal)?n.get(r.signal):[]);const s=o.call(this,e,t,r);return r?.signal&&a.push({evt:e,callback:t}),r?.signal&&(n.set(r.signal,a),r.signal.onabort=function(){n.get(r.signal).forEach((function(e){i.off(e.evt,e.callback)}))}),s},s.one=function(e,t){return o.call(this,e,t,{once:!0})},s.off=function(e,t){const r=this,n=e.split(" ");return t?n.forEach((function(e){const n=r._listeners[e];n&&n.has(t)&&r.$events.removeEventListener(e,n.get(t))})):n.forEach((function(e){const t=r._listeners[e];t&&(t.forEach((function(t){r.$events.removeEventListener(e,t)})),t.clear())})),r},s.trigger=function(e,t){var r;window.$&&$.Event&&e instanceof $.Event&&(t={},Object.keys(e).forEach((function(r){"type"!==r&&(t[r]=e[r])})),e=e.type),t&&(r={detail:t});const n=new CustomEvent(e,r);this.dispatchEvent(n)},a._onBySelectorMap=new WeakMap,a.listenerBySelector=function(e,t){return function(r){const n=this,i=r.type;var o=a._onBySelectorMap.get(n);o||(o={},a._onBySelectorMap.set(n,o));var s=o[i];if(s||(o[i]=s={}),s[e]||(s[e]=t),!r._listenerBySelectorCalled)for(var l,c=!1,u=r.target;u&&u!==n;){for(e in s)u.matches&&u.matches(e)&&(c=!0,l=s[e].call(n,r),r._listenerBySelectorCalled=!0);if(c)return l;u=u.parentNode}}};const l=a},3503:(e,t,r)=>{var n,i,o,a,s;n=r(3939),i=r(2151).utf8,o=r(7206),a=r(2151).bin,(s=function(e,t){e.constructor==String?e=t&&"binary"===t.encoding?a.stringToBytes(e):i.stringToBytes(e):o(e)?e=Array.prototype.slice.call(e,0):Array.isArray(e)||e.constructor===Uint8Array||(e=e.toString());for(var r=n.bytesToWords(e),l=8*e.length,c=1732584193,u=-271733879,h=-1732584194,d=271733878,p=0;p<r.length;p++)r[p]=16711935&(r[p]<<8|r[p]>>>24)|4278255360&(r[p]<<24|r[p]>>>8);r[l>>>5]|=128<<l%32,r[14+(l+64>>>9<<4)]=l;var g=s._ff,f=s._gg,m=s._hh,y=s._ii;for(p=0;p<r.length;p+=16){var v=c,A=u,S=h,E=d;c=g(c,u,h,d,r[p+0],7,-680876936),d=g(d,c,u,h,r[p+1],12,-389564586),h=g(h,d,c,u,r[p+2],17,606105819),u=g(u,h,d,c,r[p+3],22,-1044525330),c=g(c,u,h,d,r[p+4],7,-176418897),d=g(d,c,u,h,r[p+5],12,1200080426),h=g(h,d,c,u,r[p+6],17,-1473231341),u=g(u,h,d,c,r[p+7],22,-45705983),c=g(c,u,h,d,r[p+8],7,1770035416),d=g(d,c,u,h,r[p+9],12,-1958414417),h=g(h,d,c,u,r[p+10],17,-42063),u=g(u,h,d,c,r[p+11],22,-1990404162),c=g(c,u,h,d,r[p+12],7,1804603682),d=g(d,c,u,h,r[p+13],12,-40341101),h=g(h,d,c,u,r[p+14],17,-1502002290),c=f(c,u=g(u,h,d,c,r[p+15],22,1236535329),h,d,r[p+1],5,-165796510),d=f(d,c,u,h,r[p+6],9,-1069501632),h=f(h,d,c,u,r[p+11],14,643717713),u=f(u,h,d,c,r[p+0],20,-373897302),c=f(c,u,h,d,r[p+5],5,-701558691),d=f(d,c,u,h,r[p+10],9,38016083),h=f(h,d,c,u,r[p+15],14,-660478335),u=f(u,h,d,c,r[p+4],20,-405537848),c=f(c,u,h,d,r[p+9],5,568446438),d=f(d,c,u,h,r[p+14],9,-1019803690),h=f(h,d,c,u,r[p+3],14,-187363961),u=f(u,h,d,c,r[p+8],20,1163531501),c=f(c,u,h,d,r[p+13],5,-1444681467),d=f(d,c,u,h,r[p+2],9,-51403784),h=f(h,d,c,u,r[p+7],14,1735328473),c=m(c,u=f(u,h,d,c,r[p+12],20,-1926607734),h,d,r[p+5],4,-378558),d=m(d,c,u,h,r[p+8],11,-2022574463),h=m(h,d,c,u,r[p+11],16,1839030562),u=m(u,h,d,c,r[p+14],23,-35309556),c=m(c,u,h,d,r[p+1],4,-1530992060),d=m(d,c,u,h,r[p+4],11,1272893353),h=m(h,d,c,u,r[p+7],16,-155497632),u=m(u,h,d,c,r[p+10],23,-1094730640),c=m(c,u,h,d,r[p+13],4,681279174),d=m(d,c,u,h,r[p+0],11,-358537222),h=m(h,d,c,u,r[p+3],16,-722521979),u=m(u,h,d,c,r[p+6],23,76029189),c=m(c,u,h,d,r[p+9],4,-640364487),d=m(d,c,u,h,r[p+12],11,-421815835),h=m(h,d,c,u,r[p+15],16,530742520),c=y(c,u=m(u,h,d,c,r[p+2],23,-995338651),h,d,r[p+0],6,-198630844),d=y(d,c,u,h,r[p+7],10,1126891415),h=y(h,d,c,u,r[p+14],15,-1416354905),u=y(u,h,d,c,r[p+5],21,-57434055),c=y(c,u,h,d,r[p+12],6,1700485571),d=y(d,c,u,h,r[p+3],10,-1894986606),h=y(h,d,c,u,r[p+10],15,-1051523),u=y(u,h,d,c,r[p+1],21,-2054922799),c=y(c,u,h,d,r[p+8],6,1873313359),d=y(d,c,u,h,r[p+15],10,-30611744),h=y(h,d,c,u,r[p+6],15,-1560198380),u=y(u,h,d,c,r[p+13],21,1309151649),c=y(c,u,h,d,r[p+4],6,-145523070),d=y(d,c,u,h,r[p+11],10,-1120210379),h=y(h,d,c,u,r[p+2],15,718787259),u=y(u,h,d,c,r[p+9],21,-343485551),c=c+v>>>0,u=u+A>>>0,h=h+S>>>0,d=d+E>>>0}return n.endian([c,u,h,d])})._ff=function(e,t,r,n,i,o,a){var s=e+(t&r|~t&n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._gg=function(e,t,r,n,i,o,a){var s=e+(t&n|r&~n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._hh=function(e,t,r,n,i,o,a){var s=e+(t^r^n)+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._ii=function(e,t,r,n,i,o,a){var s=e+(r^(t|~n))+(i>>>0)+a;return(s<<o|s>>>32-o)+t},s._blocksize=16,s._digestsize=16,e.exports=function(e,t){if(null==e)throw new Error("Illegal argument "+e);var r=n.wordsToBytes(s(e,t));return t&&t.asBytes?r:t&&t.asString?a.bytesToString(r):n.bytesToHex(r)}},3521:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(8038),i=r(797),o=r(3301),a=r(9105),s=r(3791),l=r(5777);n.A.control=n.A.control||{},i.A.event.POPUP=i.A.event.POPUP||"popup.tc",i.A.event.POPUPHIDE=i.A.event.POPUPHIDE||"popuphide.tc",i.A.classes.DRAG=i.A.classes.DRAG||"tc-drag",i.A.classes.DRAGGED=i.A.classes.DRAGGED||"tc-dragged",i.A.classes.DRAGGABLE=i.A.classes.DRAGGABLE||"tc-draggable";class c{constructor(){this.close="",this.shareQuery=""}}class u extends a.default{currentFeature=null;constructor(){super(...arguments);const e=this;e.wrap=new n.A.wrap.control.Popup(e),e.model=new c}async register(e){const t=this;return await super.register.call(t,e),await t.renderPromise(),e.on(i.A.event.VIEWCHANGE,(function(){e.view===i.A.view.PRINTING&&t.isVisible()&&t.hide()})),e.on(i.A.event.LAYERVISIBILITY,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.isVisible()&&t.hide()})),e.on(i.A.event.LAYERREMOVE+" "+i.A.event.FEATURESCLEAR,(function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.hide()})),e.on(i.A.event.UPDATE,(function(){t.currentFeature&&t.currentFeature.getVisibilityState()!==i.A.visibility.NOT_VISIBLE||t.isVisible()&&t.hide()})),e.on(i.A.event.FEATUREREMOVE,(function(e){t.currentFeature===e.feature&&t.isVisible()&&t.hide()})),t}async loadTemplates(){const e=await r.e(9623).then(r.bind(r,9623));this.template=e.default}async render(e){const t=this;await super.renderData.call(t,{closeButton:t.options.closeButton||void 0===t.options.closeButton,shareButton:t.options.share}),t.popupDiv=t.div.querySelector(`.${t.CLASS}`),t.contentDiv=t.popupDiv.querySelector(`.${t.CLASS}-content`),t.menuDiv=t.popupDiv.querySelector(`.${t.CLASS}-menu`),t.addUIEventListeners(),await t.map.wrap.addPopup(t),o.A.isFunction(e)&&e(),t.controller=new l.A(t.model,new s.A(t.menuDiv)),t.updateModel()}addUIEventListeners(){const e=this,t=e.menuDiv.querySelector(`.${e.CLASS}-close`);t&&t.addEventListener("pointerup",(function(){e.hide()}),{passive:!0});const r=e.menuDiv.querySelector(`.${e.CLASS}-share`);return r&&r.addEventListener("pointerup",(function(){e.caller&&e.caller.showShareDialog()}),{passive:!0}),e}fitToView(e){const t=this;e?setTimeout((function(){t.wrap.fitToView()}),1e3):t.wrap.fitToView()}hide(){const e=this;if(e.map){const t={control:e,feature:e.currentFeature};e.setDragged(!1),e.map.wrap.hidePopup(e),e.getContainerElement().innerHTML="",e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1),e.map.trigger(i.A.event.POPUPHIDE,t)}return e}getContainerElement(){return this.contentDiv||null}getInfoContainer(){return this.contentDiv||null}getMenuElement(){return this.menuDiv||null}setDragged(e){const t=this;return t.dragged=e,t.popupDiv&&t.popupDiv.classList.toggle(i.A.classes.DRAGGED,!!e),t.wrap.setDragged(e),t}setDragging(e){const t=this;return e?(t.setDragged(!0),t.popupDiv.classList.add(i.A.classes.DRAG)):t.popupDiv.classList.remove(i.A.classes.DRAG),t}isVisible(){return this.popupDiv&&this.popupDiv.classList.contains(i.A.classes.VISIBLE)}updateModel(){const e=this;e.model.close=e.getLocaleString("close"),e.model.shareQuery=e.getLocaleString("shareQuery"),e?.caller?.printToolModel&&(e.caller.printToolModel.print=e.getLocaleString("print"),e.caller.printToolModel.printThisContent=e.getLocaleString("printThisContent"))}async updateLanguage(){this.updateModel()}}u.prototype.CLASS="tc-ctl-popup",n.A.control.Popup=u;const h=u},3530:(e,t,r)=>{"use strict";function n(e){for(const t in e)delete e[t]}function i(e){let t;for(t in e)return!1;return!t}r.d(t,{I:()=>n,p:()=>i})},3607:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1126),l=(r(5121),r(3333),r(6052),r(7098),r(8325)),c=r(7018),u=r(8606),h=r(6257),d=r(6546),p=r(1667),g=r(1845),f=r(2978),m=r(3791),y=r(5777);n.A.wrap=s.A;const v="sitna-edit";class A{constructor(){this.select="",this.newPoint="",this.newLine="",this.newPolygon="",this.otherTools="",this.importFromOtherLayer="",this.download="",this.featureEditing="",this.thereAreNoCompatibleFeatures="",this.ok="",this.save="",this.saveAs=""}}class S extends g.default{#t;#fe;#ir;#or;#ar;#sr;#lr=new WeakMap;#cr=new Set;static mode={MODIFY:"modify",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon",CUT:"cut",OTHER:"other"};static event={MODECHANGE:"modechange"};constructor(){super(...arguments);const e=this;e.#t="."+e.CLASS,e.#fe={MODE_TAB:`.${e.CLASS}-mode sitna-tab`},e.mode=e.options.mode,e.initProperty("stylable").initProperty("snapping").initProperty("mode").initProperty("otherToolsIncluded"),e.wrap=new n.A.wrap.control.Edit(e),e.layer=null,e.callback=a.A.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null,e.cancelActionConfirmTxt=e.options.cancelText?e.options.eraseText:"Si continua todos los cambios se perderán. ¿Desea continuar?",e.layersEditData={},e.pointDrawControl=null,e.lineDrawControl=null,e.polygonDrawControl=null,e.modifyControl=null,e.model=new A}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;const n=this;"stylable"===e&&n.#Wt(),"mode"===e&&n.#h(t),"snapping"==e&&n.#ur()}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}async#Wt(){const e=this,t=await Promise.all([e.getModifyControl(),e.getPointDrawControl(),e.getLineDrawControl(),e.getPolygonDrawControl()]),r=e.stylable;t.forEach((e=>e.stylable=r))}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}async#ur(){const e=this,t=!!e.snapping&&(e.layer||e.snapping);(await e.getPointDrawControl()).snapping=t,(await e.getLineDrawControl()).snapping=t,(await e.getPolygonDrawControl()).snapping=t}get mode(){return this.hasAttribute("mode")?this.getAttribute("mode"):S.mode.MODIFY}set mode(e){this.setAttribute("mode",e||"")}get otherToolsIncluded(){return!this.hasAttribute("no-other-tools")}set otherToolsIncluded(e){this.toggleAttribute("no-other-tools",!e)}#h(e){const t=this,r=t.mode;Promise.all([t.getPointDrawControl(),t.getLineDrawControl(),t.getPolygonDrawControl(),t.getModifyControl()]).then((function(n){const o=n[0],a=n[1],s=n[2],l=n[3];switch(r){case S.mode.MODIFY:l.activate();break;case S.mode.ADDPOINT:o.activate(),t.#sr.mode=i.A.geom.POINT;break;case S.mode.ADDLINE:a.activate(),t.#sr.mode=i.A.geom.POLYLINE;break;case S.mode.ADDPOLYGON:s.activate(),t.#sr.mode=i.A.geom.POLYGON;break;case S.mode.OTHER:default:n.indexOf(t.map.activeControl)>=0&&t.map.activeControl.deactivate()}r?t.querySelector(`${t.#fe.MODE_TAB}[for="${t.getId()}-mode-${r}"]`).selected=!0:t.querySelectorAll(t.#fe.MODE_TAB).forEach((function(e){e.selected=!1}));const c=new CustomEvent(S.event.MODECHANGE,{detail:{oldMode:e}});t.dispatchEvent(c)}))}async register(e){const t=this;return await super.register.call(t,e),t.#sr=t.querySelector("sitna-measurement"),t.#sr.displayElevation=t.options.displayElevation,Array.isArray(t.options.modes)&&1==t.options.modes.length&&(t.mode=t.options.modes[0]),e.loaded((function(){t.setLayer(t.options.layer)})),e.on(i.A.event.RESULTSPANELCLOSE,(function(e){e.control===t.featureImportPanel&&(t.featuresToImport=[],t.getHighlightsLayer().then((e=>e.clearFeatures())))})).on(i.A.event.LAYERREMOVE+" "+i.A.event.FEATURESCLEAR,(function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.A.classes.HIDDEN)&&t.getHighlightsLayer().then((function(r){for(let n=t.featuresToImport.length-1;n>=0;n--){const i=t.featuresToImport[n];(i.layer===e.layer||i.original&&i.original.layer===e.layer)&&(t.featuresToImport.splice(n,1),r.removeFeature(i))}const n=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);n&&n.remove()}))})).on(i.A.event.FEATUREREMOVE,(function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.A.classes.HIDDEN)&&t.getHighlightsLayer().then((function(r){for(var n=0,i=t.featuresToImport.length;n<i;n++){const i=t.featuresToImport[n];if(i===e.feature||i.original===e.feature){t.featuresToImport.splice(n,1),r.removeFeature(i);const o=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);if(o){const t=o.querySelector(`#tc-ctl-edit-import-list-cb-${e.layer.id}-${e.feature.id}`);t&&t.remove(),o.children.length||o.remove()}break}}}))})).on(i.A.event.LAYERUPDATE,(function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.A.classes.HIDDEN)){const r=t.getAvailableFeaturesToImport().find((t=>t.id===e.layer.id));r&&t.getRenderedHtml(t.CLASS+"-import-layer",r,(function(r){const n=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`);n.querySelector(`li[data-layer-id="${e.layer.id}"]`)||n.insertAdjacentHTML("beforeend",r)}))}})).on(i.A.event.FEATUREADD+" "+i.A.event.FEATURESADD,(function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.A.classes.HIDDEN)){const r=e.layer,n=(e.feature?[e.feature]:e.features).filter((e=>t.isFeatureAllowed(e)));n.length&&t.displayLayerToImport({id:r.id,title:r.title,features:n})}})).on(i.A.event.CONTROLACTIVATE,(function(e){switch(e.control){case t.pointDrawControl:t.#sr.setMode(i.A.geom.POINT);break;case t.lineDrawControl:t.#sr.setMode(i.A.geom.POLYLINE);break;case t.polygonDrawControl:t.#sr.setMode(i.A.geom.POLYGON);break;default:t.#sr.clear()}})).on(i.A.event.CONTROLDEACTIVATE,(function(e){let r;switch(e.control){case t.pointDrawControl:r=t.getPointDrawControlAttributeEditor();break;case t.lineDrawControl:r=t.getLineDrawControlAttributeEditor();break;case t.polygonDrawControl:r=t.getPolygonDrawControlAttributeEditor()}r?.then((e=>e.feature=null))})),t}getModeTab(e){return this.querySelector(`sitna-tab[for="${this.getId()}-mode-${e}"]`)}async loadTemplates(){const e=this,t=r.e(4323).then(r.bind(r,4323)),n=r.e(9447).then(r.bind(r,9447)),i=r.e(6707).then(r.bind(r,6707)),o=r.e(4338).then(r.bind(r,1957)),a={};a[e.CLASS]=(await t).default,a[e.CLASS+"-import"]=(await n).default,a[e.CLASS+"-import-layer"]=(await i).default,a[e.CLASS+"-import-feature"]=(await o).default,e.template=a}async render(e){const t=this;await super.renderData.call(t,{controlId:t.getId(),stylable:t.stylable,snapping:t.snapping,otherToolsIncluded:t.otherToolsIncluded});const r=await Promise.all([t.getPointDrawControl(),t.getLineDrawControl(),t.getPolygonDrawControl(),t.getModifyControl()]);t.pointDrawControl=r[0],t.lineDrawControl=r[1],t.polygonDrawControl=r[2],t.pointDrawControl.id=t.getUID(),t.lineDrawControl.id=t.getUID(),t.polygonDrawControl.id=t.getUID(),t.pointDrawControl.snapping=t.snapping,t.lineDrawControl.snapping=t.snapping,t.polygonDrawControl.snapping=t.snapping,t.modifyControl=r[3],t.modifyControl.id=t.getUID(),t.modifyControlAttributesEditor=await t.getModifyControlAttributeEditor(),t.modifyControlAttributesEditor.clientControl=t.modifyControl,t.pointDrawControlAttributesEditor=await t.getPointDrawControlAttributeEditor(),t.pointDrawControlAttributesEditor.clientControl=t.pointDrawControl,t.lineDrawControlAttributesEditor=await t.getLineDrawControlAttributeEditor(),t.lineDrawControlAttributesEditor.clientControl=t.lineDrawControl,t.polygonDrawControlAttributesEditor=await t.getPolygonDrawControlAttributeEditor(),t.polygonDrawControlAttributesEditor.clientControl=t.polygonDrawControl;const n=new WeakMap,o=async function(e){if(t.map.options.elevation&&e.getGeometryStride()>2){const r=Date.now();n.set(e,r);let i,o=!1;const a=function(e){return Array.isArray(e)?e.map((e=>a(e))):e},s=a(e.geometry);for(const e of l.A.iterateCoordinates(s)){if(null==e[2]){i=i||await t.map.getElevationTool();const r=await i.getElevation({coordinates:[e],crs:t.map.getCrs()});r?.length&&(o=!0,e[2]=r[0][2])}}o&&r===n.get(e)&&e.setCoordinates(s)}},s=function(e){t.#sr.clearMeasurement(),e.feature&&t.#hr(e.feature)},c=async function(e){await o(e.feature),t.trigger(i.A.event.DRAWEND,{feature:e.feature})},u=function(){t.cancel()},h=function(e){t.#sr.displayMeasurement(e)};if(t.pointDrawControl.on(i.A.event.DRAWEND,c).on(i.A.event.DRAWCANCEL,u).on(i.A.event.MEASURE+" "+i.A.event.MEASUREPARTIAL,h),t.lineDrawControl.on(i.A.event.DRAWSTART,s).on(i.A.event.DRAWEND,c).on(i.A.event.DRAWCANCEL,u).on(i.A.event.MEASURE+" "+i.A.event.MEASUREPARTIAL,h),t.polygonDrawControl.on(i.A.event.DRAWSTART,s).on(i.A.event.DRAWEND,c).on(i.A.event.DRAWCANCEL,u).on(i.A.event.MEASURE+" "+i.A.event.MEASUREPARTIAL,h),t.modifyControl.on(i.A.event.FEATUREMODIFY,(async function(e){e.layer===t.layer&&t.#sr.displayMeasurement(e.feature),await o(e.feature),t.trigger(i.A.event.FEATUREMODIFY,{feature:e.feature,layer:e.layer,geometryChanged:!0})})).on(i.A.event.FEATUREADD,(function(e){t.trigger(i.A.event.FEATUREADD,{feature:e.feature,layer:e.layer})})).on(i.A.event.FEATUREREMOVE,(function(e){t.trigger(i.A.event.FEATUREREMOVE,{feature:e.feature,layer:e.layer})})).on(i.A.event.FEATURESSELECT+" "+i.A.event.FEATURESUNSELECT,(function(e){const r=t.modifyControl.getSelectedFeatures();r.length?t.#sr.displayMeasurement(r[r.length-1]):t.#sr.clearMeasurement()})),Array.isArray(t.options.modes)&&t.options.modes.length>0){for(var d in S.mode)if("string"==typeof d&&t.options.modes.indexOf(S.mode[d])<0){const e=t.getModeTab(S.mode[d]),r=e.target;r.parentElement.removeChild(r),e.parentElement.removeChild(e)}if(1===t.options.modes.length){var p=t.options.modes[0];const e=t.getModeTab(p);e.parentElement.removeChild(e)}}return t.querySelectorAll(t.#fe.MODE_TAB).forEach((function(e){e.callback=function(){const e=this.target?.getAttribute("id");if(e){const r=e.substr(e.lastIndexOf("-")+1);t.mode=this.selected?r:null}}})),t.querySelector(t.#t+"-btn-import").addEventListener(i.A.event.CLICK,(function(e){t.showFeatureImportPanel()}),{passive:!0}),t.querySelector(t.#t+"-btn-dl").addEventListener(i.A.event.CLICK,(function(e){t.getDownloadDialog().then((function(e){const r={title:t.getLocaleString("download"),fileName:t.layer.id.toLowerCase().replace(" ","_")+"_"+a.A.getFormattedDate((new Date).toString(),!0),elevation:t.options.downloadElevation};e.open(t.layer.features,r)}))}),{passive:!0}),a.A.isFunction(e)&&e(),t.controller=new y.A(t.model,new m.A(t)),t.updateModel(),t}setLayer(e){const t=this;return t.modifyControl&&t.modifyControl.unselectFeatures(t.getSelectedFeatures()),t.layer=t.map.getLayer(e),t.layer&&e.describeFeatureType().then((function(r){const n={attributes:{}};let o;for(o in r){const e=r[o],t=f.A.getGeometryType(e.type);t?(n.geometryName=e.name,n.geometryType=t===i.A.geom.GEOMETRY?null:t):n.attributes[o]=e}for(o in n.attributes){const e=n.attributes[o];e.type=e.type.substr(e.type.indexOf(":")+1)}t.layersEditData[e.id]=n})).catch((function(r){t.layersEditData[e.id]={geometryType:null,attributes:{}}})),Promise.all([t.getModifyControl(),t.getPointDrawControl(),t.getLineDrawControl(),t.getPolygonDrawControl()]).then((e=>{e.forEach((e=>{e.setLayer(t.layer)})),t.#ur()})),t.mode=t.layer?S.mode.MODIFY:null,t.#dr(t.layer),t}getModes(){return[...this.#cr.values()]}setModes(e){const t=this;Array.isArray(e)||(e=[]),e.length||(e=Object.values(S.mode)),t.#cr=new Set(e.filter((function(e){for(var t in S.mode)if(S.mode[t]===e)return!0;return!1})).filter((function(e){return!Array.isArray(t.options.modes)||t.options.modes.indexOf(e)>=0}))),t.#cr.has(t.mode)||(t.mode=null);const r=t.getModes().map((e=>`[for="${t.getId()}-mode-${e}"]`)).join()||"[for]";return t.querySelectorAll(t.#fe.MODE_TAB).forEach((function(e){e.disabled=!e.matches(r)})),t}isFeatureAllowed(e){const t=this,r=t.getModes();switch(!0){case e instanceof c.A:return r.includes(S.mode.ADDPOINT);case e instanceof u.A:return r.includes(S.mode.ADDLINE);case e instanceof h.A:return r.includes(S.mode.ADDLINE)&&t.isMultiple;case e instanceof d.A:return r.includes(S.mode.ADDPOLYGON);case e instanceof p.A:return r.includes(S.mode.ADDPOLYGON)&&t.isMultiple;default:return!0}}async setComplexGeometry(e){const t=this;t.isMultiple=e,(await t.getLineDrawControl()).setMode(e?i.A.geom.MULTIPOLYLINE:i.A.geom.POLYLINE),(await t.getPolygonDrawControl()).setMode(e?i.A.geom.MULTIPOLYGON:i.A.geom.POLYGON)}getLayerEditData(e){const t=this,r=e||t.layer;return r?t.layersEditData[r.id]=t.layersEditData[r.id]||{checkedOut:!1}:null}cancel(){const e=this;return Array.isArray(e.options.modes)&&1==e.options.modes.length?e.mode=e.options.modes[0]:e.mode=null,e.wrap.cancel(!0,e.cancelActionConfirmTxt),e}async activate(e={}){const t=this;let r;switch(e.mode){case S.mode.ADDPOINT:r=await t.getPointDrawControl();break;case S.mode.ADDLINE:r=await t.getLineDrawControl();break;case S.mode.ADDPOLYGON:r=await t.getPolygonDrawControl();break;default:r=await t.getModifyControl()}r!==t.map.activeControl&&(t.#ir=t.map.activeControl,await r.activate())}deactivate(){const e=this;switch(e.#ir&&(e.map.previousActiveControl=e.#ir),e.map.activeControl){case e.pointDrawControl:e.pointDrawControl.deactivate();break;case e.lineDrawControl:e.lineDrawControl.deactivate();break;case e.polygonDrawControl:e.polygonDrawControl.deactivate();break;case e.modifyControl:e.modifyControl.deactivate()}return e}isExclusive(){return!0}getAttributeDisplayTarget(){return this.modifyControl?.getAttributeDisplayTarget()}getSelectedFeatures(){return this.modifyControl?.getSelectedFeatures()}setSelectedFeatures(e){return this.modifyControl?.setSelectedFeatures(e)}async getLayer(){const e=this;return e.layer?e.layer:await e.layerPromise}async getModifyControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-modify sitna-modify`)}async getModifyControlAttributeEditor(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-modify sitna-attributes-edit`)}async getPointDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-point sitna-draw`)}async getPointDrawControlAttributeEditor(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-point sitna-attributes-edit`)}async getLineDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-line sitna-draw`)}async getLineDrawControlAttributeEditor(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-line sitna-attributes-edit`)}async getPolygonDrawControl(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-polygon sitna-draw`)}async getPolygonDrawControlAttributeEditor(){const e=this;return await e.renderPromise(),e.querySelector(`.${e.CLASS}-polygon sitna-attributes-edit`)}async getFeatureImportPanel(){const e=this;return e.#or||(e.#or=e.map.addControl("resultsPanel",{titles:{main:e.getLocaleString("importFromOtherLayer")}}),e.featureImportPanel=await e.#or),await e.#or}async getHighlightsLayer(){const e=this;return e.#ar||(e.#ar=e.map.addLayer({id:e.getUID(),type:i.A.layerType.VECTOR,title:"Highlights Layer",stealth:!0,styles:e.map.options.styles.selection||o.A.styles.selection}),e.highlightsLayer=await e.#ar),e.#ar}async highlightFeatures(e){const t=await this.getHighlightsLayer(),r=this.featuresToImport.concat(e);t.features.slice().forEach((function(e){(!e.original||r.indexOf(e.original)<0)&&t.removeFeature(e)})),await t.addFeatures(r.filter((function(e){return!t.features.some((function(t){return t.original&&t.original===e}))})).map((function(e){const t=e.clone();return t.toggleSelectedStyle(!0),t.original=e,t})))}getAvailableFeaturesToImport(){const e=this;return e.map.workLayers.filter((e=>!e.isRaster())).filter((t=>t!==e.layer)).filter((t=>t!==e.highlightsLayer)).map((function(t){return{id:t.id,title:t.title,features:t.features.filter((function(t){return e.isFeatureAllowed(t)}))}})).filter((e=>e.features.length))}displayMeasurement(e){this.#sr.displayMeasurement(e)}importFeatures(e){const t=this;let r=!1;const n=t.getLayerEditData();return(e||t.featuresToImport||[]).filter((e=>{const n=t.isFeatureAllowed(e);return n||(r=!0),n})).map((function(e){let r;const i={data:e.data,geometryName:n.geometryName};if(t.isMultiple)switch(!0){case e instanceof d.A:r=new p.A([e.geometry],i);break;case e instanceof u.A:r=new h.A([e.geometry],i);break;default:r=e.clone()}else switch(!0){case e instanceof p.A:r=new d.A(e.geometry[0],i);break;case e instanceof h.A:r=new u.A(e.geometry[0],i);break;default:r=e.clone()}return r.setStyle(null),r})).forEach((function(e){t.layer.addFeature(e),t.trigger(i.A.event.FEATUREADD,{feature:e,layer:t.layer})})),r&&t.map.toast(t.getLocaleString("importFromOtherLayer.warning"),{type:i.A.msgType.WARNING}),t}#pr(e){const t=e.querySelector("sitna-toggle"),r=this.map.getLayer(e.parentElement.parentElement.dataset.layerId);return r?r.getFeatureById(t.value):null}#dr(e){this.querySelectorAll(this.#fe.MODE_RADIO_BUTTON).forEach((t=>t.disabled=!e))}#gr(e){const t=this,r=t.#pr(e.parentElement);if(e.checked)t.featuresToImport.push(r);else{const e=t.featuresToImport.indexOf(r);e>=0&&t.featuresToImport.splice(e,1)}}#fr(e){const t=this;e.querySelector("sitna-toggle").addEventListener("change",(function(e){const r=this;r.parentElement.querySelectorAll("li.tc-feature sitna-toggle").forEach((function(e){e.checked!==r.checked&&(e.checked=r.checked,t.#gr(e))})),t.highlightFeatures([])})),e.querySelectorAll("li.tc-feature").forEach((function(e){t.#mr(e)}))}#mr(e){const t=this,r=function(e){const r=t.#pr(this);r&&t.highlightFeatures([r])};e.addEventListener(i.A.event.CLICK,r,{passive:!0}),e.addEventListener("mouseover",r),e.querySelector("sitna-toggle").addEventListener("change",(function(e){t.#gr(this)}))}showFeatureImportPanel(){const e=this;e.featuresToImport=[],e.getFeatureImportPanel().then((function(t){const r=t.getInfoContainer();e.getRenderedHtml(e.CLASS+"-import",{layers:e.getAvailableFeaturesToImport()},(function(n){t.open(n,r),e.controller.add(r),r.querySelector("ul").addEventListener("mouseout",(function(t){e.highlightFeatures([])})),r.querySelectorAll("li.tc-layer").forEach((function(t){e.#fr(t)})),r.querySelector(`.${e.CLASS}-import-btn-ok`).addEventListener(i.A.event.CLICK,(function(t){e.importFeatures(),e.featureImportPanel.close()}),{passive:!0})}))}))}async displayLayerToImport(e){const t=this;if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(i.A.classes.HIDDEN)){const r=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`),n=`li[data-layer-id="${e.id}"]`,i=r.querySelector(n);if(i)return e.features.forEach((function(r){t.isFeatureAllowed(r)&&t.getRenderedHtml(t.CLASS+"-import-feature",e,(function(e){i.insertAdjacentHTML("beforeend",e),t.#mr(i.querySelector("li:last-child"))}))})),i;{const i=await t.getRenderedHtml(t.CLASS+"-import-layer",{id:e.id,title:e.title,features:e.features});r.insertAdjacentHTML("beforeend",i);const o=r.querySelector(n);return t.#fr(o),o}}return null}#hr(e){this.#lr.set(e,e.clone())}async updateModel(){const e=this;e.model.select=e.getLocaleString("select"),e.model.newPoint=e.getLocaleString("newPoint"),e.model.newLine=e.getLocaleString("newLine"),e.model.newPolygon=e.getLocaleString("newPolygon"),e.model.otherTools=e.getLocaleString("otherTools"),e.model.importFromOtherLayer=e.getLocaleString("importFromOtherLayer"),e.model.download=e.getLocaleString("download"),e.model.featureEditing=e.getLocaleString("featureEditing"),e.model.thereAreNoCompatibleFeatures=e.getLocaleString("thereAreNoCompatibleFeatures"),e.model.ok=e.getLocaleString("ok"),e.model.save=e.getLocaleString("save"),e.model.saveAs=e.getLocaleString("saveAs"),e.featureImportPanel&&e.featureImportPanel.setTitles({main:e.getLocaleString("importFromOtherLayer")})}async updateLanguage(){this.updateModel()}}S.prototype.CLASS="tc-ctl-edit",customElements.get(v)||customElements.define(v,S);const E=S},3662:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(7468),i=r(3942),o=r(581),a=r(8662),s=r(1386);class l extends a.A{constructor(e){super(e=e||{}),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,r){const n=r[r.length-1];r[r.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},n),super.writeGeometryElement(e,t,r)}}l.prototype.namespace="http://www.opengis.net/gml/3.2",l.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:(0,i.Tb)(a.A.prototype.readFlatPos),posList:(0,i.Tb)(a.A.prototype.readFlatPosList),coordinates:(0,i.Tb)(o.A.prototype.readFlatCoordinates)}},l.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:a.A.prototype.interiorParser,exterior:a.A.prototype.exteriorParser}},l.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:(0,i.Tb)(s.A.prototype.readPoint),MultiPoint:(0,i.Tb)(s.A.prototype.readMultiPoint),LineString:(0,i.Tb)(s.A.prototype.readLineString),MultiLineString:(0,i.Tb)(s.A.prototype.readMultiLineString),LinearRing:(0,i.Tb)(s.A.prototype.readLinearRing),Polygon:(0,i.Tb)(s.A.prototype.readPolygon),MultiPolygon:(0,i.Tb)(s.A.prototype.readMultiPolygon),Surface:(0,i.Tb)(l.prototype.readSurface),MultiSurface:(0,i.Tb)(a.A.prototype.readMultiSurface),Curve:(0,i.Tb)(l.prototype.readCurve),MultiCurve:(0,i.Tb)(a.A.prototype.readMultiCurve),Envelope:(0,i.Tb)(l.prototype.readEnvelope)}},l.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:(0,i.VT)(a.A.prototype.curveMemberParser),curveMembers:(0,i.VT)(a.A.prototype.curveMemberParser)}},l.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:(0,i.VT)(a.A.prototype.surfaceMemberParser),surfaceMembers:(0,i.VT)(a.A.prototype.surfaceMemberParser)}},l.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:(0,i.VT)(s.A.prototype.readLineString),Curve:(0,i.VT)(a.A.prototype.readCurve)}},l.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:(0,i.VT)(s.A.prototype.readPolygon),Surface:(0,i.VT)(a.A.prototype.readSurface)}},l.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:(0,i.Tb)(a.A.prototype.readPatch)}},l.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:(0,i.Tb)(a.A.prototype.readSegment)}},l.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:(0,i.VT)(a.A.prototype.readFlatPosList),upperCorner:(0,i.VT)(a.A.prototype.readFlatPosList)}},l.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:(0,i.Tb)(a.A.prototype.readPolygonPatch)}},l.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:(0,i.Vh)(a.A.prototype.readLineStringSegment)}},l.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:(0,i.VT)(s.A.prototype.pointMemberParser),pointMembers:(0,i.VT)(s.A.prototype.pointMemberParser)}},l.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:(0,i.VT)(s.A.prototype.lineStringMemberParser),lineStringMembers:(0,i.VT)(s.A.prototype.lineStringMemberParser)}},l.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:(0,i.VT)(s.A.prototype.polygonMemberParser),polygonMembers:(0,i.VT)(s.A.prototype.polygonMemberParser)}},l.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:(0,i.VT)(s.A.prototype.readFlatCoordinatesFromNode)}},l.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:(0,i.VT)(s.A.prototype.readLineString)}},l.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:(0,i.VT)(s.A.prototype.readPolygon)}},l.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:(0,i.Tb)(s.A.prototype.readFlatLinearRing),Ring:(0,i.Tb)(l.prototype.readFlatCurveRing)}},l.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:(0,i.mm)(a.A.prototype.writeRing),interior:(0,i.mm)(a.A.prototype.writeRing)}},l.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:(0,i.mm)(n.uB),upperCorner:(0,i.mm)(n.uB)}},l.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:(0,i.mm)(a.A.prototype.writeSurfaceOrPolygonMember),polygonMember:(0,i.mm)(a.A.prototype.writeSurfaceOrPolygonMember)}},l.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:(0,i.mm)(a.A.prototype.writePointMember)}},l.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:(0,i.mm)(a.A.prototype.writeLineStringOrCurveMember),curveMember:(0,i.mm)(a.A.prototype.writeLineStringOrCurveMember)}},l.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:(0,i.mm)(a.A.prototype.writeCurveOrLineString),MultiCurve:(0,i.mm)(a.A.prototype.writeMultiCurveOrLineString),Point:(0,i.mm)(l.prototype.writePoint),MultiPoint:(0,i.mm)(a.A.prototype.writeMultiPoint),LineString:(0,i.mm)(a.A.prototype.writeCurveOrLineString),MultiLineString:(0,i.mm)(a.A.prototype.writeMultiCurveOrLineString),LinearRing:(0,i.mm)(a.A.prototype.writeLinearRing),Polygon:(0,i.mm)(a.A.prototype.writeSurfaceOrPolygon),MultiPolygon:(0,i.mm)(a.A.prototype.writeMultiSurfaceOrPolygon),Surface:(0,i.mm)(a.A.prototype.writeSurfaceOrPolygon),MultiSurface:(0,i.mm)(a.A.prototype.writeMultiSurfaceOrPolygon),Envelope:(0,i.mm)(a.A.prototype.writeEnvelope)}};const c=l},3671:(e,t,r)=>{"use strict";r.d(t,{AL:()=>o,Hg:()=>l,P4:()=>i,n$:()=>a,sx:()=>c});var n=r(1597);function i(e,t,r,i,o,a,s){const l=(r-t)/i;if(l<3){for(;t<r;t+=i)a[s++]=e[t],a[s++]=e[t+1];return s}const c=new Array(l);c[0]=1,c[l-1]=1;const u=[t,r-i];let h=0;for(;u.length>0;){const r=u.pop(),a=u.pop();let s=0;const l=e[a],d=e[a+1],p=e[r],g=e[r+1];for(let t=a+i;t<r;t+=i){const r=e[t],i=e[t+1],o=(0,n.Q1)(r,i,l,d,p,g);o>s&&(h=t,s=o)}s>o&&(c[(h-t)/i]=1,a+i<h&&u.push(a,h),h+i<r&&u.push(h,r))}for(let r=0;r<l;++r)c[r]&&(a[s++]=e[t+r*i],a[s++]=e[t+r*i+1]);return s}function o(e,t,r,n,o,a,s,l){for(let c=0,u=r.length;c<u;++c){const u=r[c];s=i(e,t,u,n,o,a,s),l.push(s),t=u}return s}function a(e,t){return t*Math.round(e/t)}function s(e,t,r,n,i,o,s){if(t==r)return s;let l,c,u=a(e[t],i),h=a(e[t+1],i);t+=n,o[s++]=u,o[s++]=h;do{if(l=a(e[t],i),c=a(e[t+1],i),(t+=n)==r)return o[s++]=l,o[s++]=c,s}while(l==u&&c==h);for(;t<r;){const r=a(e[t],i),d=a(e[t+1],i);if(t+=n,r==l&&d==c)continue;const p=l-u,g=c-h,f=r-u,m=d-h;p*m==g*f&&(p<0&&f<p||p==f||p>0&&f>p)&&(g<0&&m<g||g==m||g>0&&m>g)?(l=r,c=d):(o[s++]=l,o[s++]=c,u=l,h=c,l=r,c=d)}return o[s++]=l,o[s++]=c,s}function l(e,t,r,n,i,o,a,l){for(let c=0,u=r.length;c<u;++c){const u=r[c];a=s(e,t,u,n,i,o,a),l.push(a),t=u}return a}function c(e,t,r,n,i,o,a,s){for(let c=0,u=r.length;c<u;++c){const u=r[c],h=[];a=l(e,t,u,n,i,o,a,h),s.push(h),t=u[u.length-1]}return a}},3721:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(8038),i=r(797),o=r(1845),a=r(6378),s=r(3607),l=r(8325),c=r(3301),u=r(6631),h=r(2902),d=r(3365),p=r(7018),g=r(1651),f=(r(2948),r(8606)),m=r(6546),y=(r(9439),r(6257)),v=r(1667),A=r(4583),S=r(3791),E=r(5777);n.A.control=n.A.control||{},n.A.Geometry=l.A,n.A.filter=u.A;const w=new Set;window.addEventListener("beforeunload",(function(e){w.size>0&&(e.preventDefault(),e.returnValue="")}),{capture:!0});const _="sitna-file-edit";class L{constructor(){this.save="",this.saveAs=""}}class C extends o.default{TITLE_SEPARATOR=" › ";#yr=new WeakMap;constructor(){super(...arguments);const e=this;e.initProperty("snapping"),e.layer=null,e.model=new L}static get observedAttributes(){return["stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;"stylable"===e&&this.#Wt(),"snapping"==e&&this.#ur()}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}async#Wt(){(await this.getEditControl()).stylable=this.stylable}get snapping(){return this.hasAttribute("snapping")}set snapping(e){this.toggleAttribute("snapping",!!e)}async#ur(){const e=this.snapping;(await this.getEditControl()).snapping=e}async register(e){const t=this,r=await super.register.call(t,e);return t.editControl=await t.getEditControl(),t.editControl&&(t.editControl.styles=t.options.styles),e.on(i.A.event.RESULTSPANELCLOSE,(function(e){e.control===t.panel&&t.closeEditSession()})).on(i.A.event.LAYERREMOVE,(function(e){t.markAsSaved(e.layer)})).on(i.A.event.LAYERREMOVE+" "+i.A.event.FEATURESCLEAR,(function(e){t.getLayer().then((function(r){e.layer===r&&t.closeEditSession()}))})).on(i.A.event.FEATUREADD,(function(e){t.getLayer().then((function(t){if(e.layer===t){const t=e.layer.features[0];t!==e.feature&&(e.feature.folders=t?.folders?.slice(),e.feature.wrap.feature._folders=e.feature.folders)}}))})).on(i.A.event.FEATUREADD+" "+i.A.event.FEATUREREMOVE,(function(e){t.getLayer().then((function(t){e.layer===t&&(w.has(e.layer)||w.add(e.layer))}))})),t.getEditControl().then((e=>{e.on(i.A.event.FEATUREMODIFY+" "+i.A.event.DRAWEND,(function(e){e.feature.layer&&!w.has(e.feature.layer)&&w.add(e.feature.layer)}))})),e.ready((function(){t.getCallerControls().forEach((e=>t.registerTool(e)))})),r}getCallerControls(){return this.options.caller?[this.options.caller]:this.map.getControlsByClass(a.default)}registerTool(e){const t=this;if(e.options.fileEditing){const r=c.A.getTextFromCssVar("--icon-edit",e.div);e instanceof a.default&&e.addItemTool({renderFn:function(e,n){const o=t.map.getLayer(n);if(o?.type!==i.A.layerType.VECTOR)return;const a=t.CLASS+"-btn-edit";let s=e.querySelector("sitna-toggle."+a);if(!s){const e=t.getLocaleString("editFeatures");s=new h.A,s.setAttribute("title",e),s.checkedIconText=r,s.uncheckedIconText=r,s.dataset.layerId=n}return s.disabled=o.state===d.A.state.LOADING,s},updateEvents:[i.A.event.BEFORELAYERUPDATE,i.A.event.LAYERUPDATE,i.A.event.CONTROLACTIVATE,i.A.event.CONTROLDEACTIVATE],updateFn:function(e){const r=this,n=t.map.getLayer(r.dataset.layerId);t.getLayer().then((function(e){r.checked=e===n})),r.disabled=!n||n.state===d.A.state.LOADING},actionFn:function(){const e=t.map.getLayer(this.dataset.layerId);e.isRaster()||(t.closeEditSession(),this.checked&&t.setLayer(e).then((()=>{t.openEditSession()})))}})}}async loadTemplates(){const e=r.e(3103).then(r.bind(r,3103));this.template=(await e).default}async render(e){const t=this,r=!!window.showSaveFilePicker;if(await t.renderData({editControlId:t.getUID(),stylable:t.stylable,snapping:t.snapping,includeSaveAs:r}),t.map){const e=await t.map.addResultsPanel({resize:!1,content:"table",titles:{main:t.getLocaleString("editFeatures")}});t.panel=e,t.panel.div.querySelector("."+t.panel.CLASS+"-info").insertAdjacentElement("beforeend",t),t.saveButton=t.panel.div.querySelector(`.${t.CLASS}-actions sitna-button.${t.CLASS}-btn-save`),r&&(t.saveAsButton=t.panel.div.querySelector(`.${t.CLASS}-actions sitna-button.${t.CLASS}-btn-saveas`));const o=await t.getEditControl();o.addEventListener(s.default.event.MODECHANGE,(async function(e){const r=await(o.layer?.getFeatureTypeMetadata()),a=r?.geometries?.[0].type;if(a&&!t.#vr(o.layer).allowOtherGeometryTypes){let l=!1;switch(this.mode){case s.default.mode.ADDPOINT:a!==i.A.geom.GEOMETRY&&a!==i.A.geom.POINT&&a!==i.A.geom.MULTIPOINT&&(l=!0);break;case s.default.mode.ADDLINE:a!==i.A.geom.GEOMETRY&&a!==i.A.geom.POLYLINE&&a!==i.A.geom.MULTIPOLYLINE&&(l=!0);break;case s.default.mode.ADDPOLYGON:a!==i.A.geom.GEOMETRY&&a!==i.A.geom.POLYGON&&a!==i.A.geom.MULTIPOLYGON&&(l=!0)}l&&n.A.confirm(t.getLocaleString("geometryTypeNotAllowed.warning"),(()=>{t.#Ar(o.layer,{allowOtherGeometryTypes:!0}),r.geometryType=null,o.layer.setFeatureTypeMetadata(r)}),(()=>{o.mode=e.detail.oldMode}))}}))}t.addUIEventListeners(),c.A.isFunction(e)&&e(),t.controller=new E.A(t.model,new S.A(t)),t.updateModel()}addUIEventListeners(){const e=this;return e.saveButton?.addEventListener(i.A.event.CLICK,(function(t){e.getEditControl().then((function(t){t.getModifyControl().then((function(t){t.unselectFeatures(t.getSelectedFeatures()),e.save()}))}))}),{passive:!0}),e.saveAsButton?.addEventListener(i.A.event.CLICK,(function(t){e.getEditControl().then((function(t){t.getModifyControl().then((function(t){t.unselectFeatures(t.getSelectedFeatures()),e.save({showDialog:!0})}))}))}),{passive:!0}),e}async getEditControl(){const e=this;return await e.renderPromise(),e.panel?.div.querySelector(`.${e.CLASS}-edit sitna-edit`)}async openEditSession(e={}){const t=this,r=await t.getLayer();await t.renderPromise();const o=await t.getEditControl(),a=function(e,t,r,n){r?e.setMode(i.A.geom[t]):n&&e.setMode(i.A.geom["MULTI"+t])};a(await o.getPointDrawControl(),"POINT",r.features.some((e=>e instanceof p.A)),r.features.some((e=>e instanceof g.A)));const s=await o.getLineDrawControl(),l=r.features.some((e=>e instanceof f.A)),c=r.features.some((e=>e instanceof y.A));if(a(s,"POLYLINE",l,c),e?.extensibleSketch){if(l&&c)return void n.A.Error("extensibleSketch option is not possible on this file");s.extensibleSketch=e?.extensibleSketch}a(await o.getPolygonDrawControl(),"POLYGON",r.features.some((e=>e instanceof m.A)),r.features.some((e=>e instanceof v.A))),o.setModes(e.modes),t.stylable=e?.stylable??!0,t.#Sr(),t.panel.open()}closeEditSession(){const e=this;e.editControl&&e.editControl.setLayer(null),e.panel&&!e.panel.div.classList.contains(i.A.classes.HIDDEN)&&e.panel.close()}setLayer(e){return this.editControl?(this.editControl.setLayer(e),Promise.resolve()):Promise.reject(new Error("Edit control not initialized"))}async getLayer(){return await(await this.getEditControl()).getLayer()}isStylable(e){const t=e._fileHandle?.name;return!t||t.endsWith(".kml")||t.endsWith(".kmz")}async save(e={}){const t=this,o=e.layer||await t.getLayer();let a,s,l,u,h,d,p,g,f=o.features;const y=async function(){(await s(t.map.workLayers)).forEach((e=>w.delete(e)))};if(e.showDialog){const r=await t.getDownloadDialog(),n={title:t.getLocaleString("saveAs"),fileName:o.file?.substring(0,o.file.lastIndexOf("."))??o.title,persistenceMode:r.constructor.persistenceMode.SAVE,elevation:(await t.map.getElevationTool())?.options,formats:e.formats};return f.some((e=>e instanceof m.A||e instanceof v.A))&&(n.excludedFormats??=[],n.excludedFormats.indexOf(i.A.format.GPX)<0&&n.excludedFormats.push(i.A.format.GPX)),void r.open(f,n)}if(DataTransferItem.prototype.getAsFileSystemHandle){const e=async function(e){const t={mode:"readwrite"};let r=await e.queryPermission(t);return"granted"!==r&&(r=await e.requestPermission(t)),r};if(o._fileHandle){const t=async function(t){let r=await e(t._fileHandle);if(t._additionalFileHandles?.length)for await(let n of t._additionalFileHandles.map((t=>e(t))))"granted"!==n&&(r=n);return r};g=o._fileHandle,p=g,l=o.file,u=o.fileSystemFile,s=async function(e){const t=await Promise.all(e.map((e=>e._fileHandle?.isSameEntry(g))));return e.filter(((e,r)=>t[r]))},d=await t(o)}else l=o.title,/\.[a-zA-Z]+$/.test(l)||(l+="."+i.A.format.GEOJSON),s=async function(e){return[o]};a=async function(){if("granted"===d){const e=async function(e,r){try{const t=await e.createWritable();return await t.write(r),await t.close(),!0}catch(e){n.A.error(t.getLocaleString("fileWrite.error"),[i.A.msgErrorMode.TOAST,i.A.msgErrorMode.CONSOLE])}return!1};let a,s;try{a=await t.map.exportFeatures(f,{fileName:u,format:h})}catch(e){return void(e instanceof A.et?n.A.error(t.getLocaleString("fileWrite.fieldNameError",{name:e.cause}),[i.A.msgErrorMode.TOAST,i.A.msgErrorMode.CONSOLE]):n.A.error(e))}if(o._additionalFileHandles?.length&&"application/zip"===a.type){const t=new(0,(await r.e(1710).then(r.t.bind(r,1710,23))).default),n=await t.loadAsync(a),i=new Map;n.forEach((function(e,t){t.dir||i.set(e,t)}));const l=[p,...o._additionalFileHandles];for(let[t,r]of i.entries()){const n=l.find((e=>e.name===t));if(n&&(s=await e(n,await r.async("blob")),!s))break}}else s=await e(p,a);if(s){const e={fileHandle:p};await y(),t.map.trigger(i.A.event.FILESAVE,e),t.map.toast(t.getLocaleString("fileSaved"),{type:i.A.msgType.INFO})}}}}else u=o.fileSystemFile,l=u||o.file,s=async function(e){return e.filter((e=>o.fileSystemFile?e.fileSystemFile===o.fileSystemFile:e.file===o.file))},a=async function(){const e=await t.map.exportFeatures(f,{fileName:l,format:h});switch(y(),h){case i.A.format.SHAPEFILE:c.A.downloadBlob(l,e);break;case i.A.format.GEOPACKAGE:c.A.downloadFile(l,"application/geopackage+sqlite3",e);break;case i.A.format.KMZ:c.A.downloadBlob(l,e);break;default:{const t=i.A.mimeType[h];c.A.downloadFile(l,t,e);break}}};if(l){h=c.A.getFormatFromFileExtension(u?.substr(u.lastIndexOf("."))),h||(h=c.A.getFormatFromFileExtension(l.substr(l.lastIndexOf(".")))),!h&&o.file&&(h=c.A.getFormatFromFileExtension(o.file.substr(o.file.lastIndexOf(".")))),h||(h=c.A.getFormatFromFileExtension(o.fileSystemFile.substr(o.fileSystemFile.lastIndexOf(".")))),h===i.A.format.GML&&(h=i.A.format.GML32);const e=await s(t.map.workLayers);f=e.map((e=>e.features)).flat();const r=e.filter((e=>e!==o));r.length&&!n.A.confirm(t.getLocaleString("fileSave.otherLayers.confirm",{layerList:r.map((e=>e.getPath().join(t.TITLE_SEPARATOR)||e.title)).join(", ")}))||(await a(),t.#Sr())}}#vr(e){return this.#yr.get(e)||{}}#Ar(e,t){const r=this.#vr(e);this.#yr.set(e,{...r,...t})}async markAsSaved(e){const t=e||await self.getLayer();w.delete(t)}async#Sr(){const e=this,t=await e.getLayer(),r=!t||!(t._fileHandle&&!t._additionalFileHandles?.length||t.fileSystemFile||t.file),n=!t||t._additionalFileHandles?.length;e.saveButton.disabled=r,e.saveAsButton&&(e.saveAsButton.disabled=n)}updateModel(){const e=this;e.model.save=e.getLocaleString("save"),e.model.saveAs=e.getLocaleString("saveAs"),e.panel&&e.panel.setTitles({main:e.getLocaleString("editFeatures")})}async updateLanguage(){this.updateModel()}}C.prototype.CLASS="tc-ctl-fedit",customElements.get(_)||customElements.define(_,C),n.A.control.FileEdit=C;const b=C},3790:(e,t,r)=>{e.exports=function e(t,r,n){function i(a,s){if(!r[a]){if(!t[a]){if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};t[a][0].call(c.exports,(function(e){return i(t[a][1][e]||e)}),c,c.exports,e,t,r,n)}return r[a].exports}for(var o=void 0,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(e,t,n){(function(e){"use strict";var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(u),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var l=new e.MessageChannel;l.port1.onmessage=u,r=function(){l.port2.postMessage(0)}}var c=[];function u(){var e,t;n=!0;for(var r=c.length;r;){for(t=c,c=[],e=-1;++e<r;)t[e]();r=c.length}n=!1}t.exports=function(e){1!==c.push(e)||n||r()}}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,r){"use strict";var n=e(1);function i(){}var o={},a=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==i&&p(this,e)}function u(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function h(e,t,r){n((function(){var n;try{n=t(r)}catch(t){return o.reject(e,t)}n===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,n)}))}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function p(e,t){var r=!1;function n(t){r||(r=!0,o.reject(e,t))}function i(t){r||(r=!0,o.resolve(e,t))}var a=g((function(){t(i,n)}));"error"===a.status&&n(a.value)}function g(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}t.exports=c,c.prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var r=new this.constructor(i);return this.state!==l?h(r,this.state===s?e:t,this.outcome):this.queue.push(new u(r,e,t)),r},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var r=g(d,t);if("error"===r.status)return o.reject(e,r.value);var n=r.value;if(n)p(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=a,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:o.resolve(new this(i),e)},c.reject=function(e){var t=new this(i);return o.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var a=new Array(r),s=0,l=-1,c=new this(i);++l<r;)u(e[l],l);return c;function u(e,i){t.resolve(e).then((function(e){a[i]=e,++s!==r||n||(n=!0,o.resolve(c,a))}),(function(e){n||(n=!0,o.reject(c,e))}))}},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r,n=e.length,a=!1;if(!n)return this.resolve([]);for(var s=-1,l=new this(i);++s<n;)r=e[s],t.resolve(r).then((function(e){a||(a=!0,o.resolve(l,e))}),(function(e){a||(a=!0,o.reject(l,e))}));return l}},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==r.g?r.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var i=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var r=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)r.append(e[n]);return r.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var a=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,r){"function"==typeof t&&e.then(t),"function"==typeof r&&e.catch(r)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var h="local-forage-detect-blob-support",d=void 0,p={},g=Object.prototype.toString,f="readonly",m="readwrite";function y(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<t;i++)n[i]=e.charCodeAt(i);return r}function v(e){return"boolean"==typeof d?a.resolve(d):function(e){return new a((function(t){var r=e.transaction(h,m),n=o([""]);r.objectStore(h).put(n,"key"),r.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},r.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),r=navigator.userAgent.match(/Edge\//);t(r||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function A(e){var t=p[e.name],r={};r.promise=new a((function(e,t){r.resolve=e,r.reject=t})),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then((function(){return r.promise})):t.dbReady=r.promise}function S(e){var t=p[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function E(e,t){var r=p[e.name].deferredOperations.pop();if(r)return r.reject(t),r.promise}function w(e,t){return new a((function(r,n){if(p[e.name]=p[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return r(e.db);A(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var a=i.open.apply(i,o);t&&(a.onupgradeneeded=function(t){var r=a.result;try{r.createObjectStore(e.storeName),t.oldVersion<=1&&r.createObjectStore(h)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),n(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},r(t),S(e)}}))}function _(e){return w(e,!1)}function L(e){return w(e,!0)}function C(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||r){if(r){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function b(e){return o([y(atob(e.data))],{type:e.type})}function T(e){return e&&e.__local_forage_encoded_blob}function x(e){var t=this,r=t._initReady().then((function(){var e=p[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(r,e,e),r}function P(e,t,r,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);r(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return a.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),L(e)})).then((function(){return function(e){A(e);for(var t=p[e.name],r=t.forages,n=0;n<r.length;n++){var i=r[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,_(e).then((function(t){return e.db=t,C(e)?L(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=n})).catch((function(t){throw E(e,t),t}))}(e).then((function(){P(e,t,r,n-1)}))})).catch(r);r(i)}}var M={_driver:"asyncStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]=e[n];var i=p[r.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},p[r.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=x);var o=[];function s(){return a.resolve()}for(var l=0;l<i.forages.length;l++){var c=i.forages[l];c!==t&&o.push(c._initReady().catch(s))}var u=i.forages.slice(0);return a.all(o).then((function(){return r.db=i.db,_(r)})).then((function(e){return r.db=e,C(r,t._defaultConfig.version)?L(r):e})).then((function(e){r.db=i.db=e,t._dbInfo=r;for(var n=0;n<u.length;n++){var o=u[n];o!==t&&(o._dbInfo.db=r.db,o._dbInfo.version=r.version)}}))},_support:function(){try{if(!i||!i.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){P(r._dbInfo,f,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var r=a.result;if(r){var n=r.value;T(n)&&(n=b(n));var i=e(n,r.key,s++);void 0!==i?t(i):r.continue()}else t()},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,t),n},getItem:function(e,t){var r=this;e=c(e);var n=new a((function(t,n){r.ready().then((function(){P(r._dbInfo,f,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),T(e)&&(e=b(e)),t(e)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,t),n},setItem:function(e,t,r){var n=this;e=c(e);var i=new a((function(r,i){var o;n.ready().then((function(){return o=n._dbInfo,"[object Blob]"===g.call(t)?v(o.db).then((function(e){return e?t:(r=t,new a((function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:r.type})},n.readAsBinaryString(r)})));var r})):t})).then((function(t){P(n._dbInfo,m,(function(o,a){if(o)return i(o);try{var s=a.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var l=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),r(t)},a.onabort=a.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return s(i,r),i},removeItem:function(e,t){var r=this;e=c(e);var n=new a((function(t,n){r.ready().then((function(){P(r._dbInfo,m,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){n(a.error)},o.onabort=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){P(t._dbInfo,m,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,e),r},length:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){P(t._dbInfo,f,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,e),r},key:function(e,t){var r=this,n=new a((function(t,n){e<0?t(null):r.ready().then((function(){P(r._dbInfo,f,(function(i,o){if(i)return n(i);try{var a=o.objectStore(r._dbInfo.storeName),s=!1,l=a.openKeyCursor();l.onsuccess=function(){var r=l.result;r?0===e||s?t(r.key):(s=!0,r.advance(e)):t(null)},l.onerror=function(){n(l.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,t),n},keys:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){P(t._dbInfo,f,(function(n,i){if(n)return r(n);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];o.onsuccess=function(){var t=o.result;t?(a.push(t.key),t.continue()):e(a)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){var o=e.name===n.name&&this._dbInfo.db?a.resolve(this._dbInfo.db):_(e).then((function(t){var r=p[e.name],n=r.forages;r.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));r=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var r=t.version+1;A(e);var n=p[e.name],o=n.forages;t.close();for(var s=0;s<o.length;s++){var l=o[s];l._dbInfo.db=null,l._dbInfo.version=r}var c=new a((function(t,n){var o=i.open(e.name,r);o.onerror=function(e){o.result.close(),n(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}));return c.then((function(e){n.db=e;for(var t=0;t<o.length;t++){var r=o[t];r._dbInfo.db=e,S(r._dbInfo)}})).catch((function(t){throw(E(e,t)||a.resolve()).catch((function(){})),t}))}})):o.then((function(t){A(e);var r=p[e.name],n=r.forages;t.close();for(var o=0;o<n.length;o++)n[o]._dbInfo.db=null;var s=new a((function(t,r){var n=i.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),r(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}));return s.then((function(e){r.db=e;for(var t=0;t<n.length;t++)S(n[t]._dbInfo)})).catch((function(t){throw(E(e,t)||a.resolve()).catch((function(){})),t}))}))}else r=a.reject("Invalid arguments");return s(r,t),r}};var I="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:",D="arbf",N="blob",k="si08",F="ui08",G="uic8",B="si16",U="si32",q="ur16",W="ui32",H="fl32",j="fl64",V=Object.prototype.toString;function z(e){var t,r,n,i,o,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c=new ArrayBuffer(a),u=new Uint8Array(c);for(t=0;t<s;t+=4)r=I.indexOf(e[t]),n=I.indexOf(e[t+1]),i=I.indexOf(e[t+2]),o=I.indexOf(e[t+3]),u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c}function Y(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=I[r[t]>>2],n+=I[(3&r[t])<<4|r[t+1]>>4],n+=I[(15&r[t+1])<<2|r[t+2]>>6],n+=I[63&r[t+2]];return r.length%3==2?n=n.substring(0,n.length-1)+"=":r.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var $={serialize:function(e,t){var r="";if(e&&(r=V.call(e)),e&&("[object ArrayBuffer]"===r||e.buffer&&"[object ArrayBuffer]"===V.call(e.buffer))){var n,i=O;e instanceof ArrayBuffer?(n=e,i+=D):(n=e.buffer,"[object Int8Array]"===r?i+=k:"[object Uint8Array]"===r?i+=F:"[object Uint8ClampedArray]"===r?i+=G:"[object Int16Array]"===r?i+=B:"[object Uint16Array]"===r?i+=q:"[object Int32Array]"===r?i+=U:"[object Uint32Array]"===r?i+=W:"[object Float32Array]"===r?i+=H:"[object Float64Array]"===r?i+=j:t(new Error("Failed to get type for BinaryArray"))),t(i+Y(n))}else if("[object Blob]"===r){var o=new FileReader;o.onload=function(){var r="~~local_forage_type~"+e.type+"~"+Y(this.result);t(O+N+r)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(r){console.error("Couldn't convert value into a JSON string: ",e),t(null,r)}},deserialize:function(e){if(e.substring(0,9)!==O)return JSON.parse(e);var t,r=e.substring(13),n=e.substring(9,13);if(n===N&&R.test(r)){var i=r.match(R);t=i[1],r=r.substring(i[0].length)}var a=z(r);switch(n){case D:return a;case N:return o([a],{type:t});case k:return new Int8Array(a);case F:return new Uint8Array(a);case G:return new Uint8ClampedArray(a);case B:return new Int16Array(a);case q:return new Uint16Array(a);case U:return new Int32Array(a);case W:return new Uint32Array(a);case H:return new Float32Array(a);case j:return new Float64Array(a);default:throw new Error("Unkown type: "+n)}},stringToBuffer:z,bufferToString:Y};function K(e,t,r,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],r,n)}function X(e,t,r,n,i,o){e.executeSql(r,n,i,(function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,a):K(e,t,(function(){e.executeSql(r,n,i,o)}),o)}),o):o(e,a)}),o)}function Z(e,t,r,n){var i=this;e=c(e);var o=new a((function(o,a){i.ready().then((function(){void 0===t&&(t=null);var s=t,l=i._dbInfo;l.serializer.serialize(t,(function(t,c){c?a(c):l.db.transaction((function(r){X(r,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){a(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void o(Z.apply(i,[e,s,r,n-1]));a(t)}}))}))})).catch(a)}));return s(o,r),o}var J={_driver:"webSQLStorage",_initStorage:function(e){var t=this,r={db:null};if(e)for(var n in e)r[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new a((function(e,n){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(e){return n(e)}r.db.transaction((function(i){K(i,r,(function(){t._dbInfo=r,e()}),(function(e,t){n(t)}))}),n)}));return r.serializer=$,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){X(r,i,"SELECT * FROM "+i.storeName,[],(function(r,n){for(var o=n.rows,a=o.length,s=0;s<a;s++){var l=o.item(s),c=l.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},getItem:function(e,t){var r=this;e=c(e);var n=new a((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){X(r,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},setItem:function(e,t,r){return Z.apply(this,[e,t,r,1])},removeItem:function(e,t){var r=this;e=c(e);var n=new a((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){X(r,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},clear:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){X(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},length:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){X(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,r){var n=r.rows.item(0).c;e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},key:function(e,t){var r=this,n=new a((function(t,n){r.ready().then((function(){var i=r._dbInfo;i.db.transaction((function(r){X(r,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,t),n},keys:function(e){var t=this,r=new a((function(e,r){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){X(t,n,"SELECT key FROM "+n.storeName,[],(function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,e),r},dropInstance:function(e,t){t=u.apply(this,arguments);var r=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||r.name,e.storeName=e.storeName||r.storeName);var n,i=this;return s(n=e.name?new a((function(t){var n;n=e.name===r.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(function(e){return new a((function(t,r){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(r,n){for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){r(t)}))}),(function(e){r(e)}))}))}(n))})).then((function(e){return new a((function(t,r){e.db.transaction((function(n){function i(e){return new a((function(t,r){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){r(t)}))}))}for(var o=[],s=0,l=e.storeNames.length;s<l;s++)o.push(i(e.storeNames[s]));a.all(o).then((function(){t()})).catch((function(e){r(e)}))}),(function(e){r(e)}))}))})):a.reject("Invalid arguments"),t),n}};function Q(e,t){var r=e.name+"/";return e.storeName!==t.storeName&&(r+=e.storeName+"/"),r}function ee(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var te={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var r in e)t[r]=e[r];return t.keyPrefix=Q(e,this._defaultConfig),ee()?(this._dbInfo=t,t.serializer=$,a.resolve()):a.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var r=this,n=r.ready().then((function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,o=localStorage.length,a=1,s=0;s<o;s++){var l=localStorage.key(s);if(0===l.indexOf(n)){var c=localStorage.getItem(l);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,l.substring(i),a++)))return c}}}));return s(n,t),n},getItem:function(e,t){var r=this;e=c(e);var n=r.ready().then((function(){var t=r._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return s(n,t),n},setItem:function(e,t,r){var n=this;e=c(e);var i=n.ready().then((function(){void 0===t&&(t=null);var r=t;return new a((function(i,o){var a=n._dbInfo;a.serializer.serialize(t,(function(t,n){if(n)o(n);else try{localStorage.setItem(a.keyPrefix+e,t),i(r)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return s(i,r),i},removeItem:function(e,t){var r=this;e=c(e);var n=r.ready().then((function(){var t=r._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(n,t),n},clear:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,r=localStorage.length-1;r>=0;r--){var n=localStorage.key(r);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return s(r,e),r},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var r=this,n=r.ready().then((function(){var t,n=r._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return s(n,t),n},keys:function(e){var t=this,r=t.ready().then((function(){for(var e=t._dbInfo,r=localStorage.length,n=[],i=0;i<r;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&n.push(o.substring(e.keyPrefix.length))}return n}));return s(r,e),r},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var r=this.config();e.name=e.name||r.name,e.storeName=e.storeName||r.storeName}var n,i=this;return n=e.name?new a((function(t){e.storeName?t(Q(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var r=localStorage.key(t);0===r.indexOf(e)&&localStorage.removeItem(r)}})):a.reject("Invalid arguments"),s(n,t),n}},re=function(e,t){for(var r=e.length,n=0;n<r;){if((i=e[n])===(o=t)||"number"==typeof i&&"number"==typeof o&&isNaN(i)&&isNaN(o))return!0;n++}var i,o;return!1},ne=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},ie={},oe={},ae={INDEXEDDB:M,WEBSQL:J,LOCALSTORAGE:te},se=[ae.INDEXEDDB._driver,ae.WEBSQL._driver,ae.LOCALSTORAGE._driver],le=["dropInstance"],ce=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(le),ue={description:"",driver:se.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function he(e,t){e[t]=function(){var r=arguments;return e.ready().then((function(){return e[t].apply(e,r)}))}}function de(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(ne(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r])}return arguments[0]}var pe=function(){function e(t){for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ae)if(ae.hasOwnProperty(r)){var n=ae[r],i=n._driver;this[r]=i,ie[i]||this.defineDriver(n)}this._defaultConfig=de({},ue),this._config=de({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new a((function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void r(i);for(var o=ce.concat("_initStorage"),l=0,c=o.length;l<c;l++){var u=o[l];if((!re(le,u)||e[u])&&"function"!=typeof e[u])return void r(i)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),r=a.reject(t);return s(r,arguments[arguments.length-1]),r}},r=0,n=le.length;r<n;r++){var i=le[r];e[i]||(e[i]=t(i))}}();var h=function(r){ie[n]&&console.info("Redefining LocalForage driver: "+n),ie[n]=e,oe[n]=r,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,r):h(!!e._support):h(!0)}catch(e){r(e)}}));return l(n,t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,r){var n=ie[e]?a.resolve(ie[e]):a.reject(new Error("Driver not found."));return l(n,t,r),n},e.prototype.getSerializer=function(e){var t=a.resolve($);return l(t,e),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(r,e,e),r},e.prototype.setDriver=function(e,t,r){var n=this;ne(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){n._config.driver=n.driver()}function s(e){return n._extend(e),o(),n._ready=n._initStorage(n._config),n._ready}var c=null!==this._driverSet?this._driverSet.catch((function(){return a.resolve()})):a.resolve();return this._driverSet=c.then((function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){var t=0;return function r(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(s).catch(r)}o();var l=new Error("No available storage method found.");return n._driverSet=a.reject(l),n._driverSet}()}}(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return n._driverSet=a.reject(e),n._driverSet})),l(this._driverSet,t,r),this._driverSet},e.prototype.supports=function(e){return!!oe[e]},e.prototype._extend=function(e){de(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;r<n;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=ce.length;e<t;e++)he(this,ce[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),ge=new pe;t.exports=ge},{3:3}]},{},[4])(4)},3791:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(8038),i=r(3301);class o{#Er;constructor(e){this.#Er=new Map,this.#wr(e)}#wr(e){e&&(e instanceof Array?[...e,...e.reduce(((e,t)=>e.concat(...t.querySelectorAll("*"))),[])]:[e,...e.querySelectorAll("*")]).forEach((e=>{Array.from(e.attributes).forEach((t=>{let r;null!=(r=/\[{2}\s*(?<key>.+)\s*\]{2}/gim.exec(t.value))&&this.#_r(r.groups.key,{node:e,attribute:t.name,get:function(){return e.attributes[t.name].value},set:function(r){e.setAttribute(t.name,r)}}),t.name.toLowerCase().startsWith("tc-vc-")&&"tc-vc-model"===t.name.toLowerCase()&&this.#_r(t.value,{node:e,get:function(){return e.value},set:function(t){e.value=t}})})),function(e){let t=[];return function e(r){t.push(r);for(let t=0;t<r.childNodes.length;t++)e(r.childNodes[t])}(e),t}(e).filter((e=>3===e.nodeType)).forEach((e=>{let t;null!=(t=/\[{2}\s*(?<key>.+)\s*\]{2}/gim.exec(e.textContent))&&(e._original=e.textContent,this.#_r(t.groups.key,{node:e,get:function(e){return e.textContent},set:function(e,r){e?.match(/.*\<.+\>/gm)?(Array.from(r.parentElement.childNodes).filter((e=>e!==r)).forEach((e=>e.remove())),r.parentElement.insertAdjacentHTML("beforeend",e),r.textContent=""):r.textContent=i.A.htmlToText(r._original.replace(t[0],e))}}))}))}))}#_r(e,t){this.#Er.has(e)?this.#Er.get(e).find((e=>t.node===e.node&&t.attribute===e.attribute))||this.#Er.set(e,[...this.#Er.get(e),t]):this.#Er.set(e,[t]),Object.prototype.hasOwnProperty.call(this,e)||Object.defineProperty(this,e,{get:function(){const t=this.#Er.get(e)[0];return t.get(t.node)},set:function(t){this.#Er.get(e).forEach(((e,r)=>{e.set(t,e.node)}))},enumerable:!0,configurable:!0})}add(e){this.#wr(e)}addListener(e,t){this.#_r(e,t)}}n.A.mvc=n.A.mvc||{},n.A.mvc.Observer=o;const a=o},3833:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(5777),c=r(3791);n.A.control=n.A.control||{},i.A.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";let u=i.A.url.GOOGLEMAPS;o.A.proxyExceptions=o.A.proxyExceptions||[],o.A.proxyExceptions.push(i.A.url.GOOGLEMAPS);var h=0;class d{constructor(){this["sv.tip"]="",this.closeStreetView=""}}class p extends s.A{viewDiv=null;#Lr=null;#Cr=null;#ir;#br;register(e){const t=this;t.viewDiv||(t.viewDiv=a.A.getDiv(t.options.viewDiv),t.viewDiv.classList.add(t.CLASS+"-view",i.A.classes.HIDDEN),t.options.viewDiv||e.div.insertAdjacentElement("beforebegin",t.viewDiv));const r=super.register.call(t,e);t.model=new d,t.mapDiv=t.map.div,t.getCoordinateFromPixel=t.map.wrap.getCoordinateFromPixel;let o="SV_"+(Math.random()+1).toString(36).substring(7);window[o]=function(){delete window[o]};const s=t.options.googleMapsKey||e.options.googleMapsKey;s&&(u+="&key="+s+"&callback="+o),t.layer=null,t.ThreeDMarker=null;for(var l=t.getUID(),c=0;c<e.workLayers.length;c++){var h=e.workLayers[c];if(h.type===i.A.layerType.VECTOR&&h.id===l){t.layer=h;break}}return t.layer||e.loaded((function(){e.addLayer({id:l,owner:t,stealth:!0,type:i.A.layerType.VECTOR}).then((function(e){t.layer=e}))})),t.renderPromise().then((function(){t.viewDiv.querySelector("."+t.CLASS+"-btn-close").addEventListener(i.A.event.CLICK,(function(e){e.stopPropagation(),t.closeView()}),{passive:!0})}),(function(){n.A.error("Error de renderizado StreetView")})),e.on(i.A.event.VIEWCHANGE,(function(e){const r=e.view;r===i.A.view.THREED?(t.mapDiv=this.view3D.container,t.getCoordinateFromPixel=e=>{const t=this.view3D.Coordinates2DTo3D(e);return[t.lon,t.lat]}):r===i.A.view.DEFAULT&&(t.mapDiv=this.div,t.getCoordinateFromPixel=t.map.wrap.getCoordinateFromPixel)})),e.on(i.A.event.THREED_DRAG,(function(e){e.pickedFeature===t.ThreeDMarker&&(t.#Cr=e.oldCoords,t.#Lr.setPosition({lng:e.newCoords[0],lat:e.newCoords[1]}))})),r}#Tr(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1),(this.map.div.querySelector("canvas")||window).dispatchEvent(e)}#xr(){const e=this;e.div.querySelector("."+e.CLASS+"-btn").classList.add(i.A.classes.CHECKED),e.mapDiv.classList.add(e.CLASS+"-active")}#Pr(){const e=this,t=e.viewDiv,r=function(){t.removeEventListener("transitionend",r),e.#Tr()};t.addEventListener("transitionend",r),setTimeout((function(){e.#Tr()}),1e3),e.map.on3DView&&e.ThreeDMarker?(e.ThreeDMarker.show=!1,e.map.view3D.getScene().requestRender()):e.layer.clearFeatures(),e.div.querySelector("."+e.CLASS+"-btn").classList.remove(i.A.classes.CHECKED),e.div.querySelector("."+e.CLASS+"-drag").classList.remove(i.A.classes.HIDDEN),e.mapDiv.classList.remove(e.CLASS+"-active"),e.#Cr=null}#Mr(){const e=this;var t=!1;const r=e.div.querySelector("."+e.CLASS+"-btn"),n=e.div.querySelector("."+e.CLASS+"-drag");var o=r.getBoundingClientRect(),a=n.getBoundingClientRect();if(n.classList.add(i.A.classes.HIDDEN),a.top<o.top||a.top>o.bottom||a.left<o.left||a.left>o.right){t=!0;var s=e.map.getExtent(),l=[s[2],s[3]];if(!e.map.on3DView)for(var c=0;c<16;c++)e.layer.addMarker(l,{id:"pegman",cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=e.mapDiv.getBoundingClientRect(),h=(a.left+a.right)/2-u.left,d=a.bottom-u.top,p=e.getCoordinateFromPixel([h,d]);e.callback(p)}else e.#Pr();return t}async loadTemplates(){const e=this,t=r.e(4264).then(r.bind(r,4264)),n=r.e(3478).then(r.bind(r,3478)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-view"]=(await n).default,e.template=i}async render(){const e=this;e.viewDiv.innerHTML=await e.getRenderedHtml(e.CLASS+"-view",null),await e.renderData(null),e.controller=new l.A(e.model,new c.A(e.div)),e.controller.add(e.viewDiv),e.updateModel(),r.e(5587).then(r.t.bind(r,5587,23)).then((function(t){const r=new(0,t.default)(e.div.querySelector("."+e.CLASS+"-drag"),{containment:e.getMapDiv&&e.mapDiv||e.map.div});r.on("dragStart",(function(t){e.#xr()})),r.on("dragEnd",(function(t){e.#Mr(),r.setPosition(0,0)})),e.div.querySelector("."+e.CLASS+"-btn").addEventListener("click",(function(t){const r=t.target.getBoundingClientRect();console.log(r),t.clientX>=r.left&&t.clientX<=r.right&&t.clientY>=r.top&&t.clientY<=r.bottom&&e.map.toast(e.getLocaleString("sv.instructions"),{type:n.A.Consts.msgType.INFO})}))}))}callback(e){const t=this;var r="EPSG:4326",o=function(e){if(t.#Lr){var n=e.getBounds();const i=a.A.reproject([(n[0]+n[2])/2,(n[1]+n[3])/2],t.map.getCrs(),r);t.#Lr.setPosition({lng:i[0],lat:i[1]})}},s=function(e){if(t.#Lr){var n=e.getBounds();t.#Cr=a.A.reproject([(n[0]+n[2])/2,(n[1]+n[3])/2],t.map.getCrs(),r)}},l=t.map.getLoadingIndicator();l&&(h=l.addWait(h));const c=t.mapDiv;var d=function(n,l){var u,h;if(t.layer.clearFeatures(),n){var d=n.getPosition();u=a.A.reproject([d.lng(),d.lat()],r,t.map.getCrs()),h=n.getPov().heading}else u=e,h=0;if(t.map.on3DView?t.ThreeDMarker=t.map.view3D.setMarker(u,a.A.getFeatureStyleFromCss("tc-marker-sv-"+(Math.round(16*h/360)+16)%16)?.url,t.ThreeDMarker):(t.map.addMarker(u,{cssClass:"tc-marker-sv-"+(Math.round(16*h/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:t.layer,showsPopup:!1}),Promise.all(t.map._markerPromises).then((function(){t.layer.wrap.setDraggable(!0,o,s)}))),l){var p=function(){t.map.on3DView?t.map.view3D.setCenter(u):t.map.setCenter(u)};c.classList.contains(i.A.classes.COLLAPSED)?p():setTimeout(p,1200)}};n.A.loadJS(!window.google||!google.maps,u+"&language="+t.map.options.locale.substr(0,2),(function(){if(window.google){d();const o=t.viewDiv,s=a.A.reproject(e,t.map.getCrs(),r),u=new google.maps.LatLng(s[1],s[0]);(new google.maps.StreetViewService).getPanorama({location:u,preference:google.maps.StreetViewPreference.BEST},(function(e,r){if(r!==google.maps.StreetViewStatus.OK)l&&l.removeWait(h),setTimeout((function(){n.A.alert(r===google.maps.StreetViewStatus.ZERO_RESULTS?t.getLocaleString("noStreetView"):t.getLocaleString("streetViewUnknownError")),t.layer.wrap.setDraggable(!1),t.#Pr()}),100);else{const e=function(r){if(t.#br&&("width"===r.propertyName||"height"===r.propertyName)){t.#br=!1,l&&l.removeWait(h);const r=document.createEvent("HTMLEvents");r.initEvent("resize",!1,!1),c.dispatchEvent(r),t.#Tr(),o.removeEventListener("transitionend",e);var s={position:u,pov:{heading:0,pitch:0},zoom:1,fullscreenControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},imageDateControl:!0};t.#Lr?(t.#Lr.setOptions(s),t.#Lr.setVisible(!0)):(t.#Lr=new google.maps.StreetViewPanorama(o,s),google.maps.event.addListener(t.#Lr,"position_changed",(function(){d(t.#Lr,o.classList.contains(i.A.classes.VISIBLE))})),t.managePOVChange=function(){var e;e=t.map.on3DView?(t.#Lr.getPov().heading||360)-t.map.view3D.getCameraData().heading:t.#Lr.getPov().heading,function(e){if(t.map.on3DView)t.ThreeDMarker?.setImage(1e3*Math.random(),a.A.getFeatureStyleFromCss(e)?.url);else if(t.layer.features&&t.layer.features.length>0){var r=t.layer.features[0];delete r.options.url,r.options.cssClass=e,r.setStyle(r.options)}}("tc-marker-sv-"+(Math.round(16*e/360)+16)%16)},t.map.on(i.A.event.CAMERACHANGE,t.managePOVChange),google.maps.event.addListener(t.#Lr,"pov_changed",t.managePOVChange),google.maps.event.addListener(t.#Lr,"status_changed",(function(){var e=t.#Lr.getStatus();e!==google.maps.StreetViewStatus.OK&&(t.#Lr.setVisible(!1),n.A.alert(e===google.maps.StreetViewStatus.ZERO_RESULTS?t.getLocaleString("noStreetView"):t.getLocaleString("streetViewUnknownError")),t.#Cr?(t.#Lr.setVisible(!0),t.#Lr.setPosition({lng:t.#Cr[0],lat:t.#Cr[1]})):(t.layer.wrap.setDraggable(!1),t.closeView()))})))}};if(t.#br=!0,o.addEventListener("transitionend",e),!t.options.viewDiv||!c.classList.contains(i.A.classes.FULL_SCREEN)){const e=c.getBoundingClientRect();t.viewDiv.style.height=e.height+"px",t.viewDiv.style.width=e.width+"px"}const r=parseInt(window.getComputedStyle(c).zIndex,10);c.classList.add(i.A.classes.COLLAPSED),c.style.width=t.options.ovmapW||"25vh",c.style.height=t.options.ovmapH||"25vh",t.map.on3DView&&(t.map.div.style.display="none"),o.style.left="",o.style.top="",o.classList.remove(i.A.classes.HIDDEN),o.classList.add(i.A.classes.VISIBLE);const s=parseInt(window.getComputedStyle(o).zIndex,10);r<=s&&(c.style.zIndex=s+1),setTimeout((function(){e({propertyName:"width"})}),1e3);const p=document.body.querySelector("header");p&&(p.style.display="none"),t.map.activeControl&&(t.#ir=t.map.activeControl,t.map.activeControl.deactivate(!0)),d(t.#Lr)}}))}else t.#Pr()}),!1,!0)}closeView(){const e=this,t=e.mapDiv,r=e.viewDiv,n=function(){t.classList.remove(i.A.classes.COLLAPSED),t.style.width=t.style.height=t.style.zIndex="",e.map.on3DView&&(e.map.div.style.display="");const r=document.createEvent("HTMLEvents");r.initEvent("resize",!1,!1),t.dispatchEvent(r),e.map.off(i.A.event.CAMERACHANGE,e.managePOVChange)},o="transitionend",a=function(e){"width"!==e.propertyName&&"height"!==e.propertyName||(r.removeEventListener(o,a),n())};r.removeEventListener(o,a),r.addEventListener(o,a),setTimeout(n,1e3),e.options.viewDiv||(e.viewDiv.style.removeProperty("height"),e.viewDiv.style.removeProperty("width")),r.classList.add(i.A.classes.HIDDEN),r.classList.remove(i.A.classes.VISIBLE),r.style.height=r.style.width="",e.div.querySelector("."+e.CLASS+"-drag").classList.remove(i.A.classes.HIDDEN),e.layer.wrap.setDraggable(!1),e.#Pr(),e.#Lr.setVisible(!1);const s=document.body.querySelector("header");s&&(s.style.display=""),e.#ir&&e.#ir.activate()}updateModel(){this.model["sv.tip"]=this.getLocaleString("sv.tip"),this.model.closeStreetView=this.getLocaleString("closeStreetView")}async updateLanguage(){this.updateModel()}}p.prototype.CLASS="tc-ctl-sv",n.A.control.StreetView=p;const g=p},3939:e=>{var t,r;t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&r.rotl(e,8)|4278255360&r.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=r.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],r=0,n=0;r<e.length;r++,n+=8)t[n>>>5]|=e[r]<<24-n%32;return t},wordsToBytes:function(e){for(var t=[],r=0;r<32*e.length;r+=8)t.push(e[r>>>5]>>>24-r%32&255);return t},bytesToHex:function(e){for(var t=[],r=0;r<e.length;r++)t.push((e[r]>>>4).toString(16)),t.push((15&e[r]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(parseInt(e.substr(r,2),16));return t},bytesToBase64:function(e){for(var r=[],n=0;n<e.length;n+=3)for(var i=e[n]<<16|e[n+1]<<8|e[n+2],o=0;o<4;o++)8*n+6*o<=8*e.length?r.push(t.charAt(i>>>6*(3-o)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],n=0,i=0;n<e.length;i=++n%4)0!=i&&r.push((t.indexOf(e.charAt(n-1))&Math.pow(2,-2*i+8)-1)<<2*i|t.indexOf(e.charAt(n))>>>6-2*i);return r}},e.exports=r},3942:(e,t,r)=>{"use strict";r.d(t,{Dm:()=>E,Gl:()=>S,I8:()=>c,NQ:()=>C,OL:()=>A,Tb:()=>p,UN:()=>w,VT:()=>d,Vh:()=>h,X1:()=>v,YE:()=>P,c4:()=>g,eY:()=>_,gN:()=>y,kW:()=>f,mT:()=>a,mc:()=>x,mm:()=>m,pF:()=>i,qg:()=>u,qq:()=>o,wz:()=>l});var n=r(6514);const i="http://www.w3.org/2001/XMLSchema-instance";function o(e,t){return P().createElementNS(e,t)}function a(e,t){return s(e,t,[]).join("")}function s(e,t,r){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?r.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):r.push(e.nodeValue);else{let n;for(n=e.firstChild;n;n=n.nextSibling)s(n,t,r)}return r}function l(e){return"documentElement"in e}function c(e,t,r){return e.getAttributeNS(t,r)||""}function u(e){return(new DOMParser).parseFromString(e,"application/xml")}function h(e,t){return function(r,i){const o=e.call(t??this,r,i);if(void 0!==o){const e=i[i.length-1];(0,n.X$)(e,o)}}}function d(e,t){return function(r,n){const i=e.call(t??this,r,n);void 0!==i&&n[n.length-1].push(i)}}function p(e,t){return function(r,n){const i=e.call(t??this,r,n);void 0!==i&&(n[n.length-1]=i)}}function g(e,t,r){return function(n,i){const o=e.call(r??this,n,i);if(void 0!==o){const e=i[i.length-1],r=void 0!==t?t:n.localName;let a;r in e?a=e[r]:(a=[],e[r]=a),a.push(o)}}}function f(e,t,r){return function(n,i){const o=e.call(r??this,n,i);void 0!==o&&(i[i.length-1][void 0!==t?t:n.localName]=o)}}function m(e,t){return function(r,n,i){e.call(t??this,r,n,i),i[i.length-1].node.appendChild(r)}}function y(e,t){let r,n;return function(t,i,o){if(void 0===r){r={};const i={};i[t.localName]=e,r[t.namespaceURI]=i,n=v(t.localName)}L(r,n,i,o)}}function v(e,t){return function(r,n,i){const a=n[n.length-1].node;let s=e;return void 0===s&&(s=i),o(void 0!==t?t:a.namespaceURI,s)}}const A=v();function S(e,t){const r=t.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=e[t[i]];return n}function E(e,t,r){let n,i;for(r=void 0!==r?r:{},n=0,i=e.length;n<i;++n)r[e[n]]=t;return r}function w(e,t,r,n){let i;for(i=t.firstElementChild;i;i=i.nextElementSibling){const t=e[i.namespaceURI];if(void 0!==t){const e=t[i.localName];void 0!==e&&e.call(n,i,r)}}}function _(e,t,r,n,i){return n.push(e),w(t,r,n,i),n.pop()}function L(e,t,r,n,i,o){const a=(void 0!==i?i:r).length;let s,l;for(let c=0;c<a;++c)s=r[c],void 0!==s&&(l=t.call(o,s,n,void 0!==i?i[c]:void 0),void 0!==l&&e[l.namespaceURI][l.localName].call(o,l,s,n))}function C(e,t,r,n,i,o,a){return i.push(e),L(t,r,n,i,o,a),i.pop()}let b,T;function x(){return void 0===b&&"undefined"!=typeof XMLSerializer&&(b=new XMLSerializer),b}function P(){return void 0===T&&"undefined"!=typeof document&&(T=document.implementation.createDocument("","",null)),T}},3953:(e,t,r)=>{"use strict";r.d(t,{HX:()=>a,MD:()=>o,c:()=>s,n:()=>l,oW:()=>c,te:()=>u});var n=r(1597);function i(e,t,r,i,o,a,s){const l=e[t],c=e[t+1],u=e[r]-l,h=e[r+1]-c;let d;if(0===u&&0===h)d=t;else{const p=((o-l)*u+(a-c)*h)/(u*u+h*h);if(p>1)d=r;else{if(p>0){for(let o=0;o<i;++o)s[o]=(0,n.Cc)(e[t+o],e[r+o],p);return void(s.length=i)}d=t}}for(let t=0;t<i;++t)s[t]=e[d+t];s.length=i}function o(e,t,r,i,o){let a=e[t],s=e[t+1];for(t+=i;t<r;t+=i){const r=e[t],i=e[t+1],l=(0,n.hG)(a,s,r,i);l>o&&(o=l),a=r,s=i}return o}function a(e,t,r,n,i){for(let a=0,s=r.length;a<s;++a){const s=r[a];i=o(e,t,s,n,i),t=s}return i}function s(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){const s=r[o];i=a(e,t,s,n,i),t=s[s.length-1]}return i}function l(e,t,r,o,a,s,l,c,u,h,d){if(t==r)return h;let p,g;if(0===a){if(g=(0,n.hG)(l,c,e[t],e[t+1]),g<h){for(p=0;p<o;++p)u[p]=e[t+p];return u.length=o,g}return h}d=d||[NaN,NaN];let f=t+o;for(;f<r;)if(i(e,f-o,f,o,l,c,d),g=(0,n.hG)(l,c,d[0],d[1]),g<h){for(h=g,p=0;p<o;++p)u[p]=d[p];u.length=o,f+=o}else f+=o*Math.max((Math.sqrt(g)-Math.sqrt(h))/a|0,1);if(s&&(i(e,r-o,t,o,l,c,d),g=(0,n.hG)(l,c,d[0],d[1]),g<h)){for(h=g,p=0;p<o;++p)u[p]=d[p];u.length=o}return h}function c(e,t,r,n,i,o,a,s,c,u,h){h=h||[NaN,NaN];for(let d=0,p=r.length;d<p;++d){const p=r[d];u=l(e,t,p,n,i,o,a,s,c,u,h),t=p}return u}function u(e,t,r,n,i,o,a,s,l,u,h){h=h||[NaN,NaN];for(let d=0,p=r.length;d<p;++d){const p=r[d];u=c(e,t,p,n,i,o,a,s,l,u,h),t=p[p.length-1]}return u}},3967:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(8991);n.A.control=n.A.control||{};class l extends a.A{#Ir={};constructor(){super(...arguments),this.layerTrees={}}async render(e,t){const r=this;if(!r.map)throw Error("Cannot render: control has no map");let n;n=r.map?.isLoaded?t?o.A.extend(r.map.getLayerTree(),t):r.map.getLayerTree():t,await r.renderData(n),r.addUIEventListeners(),o.A.isFunction(e)&&e()}async register(e){const t=this;return await super.register.call(t,e),e.loaded((()=>{e.layers.forEach((e=>t.updateLayerTree(e)))})),e.on(i.A.event.ZOOM+" "+i.A.event.PROJECTIONCHANGE,(function(){t.updateScale()})).on(i.A.event.UPDATEPARAMS,(function(e){const r=e.layer;var i=r.names;!function e(t){var r=!1;if(t)if(i.indexOf(t.name)>=0)r=!0;else for(var n=0;n<t.children.length;n++)if(e(t.children[n])){r=!0;break}return r}(t.layerTrees[r.id])&&0!==i.length?t.updateLayerTree(r):t.update(t instanceof n.A.control.BasemapSelector?void 0:r)})).on(i.A.event.LAYERVISIBILITY,(function(e){t.updateLayerVisibility(e.layer)})).on(i.A.event.LAYERADD,(function(e){t.updateLayerTree(e.layer)})).on(i.A.event.VECTORUPDATE+" "+i.A.event.FEATUREADD+" "+i.A.event.FEATURESADD,(function(e){const r=e.layer;t.#Ir[r.id]&&clearTimeout(t.#Ir[r.id]),t.#Ir[r.id]=setTimeout((function(){t.map.workLayers.indexOf(r)>-1&&(t.updateLayerTree(r),delete t.#Ir[r.id])}),100)})).on(i.A.event.LAYERREMOVE,(function(e){t.removeLayer(e.layer)})).on(i.A.event.LAYERORDER,(function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)})).on(i.A.event.LAYERERROR,(function(e){t.onErrorLayer(e.layer)})),t}updateScale(){}updateLayerVisibility(e){}updateLayerTree(e){e.tree=null,this.layerTrees[e.id]=e.getTree()}updateLayerOrder(e,t,r,n){const i=this;if(t>=0&&t!==r){var o,a;const t=i.getLayerUIElements();for(var s=(n=n||i.map.workLayers).length-1;s>=0;s--){const r=n[s];a=o;for(var l=0,c=t.length;l<c;l++){const e=t[l];if(e.dataset.layerId===r.id){o=e;break}}if(r===e){o&&(a?a.insertAdjacentElement("afterend",o):o.parentElement.firstChild.insertAdjacentElement("beforebegin",o));break}}}}removeLayer(e){const t=this,r=t.getLayerUIElements();for(var n=0,o=r.length;n<o;n++){const t=r[n];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}0===t.getLayerUIElements().length&&t.div.querySelector("."+t.CLASS+"-empty").classList.remove(i.A.classes.HIDDEN)}onErrorLayer(e){}getLayerUIElements(){return this.div.querySelector("ul").children}styleLegendImage(e,t){if(!e.getAttribute("src")){var r=e.dataset.img;if(r.startsWith("data"))return void(e.src=r);const d=new s.default(n.A.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then((function(t){e.src=t})).catch((function(e){n.A.error(e.statusText||e)}));else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){const i=e.parentElement;var a=i.style.color,l=a.indexOf("("),c=a.indexOf(")");if(l>=0&&c>l){let e=a.substr(0,c).substr(l+1).split(",");a="0x";for(var u=0;u<3;u++){var h=parseInt(e[u]).toString(16);a+=1===h.length?"0"+h:h}}else a.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+i.style.fontFamily+";fontSize:"+parseInt(i.style.fontSize)+";fontColor:"+a+";fontAntiAliasing:true",t.params&&t.params.sld_body&&(r=o.A.addURLParameters(r,{sld_body:t.params.sld_body})),d.fetchImage(r).then((function(e){e.dataset.img=e.src})).catch((function(e){n.A.error(e.statusText||e)}))}d.fetchImage(r).then((function(t){e.src=t.src})).catch((function(a){!a.status||404!==a.status&&401!==a.status?d._image.ErrorType.UNEXPECTEDCONTENTTYPE===a.message?(n.A.error(o.A.getLocaleString(t.map.options.locale,"simbologyNotCompatible")),e.src=i.A.BLANK_IMAGE):n.A.error(a):n.A.error(o.A.getLocaleString(t.map.options.locale,"simbologyImgNotFound",{url:r}))}))}}}}l.prototype.CLASS="tc-ctl-mc",n.A.control.MapContents=l;const c=l},4049:(e,t,r)=>{"use strict";r.d(t,{C:()=>i});var n=r(915);function i(e,t,r,i){const o=[];let a=(0,n.S5)();for(let s=0,l=r.length;s<l;++s){const l=r[s];a=(0,n.Vy)(e,t,l[0],i),o.push((a[0]+a[2])/2,(a[1]+a[3])/2),t=l[l.length-1]}return o}},4087:(e,t,r)=>{"use strict";function n(){throw new Error("Unimplemented abstract method.")}r.d(t,{b0:()=>n,v6:()=>o,xv:()=>a});let i=0;function o(e){return e.ol_uid||(e.ol_uid=String(++i))}const a="10.5.0"},4120:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var n=r(8450),i=r(1854),o=r(1685),a=r(3530),s=r(4087);class l extends o.Ay{constructor(e,t,r){super(e),this.key=t,this.oldValue=r}}class c extends i.A{constructor(e){super(),this.on,this.once,this.un,(0,s.v6)(this),this.values_=null,void 0!==e&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let r;r=`change:${e}`,this.hasListener(r)&&this.dispatchEvent(new l(r,e,t)),r=n.A.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new l(r,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,r){const n=this.values_||(this.values_={});if(r)n[e]=t;else{const r=n[e];n[e]=t,r!==t&&this.notify(e,r)}}setProperties(e,t){for(const r in e)this.set(r,e[r],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const r=this.values_[e];delete this.values_[e],(0,a.p)(this.values_)&&(this.values_=null),t||this.notify(e,r)}}}const u=c},4128:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(1256);n.A.control=n.A.control||{};const a=function(e,t,r,n,i){var o="message";navigator.serviceWorker.addEventListener(o,(function a(s){s.data.name===r&&(s.data.action===n&&s.data.event===i?e(r):"error"===s.data.event&&t(Error(`Error message from service worker [${s.data.url} - ${s.data.action} - ${s.data.name}]`)),"progress"!==s.data.event&&navigator.serviceWorker.removeEventListener(o,a))}))};class s extends o.A{SW_URL="tc-cb-service-worker.js";#Rr;constructor(){super(...arguments);const e=this;e.serviceWorkerEnabled=!1,e.serviceWorkerIsRequired=e.options.serviceWorkerIsRequired||!0}register(e){const t=this,r=super.register.call(t,e);return t.#Rr=new Promise((function(e,r){navigator.serviceWorker?navigator.serviceWorker.register(t.SW_URL,{updateViaCache:"none"}).then((function(r){t.serviceWorkerEnabled=!0,r.installing?e(r.installing):r.waiting?e(r.waiting):r.active&&e(r.active),console.log(r.scope,"register")}),(function(e){t.serviceWorkerEnabled=!1,r(new Error(e)),console.error("Could not register service worker: "+e)})):r(new Error("Browser does not support service workers"))})),t.#Rr.catch((()=>{let r=!1;const n=window.parent!==window;for(var o=window;!r;o=o.parent){try{"https:"!==o.location.protocol&&(r=!0)}catch(e){}if(o===o.parent)break}r?e.toast(t.getLocaleString("httpsRequired.warning",{url:location.href.replace(location.protocol,"")}),{type:i.A.msgType.WARNING}):n?e.toast(t.getLocaleString("frameOrNotCompatible.warning"),{type:i.A.msgType.WARNING}):t.serviceWorkerIsRequired&&e.toast(t.getLocaleString("browserNotCompatible.warning"),{type:i.A.msgType.WARNING})})),r}getServiceWorker(){return this.#Rr?this.#Rr:Promise.reject(new Error("No service worker available"))}createCache(e,t={}){const r=this;return new Promise((function(n,i){r.getServiceWorker().then((function(r){var o="create";a(n,i,e,o,"cached"),r.postMessage({action:o,name:e,requestId:t.requestId,list:t.urlList||[],silent:t.silent})}),(function(){n(!1)}))}))}deleteCache(e,t={}){const r=this;return new Promise((function(n,i){r.getServiceWorker().then((function(r){var o="delete";a(n,i,e,o,"deleted"),r.postMessage({action:o,requestId:t.requestId,name:e,silent:t.silent})}),(function(){n(!1)}))}))}}s.prototype.CLASS="tc-ctl-swcc",n.A.control.SWCacheClient=s;const l=s},4142:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>A,VY:()=>S,nD:()=>E});var n=r(6514),i=r(915),o=r(1597),a=r(2809),s=r(4294),l=r(2096),c=r(8609),u=r(3953),h=r(2845),d=r(2497),p=r(6361),g=r(2616),f=r(4350),m=r(3402),y=r(3671);class v extends l.Ay{constructor(e,t,r){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,void 0!==t&&r?(this.setFlatCoordinates(t,e),this.ends_=r):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?(0,n.X$)(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new v(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,r,n){return n<(0,i.Ld)(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,u.HX)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,u.oW)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,r,n))}containsXY(e,t){return(0,h.zb)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return(0,c.PK)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return void 0!==e?(t=this.getOrientedFlatCoordinates().slice(),(0,m.ug)(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,(0,p.cD)(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=(0,i.q1)(this.getExtent());this.flatInteriorPoint_=(0,g.J)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new s.A(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new a.A(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,r=this.ends_,n=[];let i=0;for(let o=0,s=r.length;o<s;++o){const s=r[o],l=new a.A(t.slice(i,s),e);n.push(l),i=s}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;(0,m.PA)(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=(0,m.ug)(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],r=[];return t.length=(0,y.Hg)(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,r),new v(t,"XY",r)}getType(){return"Polygon"}intersectsExtent(e){return(0,f.HT)(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=(0,d.KG)(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()}}const A=v;function S(e){if((0,i.Im)(e))throw new Error("Cannot create polygon from empty extent");const t=e[0],r=e[1],n=e[2],o=e[3],a=[t,r,t,o,n,o,n,r,t,r];return new v(a,"XY",[a.length])}function E(e,t,r){t=t||32;const n=e.getStride(),i=e.getLayout(),a=e.getCenter(),s=n*(t+1),l=new Array(s);for(let e=0;e<s;e+=n){l[e]=0,l[e+1]=0;for(let t=2;t<n;t++)l[e+t]=a[t]}const c=[l.length],u=new v(l,i,c);return function(e,t,r,n){const i=e.getFlatCoordinates(),a=e.getStride(),s=i.length/a-1,l=n||0;for(let e=0;e<=s;++e){const n=e*a,c=l+2*(0,o.xP)(e,s)*Math.PI/s;i[n]=t[0]+r*Math.cos(c),i[n+1]=t[1]+r*Math.sin(c)}e.changed()}(u,a,e.getRadius(),r),u}},4165:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(6514),i=r(8217),o=r(4087),a=r(3942);class s extends i.Ay{constructor(){super(),this.xmlSerializer_=(0,a.mc)()}getType(){return"xml"}readFeature(e,t){if(!e)return null;if("string"==typeof e){const r=(0,a.qg)(e);return this.readFeatureFromDocument(r,t)}return(0,a.wz)(e)?this.readFeatureFromDocument(e,t):this.readFeatureFromNode(e,t)}readFeatureFromDocument(e,t){const r=this.readFeaturesFromDocument(e,t);return r.length>0?r[0]:null}readFeatureFromNode(e,t){return null}readFeatures(e,t){if(!e)return[];if("string"==typeof e){const r=(0,a.qg)(e);return this.readFeaturesFromDocument(r,t)}return(0,a.wz)(e)?this.readFeaturesFromDocument(e,t):this.readFeaturesFromNode(e,t)}readFeaturesFromDocument(e,t){const r=[];for(let i=e.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&(0,n.X$)(r,this.readFeaturesFromNode(i,t));return r}readFeaturesFromNode(e,t){return(0,o.b0)()}readGeometry(e,t){if(!e)return null;if("string"==typeof e){const r=(0,a.qg)(e);return this.readGeometryFromDocument(r,t)}return(0,a.wz)(e)?this.readGeometryFromDocument(e,t):this.readGeometryFromNode(e,t)}readGeometryFromDocument(e,t){return null}readGeometryFromNode(e,t){return null}readProjection(e){if(!e)return null;if("string"==typeof e){const t=(0,a.qg)(e);return this.readProjectionFromDocument(t)}return(0,a.wz)(e)?this.readProjectionFromDocument(e):this.readProjectionFromNode(e)}readProjectionFromDocument(e){return this.dataProjection}readProjectionFromNode(e){return this.dataProjection}writeFeature(e,t){const r=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(r)}writeFeatureNode(e,t){return null}writeFeatures(e,t){const r=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(r)}writeFeaturesNode(e,t){return null}writeGeometry(e,t){const r=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(r)}writeGeometryNode(e,t){return null}}const l=s},4193:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>ee});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(5264),c=r(7843),u=r(6378),h=r(9687),d=r(6083),p=r(6631),g=r(5246),f=r(7018),m=r(8606),y=r(6546),v=r(6257),A=r(1667),S=r(4370),E=r(3791),w=r(5777);n.A.control=n.A.control||{},n.A.UI=n.A.UI||{},n.A.UI.autocomplete=g.A,n.A.Control=s.A;const _="tc-ctl-wfsquery",L=i.A.classes.LOADING,C=i.A.classes.HIDDEN,b="tc-spatial",T="#text";var x=null,P=null,M=null,I=null,R=null,O=function(){return null},D=function(){return null},N=null,k=null;const F={eq:{Ctor:p.A.equalTo,key:"query.equalTo"},neq:{Ctor:p.A.notEqualTo,key:"query.notEqualTo"},gt:{Ctor:p.A.greaterThan,key:"query.greaterThan"},lt:{Ctor:p.A.lessThan,key:"query.lowerThan"},gte:{Ctor:p.A.greaterThanOrEqualTo,key:"query.greaterThanOrEqualTo"},lte:{Ctor:p.A.lessThanOrEqualTo,key:"query.lowerThanOrEqualTo"},contains:{Ctor:p.A.like,key:"query.contains"},starts:{Ctor:p.A.like,key:"query.startsWith"},ends:{Ctor:p.A.like,key:"query.endsWith"},btw:{Ctor:p.A.between,key:"query.equalTo"},nbtw:{key:"query.notEqualTo"},intersects:{Ctor:p.A.like,key:"query.intersects"},within:{Ctor:p.A.between,key:"query.within"},empty:{Ctor:p.A.equalTo,key:"query.empty"},null:{Ctor:p.A.isNull,key:"query.empty"}},G=function(e){var t=document.createElementNS("http://www.w3.org/1999/xhtml","input");return t.setAttribute("type",e),t.type==e};let B=null,U=null;const q=function(){if(B){var e=B.el.input;B.destroy(),B=null,e.value="",e.type="search"}};let W;const H=function(e,t){return t=new RegExp(t.replace(/\W/g,""),"gi"),'<li><a href="#" data-value="'+e+'">'+e.replace(t,"<b>$&</b>")+"</a></li>"},j=function(e){const t=e.layer.map.getLayer("WFSQueryResultsHighlight");t&&t.clearFeatures()},V=function(e){const t=e.layer.owner;if(t&&t instanceof Q&&e.layer===t.resultsLayer){if(e.newData&&0===e.newData.totalFeatures)return t.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(L),void t.showMessage(N("query.msgNoResults"),i.A.msgType.INFO);var r=e.layer.features;if(r.length>0){t.toShare&&t.toShare.doZoom&&(t.setQueryToSearch({doZoom:!1}),t.map.zoomToFeatures(r));const e="h3_"+t.getLocaleString("service"),i="h4_"+t.getLocaleString("layer"),o=t.map.getControlsByClass(d.default).some((e=>e.TITLE_SEPARATOR))?t.map.getControlsByClass(d.default).find((e=>e.TITLE_SEPARATOR)).TITLE_SEPARATOR:" • ",s=t.getCurrentQuery();for(var n=0;n<r.length;n++){const t=s.layer.getPath(s.name).slice(1);if(t){const l={};l[e]=s.layer.title,l[i]=t.join(o);const c=a.A.extend(l,r[n].getData());r[n].clearData(),r[n].setData(c)}}t.showResultsPanel(r.length>1?r.reduce((function(e,t){return(e instanceof Array?e:[e.data]).concat([t.data])})):[r[0].data],s.title)}e.layer.map.off(i.A.event.LAYERUPDATE,V)}},z=function(e){const t=e.layer.owner;t&&e.layer===t.resultsLayer&&e.query&&t.setQueryToSearch({filter:e.query})},Y=function(e){switch(!0){case e instanceof p.A.EqualTo:return"eq";case e instanceof p.A.NotEqualTo:return"neq";case e instanceof p.A.GreaterThan:return"gt";case e instanceof p.A.LessThan:case e instanceof p.A.GreaterThanOrEqualTo:case e instanceof p.A.LessThanOrEqualTo:return"lt";case e instanceof p.A.IsLike:var t=/<!\[CDATA\[(?<content>.*?)\]\]>/gm.exec(e.pattern)?.groups?.content||e.pattern;return e.expression=t.replace(/\*/g,""),t.startsWith("*")?t.endsWith("*")?"contains":"ends":t.endsWith("*")?"starts":"";case e instanceof p.A.IsNull:return"null";case e instanceof p.A.IsBetween:return e.expression=new Date(e.LowerBoundary).getFullYear()+"-"+new Date(e.LowerBoundary).getMonth()+"1-"+new Date(e.LowerBoundary).getDate(),"btw";case e instanceof p.A.Intersects:return"intersects";case e instanceof p.A.Within:return"within"}},$=function(e,t){if(x){var r=x.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(P)clearTimeout(P);else{switch(r.innerHTML=e,t){case i.A.msgType.INFO:r.classList.add("tc-msg-info");break;case i.A.msgType.WARNING:r.classList.add("tc-msg-warning");break;case i.A.msgType.ERROR:default:r.classList.add("tc-msg-error")}r.classList.remove(C)}P=setTimeout((function(){P=null,r.classList.add(C)}),3e3)}};class K{constructor(){this["query.tooltipMagnifBtn"]="",this["query.tooltipCloseDialogBtn"]="",this["query.chooseALayerCombo"]="",this["query.tooltipSendQueryBtn"]="",this["query.sendQueryBtnText"]="",this["query.cancelQueryTooltip"]="",this["query.cancelQueryButton"]="",this["query.zoomToExtent"]="",this["wfs.changeCriteria"]="",this.headerTitle="",this["query.chooseAttrCombo"]="",this.geometry="",this["query.noAttributes"]="",this["operators.eq.key"]="",this["operators.neq.key"]="",this["operators.gt.key"]="",this["operators.lt.key"]="",this["operators.gte.key"]="",this["operators.lte.key"]="",this["operators.contains.key"]="",this["operators.starts.key"]="",this["operators.ends.key"]="",this["operators.empty.key"]="",this["query.searchFieldPhd"]="",this["query.tooltipAddCondBtn"]="",this["query.textAddCondBtn"]="",this["operators.btw.key"]="",this["operators.nbtw.key"]="",this["operators.intersects.key"]="",this["operators.within.key"]="",this["query.textAddCondBtn"]="",this.box="",this.line="",this.polygon="",this["query.logicalOpLbl"]="",this["query.logicalOpAndLbl"]="",this["query.logicalOpOrLbl"]="",this["query.returnToQueryBuilder"]}}class X{constructor(){this.view="",this["query.tooltipRemoveCond"]=""}}class Z{constructor(){this["query.tooltipMagnifBtn"]="",this.share="",this.close=""}}class J{constructor(){this["wfs.QuerySortTitle"]="",this.zoomToFeature="",this.linkInNewWindow="",this.open="",this["featureInfo.complexData.array"]=""}}class Q extends s.A{DEFAULT_STROKE_COLOR="#0000ff";#Or={current:{layer:null,name:null,capabilities:null,title:null,URL:null,filter:[]},queried:null};constructor(){super(...arguments),this._dialogDiv=a.A.getDiv(this.options.dialogDiv),this.options.dialogDiv||document.body.appendChild(this._dialogDiv),this.model=new K,this.filterModel=new X,this.exportsState=!0,this.styles=this.options.styles,this.highlightStyles=this.options.highlightStyles||this.options.highLightStyles,this.download=this.options.download,this.resultsPanel=null,this.geometryPanel=null,this.deletedFeatures=[],this.styles=a.A.extend(!0,{polygon:{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:0},line:{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000"}},this.options.styles)}async register(e){const t=this;return e.on(i.A.event.LAYERERROR,(e=>{if(e.layer===t.resultsLayer){if(t.modalDialog&&t.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(L),e.reason!==i.A.WFSErrors.MAX_NUM_FEATURES)throw t.showMessage(N("query.errorUndefined"),i.A.msgType.ERROR),new Error(e.reason);t.showMessage(N("query.msgTooManyResults",{limit:e.data.limit}),i.A.msgType.WARNING)}})),e.on(i.A.event.BEFOREFEATUREREMOVE,(e=>{if(e.layer===t.resultsLayer){const r=e.layer.features.indexOf(e.feature);t.deletedFeatures.push(r);const n=t.resultsPanel.div.querySelector("table tbody tr:not(."+i.A.classes.DISABLED+")[data-index='"+r+"']");delete n.dataset.index,n.removeAttribute("title"),n.classList.add(i.A.classes.DISABLED);for(let n=r+1;n<e.layer.features.length;n++){const e=t.resultsPanel.div.querySelector("table tbody tr[data-index='"+n+"']");e&&e.dataset.index&&(e.dataset.index=parseInt(e.dataset.index,10)-1)}}})),e.on(i.A.event.RESULTSPANELCLOSE,(function(e){e.control===t.resultsPanel&&(n.A.browserFeatures.touch()&&a.A.swipe(e.control.div,"enable"),t.resultsLayer&&(t.resultsLayer.clearFeatures(),t.resultsLayer.setVisibility(!1)),t.clearFilters(),t.#Or.current.name="",t.#Or.queried.filter.filter((e=>e instanceof p.A.Spatial)).forEach((e=>e.geometry?.layer?.removeFeature(e.geometry))),t.#Or.queried=null,t.modalDialog=null,t.map.off(i.A.event.LAYERUPDATE,V),t.map.off(i.A.event.BEFOREAPPLYQUERY,z),delete t.toShare,t.resultsController.model=null,t.resultsController.view=null,t.resultsController=null)})),await s.A.prototype.register.call(t,e),O=function(){var e=function(e,t){return this.options.styles&&this.options.styles[e]&&this.options.styles[e][t]||o.A.styles[e][t]};return{polygon:{fillColor:e.bind(t,"polygon","fillColor"),fillOpacity:e.bind(t,"polygon","fillOpacity"),strokeColor:e.bind(t,"polygon","strokeColor"),strokeOpacity:e.bind(t,"polygon","strokeOpacity"),strokeWidth:e.bind(t,"polygon","strokeWidth")},line:{strokeColor:e.bind(t,"line","strokeColor"),strokeOpacity:e.bind(t,"line","strokeOpacity"),strokeWidth:e.bind(t,"line","strokeWidth")},point:{radius:e.bind(t,"point","radius"),height:e.bind(t,"point","height"),width:e.bind(t,"point","width"),fillColor:e.bind(t,"point","fillColor"),fillOpacity:e.bind(t,"point","fillOpacity"),strokeColor:e.bind(t,"point","strokeColor"),strokeWidth:e.bind(t,"point","strokeWidth"),fontSize:e.bind(t,"point","fontSize"),fontColor:e.bind(t,"point","fontColor"),labelOutlineColor:e.bind(t,"point","labelOutlineColor"),labelOutlineWidth:e.bind(t,"point","labelOutlineWidth"),label:e.bind(t,"point","label"),labelRotationKey:e.bind(t,"point","labelRotationKey")}}},D=function(){var e={polygon:a.A.extend(!0,{},o.A.styles.polygon,{fillColor:"#0099FF",fillOpacity:1,strokeColor:"#0099FF",strokeWidth:2}),line:a.A.extend(!0,{},o.A.styles.line,{strokeColor:"#0099FF",strokeWidth:2}),point:a.A.extend(!0,{},o.A.styles.point,{strokeColor:"#0099FF"})};return t.highlightStyles?{polygon:a.A.extend(!0,{},e.polygon,t.highlightStyles.polygon?t.highlightStyles.polygon:{}),line:a.A.extend(!0,{},e.line,t.highlightStyles.line?t.highlightStyles.line:{}),point:a.A.extend(!0,{},e.point,t.highlightStyles.point?t.highlightStyles.point:{})}:e},N=function(e,t){return a.A.getLocaleString(R,e,t)},e.ready((function(){e.getControlsByClass(u.default).forEach((function(r){const n=a.A.getTextFromCssVar("--icon-query",r.div);r.addItemTool({renderFn:function(r,o){const a=t.CLASS+"-btn-open";let s=r.querySelector("sitna-button."+a);s&&(s.remove(),s=null);const l=e.getLayer(o);if(l?.type===i.A.layerType.WMS||l?.type===i.A.layerType.WFS){const e=t.getLocaleString("query.tooltipMagnifBtn");s=new S.A,s.variant=S.A.variant.MINIMAL,s.text=e,s.iconText=n,s.classList.add(a),s.dataset.layerId=o,l.type===i.A.layerType.WMS&&(s.classList.add(L),l.getWFSCapabilities().then((e=>{if(e.Operations.GetFeature){var t=l.getDisgregatedLayerNames?l.getDisgregatedLayerNames():l.featureType;(t=t.filter((function(t){return Object.prototype.hasOwnProperty.call(e.FeatureTypes,t.substring(t.indexOf(":")+1))}))).length||s.classList.add(C)}else s.classList.add(C)})).catch((()=>s.classList.add(C))).finally((()=>s.classList.remove(L)))),t.model&&(s.text="[[query.tooltipMagnifBtn]]",t.controller?t.controller.add(s):t.controller=new w.A(t.model,new E.A(s)),t.model["query.tooltipMagnifBtn"]=t.getLocaleString("query.tooltipMagnifBtn"))}return s},updateEvents:[],actionFn:function(){const e=this;if(e.classList.contains("tc-unavailable")||e.classList.contains("tc-loading"))return;const r=t.map.getLayer(e.dataset.layerId);t.#Or.queried&&(t.#Or.current=Object.assign({},t.#Or.queried,{filter:[...t.#Or.queried.filter]}));const n=t.getCurrentQuery();n.layer&&n.layer==r?n?.layer!==r||n.filter.length||(n.name=""):(n.layer=r,n.name="",n.filter=[],t.modalDialog=null),t.#Dr(n)}})}))})),await t.getShareDialog(),t.shareDialogController=new w.A(new Z,new E.A(t._dialogDiv)),t}async loadTemplates(){const e=this,t=r.e(7974).then(r.bind(r,7974)),n=r.e(7620).then(r.bind(r,7620)),i=r.e(8984).then(r.bind(r,8984)),o=r.e(2578).then(r.bind(r,2578)),a=r.e(9031).then(r.bind(r,9031)),s=r.e(4021).then(r.bind(r,4021)),l=r.e(6662).then(r.bind(r,6662)),c=r.e(8456).then(r.bind(r,8456)),u={};u[e.CLASS+"-dialog"]=(await t).default,u[e.CLASS+"-form"]=(await n).default,u[e.CLASS+"-filter"]=(await i).default,u[e.CLASS+"-table"]=(await o).default,u["tc-ctl-finfo-attr-val"]=(await a).default,u["tc-ctl-finfo-object"]=(await s).default,u[e.CLASS+"-geom"]=(await l).default,u[e.CLASS+"-share-dialog"]=(await c).default,e.template=u}async render(e){this._dialogDiv.innerHTML=await this.getRenderedHtml(this.CLASS+"-share-dialog",{}),this.map&&(R=this.map.options.locale),await super.render.call(this,e)}getCurrentQuery(){return this.#Or.current}#Nr(e){const t=e instanceof p.A.Spatial;return{field:t?this.getLocaleString("geometry"):e.propertyName,opText:"[["+F[e._abbr].key+"]]",valueToShow:e._valueToShow,isSpatial:t}}#kr(){const e=this,t=e.getForm(),r=t.querySelector(`.${e.CLASS}-where-list`);r.replaceChildren(),e.getCurrentQuery().filter.forEach((t=>{e.filterModel[F[t._abbr].key]=e.getLocaleString(F[t._abbr].key)})),e.getRenderedHtml(e.CLASS+"-filter",{conditions:e.getCurrentQuery().filter.map((t=>e.#Nr(t))),locale:e.map.options.locale},(n=>{r.innerHTML=n,r.querySelectorAll(`.${e.CLASS}-where-cond-view`).forEach((function(t,r){t.addEventListener(i.A.event.CLICK,(function(){e.map.zoomToFeatures([e.getCurrentQuery().filter.filter((e=>e instanceof p.A.Spatial))[r].geometry]),e.showGeometryPanel()}),{passive:!0})})),t.querySelectorAll(`.${e.CLASS}-del-cond`).forEach((function(t,r){t.addEventListener(i.A.event.CLICK,(function(){e.removeFilter(r)}),{passive:!0})})),e.filterController=new w.A(e.filterModel,new E.A(r)),e.filterModel.view=e.getLocaleString("view"),e.filterModel["query.tooltipRemoveCond"]=e.getLocaleString("query.tooltipRemoveCond")}))}#Fr(e){const t=this;var r,n=e.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');return 0===n.length?(t.showMessage(N("query.msgNoCondition")),!1):e.querySelectorAll("input[type='date']").length&&!e.querySelector("input[type='date']").checkValidity()?(t.showMessage(N("query.msgNoValidDate")),!1):e.querySelectorAll("input[type='number']").length&&null!==(r=e.querySelector("input[type='number']"))&&!r.checkValidity()?("numeric"===r.getAttribute("inputmode")?t.showMessage(N("query.msgNoValidNumberMustInt")):t.showMessage(N("query.msgNoValidNumber")),!1):""!==e.querySelector("input.tc-textbox").value.trim()||"empty"===n.value||"null"===n.value||(t.showMessage(N("query.msgNoValueCondition")),!1)}async#Gr(e){const t=this;var r=e;if(t.resultsPanel)t.resultsPanel.options.save.fileName=r+".xls";else{var n=t.map.getControlsByClass(c.default);const e={content:"table",titles:{main:"",max:""},save:{fileName:r+".xls"},download:()=>function(e){const t=e;t.getDownloadDialog().then((function(r){var n={title:e.#Or.current.title};(t.map.elevation||t.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),r.open(t.resultsLayer.features,n)}))}(t),share:!0,resize:!0};0===n.length?(t.resultsPanel=await t.map.addControl("resultsPanel",e),t.resultsPanel.caller=t):(e.position="right",t.resultsPanel=await n[0].addControl("resultsPanel",e),t.resultsPanel.caller=t),t.resultsPanel.template[t.resultsPanel.CLASS+"-table"]=t.template[t.CLASS+"-table"];const i=a.A.getTextFromCssVar("--icon-extent",t.resultsPanel.div);t.resultsPanel.addItemTool({renderFn:function(e){const r=t.CLASS+"-btn-zoom";let n=e.querySelector("sitna-button."+r);return n&&(n.remove(),n=null),n=new S.A,n.variant=S.A.variant.MINIMAL,n.text="[[query.zoomToExtent]]",n.iconText=i,n.classList.add(r),t.controller.add(n),n},updateEvents:[],actionFn:function(){t.map.zoomToLayer(t.resultsLayer)}});const o=a.A.getTextFromCssVar("--icon-filter",t.resultsPanel.div);t.resultsPanel.addItemTool({renderFn:function(e){const r=t.CLASS+"-btn-chng";let n=e.querySelector("sitna-button."+r);return n&&(n.remove(),n=null),n=new S.A,n.variant=S.A.variant.MINIMAL,n.text="[[wfs.changeCriteria]]",n.iconText=o,n.classList.add(r),t.controller.add(n),n},updateEvents:[],actionFn:async function(){t.#Or.current=Object.assign({},t.#Or.queried,{filter:[...t.#Or.queried.filter]}),await t.#Dr(t.#Or.current)}})}t.resultsPanel.options.titles.max=t.resultsPanel.getLocaleString("geo.trk.chart.exp")}showMessage(e,t){x?$(e,t):this.map.toast(e,{type:t})}#Br(e){const t=this;var r=function(e,t){var r;return t instanceof f.A?r=e.addPoint(t.getCoords()):t instanceof m.A?r=e.addPolyline(t.getCoords()):t instanceof y.A?r=e.addPolygon(t.getCoords()):t instanceof A.A?r=e.addMultiPolygon(t.getCoords()):t instanceof v.A&&(r=e.addMultiPolyline(t.getCoords())),r};if(e.layer){var n=e.layer.map.getLayer("WFSQueryResultsHighlight");n?r(n,e):e.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:i.A.layerType.VECTOR,owner:t,stealth:!0,styles:D()},(function(t){r(t,e)}))}}async#Ur(e){const t=this,r=t.getCurrentQuery();if(r.layer&&r.name&&r.title&&e){var n=await r.layer.getWFSURL();t.definitiveFilters=[e],t.#Or.queried&&t.#Or.queried.layer!==r.layer&&t.#Or.queried.filter.reduce(((e,t)=>e.concat(t.geometry||[])),[]).forEach((e=>t.drawControl?.layer.removeFeature(e))),t.#Or.queried=r,await t.#Gr(r.title),r.layer.proxificationTool.cacheHost.getAction(n).then((function(o){const a=o.action(n);t.resultsLayer&&t.resultsLayer.url!==a&&(t.map.removeLayer(t.resultsLayer),t.resultsLayer=null),t.resultsLayer?(t.map.off(i.A.event.BEFOREAPPLYQUERY,z),t.map.on(i.A.event.BEFOREAPPLYQUERY,z),t.resultsLayer.setVisibility(!1),t.resultsLayer.clearFeatures(),t.map.off(i.A.event.LAYERUPDATE,V),t.map.on(i.A.event.LAYERUPDATE,V),t.resultsLayer.url=a,t.resultsLayer.featurePrefix=r.name.substring(0,r.name.indexOf(":")),t.resultsLayer.featureType=r.name.substring(r.name.indexOf(":")+1),t.resultsLayer.filter=e,t.resultsLayer.setVisibility(!0),t.resultsLayer.refresh()):(t.map.on(i.A.event.BEFOREAPPLYQUERY,z),t.map.addLayer({id:"WFSQueryResults",type:i.A.layerType.WFS,url:a,owner:t,stealth:!0,geometryName:"the_geom",featurePrefix:r.name.substring(0,r.name.indexOf(":")),featureType:r.name.substring(r.name.indexOf(":")+1),filter:e,outputFormat:i.A.format.JSON,styles:O()}).then((function(e){t.resultsLayer=e,e.map.on(i.A.event.LAYERUPDATE,V)})))}))}}async sendQuery(){const e=this;if(!e.validateQuery())return void e.showMessage(e.getLocaleString("query.msgNoQueryFilter"));let t;e.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.add(L);const r=e.getCurrentQuery();if(r.filter.length>1){const n=e.modalDialog.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;t=p.A[i.A.logicalOperator[n]].apply(null,r.filter)}else t=r.filter[0];e.#Ur(t)}setQueryToSearch(e){const t=this;if(1===Object.keys(e).length&&Object.prototype.hasOwnProperty.call(e,"doZoom"))t.toShare=a.A.extend(t.toShare,{doZoom:e.doZoom});else if(e.filter||t.resultsLayer&&t.resultsLayer.filter instanceof p.A.Filter){const r=t.getCurrentQuery();t.toShare=a.A.extend(t.toShare,{wms:{url:r.layer.url,names:r.layer.names},title:r.title,name:r.name,filter:e.filter?e.filter:t.resultsLayer.filter.getText(),doZoom:!Object.prototype.hasOwnProperty.call(e,"doZoom")||e.doZoom})}}exportState(){const e=this;return e.toShare?{id:e.id,queryResult:JSON.stringify(e.toShare)}:null}importState(e){const t=this;e.queryResult&&this.map?.wait((async()=>{await t.map.loaded();let r=JSON.parse(e.queryResult);if(r.wms&&r.filter){let e=t.map.workLayers.filter((e=>e.url&&e.url===r.wms.url&&e.names.join()===r.wms.names.join()));if(e.length>0){const n=t.getCurrentQuery();n.layer=e[0],n.name=r.name,n.title=r.title,t.setQueryToSearch({doZoom:r.doZoom});const i=await n.layer.describeFeatureType(n.name);t.#qr(i,!1),t.#Ur(r.filter),t.setQueryToSearch({filter:r.filter,doZoom:r.doZoom}),n.filter=[p.A.Filter.fromText(r.filter)],t.#Or.queried=t.#Or.current=Object.assign({},n,{filter:[...n.filter]})}}else alert("shared query error")}))}validateQuery(){return this.getCurrentQuery().filter.length>0}showResultsPanel(e,t){const r=this;r.deletedFeatures=[],r.resultsPanel.model.title=r.resultsPanel.getLocaleString(e.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.length,layerName:t}),r.resultsPanel.div.classList.add("tc-ctl-wfsquery-results"),r.modalDialog&&r.modalDialog.parentElement.removeChild(r.modalDialog);const o=W();r.resultsPanel.openTable({data:e,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},sort:!0,callback:function(t){r.resultsPanel.maximize(),console.log("render del panel de resultados");var s=t.querySelectorAll(".tc-table > tbody > tr"),l=1;for(var c in e[0])if(Object.prototype.hasOwnProperty.call(o,c)){const e=o[c].type["#text"]?.type||o[c].type;if(e&&!(e instanceof Object)){if(e.indexOf("int")>=0||e.indexOf("float")>=0||e.indexOf("double")>=0||e.indexOf("long")>=0||e.indexOf("decimal")>=0)for(var u=t.querySelectorAll("td:nth-child("+l+")"),d=0;d<u.length;d++)u[d].classList.add("tc-numeric");e.indexOf("date")>=0&&t.querySelectorAll(".tc-table > tbody > tr > td:nth-child("+l+")").forEach((e=>e.classList.add("tc-date")))}l++}for(var p=0;p<s.length;p++)s[p].addEventListener("click",(function(e){if(e.stopPropagation(),!this.classList.contains(i.A.classes.DISABLED)){var t=this.dataset.index;null!=t&&r.resultsLayer.map.zoomToFeatures([r.resultsLayer.features[t]])}})),s[p].addEventListener("mouseenter",(function(){if(!this.classList.contains(i.A.classes.DISABLED)){var e=this.dataset.index;if(null!=e){var t=r.resultsLayer.features[e];t&&t.geometry&&r.#Br(t);var n=this.querySelectorAll("td.tc-value div");n.length>0?n.forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)})):this.querySelectorAll("td").forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)}))}}})),s[p].addEventListener("mouseleave",(function(){var e=this.dataset.index;if(null!=e){var t=r.resultsLayer.features[e];t&&t.geometry&&j(t)}}));t.querySelectorAll(".tc-complex-attr label,.tc-complex-attr input").forEach((function(e){e.addEventListener("click",(function(e){e.stopPropagation()}))})),t.querySelectorAll(".tc-complex-attr input").forEach((function(e){e.addEventListener("change",(function(e){this.checked&&this.nextElementSibling.querySelectorAll("td.tc-value div").forEach((function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)}))}))})),h.default.addSpecialAttributeEventListeners(t),t.querySelectorAll("td > img, td > video, td > audio, td > iframe").forEach((e=>e.parentNode.classList.add("tc-multimedia"))),t.querySelectorAll("video").forEach((e=>{e.addEventListener(i.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),r.deletedFeatures.length>0&&(r.deletedFeatures.sort().forEach((e=>{const t=r.resultsPanel.div.querySelector("table tbody tr[data-index='"+e+"']");delete t.dataset.index,t.removeAttribute("title"),t.classList.add(i.A.classes.DISABLED)})),Array.from(r.resultsPanel.div.querySelectorAll("table tbody tr:not(."+i.A.classes.DISABLED+")")).forEach((e=>{const t=parseInt(e.dataset.index,10);e.dataset.index=t-r.deletedFeatures.filter((e=>e<t)).length}))),n.A.browserFeatures.touch()&&a.A.swipe(r.resultsPanel.div,"disable"),r.resultsController=new w.A(new J,new E.A(t)),r.resultsController.model["wfs.QuerySortTitle"]=r.getLocaleString("wfs.QuerySortTitle"),r.resultsController.model.zoomToFeature=r.getLocaleString("zoomToFeature"),r.resultsController.model.linkInNewWindow=r.getLocaleString("linkInNewWindow"),r.resultsController.model.open=r.getLocaleString("open"),r.resultsController.model["featureInfo.complexData.array"]=r.getLocaleString("featureInfo.complexData.array")}})}#Wr(e,t,r){const o=this;n.A.UI.autocomplete.call(e,{minLength:3,target:r,source:function(e,r){var n=this;n.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+N("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>',n.target.classList.remove(C),M&&window.clearTimeout(M),M=window.setTimeout((async function(){if(!document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text").classList.contains(i.A.classes.HIDDEN)){var a=await o.#Hr(t,e);a&&(a.length?r(a.sort()):n.target.classList.add(C))}}),500)},callback:function(t){e.value=t.currentTarget.dataset.value,this.target.classList.add(C)},buildHTML:function(t){var r=e.value;return this.target.style.maxHeight="",t.results.length>1?t.results.reduce((function(e,t,n){return(n>1?e:H(e,r))+H(t,r)})):H(t.results[0],r)}}),e.addEventListener("targetCleared.autocomplete",(function(){r.classList.add(C)})),e.addEventListener("keypress",(function(t){13==t.which&&n.A.UI.autocomplete.call(e,"clear")})),e.addEventListener("search",(function(t){0===e.value.length&&n.A.UI.autocomplete.call(e,"clear")})),e.addEventListener("input",(function(t){0===e.value.length&&n.A.UI.autocomplete.call(e,"clear")}))}#jr(e,t,r){const n=this;var i="";for(var o in i+='<option value="">'+N("query.chooseAttrCombo")+"</option>",t){const e=t[o];e.type&&(i+='<option value="'+(e.name||o)+'"'+(a.A.isGeometry(e.type)?' class="tc-ctl-wfsquery-opt-geom"':"")+">"+(o===T?"["+N("content")+"]":o)+"</option>")}var s=document.createElementNS("http://www.w3.org/1999/xhtml","div");s.insertAdjacentHTML("beforeend",'<select class="'+e.className+'" name="'+e.name+'">'+i+"</select>"),e.parentNode.parentNode.insertBefore(s,e.parentNode.nextSibling).firstElementChild.addEventListener("change",(function(){n.#Vr(this,r,t)}))}#Vr(e,t,r){e.parentElement.parentElement.querySelectorAll("select").forEach((function(t){e.offsetTop<t.offsetTop&&t.parentElement.parentElement.removeChild(t.parentElement)}));const i=t.querySelector(`.${_}-numeric`),o=t.querySelector(`.${_}-text`),s=t.querySelector(`.${_}-date`),l=t.querySelector(`.${_}-geom`),c=t.querySelector(`.${_}-where`),u=t.querySelector(`.${_}-op`);var h,d=c.querySelector(".tc-textbox");if(d.disabled=!1,d.dataset.autocomplete&&n.A.UI.autocomplete.call(d,"clear"),i.classList.add(C),s.classList.add(C),o.classList.add(C),l.classList.add(C),c.classList.add(C),r[e.selectedOptions[0].value])switch(k=r[e.selectedOptions[0].value].type,u.classList.remove(C),n.A.UI.autocomplete.call(d,"destroy"),function(){if(U){var e=U.el.input;U.destroy(),U=null,e.value="",e.type="search"}}(),d.type="search",d.removeAttribute("step"),d.removeAttribute("inputmode"),!0){case!k:console.log("type es nulo");break;case k instanceof Object:this.#jr(e,k,t);break;case a.A.isGeometry(k):l.classList.remove(C),c.classList.remove(C),c.classList.add(b),0===l.querySelectorAll("input:checked").length&&(l.firstElementChild.checked=!0),q();break;case k.indexOf("int")>=0:case k.indexOf("float")>=0:case k.indexOf("double")>=0:case k.indexOf("long")>=0:case k.indexOf("decimal")>=0:case k.indexOf("short")>=0:i.classList.remove(C),c.classList.remove(C,b),0===i.querySelectorAll("input:checked").length&&(i.firstElementChild.checked=!0),q(),G("number")&&(a.A.detectIE()?(d.type="text",async function(){"undefined"!=typeof IMask?await a.A.getTimedPromise(null,10):(await n.A.loadJS(!0,[n.A.apiLocation+"/lib/polyfill/imask"]),console.log("Imask loaded"))}().then((function(){U=new IMask(d,{mask:Number,scale:k.indexOf("int")>=0||k.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:R&&"en-US"===R?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:R&&"en-US"===R?".":","})}))):(d.type="number",k.indexOf("int")>=0||k.indexOf("long")>=0?(d.step=1,d.setAttribute("inputmode","numeric")):(d.step="any",d.setAttribute("inputmode","decimal"))));break;case k.indexOf("dateTime")>=0:case k.indexOf("date")>=0:s.classList.remove(C),c.classList.remove(C,b),0===s.querySelectorAll("input:checked").length&&(s.firstElementChild.checked=!0),h=d,G("date")?h.type="date":(h.type="search",async function(){"undefined"!=typeof IMask?await a.A.getTimedPromise(null,10):(await n.A.loadJS(!0,[n.A.apiLocation+"/lib/polyfill/imask"]),console.log("Imask loaded"))}().then((function(){B=new IMask(h,{mask:Date,pattern:R&&"es-ES"!==R?"eu-ES"===R?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(e){var t=e.getDate(),r=e.getMonth()+1,n=e.getFullYear();switch(t<10&&(t="0"+t),r<10&&(r="0"+r),R){case"eu-ES":return[n,r,t].join("/");case"en-US":return[r,t,n].join("/");default:return[t,r,n].join("/")}},parse:function(e){switch(R){case"eu-ES":return new Date(e.split("/")[1]+"/"+e.split("/")[2]+"/"+e.split("/")[0]);case"en-US":return new Date(e);default:return new Date(e.split("/")[1]+"/"+e.split("/")[0]+"/"+e.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})));break;case k.indexOf("string")>=0:case"gml:ID"===k:{o.classList.remove(C),c.classList.remove(C,b),0===o.querySelectorAll("input:checked").length&&(o.firstElementChild.checked=!0),q();const r=[].slice.call(t.querySelectorAll("select[name="+e.name+"]")).reduce((function(e,t){return e+(e?"/":"")+t.value}),"");this.#Wr(d,r,t.getElementsByClassName(_+"-list tc-ctl-search-list")[0]);break}}else u.classList.add(C)}async#Hr(e,t,r){const n=this.getCurrentQuery();var o=Object.assign({},n.capabilities);switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"starts":t+="*";break;case"contains":case"eq":case"neq":t="*"+t+"*";break;case"ends":t="*"+t}I&&I.abort();let s=(I=new AbortController).signal;try{r=r||e.indexOf("/")>=0;var l=await n.layer.proxificationTool.fetch(n.URL,{data:a.A.WFGetPropertyValue(n.name,!r&&e,p.A.like(e,t,void 0,void 0,void 0,!1),o),contentType:"application/xml",method:"POST",signal:s});if(l.contentType.startsWith("application/xml")||l.contentType.startsWith("text/xml")){let n=(new DOMParser).parseFromString(l.responseText,"text/xml"),o=n.querySelector("Exception");if(o){if("InvalidParameterValue"===o.getAttribute("exceptionCode")&&!r)return await this.#Hr(e,t,!0);let a=n.querySelector("Exception ExceptionText");return a&&$(a.innerHTML,i.A.msgType.ERROR),[]}const a=[];return n.querySelectorAll("member > *").forEach((function(e){a.indexOf(e.innerHTML)<0&&(a[a.length]=e.innerHTML)})),a}if(l.contentType.startsWith("application/json")&&(l=JSON.parse(l.responseText)),l.features&&l.features.length>0){let t;return 1===l.features.length&&(t=[e.split("/").reduce((function(e,t){return e[t.substring(t.indexOf(":")+1)]}),l.features[0].properties)]),l.features.length>1&&(t=l.features.reduce((function(t,r){if(t&&t instanceof Array)return t.indexOf(r.properties[e])<0?t.concat(e.split("/").reduce((function(e,t){return e[t.substring(t.indexOf(":")+1)]}),r.properties)):t}),[])),t}return[]}catch(e){return e instanceof DOMException&&"AbortError"!==e.name&&$(e,i.A.msgType.ERROR),null}}#zr(){return Array.from(this.getForm().querySelectorAll(".tc-combo")).map((e=>e.value)).join("/")}async showGeometryPanel(e,t=!0){const r=this;let n;if(a.A.closeModal(),r.geometryPanel)r.geometryPanel.open(),n=r.drawControl.layer;else{const e={titles:{main:r.getLocaleString("query.spatialFilter")}},t=r.map.getControlsByClass(c.default)[0];t?(e.position=t.POSITION.RIGHT,r.geometryPanel=await t.addControl("resultsPanel",e)):r.geometryPanel=await r.map.addControl("resultsPanel",e),r.map.on(i.A.event.RESULTSPANELCLOSE,(function(e){e.control===r.geometryPanel&&(setTimeout((()=>r.drawControl.cancel()),500),a.A.showModal(r.modalDialog,{closeCallback:()=>r.clearFilters()}))}));const o=await r.getRenderedHtml(r.CLASS+"-geom");r.geometryPanel.open(o),r.controller.add(r.geometryPanel.div),r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-btn-ok`).addEventListener(i.A.event.CLICK,(function(){r.geometryPanel.close()}),{passive:!0}),r.drawControl||(r.drawControl=await r.map.addControl("draw",{div:r.geometryPanel.getTableContainer().querySelector(`.${r.CLASS}-geom-draw`),styles:r.styles}),n=await r.drawControl.getLayer(),r.drawControl.on(i.A.event.DRAWEND,(function(e){e.feature.showsPopup=!1,r.geometryPanel.close();const t=r.modalDialog.querySelector(`input[name="${r.id}-condition"]:checked`).value,n=r.#zr();let i;switch(i="intersects"===t?new p.A.Intersects(n,e.feature,r.map.crs):new p.A.Within(n,e.feature,r.map.crs),i._abbr=t,e.target.mode){case"polygon":i._valueToShow=r.getLocaleString("polygon");break;case"line":case"polyline":i._valueToShow=r.getLocaleString("line");break;case"rectangle":i._valueToShow=r.getLocaleString("box")}r.getCurrentQuery().filter.push(i),r.#kr(),a.A.showModal(r.modalDialog,{closeCallback:()=>r.clearFilters()})})),r.drawControl.on(i.A.event.DRAWCANCEL,(function(e){e.ctrl.deactivate()})))}return r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-draw`).classList.toggle(i.A.classes.HIDDEN,!e),r.geometryPanel.div.querySelector(`.${r.CLASS}-geom-btn`).classList.toggle(i.A.classes.HIDDEN,!!e),e&&r.drawControl.setMode(e,t),n}#Yr(e,t,r,n){let i=(o=e,U?U.unmaskedValue:B?B.unmaskedValue.substring(4)+"-"+B.unmaskedValue.substring(2,4)+"-"+B.unmaskedValue.substring(0,2):o.value);var o;let a=function(e){if(U)return U.value;if(B)return B.value;if("date"===e.type)return new Date(e.value).toLocaleDateString(R,{timeZone:"UTC"});if("number"===e.type){var t=1.1.toLocaleString(R).substring(1,2);return e.value.replace(".",t)}return e.value}(e);switch(!0){case n.indexOf("int")>=0:a=parseInt(i,10);break;case n.indexOf("float")>=0:case n.indexOf("double")>=0:case n.indexOf("long")>=0:case n.indexOf("decimal")>=0:a=parseFloat(i,10);break;case n.indexOf("string")>=0&&"empty"!==r:a='"'+a+'"';break;case n.indexOf("date")>=0&&"null"===r:a=""}var s;if(n.indexOf("dateTime")>=0||n.indexOf("date")>=0)if(i){const e=function(e){return new p.A.Function("dateParse",["yyyy-MM-dd HH:mm:ss",`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`])},n=e(new Date(i+"T00:00:00")),o=e(new Date(i+"T23:59:59"));s="nbtw"===r?p.A.not(p.A.between(t,n,o)):new F[r].Ctor(t,n,o),s=new p.A.And(p.A.not(p.A.isNull(t)),s)}else s=new F[r].Ctor(t);else s=new F[r].Ctor(t,("ends"===r||"contains"===r?"*":"")+i+("starts"===r||"contains"===r?"*":""));s.matchCase=!1,s._abbr=r,s._valueToShow=a,this.getCurrentQuery().filter.push(s)}#qr(e,t){const r=this;for(var o in W=function(){return e},e){const t=e[o];a.A.isGeometry(t.type)&&(t.isGeometry=!0)}if(t)return new Promise((function(t){r.getRenderedHtml(r.CLASS+"-form",{operators:F,attributes:e,controlId:r.id},(function(o){const a=r.modalDialog,s=r.getForm();s.replaceChildren(),s.insertAdjacentHTML("beforeend",o),x.classList.remove(L);const l=s.getElementsByClassName("tc-combo"),c=a.querySelector(".tc-ctl-wfsquery-btn-launch");if(0===l.length)c.disabled=!0;else{c.disabled=!1,l[0].addEventListener("change",(function(){r.#Vr(this,s,e)})),s.querySelectorAll(`input[name="${r.id}-condition"]`).forEach((e=>{e.addEventListener("change",(async function(e){s.querySelector(`.${r.CLASS}-geomtype-line-btn`).disabled="within"===e.target.value;const t=x.querySelector(".tc-ctl-wfsquery-value input");if(t.disabled=!1,this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"===this.value&&(t.value="",t.disabled=!0,n.A.UI.autocomplete.call(t,"clear")),this.parentElement.classList.contains("tc-ctl-wfsquery-date")&&"null"===this.value&&(t.value="",t.disabled=!0),""!==t.value.trim()&&this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"!==this.value){var i=document.createEvent("HTMLEvents");i.initEvent("keyup",!1,!0),t.dispatchEvent(i)}}))})),s.querySelector(`.${r.CLASS}-value sitna-button`).addEventListener(i.A.event.CLICK,(function(){var e=s.querySelector("input.tc-textbox");if(n.A.UI.autocomplete.call(e,"clear"),U?.masked.remove(),!r.#Fr(s))return;let t=r.#zr();const i="/"+T;t.endsWith(i)&&(t=t.substring(0,t.indexOf(i)));var o=s.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked').value;r.#Yr(e,t,o,k),r.#kr(),e.value=""}),{passive:!0});const o=function(e){r.showGeometryPanel(e.target.value)};s.querySelectorAll("sitna-button[name='geometry']").forEach((e=>e.addEventListener(i.A.event.CLICK,o,{passive:!0}))),r.controller.add(s),t(s)}}))}))}async#$r(e,t,r){const n=this;n.modalDialog=t;const o=n.getCurrentQuery();o.layer=e,o.capabilities=r,o.URL=r.Operations.DescribeFeatureType.DCP.HTTP.Get.href,new URL(o.URL).host===document.location.host&&(o.URL=o.URL.substring(o.URL.indexOf(":")+1));var s=e.getDisgregatedLayerNames?e.getDisgregatedLayerNames():e.featureType;if((s=s.filter((function(e){return Object.prototype.hasOwnProperty.call(r.FeatureTypes,e.substring(e.indexOf(":")+1))}))).length>1)x.classList.remove(L),t.getElementsByClassName("tc-combo")[0].addEventListener("change",(function(){if(this.value)t.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",t).classList.add(C),o.title=this.options[this.selectedIndex].text,x.classList.add(L),o.name=this.value,n.#Kr(o.layer,o.name,t);else{var e=n.getForm();e.replaceChildren();for(var r=0;r<e.children.length;r++)e.removeChild(e.children[r]);n.clearFilters()}}));else if(1===s.length)if(r.FeatureTypes[s[0].substring(s[0].indexOf(":")+1)])o.title=r.FeatureTypes[s[0].substring(s[0].indexOf(":")+1)].Title,o.name=s[0],await n.#Kr(o.layer,o.name,t);else{var l=t.getElementsByClassName("tc-modal-body")[0];l.classList.remove(L),l.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+N("query.LayerNotAvailable")+"</div>")}else a.A.closeModal(),e.map.toast(a.A.getLocaleString(e.map.options.locale,"query.LayerNotAvailable"),{type:i.A.msgType.ERROR})}async#Kr(e,t,r){const n=this;try{const r=await e.describeFeatureType(t),i={};for(const e in r)e.startsWith("gml:")||e.startsWith("@gml:")||(i[e]=r[e]);return{attributes:i,form:await n.#qr(i,!0)}}catch(e){var i=r.getElementsByClassName("tc-modal-body")[0];throw i.classList.remove(L),e?"error"===e.data?.state?i.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+N("query.errorUndefined")+"</div>"):i.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+e+"</div>"):i.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+N("query.LayerNotAvailable")+"</div>"),e}}async#Dr(e){const t=this;if(t.modalDialog&&!t.modalDialog.parentElement)return document.body.appendChild(t.modalDialog),t.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(L),t.#Or.current=e,t.getCurrentQuery().filter.filter((e=>e instanceof p.A.Spatial)).forEach((e=>{e.geometry instanceof SITNA.feature.Polygon&&!e.geometry.layer&&t.drawControl.layer.addPolygon(e.geometry),e.geometry instanceof SITNA.feature.Polyline&&!e.geometry.layer&&t.drawControl.layer.addPolyline(e.geometry)})),t.modalDialog;{const o=await function(e){let t;if(e.type===i.A.layerType.WMS)t=e.getWFSCapabilities();else{if(e.type!==i.A.layerType.WFS)return;t=e.getCapabilitiesPromise()}return t}(e.layer),s=await t.#Xr(e.layer,o,e.name),l=await t.#$r(e.layer,s,o);if(e.filter?.length){const i=[...e.filter];t.clearFilters();const o=await t.#Kr(e.layer,e.name,l),s=o.form.querySelector(".tc-combo[name='attributes']"),c=Object.entries(o.attributes).find((e=>a.A.isGeometry(e[1].type)))?.[0];if(s){var r=Object.keys(o.attributes).filter((e=>"FEATURE"!==e)).indexOf(i[0].propertyName||c);s.options[r+1].selected=!0,t.#Vr(s,o.form,o.attributes)}const u=i[0]instanceof p.A.LogicalNary?i[0].getTagName():"And";o.form.querySelector("."+t.CLASS+"-logOpRadio[value='"+u.toUpperCase()+"']").checked=!0;const h=i.reduce(((e,t)=>e.concat(t instanceof p.A.LogicalNary?t.conditions:t)),[]);for(var n in h){const e=h[n],r=Y(e),i=o.attributes[e.propertyName||c].type,a=await t.#Zr(e,r,o,c);e instanceof p.A.Spatial||t.#Yr(a,e.propertyName.substring(e.propertyName.indexOf(":")+1),r,i)}t.#kr()}return s}}async#Xr(e,t,r){const n=this;let o,s;if(e.type===i.A.layerType.WMS){const t=e.getPath();o=t[t.length-1]}else{if(e.type!==i.A.layerType.WFS)return;o=e.title}e.getDisgregatedLayerNames?(s=[],e.getDisgregatedLayerNames().forEach((function(r,n){var i=e.getPath(r);Object.prototype.hasOwnProperty.call(t.FeatureTypes,r.substring(r.indexOf(":")+1))&&s.push({name:r,title:i[i.length-1]})})),s.sort((function(e,t){return e.title<t.title?-1:e.title>t.title?1:0}))):s=e.featureType;const l=await n.getRenderedHtml(n.CLASS+"-dialog",{layers:s});document.body.querySelectorAll(`.${n.CLASS}-dialog`).forEach((e=>e.remove()));var c=document.createElementNS("http://www.w3.org/1999/xhtml","div");c.insertAdjacentHTML("beforeEnd",l);var u=null;if(c.childNodes.length>0&&(u=c.firstChild,document.body.appendChild(u)),(x=u.getElementsByClassName("tc-modal-body")[0]).classList.add(L),a.A.showModal(u,{closeCallback:()=>{n.clearFilters(),n.#Or.queried?.layer.id===n.#Or.current?.layer.id&&n.#Or.queried?.filter?.filter((e=>e instanceof p.A.Spatial)).forEach((e=>n.drawControl.layer.addFeature(e.geometry)))}}),a.A.detectIE()){var h=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:case document.body.clientWidth>1140:h=.7}x.style.maxHeight=document.body.clientHeight*h-x.nextElementSibling.clientHeight-x.previousElementSibling.clientHeight}return n.modalDialog=u,u.querySelector(".tc-ctl-wfsquery-btn-launch").addEventListener("click",(function(){n.sendQuery()})),r&&s.length>1&&(Array.from(u.querySelector(".tc-combo[name='availableLayers']")).find((e=>e.value===r)).selected=!0),n.controller.add(u),n.updateModel(),n.model.headerTitle=n.getLocaleString("query.titleDialog",{layerName:o}),u}removeFilter(e){const t=this;let r=e;const n=t.getCurrentQuery();if(e instanceof p.A.Filter&&(r=n.filter.indexOf(e)),r>=0&&r<n.filter.length){const e=n.filter.splice(r,1)[0];e instanceof p.A.Spatial&&e.geometry.layer.removeFeature(e.geometry),t.#kr()}return t}clearFilters(){const e=this.getCurrentQuery();return e.filter.filter((e=>e instanceof p.A.Spatial)).forEach((e=>e.geometry?.layer?.removeFeature(e.geometry))),e.filter.length=0,this}getForm(){return this.modalDialog&&this.modalDialog.querySelector(".tc-modal-form")}async#Zr(e,t,r,n){const i=this,o=document.createElementNS("http://www.w3.org/1999/xhtml","input");o.value=/<!\[CDATA\[(?<content>.*?)\]\]>/gm.exec(e.expression)?.groups?.content||e.expression;const s=r.attributes[e.propertyName||n].type;switch(!0){case a.A.isGeometry(s):var l=await i.showGeometryPanel(e.geometry.STYLETYPE,!1);i.geometryPanel.close();var c=new e.constructor(null,e.geometry,i.map.crs);switch(c._abbr=t,e.geometry.STYLETYPE){case"polygon":var u=e.geometry.getCoordinates()[0];u[0][0]===u[1][0]&&u[0][1]===u[3][1]&&u[3][0]==u[3][0]&&u[1][1]==u[1][1]?c._valueToShow=i.getLocaleString("box"):c._valueToShow=i.getLocaleString("polygon");break;case"line":c._valueToShow=i.getLocaleString("line")}i.getCurrentQuery().filter.push(c),l.addFeature(e.geometry);break;case s.indexOf("int")>=0:case s.indexOf("float")>=0:case s.indexOf("double")>=0:case s.indexOf("long")>=0:case s.indexOf("decimal")>=0:o.type="number",s.indexOf("int")>=0||s.indexOf("long")>=0?o.step=1:o.step="any";break;case s.indexOf("dateTime")>=0:case s.indexOf("date")>=0:o.type="date";break;case s.indexOf("string")>=0:o.type="text"}return o}updateModel(){const e=this;e.model["query.tooltipMagnifBtn"]=e.getLocaleString("query.tooltipMagnifBtn"),e.model["query.tooltipCloseDialogBtn"]=e.getLocaleString("query.tooltipCloseDialogBtn"),e.model["query.chooseALayerCombo"]=e.getLocaleString("query.chooseALayerCombo"),e.model["query.tooltipSendQueryBtn"]=e.getLocaleString("query.tooltipSendQueryBtn"),e.model["query.sendQueryBtnText"]=e.getLocaleString("query.sendQueryBtnText"),e.model["query.cancelQueryTooltip"]=e.getLocaleString("query.cancelQueryTooltip"),e.model["query.cancelQueryButton"]=e.getLocaleString("query.cancelQueryButton"),e.model["query.zoomToExtent"]=e.getLocaleString("query.zoomToExtent"),e.model["wfs.changeCriteria"]=e.getLocaleString("wfs.changeCriteria"),e.model.headerTitle=e.getLocaleString("query.titleDialog",{layerName:e.getCurrentQuery().title}),e.model["query.chooseAttrCombo"]=e.getLocaleString("query.chooseAttrCombo"),e.model.geometry=e.getLocaleString("geometry"),e.model["query.noAttributes"]=e.getLocaleString("query.noAttributes"),e.model["operators.eq.key"]=e.getLocaleString(F.eq.key),e.model["operators.neq.key"]=e.getLocaleString(F.neq.key),e.model["operators.gt.key"]=e.getLocaleString(F.gt.key),e.model["operators.lt.key"]=e.getLocaleString(F.lt.key),e.model["operators.gte.key"]=e.getLocaleString(F.gte.key),e.model["operators.lte.key"]=e.getLocaleString(F.lte.key),e.model["operators.contains.key"]=e.getLocaleString(F.contains.key),e.model["operators.starts.key"]=e.getLocaleString(F.starts.key),e.model["operators.ends.key"]=e.getLocaleString(F.ends.key),e.model["operators.empty.key"]=e.getLocaleString(F.empty.key),e.model["operators.btw.key"]=e.getLocaleString(F.btw.key),e.model["operators.nbtw.key"]=e.getLocaleString(F.nbtw.key),e.model["operators.intersects.key"]=e.getLocaleString(F.intersects.key),e.model["operators.within.key"]=e.getLocaleString(F.within.key),e.model["query.textAddCondBtn"]=e.getLocaleString("query.textAddCondBtn"),e.model.box=e.getLocaleString("box"),e.model.line=e.getLocaleString("line"),e.model.polygon=e.getLocaleString("polygon"),e.model["query.logicalOpLbl"]=e.getLocaleString("query.logicalOpLbl"),e.model["query.logicalOpAndLbl"]=e.getLocaleString("query.logicalOpAndLbl"),e.model["query.logicalOpOrLbl"]=e.getLocaleString("query.logicalOpOrLbl"),e.model["query.searchFieldPhd"]=e.getLocaleString("query.searchFieldPhd"),e.model["query.tooltipAddCondBtn"]=e.getLocaleString("query.tooltipAddCondBtn"),e.model["query.textAddCondBtn"]=e.getLocaleString("query.textAddCondBtn"),e.model["query.returnToQueryBuilder"]=e.getLocaleString("query.returnToQueryBuilder"),e.geometryPanel&&e.geometryPanel.setTitles({main:e.getLocaleString("query.spatialFilter")}),e?.resultsLayer?.features&&e.resultsPanel.setTitles({main:e.resultsPanel.getLocaleString(e.resultsLayer.features.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.resultsLayer.features.length,layerName:e.getCurrentQuery().title})}),Object.keys(e.filterModel).forEach((t=>{e.filterModel[t]=e.getLocaleString(t)})),e.shareDialogController.model.share=e.getLocaleString("share"),e.shareDialogController.model["query.tooltipMagnifBtn"]=e.getLocaleString("query.tooltipMagnifBtn"),e.shareDialogController.model.close=e.getLocaleString("close"),e.resultsController&&(e.resultsController.model["wfs.QuerySortTitle"]=e.getLocaleString("wfs.QuerySortTitle"),e.resultsController.model.zoomToFeature=e.getLocaleString("zoomToFeature"),e.resultsController.model.linkInNewWindow=e.getLocaleString("linkInNewWindow"),e.resultsController.model.open=e.getLocaleString("open"),e.resultsController.model["featureInfo.complexData.array"]=e.getLocaleString("featureInfo.complexData.array"))}async updateLanguage(){R=this.map.options.locale,this.updateModel()}}n.A.mix(Q,l.default),Q.prototype.CLASS=_,n.A.control.WFSQuery=Q;const ee=Q},4238:(e,t,r)=>{"use strict";r.d(t,{B4:()=>s,W8:()=>o,hq:()=>l,rT:()=>i,tV:()=>a});var n=r(6514);function i(){return!0}function o(){return!1}function a(){}function s(e){let t,r,i;return function(){const o=Array.prototype.slice.call(arguments);return r&&this===i&&(0,n.aI)(o,r)||(i=this,r=o,t=e.apply(this,arguments)),t}}function l(e){return function(){let t;try{t=e()}catch(e){return Promise.reject(e)}return t instanceof Promise?t:Promise.resolve(t)}()}},4272:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(4641),l=r(3791),c=r(5777);n.A.control=n.A.control||{};class u extends s.default{scales=null;async loadTemplates(){const e=await r.e(9285).then(r.bind(r,9285));this.template=e.default}async render(e){const t=this;if(!t.map)throw Error("ScaleSelector no registrado");!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t)),t.scales||await t.map.wrap.getMap(),t.scales=t.map.wrap.getResolutions().map(t.getScale,t),await t.renderData({scale:t.getScale(),screenSize:o.A.screenSize,scales:t.scales},(function(){t.div.querySelectorAll("option").forEach((function(e){e.textContent="1:"+t.format(e.textContent.substr(2))})),t.addUIEventListeners(),a.A.isFunction(e)&&e(),t.controller=new c.A(t.model,new l.A(t.div)),t.updateModel()}))}addUIEventListeners(){const e=this;e.div.querySelector('input[type="button"]').addEventListener(i.A.event.CLICK,(function(){e.setScreenSize()}),{passive:!0}),e.div.querySelector("select").addEventListener("change",(function(){e.setScale(this.value)}))}setScale(e){const t=this;let r=.0254*e/t.getDpi(o.A.screenSize);return window.devicePixelRatio&&(r/=window.devicePixelRatio),t.metersPerDegree&&(r/=t.metersPerDegree),t.map.wrap.setResolution(r),r}updateModel(){this.model.estimatedMapSize=this.getLocaleString("estimatedMapSize")}updateLanguage(){this.updateModel()}}u.prototype.CLASS="tc-ctl-ss",n.A.control.ScaleSelector=u;const h=u},4294:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(915),i=r(1597),o=r(2096),a=r(2497);class s extends o.Ay{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new s(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,r,n){const o=this.flatCoordinates,a=(0,i.hG)(e,t,o[0],o[1]);if(a<n){const e=this.stride;for(let t=0;t<e;++t)r[t]=o[t];return r.length=e,a}return n}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return(0,n.dP)(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return(0,n.Rj)(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=(0,a._n)(this.flatCoordinates,0,e,this.stride),this.changed()}}const l=s},4338:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(6837),i=r(9438),o=r(915),a=r(7430);class s extends a.A{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(i.JH),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,r=e.length;t<r;++t)this.changeEventsKeys_.push((0,i.KT)(e[t],n.A.CHANGE,this.changed,this))}clone(){const e=new s(l(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,r,n){if(n<(0,o.Ld)(this.getExtent(),e,t))return n;const i=this.geometries_;for(let o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(e,t,r,n);return n}containsXY(e,t){const r=this.geometries_;for(let n=0,i=r.length;n<i;++n)if(r[n].containsXY(e,t))return!0;return!1}computeExtent(e){(0,o.aZ)(e);const t=this.geometries_;for(let r=0,n=t.length;r<n;++r)(0,o.X$)(e,t[r].getExtent());return e}getGeometries(){return l(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let r=0,n=t.length;r<n;++r)t[r].getType()===this.getType()?e=e.concat(t[r].getGeometriesArrayRecursive()):e.push(t[r]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],r=this.geometries_;let n=!1;for(let i=0,o=r.length;i<o;++i){const o=r[i],a=o.getSimplifiedGeometry(e);t.push(a),a!==o&&(n=!0)}return n?new s(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let r=0,n=t.length;r<n;++r)if(t[r].intersectsExtent(e))return!0;return!1}isEmpty(){return 0===this.geometries_.length}rotate(e,t){const r=this.geometries_;for(let n=0,i=r.length;n<i;++n)r[n].rotate(e,t);this.changed()}scale(e,t,r){r||(r=(0,o.q1)(this.getExtent()));const n=this.geometries_;for(let i=0,o=n.length;i<o;++i)n[i].scale(e,t,r);this.changed()}setGeometries(e){this.setGeometriesArray(l(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let r=0,n=t.length;r<n;++r)t[r].applyTransform(e);this.changed()}translate(e,t){const r=this.geometries_;for(let n=0,i=r.length;n<i;++n)r[n].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function l(e){return e.map((e=>e.clone()))}const c=s},4350:(e,t,r)=>{"use strict";r.d(t,{HT:()=>c,Wp:()=>u,fB:()=>s,gp:()=>a,sj:()=>l});var n=r(915),i=r(2845),o=r(1374);function a(e,t,r,i,a,s){return s=s??(0,n.R8)((0,n.S5)(),e,t,r,i),!!(0,n.HY)(a,s)&&(s[0]>=a[0]&&s[2]<=a[2]||s[1]>=a[1]&&s[3]<=a[3]||(0,o.j)(e,t,r,i,(function(e,t){return(0,n.Mx)(a,e,t)})))}function s(e,t,r,n,i){for(let o=0,s=r.length;o<s;++o){if(a(e,t,r[o],n,i))return!0;t=r[o]}return!1}function l(e,t,r,n,o){return!!(a(e,t,r,n,o)||(0,i.a_)(e,t,r,n,o[0],o[1])||(0,i.a_)(e,t,r,n,o[0],o[3])||(0,i.a_)(e,t,r,n,o[2],o[1])||(0,i.a_)(e,t,r,n,o[2],o[3]))}function c(e,t,r,n,o){if(!l(e,t,r[0],n,o))return!1;if(1===r.length)return!0;for(let t=1,s=r.length;t<s;++t)if((0,i.t7)(e,r[t-1],r[t],n,o)&&!a(e,r[t-1],r[t],n,o))return!1;return!0}function u(e,t,r,n,i){for(let o=0,a=r.length;o<a;++o){const a=r[o];if(c(e,t,a,n,i))return!0;t=a[a.length-1]}return!1}},4363:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(8038),i=r(797),o=r(3301),a=r(8325);i.A.elevationService={GOOGLE:"elevationServiceGoogle",IDENA:"elevationServiceIDENA",IGN_ES:"elevationServiceIGNEs",IGN_FR:"elevationServiceIGNFr"},n.A.tool=n.A.tool||{};let s=1;class l{static errors={MAX_COORD_QUANTITY_EXCEEDED:"max_coord_quantity_exceeded",UNDEFINED:"undefined"};#Jr=[];constructor(e={}){this.options=e,(this.options.services||[i.A.elevationService.IDENA,i.A.elevationService.IGN_ES,i.A.elevationService.IGN_FR,i.A.elevationService.GOOGLE]).forEach(((e,t)=>{this.#Jr[t]=new Promise((function(t,i){const o="string"==typeof e?e:e.name,a=o.substr(0,1).toUpperCase()+o.substr(1),s="string"==typeof e?{}:e;r(8176)("./"+a).then((function(e){const r=e.default;n.A.tool[a]=r,t(new r(s))}))}))}))}getService(e){return this.#Jr[e]}getServices(){return Promise.all(this.#Jr)}async getElevation(e){const t=this,r=Object.assign({},e);r.id=function(){const e=s.toString();return s++,e}(),void 0===r.resolution&&(r.resolution=t.options.resolution),void 0===r.sampleNumber&&(r.sampleNumber=t.options.sampleNumber);let n,i,l=!1;o.A.isFunction(r.partialCallback)&&(i=r.partialCallback);const c=1===r.coordinates.length;r.coordinates=a.A.interpolate(r.coordinates,r),r.resolution=0,r.sampleNumber=0,n=r.coordinates.map((e=>[e[0],e[1],null])),Object.prototype.hasOwnProperty.call(r,"includeHeights")||(r.includeHeights=c);const u=await t.getServices(),h=new Array(u.length);h.fill(!1);const d=u.map((e=>async function(e){if(navigator.onLine)try{const t=await e.request(r);return l?null:e.parseResponse(t,r)}catch(e){return null}return null}(e)));for(var p=0,g=d.length;p<g;p++)if(!l){let r;try{r=h[p]=await d[p]}catch(e){console.error(e)}if(null===r){if(h.every((e=>null===e)))throw Error("No services available")}else t._updatePartialResult(n,h)&&(l=!0),i&&i(n);if(l)return h.forEach(((t,r)=>!1===t&&u[r].cancelRequest(e.id))),n.some((e=>null!==e[2]))?n:[]}}async setGeometry(e={}){const t=this,r=e.features||[];if(r.length){const i=function(e,t,r){Promise.all(e).then((function(e){t(e)}),(function(e){r(e)}))};if(e.maxCoordQuantity&&e.resolution&&r.reduce((function(t,r){if(r)switch(t+=r.getCoords({pointArray:!0}).length,!0){case SITNA.feature.Polyline&&r instanceof SITNA.feature.Polyline:case SITNA.feature.Polygon&&r instanceof SITNA.feature.Polygon:case SITNA.feature.MultiPolyline&&r instanceof SITNA.feature.MultiPolyline:case SITNA.feature.MultiPolygon&&r instanceof SITNA.feature.MultiPolygon:t+=Math.floor(r.getLength()/e.resolution)}return t}),0)>e.maxCoordQuantity)throw Error(l.errors.MAX_COORD_QUANTITY_EXCEEDED);const o=e.resolution||0,s=function(t){return{crs:e.crs,coordinates:t,resolution:o,sampleNumber:0}},c=function(e){return t.getElevation(s(e))},u=r.map((function(e){return new Promise((function(r,n){switch(!0){case!e:r(null);break;case SITNA.feature&&SITNA.feature.MultiPolygon&&e instanceof SITNA.feature.MultiPolygon:{const t=e.getCoords().map((function(e){return new Promise((function(t,r){i(e.map(c),t,r)}))}));i(t,r,n);break}case SITNA.feature&&SITNA.feature.Polygon&&e instanceof SITNA.feature.Polygon:case SITNA.feature&&SITNA.feature.MultiPolyline&&e instanceof SITNA.feature.MultiPolyline:{const t=e.getCoords().map(c);i(t,r,n);break}case SITNA.feature&&SITNA.feature.Polyline&&e instanceof SITNA.feature.Polyline:t.getElevation(s(e.getCoords())).then((function(e){r(e)}),(function(e){n(Error(e))}));break;case SITNA.feature&&SITNA.feature.Point&&e instanceof SITNA.feature.Point:t.getElevation(s([e.getCoords()])).then((function(e){r(e[0])}),(function(e){n(Error(e))}));break;default:n(Error("Geometry not supported"))}}))})),h=await Promise.all(u),d=function(e,t){a.A.isPoint(e)?(t[2]=e[2],e.length>3&&(t[3]=e[3])):Array.isArray(e)&&e.forEach((function(e,r){d(e,t[r])}))},p=function(e){return a.A.isPoint(e)?1:Array.isArray(e)?e.reduce(((e,t)=>e+p(t)),0):0};return h.forEach((function(e,t){const i=r[t];if(i){n.A.isDebug&&console.log("Estableciendo elevaciones a entidad:",i);const t=i.getCoords();p(t)===p(e)?(d(e,t),i.setCoordinates(t)):e&&i.setCoordinates(e)}})),r}return[]}_updatePartialResult(e,t){let r=!1,n=!1;for(var i=0,o=e.length;i<o;i++){const r=e[i];let o=null,l=null;const c=t.filter((e=>null!==e));for(var a=0,s=c.length;a<s;a++){const e=c[a];if(!1===e&&(n=!0),Array.isArray(e)){const t=e[i];null===o&&t&&(o=t[2],t.length>3&&null===l&&(l=t[3]))}if(null!==o){r[2]=o,null!==l&&(r[3]=l);break}}}return r=!n&&e.every((e=>null!==e[2]))||t.every((e=>!1!==e)),r}static getElevationGain(e){return o.A.getElevationGain(e)}}n.A.tool.Elevation=l;const c=l},4370:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(3327);const i="sitna-button";class o extends n.A{#Qr;static variant={DEFAULT:"default",ICON:"icon",ICONLEFT:"icon-left",LINK:"link",MINIMAL:"minimal"};static action={CLOSE:"close",DELETE:"delete",DOWNLOAD:"download",DOWNLOAD_ALL:"download-all",EDIT:"edit",SHARE:"share"};constructor(){super(),this.#Qr=document.createElement("button"),this.#Qr.setAttribute("type","button"),this.createTemplate();const e=this.getTemplate();this.#Qr.appendChild(e.content.cloneNode(!0)),this.#Qr.querySelector("slot").addEventListener("slotchange",(()=>this.#en())),this.shadowRoot.appendChild(this.#Qr)}connectedCallback(){this.#en(),this.#tn(this.variant,this.variant),this.#rn(),this.#d(),this.#nn(),this.#in()}static get observedAttributes(){return["text","icon","variant","disabled","active","icon-text","title"]}attributeChangedCallback(e,t,r){if(t!==r&&("disabled"===e?this.#d():"active"===e&&this.#rn(),t!==r))switch(e){case"text":this.#en();break;case"icon":this.#nn();break;case"variant":this.#tn(t,r);break;case"icon-text":this.#in();break;case"title":this.hasAttribute(e)?this.#Qr.hasAttribute("title")&&this.#Qr.setAttribute("title",r):this.#Qr.hasAttribute("title")&&this.#en(),this.#Qr.ariaLabel=r}}get elementName(){return i}get text(){return this.getAttribute("text")}set text(e){this.#ue("text",e)}#en(){const e=this.text||this.textContent;this.textContent!==e&&(this.textContent=e??"");const t=this.variant;(t===o.variant.ICON||t===o.variant.MINIMAL||t===o.variant.LINK&&!this.hasAttribute("title"))&&(e?this.#Qr.setAttribute("title",e):this.#Qr.removeAttribute("title"))}get icon(){return this.getAttribute("icon")}set icon(e){this.#ue("icon",e)}#nn(){this.#he("icon",this.icon)}get variant(){return this.getAttribute("variant")||o.variant.DEFAULT}set variant(e){this.#ue("variant",e)}#tn(e,t){this.#Qr.classList.remove(e),t??=o.variant.DEFAULT,t!==o.variant.DEFAULT&&this.#Qr.classList.add(t);const r=this.text;r&&(t===o.variant.ICON||t===o.variant.MINIMAL||t===o.variant.LINK&&!this.hasAttribute("title"))?this.#Qr.setAttribute("title",r):this.#Qr.removeAttribute("title")}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get value(){return this.getAttribute("value")}set value(e){this.setAttribute("value",e)}#d(){this.#Qr.disabled=this.disabled}get active(){return this.hasAttribute("active")}set active(e){this.toggleAttribute("active",!!e)}#rn(){this.#Qr.classList.toggle("active",this.active)}get iconText(){return this.getAttribute("icon-text")}set iconText(e){this.#ue("icon-text",e)}#in(){this.#he("icon-text",this.iconText)}#ue(e,t){t?this.setAttribute(e,t):this.removeAttribute(e)}#he(e,t){t?this.#Qr.setAttribute("data-"+e,t):this.#Qr.removeAttribute("data-"+e)}}customElements.get(i)||(n.A.preloadStyle(i),customElements.define(i,o));const a=o},4422:(e,t,r)=>{"use strict";r.d(t,{R8:()=>o});const n={info:1,warn:2,error:3,none:4};let i=n.info;function o(...e){i>n.warn||console.warn(...e)}},4442:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n=class{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}},4450:(e,t,r)=>{"use strict";r.d(t,{A:()=>C});var n=r(8038),i=r(3301),o=r(797),a=r(187),s=r(3365),l=r(6792),c=r(6031);n.A.layer=n.A.layer||{},o.A.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";const u={},h={},d=new Map,p={};var g={};const f=()=>[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],m=function e(t,r,n){var i=!1;if(n.count=n.count+1,t.name===r)i=!0;else for(var o=t.children.length-1;o>=0;o--)if(e(t.children[o],r,n)){i=!0;break}return i};var y=function(e){return i.A.extend({aggregate:!0,lazy:!1},e)},v=function(e,t,r){var n,i,o=[];n=t||[],i=r||[];for(var a=(e||[]).concat(n),s=0;s<a.length;s++)a.indexOf(a[s])===s&&-1===i.indexOf(a[s])&&o.push(a[s]);return o},A=function(e,t,r,n){return r.some((function(r){return e.compareNames(t,r,n)}))};const S="json",E="png",w="unavailable",_="not_allowed";class L extends s.A{transparent;names;availableNames;#on;#an=null;#sn;#ln=new Map;#cn;constructor(){super(...arguments);const e=this;if(e.#on=null,e.wrap=new n.A.wrap.layer.Raster(e),e.transparent=!1!==e.options.transparent,e.url=e.options.url,e.capabilities=n.A.capabilities[e.url],e.params=e.options.params,"string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else if(e.names=[],e.availableNames=[],Array.isArray(e.options.layerNames))for(var t=0;t<e.options.layerNames.length;t++){const r=e.options.layerNames[t];"string"==typeof r?(e.names.push(r),e.availableNames.push(r)):Object.prototype.hasOwnProperty.call(r,"name")&&(e.availableNames.push(r.name),(void 0===r.isVisible||r.isVisible)&&e.names.push(r.name))}else{var r=e.options.params?e.options.params.sld_body:null;if(r){const t=new DOMParser;var a;try{a=t.parseFromString(r,"text/xml")}catch(e){n.A.error(e.message),a=null}if(a){var s=i.A.getElementByNodeName(a,"sld:NamedLayer");if(s&&s.length>0){var l=i.A.getElementByNodeName(s[0],"sld:Name");if(l&&l.length>0){const t=l[0].textContent;e.names.push(t),e.availableNames.push(t)}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes||e.options.ignorePrefixes,e.wrap._promise=new Promise((function(t,r){const i=function(n){e.wrap.setLayer(n),n?t(n):r(Error('Could not create native layer for "'+e.id+'"'))},a=function(t){e.capabilities=e.capabilities||t;var a=e.getGetMapUrl();n.A.capabilities[e.options.url]=n.A.capabilities[e.options.url]||t,n.A.capabilities[a]=n.A.capabilities[a]||t,function(){let t;if(!e.wrap.layer)switch(e.type){case o.A.layerType.GROUP:i(t);break;case o.A.layerType.WMTS:try{t=e.#un(),i(t)}catch(n){e.getCapabilitiesOnline().then((function(n){e.capabilities=n;try{t=e.#un(),i(t)}catch(e){r(e)}}))}break;default:t=e.#hn(),i(t)}}()};if(e.capabilities)return a(e.capabilities),void(e.#on=Promise.resolve(e.capabilities));e.#on=d.get(e.url)||new Promise((function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then((function(e){t(e)})).catch((function(e){i.catch((function(){r(e)}))})),i.then((function(e){t(e)})).catch((function(){n.catch((function(e){r(e)}))}))})),d.set(e.url,e.#on),e.getCapabilitiesPromise().then((function(e){a(e)})).catch((function(t){e.map&&e.map.trigger(o.A.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}),r(t)}))})),e.#sn=null,o.A.layerType.WMTS===e.type&&e.wrap.setWMTSUrl()}#hn(){const e=this,t=Array.isArray(e.names)?e.names.join(","):e.names,r=e.format,o=e.options;var a={LAYERS:t,FORMAT:r,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&i.A.extend(a,e.params),e.queryParams&&i.A.extend(a,e.queryParams);var s=e.getPreferredInfoFormat();return null!==s&&(a.INFO_FORMAT=s),o.filter&&(o.filter instanceof n.A.filter.Filter&&(a.filter=o.filter.getText()),o.filter instanceof c.B?a.filter=o.filter.getFilterText(e):(new DOMParser).parseFromString(o.filter,"text/xml").querySelector("parsererror")?a.cql_filter=o.filter:a.filter=o.filter),e.wrap.createWMSLayer(e.getGetMapUrl(),a,o)}#un(){return this.wrap.createWMTSLayer(this.options)}setVisibility(e){this.tree=null,super.setVisibility.call(this,e)}#dn(e){const t=this;if(t.type!==o.A.layerType.WMS)return e;var r=e.slice();return t.#pn(r,t.wrap.getRootLayerNode()),r}#pn(e,t){const r=this;var n=!1,i=r.wrap.getLayerNodes(t);if(i.length){i.forEach((t=>{r.#pn(e,t)&&(n=!0)}));var o,a,s=i.map((function(e){return r.wrap.getName(e)})).reverse(),l=!1;if(a=o=e.indexOf(s[0]),o<0)l=!0;else for(var c=1,u=s.length;c<u;c++)if(s[c]!=e[++o]){l=!0;break}if(!l){var h=r.wrap.getName(t);h&&s.length>1&&(e.splice(a,s.length,h),n=!0)}}return n}#gn(e){const t=this;let r=[];const n=e.slice(),i=t.wrap.getRootLayerNode();for(var o=0,a=n.length;o<a;o++)r=r.concat(t.#fn(n[o],i));return r}#fn(e,t,r){const n=this;let i=[];const o=n.wrap.getName(t),a=n.compareNames(e,o);let s=!1;const l=n.wrap.getLayerNodes(t);for(var c=0;c<l.length;c++){var u=n.#fn(e,l[c],r||a);u.length?i=i.concat(u):s=!0}return l.length&&!s||(r||a)&&(i=[o]),i}getLimitedMatrixSet(){const e=this,t=e.layerNames,r=e.matrixSet;var n=e.capabilities;const o=n.Contents.TileMatrixSet.find((e=>e.Identifier===r));if(o){const e=n.Contents.Layer.find((e=>e.Identifier===t));if(e.TileMatrixSetLink){const t=e.TileMatrixSetLink.find((e=>e.TileMatrixSet===r));if(t&&t.TileMatrixSetLimits&&t.TileMatrixSetLimits.length){const e=[];return t.TileMatrixSetLimits.forEach((function(t){const r=o.TileMatrix.find((e=>e.Identifier===t.TileMatrix));r&&e.push(i.A.extend({matrixIndex:o.TileMatrix.indexOf(r)},r,t))})),e}return o.TileMatrix}return o.TileMatrix}return null}async setLayerNames(e,t){const r=this;await r.wrap.getLayer();let n=Array.isArray(e)?e:e.split(",");r.names=n;var a=y(t);a.aggregate&&(n=r.#dn(n)),r.#sn=null;var s={LAYERS:n.join(","),TRANSPARENT:!0};if(a.lazy){var l=r.#cn||r.wrap.getParams();r.#cn=i.A.extend(l,s)}else r.map&&r.map.trigger(o.A.event.BEFOREUPDATEPARAMS,{layer:r}),r.tree=null,r.wrap.setParams(s),!a.reset&&r.map||(r.availableNames=r.names),r.map&&r.map.trigger(o.A.event.UPDATEPARAMS,{layer:r});return r.names}async setFilter(e){const t=this;await t.wrap.getLayer();var r=t.wrap.getParams();return delete r.filter,delete r.cql_filter,e instanceof n.A.filter.Filter?t.filter=r.filter=e.getText():(new DOMParser).parseFromString(e,"text/xml").querySelector("parsererror")?t.filter=r.cql_filter=e:t.filter=r.filter=e,t.wrap.setParams(r),e}#mn(e){const t=this;var r="string"==typeof e?e.split(","):e;if(t.capabilities){t.tree=null;var n=t.getTree();r.sort((function(e,t){var r={count:0},i={count:0};return m(n,e,r),m(n,t,i),i.count-r.count}))}return r}async addLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=y(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS?r.wrap.getParams().LAYERS.split(","):[];return n.aggregate&&(i=r.#gn(i),o=r.getDisgregatedLayerNames()),await r.setLayerNames(r.#mn(v(o,i,null)),t)}async removeLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=y(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS;return n.aggregate&&(i=r.#gn(i),o=r.getDisgregatedLayerNames()),await r.setLayerNames(r.#mn(v(o,null,i)),t)}async toggleLayerNames(e,t){const r=this;await r.wrap.getLayer();const n=y(t);let i=Array.isArray(e)?e:e.split(","),o=r.wrap.getParams().LAYERS;n.aggregate&&(i=r.#gn(i),o=r.getDisgregatedLayerNames());const a=[],s=[];for(var l=0;l<i.length;l++){var c=i[l];o.indexOf(c)<0?a.push(c):s.push(c)}var u=[];a.length>0&&u.push(r.addLayerNames(a,n)),s.length>0&&u.push(r.removeLayerNames(s,n));const h=await Promise.all(u),d=h[0],p=h[1];return d?p?d.concat(p):d:[]}getDisgregatedLayerNames(){const e=this,t=e.wrap.layer;if(e.wrap.isNative(t)&&e.type===o.A.layerType.WMS){if(!e.#sn){var r=e.wrap.getParams().LAYERS;r=Array.isArray(r)?r:r.split(","),e.#sn=e.#gn(r)}}else e.#sn=e.names;return e.#sn.slice()}isValidFromNames(){const e=this;for(var t=0,r=e.names.length;t<r;t++)if(!e.getLayerNodeByName(e.names[t]))return!1;return!0}isCompatible(e){const t=this;switch(t.type){case o.A.layerType.WMTS:return t.wrap.isCompatible(e)||t.wrap.getCompatibleMatrixSets(e).length>0;case o.A.layerType.WMS:return t.wrap.isCompatible(e)}return!1}getCompatibleCRS(e={}){const t=this;let r=t.wrap.getCompatibleCRS();if(e.includeFallback&&t.fallbackLayer){const e=t.getFallbackLayer();e instanceof s.A&&(r=r.concat(e.wrap.getCompatibleCRS()))}return e.normalized&&(r=r.map((function(e){return i.A.getCRSCode(e)})).filter((function(e){return null!==e})).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]).map((function(e){return"EPSG:"+e}))),r}getProjection(){const e=this;switch(e.type){case o.A.layerType.WMTS:return e.wrap.layer.getSource().getProjection().getCode();case o.A.layerType.WMS:return e.map.crs}}setProjection(e={}){const t=this;if(e.crs)switch(t.type){case o.A.layerType.WMTS:var r=t.wrap.getCompatibleMatrixSets(e.crs)[0];r?(t.matrixSet=r,t.wrap.setMatrixSet(r)):t.wrap.setProjection(e),t.mustReproject=!r;break;case o.A.layerType.WMS:t.wrap.setProjection(e),t.mustReproject=!t.isCompatible(e.crs)}}getOgcScale(){return this.map.wrap.getResolution()*this.map.getMetersPerUnit()/28e-5}isVisibleByScale(e,t){const r=this;let n;var i,a;switch(r.type){case o.A.layerType.WMTS:n=!1;var s=r.wrap.getTileMatrix(r.options.matrixSet);if(s)for(i=r.getOgcScale(),a=0;a<s.length;a++)if(r.wrap.getScaleDenominators(s[a])[0]===i){n=!0;break}break;case o.A.layerType.WMS:n=!0;var l=r.wrap.getAllLayerNodes();if(l.length>0){var c;i=r.getOgcScale(),parseInt(e).toString()===e&&(c=r.#ln.get(e)),c||(c=l.find((n=>r.compareNames(r.wrap.getName(n),e,t))));const o=function(e){const t=r.wrap.getScaleDenominators(e);return!(parseFloat(t[1])>i||parseFloat(t[0])<i)};if(c&&(n=o(c),!n&&c.Layer&&c.Layer.length>0))return c.Layer.some(o)}break;default:n=!0}return n}isVisibleByName(e,t){const r=this;let n=!1;switch(r.type){case o.A.layerType.WMTS:if(r.wrap.getWMTSLayer()){n=!0;break}break;case o.A.layerType.WMS:{const i=function(e){return o(e,r.wrap.getRootLayerNode())},o=function e(n,i){let o=[];const a=r.wrap.getName(i);if(r.compareNames(a,n,t))o.push(a);else{const t=r.wrap.getLayerNodes(i);let s=!1;t.forEach((t=>{const r=e(n,t);r.length&&(s=!0,o=o.concat(r))})),s&&o.push(a)}return o};n=i(e).some((e=>A(r,e,r.names)));break}default:n=!0}return n}isVisibleByNode(e){const t=this;let r=!1;switch(t.type){case o.A.layerType.WMTS:if(t.wrap.getWMTSLayer()){r=!0;break}break;case o.A.layerType.WMS:{const o=function(e,t){return e===t||e.Layer&&e.Layer.some((e=>o(e,t)))};for(var n=0,i=t.names.length;n<i;n++)if(t.getLayerNodesByName(t.names[n]).some((t=>o(t,e)))){r=!0;break}break}default:r=!0}return r}#yn(e){const t=this;var r=t.availableNames.indexOf(e.name);if(-1===r)for(var n=0,i=e.children.length;n<i&&-1===(r=t.#yn(e.children[n]));n++);return r}#vn(e){const t=this;e.children.sort((function(e,r){return t.#yn(r)-t.#yn(e)}));for(var r=0,n=e.children.length;r<n;r++)t.#vn(e.children[r])}#An(e){const t=this;return t.getDisgregatedLayerNames().some((r=>t.getNodePath(r).some((t=>t.Name===e||!t.Name&t.Title===e))))}getNestedTree(){return this.getTree(!1,!0)}getFullTree(){return this.getTree(!0)}getTree(e,t=!1){const r=this;void 0===e&&(e=!r.hideTree);var a=!e&&!t&&r.tree;if(!a){let s;const l=function e(t,o,a,l){let c;for(var u of r.#ln.keys())if(r.#ln.get(u)===t){c=u;break}c||(c=n.A.getUID(),r.#ln.set(c,t));let h={name:r.wrap.getName(t),title:t.title||t.Title,uid:c,children:[],abstract:!!t.Abstract,metadata:!!t.MetadataURL};if(a&&(s=h),A(r,h.name,r.availableNames)&&(o=!0),l){if(!a&&!r.#An(h.name||h.title))return null;o=!0}if(r.options.isBase)h.name=r.names.join(","),h.title=r.title||h.title,h.isBase=r.isDefault,r.options.thumbnail&&(h.legend=[{src:r.options.thumbnail}]);else{var d;h.isVisible=h===s?r.getVisibility():r.isVisibleByName(h.name);var p=r.wrap.getLayerNodes(t);for(d=0;d<p.length;d++){const t=e(p[d],o,void 0,l);t&&(g=h,(f=t).parent=g,r.options.inverseTree?i.A.fastUnshift(g.children,f):g.children.push(f))}h.legend=r.wrap.getLegend(t),o||a||(s.children=s.children.concat(h.children),h=null)}var g,f;return h};switch(r.type){case o.A.layerType.WMTS:a=l(r.wrap.getWMTSLayer(),!r.hideTree,!0);break;case o.A.layerType.WMS:r.capabilities&&(!function e(t){let n=o.A.visibility.NOT_VISIBLE;if(t){if(t.children)for(var i=0,a=t.children.length;i<a;i++){var l=e(t.children[i]);if(l===o.A.visibility.VISIBLE||l===o.A.visibility.HAS_VISIBLE){n=o.A.visibility.HAS_VISIBLE;break}}t.isVisible&&(t===s&&r.layerNames&&r.layerNames.length&&t.isVisible||t!==s)&&(n=o.A.visibility.VISIBLE),t.visibilityState=n}return n}(a=l(r.wrap.getRootLayerNode(),e||!r.hideTree,!0,t)),r.hideTree&&r.#vn(a))}a||(a={name:r.name,title:r.title}),a.title=r.title||a.title,a.customLegend=r.customLegend||a.customLegend,e||(r.tree=a)}return a}setNodeVisibility(e,t){const r=this,n=super.setNodeVisibility,i=[];(e=Array.isArray(e)?e:[e]).forEach((function(e){i.push(n.call(r,e,t))}));var o=function e(t){var r=[];if(t.name)r[0]=t.name;else for(var n=0;n<t.children.length;n++)r=r.concat(e(t.children[n]));return r};if(i.some((e=>r.isRoot(e))))t&&0===r.names.length?r.addLayerNames(r.availableNames).then((function(){r.setVisibility(!0)})):r.setVisibility(t);else{var a=i.map((e=>o(e))).join(",");t?r.addLayerNames(a):r.removeLayerNames(a)}return i.length>1?i:i[0]}getNodePath(e,t){const r=this;let n=[];return r.type===o.A.layerType.WMS&&r.capabilities&&(e=e||r.names[0],n=function n(o){var a=[],s=r.wrap.getName(o);if(r.compareNames(s,e,t))a.push(o);else for(var l=r.wrap.getLayerNodes(o),c=0;c<l.length;c++){var u=n(l[c]);if(u.length){a=u,i.A.fastUnshift(a,o);break}}return a}(r.wrap.getRootLayerNode())),n}getPath(e,t){return this.getNodePath(e,t).map((function(e){return e.title||e.Title}))}getLayerNodesByName(e){const t=[],r=this,n=r.wrap.getServiceType()===o.A.layerType.WMTS?r.wrap.getIdentifier:r.wrap.getName,i=r.wrap.getAllLayerNodes();for(var a=0,s=i.length;a<s;a++)r.compareNames(n(i[a]),e)&&t.push(i[a]);return t}getLayerNodeByName(e){const t=this.getLayerNodesByName(e);return t.length?t[0]:null}getChildrenLayers(e){const t=[],r=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var n=0;n<e.Layer.length;n++)t.push(e.Layer[n]),r(e.Layer[n],t)};return r(e,t),t}compareNames(e,t,r){let n=e===t;const i=void 0!==r?r:this.ignorePrefixes;if(!n&&i&&e&&t){var o=e.indexOf(":"),a=t.indexOf(":");o>=0&&a<0?n=e.substr(o+1)===t:a>=0&&o<0&&(n=e===t.substr(a+1))}return n}getCapabilitiesPromise(){return this.#on}getResolutions(){return this.wrap.getResolutions()}setResolutions(e){this.wrap.setResolutions(e)}getExtent(e={}){const t=this;let r=null;const a=t.map?.wrap.isGeo();if(t.type===o.A.layerType.WMS){const o=e.crs||t.map?.getCRS()||"EPSG:4326",c=i.A.getCRSCode(o),u=function(e){let r=null,n=!1;if(e.BoundingBox){r=Array.isArray(e.BoundingBox)?e.BoundingBox:[e.BoundingBox];const t=r.filter((e=>i.A.getCRSCode(e.crs)===c));t.length&&(n=!0,r=t)}return r||e.EX_GeographicBoundingBox&&a||!e.parent||(r=u(e.parent)),"1.3.0"===t.capabilities.version&&r&&(r=r.map((function(e){if("EPSG:4326"===e.crs){const t=e.extent;return{crs:e.crs,extent:[t[1],t[0],t[3],t[2]]}}return"CRS:84"===e.crs?{crs:"EPSG:4326",extent:e.extent}:e})),!n&&a&&e.EX_GeographicBoundingBox&&r.unshift({crs:"EPSG:4326",extent:e.EX_GeographicBoundingBox})),r},h=new Array(t.names.length);for(var s=0,l=h.length;s<l;s++){const e=t.getLayerNodeByName(t.names[s]);if(!e)return null;const r=u(e);if(!r)return null;h[s]=r}const d=h.map((function(e){const t={};let r,n;return e.forEach((function(e,t){0===t&&(r=e),i.A.getCRSCode(e.crs)===c&&(n=e)})),n?(t.crs=o,t.extent=n.extent):(t.crs=r.crs,t.extent=r.extent),t})).reduce((function(e,t){let r=e.get(t.crs);const n=t.extent;return r?(r=r.slice(),r[0]=Math.min(r[0],n[0]),r[1]=Math.min(r[1],n[1]),r[2]=Math.max(r[2],n[2]),r[3]=Math.max(r[3],n[3])):r=n,e.set(t.crs,r),e}),new Map);Array.from(d.keys()).some((e=>i.A.getCRSCode(e)===c))?(r=f(),d.forEach((function(e,t){i.A.getCRSCode(t)===c&&(r[0]=Math.min(e[0],r[0]),r[1]=Math.min(e[1],r[1]),r[2]=Math.max(e[2],r[2]),r[3]=Math.max(e[3],r[3]))}))):a&&(r=f(),d.forEach((function(e,t){if(n.A.getProjectionData({crs:t,sync:!0}).unit?.startsWith("degree")){const n=i.A.reprojectExtent(e,t,o);r[0]=Math.min(n[0],r[0]),r[1]=Math.min(n[1],r[1]),r[2]=Math.max(n[2],r[2]),r[3]=Math.max(n[3],r[3])}})))}else if(t.type===o.A.layerType.WMTS){const e=t.names[0],n=t.capabilities.Contents.Layer.find((t=>t.Identifier===e));if(n){const e=t.capabilities.Contents.TileMatrixSet.find((e=>e.Identifier===t.matrixSet));if(e&&(n.BoundingBox||a&&n.WGS84BoundingBox)){let t;if(t=Array.isArray(n.BoundingBox)?n.BoundingBox.find((t=>i.A.CRSCodesEqual(t.crs,e.SupportedCRS))):n.BoundingBox,t){const e=e=>e.split(" ").map((e=>parseFloat(e))),n=e(t.LowerCorner),i=e(t.UpperCorner);r=[n[0],n[1],i[0],i[1]]}!r&&a&&n.WGS84BoundingBox&&(r=i.A.reprojectExtent(n.WGS84BoundingBox,"EPSG:4326",e.SupportedCRS))}}}return r}getInfo(e){const t=this,r=t.wrap.getInfo(e);return r.metadata&&r.metadata.forEach((function(e){t.map?e.formatDescription=p[e.format]=p[e.format]||i.A.getLocaleString(t.map.options.locale,i.A.getSimpleMimeType(e.format))||i.A.getLocaleString(t.map.options.locale,"viewMetadata"):e.formatDescription=p[e.format]})),r}searchSubLayers(e){if(e&&e.length&&e.length>=3){var t=this,r=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)r=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){r=[];for(var o=0;o<t.availableNames.length;o++){var a=t.getLayerNodeByName(t.availableNames[o]);a&&(r.push(a),r=r.concat(t.getChildrenLayers(a)))}}else r=t.wrap.getAllLayerNodes();var s=i.A.patternFn(e),l=new RegExp(s,"i"),c=r.map((function(e,r){delete e.tcScore,e.tcPosition=r,t.wrap.normalizeLayerNode(e);var i=e.Title.trim(),o=l.exec(n.A.Util.htmlToText(i)),a=o?o.index:-1,s=-1;if(e.Abstract){var c=e.Abstract.trim(),u=l.exec(c);s=u?u.index:-1}return o&&i==o[0]?e.tcScore=20:0==a?e.tcScore=15:a>-1?e.tcScore=10:0==s?e.tcScore=5:s>-1&&(e.tcScore=1),e.tcScore?e:null})).filter((function(e){return null!=e})).sort((function(e,t){if(t.tcScore===e.tcScore){var r=i.A.replaceSpecialCharacters(e.Title),n=i.A.replaceSpecialCharacters(t.Title);return r<n?-1:r>n?1:0}return t.tcScore-e.tcScore}));return this.lastPattern=e,this.lastMatches=c,c}return[]}getGetCapabilitiesUrl(){const e=this;var t;const r=e.url,n={};if(e.type===o.A.layerType.WMTS)if(e.options.encoding===o.A.WMTSEncoding.RESTFUL){var a="/1.0.0/WMTSCapabilities.xml";const e=r.indexOf(a);e<0||e<r.length-a.length?("/"===r[r.length-1]&&(a=a.substr(1)),t=r+a):t=r}else t=r,n.SERVICE="WMTS",n.VERSION="1.0.0",n.REQUEST="GetCapabilities";else t=r,n.SERVICE="WMS",n.VERSION="1.3.0",n.REQUEST="GetCapabilities";return t+"?"+i.A.getParamString(i.A.extend(n,e.queryParams))}getPreferredInfoFormat(){var e=null;const t=this.wrap.getInfoFormats();if(t)for(var r=0;r<n.A.wrap.layer.Raster.infoFormatPreference.length;r++){var i=n.A.wrap.layer.Raster.infoFormatPreference[r];if(t.indexOf(i)>=0){e=i;break}}return e}getLegendGraphicImage(){const e=this;return new Promise((function(t,r){if(e.options.params.base64LegendSrc)return t(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var n=e.names[0],i=e.wrap.getInfo(n),o=new XMLHttpRequest,a=i.legend[0].src.split("?"),s=a[1].split("&"),l=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",c=0;c<s.length;c++){var u=s[c].split("=");u&&u.length>1&&u[1]&&(l+="&"+s[c])}e.options.params.env&&(l+="&"+e.options.params.env),o.open("POST",a[0],!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.responseType="arraybuffer",o.onload=function(r){if(200===this.status){for(var n=new Uint8Array(this.response),i=n.length,a=new Array(i);i--;)a[i]=String.fromCharCode(n[i]);var s,l=a.join(""),c=o.getResponseHeader("content-type");0===c.indexOf("image")&&(s="data:"+c+";base64,"+window.btoa(l),e.options.params.base64LegendSrc=s,t(s))}},o.send(l)}else r(Error("Función window.btoa no soportada por el navegador"))}))}async getWebGLUrl(e){const t=this,r=!i.A.isSecureURL(e)&&i.A.isSecureURL(i.A.toAbsolutePath(t.url))?t.getBySSL_(e):e;if(t.ignoreProxification)return{url:r};{const e={exportable:!0,ignoreProxification:t.ignoreProxification},n=await t.proxificationTool.fetchImage(r,e);let i=t.proxificationTool.cacheHost.getAction(r,e),o=n;if(!i)throw Error("No action to "+r);{const e=await i;if(e&&e.action)return{url:e.action.call(t.proxificationTool,r),image:o}}}}getLegendFormatUrl(e,t,r){const n=this;var a;const s=n.url,l={};if(n.type===o.A.layerType.WMTS)return null;if(a=s,l.SERVICE="WMS",l.VERSION="1.3.0",l.REQUEST="GetLegendGraphic",l.FORMAT=r?"image/png":"application/json",!t){var c=n.map.getExtent();l.CRS=n.map.on3DView?n.map.view3D.view2DCRS:n.map.getCRS(),"neu"===ol.proj.get(l.CRS).axisOrientation_&&(c=[c[1],c[0],c[3],c[2]]),l.SCALE=n.getOgcScale(),l.SRCWIDTH=n.map.div.clientWidth,l.SRCHEIGHT=n.map.div.clientHeight,l.BBOX=c.join(","),l.LEGEND_OPTIONS="hideEmptyRules:true;fontAntiAliasing:true",n?.options?.params&&Object.keys(n.options.params).forEach((e=>{l[e.toUpperCase()]=n.options.params[e]}))}return l.LAYER=e||n.availableNames[0],a+"?"+i.A.getParamString(i.A.extend(l,n.queryParams))}#Sn(){const e=this;return e.wrap&&e.wrap.$events?e.wrap.$events:null}async getImageLoad(e,t){const r=this,n=e.getImage();n._timestamp=Date.now();const a=n._timestamp,s=function(t){a<n._timestamp?r.#Sn().trigger(o.A.event.TILELOADERROR,{tile:e,error:{text:"Obsolete image"}}):(i.A.isSameOrigin(t.src)||r.map&&!r.map.crossOrigin||(n.crossOrigin=null!==t.crossOrigin?t.crossOrigin:r.map?r.map.crossOrigin:"anonymous"),n.setAttribute("src",t.src),n.onload=function(){r.#Sn().trigger(o.A.event.TILELOAD,{tile:e})},n.onerror=function(t){n.setAttribute("src",o.A.BLANK_IMAGE),r.#Sn().trigger(o.A.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})})};if(r.names&&r.names.length>0){const n=function(t){r.#Sn().trigger(o.A.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}}),s({src:o.A.BLANK_IMAGE})};if(r.type===o.A.layerType.WMTS){var l,c,u;if("KVP"!==r.encoding){var h=t.replace("."+r.format.split("/")[1],"");const e=h.split("/").slice(h.split("/").length-3).map((function(e){return parseInt(e)}));l=e[0],c=e[1],u=e[2]}else{let e=/.*TileMatrix=([\W|\w]*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(decodeURIComponent(t));e&&4===e.length&&(e=e.slice(1).map((function(e){return e})),l=e[0],c=e[2],u=e[1])}if(l&&c&&u){var d=r.wrap.getWMTSLayer();if(d){const e=d.TileMatrixSetLink.find((e=>e.TileMatrixSet===r.matrixSet));if(e&&e.TileMatrixSetLimits&&e.TileMatrixSetLimits.length>0){var p=e.TileMatrixSetLimits.findByProperty("TileMatrix",l);if(p&&r.map&&r.map.on3DView&&!(p.MinTileRow<=c&&p.MaxTileRow>=c&&p.MinTileCol<=u&&p.MaxTileCol>=u))return console.log("Prevenimos petición fuera de matrix set, cargamos imagen en blanco"),void s({src:o.A.BLANK_IMAGE})}}}}r.#Sn().trigger(o.A.event.BEFORETILELOAD,{tile:e});var g="";if("POST"===r.options.method){var f=t.split("?");g=f[1].split("&").filter((function(e){const t=e.split("=");return t.length>1&&t[1].trim().length>0&&"layers"!==t[0].trim().toLowerCase()})).join("&");try{const t=await r.proxificationTool.fetchImageAsBlob(f[0],{type:"POST",data:g,contentType:"application/x-www-form-urlencoded"}),n=URL.createObjectURL(t);e.getImage().onload=function(e){URL.revokeObjectURL(n)},s({src:n})}catch(e){n(e)}}else if(r.ignoreProxification){s({src:t});const n=e.getImage();i.A.isSameOrigin(t)||r.map&&!r.map.crossOrigin||(n.crossOrigin=r.map?r.map.crossOrigin:"anonymous"),n.onload=function(){r.#Sn().trigger(o.A.event.TILELOAD,{tile:e})},n.onerror=function(t){n.src=o.A.BLANK_IMAGE,r.#Sn().trigger(o.A.event.TILELOADERROR,{tile:e,error:{code:t.status,text:t.statusText}})},n.src=r.names.length?t:o.A.BLANK_IMAGE}else try{const e=await r.proxificationTool.fetchImage(t,{exportable:!r.map||r.map.crossOrigin});s(e)}catch(e){n(e)}}else s({src:o.A.BLANK_IMAGE}),r.#Sn().trigger(o.A.event.TILELOAD,{tile:e})}async describeLayer(e){const t=this,r=new URL(t.url,document.location.href);let n=function(e){return e.Layer?n(e.Layer[0]):e.Name};const i=t.names instanceof Array?t.names[0]||n(t?.capabilities?.Capability?.Layer):t.names;r.search=new URLSearchParams(Object.assign({request:"DescribeLayer",service:"WMS",version:"1.1.1",outputFormat:"application/json"},i?{Layers:i}:{}));let o=h[t.options.url];o||(o=h[t.options.url]=new Map),o.has(i)||o.set(i,t.proxificationTool.fetch(r.toString(),{method:"GET"}));const a=await o.get(i);if(a.contentType.startsWith("application/json"))return e?JSON.parse(a.responseText).layerDescriptions:JSON.parse(a.responseText).layerDescriptions[0];{let e=(new DOMParser).parseFromString(a.responseText,"text/xml"),t=e.querySelector("Exception ExceptionText")||e.querySelector("ServiceException");if(t)throw Error(t.textContent);return e.querySelector("LayerDescription")}}async getWFSURL(){const e=this;if(!u[e.options.url]){let t;try{t=await e.describeLayer()}catch(t){return u[e.options.url]=e.options.url.replace(/wms/gi,"wfs"),u[e.options.url]}if("WFS"!==t.owsType)u[e.options.url]=e.options.url.replace(/wms/gi,"wfs");else{const r=t.owsURL.substr(0,t.owsURL.length+(t.owsURL.endsWith("?")?-1:0));try{const t=new URL(r);t.searchParams.append("request","GetCapabilities"),await e.proxificationTool.fetch(t.toString(),{method:"HEAD"}),u[e.options.url]=r}catch(t){u[e.options.url]=e.options.url.replace(/wms/gi,"wfs")}}}return u[e.options.url]}async getWFSFeatureType(){const e=await this.describeLayer();return"WFS"!==e.owsType?"":e.typeName}async getWFSCapabilities(){const e=await this.#En(await this.getWFSURL());return await e.getCapabilitiesPromise()}async#En(e){const t=this;return t.#an&&t.#an.options.url===e&&t.#an.featureType===t?.names?.[0]||(t.#an=new l.A({type:o.A.layerType.WFS,url:e,featureType:t?.names?.[0]||null,stealth:!0})),t.#an}async getLegend(e){const t=this;if(t.type!==o.A.layerType.WMS)return null;const r=t.getGetMapUrl();var a=Object.prototype.hasOwnProperty.call(n.A.legendFormat,r)?n.A.legendFormat[r]:new Promise((async(e,i)=>{if(t.getLegendFormatUrl())try{var o=await Promise.all(t.availableNames.map((e=>t.proxificationTool.fetch(t.getLegendFormatUrl(e,!0),{retryAttempts:1}))));switch(o=o[0],!0){case o.contentType.toLowerCase().includes("application/json"):n.A.legendFormat[r]=S,e(S);break;case o.contentType.toLowerCase().includes("text/xml"):o.responseText.includes('"OperationNotSupported"')||o.responseText.includes('"MissingRights"')?(i(),n.A.legendFormat[r]=w):(e(E),n.A.legendFormat[r]=E);break;default:i(),n.A.legendFormat[r]=w}}catch(t){if(t?.status>=400)return void(405===t.status||501===t.status?e(_):(n.A.legendFormat[r]=w,i(t)));console.warn("GetLegendgraphic error no registrado")}}));if(n.A.legendFormat[r]=a,a instanceof Promise&&(a=await a),a===w)throw a;if(a===_)return[t.getDisgregatedLayerNames().map((e=>({layerName:e,rules:[{symbolizers:[{Point:{graphics:[{"external-graphic-url":"data:image/svg+xml;base64,"+window.btoa('<svg height="18" id="svg8" version="1.1" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg" xmlns:svg="http://www.w3.org/2000/svg"><g id="g1439" transform="translate(0,-290.65)"><path d="m 12,292.65 c -5.511,0 -10,4.489 -10,10 0,5.511 4.489,10 10,10 5.511,0 10,-4.489 10,-10 0,-5.511 -4.489,-10 -10,-10 z m 0,2 c 1.8532,0 3.55051,0.63256 4.9043,1.68359 L 5.68164,307.55625 C 4.63016,306.20231 4,304.50363 4,302.65 c 0,-4.43012 3.56988,-8 8,-8 z m 6.32031,3.0957 C 19.37078,299.09929 20,300.79735 20,302.65 c 0,4.43012 -3.56988,8 -8,8 -1.85265,0 -3.55071,-0.62922 -4.9043,-1.67969 z" id="path1433" style="fill:#999;"/></g></svg>')}]}}],title:i.A.getLocaleString(t.map.options.locale,"simbologyNotAvailable")}]})))];const s=await t.describeLayer(!0),l=a===S?t.proxificationTool.fetchJSON:t.proxificationTool.fetchImageAsBlob,c=a===S&&s.every((e=>"WFS"===e.owsType))?t.availableNames:t.getDisgregatedLayerNames();return Promise.all(c.map((async r=>{try{const c="WCS"===s.find((e=>e.layerName.substring(e.layerName.indexOf(":")+1)===r))?.owsType;var n=t.getLegendFormatUrl(r,e||c,a===E),i={retryAttempts:1};if(n.length>o.A.URL_MAX_LENGTH){let e=new URLSearchParams(n);n=n.substr(0,n.indexOf("?")),Object.assign(i,{type:"POST",data:e,contentType:"application/x-www-form-urlencoded"})}return(g=await l.call(t.proxificationTool,n,i))instanceof Blob?g.size<100?null:await new Promise((e=>{var t=new FileReader;t.readAsDataURL(g),t.onloadend=function(){e([{layerName:r,src:t.result}])}})):g.Legend}catch(e){return null}})))}async getDescribeFeatureTypeUrl(){return(await this.#En(await this.getWFSURL())).getDescribeFeatureTypeUrl()}getFallbackLayer(){const e=this;if(e.fallbackLayer instanceof s.A)return e.fallbackLayer;if(e.options.fallbackLayer){var t=e.options.fallbackLayer;return"string"==typeof t?(e.map?e.map.availableBaseLayers:a.A.availableBaseLayers).forEach((function(t){e.options.fallbackLayer===t.id&&(e.fallbackLayer=new L(i.A.extend({},t,{isBase:!0,stealth:!0,map:e.map})),e.fallbackLayer.firstOption=e)})):t instanceof s.A?(e.fallbackLayer=t,e.fallbackLayer.firstOption=e):(e.fallbackLayer=new L(i.A.extend({},t,{id:n.A.getUID(),isBase:!0,stealth:!0,title:e.title,map:e.map})),e.fallbackLayer.firstOption=e),e.fallbackLayer}return null}async describeFeatureType(e){const t=this;return(await t.#En(await t.getWFSURL())).describeFeatureType(e||t.layerNames[0])}refresh(){return this.wrap.reloadSource()}}n.A.layer.Raster=L;const C=L},4459:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(8038),i=r(797),o=r(3301),a=r(3967),s=r(4450),l=r(6792),c=r(5777),u=r(3791);n.A.control=n.A.control||{};const h=function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},d=function(e){return Promise.all([e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()])};class p{constructor(){this.showDetailsView="",this.backgroundMaps="",this.moreBackgroundMaps="",this.close="",this.cancel="",this.baseLayerNotCompatible="",this.baseLayerNotCompatible_instructions="",this.metadata="",this.fileDefault="",this.notAvailableTo3D="",this.reprojectionNeeded=""}}const g=[];class f extends a.default{#wn;#_n;#Ln;#Cn={LOAD_CRS_BUTTON:this.CLASS+"-crs-btn-load",CRS_DIALOG:this.CLASS+"-crs-dialog",CRS_LIST:this.CLASS+"-crs-list",VIEW_TOGGLE:this.CLASS+"-btn-view",CURRENT_CRS_NAME:this.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:this.CLASS+"-cur-crs-code",TREE:this.CLASS+"-tree",DETAILS:"tc-details",GRID:"tc-grid"};constructor(){super(...arguments);const e=this;e.layerInfos={},e.model=new p,e.modelDialog=new p,e._dialogDiv=o.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv)}#bn(e,t){const r=this;var n=!0,o=e.target,a=r.getLayer(h(o,"li").dataset.layerId);if(r.options.dialogMore&&h(o,"."+r.CLASS+"-more-dialog")){const e=r.div.querySelectorAll("input[type=radio]");for(var s=0,l=e.length;s<l;s++){const t=r.getLayer(h(e[s],"li").dataset.layerId);t&&1==(t.id===a.id)&&(a=t)}}if(a!=r.map.getBaseLayer())if(a.mustReproject)if(r.map.on3DView){if(!a.getFallbackLayer())return r.#wn.checked=!0,void e.stopPropagation();if(a.getFallbackLayer()){const e=a.getFallbackLayer();e&&e.getCapabilitiesPromise().then((function(){e.isCompatible(r.map.getCRS())&&r.map.setBaseLayer(a)})),n=!0}}else{r.#wn&&(r.#wn.checked=!0);const e={layer:a},t=a.getFallbackLayer();t?t.getCapabilitiesPromise().then((function(){t.isCompatible(r.map.getCRS())&&(e.fallbackLayer=t),r.showProjectionChangeDialog(e)})):r.showProjectionChangeDialog(e),n=!1}else(a.type===i.A.layerType.WMS||a.type===i.A.layerType.WMTS&&a.getProjection()!==r.map.crs)&&a.setProjection({crs:r.map.crs}),r.map.setBaseLayer(a);this.#wn&&(this.#wn.checked=!0),t&&t(n)}async register(e){const t=this,r=await super.register.call(t,e);return t.options.dialogMore&&e.on(i.A.event.VIEWCHANGE,(function(){t.#Tn()})),t.updateModel(),e.on(i.A.event.BASELAYERCHANGE+" "+i.A.event.PROJECTIONCHANGE+" "+i.A.event.VIEWCHANGE,(function(e){t.update(t.div,e.layer)})),t.div.addEventListener("change",n.A.EventTarget.listenerBySelector("input[type=radio]",(function(e){"moreLayers"===e.target.value?t.showMoreLayersDialog():t.#bn(e),e.stopPropagation()}))),r}async loadTemplates(){const e=this,t=r.e(7).then(r.bind(r,7)),n=r.e(7196).then(r.bind(r,7196)),i=r.e(7304).then(r.bind(r,7304)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-node"]=(await n).default,o[e.CLASS+"-dialog"]=(await i).default,e.template=o}async render(e){const t=this;return t._dialogDiv.innerHTML=await t.getRenderedHtml(t.CLASS+"-dialog",null),await super.render(e,o.A.extend({},t.options,{controlId:t.id})),t.controller=new c.A(t.model,new u.A(t.div)),t.dialogController=new c.A(t.modelDialog,new u.A(t._dialogDiv)),t}addUIEventListeners(){const e=this;if(e.div.querySelector(`.${e.#Cn.VIEW_TOGGLE}`)?.addEventListener("change",(function(t){e.toggleView()}),{passive:!0}),e.options.dialogMore){const t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");t.querySelector(`.${e.#Cn.VIEW_TOGGLE}`)?.addEventListener("change",(function(t){e.toggleMoreLayersDialogView()}),{passive:!0}),t.addEventListener("change",n.A.EventTarget.listenerBySelector("input[type=radio]",(function(t){e.#bn(t,(function(e){e&&o.A.closeModal()})),t.stopPropagation()})))}}async update(e,t){const r=this;e=e||r.div,await(r.#_n||r.#Tn()),Array.from(e.querySelectorAll(`ul.${r.CLASS}-branch li`)).forEach((function(e,n,o){const a=r.getLayer(e.dataset.layerId);if(a){const n=t||r.map.baseLayer,s=e.querySelector("input[type=radio]"),l=a.getFallbackLayer&&a.getFallbackLayer();let c=n&&(n===a||n.id===a.id);if(!c){const t=l&&o.filter((t=>t!==e)).some((e=>e.dataset.layerId===l.id));c=!t&&n&&(n===l||l&&n.id===l.id)}r.map.on3DView&&a.mustReproject&&l?l.getCapabilitiesPromise().then((function(){var t=!a.getFallbackLayer().isCompatible(r.map.getCRS());s.checked=c,t?(s.classList.add(i.A.classes.DISABLED),r.dialogController.setAttribute(r.map.on3DView?"notAvailableTo3D":"reprojectionNeeded","title",e)):(s.classList.remove(i.A.classes.DISABLED),e.removeAttribute("title"))})):(s.checked=c,a.mustReproject?(s.classList.add(i.A.classes.DISABLED),r.dialogController.setAttribute(r.map.on3DView?"notAvailableTo3D":"reprojectionNeeded","title",e)):(s.classList.remove(i.A.classes.DISABLED),e.removeAttribute("title"))),c&&(r.#wn=s)}})),r.updateScale()}updateLayerTree(e){const t=this;if(e.isBase&&(!e.options.stealth||e.firstOption&&!e.firstOption.options.stealth)){super.updateLayerTree.call(t,e);const r=e.firstOption||e;r!==e&&(t.layerTrees[r.id]=r.getTree()),r.getInfo&&(t.layerInfos[r.id]=r.getInfo(r.names[0])),t.getRenderedHtml(t.CLASS+"-node",{layer:t.layerTrees[r.id],info:t.layerInfos[r.id],controlId:t.id}).then((function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;var i=n.dataset.layerUid;const o=t.div.querySelector("."+t.CLASS+"-branch"),a=o.querySelector('li[data-layer-uid="'+i+'"]');if(a)a.innerHTML=n.innerHTML,t.#xn(a),t.controller.add(a);else{n.dataset.layerId=r.id,t.#xn(n);const e=t.map.baseLayers.map((e=>e.firstOption||e)).filter((e=>e&&!e.stealth)).map((e=>e.id)),i=e.indexOf(r.id);let a,s=!1;for(a=i-1;a>=0;a--){const r=o.querySelector(`li[data-layer-id="${e[a]}"]`);if(r){r.insertAdjacentElement("afterend",n),t.controller.add(r),s=!0;break}}if(!s){for(a=i+1;a<e.length;a++){const r=o.querySelector(`li[data-layer-id="${e[a]}"]`);if(r){r.insertAdjacentElement("beforebegin",n),t.controller.add(r),s=!0;break}}if(!s){const e=o.querySelector(`.${t.CLASS}-more-node`);e?e.parentElement.insertAdjacentElement("beforebegin",n):o.appendChild(n),t.controller.add(n)}}t.update()}})).catch((function(e){n.A.error(e)}))}}updateLayerOrder(e,t,r){}removeLayer(e){const t=this;if(e.isBase){const i=t.div.querySelector("."+t.CLASS+"-branch").querySelectorAll("li");for(var r=0,n=i.length;r<n;r++){const t=i[r];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}}}onErrorLayer(e){e.isBase&&!e.options.stealth&&this.map.toast(this.getLocaleString("baseLayerNotAvailable",{mapName:e.title}),{type:i.A.msgType.ERROR})}getFallbackLayer(e){const t=this,r=function(t){return t.fallbackLayer&&t.fallbackLayer.id===e};let n=t.map.baseLayers.filter(r),i=n.length?n[0].fallbackLayer:null;return!i&&t.#Ln&&(n=t.#Ln.filter(r),i=n.length?n[0].fallbackLayer:null),i}loadFallbackProjections(){const e=this;e._dialogDiv.querySelector("."+e.#Cn.CRS_DIALOG).querySelectorAll("ul."+e.#Cn.CRS_LIST+" li").forEach((function(t){t.classList.remove(i.A.classes.HIDDEN),t.querySelector("button."+e.#Cn.LOAD_CRS_BUTTON)&&t.classList.add(i.A.classes.HIDDEN)}))}#Pn(e={}){const t=this,{crs:r,parent:n,layer:a,onclick:s}=e,l=!a.getCompatibleCRS().find((e=>o.A.CRSCodesEqual(e,r))),c=document.createElement("li"),u=document.createElement("button");u.setAttribute("type","button"),u.dataset.crsCode=o.A.getCRSCode(r);const h=document.createElement("span");h.classList.add(t.CLASS+"-crs-code"),h.innerHTML=r;const d=document.createElement("span");d.classList.add(t.CLASS+"-crs-desc",i.A.classes.LOADING),u.appendChild(h),u.appendChild(d),l&&(u.classList.add(i.A.classes.WARNING),c.classList.add(i.A.classes.HIDDEN)),u.addEventListener(i.A.event.CLICK,s,{passive:!0}),c.appendChild(u),n.appendChild(c),t.map.loadProjections({crsList:[r],orderBy:"name",silent:!0}).then((function([e]){const r=e?.name??"";l?(d.innerHTML=r,a.fallbackLayer&&(u.dataset.fallbackLayerId=a.fallbackLayer.id)):d.innerHTML=t.getLocaleString("changeMapToCrs",{crs:r}),d.classList.remove(i.A.classes.LOADING)}))}showProjectionChangeDialog(e={}){const t=this,r=e.layer,n=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog"),a=n.querySelector(".tc-modal-body");a.classList.add(i.A.classes.LOADING);const s=r.getCompatibleCRS();n.classList.remove(i.A.classes.HIDDEN);const l=function(e){o.A.closeModal();const r=e.currentTarget,n="EPSG:"+r.dataset.crsCode,a=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog");a.classList.add(i.A.classes.HIDDEN);const s=t.getLayer(a.dataset.layerId);if(s)if(n)t.map.wait(o.A.getTimedPromise((()=>{t.map.setProjection({crs:n,baseLayer:s})}),20));else{const e=t.getFallbackLayer(r.dataset.fallbackLayerId);e&&t.map.setBaseLayer(e)}};n.dataset.layerId=r.id;const c=n.querySelector("ul."+t.CLASS+"-crs-list");c.innerHTML="";const u=t.map.getCompatibleCRS({layers:t.map.workLayers.concat(r),includeFallbacks:!0}),h=u.some((e=>s.find((t=>o.A.CRSCodesEqual(t,e)))));for(const e of u)t.#Pn({crs:e,parent:c,layer:r,onclick:l});if(e.fallbackLayer){const r=document.createElement("li"),n=document.createElement("button");n.setAttribute("type","button"),n.innerHTML=t.getLocaleString("reprojectOnTheFly"),n.dataset.fallbackLayerId=e.fallbackLayer.id,n.addEventListener(i.A.event.CLICK,l,{passive:!0}),r.appendChild(n),c.appendChild(r)}if(h){const e=document.createElement("li"),r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(t.#Cn.LOAD_CRS_BUTTON),r.innerHTML=t.getLocaleString("showOnTheFlyProjections"),r.addEventListener(i.A.event.CLICK,(function(e){t.loadFallbackProjections()}),{passive:!0}),e.appendChild(r),c.appendChild(e)}a.classList.remove(i.A.classes.LOADING);const d=n.querySelector("."+t.CLASS+"-name");d&&(d.innerHTML=r.title||r.name),o.A.showModal(n)}showMoreLayersDialog(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");t.classList.toggle(i.A.classes.THREED,!!e.map.on3DView);const r=t.querySelector(".tc-modal-body");o.A.showModal(t,{closeCallback:function(){this.update().then((()=>this.#wn.checked=!0))}.bind(e)});const n=e.div.querySelector(`.${e.#Cn.TREE}`).classList.contains(e.#Cn.GRID),a=t.querySelector(`.${e.#Cn.VIEW_TOGGLE}`);if(a.checked=n,a.setAttribute("title",e.getLocaleString(n?"showDetailsView":"showGridView")),r.childElementCount>0){t.classList.remove(i.A.classes.HIDDEN),t.classList.add(i.A.classes.VISIBLE);const o=r.querySelector(`.${e.#Cn.TREE}`);return o.classList.toggle(e.#Cn.DETAILS,!n),void o.classList.toggle(e.#Cn.GRID,n)}r.innerHTML="",r.classList.add(i.A.classes.LOADING),t.classList.remove(i.A.classes.HIDDEN);const s=t=>{if(t){const r=t.getInfo?t.getInfo(t.names[0]):null;return{layer:t,info:r,controlId:e.id}}return{}},l=function(){const n=t.querySelector(`.${e.#Cn.VIEW_TOGGLE}`).checked,o=e.#Ln.slice();for(var a=0,l=o.length;a<l;a++)o[a]||(o[a]=!1);e.getRenderedHtml(e.CLASS,{baseLayers:o.map(s),controlId:e.id},(function(t){r.innerHTML=t;const o=r.querySelector(`.${e.#Cn.TREE}`);o.classList.toggle(e.#Cn.DETAILS,!n),o.classList.toggle(e.#Cn.GRID,n),r.classList.remove(i.A.classes.LOADING),e.update(o),e.dialogController.add(r)}))};e.#Tn((function(t){if(r.classList.contains(i.A.classes.LOADING))l();else{const n=r.querySelector(`li.${e.CLASS}-node:nth-child(${t+1})`),i=e.#Ln[t];i&&e.getRenderedHtml(e.CLASS+"-node",s(i),(function(t){n.insertAdjacentHTML("beforebegin",t),n.remove(),e.update(r)}))}})).then((function(){l(),e.modelDialog.metadata=e.getLocaleString("metadata")}))}#Mn(e){const t=e.querySelector(`.${this.#Cn.TREE}`);if(t){const r=e.querySelector(`.${this.#Cn.VIEW_TOGGLE}`),n=r.checked;r.setAttribute("title",this.getLocaleString(n?"showDetailsView":"showGridView")),t.classList.remove(this.#Cn.DETAILS,this.#Cn.GRID),setTimeout((()=>t.classList.add(n?this.#Cn.GRID:this.#Cn.DETAILS)),20)}}toggleView(){this.#Mn(this.div)}toggleMoreLayersDialogView(){this._dialogDiv&&this.#Mn(this._dialogDiv)}getLayer(e){const t=this;return t.map&&(t.map.getLayer(e)||t.#Ln&&t.#Ln.find((t=>t.id===e)))}#Tn(e){const t=this;if(t.#Ln||t.#_n){if(t.#Ln)return Promise.all(t.#Ln.filter((e=>e.type===i.A.layerType.WMS||e.type===i.A.layerType.WMTS)).map((e=>t.map.on3DView?d(e):e.getCapabilitiesPromise()))).then((function(){return t.#Ln=t.#Ln.map((function(e){if(e.type===i.A.layerType.WMTS){var r=e.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];e.mustReproject=!r}else e.type===i.A.layerType.WMS&&(e.mustReproject=!e.isCompatible(t.map.getCRS()));return t.map.on3DView&&e.mustReproject&&e.getFallbackLayer&&e.getFallbackLayer()?(e.mustReproject=!e.getFallbackLayer().isCompatible(t.map.getCRS()),e):e})),t.#Ln}))}else t.#_n=new Promise((function(r,n){var a=t.map.availableBaseLayers.filter((function(e){return-1===t.map.availableBaseLayers.filter((e=>e.fallbackLayer)).map((e=>e.fallbackLayer)).indexOf(e.id)})).map((function(e){return e.type===i.A.layerType.WMS||e.type===i.A.layerType.WMTS?new s.A(e):e.type===i.A.layerType.VECTOR?new l.A(e):void 0}));t.#Ln=new Array(a.length);const c=async function(r){const n=this;if(n.map=t.map,n.isBase=n.options.isBase=!0,n.type===i.A.layerType.WMTS){await n.getCapabilitiesPromise();var a=n.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];n.mustReproject=!a}else n.type===i.A.layerType.WMS&&(await n.getCapabilitiesPromise(),n.mustReproject=!n.isCompatible(t.map.getCRS()));if(t.map.on3DView&&n.mustReproject&&n.getFallbackLayer){const e=n.getFallbackLayer();e&&(await e.getCapabilitiesPromise(),n.mustReproject=!e.isCompatible(t.map.getCRS()))}t.#Ln.splice(r,1,n),o.A.isFunction(e)&&e(r)};Promise.all(a.map((async function(r,n){if(r.type===i.A.layerType.WMS||r.type===i.A.layerType.WMTS)try{await(t.map.on3DView?d(r):r.getCapabilitiesPromise())}catch(r){return t.#Ln.splice(n,1,null),void(o.A.isFunction(e)&&e(n))}await c.call(r,n)}))).finally((function(){t.#Ln=t.#Ln.filter((function(e){return null!==e})),r(t.#Ln)}))}));return t.#_n}#xn(e){e.querySelectorAll(".tc-ctl-bms-metadata li a").forEach((e=>{const t=e.attributes.type.value;g[t]=g[t]||this.getLocaleString(o.A.getSimpleMimeType(t))||this.getLocaleString("viewMetadata"),this.model[t]=this.modelDialog[t]=g[t]}))}updateModel(){this.modelDialog.showDetailsView=this.model.showDetailsView=this.getLocaleString("showDetailsView"),this.modelDialog.backgroundMaps=this.model.backgroundMaps=this.getLocaleString("backgroundMaps"),this.model.moreBackgroundMaps=this.getLocaleString("moreBackgroundMaps"),this.modelDialog.close=this.getLocaleString("close"),this.modelDialog.cancel=this.getLocaleString("cancel"),this.modelDialog.baseLayerNotCompatible=this.getLocaleString("baseLayerNotCompatible"),this.modelDialog.baseLayerNotCompatible_instructions=this.getLocaleString("baseLayerNotCompatible.instructions"),this.modelDialog.metadata=this.model.metadata=this.getLocaleString("metadata"),this.modelDialog.notAvailableTo3D=this.getLocaleString("notAvailableTo3D"),this.modelDialog.reprojectionNeeded=this.getLocaleString("reprojectionNeeded"),Object.keys(g).forEach((e=>{this.modelDialog[e]=this.model[e]=this.getLocaleString(o.A.getSimpleMimeType(e))||self.getLocaleString("viewMetadata")})),this.model.fileDefault=this.modelDialog.fileDefault=this.getLocaleString("viewMetadata")}async updateLanguage(){this.updateModel()}}f.prototype.CLASS="tc-ctl-bms",n.A.control.BasemapSelector=f;const m=f},4532:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(8038),i=r(797),o=r(3301),a=r(1979),s=(r(3333),r(6052),r(7018)),l=r(1651),c=r(8606),u=r(6257),h=r(6546),d=r(1667),p=r(3521),g=r(3791),f=r(5777);n.A.control=n.A.control||{},i.A.event.RESULTSPANELCLOSE=i.A.event.RESULTSPANELCLOSE||"resultspanelclose.tc",i.A.event.FEATURESSELECT=i.A.event.FEATURESSELECT||"featuresselect.tc";class m{constructor(){this.drawAndMeasure="",this.points="",this.lines="",this.polygons="",this.hideSketch="",this.download="",this.deleteAll=""}}class y extends a.default{#fe={};#In;#Rn;#On;constructor(){super(...arguments);const e=this;e._dialogDiv=o.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.#fe.MODE_RADIO_BUTTON=`input[type=radio][name="${e.id}-mode"]`,e.persistentDrawControls=!0}async register(e){const t=this;await super.register.call(t,e);const r=t.getUID(),n=t.getUID(),a=await Promise.all([t.layerPromise,t.renderPromise(),t.getElevationTool()]),l=a[0];t.elevationProfileActive=!!a[2],l&&(l.title=t.getLocaleString("sketch"),l.getNextFeatureId=function(e={}){return e.prefix=l.title+".",Object.getPrototypeOf(l).getNextFeatureId.call(l,e)});const u=await t.getModifyControl();t.modify=u,u.containerControl=t,u.id=r,u.snapping=t.snapping,u.on(i.A.event.FEATURESSELECT,(function(e){const r=e.features[e.features.length-1];t.displayFeatureMode(r),t.getElevationControl().then((function(t){t.resultsPanel&&!e.features.some((function(e){return t.resultsPanel.currentFeature===e}))&&t.resultsPanel.setCurrentFeature(null)}))})).on(i.A.event.FEATURESUNSELECT,(function(e){t.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()}))})).on(i.A.event.FEATUREMODIFY,(function(e){if(e.layer===t.layer){const r=function(e){const r=t.getFeatureMeasurementData(e);t.displayMeasurements(r),t.setFeatureMeasurementData(e)};r(e.feature),e.feature instanceof s.A&&t.getElevationTool().then((function(n){n&&n.setGeometry({features:[e.feature],crs:t.map.getCRS()}).then((function(e){r(e[0])}),(function(e){console.warn(e.message)}))})),t.map.getControlsByClass(p.default).forEach((function(t){t.currentFeature===e.feature&&t.isVisible()&&t.hide()}))}})),e.on(i.A.event.CONTROLDEACTIVATE,(function(e){const r=e.control;r!==t.modify&&r!==t.lineDrawControl||t.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&(r===t.modify&&e.resultsPanel.setCurrentFeature(null),e.resultsPanel.close())}))})).on(i.A.event.POPUP+" "+i.A.event.DRAWTABLE,(function(e){const r=e.control.currentFeature;r instanceof c.A&&t.layer.features.indexOf(r)>=0&&t.elevationProfileActive&&(e.control.hide(),t.getElevationControl().then((function(e){e.resultsPanel&&(e.resultsPanel.setCurrentFeature(r),e.resultsPanel.isMinimized()&&e.resultsPanel.maximize()),e.displayElevationProfile(r)})))})).on(i.A.event.PROJECTIONCHANGE,(function(e){t.elevationChartData&&(t.elevationChartData.coords=o.A.reproject(t.elevationChartData.coords,e.oldCrs,e.newCrs))})),(await t.getLineDrawControl()).on(i.A.event.DRAWSTART,(function(){t.getElevationControl().then((function(e){e.resultsPanel&&e.resultsPanel.currentFeature&&e.resultsPanel.setCurrentFeature(null),t.resetValues()})),t.getModifyControl().then((e=>{e.setLabelableState(!0),e.displayLabelText()}))})).on(i.A.event.DRAWUNDO+" "+i.A.event.DRAWREDO,(function(){const e=this;t.getElevationControl().then((function(r){t.elevationProfileActive&&(e.historyIndex?r.displayElevationProfile(e.history.slice(0,e.historyIndex)):r.closeElevationProfile())})),t.#Dn()})).on(i.A.event.DRAWEND,(function(e){t.getElevationControl().then((function(t){t.resultsPanel&&(t.resultsPanel.currentFeature=e.feature)})),t.getModifyControl().then((e=>{e.displayLabelText()}))})).on(i.A.event.POINT,(function(e){const r=this.history.slice(0,this.historyIndex),n=r[r.length-1];n[0]===e.point[0]&&n[1]===e.point[1]||r.push(e.point),t.getElevationControl().then((function(e){t.elevationProfileActive&&(navigator.onLine?e.displayElevationProfile(r):e.closeElevationProfile())})),1===e.target.historyIndex&&t.#Nn()})).on(i.A.event.STYLECHANGE,(function(e){t.onStyleChange(e)})).on(i.A.event.DRAWCANCEL,(function(){t.getModifyControl().then((e=>{e.setLabelableState(t.layer.features.length>0),e.displayLabelText()})),t.#Dn()})),(await t.getPolygonDrawControl()).on(i.A.event.DRAWSTART,(function(){t.resetValues(),t.getModifyControl().then((e=>{e.setLabelableState(!0),e.displayLabelText()}))})).on(i.A.event.POINT,(function(e){1===e.target.historyIndex&&t.#Nn()})).on(i.A.event.DRAWEND,(function(e){t.getModifyControl().then((e=>{e.displayLabelText()}))})).on(i.A.event.STYLECHANGE,(function(e){t.onStyleChange(e)})).on(i.A.event.DRAWCANCEL+" "+i.A.event.DRAWUNDO,(function(){t.getModifyControl().then((e=>{e.setLabelableState(t.layer.features.length>0),e.displayLabelText()})),t.#Dn()}));const h=await t.getPointDrawControl();return h.containerControl=t,h.id=n,h.snapping=t.snapping,t.drawControls.push(h),t.pointDrawControl=h,t.resetValues(),h.on(i.A.event.DRAWEND,(function(r){const n=function(r){t.displayMeasurements({coordinates:r.geometry,units:e.wrap.isGeo()||e.on3DView?"degrees":"m"}),t.setFeatureMeasurementData(r)};n(r.feature),t.getElevationTool().then((function(e){e&&e.setGeometry({features:[r.feature],crs:t.map.getCRS()}).then((function(e){n(e[0])}),(function(e){console.log(e.message)}))})),t.#Nn()})).on(i.A.event.DRAWCANCEL,(function(e){setTimeout((function(){t.cancel()}),100),t.#Dn()})).on(i.A.event.STYLECHANGE,(function(e){t.onStyleChange(e)})),h.exportsState=!1,t.#On=e.addControl("elevation",t.options.displayElevation),await t.setLayer(t.layer),t.setMode(t.options.mode),e.on(i.A.event.FEATUREADD,(function(e){const r=e.layer,n=e.feature;r===t.layer&&(t.setFeatureMeasurementData(n),t.getModifyControl().then((function(e){e.displayLabelText(n.getStyle().label)})),t.#In.disabled=!1,t.#Rn.disabled=!1)})).on(i.A.event.FEATUREREMOVE+" "+i.A.event.FEATURESCLEAR,(function(e){e.layer===t.layer&&0===t.layer.features.length&&(t.#In.disabled=!0,t.#Rn.disabled=!0,t.resetValues(),t.#Dn())})).on(i.A.event.RESULTSPANELCLOSE,(function(e){t.getElevationControl().then((function(t){t===e.control&&t.setCurrentFeature(null)}))})),t}async loadTemplates(){const e=await r.e(8851).then(r.bind(r,8851));this.template=e.default}async render(e){const t=this;await super.render.call(t),t.pointMeasurementControl=t.div.querySelector('sitna-measurement[mode="point"]'),t.pointMeasurementControl.containerControl=t,t.#In=t.div.querySelector(".tc-ctl-dmm-cmd sitna-button.tc-ctl-dmm-btn-clr"),t.#In.addEventListener(i.A.event.CLICK,(function(e){n.A.confirm(t.getLocaleString("deleteAll.confirm"),(function(){t.clear(),t.#Dn()}))}),{passive:!0}),t.#Rn=t.div.querySelector(".tc-ctl-dmm-cmd sitna-button.tc-ctl-dmm-btn-dl"),t.#Rn.addEventListener(i.A.event.CLICK,(function(e){t.showSketchDownloadDialog()}),{passive:!0}),t.div.querySelector(".tc-ctl-dmm-cmd sitna-button.tc-ctl-dmm-btn-hide").addEventListener(i.A.event.CLICK,(function(e){const r=e.target.active;t.drawControls.forEach((function(e){e.layer.setVisibility(r),e.isActive&&e.wrap.setVisibility(r)})),e.target.title=t.getLocaleString(r?"hideSketch":"showSketch"),e.target.active=!e.target.active}),{passive:!0}),o.A.isFunction(e)&&e(),t.model=new m,t.controller=new f.A(t.model,new g.A(t.div)),t.updateModel()}displayMode(e){const t=this;return e===i.A.geom.POINT&&(t._activeMode=t.div.querySelector(".tc-ctl-meas-pt")),t.modify&&t.modify.div.classList.remove(i.A.classes.COLLAPSED),super.displayMode.call(t,e)}displayFeatureMode(e){const t=this;if(e)switch(t.displayMeasurements(t.getFeatureMeasurementData(e)),!0){case e instanceof h.A:case e instanceof d.A:t.displayMode(i.A.geom.POLYGON),t.polygonDrawControl.setFeature(e);break;case e instanceof c.A:case e instanceof u.A:t.displayMode(i.A.geom.POLYLINE),t.lineDrawControl.setFeature(e),t.elevationProfileActive&&t.getElevationControl().then((t=>t.displayElevationProfile(e)));break;case e instanceof s.A:case e instanceof l.A:t.displayMode(i.A.geom.POINT),t.pointDrawControl.setFeature(e)}}async setMode(e){const t=this;e===i.A.geom.POINT?((await t.getPointDrawControl()).activate(),super.setMode.call(t,e),t.#Dn()):(super.setMode.call(t,e),t.#Dn())}setModes(e){const t=this;Array.isArray(e)||(e=[]),e.indexOf(t.mode)<0&&t.setMode(null);const r=e.map((e=>`[value=${e}]`)).join()||"[value]";t.div.querySelectorAll(t.#fe.MODE_RADIO_BUTTON).forEach((function(e){e.disabled=!e.matches(r)}))}async setLayer(e){const t=this;await super.setLayer.call(t,e);for await(const e of[t.getPointDrawControl(),t.getModifyControl()])e.setLayer(t.layer);if(!await e.getFeatureTypeMetadata()){const r=await t.getLineMeasurementControl();e.setFeatureTypeMetadata(r.getFeatureMeasurementMetadata())}t.layer?.features.length&&t.displayFeatureMode(t.layer.features[0])}setFeatureMeasurementData(e){const t=this;switch(t.mode){case i.A.geom.POINT:t.pointMeasurementControl.setFeatureMeasurementData(e);break;case i.A.geom.POLYLINE:t.lineMeasurementControl.setFeatureMeasurementData(e);break;case i.A.geom.POLYGON:t.polygonMeasurementControl.setFeatureMeasurementData(e)}return t}getFeatureMeasurementData(e){const t=this,r={units:t.map.wrap.isGeo()||t.map.on3DView&&e instanceof s.A?"degree":"m"},n={crs:t.map.getCRS()};switch(!0){case e instanceof h.A:case e instanceof d.A:r.area=e.getArea(n),r.perimeter=e.getLength(n);break;case e instanceof c.A:case e instanceof u.A:r.length=e.getLength(n),t.getElevationControl().then((r=>{t.elevationProfileActive&&r.displayElevationProfile(e)}));break;case e instanceof s.A:r.coordinates=e.geometry}return r}async getPointMeasurementControl(){return await this.renderPromise(),this.div.querySelector('sitna-measurement[mode="point"]')}displayMeasurements(e={}){const t=this;return super.displayMeasurements.call(t,e),e.coordinates&&t.pointMeasurementControl.displayMeasurement(e),t}resetValues(){const e=this;return super.resetValues.call(e),e.getPointMeasurementControl().then((e=>e.clearMeasurement())),e}clear(){const e=this;return e.resetValues(),e.layer.clearFeatures(),e.modify.isActive&&e.modify.deactivate(),e.options.displayElevation&&e.getElevationControl().then((function(e){e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()})),e.#In.disabled=!0,e.#Rn.disabled=!0,e}showSketchDownloadDialog(e){const t=this;return t.getDownloadDialog().then((function(e){var r={title:t.getLocaleString("downloadSketch"),fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+o.A.getFormattedDate((new Date).toString(),!0),hiddenElevationSourceSelection:!0};(t.map.elevation||t.options.displayElevation)&&(r=Object.assign({},r,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),e.open(t.layer.features,r)})),t}onStyleChange(e){var t;switch(e.target.mode){case i.A.geom.POLYGON:t=h.A;break;case i.A.geom.POLYLINE:t=c.A;break;case i.A.geom.POINT:t=s.A}t&&this.modify.getSelectedFeatures().forEach((function(r){if(r instanceof t){const t={};e.strokeWidth&&(t.strokeWidth=e.strokeWidth),e.strokeColor&&(t.strokeColor=e.strokeColor),e.fillColor&&(t.fillColor=e.fillColor),e.fillOpacity&&(t.fillOpacity=e.fillOpacity),e.fontColor&&(t.fontColor=e.fontColor),e.fontSize&&(t.fontSize=e.fontSize),e.labelOutlineColor&&(t.labelOutlineColor=e.labelOutlineColor),e.labelOutlineWidth&&(t.labelOutlineWidth=e.labelOutlineWidth),e.radius&&(t.radius=e.radius),r.setStyle(t)}}))}async activateElevationProfile(){const e=this;e.elevationProfileActive=!0;var t=!1;const r=await e.getElevationControl();if(e.lineDrawControl.historyIndex>1)r.displayElevationProfile(e.lineDrawControl.history.slice(0,e.lineDrawControl.historyIndex)),t=!0;else{const n=e.modify.getActiveFeatures().filter((function(e){return e instanceof c.A}));if(n.length){const e=n[n.length-1];r.displayElevationProfile(e.geometry),t=!0}}t||r.resetElevationProfile(),r.resultsPanel&&r.resultsPanel.show()}async deactivateElevationProfile(){this.elevationProfileActive=!1;const e=await this.getElevationControl();e.resetElevationProfile(),e.resultsPanel&&e.resultsPanel.close()}resetElevationProfile(){const e=this;e.options.displayElevation&&e.resultsPanelChart&&(e.elevationChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},e.resultsPanelChart.openChart(e.elevationChartData))}getElevationControl(){return this.#On}async getPointDrawControl(){return await this.renderPromise(),this.div.querySelector("."+super.CLASS+"-pt sitna-draw")}async getModifyControl(){const e=this;return await e.renderPromise(),e.div.querySelector("."+e.CLASS+"-mod sitna-modify")}#Nn(){const e=this.div.querySelector(".tc-ctl-dmm-cmd sitna-button.tc-ctl-dmm-btn-hide");e&&(e.disabled=!1)}#Dn(){const e=this,t=e.div.querySelector(".tc-ctl-dmm-cmd sitna-button.tc-ctl-dmm-btn-hide");if(t){const r=this.drawControls.reduce((function(e,t){return e.concat([t.getLayer()])}),[]);Promise.all(r).then((function(){t.disabled=!e.drawControls.some((e=>e.layer.features.length||e.isActive&&e.historyIndex>0)),t.active=!1,t.title=e.getLocaleString("hideSketch")}))}}updateModel(){const e=this;e.model.drawAndMeasure=e.getLocaleString("drawAndMeasure"),e.model.points=e.getLocaleString("points"),e.model.lines=e.getLocaleString("lines"),e.model.polygons=e.getLocaleString("polygons"),e.model.hideSketch=e.getLocaleString("hideSketch"),e.model.download=e.getLocaleString("download"),e.model.deleteAll=e.getLocaleString("deleteAll")}async updateLanguage(){this.updateModel()}}y.prototype.CLASS="tc-ctl-dmm",n.A.control.DrawMeasureModify=y;const v=y},4583:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>l,Tp:()=>s,et:()=>a});var n=r(8217),i=r(6128);class o extends n.Ay{#kn;constructor(e){super(e),this.#kn=new i.A(e)}getType(){return"arraybuffer"}readGeoJsonFeatures(e,t){return this.#kn.readFeatures(e,t)}}class a extends TypeError{}class s extends TypeError{constructor(){super(...arguments),this.message="Time not supported in this format"}}const l=o},4641:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(3791),c=r(5777);n.A.control=n.A.control||{},i.A.SCREEN_SIZE_KEY="TC.Map.screenSize";class u{constructor(){this.estimatedMapSize=""}}class h extends s.A{async loadTemplates(){const e=await r.e(67).then(r.bind(r,67));this.template=e.default}render(e){const t=this;return t.model=new u,t.renderData({scale:t.getScale(),screenSize:o.A.screenSize},(function(){const r=t.div.querySelector("span");r.textContent="1:"+t.format(r.textContent.substr(2)),t.addUIEventListeners(),a.A.isFunction(e)&&e(),t.controller=new c.A(t.model,new l.A(t.div)),t.updateModel()}))}addUIEventListeners(){const e=this;e.div.querySelector('input[type="button"]').addEventListener(i.A.event.CLICK,(function(){e.setScreenSize()}),{passive:!0})}register(e){const t=this,r=super.register.call(t,e);let n=a.A.storage.getLocalValue(i.A.SCREEN_SIZE_KEY);return n&&(o.A.screenSize=n),t.render((function(){e.on(i.A.event.ZOOM,(function(){delete t.metersPerDegree,t.update()}))})),r}update(){this.render()}setScreenSize(){const e=this;n.A.prompt(e.getLocaleString("selectScreenSize"),o.A.screenSize,(function(t){t&&(o.A.screenSize=parseFloat(t),a.A.storage.setLocalValue(i.A.SCREEN_SIZE_KEY,o.A.screenSize),e.update())}))}getScale(e){const t=this;var r=0,n=!e&&t.map?t.map.wrap.getResolution():e;if(n&&(r=n*t.getDpi(o.A.screenSize)/.0254,window.devicePixelRatio&&(r*=window.devicePixelRatio)),t.map&&t.map.wrap.isGeo()){if(!t.metersPerDegree){var i=t.map.getExtent();i&&(t.metersPerDegree=a.A.getMetersPerDegree(i))}t.metersPerDegree&&(r*=t.metersPerDegree)}return r}getDpi(e){return this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e,this.dpi}format(e){for(var t=new Number(e).toFixed(0),r=[];t.length>3;){var n=t.length-3;r.unshift(t.substr(n)),t=t.substr(0,n)}return t&&r.unshift(t),r.join(".")}updateModel(){this.model.estimatedMapSize=this.getLocaleString("estimatedMapSize")}updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-scl",n.A.control.Scale=h;const d=h},4778:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>m});var n=r(6514),i=r(915),o=r(4238),a=r(4049),s=r(2616),l=r(9969),c=r(3402),u=r(3671),h=r(7622),d=r(7947),p=r(9703);const g=(0,p.vt)();class f{constructor(e,t,r,n,i,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=r||null,this.properties_=i,this.squaredTolerance_,this.stride_=n,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_="Point"===this.type_?(0,i.dP)(this.flatCoordinates_):(0,i.Vy)(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=(0,i.q1)(this.getExtent());this.flatInteriorPoints_=(0,s.J)(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=(0,c.yJ)(this.flatCoordinates_,this.ends_),t=(0,a.C)(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=(0,s.p)(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=(0,l.SH)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const r=this.ends_;for(let i=0,o=r.length;i<o;++i){const o=r[i],a=(0,l.SH)(e,t,o,2,.5);(0,n.X$)(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){const t=(e=(0,d.Jt)(e)).getExtent(),r=e.getWorldExtent();if(t&&r){const e=(0,i.Oq)(r)/(0,i.Oq)(t);(0,p.Zz)(g,r[0],r[3],e,-e,0,0,0),(0,h.Rc)(this.flatCoordinates_,0,this.flatCoordinates_.length,2,g,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new f(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=(0,o.B4)(((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const r=this.simplifiedGeometry_.getFlatCoordinates();let n;switch(this.type_){case"LineString":r.length=(0,u.P4)(r,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,r,0),n=[r.length];break;case"MultiLineString":n=[],r.length=(0,u.AL)(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,r,0,n);break;case"Polygon":n=[],r.length=(0,u.Hg)(r,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),r,0,n)}return n&&(this.simplifiedGeometry_=new f(this.type_,r,n,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_})),this}}f.prototype.getFlatCoordinates=f.prototype.getOrientedFlatCoordinates;const m=f},4921:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(3301);n.A.tool=n.A.tool||{},n.A.tool.ExcelExport=function(){this.stringifyField=function(e,t,r){return"string"==typeof e?(e=e.replace(/"/g,'""'),(r||e.indexOf(",")>-1||e.indexOf("\n")>-1||e.indexOf("\r")>-1)&&(e=t+e+t),e):"boolean"==typeof e?e?"TRUE":"FALSE":e},this.stringify=function(e,t){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=String.fromCharCode,o=function(){try{document.createElement("$")}catch(e){return e}}();window.btoa||(window.btoa=function(e){for(var t,n,i,a,s,l,c=0,u=e.length,h=Math.max,d="";c<u;){if(h(t=e.charCodeAt(c++)||0,n=e.charCodeAt(c++)||0,l=e.charCodeAt(c++)||0)>255)throw o;i=(3&t)<<4|n>>4&15,a=(15&n)<<2|l>>6&3,s=63&l,n?l||(s=64):a=s=64,d+=r.charAt(t>>2&63)+r.charAt(i)+r.charAt(a)+r.charAt(s)}return d}),window.atob||(window.atob=function(e){var t,i,a,s,l,c=0,u=(e=e.replace(/=+$/,"")).length,h=[];if(u%4==1)throw o;for(;c<u;)t=(63&r.indexOf(e.charAt(c++)))<<2|(a=r.indexOf(e.charAt(c++)))>>4&3,i=(15&a)<<4|(s=r.indexOf(e.charAt(c++)))>>2&15,l=(3&s)<<6|63&r.indexOf(e.charAt(c++)),h.push(n(t)),i&&h.push(n(i)),l&&h.push(n(l));return h.join("")});var a=[];Array.isArray(e)?a=e:i.A.isFunction(e)&&(a=e());const s=function(e,t){var r=t||"";if(e instanceof Array){r+="<table><tbody>";for(var n=0;n<e.length;n++)r+="<tr><td>"+s(e[n],t)+"</td></tr>";r+="</tbody></table>"}else if(e instanceof Object){for(var i in r+="<table><tbody>",e){const n=e[i];if(r+="<tr><th>"+i+"</th>",n instanceof Object)r+="<td>"+s(n,t)+"</td></tr>";else{var o=l(n);e[i]=o.value,r+='<td class="'+o.class+'">',!0===("string"==typeof n&&n.startsWith("http"))?r+='<a href="'+unescape(encodeURIComponent(n))+'">Abrir</a>':r+=n,r+="</td></tr>"}}r+="</tbody></table>"}else r+=e;return r},l=function(e){var t;if(null===e||"string"!=typeof e&&"number"!=typeof e)t=t instanceof Object?"":"string";else if(e.value&&(e=e.value),-1!==(""+e).indexOf("%"))e=e.replace(" %","%").replace(/\.|,/g,p),t="percent";else{var r=0;e&&(r="number"==typeof e?e:new Number(e.replace?e.replace(/\,/g,"").replace(/./g,".").trim():e.trim())),isNaN(r)?t=/^\d{1,2}([.\/-])\d{1,2}\1(\d{4}|\d{2})$/.test(e)||/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])[ ,T]{1}(2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9][Z]{0,1}$/.test(e)?"date":"string":(e=r.toString().replace(".",p),t=r%1>0?"number2d":"number")}return{class:t,value:e}};for(var c='<thead valign="top">',u=0;u<1;u++){for(var h in c+="<tr>",a[u])Object.prototype.hasOwnProperty.call(a[u],h)&&(c+="<th>"+a[u][h]+"</th>");c+="</tr>"}c+="</thead>",c+="<tbody>";let d=navigator.language.substring(0,5);var p;try{p=1.1.toLocaleString(d).substring(1,2)}catch(e){p=1.1.toLocaleString("es-ES").substring(1,2)}for(u=1;u<a.length;u++){for(c+="<tr>",h=0;h<a[u].length;h++)if(Object.prototype.hasOwnProperty.call(a[u],h)){var g=a[u][h];const e=l(g);(g=e.value)instanceof Object?c+="<td>"+s(g)+"</td>":(c+='<td class="'+e.class+'"',g&&(Object.prototype.hasOwnProperty.call(g,"rowspan")||Object.prototype.hasOwnProperty.call(g,"colspan"))?(Object.prototype.hasOwnProperty.call(g,"rowspan")&&(c+=' valign="top" rowspan="'+g.rowspan+'">'+g.value+"</td>"),Object.prototype.hasOwnProperty.call(g,"colspan")&&(c+=' colspan="'+g.colspan+'">'+g.value+"</td>"),h++):c+=">"+(null==g?"":g)+"</td>")}c+="</tr>"}c+="</tbody>";var f='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name=ProgId content=Excel.Sheet><meta name=Generator content="Microsoft Excel 9">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>';f+=","===p?'\x3c!--table{mso-displayed-decimal-separator:","; mso-displayed-thousand-separator:".";}':'\x3c!--table{mso-displayed-decimal-separator:"."; mso-displayed-thousand-separator:",";}',f+="body {visibility:hidden;}",f+='.number{mso-number-format:"#,##0";} .number2d{mso-number-format:"#,##0.00";} .percent{mso-number-format:0.00%;} ',f+='.date{mso-number-format:"dd/mm/yyyy";} .string{mso-number-format:"@";} caption{text-align:left;}--\x3e</style></head><body><table><caption>{caption}</caption>{table}</table></body></html>';var m,y={worksheet:t.workSheet||"Hoja1",table:c,caption:t.title||""};return m=y,f.replace(/{(\w+)}/g,(function(e,t){return m[t]}))}},n.A.tool.ExcelExport.prototype.Save=function(e,t,r){const n=this.stringify(t,{txtDelim:'"',fieldSep:";",title:r||""});var i=new Blob([n],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(i,e);else{var o=document.createElement("a");if(void 0!==o.download){var a=URL.createObjectURL(i);o.setAttribute("href",a),o.setAttribute("download",e),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}};const o=n.A.tool.ExcelExport},5056:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(3791),c=r(5777);n.A.control=n.A.control||{},i.A.classes.PRINTABLE="tc-printable";class u{constructor(){this.printThisContent="",this.print=""}}class h extends s.A{#Fn;constructor(){super(...arguments);const e=this;delete e.div,e.ready=!1,e.title=e.options.title||a.A.getLocaleString(o.A.locale,"printPage"),e.cssUrl=e.options.cssUrl||n.A.apiLocation+"css/print.css",e.options.target&&((e.options.printableElement||e.options.target).classList.add(i.A.classes.PRINTABLE),e.render()),e.model=new u}async loadTemplates(){const e=this,t=r.e(4680).then(r.bind(r,4680)),n=r.e(860).then(r.bind(r,860)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-page"]=(await n).default,e.template=i}renderData(e,t){const r=this;if(r.div)return super.renderData.call(r,e,t);const n=new Promise((function(e,n){const i=r.getRenderTarget();i?r.getRenderedHtml(r.CLASS,null).then((function(n){i.querySelector("."+r.CLASS+"-btn")||(r.#Fn=!0,i.insertAdjacentHTML("beforeend",n)),a.A.isFunction(t)&&t(),e(),r.controller=new c.A(r.model,new l.A(i)),r.model.print=r.getLocaleString("print"),r.model.printThisContent=r.getLocaleString("printThisContent")})):(a.A.isFunction(t)&&t(),e())}));return r._firstRender??=n,n}renderPrintPage(){const e=this,t=open(null,e.CLASS),r=(e.options.printableElement||e.options.target).innerHTML;e.getRenderedHtml(e.CLASS+"-page",{title:e.title,content:r,cssUrl:e.cssUrl}).then((function(e){t.document.write(e),t.document.close(),t.focus()})).catch((function(e){n.A.error(e)}))}getRenderTarget(){return this.options.target||this.div}addUIEventListeners(){const e=this;if(e.#Fn){const t=e.getRenderTarget();if(t){const r=t.querySelector("."+e.CLASS+"-btn");r&&(r.addEventListener("click",(function(t){e.renderPrintPage()})),e.#Fn=!1)}}return e}updateModel(){const e=this;e.model.printThisContent=e.getLocaleString("printThisContent"),e.model.print=e.getLocaleString("print")}async updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-print",n.A.control.Print=h;const d=h},5101:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(8038),i=r(3301),o=r(8991);const a=new Blob([String.raw`
/**
 * @author: Tobias Nickel
 * @created: 06.04.2015
 * I needed a small xmlparser chat can be used in a worker.
 */

/**
 * parseXML / html into a DOM Object. with no validation and some failur tolerance
 * @params S {string} your XML to parse
 * @param options {object} all other options:
 * searchId {string} the id of a single element, that should be returned. using this will increase the speed rapidly
 * filter {function} filter method, as you know it from Array.filter. but is goes throw the DOM.
 * simplify {bool} to use tXml.simplify.
 */

//importScripts('./loquesea.js');

function tXml(S, options) {
    "use strict";
    options = options || {};

    var pos = 0;

    var openBracket = "<";
    var openBracketCC = "<".charCodeAt(0);
    var closeBracket = ">";
    var closeBracketCC = ">".charCodeAt(0);
    //var minus = "-";
    var minusCC = "-".charCodeAt(0);
    //var slash = "/";
    var slashCC = "/".charCodeAt(0);
    //var exclamation = '!';
    var exclamationCC = '!'.charCodeAt(0);
    //var singleQuote = "'";
    var singleQuoteCC = "'".charCodeAt(0);
    //var doubleQuote = '"';
    var doubleQuoteCC = '"'.charCodeAt(0);
    //var openSquareBracket = "[";
    var openSquareBracketCC = "[".charCodeAt(0);
    //var closeSquareBracket = "]";
    var closeSquareBracketCC = "]".charCodeAt(0);

    /**
     * parsing a list of entries
     */

    function parseChildren() {
        var children = [];
        while (S[pos]) {
            if (S.charCodeAt(pos) == openBracketCC) {
                if (S.charCodeAt(pos + 1) === slashCC) {
                    pos = S.indexOf(closeBracket, pos);
                    return children;
                } else if (S.charCodeAt(pos + 1) === exclamationCC) {
                    var char2 = S.charCodeAt(pos + 2);
                    if (char2 == openSquareBracketCC) {
                        // cdata support
                    }
                    else {
                        if (char2 == minusCC) {
                            //comment support
                            while (pos !== -1 && !(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) == minusCC && S.charCodeAt(pos - 2) == minusCC && pos != -1)) {
                                pos = S.indexOf(closeBracket, pos + 1);
                            }
                            if (pos === -1)
                                pos = S.length
                        } else {
                            // doctypesupport
                            pos += 2;
                            while (S.charCodeAt(pos) !== closeBracketCC) {
                                pos++;
                            }
                        }
                        pos++;
                        continue;
                    }
                }
                var node = parseNode();
                children.push(node);
            } else {
                var text = parseText()
                if (text.trim().length > 0)
                    children.push(text);
            }
            pos++;
        }
        return children;
    }

    /**
     *    returns the text outside of texts until the first '<'
     */

    function parseText() {
        var start = pos;
        pos = S.indexOf(openBracket, pos) - 1;
        if (pos === -2)
            pos = S.length;
        return S.slice(start, pos + 1);
    }
    /**
     *    returns text until the first nonAlphebetic letter
     */
    var nameSpacer = '\n\t>/= ';

    function parseName() {
        var start = pos;
        var c = S[pos];
        while (nameSpacer.indexOf(c) === -1) {
            c = S[++pos];
        }
        return S.slice(start, pos);
    }
    /**
     *    is parsing a node, including tagName, Attributes and its children,
     * to parse children it uses the parseChildren again, that makes the parsing recursive
     */
    var NoChildNodes = ['img', 'br', 'input', 'meta', 'link'];

    function parseNode() {
        var node = {};
        pos++;
        if (S.charCodeAt(pos) === exclamationCC && S.charCodeAt(pos + 1) === openSquareBracketCC) {
            // parse cdata
            var start = pos + 8;
            while (!(S.charCodeAt(pos) === closeBracketCC && S.charCodeAt(pos - 1) === closeSquareBracketCC && S.charCodeAt(pos - 2) === closeSquareBracketCC)) {
                pos++;
            }
            return S.slice(start, pos - 2);
        }

        node.tagName = parseName();

        // parsing attributes
        var attrFound = false;
        let name;
        while (S.charCodeAt(pos) !== closeBracketCC) {
            var c = S.charCodeAt(pos);
            if ((c > 64 && c < 91) || (c > 96 && c < 123)) {
                //if('abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'.indexOf(S[pos])!==-1 ){
                name = parseName();
                // search beginning of the string
                var code = S.charCodeAt(pos);
                while (code !== singleQuoteCC && code !== doubleQuoteCC && !((code > 64 && code < 91) || (code > 96 && code < 123)) && code !== closeBracketCC) {
                    pos++;
                    code = S.charCodeAt(pos);
                }
                if (!attrFound) {
                    node.attributes = {};
                    attrFound = true;
                }
                let value;
                if (code === singleQuoteCC || code === doubleQuoteCC) {
                    value = parseString();
                } else {
                    value = null;
                    pos--;
                }
                node.attributes[name] = value;
            }
            pos++;

        }
        // optional parsing of children
        if (S.charCodeAt(pos - 1) !== slashCC) {
            if (node.tagName == "script") {
                const start = pos + 1;
                pos = S.indexOf('</script>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 8;
            } else if (node.tagName == "style") {
                const start = pos + 1;
                pos = S.indexOf('</style>', pos);
                node.children = [S.slice(start, pos - 1)];
                pos += 7;
            } else if (NoChildNodes.indexOf(node.tagName) == -1) {
                pos++;
                node.children = parseChildren(name);
            }
        }
        return node;
    }

    /**
     *    is parsing a string, that starts with a char and with the same usually  ' or "
     */

    function parseString() {
        var startChar = S[pos];
        var startpos = ++pos;
        pos = S.indexOf(startChar, startpos)
        return S.slice(startpos, pos);
    }

    /**
     *
     */

    function findElements() {
        var r = new RegExp('\\s' + options.attrName + '\\s*=[\'"]' + options.attrValue + '[\'"]').exec(S)
        if (r) {
            return r.index;
        } else {
            return -1;
        }
    }

    let out = null;
    if (options.attrValue !== undefined) {
        options.attrName = options.attrName || 'id';
        out = [];

        while ((pos = findElements()) !== -1) {
            pos = S.lastIndexOf('<', pos);
            if (pos !== -1) {
                out.push(parseNode());
            }
            S = S.substr(pos);
            pos = 0;
        }
    } else {
        out = parseChildren();
    }

    if (options.filter) {
        out = tXml.filter(out, options.filter);
    }

    if (options.simplify) {
        out = tXml.simplify(out);
    }
    return out;
}
/**
 * transform the DomObject to an object that is like the object of PHPs simplexmp_load_*() methods.
 * this format helps you to write that is more likely to keep your programm working, even if there a small changes in the XML schema.
 * be aware, that it is not possible to reproduce the original xml from a simplified version, because the order of elements is not saved.
 * therefore your programm will be more flexible and easyer to read.
 *
 * @param {array} the childrenList
 */
tXml.simplify = function simplify(children) {
    var out = {};
    if (!children || !children.length) {
        return '';
    }

    if (children.length === 1 && typeof children[0] == 'string') {
        return children[0];
    }
    // map each object
    children.forEach(function (child) {
        if (typeof child !== 'object') {
            return;
        }
        if (!out[child.tagName])
            out[child.tagName] = [];
        var kids = tXml.simplify(child.children);
        out[child.tagName].push(kids);
        if (child.attributes) {
            kids._attributes = child.attributes;
        }
    });

    for (var i in out) {
        if (out[i].length == 1) {
            out[i] = out[i][0];
        }
    }

    return out;
};

/**
 * behaves the same way as Array.filter, if the filter method return true, the element is in the resultList
 * @params children{Array} the children of a node
 * @param f{function} the filter method
 */
tXml.filter = function (children, f) {
    var out = [];
    children.forEach(function (child) {
        if (typeof (child) === 'object' && f(child)) out.push(child);
        if (child.children) {
            var kids = tXml.filter(child.children, f);
            out = out.concat(kids);
        }
    });
    return out;
};

/**
 * stringify a previously parsed string object.
 * this is useful,
 *  1. to remove whitespaces
 * 2. to recreate xml data, with some changed data.
 * @param O{tXMLDomObject} the object to Stringify
 */
tXml.stringify = function TOMObjToXML(O) {
    var out = '';

    function writeChildren(O) {
        if (O)
            for (var i = 0; i < O.length; i++) {
                if (typeof O[i] == 'string') {
                    out += O[i].trim();
                } else {
                    writeNode(O[i]);
                }
            }
    }

    function writeNode(N) {
        out += "<" + N.tagName;
        for (var i in N.attributes) {
            if (N.attributes[i] === null) {
                out += ' ' + i;
            } else if (N.attributes[i].indexOf('"') === -1) {
                out += ' ' + i + '="' + N.attributes[i].trim() + '"';
            } else {
                out += ' ' + i + "='" + N.attributes[i].trim() + "'";
            }
        }
        out += '>';
        writeChildren(N.children);
        out += '</' + N.tagName + '>';
    }
    writeChildren(O);

    return out;
};


/**
 * use this method to read the textcontent, of some node.
 * It is great if you have mixed content like:
 * this text has some <b>big</b> text and a <a href=''>link</a>
 */
tXml.toContentString = function (tDom) {
    if (Array.isArray(tDom)) {
        var out = '';
        tDom.forEach(function (e) {
            out += ' ' + tXml.toContentString(e);
            out = out.trim();
        });
        return out;
    } else if (typeof tDom === 'object') {
        return tXml.toContentString(tDom.children)
    } else {
        return ' ' + tDom;
    }
};

tXml.getElementById = function (S, id, simplified) {
    var out = tXml(S, {
        attrValue: id,
        simplify: simplified
    });
    return simplified ? out : out[0];
};
/**
 * A fast parsing method, that not realy finds by classname,
 * more: the class attribute contains XXX
 * @param
 */
tXml.getElementsByClassName = function (S, classname, simplified) {
    return tXml(S, {
        attrName: 'class',
        attrValue: '[a-zA-Z0-9\-\s ]*' + classname + '[a-zA-Z0-9\-\s ]*',
        simplify: simplified
    });
};


//console.clear();
//console.log('here:',tXml.getElementById('<some><xml id="test">dada</xml><that id="test">value</that></some>','test'));
//console.log('here:',tXml.getElementsByClassName('<some><xml id="test" class="sdf test jsalf">dada</xml><that id="test">value</that></some>','test'));

/*
console.clear();
tXml(d,'content');
 //some testCode
var s = document.body.innerHTML.toLowerCase();
var start = new Date().getTime();
var o = tXml(s,'content');
var end = new Date().getTime();
//console.log(JSON.stringify(o,undefined,'\t'));
console.log("MILLISECONDS",end-start);
var nodeCount=document.querySelectorAll('*').length;
console.log('node count',nodeCount);
console.log("speed:",(1000/(end-start))*nodeCount,'Nodes / second')
//console.log(JSON.stringify(tXml('<html><head><title>testPage</title></head><body><h1>TestPage</h1><p>this is a <b>test</b>page</p></body></html>'),undefined,'\t'));
var p = new DOMParser();
var s2='<body>'+s+'</body>'
var start2= new Date().getTime();
var o2 = p.parseFromString(s2,'text/html').querySelector('#content')
var end2=new Date().getTime();
console.log("MILLISECONDS",end2-start2);
// */


(function () {

    const XSD_PREFIXES = ['xsd', 'xs'];
    const TEXT_NODE = '#text';
    const ATTRIBUTE_NAME_PREFIX = '@';
    const removePrefix = (str, prefix) => prefix ? str.substring(prefix.length) : str.substring(str.indexOf(":") + 1);
    const addPrefix = (str, prefix) => str.indexOf(':') > 0 ? str : prefix + str;

    const getPrefixForNamespace = function (schema, namespace) {
        for (const [attrName, value] of Object.entries(schema.attributes)) {
            if (attrName.startsWith('xmlns:') && value === namespace) {
                return attrName.substring(attrName.indexOf(':') + 1) + ':';
            }
        }
        return '';
    };

    const getTargetNamespacePrefix = function (schema) {
        const targetNamespace = schema.attributes?.targetNamespace;
        if (targetNamespace) {
            return getPrefixForNamespace(schema, targetNamespace);
        }
        return '';
    };

    const removePrefixFromAttribute = function (attributes, attributeName, prefix) {
        if (attributes?.[attributeName]?.indexOf(prefix) === 0) {
            attributes[attributeName] = removePrefix(attributes[attributeName], prefix);
        }
    };

    const addPrefixToAttribute = function (attributes, attributeName, prefix) {
        if (attributes?.[attributeName]) {
            attributes[attributeName] = addPrefix(attributes[attributeName], prefix);
        }
    };

    const getPredicateForTagName = (...tagNames) => {
        const compoundedTagNames = tagNames.slice();
        for (const tagName of tagNames) {
            for (const prefix of XSD_PREFIXES) {
                compoundedTagNames.push(prefix + ':' + tagName);
            }
        }
        return function (node) {
            for (const tagName of compoundedTagNames) {
                if (node?.tagName === tagName) {
                    return true;
                }
            }
            return false;
        };
    };

    const findByTagName = function (node, ...predicateOrTagNames) {
        let result = [];
        let predicate;
        if (typeof predicateOrTagNames[0] === 'function') {
            predicate = predicateOrTagNames[0];
        }
        else {
            predicate = getPredicateForTagName(...predicateOrTagNames);
        }
        if (predicate(node)) {
            result.push(node);
        }
        if (node?.children) {
            for (const child of node.children) {
                result = result.concat(findByTagName(child, predicate));
            }
        }
        return result;
    };

    const schemaElementPredicate = getPredicateForTagName('element', 'attribute', 'attributeGroup', 'complexType', 'simpleType', 'include', 'import');

    const externalPrefixes = new WeakMap();

    const copySchema = function (schema1, schema2, prefix) {
        for (var key in schema2.attributes) {
            if (key !== 'targetNamespace') {
                schema1.attributes[key] = schema2.attributes[key];
            }
        }
        const newChildren = schema2
            .children
            .filter(schemaElementPredicate);

        const newDescendants = findByTagName(schema2, schemaElementPredicate);

        const targetNamespacePrefix = getTargetNamespacePrefix(schema2);
        if (targetNamespacePrefix) {
            newDescendants.forEach((c) => {
                removePrefixFromAttribute(c.attributes, 'name', targetNamespacePrefix);
                removePrefixFromAttribute(c.attributes, 'type', targetNamespacePrefix);
                removePrefixFromAttribute(c.attributes, 'ref', targetNamespacePrefix);
            });
        }
        if (prefix) {
            newDescendants.forEach((c) => {
                addPrefixToAttribute(c.attributes, 'name', prefix);
                addPrefixToAttribute(c.attributes, 'type', prefix);
                addPrefixToAttribute(c.attributes, 'ref', prefix);
            });
        }
        newChildren.forEach((child2) => {
            const tagName = removePrefix(child2.tagName);
            if (tagName !== 'include' || tagName !== 'import' ||
                !schema1.children.some((child1) => child1.tagName === child2.tagName &&
                child1.attributes?.name === child2.attributes?.name)) {
                if (tagName === 'include' && prefix) {
                    // Si es un include que estaba en un import hay que meter el prefijo del import
                    externalPrefixes.set(child2, prefix);
                }
                schema1.children.push(child2);
            }
        })
    };

    const externalPredicate = getPredicateForTagName('include', 'import');

    const processExternals = async function (schema, url) {
        const external = schema.children?.find(externalPredicate);
        if (external) {
            let _url = new URL(external.attributes.schemaLocation, url || schema._url).href;
            _url = _url.replaceAll('&amp;', '&');
            if (!processedExternals.has(_url)) {
                var schema2;
                try {
                    schema2 = await proxifyUrl(_url);
                    schema2._url = _url;
                    schema2.children
                        .filter(externalPredicate)
                        .forEach((ext) => {
                            ext.attributes.schemaLocation = new URL(ext.attributes.schemaLocation, _url).href;
                        });
                } catch (err) {
                    return schema
                }
                let prefix = '';
                const tagName = removePrefix(external.tagName);
                if (tagName === 'import') {
                    // Los imports deben añadir el prefijo de namespace
                    const ns = external.attributes.namespace;
                    for (const [key, value] of Object.entries(schema.attributes)) {
                        if (value === ns) {
                            prefix = removePrefix(key) + ':';
                            break;
                        }
                    }
                }
                else { // include
                    const externalPrefix = externalPrefixes.get(external);
                    if (externalPrefix) {
                        prefix = externalPrefix;
                    }
                }
                copySchema(schema, schema2, prefix);
                if (tagName === 'include' && schema2.attributes?.targetNamespace) {
                    schema.attributes.targetNamespace ??= schema2.attributes.targetNamespace;
                }
                processedExternals.add(_url);
            }
            schema.children.splice(schema.children.indexOf(external), 1);
            await processExternals(schema, _url);
        }
        return schema;
    };

    const flattenElements = function (parent) {
        let result = [];
        if (parent.children) {
            if (removePrefix(parent.tagName) === 'choice') {
                return [parent.children.filter(getPredicateForTagName('element'))[0]];
            }

            for (const child of parent.children.filter(getPredicateForTagName('element', 'complexContent', 'sequence', 'choice', 'all'))) {
                if (removePrefix(child.tagName) === 'element') {
                    result.push(child);
                }
                else {
                    result = result.concat(flattenElements(child));
                }
            }
        }
        return result;
    };

    const flattenAttributes = function (parent) {
        let result = [];
        if (parent.children) {
            for (const child of parent.children.filter(getPredicateForTagName('attribute', 'attributeGroup', 'complexContent', 'simpleContent'))) {
                if (removePrefix(child.tagName) === 'attribute') {
                    result.push(child);
                }
                else {
                    result = result.concat(flattenAttributes(child));
                }
            }
        }
        return result;
    };

    const sequencePredicate = getPredicateForTagName('sequence');
    const contentPredicate = getPredicateForTagName('complexContent', 'simpleContent');
    const extensionPredicate = getPredicateForTagName('extension');

    const extendedTypeNames = new Map();

    const mergeNodeExtensions = function (schema, parentNode, complexType) {
        let result;
        const extensions = parentNode.children.filter(extensionPredicate);
        for (const extension of extensions) {
            const baseTypeName = extension.attributes.base;
            if (complexType.attributes?.name) extendedTypeNames.set(complexType.attributes.name, baseTypeName);
            let baseType = schema.children
                .filter(getPredicateForTagName('complexType', 'simpleType'))
                .find((type) => type.attributes.name === baseTypeName);
            const extendedSequence = extension.children?.find(sequencePredicate);
            if (baseType) {
                result ??= mergeExtensions(schema, baseType);
                if (!result) {
                    // 
                    result = baseTypeName;
                    while (extendedTypeNames.has(result)) {
                        result = extendedTypeNames.get(result);
                    }
                }
                const baseSequence = baseType
                    .children
                    .find(contentPredicate)
                    ?.children
                    .find(sequencePredicate);
                if (baseSequence) {
                    if (extendedSequence) {
                        extendedSequence.children = baseSequence.children.concat(extendedSequence.children);
                    }
                    else {
                        parentNode.children.push({ ...baseSequence });
                    }
                }
                const baseAttributes = flattenAttributes(baseType);
                for (const baseAttribute of baseAttributes) {
                    parentNode.children.push(baseAttribute);
                }
            }
            else {
                // No hemos encontrado el tipo base, asumimos que es un tipo básico (integer, etc.).
                result = baseTypeName;
                const parentElement = findByTagName(schema, 'element').find((elm) => elm.children?.includes(complexType));
                if (parentElement) {
                    parentElement.attributes.type = baseTypeName;
                    if (!flattenAttributes(extension).length) {
                        // No hay atributos a añadir, podemos cargarnos el tipo complejo y dejar el tipo básico
                        parentElement.children.splice(parentElement.children.indexOf(complexType), 1);
                    }
                }
            }
            parentNode.children.splice(parentNode.children.indexOf(extension), 1);
            const extendedAttributes = flattenAttributes(extension);
            extendedAttributes?.forEach((attrElm) => {
                parentNode.children ??= [];
                parentNode.children.push(attrElm);
            });
            if (extendedSequence) parentNode.children.push(extendedSequence);
        }
        return result;
    };

    const mergeExtensions = function (schema, complexType) {
        let result = mergeNodeExtensions(schema, complexType, complexType);
        for (const contentElement of complexType.children.filter(contentPredicate)) {
            result ??= mergeNodeExtensions(schema, contentElement, complexType);
        }
        return result;
    };

    const findRefParents = function (node) {
        let result = [];
        if (node?.children) {
            for (const child of node.children) {
                if (child?.attributes?.ref) {
                    result.push(node);
                }
                result = result.concat(findRefParents(child));
            }
        }
        return result;
    };

    const processRefAttributes = function (schema, typeElement) {
        let changed = false;
        const refParents = findRefParents(typeElement);
        for (const parent of refParents.reverse()) {
            parent.children.forEach((child, idx) => {
                const reference = child?.attributes?.ref;
                if (reference) {
                    const childAttributes = { ...child.attributes };
                    delete childAttributes.ref;
                    const localTagName = removePrefix(child.tagName);
                    const referenced = schema
                        .children
                        .filter(getPredicateForTagName(localTagName))
                        .find((elm) => elm.attributes?.name === reference);
                    if (referenced) {
                        const toInsert = { ...referenced };
                        toInsert.attributes = { ...toInsert.attributes, ...childAttributes };
                        parent.children.splice(idx, 1, toInsert);
                        changed = true;
                    }
                }
            });
        }
        return changed;
    };

    const findTypedElements = function (node) {
        let result = [];
        if (node?.children) {
            for (const child of node.children) {
                if (child?.attributes?.type) {
                    result.push(child);
                }
                result = result.concat(findTypedElements(child));
            }
        }
        return result;
    };

    const processTypeAttributes = function (schema, typeElement) {
        let changed = false;
        const typedElements = findTypedElements(typeElement);
        for (const element of typedElements) {
            const typeName = element.attributes.type;
            const referencedType = schema
                .children
                .filter(getPredicateForTagName('complexType', 'simpleType'))
                .find((elm) => elm.attributes?.name === typeName);
            if (referencedType) {
                changed = true;
                element.children ??= [];
                element.children.push(referencedType);
                delete element.attributes.type;
            }
        }
        return changed;
    };

    const getReferencedType = async function (schema, type, depth) {
        if (type.startsWith("xsd:")) {
            type = removePrefix(type);
        }
        //miro si ya está en la colección
        if (collection[type]) {
            return collection[type];
        }

        collection[type] = await processType(schema, type, ++depth);

        return collection[type];
    };

    const getReferencedElement = async function (schema, element) {
        if (element.attributes?.type === 'gml:ReferenceType') {
            const annotation = element.children?.find(getPredicateForTagName('annotation'));
            if (annotation) {
                const appinfo = annotation.children?.find(getPredicateForTagName('appinfo'));
                if (appinfo?.attributes?.source === 'urn:x-gml:targetElement') {
                    const path = appinfo.children[0];
                    if (path) {
                        let parent = schema;
                        for (const part of path.split('/')) {
                            if (part.startsWith('@')) {
                                const attribute = schema
                                    .children
                                    .filter(getPredicateForTagName('attribute'))
                                    .find((attr) => attr.attributes.name === part.substring(1));
                                if (attribute) {
                                    return attribute.attributes?.type ?? null;
                                }
                                return null;
                            }
                            else {
                                const element = parent
                                    .children
                                    .filter(getPredicateForTagName('element'))
                                    .find((elm) => elm.attributes.name === part);
                                if (element) {
                                    parent = element;
                                }
                            }
                        }
                        if (parent !== schema) {
                            return await processElement(schema, parent);
                        }
                    }
                }
            }
        }
        return null;
    };

    const geometryTypes = [
        "gml:PointPropertyType",
        "gml:MultiPointPropertyType",
        "gml:LineStringPropertyType",
        "gml:MultiLineStringPropertyType",
        "gml:LinearRingPropertyType",
        "gml:PolygonPropertyType",
        "gml:MultiPolygonPropertyType",
        "gml:MultiSurfacePropertyType",
        "gml:GeometryPropertyType",
        "gml:GeometryCollectionPropertyType",
        "gml:GeometryAssociationType",
        "gml:MultiCurvePropertyType",
        "gml:CurvePropertyType",
        "gml:BoxPropertyType",
        "gml:AbstractGeometryType"
    ];

    const requestCache = new Map();
    const xmlCache = new Map();
    const promiseCallbacks = new Map();

    const proxifyUrl = async function (url) {
        if (xmlCache.has(url)) {
            return tXml(xmlCache.get(url))[0];
        }
        if (!requestCache.has(url)) {
            requestCache.set(url, new Promise(function (resolve) {
                promiseCallbacks.set(url, resolve);
            }));
            self.postMessage(url);
        }
        return await requestCache.get(url);
    };

    //const getComplexType = function (schema, element) {
    //    const prefix = getTargetNamespacePrefix(schema);
    //    let complexType;
    //    if (element.attributes.type) {
    //        const type = addPrefix(element.attributes.type, prefix);
    //        complexType = schema
    //            .children
    //            .filter(getPredicateForTagName('complexType'))
    //            .find((node) => addPrefix(node.attributes.name, prefix) === type);
    //    }
    //    if (complexType) {
    //        return complexType;
    //    }
    //    return null;
    //};

    const processElement = async function (schema, element, depth) {
        if (depth === MAX_DEPTH) return null;

        if (element) {
            let elementObject = {};
            //cada atributo será un objeto cuyo key será el nombre del atributo y dentro un objeto información de cada atribut como tipo si es nullable etc 
            for (let attributeName in element.attributes) {
                const markedAttributeName = ATTRIBUTE_NAME_PREFIX + attributeName;
                switch (attributeName) {
                    case "minOccurs":
                    case "maxOccurs":
                        elementObject[markedAttributeName] = parseInt(element.attributes[attributeName], 10);
                        if (Number.isNaN(elementObject[markedAttributeName]))
                            elementObject[markedAttributeName] = element.attributes[attributeName];
                        break;
                    case "nillable":
                        elementObject[markedAttributeName] = element.attributes[attributeName] === "true" ? true : false;
                        break;
                    default:
                        elementObject[markedAttributeName] = element.attributes[attributeName];
                        break;
                }
            }

            let type = element.attributes.type;
            if (type) {
                if (type === "gml:ReferenceType") {
                    elementObject = await getReferencedElement(schema, element);
                }
                else {
                    elementObject.type = await getReferencedType(schema, type, depth);
                }
            }
            else {
                //si el tipo del atributo no es un texto sino un elemento complexType o simpleType
                const elementTypeElement = element.children.find(getPredicateForTagName('complexType', 'simpleType'));
                elementObject.type = await processType(schema, elementTypeElement, depth);
            }

            collection[element.attributes.name] = elementObject;
            const prefix = getPrefixForNamespace(schema, schema.attributes.targetNamespace);
            if (prefix) {
                collection[prefix + element.attributes.name] = elementObject;
            }
            return elementObject;
        }

        return null;
    };

    const processType = async function (schema, type, depth) {

        let typeElement;
        if (typeof type === 'string') {
            if (geometryTypes.includes(type)) return type; // no procesamos las geometrías

            const localType = removePrefix(type);
            const typePredicate = (item) => item.attributes.name === type || item.attributes.name === localType;
            typeElement = schema
                .children
                .filter(getPredicateForTagName('complexType'))
                .find(typePredicate);
            if (!typeElement) {
                typeElement = schema
                    .children
                    .filter(getPredicateForTagName('simpleType'))
                    .find(typePredicate);
                if (typeElement) {
                    return typeElement.attributes.name;
                }
            }
        }
        else {
            typeElement = type;
        }
        if (!typeElement) return type;
        if (geometryTypes.includes(typeElement.attributes?.name)) return typeElement.attributes.name; // no procesamos las geometrías

        const objFeature = {};

        // Hago merge de todos los tipos en extension
        const baseType = mergeExtensions(schema, typeElement);
        if (baseType && !baseType.includes(':')) {
            // Resulta que en el fondo este typeElement era la extensión de un tipo básico. 
            // Devolvemos el tipo base en la propiedad especial #text
            objFeature[TEXT_NODE] = { type: baseType };
        }

        let typeChangesMade, refChangesMade;
        do {
            // Sustituimos los elementos con atributos type por los elementos referenciados
            typeChangesMade = processTypeAttributes(schema, typeElement);

            // Sustituimos los elementos con atributos ref por los elementos referenciados
            refChangesMade = processRefAttributes(schema, typeElement);
        }
        while (typeChangesMade || refChangesMade);

        //Recorro los nodos element debajo del nodo typeElement, incluyendo los que estan en complexContent, sequence o all
        const elements = flattenElements(typeElement);
        //recorro los nodos element que son los atributos de la feature
        for (const element of elements) {
            const elmObj = await processElement(schema, element, depth + 1);
            if (elmObj) {
                elmObj.index = Object.keys(objFeature).length;
                objFeature[element.attributes.name] = elmObj;
            }
        }
        //recorro los nodos attribute que sean atributos de la feature
        const attributes = flattenAttributes(typeElement);
        for (const attribute of attributes) {
            let type = attribute.attributes.type || 'string';
            const attrObj = {};
            attrObj.type = await getReferencedType(schema, type, depth);
            objFeature[ATTRIBUTE_NAME_PREFIX + attribute.attributes.name] = attrObj;
        }
        return objFeature;
    };

    const processDft = async function (json, layerName, _prefix) {
        //coger nodo esquema
        const schema = json.find(getPredicateForTagName('schema'));
        //Añado includes e imports
        await processExternals(schema);

        //busco los elements con el nombre de la capa en cuestión
        const elementName = removePrefix(layerName);
        const layerElement = schema
            .children
            ?.filter(getPredicateForTagName('element'))
            ?.find((node) => node.attributes.name === elementName);

        await processElement(schema, layerElement, 0);
    };

    var collection = {};
    var processedExternals = new Set();
    const MAX_DEPTH = 10;

    onmessage = async function (e) {
        if (e.data.type === 'describeFeatureType') {
            const json = tXml(e.data.xml);

            const layerNames = Array.isArray(e.data.layerName) ? e.data.layerName : e.data.layerName.split(",");
            let result;
            try {
                for (var i = 0; i < layerNames.length; i++) {
                    await processDft(json, layerNames[i]);
                }
                result = true;
            }
            catch (error) {
                console.error(error);
                result = error.message;
            }
            postMessage({
                state: result === true ? 'success' : 'error',
                message: result === true ? '' : result,
                dftCollection: layerNames.reduce(function (acc, name) {
                    const dft = collection[name] ?? collection[name.replace(/^\w{1,}:/, (v) => v.toLowerCase())];
                    return Object.assign(acc, { [name]: dft });
                }, {})
            });
            close();
        }
        else {
            xmlCache.set(e.data.url, e.data.xml);
            const callback = promiseCallbacks.get(e.data.url);
            if (callback) {
                callback(tXml(e.data.xml)[0]);
                promiseCallbacks.delete(e.data.url);
            }
        }

    };

})();
`],{type:"text/javascript; charset=utf-8"}),s=class{#Gn;#Y={};#Bn(){const e=URL.createObjectURL(a),t=new Worker(e);return this.#Gn||(this.#Gn=new o.default(n.A.proxify)),t.addEventListener("message",(async e=>{if(!(e.data instanceof Object))return await this.#Un(t,e.data);if("success"!==e.data.state)throw new Error(e.data.message);this.#Y=Object.assign(this.#Y,this.#qn(e.data.dftCollection))})),t}async#Un(e,t){const{default:n}=await r.e(7375).then(r.bind(r,7375));if(n.has(t))e.postMessage({type:"getSchema",url:t,xml:n.get(t)});else try{const r=await this.#Gn.fetchXML(t);e.postMessage({type:"getSchema",url:t,xml:r.documentElement.outerHTML})}catch(r){e.postMessage({type:"getSchema",url:t,xml:"<xsd:schema></xsd:schema>"})}}getFeatureTypeDescription(e){const t=Array.isArray(e)?e[0]:e;return this.#Y[t]}getFeatureTypeDescriptions(){return this.#Y}#qn(e){const t={};for(const r in e)t[r]=e[r]?.type;return t}async parseFeatureTypeDescription(e,t){const r=this.#Bn();if(e.querySelector("Exception")||e.querySelector("exception"))throw(e.querySelector("Exception")||e.querySelector("exception")).textContent.trim();const o=i.A.getPromiseFromEvent(r,"message",{resolvePredicate:function(e){return!!(e.data instanceof Object&&"success"===e.data.state&&(Object.keys(e.data.dftCollection).join()===Array.isArray(t)?t.join():t))},rejectPredicate:e=>e.data instanceof Object&&"success"!==e.data.state});r.postMessage({type:"describeFeatureType",layerName:t,xml:e.documentElement.outerHTML,url:n.A.apiLocation.indexOf("http")>=0?n.A.apiLocation:document.location.protocol+n.A.apiLocation});const a=await o;return this.#qn(a.data.dftCollection)}#Wn(e){const t=e.documentElement.getAttribute("xsi:schemaLocation");if(t){const r=document.implementation.createDocument("http://www.w3.org/2001/XMLSchema","xsd:schema");for(const t of e.documentElement.attributes)t.name.startsWith("xmlns:")&&r.documentElement.setAttribute(t.name,t.value);return t.split(" ").filter(((e,t)=>t%2!=0)).forEach((e=>{if(e.indexOf("schemas.opengis.net")<0){const t=document.createElementNS("http://www.w3.org/2001/XMLSchema","include");t.setAttribute("schemaLocation",e),r.documentElement.appendChild(t)}})),r}}async parseSchemas(e,t){if(e.documentElement.getAttribute("xsi:schemaLocation")){const r=this.#Wn(e);if(r)return await this.parseFeatureTypeDescription(r,[t])}}static getSchemaEntries(e){return Object.entries(e).sort((function(e,t){const r=e[1].index,n=t[1].index;return void 0===r||void 0===n?0:r-n}))}}},5112:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(8038),i=r(797),o=r(1845),a=r(5777),s=r(3791);n.A.control=n.A.control||{};const l="tc-ctl-img-magnifier-top",c="tc-ctl-img-magnifier-left",u="tc-ctl-img-magnifier-right",h="tc-ctl-img-magnifier",d="tc-ctl-img-magnifier-no-anchor",p="sitna-image-magnifier";class g{constructor(){this.textToClose="",this.textToOpen=""}}class f extends o.default{CLASS=h;#t="."+h;#Hn;#jn;#Vn;#zn;constructor(e,t){super(...arguments);const r=this;r.#jn=e,r.classList.add(i.A.classes.HIDDEN),r.addEventListener("click",(function(e){r.hideMagnifier()})),r.#Vn=t,r.title="[[textToClose]]",r.#zn=document.createElementNS("http://www.w3.org/1999/xhtml","div"),r.#zn.classList.add("tc-ctl-img-magnifier-bg"),r.appendChild(r.#zn),r.#zn.addEventListener("pointerup",(function(e){e.preventDefault(),r.hideMagnifier()})),r.#zn.addEventListener("mouseleave",(function(e){r.hideMagnifier()})),r.model=new g}#Yn(e,t,r){const o=this,a=o.#jn||r;o.#zn.style.backgroundImage="url('"+t.src+"')",o.style.width=t.width*a+10+"px",o.style.height=t.height*a+10+"px",o.classList.remove(l),o.classList.remove("tc-ctl-img-magnifier-bottom"),o.classList.remove(c),o.classList.remove(u),o.classList.remove(d);const s=t.getBoundingClientRect();var h,p,g=o.getBoundingClientRect();const f=n.A.browserFeatures.touch()?15:8;p=s.top-g.height-f,o.classList.add(l),o.parentElement.clientWidth/2>e.clientX?(h=s.left+s.width/2-20,o.classList.add(u)):(h=s.left-g.width+s.width/2+20,o.classList.add(c)),o.style.top=p+"px",o.style.left=h+"px";const m=o.getBoundingClientRect();m.right>o.parentElement.clientWidth&&(o.style.left=m.left-(m.right-o.parentElement.clientWidth)+"px",o.classList.add(d)),m.top<0&&(o.style.top="0px",o.classList.add(d)),m.left<0&&(o.style.left="0px",o.classList.add(d)),m.bottom<0&&(o.style.top=m.height+"px",o.classList.add(d)),o.classList.remove(i.A.classes.HIDDEN)}hideMagnifier(){this.classList.add(i.A.classes.HIDDEN)}addNode(e,t){const r=this;let o=[];switch(!0){case"string"==typeof e:o=o.concat(Array.from(document.querySelectorAll(e)));break;case e instanceof Node:o.push(e);break;case e instanceof NodeList:o=o.concat(Array.from(e))}o.forEach((e=>{e.classList.add("tc-ctl-img-magnified"),e.oncontextmenu=e=>e.preventDefault(),e.title="[[textToOpen]]",e.addEventListener("pointerdown",(function(e){e.preventDefault(),this.classList.contains(i.A.classes.NOT_AVAILABLE)||r.#Yn(e,this,t)})),e.addEventListener("pointerup",(function(e){e.preventDefault(),this.classList.contains(i.A.classes.NOT_AVAILABLE)||r.hideMagnifier()})),e.addEventListener("mouseleave",(function(e){e.relatedTarget!==r.#zn&&r.hideMagnifier()})),n.A.browserFeatures.touch()&&e.addEventListener("touchmove",(function(e){r.hideMagnifier()}))})),r.#zn.addEventListener("pointerup",(function(e){e.preventDefault(),r.hideMagnifier()})),r.controller?r.controller.view.add(o):o.length&&(r.controller=new a.A(r.model,new s.A(o))),r.model.textToOpen=r.#Vn.textToOpen,r.model.textToClose=r.#Vn.textToClose}}f.prototype.CLASS="tc-ctl-img-magnifier",customElements.get(p)||customElements.define(p,f),n.A.control.ImageMagnifier=f;const m=f},5121:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1845),l=(r(1092),r(5777)),c=r(3791);n.A.control=n.A.control||{},i.A.event.DRAWSTART="drawstart.tc",i.A.event.DRAWEND="drawend.tc",i.A.event.DRAWCANCEL="drawcancel.tc",i.A.event.DRAWUNDO="drawundo.tc",i.A.event.DRAWREDO="drawredo.tc",i.A.event.POINT="point.tc",i.A.event.MEASURE="measure.tc",i.A.event.MEASUREPARTIAL="measurepartial.tc",i.A.event.STYLECHANGE="stylechange.tc",i.A.event.CHANGE="change";const u="sitna-draw";class h{constructor(){this.new="",this.undo="",this.redo="",this.cancel="",this.end="",this.tooltip=""}}class d extends s.default{#t="."+d.prototype.CLASS;#r;#Bt;#$n;#Kn=d.prototype.CLASS+"-point";#Xn=d.prototype.CLASS+"-line";#Zn=d.prototype.CLASS+"-polygon";#Jn=d.prototype.CLASS+"-rectangle";#Qn;#qt;#ei;#ti;#ri;#ni;#ii;#u=new WeakMap;static extensibility={DISABLED:"disabled",ENABLED:"enabled",EXTEND_ONLY:"extend_only"};constructor(){super(...arguments);const e=this;e.styles=e.options.styles||a.A.extend(!0,{},o.H.styles),e.initProperty("measurer").initProperty("stylable").initProperty("singleSketch").initProperty("extensibleSketch").initProperty("snapping").initProperty("mode"),e.#Qn=!(!1===e.options.layer),e.history=[],e.historyIndex=0,e.exportsState=!0,e.#qt=null,e.on(i.A.event.DRAWSTART,(function(t){e.resetValues(),t.feature&&(e.history=t.feature.getCoordinates(),e.historyIndex=e.history.length)})).on(i.A.event.POINT,(function(t){e.layer&&e.singleSketch&&e.layer.features&&e.layer.features.length>0&&e.layer.clearFeatures(),e.history.length=e.historyIndex,e.history[e.historyIndex++]=t.point,e.#oi()})).on(i.A.event.DRAWEND,(function(t){e.#ai(),t.feature.setId(e.layer.getNextFeatureId()),e.callback&&e.callback(t.feature)})),e.model=new h}connectedCallback(){super.connectedCallback(),this.#Qn=!this.hasAttribute("borrowed-layer")}static get observedAttributes(){return["mode","stylable"]}attributeChangedCallback(e,t,r){if(t===r)return;"stylable"===e&&this.#Wt(),"mode"===e&&this.#h()}get mode(){return this.hasAttribute("mode")?this.getAttribute("mode"):i.A.geom.POLYLINE}set mode(e){e?this.setAttribute("mode",e):this.removeAttribute("mode")}async#h(){const e=this,t=e.mode;await e.renderPromise(),(await e.getStyler()).mode=t}get stylable(){return this.hasAttribute("stylable")}set stylable(e){this.toggleAttribute("stylable",!!e)}async#Wt(){const e=this;await e.renderPromise(),e.querySelector(`.${e.CLASS}-style`).classList.toggle(i.A.classes.HIDDEN,!e.stylable)}get measurer(){return this.hasAttribute("measurer")}set measurer(e){this.toggleAttribute("measurer",!!e)}get snapping(){return this.#$n}set snapping(e){const t=this;t.#$n=e,t.isActive&&t.wrap.setSnapping(e)}get singleSketch(){return this.hasAttribute("single-sketch")}set singleSketch(e){this.toggleAttribute("single-sketch",!!e)}get extensibleSketch(){return this.hasAttribute("extensible-sketch")}set extensibleSketch(e){this.toggleAttribute("extensible-sketch",!!e)}async loadTemplates(){const e=await r.e(8189).then(r.bind(r,8189));this.template=e.default}render(e){const t=this;switch(t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:t.model.tooltip=t.getLocaleString("drawLine"),t.classList.add(t.#Xn);break;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:t.model.tooltip=t.getLocaleString("drawPolygon"),t.classList.add(t.#Zn);break;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:t.model.tooltip=t.getLocaleString("drawPoint"),t.classList.add(t.#Kn);break;case i.A.geom.RECTANGLE:t.model.tooltip=t.getLocaleString("drawRectangle"),t.classList.add(t.#Jn);break;default:t.model.tooltip=t.getLocaleString("draw")}const r={stylable:t.stylable};return t.renderData(r,(function(){t.reset=!0,t.callback=null,a.A.isFunction(t.options.callback)&&(t.callback=t.options.callback),t.wrap=new n.A.wrap.control.Draw(t),t.getStyler().then((e=>{e.setStyles(t.styles)})),t.#ei=t.querySelector(t.#t+"-btn-new"),t.#ti=t.querySelector(t.#t+"-btn-cancel"),t.#ri=t.querySelector(t.#t+"-btn-end"),t.#ni=t.querySelector(t.#t+"-btn-undo"),t.#ii=t.querySelector(t.#t+"-btn-redo"),t.addUIEventListeners(),a.A.isFunction(e)&&e(),t.controller=new l.A(t.model,new c.A(t)),t.updateModel()}))}addUIEventListeners(){const e=this;e.getStyler().then((t=>{t.addEventListener(i.A.event.STYLECHANGE,(t=>{e.wrap.setStyle();const r={};r[t.detail.property]=t.detail.value,e.trigger(i.A.event.STYLECHANGE,r)}))})),e.#ei.addEventListener(i.A.event.CLICK,(function(){e.new()}),{passive:!0}),e.#ti.addEventListener(i.A.event.CLICK,(function(){e.cancel()}),{passive:!0}),e.#ri.addEventListener(i.A.event.CLICK,(function(){e.end()}),{passive:!0}),e.#ni.addEventListener(i.A.event.CLICK,(function(){e.undo()}),{passive:!0}),e.#ii.addEventListener(i.A.event.CLICK,(function(){e.redo()}),{passive:!0})}async register(e){const t=this;return t.styles=a.A.extend(!0,{},e.options.styles,t.options.styles),await super.register(e),(await t.getStyler()).setStyles(t.styles),t.map.on(i.A.event.VIEWCHANGE,(function(){t.map.view===i.A.view.PRINTING&&t.end()})).on(i.A.event.PROJECTIONCHANGE,(function(e){t.history.forEach((function(t,r,n){n[r]=a.A.reproject(t,e.oldCrs,e.newCrs)}))})),t.#qt=new Promise((function(r,n){e.loaded((function(){t.options.layer?(t.setLayer(t.options.layer),r(t.layer)):t.#Qn?e.addLayer({id:t.getUID(),title:"DrawControl",stealth:!0,owner:t,type:i.A.layerType.VECTOR,styles:{point:Object.assign({},t.styles.point),line:Object.assign({},t.styles.line),polygon:Object.assign({},t.styles.polygon)}}).then((function(n){e.putLayerOnTop(n),t.setLayer(n),r(t.layer)})):r(null)}))})),t}unregister(){this.map.controls.splice(this.map.controls.findIndex((e=>e==this)),1)}new(){const e=this;return e.layer&&e.singleSketch&&e.layer.clearFeatures(),e.#ti.disabled=!1,e.setMode(e.mode,!0),e}undo(){const e=this;let t=e.wrap.undo();return t&&(e.historyIndex--,e.#oi(),e.historyIndex<=0&&e.resetValues(),e.trigger(i.A.event.DRAWUNDO)),t}redo(){const e=this;let t=this.wrap.redo();return t&&(e.historyIndex++,e.#oi(),e.trigger(i.A.event.DRAWREDO)),t}cancel(){const e=this;return e.resetValues(),e.#ai(),e.#ti.disabled=!0,e.trigger(i.A.event.DRAWCANCEL,{ctrl:e}),e}activate(){const e=this;switch(e.#ei.active=!0,e.#ti.disabled=!1,super.activate.call(e),e.wrap.activate(e.mode),e.classList.remove(e.#Kn,e.#Xn,e.#Zn,e.#Jn),e.getStyler().then((t=>t.mode=e.mode)),e.mode){case i.A.geom.POINT:e.classList.add(e.#Kn);break;case i.A.geom.POLYLINE:e.classList.add(e.#Xn);break;case i.A.geom.POLYGON:e.classList.add(e.#Zn);break;case i.A.geom.RECTANGLE:e.classList.add(e.#Jn)}return e}deactivate(){const e=this;return e.#ei&&(e.#ei.active=!1),e.#ti&&(e.#ti.disabled=!0),super.deactivate.call(e),e.wrap&&e.wrap.deactivate(),e.resetValues(),e}clear(){const e=this;return e.layer&&e.layer.clearFatures(),e.resetValues(),e}isExclusive(){return!0}end(){const e=this;return e.wrap.end(),e.resetValues(),e}setMode(e,t){const r=this;return r.mode=e,t&&e?r.activate():r.isActive&&r.deactivate(),r}setStyle(e){const t=this;switch(e=a.A.extend(t.#r,e),t.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:case i.A.geom.RECTANGLE:t.styles.line=e;break;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:t.styles.polygon=e;break;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:t.styles.point=e;break;default:e={}}t.getStyler().then((e=>{e.setStyles(t.styles),t.wrap.setStyle()}))}getStyle(){return this.#Bt?.getStyle()}resetStyle(){return this.getStyler().then((e=>e.resetStyle())),this}setStrokeColor(e){return this.styler.setStrokeColor(e),this}setFillColor(e){return this.styler.setFillColor(e),this}setFillOpacity(e){return this.styler.setFillOpacityWatch(e),this}setStrokeWidth(e){return this.styler.setStrokeWidth(e),this}#S(e,t){if(e){const r=void 0!==t?!t:void 0;e.classList.toggle(i.A.classes.HIDDEN,r)}}toggleStyleTools(e){const t=this;return t.#S(t.querySelector(`.${t.CLASS}-style`),e),t}getLayer(){return this.layer?Promise.resolve(this.layer):this.#qt}setLayer(e){const t=this;return t.map&&(t.layer&&t.#u.set(t.layer,Object.assign({},t.#r)),t.layer="string"==typeof e?t.map.getLayer(e):e,t.getStyler().then((function(t){t.setLayer(e)})),!e&&t.isActive&&t.deactivate()),t}setFeature(e){return this.getStyler().then((t=>t.setFeature(e))),self}resetValues(){const e=this;return e.history.length=0,e.historyIndex=0,e.#oi(),e}async getStyler(){const e=this;return await e.renderPromise(),e.#Bt=e.querySelector("sitna-feature-styler"),e.#Bt}getSketch(){return this.wrap.getSketch()}getExtendedFeature(){return this.wrap.getExtendedFeature()}exportState(){const e=this;return e.exportsState&&e.layer?{id:e.getId(),layer:e.layer.exportState()}:null}importState(e){return this.getLayer().then((function(t){t.importState(e.layer)})),this}async#oi(){const e=this;await e.renderPromise();const t=e.mode;e.#ri.disabled=0===e.historyIndex||t===i.A.geom.POLYGON&&e.historyIndex<3||t===i.A.geom.POLYLINE&&e.historyIndex<2||t===i.A.geom.RECTANGLE,e.#ii.disabled=e.history.length===e.historyIndex,e.#ni.disabled=0===e.historyIndex||e.mode===i.A.geom.RECTANGLE}async#ai(){const e=this;await e.renderPromise(),e.resetValues(),e.#ri.disabled=!0,e.#ti.disabled=!1}updateModel(){switch(this.model.new=this.getLocaleString("new"),this.model.undo=this.getLocaleString("undo"),this.model.redo=this.getLocaleString("redo"),this.model.end=this.getLocaleString("end"),this.model.cancel=this.getLocaleString("cancel"),this.mode){case i.A.geom.POLYLINE:case i.A.geom.MULTIPOLYLINE:this.model.tooltip=this.getLocaleString("drawLine");break;case i.A.geom.POLYGON:case i.A.geom.MULTIPOLYGON:this.model.tooltip=this.getLocaleString("drawPolygon");break;case i.A.geom.POINT:case i.A.geom.MULTIPOINT:this.model.tooltip=this.getLocaleString("drawPoint");break;case i.A.geom.RECTANGLE:this.model.tooltip=this.getLocaleString("drawRectangle");break;default:this.model.tooltip=this.getLocaleString("draw")}}async updateLanguage(){this.updateModel()}}d.prototype.CLASS="tc-ctl-draw",customElements.get(u)||customElements.define(u,d),n.A.control.Draw=d;const p=d},5232:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>w});var n=r(8038),i=r(3301),o=r(797),a=r(1421),s=r(2180),l=(r(8991),r(9239)),c=r(5777),u=r(3791);n.A.control=n.A.control||{};const h="portrait",d={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:595,height:842},pageMargins:[29.5,14,29.5,22.5],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",width:489,alignment:"center",margin:[0,10,0,0]},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:534,height:775.5}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},p={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:842,height:595},pageMargins:[30,14,30,22],content:[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:528}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},g={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:841.89,height:1190.55},pageMargins:[29.954,14,29.954,21.55],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",width:489,margin:[0,10,0,0],alignment:"center"},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:780,height:1125}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},f={logoWidth:60,logoHeight:30,layoutPDF:{pageSize:{width:1190.55,height:841.89},pageMargins:[28.775,14,28.775,14.89],content:[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]},reset:function(){this.layoutPDF.content=[{columns:[{image:null,height:22,width:45,margin:[0,0,0,6]},{text:"",alignment:"center",margin:[0,10,0,0],width:600},{alignment:"right",margin:[0,10,0,0]}]},{table:{widths:["*"],body:[[{image:null,width:1131,height:783}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}]}},m=function(e,t){switch(e){case h:switch(t){case"A4":return d;case"A3":return g}break;case"landscape":switch(t){case"A4":return p;case"A3":return f}break;default:return d}},y=function(e){return e.layoutPDF.content[0].columns[0]},v=85;class A{constructor(){this.print="",this.title="",this.mapTitle="",this.layout="",this.landscape="",this.portrait="",this.size="",this.createQrCodeToImage="",this.appendQRCode="",this.printMap="",this.qrAdvice="",this.layoutTitle="",this.sizeTitle=""}}class S{constructor(){this.printpdf="",this.sharePDF="",this.close=""}}class E extends a.default{constructor(){super(...arguments),this.model=new A,this.toolModel=new S}async loadTemplates(){const e=this,t=r.e(7333).then(r.bind(r,7333)),n=r.e(5385).then(r.bind(r,5385)),i=r.e(6179).then(r.bind(r,6179)),o={};o[e.CLASS]=(await t).default,o[e.CLASS+"-view"]=(await n).default,o[e.CLASS+"-tools"]=(await i).default,e.template=o}render(e){const t=this;return t.renderPromise().then((()=>{t.controller=new c.A(t.model,new u.A(t.div)),t.updateModel()})),super.renderData.call(t,{controlId:t.id},e)}register(e){const t=this,r=super.register.call(t,e);t.map.crossOrigin="anonymous";const a=function(){m(t.orientation||h,t.format.toString().toUpperCase()||"A4").reset()};return t.div.addEventListener("click",n.A.EventTarget.listenerBySelector("."+t.CLASS+"-btn",(function(){const e=t.getContainer();t.map.setView(o.A.view.PRINTING);var r=document.querySelector("."+t.CLASS+"-qrcode");const n=t.div.querySelector(`.${t.CLASS}-image-qr`);!n.disabled&&n.checked?(r||((r=document.createElement("div")).classList.add(t.CLASS+"-qrcode"),t.getContainer().appendChild(r)),r.innerHTML="",t.makeQRCode(r,v)):r&&(r.innerHTML="");const s="."+t.CLASS+"-btn";t.map.on(o.A.event.STARTLOADING,(function(){const e=t.div.querySelector(s);e.classList.add(o.A.classes.DISABLED),e.disabled=!0})),t.map.on(o.A.event.STOPLOADING,(function(){const e=t.div.querySelector(s);e.classList.remove(o.A.classes.DISABLED),e.disabled=!1})),t.#si()&&t.map.on(o.A.event.ZOOM,a);const l=function(r){if(r){e.classList.add(r);var n=e.getBoundingClientRect();Number.isInteger(n.width)||(e.style.width=Math.round(n.width)+"px"),Number.isInteger(n.height)||(e.style.height=Math.round(n.height)+"px");const i=`calc(50% - ${n.width/2}px)`;if(t._viewDiv.querySelector(`.${t.CLASS}-view-left`).style.width=i,t._viewDiv.querySelector(`.${t.CLASS}-view-right`).style.width=i,t._viewDiv.querySelector(`.${t.CLASS}-view-bottom`).style.top=n.height+"px",t.map.toast(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"),{type:o.A.msgType.INFO,duration:7e3}),n=e.getBoundingClientRect(),window.screen.width<n.width){const e=window.screen.width/n.width,r=n.width/window.screen.width,i=document.querySelector('meta[name="viewport"]');t._viewportMeta=i.getAttribute("content"),i.setAttribute("content",`user-scalable=yes, initial-scale=${e}, minimum-scale=${e}`);const a=t.getToolsElement().style;t._toolsTransform=a.transform,t._toolsTransformOrigin=a.transformOrigin,a.transform=`scale(${r}, ${r})`,a.transformOrigin="100% 0%";const s=document.querySelector("."+o.A.classes.TOAST_CONTAINER);if(s){const e=s.style;t._toastTransform=e.transform,t._toastTransformOrigin=e.transformOrigin,e.transform=`scale(${r}, ${r})`,e.transformOrigin="0% 100%"}}}t.map.on3DView?t.map.view3D.getScene().render():t.map.wrap.map.updateSize()},d=function(){if(Object.prototype.hasOwnProperty.call(t,"_viewportMeta")){document.querySelector('meta[name="viewport"]').setAttribute("content",t._viewportMeta),delete t._viewportMeta;const e=t.getToolsElement().style;e.transform=t._toolsTransform,e.transformOrigin=t._toolsTransformOrigin,delete t._toolsTransform,delete t._toolsTransformOrigin;const r=document.querySelector("."+o.A.classes.TOAST_CONTAINER);r&&(r.style.transform=t._toastTransform,r.style.transformOrigin=t._toastTransformOrigin),delete t._toastTransform,delete t._toastTransformOrigin}m(t.orientation||h,t.format.toString().toUpperCase()||"A4").reset(),t.#si()&&t.map.off(o.A.event.ZOOM,a),t.map.toastHide(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"));const e=t.getContainer();e.classList.remove(t.currentFormat,t.CLASS+"-printing"),e.style.removeProperty("width"),e.style.removeProperty("height"),l(),t.map.setView(o.A.view.DEFAULT),t._viewDiv.classList.add(o.A.classes.HIDDEN)};t._viewDiv||(t._viewDiv=i.A.getDiv(),document.body.appendChild(t._viewDiv),t.getRenderedHtml(t.CLASS+"-view",null,(function(e){t._viewDiv.innerHTML=e})),t.getRenderedHtml(t.CLASS+"-tools",{canShare:!!navigator.share},(function(r){e.insertAdjacentHTML("beforeend",r),e.querySelector("."+t.CLASS+"-btn-close").addEventListener("click",d),e.querySelector("."+t.CLASS+"-btn-pdf").addEventListener("click",t.downloadPdf.bind(t)),e.querySelector("."+t.CLASS+"-btn-share")?.addEventListener("click",t.sharePdf.bind(t)),t.toolsController=new c.A(t.toolModel,new u.A(t.getToolsElement()))}))),t.orientation=t.div.querySelector("#print-design").value,t.format=t.div.querySelector("#print-size").value,t.currentFormat=t.CLASS+"-"+t.orientation+"-"+t.format,t._viewDiv.classList.remove(o.A.classes.HIDDEN),t.getContainer().classList.add(t.CLASS+"-printing"),l(t.currentFormat)}))),t.div.addEventListener("click",n.A.EventTarget.listenerBySelector(`.${t.CLASS}-image-qr`,(function(e){t.generateLink()}))),t.div.addEventListener("click",n.A.EventTarget.listenerBySelector("h2",(function(e){t.registeredListeners||t.generateLink(),t.registerListeners()}))),r}#si(){return this.map.workLayers.some((function(e){return e.type===o.A.layerType.WMS&&e.getVisibility()}))}#li(){return this.map.workLayers.some((function(e){if(e.type===o.A.layerType.WMS&&e.getVisibility()){for(var t=0;t<e.names.length;t++)if(e.isVisibleByScale(e.names[t]))return!0;return!1}return!1}))}getContainer(){return this.map.on3DView?this.map.view3D.container:this.map.div}static imageErrorHandling(e){n.A.error(self.getLocaleString("print.error")),n.A.error("No se ha podido generar el base64 correspondiente a la imagen: "+e,o.A.msgErrorMode.EMAIL,"Error en la impresión")}getLogo(){const e=this,t=m(e.orientation||h,e.format.toString().toUpperCase()||"A4"),r=function(){var e=y(t);return delete e.image,e.text="",e.width=0,e};return e.options.logo?i.A.imgToDataUrl(e.options.logo).then((function(e){const r=e.canvas,n=e.dataUrl;var i=y(t);return i.width||(i.width=r.width/r.height*i.height),i.image=n,i}),(function(){return E.imageErrorHandling(e.options.logo),r()})):r()}getScaleBar(){const e=this;var t=m(e.orientation||h,e.format.toString().toUpperCase()||"A4").layoutPDF.content[0].columns[2];const r=function(){return delete t.image,t.text="",t.width="auto",t};if(e.map.on3DView)t.table={widths:[0],body:[{border:[!1,!1,!1,!1],text:""}]};else{let c=e.map.getControlsByClass(s.default)[0];if(!c)return r();var n=document.getElementsByClassName("ol-scale-line-inner"),i=n[0].getBoundingClientRect();if(!i)return r();var o=getComputedStyle(n[0],null),a=parseInt(o.getPropertyValue("border-left-width").replace("px",""))||0,l=parseInt(o.getPropertyValue("border-right-width").replace("px",""))||0;t.table={widths:[.75*((i.width>i.height?i.width:i.height)-a-l)],body:[[{border:[!0,!1,!0,!0],text:c.getText(),fontSize:10,alignment:"center"}]]},t.layout={paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}}return t}getLegend(){var e=[];let t;var r=this.map.workLayers.filter((function(e){return e.type===o.A.layerType.WMS&&e.getVisibility()})),n=[],a=function(e,r,n){if(r.isVisibleByScale(e.name))if(r.options&&r.options.params&&r.options.params.base64LegendSrc){const i=r.options.params.base64LegendSrc;t.push({title:e.title,level:n,srcBase64:i})}else e.legend?.length?e.legend.forEach((r=>{t.push({title:e.title,level:n,src:r.src,name:e.name})})):t.push({title:e.title,level:n,src:"",name:e.name})},s=function(e,r,n,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)s(e[o],r,n,i);else e&&Object.prototype.hasOwnProperty.call(e,"children")&&e.children.length>0&&((e.title||e.name)&&t.push({header:e.title||e.name,level:i}),s(e.children,r,n,++i));e&&Object.prototype.hasOwnProperty.call(e,"children")&&0===e.children.length&&(r.apply(this,[e,n,i]),i--)};const c=function(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){t(n)},n.onerror=function(e){r(e)},n.src=e}))},u=function(e){return e?.substr(e.indexOf(":")+1)},h=function(e){const t={width:.75*e.width,height:.75*e.height,margin:[0,0,0,2]};return t[e.base64?"image":"svg"]=e.base64?e.base64:e.svg,t};return r.forEach((function(e){if(t=[],e.layerNames&&0!==e.layerNames.length){var r=e.hideTree;e.tree=null,e.hideTree=!0,s(e.getNestedTree(),a,e,0),e.hideTree=r,t.length>0&&n.push({title:e.title,layers:t})}})),new Promise((function(t,o){var a;Promise.all((a=r,a.map(((e,t)=>new Promise((function(r,o){e.getLegend().then((async function(o){var a=n[t].layers;await Promise.all(a.map((async r=>{const a=o.filter((e=>e))?.[0]?.find((e=>u(e.layerName)===u(r.name)));if(!a){const e=n[t].layers.findIndex((e=>e.title===r.title));if(e)return void n[t].layers.splice(e,1)}if(a?.src){const e=await c(a.src);r.image=[{base64:a.src,height:e.height,width:e.width}]}else if(a?.rules?.length){const t=await(0,l.CreateSymbolizer)(a.rules,e),n=await Promise.all(t.map((async e=>{const t=await c(e.src);return{base64:i.A.imgTagToDataUrl(t,"image/png").base64,height:t.height,width:t.width,title:e.value}})));r.image=n?.filter((e=>e))}}))),r()})).catch((async e=>{for(var t=0;t<n.length;t++)for(var o=n[t].layers,a=0;a<o.length;a++)await async function(e,t){var r=n[e].layers[t],o=r.src||r.srcBase64;if(o){const e=await c(o),t=i.A.imgTagToDataUrl(e,"image/png");r.image=[{base64:t.base64,height:e.height,width:e.width}]}}(t,a);r()}))})))))).then((function(){(n=n.filter((e=>e.layers.some((e=>e.image?.length))))).map((function(e,t){return{groupIndex:t,height:e.layers.filter((function(e){return e.image})).reduce((function(e,t,r,n){return e+n[r].image.reduce(((e,t)=>e+t.height),0)}),0)}})).sort((function(e,t){return e.height>t.height?1:e.height<t.height?-1:0})).forEach((function(t,r){!function(t,r){var n=[[{text:t.title,fontSize:13,style:["tablegroup"],margin:[0,r>0?10:0,0,2]}]];const i=(n=n.concat(t.layers.filter((function(e){return Object.prototype.hasOwnProperty.call(e,"header")&&e.header.trim().toLowerCase()!==t.title.trim().toLowerCase()})).map((function(e,t){return[{text:e.header.trim(),fontSize:Math.max(9,14-e.level),margin:[10*e.level,0,0,2]}]})))).length;var o=null,a=null;t.layers.forEach((function(e,t){if(e.header)o=e,a&&(a=null);else{var r;if(a||(a=1),o){var i=n.map((e=>e[0].text||"")).indexOf(o.header);r=i+a++}if(e.image?.length){const t=[{text:e.title,fontSize:Math.max(9,14-e.level),margin:[-10,0,0,5]}];e.image.forEach((r=>{a++,r.title?t.push({columns:[h(r),{text:r.title,fontSize:Math.max(9,14-e.level),width:"*",margin:[5,2,0,2]}]}):t.push(h(r))}));const i=[{ul:t,type:"none",margin:[10*e.level,0,0,2]}];r?n.splice(r,0,i):n.push(i)}else{const t=[{text:e.title,fontSize:11,margin:[10*e.level,0,0,2]}];r?n.splice(r,0,t):n.push(t)}}})),e.push({layout:"noBorders",table:{dontBreakRows:!0,keepWithHeaderRows:1,headerRows:i,body:n}})}(n[t.groupIndex],r)})),t(e)}),(function(){o([])}))}))}drawQR(){const e=this,t=e.div.querySelector(`.${e.CLASS}-image-qr`);if(!t.disabled&&t.checked){const t=document.querySelector("."+e.CLASS+"-qrcode");return t.innerHTML="",e.makeQRCode(t,v).then((function(t){return t?i.A.addToCanvas(e.canvas,t,{x:e.canvas.width-v,y:e.canvas.height-v},{width:v,height:v}).then((function(e){return e})):e.canvas}))}return e.canvas}generateFileName(){var e=window.location.host+"_",t=this.div.querySelector("."+this.CLASS+"-title").value.trim();return(e+=t||i.A.getFormattedDate((new Date).toString(),!0)).replace(/[\\\/:*?"<>\|]/g,"")+".pdf"}async sharePdf(e){const t=this,r=e.target;r.classList.add(o.A.classes.LOADING),(await t.createPdf()).getBlob((async e=>{const n=new File([e],t.generateFileName(),{type:"application/pdf"}),i={title:n.name,files:[n]};navigator.canShare&&navigator.canShare(i)?navigator.userActivation?.isActive?await navigator.share(i):console.log("este escenario no se contempla salvo que se pare la ejecución entre el click del botón y método share"):t.map.toast(t.getLocaleString("shareFileNotsupported"),{type:o.A.msgType.ERROR}),r.classList.remove(o.A.classes.LOADING)}))}async downloadPdf(e){const t=e.target;t.classList.add(o.A.classes.LOADING);const r=await this.createPdf();await r.download(this.generateFileName()),t.classList.remove(o.A.classes.LOADING)}async createPdf(){const e=this;var t=e.map.getLoadingIndicator(),a=t.addWait();await r.e(7164).then(r.t.bind(r,7164,23));let s=await r.e(7108).then(r.t.bind(r,7108,23));pdfMake.vfs=s.pdfMake.vfs;var l=e.map.wrap.getCanvas();e.canvas=i.A.mergeCanvases(l);var c=m(e.orientation||h,e.format.toString().toUpperCase()||"A4"),u=c.layoutPDF;const d=function(r){var i;try{i=pdfMake.createPdf(r)}catch(t){e.map.toast(e.getLocaleString("print.error"),{type:o.A.msgType.ERROR}),n.A.error(t.message+"  "+t.stack,o.A.msgErrorMode.EMAIL)}return t.removeWait(a),i},p=[e.getLogo,function(){var t=function(e){return e.layoutPDF.content[0].columns[1]}(c);return t.text=e.div.querySelector("."+e.CLASS+"-title").value.trim(),t},e.getScaleBar,e.drawQR],g=await Promise.all(p.map((function(t){return t.apply(e)})));if(g[2].table){const e=c.layoutPDF.pageSize.width-(c.layoutPDF.pageMargins[0]+c.layoutPDF.pageMargins[2]),t=c.layoutPDF.content[0].columns[0].width||0,r=c.layoutPDF.content[0].columns[2],n=r.table.widths[0]+2,i=c.layoutPDF.content[0].columns[1];i.width=e-t-n,0===t&&(i.alignment="left",r.margin[3]=2)}var f=function(e){return e.layoutPDF.content[1].table.body[0][0]}(c),y=g[3]||e.canvas;if(f.image=y.toDataURL(),e.#li()&&2===u.content.length){const t=e.div.querySelector("."+e.CLASS+"-title").value.trim();u.content.push({pageBreak:"before",pageOrientation:e.options.legend&&e.options.legend.orientation||h,text:t.length>0?t:"",fontSize:14,margin:[0,20,0,10]}),u.styles={tablegroup:{bold:!0}},u.defaultStyle={alignment:"left"};const r=await e.getLegend();return u.content=u.content.concat(r),d(u)}return d(u)}manageMaxLengthExceed(e){const t=this,r=t.div.querySelector("."+t.CLASS+"-alert"),n=t.div.querySelector(`.${t.CLASS}-image-qr`);n.disabled=e.qr,n.checked?r.classList.toggle(o.A.classes.HIDDEN,!e.qr):r.classList.add(o.A.classes.HIDDEN)}async generateLink(){const e=this,t=e.div.querySelector(`.${e.CLASS}-div sitna-toggle.${e.CLASS}-image-qr`);t.disabled=!0,t.classList.add(o.A.classes.LOADING);const r=await a.default.prototype.generateLink.call(e);return t.classList.remove(o.A.classes.LOADING),r}getToolsElement(){return this.getContainer().querySelector(`.${this.CLASS}-tools`)}updateModel(){this.model.print=this.getLocaleString("print"),this.model.title=this.getLocaleString("title"),this.model.mapTitle=this.getLocaleString("mapTitle"),this.model.layout=this.getLocaleString("layout"),this.model.landscape=this.getLocaleString("landscape"),this.model.portrait=this.getLocaleString("portrait"),this.model.size=this.getLocaleString("size"),this.model.createQrCodeToImage=this.getLocaleString("createQrCodeToImage"),this.model.appendQRCode=this.getLocaleString("appendQRCode"),this.model.printMap=this.getLocaleString("printMap"),this.model.qrAdvice=this.getLocaleString("qrAdvice"),this.model.layoutTitle=this.getLocaleString("layout"),this.model.sizeTitle=this.getLocaleString("size"),this.toolModel.printpdf=this.getLocaleString("printpdf"),this.toolModel.sharePDF=this.getLocaleString("sharePDF"),this.toolModel.close=this.getLocaleString("close")}async updateLanguage(){this.updateModel()}}E.prototype.CLASS="tc-ctl-prnmap",n.A.control.PrintMap=E;const w=E},5246:(e,t,r)=>{"use strict";r.d(t,{A:()=>h});var n,i,o,a,s,l,c,u=r(8038);u.A.UI=u.A.UI||{},u.A,n=function(e){return"[object Object]"===Object.prototype.toString.call(e)},i=function(){var e={},t=!1,r=0;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],r++);for(var n=function(r){for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t&&"[object Object]"===Object.prototype.toString.call(r[n])?e[n]=i(e[n],r[n]):e[n]=r[n])};r<arguments.length;r++)n(arguments[r]);return e},o=function(e,t,r){var i=[];if(t)if(r.buildHTML)r.target.innerHTML=r.buildHTML({results:t});else{for(var o=0;o<t.length;o++){var s=t[o];n(s)?i.push(`<li><a href="${r.link}${encodeURIComponent(s.id)}">${s.label}</a></li>`):i.push(`<li><a href="${r.link}${encodeURIComponent(s)}">${s}</a></li>`)}var l=document.createElement("template");l.innerHTML=i.join(""),r.target.appendChild(l.content?l.content.firstChild:l.firstChild)}null!==r.callback&&"function"==typeof r.callback&&a(r),e.value.length>0?e.dispatchEvent(new CustomEvent("targetUpdated.autocomplete")):e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},a=function(e){e.target.querySelectorAll("li a").forEach((function(t){t.addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.callback(t)}))}))},s=function(e,t){t.innerHTML="",e.dispatchEvent(new CustomEvent("targetCleared.autocomplete"))},l=function(e){var t,r,i,a,l=e.target;if(l.getAttribute("autocomplete")){var c=this.settings;if((t=l.value).length<c.minLength)s(l,c.target);else if(Array.isArray(c.source))r=c.source.sort().filter((function(e){return a=c.matchFromStart?new RegExp("^"+t,"i"):new RegExp(t,"i"),i=n(e)?e.label:e,a.test(i)})),o(l,r,c);else if("function"==typeof c.source){if(arguments&&arguments[0]&&[37,39].indexOf(arguments[0].keyCode)>-1)return;c.source(t,(function(e){o(l,e,c)}))}}},c={init:function(e){var t=this,r={settings:null};r.settings=i({},r.defaults,e),t.setAttribute("autocomplete",!0);var n=r.settings;return t.removeEventListener("keyup",l),t.addEventListener("keyup",l),t.parentNode.querySelector(".ui-input-clear")&&t.parentNode.querySelector(".ui-input-clear").addEventListener("click",(function(e){s(t,n.target)})),t},update:function(e,t){return this.getAttribute("autocomplete")&&(this.settings=i(this.settings,t)),this},clear:function(e){return this.getAttribute("autocomplete")&&s(this,this.settings.target),this},destroy:function(){return this.getAttribute("autocomplete")&&(s(this,this.settings.target),this.removeAttribute("autocomplete"),this.removeEventListener("keyup",l)),this}},u.A.UI.autocomplete=function(e){return c[e]?c[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:(this.settings=arguments[0],c.init.apply(this,arguments))};const h=u.A.UI.autocomplete},5264:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(8038),i=r(3301),o=r(797);n.A.control=n.A.control||{},n.A.control.infoShare={getDiv:function(e){return e||this._dialogDiv},getShareDialog:async function(e){const t=this,r=t.getDiv(e);return t._shareCtl||(t._shareCtl=await t.map.addControl("share",{id:t.getUID(),div:r.querySelector(".tc-modal-body ."+t.CLASS+"-share-dialog-ctl"),includeControls:!1}),t._shareCtl.caller=t,t._shareCtl.extraParams=null),t._shareCtl},onShowShareDialog:async function(){const e=this;e.toShare=e.toShare||{},e.toShare.doZoom=!0,e.map.trigger(o.A.event.MAPCHANGE);const t=e._shareCtl,r=t.div,n=await t.generateLink(),i=r.querySelector(".tc-url input[type=text]");i.value=n,delete i.dataset.update,delete i.dataset.shortened,r.querySelector(".tc-iframe input[type=text]").value=await t.generateIframe(n)},showShareDialog:function(e){const t=this,r=t.getDiv(e).querySelector("."+t.CLASS+"-share-dialog");i.A.showModal(r,{openCallback:function(){t.onShowShareDialog(r).then((function(){t.map.trigger(o.A.event.DIALOG,{control:t._shareCtl,action:"share"})}))},closeCallback:function(){t.onCloseShareDialog()}})},onCloseShareDialog:function(){const e=this;e.toShare=e.toShare||{},e.toShare.doZoom=!1,e.map.trigger(o.A.event.MAPCHANGE)}};const a=n.A.control.infoShare},5272:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(7735),l=r(3521),c=r(5777),u=r(3791);n.A.control=n.A.control||{};class h{constructor(){this.crs="",this.changeCRS="",this.lat="",this.lon="",this.ele="",this.currentCRS="",this.close=""}}class d{constructor(){this.changeCRS="",this.coordsCurrentProjection="",this.currentCRSName="",this.currentCRSCode="",this.coordsNoCrsWarning="",this.coordsInstructions="",this.coordsInstructionsWarning="",this.cancel="",this.close=""}}class p extends s.default{#Cn;constructor(){super(...arguments);const e=this;e.crs="",e.xy=[0,0,0],e.latLon=[0,0,0],e.x=0,e.y=0,e.lat=0,e.lon=0,e.units=i.A.units.METERS,e.isGeo=!1,e.allowReprojection=!Object.prototype.hasOwnProperty.call(e.options,"allowReprojection")||e.options.allowReprojection,e.#Cn={CRS:e.CLASS+"-crs",GEOCRS:e.CLASS+"-geocrs",MAIN:e.CLASS+"-main",ALTERNATE:e.CLASS+"-alt",XY:e.CLASS+"-xy",X:e.CLASS+"-x",Y:e.CLASS+"-y",LATLON:e.CLASS+"-latlon",LAT:e.CLASS+"-lat",LON:e.CLASS+"-lon",ELEVATION:e.CLASS+"-elevation",ELEVATION_CONTAINER:e.CLASS+"-elev-container",THREEDMARKER:e.CLASS+"-threed"},e.geoCrs=e.options.geoCrs||o.A.geoCrs,e.wrap=new n.A.wrap.control.Coordinates(e),e.model=new h,e.modelDialog=new d}async register(e){const t=this;await super.register.call(t,e),t.crs=t.map.crs,t.clear(),t.model.currentCRS=e.crs,t.modelDialog.currentCRSCode=e.crs;const r=function(e){t.isPointerOver(e)||t.clear()};return e.on(i.A.event.VIEWCHANGE,(function(e){const n=e.view;n!==i.A.view.PRINTING&&(n===i.A.view.THREED?(t.isGeo=!0,t.units=i.A.units.DEGREES,t.crs=t.map.view3D.crs,t.map.view3D.container.addEventListener("mouseout",r),t.map.view3D.on(i.A.event.MOUSEMOVE,(function(e){if(e){if(a.A.detectMobile()&&(t.clear(),t.coordsToClick({coordinate:[e.lon,e.lat,e.ele],cssClass:t.#Cn.THREEDMARKER})),t.latLon=[e.lat,e.lon],e.ele>0){var r=a.A.getMapLocale(t.map);t.latLon.push(e.ele.toLocaleString(r)+"m")}t.update()}else t.clear()}))):n===i.A.view.DEFAULT&&(t.isGeo=t.map.wrap.isGeo(),t.units=i.A.units.METERS,t.crs=t.map.crs,t.map.view3D&&t.map.view3D.container.removeEventListener("mouseout",r)),t.model.currentCRS=t.crs,t.map.view3D&&(t.geoCrs=t.map.view3D.crs,t.render()))})),e.loaded((function(){t.wrap.register(e).then((function(){t.render((function(){t.clear()}))})),a.A.detectMobile()&&t.renderPromise().then((function(){t.getLayer(),t.activateCoords()})),e.on(i.A.event.PROJECTIONCHANGE,(function(r){e.on3DView||(t.isGeo=e.wrap.isGeo(),t.model.currentCRS=t.crs=r.newCrs,a.A.closeModal())})),t.map.wrap.getViewport().then((function(e){t.renderPromise().then((function(){e.addEventListener(i.A.event.MOUSEMOVE,(function(e){t.map.on3DView||t.onMouseMove(e)})),e.addEventListener(i.A.event.MOUSELEAVE,(function(e){t.onMouseLeave(e)}))}))}))})),t}async loadTemplates(){const e=this,t=r.e(3117).then(r.bind(r,3117)),n=r.e(1346).then(r.bind(r,1346)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(e){const t=this,r=await t.getRenderedHtml(t.CLASS+"-dialog",null);t._dialogDiv.innerHTML=r,await super.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo,allowReprojection:t.allowReprojection},(function(){t.addUIEventListeners();const r=t.div.querySelector('sitna-button[icon="close"]');a.A.detectMobile()?r.style.display="":(t.div.classList.remove(i.A.classes.HIDDEN),t.div.style.visibility="visible",r.style.display="none"),a.A.isFunction(e)&&e(),t.controller=new c.A(t.model,new u.A(t.div)),t.controllerModal=new c.A(t.modelDialog,new u.A(t._dialogDiv)),t.updateModel()}))}addUIEventListeners(){const e=this,t=e.div.querySelector("button."+e.#Cn.CRS);t&&t.addEventListener(i.A.event.CLICK,(function(t){e.showProjectionChangeDialog()}),{passive:!0}),a.A.detectMobile()&&e.div.querySelector('sitna-button[icon="close"]').addEventListener("click",(function(){e.div.classList.add(i.A.classes.HIDDEN),e.clear()}))}onMouseMove(e){this.wrap.onMouseMove(e)}onMouseLeave(e){const t=this;setTimeout((function(){t.isPointerOver(e)||(t.div.style.visibility="hidden",t.clear())}),200)}isPointerOver(e){const t=this.div.getBoundingClientRect();return t.left<=e.clientX&&t.left+t.width>=e.clientX&&t.top<=e.clientY&&t.top+t.height>=e.clientY}update(){const e=this;e.renderPromise().then((function(){!e.isGeo&&e.options.showGeo&&(e.latLon=a.A.reproject(e.xy,e.crs,e.geoCrs).reverse());const t=e.div.querySelector(`.${e.#Cn.MAIN}`),r=t.querySelector(`.${e.#Cn.XY}`),n=t.querySelector(`.${e.#Cn.LATLON}`);if(r.classList.toggle(i.A.classes.HIDDEN,e.isGeo),n.classList.toggle(i.A.classes.HIDDEN,!e.isGeo),(e.isGeo||e.options.showGeo)&&(e.lat=a.A.formatCoord(e.latLon[0],i.A.DEGREE_PRECISION),e.lon=a.A.formatCoord(e.latLon[1],i.A.DEGREE_PRECISION)),e.isGeo?(n.querySelector(`.${e.#Cn.LAT}`).innerHTML=e.lat,n.querySelector(`.${e.#Cn.LON}`).innerHTML=e.lon,n.querySelector(`.${e.#Cn.ELEVATION_CONTAINER}`).classList.toggle(i.A.classes.HIDDEN,e.latLon.length<=2)||(e.ele=e.latLon[2],n.querySelector(`.${e.#Cn.ELEVATION}`).innerHTML=e.ele)):(e.x=a.A.formatCoord(e.xy[0],i.A.METER_PRECISION),e.y=a.A.formatCoord(e.xy[1],i.A.METER_PRECISION),e.div.querySelector(`.${e.#Cn.X}`).innerHTML=e.x,e.div.querySelector(`.${e.#Cn.Y}`).innerHTML=e.y,r.querySelector(`.${e.#Cn.ELEVATION_CONTAINER}`).classList.toggle(i.A.classes.HIDDEN,e.xy.length<=2)||(e.ele=e.xy[2],r.querySelector(`.${e.#Cn.ELEVATION}`).innerHTML=e.ele)),!e.isGeo&&e.options.showGeo){const t=e.div.querySelector(`.${e.#Cn.ALTERNATE}`);t.querySelector(`.${e.#Cn.LAT}`).innerHTML=e.lat,t.querySelector(`.${e.#Cn.LON}`).innerHTML=e.lon}a.A.detectMobile()||(e.div.classList.remove(i.A.classes.HIDDEN),e.div.style.visibility="visible")}))}clear(){const e=this;e.div.classList.add(i.A.classes.HIDDEN),e.div.style.visibility="hidden",delete e.currentCoordsMarker,e.getLayer().then((function(e){e.features.length&&e.clearFeatures()}))}deactivateCoords(){const e=this;e.div.classList.add(i.A.classes.HIDDEN),e.clear(),e.wrap.coordsDeactivate()}activateCoords(){this.wrap.coordsActivate()}getCoords(){const e=this,t=e.map.getControlsByClass(l.default);t?.length>0&&t[0].isVisible()?e.coordsToPopup(t[0]):(e.updateCoordsCtrl([(e.map.getExtent()[0]+e.map.getExtent()[2])/2,(e.map.getExtent()[1]+e.map.getExtent()[3])/2]),e.coordsToClick.call(e,{coordinate:e.xy}))}coordsToPopup(e){e&&this.updateCoordsCtrl(e.wrap.popup.getPosition())}updateCoordsCtrl(e){const t=this;e&&(t.isGeo||(t.x=e[0],t.y=e[1],t.xy=[t.x,t.y],e.length>2&&t.xy.push(e[2])),(t.isGeo||t.options.showGeo)&&(t.lat=e[0],t.lon=e[1],t.latLon=[t.lat,t.lon],e.length>2&&t.latLon.push(e[2])),t.update())}coordsToClick(e){const t=this;if(!t.map.div.classList.contains("tc-ctl-sv-active")||!t.map.div.classList.contains(i.A.classes.COLLAPSED)){var r=t.div.getBoundingClientRect();if(r.left<=e.clientX&&e.clientX<=r.right&&r.top<=e.clientY&&e.clientY<=r.bottom)return t.div.classList.add(i.A.classes.HIDDEN),void t.clear();t.div.classList.remove("tc-fading"),setTimeout((function(){t.div.classList.add("tc-fading");let e=0,r=getComputedStyle(t.div).getPropertyValue("animation-duration").match(/^(\d+)(m?s)$/i);r&&(e=parseInt(r[1]),"s"===r[2]&&(e*=1e3)),0!==e&&(clearTimeout(t._markerRemoveTimeout),t._markerRemoveTimeout=setTimeout((()=>{t.currentCoordsMarker&&t.getLayer().then((e=>{e.removeFeature(t.currentCoordsMarker),t.currentCoordsMarker=null}))}),e))}),10),t.updateCoordsCtrl(e.coordinate),t.map.on3DView||t.coordsMarkerAdd(e.coordinate,e.cssClass),t.div.classList.remove(i.A.classes.HIDDEN)}}coordsMarkerAdd(e,t){const r=this;r.currentCoordsMarker?r.currentCoordsMarker.setCoords(e):r.getLayer().then((function(n){n.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:t||i.A.classes.POINT,anchor:[.5,.5]}).then((function(e){r.currentCoordsMarker=e}))}))}async getLayer(){const e=this;return null==e.layer&&(e.layer=await e.map.addLayer({id:e.getUID(),type:i.A.layerType.VECTOR,stealth:!0,owner:e,title:"Coordenadas"}),e.layer.map.putLayerOnTop(e.layer)),e.layer}updateModel(){this.model.crs=this.getLocaleString("crs"),this.model.changeCRS=this.getLocaleString("changeCRS"),this.model.lat=this.getLocaleString("lat"),this.model.lon=this.getLocaleString("lon"),this.model.ele=this.getLocaleString("ele"),this.model.close=this.getLocaleString("close"),this.modelDialog.changeCRS=this.getLocaleString("changeCRS"),this.modelDialog.coordsCurrentProjection=this.getLocaleString("coords.currentProjection"),this.modelDialog.coordsNoCrsWarning=this.getLocaleString("coords.noCrs.warning"),this.modelDialog.coordsInstructions=this.getLocaleString("coords.instructions"),this.modelDialog.coordsInstructionsWarning=this.getLocaleString("coords.instructions.warning"),this.modelDialog.cancel=this.getLocaleString("cancel"),this.modelDialog.close=this.getLocaleString("close")}async updateLanguage(){this.updateModel()}}p.prototype.CLASS="tc-ctl-coords",n.A.control.Coordinates=p;const g=p},5286:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var n=r(8100);const i=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||n.I[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!(!e||!this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!(!this.global_||!e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}}},5357:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var n=r(8038),i=r(3301),o=r(797),a=r(1845),s=r(7018),l=r(1651),c=r(8606),u=r(6257),h=r(6546),d=r(1667),p=r(4583),g=r(4363);n.A.control=n.A.control||{};const f="sitna-download-file";class m extends a.default{displaysElevation;#ci=!1;#ui=null;#Oe;#hi;#fe;usesDtm=!1;static persistenceMode={SAVE:"save",DOWNLOAD:"download"};formats=[o.A.format.KMZ,o.A.format.GML,o.A.format.GEOJSON,o.A.format.WKT,o.A.format.WKB,o.A.format.GPX,o.A.format.SHAPEFILE,o.A.format.GEOPACKAGE];persistenceMode=m.persistenceMode.DOWNLOAD;constructor(){super(...arguments),this.options.title&&(this.title=this.options.title),this.cssClass=this.options.cssClass||"";const e=this.constructor.prototype.CLASS;this.#fe={ELEVATION_CHECKBOX:`.${e}-elev sitna-toggle`,ELEVATION_PANEL:`.${e}-elev-ipt`,ELEVATION_SOURCE_PANEL:`.${e}-elev-src`,SOURCE_RADIO:`.${e}-elev-src input[type=radio]`,INTERPOLATION_PANEL:`.${e}-elev-ip`,INTERPOLATION_RADIO:`.${e}-elev-ip input[type=radio]`,INTERPOLATION_DISTANCE:`.${e}-elev-ip-m`},this.features=[],this.options={}}async loadTemplates(){const e=await r.e(165).then(r.bind(r,165));this.template=e.default}render(e){return super.renderData.call(this,{uid:n.A.getUID(),controlId:this.getId()},e)}addUIEventListeners(){const e=this;if(e.modalBody){const t=e.modalBody;t.querySelectorAll("sitna-button[data-format]").forEach((t=>t.addEventListener(o.A.event.CLICK,(function(t){e.persist({format:t.target.dataset.format})}),{passive:!0}))),e.options?.elevation&&(t.querySelector(e.#fe.ELEVATION_CHECKBOX).addEventListener("change",(function(t){e.displaysElevation=!e.displaysElevation,e.#di()})),e.options.elevation?.resolution&&(t.querySelectorAll(e.#fe.INTERPOLATION_RADIO).forEach((r=>r.addEventListener("change",(function(r){t.querySelector(e.#fe.INTERPOLATION_DISTANCE).classList.toggle(o.A.classes.HIDDEN),e.#ci=!e.#ci,e.#ci&&(t.querySelector(e.#fe.INTERPOLATION_DISTANCE+" input").value=e.#ui||t.querySelector(e.#fe.INTERPOLATION_DISTANCE+" input").value)})))),t.querySelector(e.#fe.INTERPOLATION_DISTANCE).addEventListener("change",(function(t){e.#ui=t.target.value}))),t.querySelectorAll(e.#fe.SOURCE_RADIO).forEach(((t,r)=>t.addEventListener("change",(function(t){e.usesDtm=1===r,e.#di()})))))}}#pi(){return this.getFeatures().some((e=>e instanceof s.A||e instanceof l.A))}#gi(){return this.getFeatures().some((e=>e instanceof c.A||e instanceof u.A))}#fi(){return this.getFeatures().some((e=>e instanceof h.A||e instanceof d.A))}async#mi(e,t={}){const r=this;if(!t.displayElevation){for(const t of e)t.getGeometryStride()>2&&t.removeZ();return e}let n,i=t.elevation&&t.elevation.resolution;if(n=r.usesDtm||i?e:e.map((e=>e.getCoordsArray().every((e=>!e[2]))?e:null)),i||n.some((e=>null!==e))){const i={crs:r.map.getCRS(),features:n,maxCoordQuantity:t.elevation&&t.elevation.maxCoordQuantity,resolution:t.elevation.resolution,sampleNumber:t.elevation.sampleNumber||0},o=await(r.map.elevation||new g.default("boolean"==typeof t.elevation?{}:t.elevation)).setGeometry(i);return o.forEach(((t,r)=>{t||(o[r]=e[r])})),o}return e}async open(e,t={}){const r=this;r.close(),r.hiddenElevationSourceSelection=t.hiddenElevationSourceSelection??!1,r.setFeatures(e);const n=(t=Object.assign({},{controlId:r.getId(),cssClass:r.cssClass,elevation:t.elevation},t)).excludedFormats?t.excludedFormats.slice():[];r.#pi(r)||r.#gi(r)||!r.#fi(r)||n.push(o.A.format.GPX),t.formats??=r.formats.filter((e=>n.indexOf(e)<0)),r.persistenceMode=t.persistenceMode??m.persistenceMode.DOWNLOAD,r.setOptions(t);const a=await r.getRenderedHtml(r.CLASS,t),s=document.createElement("template");s.innerHTML=a,r.modal=s.content?s.content.firstChild:s.firstChild,r.appendChild(r.modal);const l=r.modalBody=r.modal.getElementsByClassName("tc-modal-body")[0];r.#hi=l.querySelector(r.#fe.ELEVATION_SOURCE_PANEL),r.#Oe=l.querySelector(r.#fe.INTERPOLATION_PANEL),t.elevation&&(r.displaysElevation=t.elevation.checked?t.elevation.checked:r.displaysElevation,r.#di()),r.addUIEventListeners();let c={closeCallback:function(){r.modal.parentElement.removeChild(r.modal)}};t.openCallback&&(c.openCallback=t.openCallback),i.A.showModal(r.modal,c)}close(e){const t=this;t.modal&&t.modal.parentElement&&(i.A.closeModal(),t.modal.parentElement.removeChild(t.modal))}#di(){const e=this.getFeatures().some((e=>e.getGeometryStride()>2));e||(this.usesDtm=!0);const t=this.modalBody=this.modal.getElementsByClassName("tc-modal-body")[0];t.querySelector(this.#fe.ELEVATION_CHECKBOX).checked=this.displaysElevation;const r=t.querySelectorAll(this.#fe.INTERPOLATION_RADIO)[this.#ci?1:0];r&&(r.checked=!0),t.querySelector(this.#fe.INTERPOLATION_DISTANCE)?.classList.toggle(o.A.classes.HIDDEN,!this.#ci);const n=t.querySelectorAll(this.#fe.SOURCE_RADIO)[this.usesDtm?1:0];n&&(n.checked=!0),this.#hi?.classList.toggle(o.A.classes.HIDDEN,this.hiddenElevationSourceSelection||!(this.displaysElevation&&e)),this.#Oe?.classList.toggle(o.A.classes.HIDDEN,!this.usesDtm||!this.displaysElevation||!this.#gi()&&!this.#fi());const i=t.querySelector(this.#fe.INTERPOLATION_DISTANCE+" input");i.value=this.#ui||i.value}async persist(e={}){const t=this;if(!e.format)return;var r=t.displaysElevation&&t.#ci?parseFloat(t.modalBody.querySelector(t.#fe.INTERPOLATION_DISTANCE+" input[type=number]").value)||(t.options.elevation||t.map.elevation?.options)?.resolution:0;const a=e.format;let s=t.getFeatures();if(a===o.A.format.GPX&&t.#fi()){if(!n.A.confirm(t.getLocaleString("gpxNotCompatible.confirm")))return;s=s.filter((e=>!(e instanceof h.A||e instanceof d.A)))}const l=t.getOptions();if(a!==o.A.format.GEOJSON&&l.format!==o.A.format.WKT&&a!==o.A.format.GML&&s.some((function(e){for(var t in e.getData())if(e.data[t]instanceof Object)return!0;return!1}))&&!e.acceptedDataDestruction){if(!n.A.confirm(i.A.formatIndexedTemplate(t.getLocaleString("dl.export.complexAttr"),a)))return;e.acceptedDataDestruction=!0}return await t.map.wait((async()=>{let c=null;i.A.closeModal();const u=this.persistenceMode===m.persistenceMode.SAVE&&!!window.showSaveFilePicker;let h=u?s:s.map((e=>{const t=e.clone();return t.setId(e.id),t.layer=e.layer,t}));try{await t.#mi(h,{displayElevation:t.displaysElevation,elevation:t.displaysElevation?Object.assign({},l.elevation||t.map.elevation&&t.map.elevation.options,{resolution:r}):null})}catch(e){return t.open(s,l),e.message===g.default.errors.MAX_COORD_QUANTITY_EXCEEDED?void n.A.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning")):void n.A.error(t.getLocaleString("elevation.error"))}let d,f,y=l.fileName||(l.title?l.title.toLowerCase().replace(/ /g,"_"):"download"),v=l.fileName||y+" "+i.A.getFormattedDate((new Date).toString(),!0);switch(a){case o.A.format.SHAPEFILE:y+=".zip";break;case o.A.format.KMZ:y+=".kmz";break;default:y=null}switch(v=v||n.A.getUID(),a){case o.A.format.SHAPEFILE:d=".zip";break;case o.A.format.GEOPACKAGE:d=".gpkg";break;case o.A.format.KMZ:d=".kmz";break;default:d="."+a.toLowerCase()}v+=d;try{f=await t.map.exportFeatures(h,{fileName:y,format:a,adaptNames:e.adaptNames,acceptTimeLoss:e.acceptTimeLoss})}catch(r){if(r instanceof p.et){const i=t.getLocaleString("fileWrite.fieldNameError",{name:r.cause});if(e.adaptNames)n.A.error(i,[o.A.msgErrorMode.TOAST,o.A.msgErrorMode.CONSOLE]);else if(n.A.confirm(t.getLocaleString("fileWrite.fieldNameWarning"))){const r={...e};r.adaptNames=!0,t.persist(r)}else t.map.toast(i,{type:o.A.msgType.INFO})}else if(r instanceof p.Tp&&!e.acceptTimeLoss&&n.A.confirm(t.getLocaleString("dl.export.timeData",a))){const r={...e};r.acceptTimeLoss=!0,t.persist(r)}return}if(u){const e=async function(e){const t={mode:"readwrite"};let r=await e.queryPermission(t);return"granted"!==r&&(r=await e.requestPermission(t)),r},r=[{accept:{[i.A.getMimeTypeFromUrl(a)]:[d]},description:this.querySelector(`[data-format="${a}"]`).textContent}],l=await window.showSaveFilePicker({types:r,suggestedName:v}),u=await e(l),h=l.name;if(c=l,v=h,"granted"===u){const e=async function(e,r){try{const t=await e.createWritable();return await t.write(r),await t.close(),!0}catch(e){return n.A.error(t.getLocaleString("fileWrite.error"),[o.A.msgErrorMode.TOAST,o.A.msgErrorMode.CONSOLE]),!1}};if(await e(l,f)){const e=(e,t)=>{let r=0;return e.layer&&t.layer&&(r=e.layer.id.localeCompare(t.layer.id)),0===r&&(r=e.id.localeCompare(t.id)),r},r=new Set,n=new Set;s.forEach((e=>e.layer&&r.add(e.layer)));const i=s.sort(e),a=Array.from(r).map((e=>e.features)).flat().sort(e);let c=!0;for(let e=0;e<i.length;e++)if(i[e]!==a[e]){c=!1;break}c&&r.forEach((e=>{n.add(e._fileHandle),e._fileHandle=l,t.map.trigger(o.A.event.VECTORUPDATE,{layer:e})})),n.forEach((e=>{t.map.trigger(o.A.event.FILESAVE,{fileHandle:l,oldFileHandle:e})})),await t.map.addRecentFileEntry({mainHandle:l}),await t.map.refreshMapState(),t.map.toast(t.getLocaleString("fileSaved"),{type:o.A.msgType.INFO})}}}else switch(a){case o.A.format.SHAPEFILE:case o.A.format.KMZ:i.A.downloadBlob(v,f);break;case o.A.format.GEOPACKAGE:i.A.downloadFile(v,"application/geopackage+sqlite3",f);break;default:{const e=o.A.mimeType[a];i.A.downloadFile(v,e,f);break}}return c}))}setFeatures(e){this.features=Array.isArray(e)?e:[e]}getFeatures(){return this.features}setOptions(e){this.options=Object.assign(this.options,e)}getOptions(){return this.options}setPersistenceMode(e){this.persistenceMode=e}}m.prototype.CLASS="tc-ctl-dldlog",customElements.get(f)||customElements.define(f,m),n.A.control.FeatureDownloadDialog=m;const y=m},5637:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(8038),i=r(3408);const o={Map:function(e){var t=this;t.parent=e,t.map=null,t.getMap=function(){return t._promise}},Layer:function(e){var t=this;t.parent=e,t.layer=null,i.A.call(t),t.getLayer=function(){return t.layer?Promise.resolve(t.layer):t._promise},t.setLayer=function(e){t.layer=e}},layer:{Raster:function(){o.Layer.apply(this,arguments)},Vector:function(){o.Layer.apply(this,arguments)}},Control:function(e){this.parent=e},control:{Click:function(){o.Control.apply(this,arguments)},ScaleBar:function(){o.Control.apply(this,arguments)},NavBar:function(){o.Control.apply(this,arguments)},NavBarHome:function(){o.Control.apply(this,arguments)},Coordinates:function(){o.Control.apply(this,arguments)},Search:function(){o.Control.apply(this,arguments)},Measure:function(){o.Control.apply(this,arguments)},OverviewMap:function(){o.Control.apply(this,arguments)},FeatureInfo:function(){o.Control.apply(this,arguments)},Popup:function(){o.Control.apply(this,arguments)},GeometryFeatureInfo:function(){o.Control.apply(this,arguments)},Geolocation:function(){o.Control.apply(this,arguments)},Draw:function(){o.Control.apply(this,arguments)},Modify:function(){o.Control.apply(this,arguments)},OfflineMapMaker:function(){o.Control.apply(this,arguments)},Edit:function(){o.Control.apply(this,arguments)},ResultsPanel:function(){o.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};n.A.inherit(o.Layer,i.A),n.A.inherit(o.layer.Raster,o.Layer),n.A.inherit(o.layer.Vector,o.Layer),n.A.inherit(o.control.Click,o.Control),n.A.inherit(o.control.ScaleBar,o.Control),n.A.inherit(o.control.NavBar,o.Control),n.A.inherit(o.control.NavBarHome,o.Control),n.A.inherit(o.control.Coordinates,o.Control),n.A.inherit(o.control.Measure,o.Control),n.A.inherit(o.control.OverviewMap,o.Control),n.A.inherit(o.control.Popup,o.Control),n.A.inherit(o.control.FeatureInfo,o.control.Click),n.A.inherit(o.control.GeometryFeatureInfo,o.control.Click),n.A.inherit(o.control.Geolocation,o.Control),n.A.inherit(o.control.Draw,o.Control),n.A.inherit(o.control.OfflineMapMaker,o.Control),n.A.inherit(o.control.Edit,o.Control),n.A.inherit(o.control.ResultsPanel,o.Control);const a=o},5777:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(8038);class i{constructor(e,t){this.model=e,this.view=t,Object.getOwnPropertyNames(this.model).forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)&&(this.model["#"+r]=this.model[r],Object.defineProperty(this.model,r,{get:function(){return this["#"+r]},set:function(e){this["#"+r]=e,t[r]=e},enumerable:!0,configurable:!0}),t[r]=e[r]),("function"==typeof e[r]||e[r]instanceof Promise)&&this.view.addListener(e,r,e[r])}))}add(e){const t=this;t.view.add(e),Object.getOwnPropertyNames(t.view).forEach((e=>{const r=Object.getOwnPropertyDescriptor(t.model,e);r.get||r.set||(t.model["#"+e]=t.model[e],Object.defineProperty(t.model,e,{get:function(){return this["#"+e]},set:function(r){this["#"+e]=r,t.view[e]=r},enumerable:!0,configurable:!0})),t.view[e]=t.model[e]}))}setPropertyModel(e,t){const r=this;Object.defineProperty(t,e,{get:function(){return this["#"+e]},set:function(t){this["#"+e]=t,r.view[e]=t},enumerable:!0,configurable:!0})}setAttribute(e,t,r){if(!Object.prototype.hasOwnProperty.call(this.model,e))throw"No existe esta clave en el modelo";{const n=this.model,i=this.view,o=Object.getOwnPropertyDescriptor(n,e);o.get||o.set||(n["#"+e]=n[e],Object.defineProperty(n,e,{get:function(){return this["#"+e]},set:function(t){this["#"+e]=t,i[e]=t},enumerable:!0,configurable:!0})),i.addListener(e,{node:r,attribute:t,get:function(){return r.attributes[t].value},set:function(e){r.setAttribute(t,e)}}),i[e]=n[e]}}}n.A.mvc=n.A.mvc||{},n.A.mvc.Controller=i;const o=i},5794:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(2994);n.A.control=n.A.control||{},n.A.control.CacheBuilder=i.default;const o=n.A.control.CacheBuilder},5874:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(8038),i=r(797),o=r(1256);n.A.control=n.A.control||{};class a extends o.A{#yi={};constructor(){super(...arguments);const e=this;window.addEventListener("error",(function(){return e.reset(),!1}),!1)}async loadTemplates(){const e=await r.e(6223).then(r.bind(r,6223));this.template=e.default}async register(e){const t=this;return await super.register.call(t,e),e.on(i.A.event.BEFORELAYERADD+" "+i.A.event.BEFORELAYERUPDATE+" "+i.A.event.BEFOREFEATURESADD,(function(e){t.startWait(e)})).on(i.A.event.LAYERADD+" "+i.A.event.LAYERERROR+" "+i.A.event.LAYERUPDATE+" "+i.A.event.FEATURESADD,(function(e){t.stopWait(e)})).on(i.A.event.BEFOREFEATUREINFO,(function(){t.addWait(i.A.event.FEATUREINFO)})).on(i.A.event.FEATUREINFO+" "+i.A.event.NOFEATUREINFO+" "+i.A.event.FEATUREINFOERROR,(function(){t.removeWait(i.A.event.FEATUREINFO)})).on(i.A.event.LAYERREMOVE,(function(e){t.endWait(e)})),n.A.isDebug||window.addEventListener("error",(function(e,r,n,i,o){return t.reset(),!1})),t}startWait(e){const t=this,r=e.layer.id;void 0===t.#yi[r]&&(t.#yi[r]=0),t.#yi[r]=t.#yi[r]+1,t.show(),t.map.trigger(i.A.event.STARTLOADING)}stopWait(e){const t=this,r=e.layer.id;var n=t.#yi[r];n>0&&(n=t.#yi[r]=n-1),n||delete t.#yi[r],Object.keys(t.#yi).length||(t.hide(),t.map.trigger(i.A.event.STOPLOADING))}endWait(e){const t=this,r=e.layer.id;t.#yi[r]>0&&delete t.#yi[r],Object.keys(t.#yi).length||(t.hide(),t.map.trigger(i.A.event.STOPLOADING))}reset(e){const t=this;t.#yi={},t.hide(),t.map&&t.map.trigger(i.A.event.STOPLOADING)}addWait(e){const t=e||n.A.getUID();return this.startWait({layer:{id:t}}),t}removeWait(e){this.stopWait({layer:{id:e}})}}a.prototype.CLASS="tc-ctl-load",n.A.control.LoadingIndicator=a;const s=a},5882:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(9687),l=r(5777),c=r(3791);n.A.control=n.A.control||{};const u=function(e,t){return e?(!0===e&&(e={}),o.A.extend(!0,e,t)):e};class h{constructor(){this.selectionBy="",this.selectionByPoint="",this.selectionByLine="",this.selectionByPrecinct="",this.zoomFeatures="",this.downloadFeatures="",this.deleteFeatures="",this.byPoint="",this.byLine="",this.byPrecinct=""}}class d extends s.default{constructor(){super(...arguments);const e=this;e.modes=e.options.modes||{},void 0===e.modes[i.A.geom.POINT]&&(e.modes[i.A.geom.POINT]=!0),void 0===e.modes[i.A.geom.POLYGON]&&(e.modes[i.A.geom.POLYGON]=!0),e.featureInfoControl=null,e.lineFeatureInfoControl=null,e.polygonFeatureInfoControl=null,e.featureInfoControls=[],e.lastCtrlActive=null,e.popup=null,e.exportsState=!1}async register(e){const t=this;t.div.querySelectorAll("input[type=radio]").forEach((function(e){e.checked=!1})),t.model=new h;const r=[a.A.prototype.register.call(t,e)],n=t.options.styles||{},o=t.modes[i.A.geom.POINT],s=t.modes[i.A.geom.POLYLINE],l=t.modes[i.A.geom.POLYGON];return o&&r.push(e.addControl("featureInfo",u(t.modes[i.A.geom.POINT],{id:t.getUID(),displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share})).then((function(e){return t.featureInfoControl=e,t.featureInfoControls.push(e),e}))),t.modes[i.A.geom.POLYLINE]&&r.push(e.addControl("lineFeatureInfo",u(t.modes[i.A.geom.POLYLINE],{id:t.getUID(),active:s.active,displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share,style:s.filterStyle||n.line})).then((function(e){return t.lineFeatureInfoControl=e,t.featureInfoControls.push(e),e}))),t.modes[i.A.geom.POLYGON]&&r.push(e.addControl("polygonFeatureInfo",u(t.modes[i.A.geom.POLYGON],{id:t.getUID(),active:l.active,displayMode:t.options.displayMode,persistentHighlights:t.options.persistentHighlights,share:t.options.share,style:l.filterStyle||n.polygon})).then((function(e){return t.polygonFeatureInfoControl=e,t.featureInfoControls.push(e),e}))),e.on(`${i.A.event.LAYERADD} ${i.A.event.LAYERREMOVE} ${i.A.event.LAYERVISIBILITY}`,(function(e){t.updateUI()})),e.on(`${i.A.event.CONTROLACTIVATE} ${i.A.event.CONTROLDEACTIVATE}`,(function(e){e.control!==t.featureInfoControl&&e.control!==t.lineFeatureInfoControl&&e.control!==t.polygonFeatureInfoControl||t.updateUI()})),e.on(i.A.event.FEATUREADD+" "+i.A.event.FEATURESADD+" "+i.A.event.FEATUREREMOVE,(function(e){t.featureInfoControls.some((t=>t.resultsLayer===e.layer||t.filterLayer===e.layer))&&t.updateUI()})),await Promise.all(r),t.featureInfoControl&&(t.featureInfoControl.activate(),t.lastCtrlActive=t.featureInfoControl),t.updateUI(),t}async loadTemplates(){const e=await r.e(3898).then(r.bind(r,3898));this.template=e.default}render(e){const t=this;var r={controlId:t.id};return t.modes[i.A.geom.POINT]&&(r.pointSelectValue=i.A.geom.POINT),t.modes[i.A.geom.POLYLINE]&&(r.lineSelectValue=i.A.geom.POLYLINE),t.modes[i.A.geom.POLYGON]&&(r.polygonSelectValue=i.A.geom.POLYGON),t.renderData(r,(function(){t.addUIEventListeners(),o.A.isFunction(e)&&e(),new l.A(t.model,new c.A(t.div)),t.updateModel()}))}addUIEventListeners(){const e=this,t=function(){switch(this.value){case i.A.geom.POLYLINE:e.lineFeatureInfoControl.activate(),e.lastCtrlActive=e.lineFeatureInfoControl;break;case i.A.geom.POLYGON:e.polygonFeatureInfoControl.activate(),e.lastCtrlActive=e.polygonFeatureInfoControl;break;default:e.featureInfoControl.activate(),e.lastCtrlActive=e.featureInfoControl}};e.div.querySelectorAll("input[type=radio]").forEach((function(e){e.addEventListener("change",t)})),e.div.querySelector(`.${e.CLASS}-btn-remove`).addEventListener(i.A.event.CLICK,(function(t){e.featureInfoControls.forEach((e=>{e.resultsLayer.features.slice().forEach((t=>e.downplayFeature(t))),e.filterLayer.features.slice().forEach((e=>e.layer.removeFeature(e)))}))}),{passive:!0}),e.div.querySelector(`.${e.CLASS}-btn-dl`).addEventListener(i.A.event.CLICK,(async function(t){const r=await e.getDownloadDialog();let n={title:e.getLocaleString("featureInfo")+" - "+e.getLocaleString("download"),fileName:e._getFileName()};(e.map.elevation||e.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),r.open(Array.prototype.concat.apply([],e.featureInfoControls.map((e=>e.resultsLayer.features))),n)}),{passive:!0}),e.div.querySelector(`.${e.CLASS}-btn-zoom`).addEventListener(i.A.event.CLICK,(function(t){var r=e.featureInfoControls.reduce(((e,t)=>e.concat(t.resultsLayer.features)),[]);e.map.zoomToFeatures(r)}),{passive:!0})}activate(){this.lastCtrlActive&&this.lastCtrlActive.activate()}deactivate(){this.lastCtrlActive.deactivate(!1)}updateUI(){const e=this;e.renderPromise().then((function(){const t=e.map.workLayers.some((e=>e.type===i.A.layerType.WMS&&e.getVisibility()));if(e.div.querySelectorAll("input").forEach((function(e){e.disabled=!t})),e.featureInfoControl){const r=e.div.querySelector(`input[value=${i.A.geom.POINT}]`);r&&(t||!e.lineFeatureInfoControl?.isActive&&!e.polygonFeatureInfoControl?.isActive||e.featureInfoControl.activate(),r.checked=e.featureInfoControl.isActive)}if(e.lineFeatureInfoControl){const t=e.div.querySelector(`input[value=${i.A.geom.POLYLINE}]`);t&&(t.checked=e.lineFeatureInfoControl?.isActive)}if(e.polygonFeatureInfoControl){const t=e.div.querySelector(`input[value=${i.A.geom.POLYGON}]`);t&&(t.checked=e.polygonFeatureInfoControl?.isActive)}const r=e.featureInfoControls.some((e=>e.options.persistentHighlights)),n=e.featureInfoControls.every((e=>!(e.resultsLayer&&0!==e.resultsLayer.features.length||e.filterLayer&&0!==e.filterLayer.features.length))),o=e.div.querySelector(`.${e.CLASS}-btn-remove`);o.classList.toggle(i.A.classes.HIDDEN,!r),o.disabled=n;const a=e.div.querySelector(`.${e.CLASS}-btn-dl`);a.classList.toggle(i.A.classes.HIDDEN,!r),a.disabled=n;const s=e.div.querySelector(`.${e.CLASS}-btn-zoom`);s.classList.toggle(i.A.classes.HIDDEN,!r),s.disabled=n;const l=e.div.style.display;e.div.style.display="none",l?e.div.style.display=l:e.div.style.removeProperty("display")}))}updateModel(){this.model.selectionBy=this.getLocaleString("selectionBy"),this.model.selectionByPoint=this.getLocaleString("selectionByPoint"),this.model.selectionByLine=this.getLocaleString("selectionByLine"),this.model.selectionByPrecinct=this.getLocaleString("selectionByPrecinct"),this.model.zoomFeatures=this.getLocaleString("zoomFeatures"),this.model.downloadFeatures=this.getLocaleString("downloadFeatures"),this.model.deleteFeatures=this.getLocaleString("deleteFeatures"),this.model.byPoint=this.getLocaleString("byPoint"),this.model.byLine=this.getLocaleString("byLine"),this.model.byPrecinct=this.getLocaleString("byPrecinct")}updateLanguage(){this.updateModel()}}d.prototype.CLASS="tc-ctl-m-finfo",n.A.control.MultiFeatureInfo=d;const p=d},5909:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(9687),a=r(6631);n.A.control=n.A.control||{},n.A.filter=a.A;class s extends o.default{constructor(){super(...arguments);const e=this;e.wrap=new n.A.wrap.control.GeometryFeatureInfo(e),e._isDrawing=!1,e._isSearching=!1,e._drawToken=!1}async register(e){const t=this,r=super.register.call(t,e);return t.on(i.A.event.CONTROLDEACTIVATE,(function(e){t.wrap.cancelDraw()})),await r}callback(e,t){const r=this;return new Promise((function(t,n){if(r._drawToken)t();else{r.closeResults(),r.filterFeature&&(r.filterLayer.removeFeature(r.filterFeature),r.filterFeature=null),r.highlightedFeature=null;for(var o=!1,a=0;a<r.map.workLayers.length;a++){var s=r.map.workLayers[a];if(s.type===i.A.layerType.WMS&&s.getVisibility()&&s.names.length>0){o=!0;break}}o?(r.closeResults(),r.wrap.beginDraw({geometryType:r.geometryType,xy:e,layer:r.filterLayer,callback:function(e){r.wrap.getFeaturesByGeometry(e).then(t)}})):t()}}))}sendRequest(e){return this.wrap.getFeaturesByGeometry(e)}responseCallback(e){const t=this;if(super.responseCallback.call(t,e),t.filterFeature){for(var r=e.services,n=0;n<r.length;n++){var o=r[n];if(o.hasLimits)delete o.layers;else{for(var a=0;a<o.layers.length;a++)o.layers[a].features.length||(o.layers.splice(a,1),a-=1);o.layers.length||(r.splice(n,1),n-=1)}}e.coords&&0===e.featureCount?t.popup.hide():t.renderData(e,(function(){r.length&&t.insertLinks(),t.div.querySelector(`.${t.CLASS}-coords`).classList.add(i.A.classes.HIDDEN),t.info&&t.info.services.length?t.displayResults():t.map.toast(t.getLocaleString("query.msgNoResults"),{type:i.A.msgType.INFO})}))}}}n.A.control.GeometryFeatureInfo=s;const l=s},5966:(e,t,r)=>{"use strict";r.d(t,{Uo:()=>R,Qk:()=>N,Tq:()=>$,gR:()=>k,nf:()=>G,Sk:()=>U,iz:()=>q,MM:()=>V,An:()=>z,HY:()=>F,kZ:()=>Y,Xe:()=>H,Bj:()=>j,mj:()=>K,AU:()=>D,Rn:()=>W,or:()=>O,ux:()=>B});var n=r(588),i=r(4442);class o extends i.A{constructor(e,t){super(e),this.conditions=t,(0,n.v)(this.conditions.length>=2,"At least 2 conditions are required")}}const a=o,s=class extends a{constructor(e){super("And",Array.prototype.slice.call(arguments))}};class l extends i.A{constructor(e,t,r){if(super("BBOX"),this.geometryName=e,this.extent=t,4!==t.length)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=r}}const c=l;class u extends i.A{constructor(e,t,r,n){super(e),this.geometryName=t||"the_geom",this.geometry=r,this.srsName=n}}const h=u,d=class extends h{constructor(e,t,r){super("Contains",e,t,r)}},p=class extends h{constructor(e,t,r,n,i){super("DWithin",e,t,i),this.distance=r,this.unit=n}},g=class extends h{constructor(e,t,r){super("Disjoint",e,t,r)}};class f extends i.A{constructor(e,t){super(e),this.propertyName=t}}const m=f,y=class extends m{constructor(e,t,r,n){super(e,t),this.expression=r,this.matchCase=n}},v=class extends y{constructor(e,t,r){super("PropertyIsEqualTo",e,t,r)}},A=class extends y{constructor(e,t){super("PropertyIsGreaterThan",e,t)}},S=class extends y{constructor(e,t){super("PropertyIsGreaterThanOrEqualTo",e,t)}},E=class extends h{constructor(e,t,r){super("Intersects",e,t,r)}},w=class extends m{constructor(e,t,r){super("PropertyIsBetween",e),this.lowerBoundary=t,this.upperBoundary=r}},_=class extends m{constructor(e,t,r,n,i,o){super("PropertyIsLike",e),this.pattern=t,this.wildCard=void 0!==r?r:"*",this.singleChar=void 0!==n?n:".",this.escapeChar=void 0!==i?i:"!",this.matchCase=o}},L=class extends m{constructor(e){super("PropertyIsNull",e)}},C=class extends y{constructor(e,t){super("PropertyIsLessThan",e,t)}},b=class extends y{constructor(e,t){super("PropertyIsLessThanOrEqualTo",e,t)}};class T extends i.A{constructor(e){super("Not"),this.condition=e}}const x=T,P=class extends y{constructor(e,t,r){super("PropertyIsNotEqualTo",e,t,r)}},M=class extends a{constructor(e){super("Or",Array.prototype.slice.call(arguments))}},I=class extends h{constructor(e,t,r){super("Within",e,t,r)}};function R(e){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(s,t))}function O(e){const t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(M,t))}function D(e){return new x(e)}function N(e,t,r){return new c(e,t,r)}function k(e,t,r){return new d(e,t,r)}function F(e,t,r){return new E(e,t,r)}function G(e,t,r){return new g(e,t,r)}function B(e,t,r){return new I(e,t,r)}function U(e,t,r,n,i){return new p(e,t,r,n,i)}function q(e,t,r){return new v(e,t,r)}function W(e,t,r){return new P(e,t,r)}function H(e,t){return new C(e,t)}function j(e,t){return new b(e,t)}function V(e,t){return new A(e,t)}function z(e,t){return new S(e,t)}function Y(e){return new L(e)}function $(e,t,r){return new w(e,t,r)}function K(e,t,r,n,i,o){return new _(e,t,r,n,i,o)}},6014:(e,t,r)=>{"use strict";r.r(t),r.d(t,{crossPoints:()=>s,default:()=>c,xShapePoints:()=>l});var n=r(3301),i=r(3343);const o=function(e,t=0){const r=Math.sqrt(3)/2*e,i=n.A.formatTemplate("{x} {y}",{x:t,y:r+t});return[i,n.A.formatTemplate("{x} {y}",{x:e+t,y:r+t}),n.A.formatTemplate("{x} {y}",{x:e/2+t,y:t}),i]},a=function(e,t=0){const r=e*Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),i=[];for(let o=0;o<10;o++){const a=o*Math.PI/5+Math.PI/2,s=o%2==0?e:r;i.push(n.A.formatTemplate("{x} {y}",{x:e+s*Math.cos(a)+t,y:e-s*Math.sin(a)+t}))}return i};function s(e,t=e*(1/3),r=0){const i=t/2;return[n.A.formatTemplate("{x} {y}",{x:-i+r,y:-i+r}),n.A.formatTemplate("{x} {y}",{x:-i+r,y:-e+r}),n.A.formatTemplate("{x} {y}",{x:i+r,y:-e+r}),n.A.formatTemplate("{x} {y}",{x:i+r,y:-i+r}),n.A.formatTemplate("{x} {y}",{x:e+r,y:-i+r}),n.A.formatTemplate("{x} {y}",{x:e+r,y:i+r}),n.A.formatTemplate("{x} {y}",{x:i+r,y:i+r}),n.A.formatTemplate("{x} {y}",{x:i+r,y:e+r}),n.A.formatTemplate("{x} {y}",{x:-i+r,y:e+r}),n.A.formatTemplate("{x} {y}",{x:-i+r,y:i+r}),n.A.formatTemplate("{x} {y}",{x:-e+r,y:i+r}),n.A.formatTemplate("{x} {y}",{x:-e+r,y:-i+r})]}function l(e){return[{x:-e,y:-e},{x:-e/2,y:-e/2},{x:0,y:0},{x:e/2,y:e/2},{x:e,y:e},{x:e/2,y:-e/2},{x:0,y:0},{x:-e/2,y:e/2},{x:-e,y:-e}]}class c{constructor(e,t){this.height=e,this.width=t}square(e,t,r,o){return n.A.formatTemplate(i.square,{x:(Math.max(this.width,e)-e)/2,y:(Math.max(this.height,e)-e)/2,width:e,height:e,style:r,transform:o})}triangle(e,t,r,a){return n.A.formatTemplate(i.triangle,{points:o(Math.min(this.width,e),(Math.max(this.width,t)-e)/2).join(","),style:r,transform:a})}star(e,t,r,o){return n.A.formatTemplate(i.triangle,{points:a(e/2,(Math.max(this.width,t)-e)/2).join(","),style:r,transform:o})}cross(e,t,r,o){return n.A.formatTemplate(i.triangle,{points:s(e/2,void 0,Math.max(this.width,t)/2).join(","),style:r,transform:o})}circle(e,t,r,o){return n.A.formatTemplate(i.circle,{x:Math.max(this.width,e)/2,y:Math.max(this.height,e)/2,radius:e/2,style:r,transform:o})}}},6031:(e,t,r)=>{"use strict";r.d(t,{B:()=>a}),r(5966);var n=r(4442),i=r(7825),o=r(3365);n.A.prototype.getFilterText=function(e){return e instanceof o.A?(new i.A).writeGetFeature({srsName:e.map.getCrs(),featureTypes:e.availableNames,filter:this}).querySelector("Filter").outerHTML:new i.A({version:e.version||null}).writeGetFeature(Object.assign({},e,{filter:this})).querySelector("Filter").outerHTML},n.A.prototype.getGeatureText=function(e){return e instanceof o.A?(new i.A).writeGetFeature({srsName:e.map.getCrs(),featureTypes:e.availableNames,filter:this}).outerHTML:new i.A({version:e.version||null}).writeGetFeature(Object.assign({},e,{filter:this})).outerHTML};const a=n.A},6052:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var n=r(1845),i=r(8038),o=r(9566),a=r(7018),s=r(8606),l=r(6546),c=r(1651),u=r(6257),h=r(1667),d=r(187),p=r(797),g=r(3301),f=r(5777),m=r(3791);i.A.control=i.A.control||{};const y="sitna-measurement";class v{constructor(){this["2dLength"]="",this.area="",this["2dPerimeter"]="",this.deactivateElevationProfile="",this.activateElevationProfile="",this.ele="",this.latitude="",this.latitude="",this.perimeterValue="",this.areaValue="",this.lengthValue=""}}class A extends n.default{static units={m:{weight:0,abbr:"m²"},dam:{weight:1,abbr:"dam²;",precision:2},hm:{weight:2,abbr:"hm²",precision:2},ha:{weight:2,abbr:"ha",precision:3},km:{weight:3,abbr:"km²",precision:3}};NOMEASURE="-";#vi;#Ai;#Si;#Ei;#wi;#_i;#Li;#Ci;#bi;#Ti;#xi;#Pi={};constructor(){super(...arguments),this.initProperty("enabledProfile").initProperty("mode").initProperty("units"),this.model=new v}static get observedAttributes(){return["mode","enabled-profile","geographic"]}attributeChangedCallback(e,t,r){if(t===r)return;"enabled-profile"===e&&this.#Mi(),"mode"===e&&this.#h()}get enabledProfile(){return this.hasAttribute("enabled-profile")}set enabledProfile(e){this.toggleAttribute("enabled-profile",!!e)}#Mi(){this.render()}get mode(){return this.getAttribute("mode")}set mode(e){e?this.setAttribute("mode",e):this.removeAttribute("mode")}#h(){this.render()}async setMode(e){const t=this;return t.mode===e?await t.renderPromise():(t.mode=e,await t.render()),e}get units(){const e=this.getAttribute("units");return e?e.split(","):["m","km"]}set units(e){Array.isArray(e)?this.setAttribute("units",e.join()):this.setAttribute("units",e)}get geographic(){return this.hasAttribute("geographic")}set geographic(e){this.toggleAttribute("geographic",!!e)}async loadTemplates(){const e=await r.e(9448).then(r.bind(r,9448));this.template=e.default}async render(e){const t=this,r={enabledProfile:t.enabledProfile},n=t.mode;n&&(r[n]=!0),await t.renderData(r),t.#Ai=t.querySelector(`.${t.CLASS}-val-coord-1-t`),t.#vi=t.querySelector(`.${t.CLASS}-val-coord-1-v`),t.#Ei=t.querySelector(`.${t.CLASS}-val-coord-2-t`),t.#Si=t.querySelector(`.${t.CLASS}-val-coord-2-v`),t.#wi=t.querySelector(`.${t.CLASS}-val-crs`),t.#_i=t.querySelector(`.${t.CLASS}-val-coord-ele-t`),t.#Li=t.querySelector(`.${t.CLASS}-val-coord-ele-v`),t.#xi=t.querySelector("sitna-toggle.tc-ctl-msmt-prof-btn"),t.addUIEventListeners(),t.clearMeasurement(),g.A.isFunction(e)&&e(),t.controller=new f.A(t.model,new m.A(t)),t.updateModel()}addUIEventListeners(){const e=this;return e.#xi?.addEventListener("change",(function(t){const r=e.containerControl;t.target.checked?(r.activateElevationProfile(),t.target.setAttribute("text",e.getLocaleString("deactivateElevationProfile"))):(r.deactivateElevationProfile(),t.target.setAttribute("text",e.getLocaleString("activateElevationProfile")))}),{passive:!0}),e}getFeatureMeasurementData(e){const t=this,r={units:"m"},n={crs:t.map.options.utmCrs};switch(!0){case e instanceof l.A:case e instanceof h.A:r.area=e.getArea(n),r.perimeter=e.getLength(n);break;case e instanceof s.A:case e instanceof u.A:r.length=e.getLength(n);break;case e instanceof a.A:case e instanceof c.A:r.coordinates=e instanceof a.A?e.geometry:e.geometry[0],t.map&&t.geographic&&!t.map.wrap.isGeo()&&(r.coordinates=g.A.reproject(r.coordinates,t.map.crs,d.A.geoCrs)),r.units=t.geographic||t.map.wrap.isGeo()?"degrees":"m"}return r}setFeatureMeasurementData(e){const t={};switch(!0){case e instanceof a.A:Object.prototype.hasOwnProperty.call(this.#Pi,"coord1")&&Object.prototype.hasOwnProperty.call(this.#Pi,"coord2")&&(t.CRS=this.map.getCRS(),t[this.#Ii()]=this.#Pi.coord1,t[this.#Ri()]=this.#Pi.coord2,e.setData(t));break;case e instanceof s.A:Object.prototype.hasOwnProperty.call(this.#Pi,"length")&&(t[this.#Oi()]=this.#Pi.length,e.setData(t));break;case e instanceof l.A:Object.prototype.hasOwnProperty.call(this.#Pi,"area")&&Object.prototype.hasOwnProperty.call(this.#Pi,"perimeter")&&(t[this.#Di()]=this.#Pi.area,t[this.#Ni()]=this.#Pi.perimeter,e.setData(t))}return this}#Ii(){const e=this.#ki().coord1Text;return e.substring(0,e.indexOf(":"))}#Ri(){const e=this.#ki().coord2Text;return e.substring(0,e.indexOf(":"))}#Oi(){return this.getLocaleString("2dLength")}#Ni(){return this.getLocaleString("2dPerimeter")}#Di(){return this.getLocaleString("area")}getFeatureMeasurementMetadata(){const e=e=>({name:e,type:p.A.dataType.FLOAT});return t=>{const r=[],n=t.getGeometryType();let i="Measurement";switch(n){case p.A.geom.POINT:i=this.getLocaleString("point"),r.push({name:"CRS",type:p.A.dataType.STRING}),r.push(e(this.#Ii())),r.push(e(this.#Ri()));break;case p.A.geom.POLYLINE:i=this.getLocaleString("line"),r.push(e(this.#Oi()));break;case p.A.geom.POLYGON:i=this.getLocaleString("polygon"),r.push(e(this.#Di())),r.push(e(this.#Ni()))}return{origin:"Measurement",name:i,geometries:[{name:"geometry",type:n}],attributes:r}}}#ki(e={}){const t=e.units??"m",r={};return r.coord1Text="m"===t?"x: ":"lat: ",r.coord2Text="m"===t?"y: ":"lon: ",r}displayMeasurement(e){const t=this;let r,n,i,a=e;e instanceof o.A&&(i=e,a=t.getFeatureMeasurementData(e)),t.currentFeature=i,t.#Pi={};let s=a.units;if(a.coordinates){t.#Pi=t.#ki(a),r=p.A.geom.POINT;const e=function(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r};"m"===s?(n=p.A.METER_PRECISION,t.#Pi.coord1=a.coordinates[0],t.#Pi.coord2=a.coordinates[1]):(n=p.A.DEGREE_PRECISION,t.#Pi.coord1=a.coordinates[1],t.#Pi.coord2=a.coordinates[0],t.#Pi.coord1Tooltip=t.getLocaleString("latitude"),t.#Pi.coord2Tooltip=t.getLocaleString("longitude")),t.#Pi.coord1=e(t.#Pi.coord1,n),t.#Pi.coord2=e(t.#Pi.coord2,n),t.#Pi.crs=t.geographic?"":`(${t.map.getCRS()})`,a.coordinates.length>2&&(t.#Pi.elevation=Math.round(a.coordinates[2]),t.#Pi.elevationText=t.getLocaleString("ele").toLowerCase()+": ",t.#Pi.elevationTooltip=t.getLocaleString("elevation"))}else Object.prototype.hasOwnProperty.call(a,"area")?(r=p.A.geom.POLYGON,t.#Pi.area=a.area,t.#Pi.perimeter=a.perimeter):(r=p.A.geom.POLYLINE,t.#Pi.length=a.length);return t.setMode(r).then((function(){const e=t.map.options.locale||d.A.locale;if(r===p.A.geom.POLYGON){let r=t.#Pi.area;t.units.forEach((function(n,i,o){const a=n.trim(),s=A.units[a].weight-A.units.m.weight;let l=A.units[a].precision?A.units[a].precision:0;(1===o.length||r>=Math.pow(100,s)/Math.pow(10,l?l-1:l))&&(t.model.areaValue=g.A.formatNumber((r/Math.pow(100,s)).toFixed(l),e)+" "+A.units[n].abbr)}));let i=t.#Pi.perimeter;i>1e3&&(i/=1e3,s="km"),n="m"===s?0:3,t.model.perimeterValue=g.A.formatNumber(i.toFixed(n),e)+" "+s}else if(r===p.A.geom.POLYLINE){let r=t.#Pi.length;r>1e3&&(r/=1e3,s="km"),n="m"===s?0:3,t.model.lengthValue=g.A.formatNumber(r.toFixed(n),e)+" "+s}else if(r===p.A.geom.POINT){const r=(e,t)=>{t?e.setAttribute("title",t):e.removeAttribute("title")};t.#Ai.innerHTML=t.#Pi.coord1Text,r(t.#Ai,t.#Pi.coord1Tooltip),t.#Ei.innerHTML=t.#Pi.coord2Text,r(t.#Ei,t.#Pi.coord2Tooltip),t.#vi.innerHTML=g.A.formatNumber(t.#Pi.coord1.toFixed(n),e),t.#vi.dataset.value=t.#Pi.coord1,t.#Si.innerHTML=g.A.formatNumber(t.#Pi.coord2.toFixed(n),e),t.#Si.dataset.value=t.#Pi.coord2,t.#wi.innerHTML=t.#Pi.crs,t.#wi.dataset.value=t.#Pi.crs,Object.prototype.hasOwnProperty.call(t.#Pi,"elevation")?(t.#_i.innerHTML=t.#Pi.elevationText,t.#Li.innerHTML=g.A.formatNumber(t.#Pi.elevation.toFixed(p.A.METER_PRECISION),e)+" m",t.#Li.dataset.value=t.#Pi.elevation):(t.#_i.innerHTML="",t.#Li.innerHTML="",t.#Li.dataset.value=""),r(t.#_i,t.#Pi.elevationTooltip)}})),t}getFormattedCoordinates(){}clearMeasurement(){const e=this;e.#vi&&(e.#vi.innerHTML=e.NOMEASURE),e.#Si&&(e.#Si.innerHTML=e.NOMEASURE),e.#wi&&(e.#wi.innerHTML=""),e.#_i&&(e.#_i.innerHTML=""),e.#Li&&(e.#Li.innerHTML=""),e.#Ci&&(e.#Ci.innerHTML=e.NOMEASURE),e.#bi&&(e.#bi.innerHTML=e.NOMEASURE),e.#Ti&&(e.#Ti.innerHTML=e.NOMEASURE)}clear(){this.mode=null}updateModel(){this.model["2dLength"]=this.getLocaleString("2dLength"),this.model.area=this.getLocaleString("area"),this.model["2dPerimeter"]=this.getLocaleString("2dPerimeter"),this.model.deactivateElevationProfile=this.getLocaleString("deactivateElevationProfile"),this.model.activateElevationProfile=this.getLocaleString("activateElevationProfile"),this.model.ele=this.getLocaleString("ele")+": ",this.model.latitude=this.getLocaleString("latitude"),this.model.latitude=this.getLocaleString("longitude")}async updateLanguage(){const e=this;var t;if(e.updateModel(),e.containerControl?.pointDrawControl?.mode==e.mode?t=e.containerControl.pointDrawControl:e.containerControl?.lineDrawControl?.mode==e.mode?t=e.containerControl.lineDrawControl:e.containerControl?.polygonDrawControl?.mode==e.mode&&(t=e.containerControl.polygonDrawControl),!t)return;const r=await t.getLayer();if(r?.features.length){const t=r.features.filter((t=>t.STYLETYPE===e.mode));t&&t.length&&e.displayMeasurement(t[0])}}}A.prototype.CLASS="tc-ctl-msmt",customElements.get(y)||customElements.define(y,A),i.A.control.Measurement=A;const S=A},6083:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(8038),i=r(1126),o=r(1256);n.A.control=n.A.control||{},n.A.wrap=i.A;class a extends o.A{constructor(){super(...arguments);const e=this;e.options&&e.options.callback&&(e.callback=e.options.callback),e.wrap=new n.A.wrap.control.Click(e)}register(e){return this.wrap.register(e),super.register.call(this,e)}activate(){const e=this;e.wrap&&e.wrap.activate(),super.activate.call(e)}deactivate(){const e=this;e.wrap&&e.wrap.deactivate(),super.deactivate.call(e)}callback(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")}}a.prototype.CLASS="tc-ctl-click",n.A.control.Click=a;const s=a},6128:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var n=r(6717),i=r(2096),o=r(2497),a=r(3530),s=r(7947),l=r(4778),c=r(8217),u=r(2283);class h extends u.A{constructor(e){e=e||{},super(),this.dataProjection=(0,s.Jt)(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=(0,s.Jt)(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let r=null;r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const i=d(r.geometry);if(this.featureClass===l.Ay)return(0,c.Bs)({geometry:i,id:r.id,properties:r.properties},t);const o=new n.A;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&r.geometry_name&&o.setGeometryName(r.geometry_name),o.setGeometry((0,c.te)(i,t)),"id"in r&&o.setId(r.id),r.properties&&o.setProperties(r.properties,!0),o}readFeaturesFromObject(e,t){let r=null;if("FeatureCollection"===e.type){r=[];const n=e.features;for(let e=0,i=n.length;e<i;++e){const i=this.readFeatureFromObject(n[e],t);i&&r.push(i)}}else r=[this.readFeatureFromObject(e,t)];return r.flat()}readGeometryFromObject(e,t){return function(e,t){const r=d(e);return(0,c.te)(r,t)}(e,t)}readProjectionFromObject(e){const t=e.crs;let r;if(t)if("name"==t.type)r=(0,s.Jt)(t.properties.name);else{if("EPSG"!==t.type)throw new Error("Unknown SRS type");r=(0,s.Jt)("EPSG:"+t.properties.code)}else r=this.dataProjection;return r}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},n=e.getId();if(void 0!==n&&(r.id=n),!e.hasProperties())return r;const i=e.getProperties(),o=e.getGeometry();return o&&(r.geometry=p(o,t),delete i[e.getGeometryName()]),(0,a.p)(i)||(r.properties=i),r}writeFeaturesObject(e,t){t=this.adaptOptions(t);const r=[];for(let n=0,i=e.length;n<i;++n)r.push(this.writeFeatureObject(e[n],t));return{type:"FeatureCollection",features:r}}writeGeometryObject(e,t){return p(e,this.adaptOptions(t))}}function d(e,t){if(!e)return null;let r;switch(e.type){case"Point":r=function(e){const t=e.coordinates;return{type:"Point",flatCoordinates:t,layout:(0,i.p0)(t.length)}}(e);break;case"LineString":r=function(e){const t=e.coordinates,r=t.flat();return{type:"LineString",flatCoordinates:r,ends:[r.length],layout:(0,i.p0)(t[0]?.length||2)}}(e);break;case"Polygon":r=function(e){const t=e.coordinates,r=[],n=t[0]?.[0]?.length;return{type:"Polygon",flatCoordinates:r,ends:(0,o.KG)(r,0,t,n),layout:(0,i.p0)(n)}}(e);break;case"MultiPoint":r=function(e){const t=e.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:(0,i.p0)(t[0]?.length||2)}}(e);break;case"MultiLineString":r=function(e){const t=e.coordinates,r=t[0]?.[0]?.length||2,n=[];return{type:"MultiLineString",flatCoordinates:n,ends:(0,o.KG)(n,0,t,r),layout:(0,i.p0)(r)}}(e);break;case"MultiPolygon":r=function(e){const t=e.coordinates,r=[],n=t[0]?.[0]?.[0].length||2;return{type:"MultiPolygon",flatCoordinates:r,ends:(0,o.d6)(r,0,t,n),layout:(0,i.p0)(n)}}(e);break;case"GeometryCollection":r=function(e){const t=e.geometries.map((function(e){return d(e)}));return t}(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return r}function p(e,t){const r=(e=(0,c.hX)(e,!0,t)).getType();let n;switch(r){case"Point":n=function(e){return{type:"Point",coordinates:e.getCoordinates()}}(e);break;case"LineString":n=function(e){return{type:"LineString",coordinates:e.getCoordinates()}}(e);break;case"Polygon":n=function(e,t){let r;return t&&(r=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"MultiPoint":n=function(e){return{type:"MultiPoint",coordinates:e.getCoordinates()}}(e);break;case"MultiLineString":n=function(e){return{type:"MultiLineString",coordinates:e.getCoordinates()}}(e);break;case"MultiPolygon":n=function(e,t){let r;return t&&(r=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(r)}}(e,t);break;case"GeometryCollection":n=function(e,t){delete(t=Object.assign({},t)).featureProjection;return{type:"GeometryCollection",geometries:e.getGeometriesArray().map((function(e){return p(e,t)}))}}(e,t);break;case"Circle":n={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+r)}return n}const g=h},6257:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(797),i=r(9566),o=r(8606);class a extends i.A{STYLETYPE="line";constructor(e,t){super(e,t),this.wrap.isNative(e)||this.wrap.createMultiPolyline(e,t)}getCoordinates(e){return e?.pointArray?this.getCoordsArray():super.getCoordinates.call(this,e)}setCoordinates(e){return Array.isArray(e)&&Array.isArray(e[0])&&!Array.isArray(e[0][0])&&(e=[e]),super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat()}appendPolyline(e){if(e instanceof o.A){const t=this.getCoordinates();t.push(e.getCoordinates()),this.setCoordinates(t)}return this}getLength=function(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})};getGeometryType(){return n.A.geom.MULTIPOLYLINE}}const s=a},6361:(e,t,r)=>{"use strict";function n(e,t,r,n,i){i=void 0!==i?i:[];let o=0;for(let a=t;a<r;a+=n)i[o++]=e.slice(a,a+n);return i.length=o,i}function i(e,t,r,i,o){o=void 0!==o?o:[];let a=0;for(let s=0,l=r.length;s<l;++s){const l=r[s];o[a++]=n(e,t,l,i,o[a]),t=l}return o.length=a,o}function o(e,t,r,n,o){o=void 0!==o?o:[];let a=0;for(let s=0,l=r.length;s<l;++s){const l=r[s];o[a++]=1===l.length&&l[0]===t?[]:i(e,t,l,n,o[a]),t=l[l.length-1]}return o.length=a,o}r.d(t,{Dz:()=>o,cD:()=>i,n2:()=>n})},6378:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A});var n=r(8038),i=r(797),o=r(3301),a=r(2773),s=r(4370),l=(r(2902),r(3967)),c=r(6792),u=r(575),h=r(9239),d=r(5112),p=r(5777),g=r(3791);n.A.control=n.A.control||{},i.A.classes.DRAG=i.A.classes.DRAG||"tc-drag",i.A.classes.DRAGEND=i.A.classes.DRAGEND||"tc-dragend",i.A.event.TOOLSOPEN=i.A.event.TOOLSOPEN||"toolsopen.tc";class f{constructor(){this.loadedLayers="",this.removeAllLayersFromMap="",this.noData=""}}class m{constructor(){this.infoFromThisLayer="",this.visibilityOfThisLayer="",this.zoomToLayerExtent="",this.removeLayerFromMap="",this.otherTools="",this.transparencyOfThisLayer="",this.abstract="",this.content="",this.metadata="",this.dragToReorder=""}}class y{constructor(){this.singleLayer="",this.groupLayerThatContains=""}}class v extends a.default{CLICKEVENT="click";#Fi;constructor(){super(...arguments);const e=this;e.layers=[],e.hidePath=e.options.hidePath||!1,e._uiElementSelector=`ul > li.${e.CLASS}-elm`,e._toolContainerSelector=`.${e.CLASS}-tools`,e.model=new f,e.addItemTool({renderFn:function(t,r){const n=e.CLASS+"-btn-dl";let i=t.querySelector("sitna-button."+n);if(!i&&e.map.getLayer(r)instanceof c.A){const t=e.getLocaleString("downloadFeatures");i=new s.A,i.variant=s.A.variant.MINIMAL,i.text=t,i.icon=s.A.action.DOWNLOAD_ALL,i.setAttribute("title",t),i.dataset.layerId=r}return i},actionFn:function(){var t=this;do{t=t.parentElement}while(t&&"LI"!==t.tagName);const r=e.map.getLayer(this.dataset.layerId);e.getDownloadDialog().then((function(t){const n=r.title||"",i={title:`${n} - ${e.getLocaleString("downloadFeatures")}`,fileName:/\.[a-z0-9]+$/i.test(n)?n.substr(0,n.lastIndexOf(".")):n,elevation:e.map.elevation&&e.map.elevation.options};t.open(r.features,i)}))}}),e.groupModel=new y,e.nodeModel=new m}async loadTemplates(){const e=this,t=r.e(4955).then(r.bind(r,4955)),n=r.e(6572).then(r.bind(r,6572)),i=r.e(4329).then(r.bind(r,4329)),o=r.e(4462).then(r.bind(r,4462)),a=r.e(2147).then(r.bind(r,2147)),s={};s[e.CLASS]=(await t).default,s[e.CLASS+"-elm"]=(await n).default,s[e.CLASS+"-type-sgl"]=(await i).default,s[e.CLASS+"-type-grp"]=(await o).default,s[e.CLASS+"-type-grp-node"]=(await a).default,e.template=s}async render(e,t){const i=this;if(!i.map)throw Error("Cannot render: control has no map");await i.renderData(t?o.A.extend(i.map.getLayerTree(),t):i.map.getLayerTree()),i.addUIEventListeners();const a=(await r.e(246).then(r.bind(r,246))).default;i.map.workLayers.filter((function(e){return!e.stealth})).forEach((function(e){t?.refresh&&(e.renderOptions?(e.renderOptions.hide=!e.getVisibility(),e.renderOptions.opacity=e.getOpacity()):e.renderOptions={hide:!e.getVisibility(),opacity:e.getOpacity()}),i.updateLayerTree(e,t?.refresh||!1)}));const s=i.div.querySelector("ul");i.#Fi=a.create(s,{handle:"."+i.CLASS+"-dd",animation:150,onSort:function(e){i.#Gi(e.item,e.oldIndex,e.newIndex)}}),s.addEventListener("keydown",n.A.EventTarget.listenerBySelector("li",(function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const r=function(e,r){const n=i.#Fi.toArray(),o=n[e];n[e]=n[r],n[r]=o,i.#Fi.sort(n),i.#Gi(t,e,r)},n=i.getLayerUIElements(),o=n.indexOf(t);switch(!0){case/Up$/.test(e.key):o>0&&(r(o,o-1),t.focus(),e.stopPropagation());break;case/Down$/.test(e.key):o<n.length-1&&(r(o,o+1),t.focus(),e.stopPropagation());break;case/Enter$/.test(e.key):t.blur(),e.stopPropagation()}}))),i.controller=new p.A(i.model,new g.A(i.div)),o.A.isFunction(e)&&e()}async register(e){const t=this;return await super.register(e),t.options.fileEditing&&(t.fileEdit=await e.addControl("fileEdit",{caller:t,snapping:!0})),t.updateModel(),e.loaded((function(){t.updateScale()})),e.on(i.A.event.LAYEROPACITY,(function(e){const r=t.#Bi(e.layer);r&&(r.querySelector("input[type=range]").value=Math.round(100*e.opacity))})).on(i.A.event.FEATURESIMPORT,(function(r){var n=r.fileName;if(r.features&&r.features.length>0){var o="."+i.A.format.GPX.toLowerCase();if(r.fileName.toLowerCase().indexOf(o)===r.fileName.length-o.length)return;e.one(i.A.event.LAYERADD,(function(e){e&&e.layer&&e.layer.title===n&&(t.highlight(),t.map.trigger(i.A.event.TOOLSOPEN))}))}})),e.magnifier||(e.magnifier=new d.default(3,{textToOpen:o.A.getLocaleString(e.options.locale,"clickToEnlarge"),textToClose:o.A.getLocaleString(e.options.locale,"clickToClose")}),document.body.appendChild(e.magnifier)),t}onExternalServiceAdded(e){}addUIEventListeners(){const e=this;e.div.addEventListener("change",n.A.EventTarget.listenerBySelector(`sitna-toggle.${e.CLASS}-cb-visibility`,(function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&!n.matches("li."+e.CLASS+"-elm"));e.map.getLayer(n.dataset.layerId).setVisibility(r.checked),t.stopPropagation()})));const t=function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);e.map.getLayer(n.dataset.layerId).setOpacity(r.value/100)};return e.div.addEventListener("change",n.A.EventTarget.listenerBySelector("input[type=range]",t)),e.div.addEventListener("input",n.A.EventTarget.listenerBySelector("input[type=range]",t)),e.div.addEventListener("change",n.A.EventTarget.listenerBySelector(`.${e.CLASS}-cb-info`,(function(t){const r=t.target;var n=r;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const o=n.querySelector("."+e.CLASS+"-info"),a=e.map.getLayer(n.dataset.layerId);o.querySelectorAll("."+e.CLASS+"-legend img, ."+e.CLASS+"-custom-legend img").forEach((async function(t){e.styleLegendImage(t,a)})),o.classList.toggle(i.A.classes.HIDDEN,!r.checked)}))),e.div.addEventListener(e.CLICKEVENT,n.A.EventTarget.listenerBySelector(`.${e.CLASS}-btn-del:not(:disabled)`,(function(t){var r=t.target;do{r=r.parentElement}while(r&&"LI"!==r.tagName);const n=e.map.getLayer(r.dataset.layerId);e.map.removeLayer(n)}))),e.div.addEventListener(e.CLICKEVENT,n.A.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",(function(t){n.A.confirm(e.getLocaleString("layersRemove.confirm"),(function(){e.getLayerUIElements().map((function(t){return e.map.getLayer(t.dataset.layerId)})).forEach((function(t){e.map.removeLayer(t)}))})),t.stopPropagation()}))),e.div.addEventListener(e.CLICKEVENT,n.A.EventTarget.listenerBySelector(`.${e.CLASS}-btn-more`,(function(t){const r=t.target,n=r.parentElement.classList.toggle("tc-expanded");r.text=e.getLocaleString(n?"collapse":"otherTools"),r.iconText=n?"⯇":"•••"}))),e}updateLayerVisibility(e){const t=this,r=t.#Bi(e);if(r){const n=e.getVisibility();r.querySelector(`sitna-toggle.${t.CLASS}-cb-visibility`).checked=n}}updateLayerTree(e,t){const r=this;if(!e.isBase&&!e.options.stealth){l.default.prototype.updateLayerTree.call(r,e);for(var o=!1,a=0,s=r.layers.length;a<s;a++)if(e===r.layers[a]){o=!0;break}if(!o||t){t||r.layers.push(e);const o=e.title||e.wrap.getServiceTitle&&e.wrap.getServiceTitle();e._title=o;var c={title:e.hideTitle?"":o,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable,id:e.id},u=e.isRaster();if(u){c.hasExtent=!!e.getExtent(),c.layerNames=e.layerNames;const t=e.names.map((t=>e.getPath(t)));t.forEach((e=>e.shift())),r.hidePath||(c.path=t),c.legend=[],c.abstract=[],c.metadata=[],e.names.forEach((function(t){var r=e.getInfo(t);r.legend&&c.legend.push(r.legend),r.abstract&&c.abstract.push(r.abstract),r.metadata&&c.metadata.push(r.metadata)}));const n=e.getInfo();c.hasInfo=Object.prototype.hasOwnProperty.call(n,"abstract")||Object.prototype.hasOwnProperty.call(n,"legend")||Object.prototype.hasOwnProperty.call(n,"metadata")}else c.hasExtent=!0,c.hasInfo=!1,c.path=[e.getPath()];(async function(e){if(e&&e.options.method&&"POST"===e.options.method)try{return await e.getLegendGraphicImage()}catch(e){n.A.error(e)}})(e).then((async function(t){try{if(e.availableNames?.some((t=>e.getInfo(t).legend.length))){const t=e.getLegend?await e.getLegend(!0):null;if(t){const r=t;for(var n=0;n<(r?.length||0);n++)for(var o=0;o<(r[n]?.length||0);o++){let t=o+n;c.legend[0][t]||(c.legend[0][t]={}),r[n][o].rules?c.legend[0][t].symbols=(await(0,h.CreateSymbolizer)(r[n][o].rules,e)).map((e=>({src:e.src,title:e.value}))):r[n][o].src&&(c.legend[0][t]={src:r[n][o].src,title:r[n][o].title||r[n][o].name})}}}}catch(e){console.info(e)}r.getRenderedHtml(r.CLASS+"-elm",c).then((function(t){const n=(new DOMParser).parseFromString(t,"text/html").body.firstChild;var o,a,s=!1;if(u&&!(s=e.names.length>1)){const t=e.names[0],r=e.wrap.getAllLayerNodes();for(a=0;a<r.length;a++){var l=r[a];if(e.wrap.getName(l)===t){o=l,e.wrap.getLayerNodes(l).length>0&&(s=!0);break}}}const c=n.querySelector("."+r.CLASS+"-type"),h=s?r.CLASS+"-type-grp":r.CLASS+"-type-sgl";c.classList.add(h);const d=n.querySelector(`.${r.CLASS}-btn-zoom`);d&&d.addEventListener(i.A.event.CLICK,(function(e){r.map.zoomToLayer(n.dataset.layerId,{animate:!0})}),{passive:!0}),o&&(e.wrap.normalizeLayerNode(o),r.getRenderedHtml(h,o).then((function(e){var t;(t=document.createElement("div")).classList.add(r.CLASS+"-tip"),t.innerHTML=e,r.map.div.appendChild(t),r.groupController?r.groupController.add(t):r.groupController=new p.A(r.groupModel,new g.A(t)),c.addEventListener("mouseover",(function(e){const n=r.map.div,o=c.getBoundingClientRect();t.classList.remove(i.A.classes.HIDDEN),t.style.top=o.top-n.offsetTop+"px",t.style.right=n.offsetWidth-(o.left-n.offsetLeft)+"px"})),c.addEventListener("mouseout",(function(e){t.classList.add(i.A.classes.HIDDEN)}))})));const f=r.div.querySelector("ul");n.dataset.layerId=e.id;const m=r.getLayerUIElements(),y=r.map.workLayers.filter((function(e){return!e.stealth})),v=y.indexOf(e);r.getItemTools().forEach((e=>r.addItemToolUI(n,e)));var A=!1;for(a=0;a<m.length;a++){const e=m[a];if(y.indexOf(r.map.getLayer(e.dataset.layerId))<v){e.insertAdjacentElement("beforebegin",n),A=!0;break}}A||f.appendChild(n),r.updateScale(),r.map.magnifier?.addNode(".tc-ctl-wlm-legend img",4),r.nodeController?r.nodeController.add(n):r.nodeController=new p.A(r.nodeModel,new g.A(n)),r.nodeModel.infoFromThisLayer=r.getLocaleString("infoFromThisLayer"),r.nodeModel.visibilityOfThisLayer=r.getLocaleString("visibilityOfThisLayer"),r.nodeModel.zoomToLayerExtent=r.getLocaleString("zoomToLayerExtent"),r.nodeModel.removeLayerFromMap=r.getLocaleString("removeLayerFromMap"),r.nodeModel.otherTools=r.getLocaleString("otherTools"),r.nodeModel.transparencyOfThisLayer=r.getLocaleString("transparencyOfThisLayer"),r.nodeModel.abstract=r.getLocaleString("abstract"),r.nodeModel.content=r.getLocaleString("content"),r.nodeModel.metadata=r.getLocaleString("metadata"),r.nodeModel.dragToReorder=r.getLocaleString("dragToReorder"),r.groupModel.singleLayer=r.getLocaleString("singleLayer"),r.groupModel.groupLayerThatContains=r.getLocaleString("groupLayerThatContains")}))}));var d=r.#Ui();const a=r.div.querySelector("."+r.CLASS+"-n"),s=r.div.querySelector("."+r.CLASS+"-empty"),l=r.div.querySelector("."+r.CLASS+"-content");a.textContent=d,d>0?(a.classList.add(i.A.classes.VISIBLE),s.classList.add(i.A.classes.HIDDEN),l.classList.remove(i.A.classes.HIDDEN)):(a.classList.remove(i.A.classes.VISIBLE),s.classList.remove(i.A.classes.HIDDEN),l.classList.add(i.A.classes.HIDDEN)),r.div.querySelector("."+r.CLASS+"-del-all").classList.toggle(i.A.classes.HIDDEN,!r.#qi())}else{const t=function(e){let t=e.title||e.wrap.getServiceTitle&&e.wrap.getServiceTitle();const r=e.getPath();return r.length&&(t=r.join(" &rsaquo; ")),t};let n=t(e);const i=function(){return new RegExp(e.id.replace(/([\w]*-\d)(-\d)*/gi,"$1-\\d"),"gi")},o=r.layers.filter((e=>t(e)===n)).reduce(((e,t)=>{const r=i().exec(t.id)?i().exec(t.id)[0]:t.id;return e.indexOf(r)>=0?e:e.concat(r)}),[]).findIndex((t=>{const r=/^[\w]*-\d-\d/gi.exec(e.id);return t===(r?r[0]:e.id)}));o>0&&(e._title=n=n+" ("+(o+1)+")");const a=r.div.querySelector("ul li[data-layer-id='"+e.id+"']");if(a){const t=a.querySelector(`.${r.CLASS}-lyr`);t.textContent=e._title,t.title=e._title;const i=a.querySelector(`.${r.CLASS}-path`);if(e.features?.length)if(e.features.some((e=>e.getPath().length))){const t=[...new Set(e.features.map((e=>e.getPath().join(" &rsaquo; "))))];i.innerHTML=t.join(" &bull; ")}else i.innerHTML=n,i.title=i.textContent}}}}updateScale(){const e=this;e.getLayerUIElements().forEach((function(t){var r=e.map.getLayer(t.dataset.layerId);if(r&&r.names){for(var n=!1,i=0;i<r.names.length;i++)if(r.isVisibleByScale(r.names[i])){n=!0;break}t.classList.toggle(e.CLASS+"-elm-notvisible",!n)}}))}update(){const e=this;e.getLayerUIElements().forEach((function(t){const r=e.map.getLayer(t.dataset.layerId);r&&(t.querySelector(`sitna-toggle.${e.CLASS}-cb-visibility`).checked=r.getVisibility(),r.tree=null)})),e.updateScale()}updateLayerOrder(e,t,r){const n=this;n.map.workLayers.filter((function(e){return!e.stealth})).forEach((function(e){const t=n.#Bi(e);t&&t.parentElement.firstChild.insertAdjacentElement("beforebegin",t)}))}removeLayer(e){const t=this,r=t.layers.indexOf(e);r>=0&&t.layers.splice(r,1),t.getLayerUIElements().forEach((function(t){t.dataset.layerId===e.id&&t.parentElement.removeChild(t)}));const n=t.div.querySelector("."+t.CLASS+"-content"),o=t.div.querySelector("."+t.CLASS+"-empty"),a=t.div.querySelector("."+t.CLASS+"-n");var s=t.#Ui();a.textContent=s,s>0?(n.classList.remove(i.A.classes.HIDDEN),o.classList.add(i.A.classes.HIDDEN),a.classList.add(i.A.classes.VISIBLE)):(t.#qi()&&t.div.querySelector("."+t.CLASS+"-del-all").classList.add(i.A.classes.HIDDEN),n.classList.add(i.A.classes.HIDDEN),o.classList.remove(i.A.classes.HIDDEN),a.classList.remove(i.A.classes.VISIBLE))}getLayerUIElements(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))}#Bi(e){this.getLayerUIElements().find((t=>t.dataset.layerId===e.id))}#qi=function(){return!this.layers.some((e=>e.unremovable))};#Ui(){return this.layers.length}#Gi=function(e,t,r,n){const i=this,o=i.getLayerUIElements();var a;if(r>t)a=o[r-1];else{if(!(r<t))return;a=o[r+1]}const s=i.map.getLayer(e.dataset.layerId),l=i.map.getLayer(a.dataset.layerId),c=i.map.layers.indexOf(l);c>=1&&c<i.map.layers.length&&i.map.insertLayer(s,c,n)};updateModel(){const e=this;e.model.loadedLayers=e.getLocaleString("loadedLayers"),e.model.removeAllLayersFromMap=e.getLocaleString("removeAllLayersFromMap"),e.model.noData=e.getLocaleString("noData"),e.nodeModel.infoFromThisLayer=e.getLocaleString("infoFromThisLayer"),e.nodeModel.visibilityOfThisLayer=e.getLocaleString("visibilityOfThisLayer"),e.nodeModel.zoomToLayerExtent=e.getLocaleString("zoomToLayerExtent"),e.nodeModel.removeLayerFromMap=e.getLocaleString("removeLayerFromMap"),e.nodeModel.otherTools=e.getLocaleString("otherTools"),e.nodeModel.transparencyOfThisLayer=e.getLocaleString("transparencyOfThisLayer"),e.nodeModel.abstract=e.getLocaleString("abstract"),e.nodeModel.content=e.getLocaleString("content"),e.nodeModel.metadata=e.getLocaleString("metadata"),e.nodeModel.dragToReorder=e.getLocaleString("dragToReorder"),e.groupModel.singleLayer=e.getLocaleString("singleLayer"),e.groupModel.groupLayerThatContains=e.getLocaleString("groupLayerThatContains")}async updateLanguage(){const e=this;e.updateModel(),e.map?.magnifier?.model&&(e.map.magnifier.model.textToOpen=e.getLocaleString("clickToEnlarge"),e.map.magnifier.model.textToClose=e.getLocaleString("clickToClose"))}}n.A.mix(v,u.default),v.prototype.CLASS="tc-ctl-wlm",n.A.control.WorkLayerManager=v;const A=v},6394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(1256),a=r(3365),s=r(3791),l=r(5777);n.A.control=n.A.control||{},n.A.Control=o.A;class c{constructor(){this.data="",this.others="",this.attributionGithubTooltip=""}}class u extends s.A{constructor(e){super(e)}update(e){}}class h extends o.A{constructor(){super(...arguments);const e=this;e.apiAttribution="",e.mainDataAttribution=null,e.dataAttributions=[],e.options.dataAttributions&&(e.dataAttributions=e.options.dataAttributions instanceof Array?e.options.dataAttributions:[e.options.dataAttributions]),e.model=new c}register(e){const t=this,r=super.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var n=function(e){if(e){var r=e.getAttribution();if(r)if(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))t.mainDataAttribution={name:"IDENA",site:"https://idena.navarra.es/"};else{for(var n=!1,i=0;i<t.dataAttributions.length;i++)if(r.name===t.dataAttributions[i].name){n=!0;break}n||t.dataAttributions.push(r)}}},o=function(e){if(e&&(!(e instanceof a.A)||function(){if(e.map.workLayers.length>0){const r=e.map.workLayers.slice().reverse();for(var t=0;t<r.length;t++){const n=r[t];if(n.url==e.url&&n.getVisibility())return!1}return!0}return!0}())){var r=e.getAttribution();if(r){var n=t.dataAttributions.reduce((function(e,t,n){return t.name===r.name?n:e}),-1);const o=function(e){return(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(/IDENA/.test(e)||/Tracasa Instrumental/.test(e))||r.name===e};if(t.map.baseLayer&&t.map.baseLayer.wrap.getAttribution()&&o(t.map.baseLayer.wrap.getAttribution().name)&&e.parent.id!==t.map.baseLayer.id)return;if(t.map.workLayers.filter((function(e){return e.type===i.A.layerType.WMS||e.type===i.A.layerType.WMTS})).some((function(e){var t=e.wrap.getAttribution();return t&&o(t.name)})))return;n>-1?t.dataAttributions.splice(n,1):(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(t.mainDataAttribution=null)}}};return t.updateModel(),e.loaded((function(){e.baseLayer.wrap.getAttribution&&(n(e.baseLayer.wrap),t.render(),t.updateModel())})),e.on(i.A.event.LAYERADD,(function(e){const r=e.layer;!r.isBase&&r.wrap.getAttribution&&r.wrap.getAttribution()&&(n(r.wrap),t.render())})),e.on(i.A.event.BEFOREBASELAYERCHANGE+" "+i.A.event.OVERVIEWBASELAYERCHANGE,(function(e){const r=e.type,a=e.newLayer,s=e.oldLayer;i.A.event.OVERVIEWBASELAYERCHANGE.indexOf(r)>-1&&(t.ignoreLayer=a),s&&s.wrap.getAttribution&&o(s.wrap),a&&a.wrap.getAttribution&&n(a.wrap),t.render()})),e.on(i.A.event.LAYERREMOVE,(function(e){const r=e.layer;r.wrap.getAttribution&&(o(r.wrap),t.render())})),e.on(i.A.event.TERRAINPROVIDERADD,(function(e){const r=e.terrainProvider;r.getAttribution&&(n(r),t.render())})),e.on(i.A.event.TERRAINPROVIDERREMOVE,(function(e){const r=e.terrainProvider;r.getAttribution&&(o(r),t.render())})),e.on(i.A.event.LAYERVISIBILITY,(function(e){const r=e.layer;t.ignoreLayer!==r&&r.wrap.getAttribution&&(r.getVisibility()?n(r.wrap):o(r.wrap),t.render())})),r}async loadTemplates(){const{default:e}=await r.e(779).then(r.bind(r,779));this.template=e}async render(e){const t=this;await t.renderData({api:"function"==typeof t.apiAttribution?t.apiAttribution.apply(t):t.getLocaleString(t.apiAttribution),mainData:t.mainDataAttribution,otherData:t.dataAttributions,isCollapsed:!t.div.querySelector("."+t.CLASS+"-other")||t.div.querySelector("."+t.CLASS+"-other").classList.contains(i.A.classes.COLLAPSED),lang:t.map?.options.locale},(function(){t.controller=new l.A(t.model,new u(t.div)),t.addUIEventListeners(),"function"==typeof e&&e()}))}addUIEventListeners(){const e=this,t=e.div.querySelector("."+e.CLASS+"-cmd");t&&t.addEventListener(i.A.event.CLICK,(function(){e.toggleOtherAttributions()}),{passive:!0})}toggleOtherAttributions(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(i.A.classes.COLLAPSED)}updateModel(){const e=this;e.model.data=e.getLocaleString("data"),e.model.attributionGithubTooltip=e.getLocaleString("attributionGithubTooltip"),e.model.others=e.getLocaleString("others")}async updateLanguage(){this.updateModel()}}h.prototype.CLASS="tc-ctl-attrib",n.A.control.Attribution=h;const d=h},6514:(e,t,r)=>{"use strict";function n(e,t,r){let n,o;r=r||i;let a=0,s=e.length,l=!1;for(;a<s;)n=a+(s-a>>1),o=+r(e[n],t),o<0?a=n+1:(s=n,l=!o);return l?a:~a}function i(e,t){return e>t?1:e<t?-1:0}function o(e,t){return e<t?1:e>t?-1:0}function a(e,t,r){if(e[0]<=t)return 0;const n=e.length;if(t<=e[n-1])return n-1;if("function"==typeof r){for(let i=1;i<n;++i){const n=e[i];if(n===t)return i;if(n<t)return r(t,e[i-1],n)>0?i-1:i}return n-1}if(r>0){for(let r=1;r<n;++r)if(e[r]<t)return r-1;return n-1}if(r<0){for(let r=1;r<n;++r)if(e[r]<=t)return r;return n-1}for(let r=1;r<n;++r){if(e[r]==t)return r;if(e[r]<t)return e[r-1]-t<t-e[r]?r-1:r}return n-1}function s(e,t,r){for(;t<r;){const n=e[t];e[t]=e[r],e[r]=n,++t,--r}}function l(e,t){const r=Array.isArray(t)?t:[t],n=r.length;for(let t=0;t<n;t++)e[e.length]=r[t]}function c(e,t){const r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}function u(e,t,r){const n=t||i;return e.every((function(t,i){if(0===i)return!0;const o=n(e[i-1],t);return!(o>0||r&&0===o)}))}r.d(t,{El:()=>n,FT:()=>a,V_:()=>i,WC:()=>u,X$:()=>l,aI:()=>c,gI:()=>s,rG:()=>o})},6546:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(797),i=r(9566);class o extends i.A{STYLETYPE=n.A.geom.POLYGON;constructor(e,t){super(e,t),this.wrap.isNative(e)||this.wrap.createPolygon(e,t)}getCoordinates(e){const t=super.getCoordinates.call(this,e);return e?.pointArray?[].concat.apply([],t):t}setCoordinates(e){if(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new TypeError("Coordinates not valid for polygon");Array.isArray(e[0][0])||(e=[e]),e.forEach((function(e){const t=e[0],r=e[e.length-1];t[0]===r[0]&&t[1]===r[1]||(e[e.length]=t)}))}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates().flat()}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}getArea(e){return this.wrap.getArea({coordinates:this.getCoordinates(e)})}getGeometryType(){return n.A.geom.POLYGON}}const a=o},6631:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(8038);n.A.filter={},n.A.filter.Operators=["PropertyIsEqualTo","PropertyIsGreaterThan","PropertyIsGreaterThanOrEqualTo","PropertyIsLessThan","PropertyIsLessThanOrEqualTo","PropertyIsNotEqualTo","PropertyIsLike","PropertyIsNull","PropertyIsBetween","Within","Intersects","Bbox"],n.A.filter.Filter=function(e){this.tagName_=e,this._defaultNSURL="http://www.opengis.net/ogc",this._defaultPrefixNS=this._wfsPrefixNS="ogc",this._fieldTitle="PropertyName",this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc",this._wfs2prefixNS="fes",this._wfs2NSURL="http://www.opengis.net/fes/2.0",this._wfs2FieldTitle="ValueReference",this._escapeAttrName="escape",this._wfs2EscapeAttrName="escapeChar"},n.A.filter.Filter.prototype.getTagName=function(){return this.tagName_},n.A.filter.Filter.prototype.setTagName=function(e){return this.tagName_},n.A.filter.Filter.prototype.writeFilterCondition_=function(){const e=this._defaultPrefixNS;return`<${e}:Filter xmlns:${e}="${this._defaultNSURL}" xmlns:gml="http://www.opengis.net/gml${this._defaultNSURL===this._wfs2NSURL?"/3.2":""}">${this.writeInnerCondition_(this)}</${e}:Filter>`},n.A.filter.Filter.prototype.writeInnerCondition_=function(e){return e!=this&&(e._defaultNSURL=this._defaultNSURL,e._defaultPrefixNS=this._defaultPrefixNS,e._fieldTitle=this._fieldTitle),e.write()},n.A.filter.Filter.prototype.writeInnerArrayCondition_=function(e){const t=this;return t.conditions.reduce((function(e,r,i){return(e instanceof n.A.filter.Filter?t.writeInnerCondition_(e):e)+t.writeInnerCondition_(r)}))},n.A.filter.Filter.prototype.getText=function(e){return e&&parseFloat(e,10)>=2&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.writeFilterCondition_()},n.A.filter.Filter.prototype.readText=function(e){return e.indexOf(this._wfs2prefixNS)>-1&&e.indexOf(this._wfs2NSURL)>-1&&e.indexOf(this._wfs2FieldTitle)>-1&&e.indexOf(this._wfs2EscapeAttrName)>-1&&(this._defaultPrefixNS=this._wfs2prefixNS,this._defaultNSURL=this._wfs2NSURL,this._fieldTitle=this._wfs2FieldTitle,this._escapeAttrName=this._wfs2EscapeAttrName),this.readFilterCondition_(e)},n.A.filter.Filter.prototype.toString=function(){return this.write()},n.A.filter.Filter.prototype.clone=function(){const e=new this.constructor;return Object.assign(e,this),e},n.A.filter.Filter.prototype.readFilterCondition_=function(e){return this.setTagName(e),this.readInnerCondition_(e)},n.A.filter.Filter.prototype.readInnerCondition_=function(e){return i.read(e)},n.A.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(n.A.filter.And,t))},n.A.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(n.A.filter.Or,t))},n.A.filter.not=function(e){return new n.A.filter.Not(e)},n.A.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.A.filter.Intersects(null,arguments[0],arguments[1]):new n.A.filter.Intersects(arguments[0],arguments[1],arguments[2])},n.A.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.A.filter.Within(null,arguments[0],arguments[1]):new n.A.filter.Within(arguments[0],arguments[1],arguments[2])},n.A.filter.equalTo=function(e,t,r){return new n.A.filter.EqualTo(e,t,r)},n.A.filter.notEqualTo=function(e,t,r){return new n.A.filter.NotEqualTo(e,t,r)},n.A.filter.lessThan=function(e,t){return new n.A.filter.LessThan(e,t)},n.A.filter.lessThanOrEqualTo=function(e,t){return new n.A.filter.LessThanOrEqualTo(e,t)},n.A.filter.greaterThan=function(e,t){return new n.A.filter.GreaterThan(e,t)},n.A.filter.greaterThanOrEqualTo=function(e,t){return new n.A.filter.GreaterThanOrEqualTo(e,t)},n.A.filter.isNull=function(e){return new n.A.filter.IsNull(e)},n.A.filter.between=function(e,t,r){return new n.A.filter.IsBetween(e,t,r)},n.A.filter.function=function(e,t){return new n.A.filter.Function(e,t)},n.A.filter.like=function(e,t,r,i,o,a){return new n.A.filter.IsLike(e,t,r,i,o,a)},n.A.filter.LogicalNary=function(e,t){n.A.filter.Filter.call(this,e),this.conditions=Array.prototype.slice.call(arguments,1)},n.A.inherit(n.A.filter.LogicalNary,n.A.filter.Filter),n.A.filter.LogicalNary.prototype.clone=function(){const e=n.A.filter.Filter.prototype.clone.call(this);return this.conditions=this.conditions.map((e=>e.clone())),e},n.A.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));n.A.filter.LogicalNary.apply(this,t)},n.A.inherit(n.A.filter.And,n.A.filter.LogicalNary),n.A.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));n.A.filter.LogicalNary.apply(this,t)},n.A.inherit(n.A.filter.Or,n.A.filter.LogicalNary),n.A.filter.LogicalNary.prototype.write=function(){const e=this._defaultPrefixNS,t=this.getTagName();return`<${e}:${t}>${this.writeInnerArrayCondition_()}</${e}:${t}>`},n.A.filter.Not=function(e){this.condition=e,n.A.filter.Filter.call(this,"Not")},n.A.inherit(n.A.filter.Not,n.A.filter.Filter),n.A.filter.Not.prototype.clone=function(){const e=n.A.filter.Filter.clone.call(this);return e.condition=this.condition.clone(),e},n.A.filter.Filter.prototype.write=function(){const e=this._defaultPrefixNS,t=this.getTagName();return`<${e}:${t}>${this.writeInnerCondition_(this.condition)}</${e}:${t}>`},n.A.filter.Comparison=function(e,t){n.A.filter.Filter.call(this,e),this.propertyName=t},n.A.inherit(n.A.filter.Comparison,n.A.filter.Filter),n.A.filter.Comparison.prototype.write=function(){var e="";const t=this._defaultPrefixNS;if(this.LowerBoundary&&this.UpperBoundary){const r=function(e){return e instanceof n.A.filter.Filter?e.write():`<${t}:Literal>${e}</${t}:Literal>`},i=r(this.LowerBoundary),o=r(this.UpperBoundary);e=`<${t}:LowerBoundary>${i}</${t}:LowerBoundary><${t}:UpperBoundary>${o}</${t}:UpperBoundary>`}this.pattern&&(e=`<${t}:Literal><![CDATA[${this.pattern}]]></${t}:Literal>`),this.params&&(e=Array.isArray(this.params)?this.params.reduce((function(e,r,n){var i=function(e){return`<${t}:Literal><![CDATA[${e}]]></${t}:Literal>`};return(n>0?e:i(e))+i(r)})):`<${t}:Literal><![CDATA[${this.params}]]></${t}:Literal>`);const r=this.getTagName(),i=void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",o=void 0!==this.escapeChar?" "+this._escapeAttrName+'="'+this.escapeChar+'"':"",a=void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",s=void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",l=this._fieldTitle;return`<${t}:${r}${i}${o}${a}${s}><${t}:${l}>${this.propertyName}</${t}:${l}>${e}</${t}:${r}>`},n.A.filter.ComparisonBinary=function(e,t,r,i){n.A.filter.Comparison.call(this,e,t),this.expression=r,this.matchCase=i},n.A.inherit(n.A.filter.ComparisonBinary,n.A.filter.Comparison),n.A.filter.ComparisonBinary.prototype.write=function(){const e=this._defaultPrefixNS,t=this._fieldTitle,r=this.getTagName();return`<${e}:${r}${void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':""}>${this.propertyName instanceof n.A.filter.Filter?`${this.propertyName.write()}`:`<${e}:${t}>${this.propertyName}</${e}:${t}>`}${this.expression instanceof n.A.filter.Filter?this.expression.write():`<${e}:Literal><![CDATA[${this.expression}]]></${e}:Literal>`}</${e}:${r}>`},n.A.filter.EqualTo=function(e,t,r){n.A.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,r)},n.A.inherit(n.A.filter.EqualTo,n.A.filter.ComparisonBinary),n.A.filter.GreaterThan=function(e,t){n.A.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)},n.A.inherit(n.A.filter.GreaterThan,n.A.filter.ComparisonBinary),n.A.filter.GreaterThanOrEqualTo=function(e,t){n.A.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)},n.A.inherit(n.A.filter.GreaterThanOrEqualTo,n.A.filter.ComparisonBinary),n.A.filter.LessThan=function(e,t){n.A.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)},n.A.inherit(n.A.filter.LessThan,n.A.filter.ComparisonBinary),n.A.filter.LessThanOrEqualTo=function(e,t){n.A.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)},n.A.inherit(n.A.filter.LessThanOrEqualTo,n.A.filter.ComparisonBinary),n.A.filter.NotEqualTo=function(e,t,r){n.A.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,r)},n.A.inherit(n.A.filter.NotEqualTo,n.A.filter.ComparisonBinary),n.A.filter.IsLike=function(e,t,r,i,o,a){n.A.filter.Comparison.call(this,"PropertyIsLike",e),this.pattern=t,this.wildCard=void 0!==r?r:"*",this.singleChar=void 0!==i?i:".",this.escapeChar=void 0!==o?o:"!",this.matchCase=a},n.A.inherit(n.A.filter.IsLike,n.A.filter.Comparison),n.A.filter.IsNull=function(e){n.A.filter.Comparison.call(this,"PropertyIsNull",e)},n.A.inherit(n.A.filter.IsNull,n.A.filter.Comparison),n.A.filter.IsBetween=function(e,t,r){n.A.filter.Comparison.call(this,"PropertyIsBetween",e),this.LowerBoundary=t,this.UpperBoundary=r},n.A.inherit(n.A.filter.IsBetween,n.A.filter.Comparison),n.A.filter.Function=function(e,t){n.A.filter.Filter.call(this,e),this.params=t},n.A.inherit(n.A.filter.Function,n.A.filter.Filter),n.A.filter.Filter.fromText=function(e){var t=e=>{const r=e.tagName.substring(e.tagName.indexOf(":")+1);var o;switch(r){case"PropertyIsEqualTo":o=new n.A.filter.EqualTo;break;case"PropertyIsGreaterThan":o=new n.A.filter.GreaterThan;break;case"PropertyIsGreaterThanOrEqualTo":o=new n.A.filter.GreaterThanOrEqualTo;break;case"PropertyIsLessThan":o=new n.A.filter.LessThan;break;case"PropertyIsLessThanOrEqualTo":o=new n.A.filter.LessThanOrEqualTo;break;case"PropertyIsNotEqualTo":o=new n.A.filter.NotEqualTo;break;case"PropertyIsLike":o=new n.A.filter.IsLike;break;case"PropertyIsNull":o=new n.A.filter.IsNull;break;case"PropertyIsBetween":o=new n.A.filter.IsBetween;break;default:o=new n.A.filter[r]}const a=e.querySelector(o._fieldTitle+","+o._wfs2FieldTitle)?.innerHTML,s=e.querySelector("Literal")?.innerHTML;if(o._defaultNSURL=e.tagName.substring(0,i.indexOf(":")),a&&(o.propertyName=a),o instanceof n.A.filter.IsLike&&(o.pattern=s),o instanceof n.A.filter.IsBetween&&(o.LowerBoundary=e.querySelector("LowerBoundary > Literal")?.innerHTML,o.UpperBoundary=e.querySelector("UpperBoundary > Literal")?.innerHTML),o instanceof n.A.filter.ComparisonBinary&&(o.expression=s),o instanceof n.A.filter.Spatial){const t=e.childNodes[1].textContent.split(" ").reduce(((e,t,r,n)=>(r%2==1&&e.push([parseFloat(n[r-1]),parseFloat(t)]),e)),[]);switch(e.childNodes[1].tagName.substr(4)){case"Polygon":o.geometry=new SITNA.feature.Polygon(t);break;case"LineString":o.geometry=new SITNA.feature.Polyline(t)}}return o.conditions=Array.from(e.childNodes).filter((e=>n.A.filter.Operators.includes(e.tagName.substring(e.tagName.indexOf(":")+1)))).reduce((function(e,r){return e.push(t(r)),e}),[]),o},r=(new DOMParser).parseFromString(e,"application/xml");const i=r.firstElementChild.firstElementChild.tagName;return t(r.firstElementChild.firstElementChild)},n.A.filter.Function.prototype.write=function(){var e="";const t=this._defaultPrefixNS;if(this.params){var r=function(e,t){if("string"==typeof e)return`<${t}:Literal><![CDATA[${e}]]></${t}:Literal>`;if("object"==typeof e){var r="";for(var n in e)r+=`<${t}:${n}>${e[n]}</${t}:${n}>`;return r}};e=Array.isArray(this.params)?this.params.reduce((function(e,n,i){var o=function(e){return r(e,t)};return(i>1?e:o(e))+o(n)})):r(this.params,this._defaultPrefixNS)}const n=this.getTagName();return`<${t}:Function name="${n}">${e}</${t}:Function>`},n.A.filter.Spatial=function(e,t,r,i){n.A.filter.Filter.call(this,e),this.geometryName=t,this.geometry=r,this.srsName=i,this.wrap=new n.A.wrap.Filter(this)},n.A.filter.Spatial.prototype.clone=function(){const e=n.A.filter.Filter.prototype.clone.call(this);return e.wrap=new n.A.wrap.Filter(e),e},n.A.wrap.Filter=function(e){this.parent=e},n.A.wrap.Filter.prototype.getAxisOrientation=function(){var e=this.parent.srsName;if(e){const t=e.match(/\d{4,6}$/);if(t){const r=t[0],n=ol.proj.get(e);if(n)return("neu"===n.axisOrientation_?"urn:x-ogc:def:crs:EPSG:":"EPSG:")+r}}return e},n.A.inherit(n.A.filter.Spatial,n.A.filter.Filter),n.A.filter.Spatial.prototype.write=function(){const e=this._defaultPrefixNS,t=this.getTagName(),r=this._fieldTitle,i=this.geometryName,o=this.geometry instanceof n.A.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(void 0,this.wrap.getAxisOrientation());return this.geometryName?`<${e}:${t}><${e}:${r}>${i}</${e}:${r}>${o}</${e}:${t}>`:`<${e}:${t}><${e}:${r}/>${o}</${e}:${t}>`},n.A.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new n.A.filter.Bbox(null,arguments[0],arguments[1]):new n.A.filter.Bbox(arguments[0],arguments[1],arguments[2])},n.A.filter.BBOX=n.A.filter.Bbox=function(e,t,r){n.A.filter.Filter.call(this,"BBOX"),this.geometryName=e,this.extent=t,this.srsName=r},n.A.inherit(n.A.filter.Bbox,n.A.filter.Spatial),n.A.filter.Bbox.prototype.clone=function(){const e=n.A.filter.Spatial.prototype.clone.call(this);return e.extent=this.extent.slice(),e},n.A.filter.Bbox.prototype.write=function(){const e=`<gml:Envelope${void 0!==this.srsName?' srsName="'+this.srsName+'"':""}><gml:lowerCorner>${this.extent[0]+" "+this.extent[1]}</gml:lowerCorner><gml:upperCorner>${this.extent[2]+" "+this.extent[3]}</gml:upperCorner></gml:Envelope>`,t=this._defaultPrefixNS,r=this.getTagName(),n=this._fieldTitle,i=this.geometryName;return this.geometryName?`<${t}:${r}><${t}:${n}>${i}</${t}:${n}>${e}</${t}:${r}>`:`<${t}:${r}><${t}:${n}/>${e}</${t}:${r}>`},n.A.filter.Intersects=function(e,t,r){n.A.filter.Spatial.call(this,"Intersects",e,t,r)},n.A.inherit(n.A.filter.Intersects,n.A.filter.Spatial),n.A.filter.Within=function(e,t,r){n.A.filter.Spatial.call(this,"Within",e,t,r)},n.A.inherit(n.A.filter.Within,n.A.filter.Spatial);const i=n.A.filter,o=i},6702:(e,t,r)=>{"use strict";r.d(t,{A:()=>f});var n=r(6514),i=r(915),o=r(1217),a=r(2096),s=r(3953),l=r(2497),c=r(6361),u=r(9969),h=r(4350),d=r(904),p=r(3671);class g extends a.Ay{constructor(e,t,r){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(void 0!==t&&r)this.setFlatCoordinates(t,e),this.ends_=r;else{const t=e,r=[],i=[];for(let e=0,o=t.length;e<o;++e){const o=t[e];(0,n.X$)(r,o.getFlatCoordinates()),i.push(r.length)}const o=0===t.length?this.getLayout():t[0].getLayout();this.setFlatCoordinates(o,r),this.ends_=i}}appendLineString(e){(0,n.X$)(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new g(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,r,n){return n<(0,i.Ld)(this.getExtent(),e,t)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt((0,s.HX)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),(0,s.oW)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,r,n))}getCoordinateAtM(e,t,r){return"XYM"!=this.layout&&"XYZM"!=this.layout||0===this.flatCoordinates.length?null:(t=void 0!==t&&t,r=void 0!==r&&r,(0,u.L8)(this.flatCoordinates,0,this.ends_,this.stride,e,t,r))}getCoordinates(){return(0,c.cD)(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new o.A(this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,r=this.layout,n=[];let i=0;for(let a=0,s=t.length;a<s;++a){const s=t[a],l=new o.A(e.slice(i,s),r);n.push(l),i=s}return n}getLength(){const e=this.ends_;let t=0,r=0;for(let n=0,i=e.length;n<i;++n)r+=(0,d.k)(this.flatCoordinates,t,e[n],this.stride),t=e[n];return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let r=0;const i=this.ends_,o=this.stride;for(let a=0,s=i.length;a<s;++a){const s=i[a],l=(0,u.SH)(t,r,s,o,.5);(0,n.X$)(e,l),r=s}return e}getSimplifiedGeometryInternal(e){const t=[],r=[];return t.length=(0,p.AL)(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,r),new g(t,"XY",r)}getType(){return"MultiLineString"}intersectsExtent(e){return(0,h.fB)(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const r=(0,l.KG)(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()}}const f=g},6717:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,o:()=>l});var n=r(4120),i=r(588),o=r(6837),a=r(9438);class s extends n.A{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if("function"==typeof e.getSimplifiedGeometry){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new s(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const r=this.getStyle();return r&&e.setStyle(r),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&((0,a.JH)(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=(0,a.KT)(e,o.A.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?l(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function l(e){if("function"==typeof e)return e;let t;return Array.isArray(e)?t=e:((0,i.v)("function"==typeof e.getZIndex,"Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[e]),function(){return t}}const c=s},6728:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(1993);n.A.control=n.A.control||{},n.A.control.SelectContainer=i.default;const o=n.A.control.SelectContainer},6792:(e,t,r)=>{"use strict";r.d(t,{A:()=>T});var n=r(8038),i=r(187),o=r(3301),a=r(797),s=r(3365),l=r(9566),c=r(7018),u=r(2948),h=r(8606),d=r(6546),p=r(1651),g=r(9439),f=r(6257),m=r(1667),y=r(8370),v=r(5101),A=r(2978);n.A.Layer=s.A,n.A.layer=n.A.layer||{};const S={};S.Point=c.A,S.Marker=u.A,S.Polyline=h.A,S.Polygon=d.A,S.MultiPoint=p.A,S.MultiMarker=g.A,S.MultiPolyline=f.A,S.MultiPolygon=m.A,S.Circle=y.A;const E={},w=new Map,_="__f",L=function(e){let t=0;const r=e.map((e=>e.replace("data:image/svg+xml,",""))).map((e=>decodeURIComponent(e))),n=r.map((e=>parseFloat(e.match(/ width="([\d\.]*)"/)[1]))),i=r.map((e=>parseFloat(e.match(/ height="([\d\.]*)"/)[1]))),o=n.reduce(((e,t)=>e+t+2),0),a=Math.max(...i),s=r.map(((e,r)=>{const o=e.replace('<svg xmlns="http://www.w3.org/2000/svg"',`<svg x="${t}" y="${(a-i[r])/2}" `);return t+=n[r]+2,o}));return"data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${o}" height="${a}">${s.join("")}</svg>`)},C=function(e,t,r=!0){const n=function(e,t,r){return r?e!==t:e===t};for(let i in t){const o=t[i];if(Array.isArray(o)){let t=e[i];t=t?Array.isArray(t)?t:[t]:[],Object.prototype.hasOwnProperty.call(e,i)&&n(o.join(),t.join(),r)&&delete e[i]}else"object"==typeof o?e[i]=C(e[i],o):Object.prototype.hasOwnProperty.call(e,i)&&n(o,e[i],r)&&delete e[i]}return e};class b extends s.A{features=[];selectedFeatures=[];#Wi=new Set;#on=null;#Hi=new Set;#ji;#Vi;constructor(){super(...arguments);const e=this;e.type=e.options.type||a.A.layerType.VECTOR,e.featureType=e.options.featureType,e.options.file&&(e.file=e.options.file),e.options.fileSystemFile&&(e.fileSystemFile=e.options.fileSystemFile),e.setAllowedGeometryTypes(e.options.allowedGeometryTypes);const t=(((i=(r=(r=e.url)||"").indexOf("?"))>=0||(i=r.indexOf("#"))>=0)&&(r=r.substr(0,i)),r.substr(r.lastIndexOf(".")).toLowerCase());var r,i;const s=function(e){switch(e){case a.A.mimeType.KML:return a.A.format.KML;case a.A.mimeType.GPX:return a.A.format.GPX;case a.A.mimeType.JSON:case a.A.mimeType.GEOJSON:return a.A.format.GEOJSON;case a.A.mimeType.GML:return a.A.format.GML;default:return null}}(e.format)||o.A.getFormatFromFileExtension(t);(s||e.type===a.A.layerType.KML)&&(s===a.A.format.KML&&(e.type=a.A.layerType.KML),e.title=e.options.title||function(e){for(var r=e=e||"",n=new RegExp("([\\w|\\-|\\.]+\\"+t+")","i"),i=0;i<3;i++){e=decodeURIComponent(e);var o=n.exec(e);if(o.length>1){r=o[1];break}}return r}(e.url)),e.wrap=new n.A.wrap.layer.Vector(e),e.wrap._promise=new Promise(((t,r)=>{var n;n=e.wrap.createVectorLayer(),e.wrap.setLayer(n),t(n)}))}getTree(){const e=this;if(e.tree)return e.tree;let t=null;if(!e.options.stealth){t={children:[]};const r=new Set;if(e.features.forEach((e=>{const n=e.getPath();if(n.length){const i=o.A.addArrayToTree(n,t);r.has(i)||(r.add(i),e.getVisibilityState()===a.A.visibility.NOT_VISIBLE?Object.prototype.hasOwnProperty.call(i,"visibilityState")||(i.visibilityState=a.A.visibility.NOT_VISIBLE):i.visibilityState=a.A.visibility.VISIBLE,i.legend=[]);const s=e.getLegend();let l=i.legend.find((e=>e.src===s.src));l||(l=Object.assign({},s),l.features=[],i.legend.push(l)),l.features.push(e)}})),r.forEach((function(e){if(e.legend.length>1){const t=[];e.legend.forEach((function(e){const r=e.features.map((e=>e.getData())).reduce((function(e,t){for(var r in e){const n=t[r];n&&Object.prototype.hasOwnProperty.call(n,"value")?n.value!==e[r].value&&delete e[r]:n!==e[r]&&delete e[r]}return e}),Object.assign({},e.features[0].getData())),n={};for(var i in r){const e=r[i];n[e?.displayName||i]=e?.value||e}t.push(n)}));const r=Object.keys(t[0]),n=[];r.forEach((function(e){const r=t.map((t=>t[e]));new Set(r).size<r.length||n.push(e)}));const i=n[0];i&&(e.legendTitle=i,e.legend.forEach((function(e,r){e.value=t[r][i]})))}})),e.styles||e.cluster){const r=[];e.cluster&&r.push(o.A.getLegendImageFromStyle(o.A.extend({},e.cluster.styles?.point,{radius:i.A.styles.point.radius+2,offset:[0,6]}),{geometryType:a.A.geom.POINT})),e.styles?.point&&r.push(o.A.getLegendImageFromStyle(e.styles.point,{geometryType:a.A.geom.POINT})),e.styles?.line&&r.push(o.A.getLegendImageFromStyle(e.styles.line,{geometryType:a.A.geom.POLYLINE})),e.styles?.polygon&&r.push(o.A.getLegendImageFromStyle(e.styles.polygon,{geometryType:a.A.geom.POLYGON})),t.legend={src:L(r)}}t.name=e.name||t.name,t.customLegend=e.options.customLegend,t.title=e.title||t.title,t.uid=e.id}return e.tree=t,t}async#zi(e,t,r){const n=this,i=await e.call(n,[t],r);return n.map&&n.map.trigger(a.A.event.FEATUREADD,{layer:n,feature:i[0]}),i[0]}async#Yi(e,t,r,a){const s=this;let c;c=t?S[t]:l.A;for(var u=new Array(e.length),h=[],d=0,p=e.length;d<p;d++){const t=o.A.extend(!0,{},a);let l,p=e[d];const g=n.A.wrap.Feature.prototype.isNative(p);if(p instanceof c)l=p;else if(g&&(l=p._wrap&&p._wrap.parent),!l){t.layer=s;const e=s.styles&&s.styles[r];if(o.A.hasStyleOptions(t)||!e){const n=Object.assign({},i.A.styles,s.map?s.map.options.styles:null);Object.assign(t,n[r],e,a)}l=new c(p,t)}l.layer=s,u[d]=l,s.features.push(l),g||h.push(l.wrap.feature),l.options.showPopup&&l.showInfo()}return h.length&&s.wrap.addFeatures(h),u}addPoint(e,t){return this.#zi(this.addPoints,e,t)}addPoints(e,t){return this.#Yi(e,"Point",a.A.geom.POINT,t)}addMultiPoint(e,t){return this.#zi(this.addMultiPoints,e,t)}addMultiPoints=function(e,t){return this.#Yi(e,"MultiPoint","point",t)};addMarker(e,t){return this.#zi(this.addMarkers,e,t)}addMarkers(e,t){return this.#Yi(e,"Marker","marker",t)}addMultiMarker(e,t){return this.#zi(this.addMultiMarkers,e,t)}addMultiMarkers(e,t){return this.#Yi(e,"MultiMarker","marker",t)}addPolyline(e,t){return this.#zi(this.addPolylines,e,t)}addPolylines(e,t){return this.#Yi(e,"Polyline","line",t)}addMultiPolyline(e,t){return this.#zi(this.addMultiPolylines,e,t)}addMultiPolylines(e,t){return this.#Yi(e,"MultiPolyline","line",t)}addPolygon(e,t){return this.#zi(this.addPolygons,e,t)}addPolygons(e,t){return this.#Yi(e,"Polygon",a.A.geom.POLYGON,t)}addMultiPolygon(e,t){return this.#zi(this.addMultiPolygons,e,t)}addMultiPolygons(e,t){return this.#Yi(e,"MultiPolygon",a.A.geom.POLYGON,t)}addCircle(e,t){return this.#zi(this.addCircles,e,t)}addCircles(e,t){return this.#Yi(e,"Circle",a.A.geom.POLYGON,t)}addFeature(e){const t=this;return e instanceof c.A?t.addPoint(e):e instanceof h.A?t.addPolyline(e):e instanceof d.A?t.addPolygon(e):e instanceof m.A?t.addMultiPolygon(e):e instanceof f.A?t.addMultiPolyline(e):e instanceof y.A?t.addCircle(e):t.#Yi([e])}addFeatures(e){return this.#Yi(e)}removeFeature(e){e.layer&&this.features.indexOf(e)>=0&&(this.wrap.removeFeature(e),e.layer=null)}getFeature(e){return e instanceof l.A?this.features.includes(e)?e:null:this.getFeatureById(e)}getFeatureById(e){let t=null;var r=this.wrap.getFeatureById(e);return r&&(t=r._wrap.parent),t}clearFeatures(){const e=this;e.features&&e.wrap&&(e.map&&e.map.getControlsByClass("TC.control.Popup").forEach((function(t){t.isVisible()&&e.features.indexOf(t.currentFeature)>=0&&t.hide()})),e.features.length=0,e.wrap.clearFeatures())}getDescribeFeatureTypeUrl(e){const t=this,r=t.options.version||t.capabilities.version||"1.1.0";let n=e||t.featureType;return n=Array.isArray(n)?n:[n],t.url+"?service=WFS&version="+r+"&request=DescribeFeatureType&typename="+n.join(",")+"&outputFormat="+encodeURIComponent(t.capabilities.Operations.DescribeFeatureType.outputFormat)}async describeFeatureType(e,t,r){const n=this;let i;e||(e=n.featureType);try{if(!(await n.getCapabilitiesPromise()).Operations.DescribeFeatureType)throw Error("No esta disponible el método describeFeatureType");n.#Vi??=new v.default;const r=async function(e){var t=await n.proxificationTool.fetchXML(n.getDescribeFeatureTypeUrl(e||n.featureType));return await n.#Vi.parseFeatureTypeDescription(t,e)};Array.isArray(e)||(e=e.split(","));var a=Object.entries(e.reduce((function(e,t){let r=t.substring(0,t.indexOf(":"));if(e[r])return e[r].push(t),e;{let n={};return n[r]=[t],Object.assign(e,n)}}),{})).map((function(e){var t=e[1];return n.#Vi.getFeatureTypeDescription(t)?function(e,t){return Array.isArray(e)||(e=e.split(",")),e.reduce(((e,r)=>Object.assign(e,{[r]:t[r]})),{})}(t,n.#Vi.getFeatureTypeDescriptions()):r(t)}));let s=(await Promise.all(a)).reduce((function(e,t){return Object.assign(e,t)}),{});i=1===Object.keys(s).length?s[Object.keys(s)[0]]:s,o.A.isFunction(t)&&t(i)}catch(e){throw o.A.isFunction(r)&&r(e),e}return i}import(e){this.wrap.import(e)}setNodeVisibility(e,t){const r=this,n=[];return e=Array.isArray(e)?e:[e],r.state=s.A.state.LOADING,r.map.trigger(a.A.event.BEFOREUPDATE),r.map.trigger(a.A.event.BEFORELAYERUPDATE,{layer:r}),e.forEach((function(e){n.push(s.A.prototype.setNodeVisibility.call(r,e,t))})),n.some((e=>!e.parent))?r.setVisibility(t):n.forEach((n=>{w.set(n.uid,t?a.A.visibility.VISIBLE:a.A.visibility.NOT_VISIBLE),n.children.forEach((e=>{r.setNodeVisibility(e.uid,t)})),n.parent&&w.get(n.parent.uid)!==a.A.visibility.NOT_VISIBLE&&n.parent.children.length>0&&n.parent.children.every((e=>w.get(e.uid)===a.A.visibility.NOT_VISIBLE))&&r.setNodeVisibility(n.parent.uid,!1);var i,o,s=!1;for(i=0;i<r.features.length;i++)if((o=r.features[i]).id==e){s=!0,o.setVisibility(t);break}if(!s)for(i=0;i<r.features.length;i++)void 0===(o=r.features[i])._path&&(o._path="/"+o.getPath().join("/")),(o._path===e||o._path.startsWith(e))&&o.setVisibility(t)})),r.state=s.A.state.IDLE,r.map.trigger(a.A.event.LAYERUPDATE,{layer:r}),r.map.trigger(a.A.event.UPDATE),n.length>1?n:n[0]}getNodeVisibility(e){var t=this,r=super.getNodeVisibility.call(t,e),n=t.findNode(e,t.getTree());if(n){if(n===t.getTree())(r=t.getVisibility()?a.A.visibility.VISIBLE:a.A.visibility.NOT_VISIBLE)===a.A.visibility.VISIBLE&&Array.from(w.values()).some((e=>e===a.A.visibility.NOT_VISIBLE))&&(r=a.A.visibility.HAS_VISIBLE);else{var i=w.get(e);if(void 0!==i)r=i,Array.from(w.entries()).some((t=>t[0]!==e&&t[0].startsWith(e)&&t[1]!==r))&&(r=a.A.visibility.HAS_VISIBLE);else{const t=Array.from(w.entries()).some((t=>t[0]!==e&&t[0].startsWith(e)&&!t[1])),i=n.children.length>0&&n.children.every((e=>w.get(e.uid)===a.A.visibility.NOT_VISIBLE));r=i?a.A.visibility.NOT_VISIBLE:t?a.A.visibility.HAS_VISIBLE:a.A.visibility.VISIBLE}}return r}}getPath(){const e=[];if(this.file){if(this.fileSystemFile&&this.fileSystemFile!==this.file){const t=e=>e.substring(0,e.lastIndexOf("."))||e;t(this.fileSystemFile)!==t(this.file)&&e.push(this.file)}const t=this.groupIndex??this.options?.groupIndex,r=this.groupCount??this.options?.groupCount,n=this.groupName??this.options?.groupName;(0===e.length||r>1)&&(n?e.push(n):e.push((t??0)+1))}return e}setModifiable(e){this.wrap.setModifiable(e)}applyEdits(e,t,r){return this.wrap.sendTransaction(e,t,r)}refresh(){return this.clearFeatures(),this.wrap.reloadSource()}getFeaturesInCurrentExtent(e){const t=this.map.getExtent();return this.getFeaturesInExtent(t,e)}getFeaturesInExtent(e,t){return this.wrap.getFeaturesInExtent(e,t)}setProjection(e){const t=this;t.wrap.setProjection(e),e.crs&&e.oldCrs&&(t.map.trigger(a.A.event.BEFORELAYERUPDATE,{layer:t}),t.features.forEach((function(t){t.setCoordinates(t.getCoordinates({geometryCrs:e.oldCrs,crs:e.crs}))})),t.map.trigger(a.A.event.LAYERUPDATE,{layer:t}))}getAllowedGeometryTypes(){return[...this.#Hi.values()]}setAllowedGeometryTypes(e=[]){return this.#Hi=new Set(e),this}isGeometryTypeAllowed(e){return 0===this.#Hi.size||this.#Hi.has(e.getGeometryType())}async getFeatureTypeMetadata(){if(this.type===a.A.layerType.WFS&&!this.#ji)try{const e=await this.describeFeatureType();this.#ji={name:this.featureType,origin:a.A.layerType.WFS,originaData:e,geometries:[],attributes:[]};const t=e=>{switch(e){case"number":case"double":case"float":case"decimal":return a.A.dataType.FLOAT;case"boolean":return a.A.dataType.BOOLEAN;case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":return a.A.dataType.INTEGER;case"date":return a.A.dataType.DATE;case"time":return a.A.dataType.TIME;case"dateTime":return a.A.dataType.DATETIME;default:return a.A.dataType.STRING}};for(let r in e){const n=e[r],i=A.A.getGeometryType(n.type);if(i){const e={name:r,originalType:n.type};e.type=i,this.#ji.geometries.push(e)}else{const e={name:r,type:t(n.type),originalType:n.type};"string"==typeof n.type&&"ID"===n.type.substring(n.type.indexOf(":")+1)&&(e.isId=!0),0===n["@minOccurs"]&&(e.optional=!0),this.#ji.attributes.push(e)}}}catch(e){}return this.#ji}setFeatureTypeMetadata(e){return this.#ji=e,this}setStyles(e){this.styles=o.A.extend({},e),this.wrap.setStyles(e)}getNextFeatureId(e={}){for(const e of this.features.map((e=>e.getId())))this.#Wi.add(e);const t=Array.from(this.#Wi);if(0===t.length)return(e.prefix??this.id+".")+1;if(t.every((e=>"number"==typeof e)))return Math.max(...t)+1;let r="";if(e.prefix)r=e.prefix;else if(t.length>1){r=t[0];for(let e=1;e<t.length;e++){for(;0!==t[e].indexOf(r)&&(r=r.substring(0,r.length-1),""!==r););if(""===r)break}}else if(1===t.length){const e=t[0];/\.\d+$/.test(e)&&(r=e.substring(0,e.lastIndexOf(".")+1))}const n=r.length;let i=Math.max(...t.map((e=>parseInt(e.substring(n)))))+1;return Number.isNaN(i)&&(i=1),r+i}exportState(e={}){const t=this,r={id:t.id};t.map&&t.map.crs!==t.map.options.crs&&(r.crs=t.map.crs);const n=Math.pow(10,(t.map.wrap.isGeo()?a.A.DEGREE_PRECISION:a.A.METER_PRECISION)+1);let s=null;const c=e.features||t.features,u=e=>({id:e.id,type:e.getGeometryType(),geom:o.A.compactGeometry(e.geometry,n),data:h(e.getData()),autoPopup:e.autoPopup,showsPopup:e.showsPopup}),h=e=>{if(e instanceof l.A)return{[_]:u(e)};if(Array.isArray(e))return e.map((e=>h(e)));if(e&&"object"==typeof e){const t={};for(const r in e)t[r]=h(e[r]);return t}return o.A.isFunction(e)?null:e};return r.features=c.map((function(r){const n=u(r);let a=t.styles?.[r.STYLETYPE]||t.map?.options?.styles?.[r.STYLETYPE]||i.A.styles?.[r.STYLETYPE];if(void 0===e.exportStyles||e.exportStyles){for(var l in a=o.A.extend({},a),a){var c=a[l];o.A.isFunction(c)&&(a[l]=c(r))}n.style=o.A.extend(a,r.getStyle()),s=s?C(s,n.style):Object.assign({},n.style)}return n})),!e.features&&s&&Object.keys(s).length&&(r.features.forEach((function(e){e.style=C(e.style,s,!1)})),r.style=s),this.#ji&&(r.metadata={origin:this.#ji.origin,attributes:this.#ji.attributes,geometries:this.#ji.geometries,originalMetadata:this.#ji.originalMetadata}),r}async importState(e){const t=this,r=function(e){if(Array.isArray(e))return e.map((e=>r(e)));if(!e||"object"!=typeof e)return e;const t={...e};for(const r in e){const i=e[r];if(i&&"object"==typeof i){const e=Object.keys(i);1===e.length&&e[0]===_&&(t[r]=n(i[_]))}}return t};e.crs&&t.map.crs!==e.crs&&await new Promise((function(e,r){t.map.one(a.A.event.PROJECTIONCHANGE,e)})),e.metadata&&t.setFeatureTypeMetadata(e.metadata);const n=function(t){let n,i=o.A.extend({},e.style||{},t.style);switch(t.type){case a.A.geom.POLYGON:n=d.A;break;case a.A.geom.MULTIPOLYGON:n=m.A;break;case a.A.geom.POLYLINE:n=h.A;break;case a.A.geom.MULTIPOLYLINE:n=f.A;break;case a.A.geom.CIRCLE:n=y.A;break;case a.A.geom.MULTIPOINT:n=t.style&&(t.style.url||t.style.className)?g.A:p.A;break;case a.A.geom.POINT:n=i&&(i.url||i.className)?u.A:c.A}if(n){const e=o.A.extend({},i,{data:r(t.data),id:t.id,showsPopup:t.showsPopup,showPopup:t.autoPopup});return new n(o.A.explodeGeometry(t.geom),e)}},i=e.features.map(n);await Promise.all(i.map((e=>t.addFeature(e))))}clone(){const e=super.clone.call(this);return this.features.forEach((t=>e.addFeature(t.clone()))),e}getGetCapabilitiesUrl(){const e=this;if(e.type===a.A.layerType.WFS){const t=()=>e.options.url||e.url;return(!o.A.isSecureURL(t())&&o.A.isSecureURL(o.A.toAbsolutePath(t()))?e.getBySSL_(t()):t())+"?"+o.A.getParamString({SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"})}return null}getCapabilitiesPromise(){const e=this;return e.type===a.A.layerType.WFS?new Promise(((t,r)=>{var i=(e.options.url||e.url).replace(/https ?:/gi,"");e.capabilities&&(t(e.capabilities),e.#on=Promise.resolve(e.capabilities)),n.A.capabilitiesWFS[i]&&(t(n.A.capabilitiesWFS[i]),e.#on=Promise.resolve(n.A.capabilitiesWFS[i]));const o=E[i];E[i]=e.#on=o||new Promise((function(t,r){const n=e.getCapabilitiesOnline(),i=e.getCapabilitiesFromStorage();n.then((function(e){t(e)})).catch((function(e){i.catch((function(){r(e)}))})),i.then((function(e){t(e)})).catch((function(){n.catch((function(e){r(e)}))}))})),E[i].then((function(r){!function(r){e.capabilities=e.capabilities||r,n.A.capabilitiesWFS[e.options.url||e.url]=n.A.capabilitiesWFS[e.options.url||e.url]||r,n.A.capabilitiesWFS[i]=n.A.capabilitiesWFS[i]||r,t(r)}(r)})).catch((function(t){e.map&&e.map.trigger(a.A.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}),r(t)}))})):Promise.reject(new Error(`Layer "${e.id}" does not have capabilities document`))}setDraggable(e,t,r){return this.wrap.setDraggable(e,t,r),this}}n.A.layer.Vector=b;const T=b},6837:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"}},6933:(e,t,r)=>{"use strict";r.d(t,{$x:()=>d,Io:()=>h,Li:()=>p,U$:()=>g,WQ:()=>i,aI:()=>s,e$:()=>l,hG:()=>u,hs:()=>c,hw:()=>o,sG:()=>a});var n=r(915);function i(e,t){return e[0]+=+t[0],e[1]+=+t[1],e}function o(e,t){const r=t.getRadius(),n=t.getCenter(),i=n[0],o=n[1];let a=e[0]-i;const s=e[1]-o;0===a&&0===s&&(a=1);const l=Math.sqrt(a*a+s*s);return[i+r*a/l,o+r*s/l]}function a(e,t){const r=e[0],n=e[1],i=t[0],o=t[1],a=i[0],s=i[1],l=o[0],c=o[1],u=l-a,h=c-s,d=0===u&&0===h?0:(u*(r-a)+h*(n-s))/(u*u+h*h||0);let p,g;return d<=0?(p=a,g=s):d>=1?(p=l,g=c):(p=a+d*u,g=s+d*h),[p,g]}function s(e,t){let r=!0;for(let n=e.length-1;n>=0;--n)if(e[n]!=t[n]){r=!1;break}return r}function l(e,t){const r=Math.cos(t),n=Math.sin(t),i=e[0]*r-e[1]*n,o=e[1]*r+e[0]*n;return e[0]=i,e[1]=o,e}function c(e,t){return e[0]*=t,e[1]*=t,e}function u(e,t){const r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function h(e,t){return Math.sqrt(u(e,t))}function d(e,t){return u(e,a(e,t))}function p(e,t){if(t.canWrapX()){const r=(0,n.RG)(t.getExtent()),i=g(e,t,r);i&&(e[0]-=i*r)}return e}function g(e,t,r){const i=t.getExtent();let o=0;return t.canWrapX()&&(e[0]<i[0]||e[0]>i[2])&&(r=r||(0,n.RG)(i),o=Math.floor((e[0]-i[0])/r)),o}},7018:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(797),i=r(187),o=r(3301),a=r(9566);class s extends a.A{STYLETYPE=n.A.geom.POINT;constructor(e,t){super(e,t),this.wrap.isNative(e)||(this.wrap.feature=e,this.wrap.createPoint(e,t))}getCoordinates(e){const t=super.getCoordinates.call(this,e);return e?.pointArray?[t]:t}getCoords(e){return this.getCoordinates(e)}getCoordsArray(){return[this.getCoordinates()]}getGeometryType(){return n.A.geom.POINT}setStyle(e){if(Array.isArray(this.features)&&this.features.length>1){const e=[];this.layer?.styles?.cluster&&e.unshift(this.layer.styles.cluster),this.layer?.map.options.styles?.cluster&&e.unshift(this.layer.map.options.styles.cluster),i.A?.styles?.cluster&&e.unshift(i.A.styles.cluster);const t=o.A.mergeStyles(...e);return this.wrap.setStyle(t)}return super.setStyle.call(this,e)}}const l=s},7088:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n=r(8038),i=r(797),o=r(187),a=r(3301),s=r(1256),l=r(9566),c=r(7018),u=r(8606),h=r(6257),d=r(8325),p=r(9105),g=r(3791),f=r(5777);n.A.control=n.A.control||{};const m=new WeakMap,y=new Map,v=function(e){if(e){const t=e.getCoords();t&&y.delete(t.toString())}};class A{constructor(){this.originalValue="",this.ele="",this.mdt="",this["elevation.explained"]="",this.heightOverTerrain=""}}class S extends s.A{#$i;#Ki;constructor(){super(...arguments),this.displayElevation=!0,this.resultsPanel=null}async register(e){const t=this;return await super.register.call(t,e),e.on(i.A.event.FEATUREMODIFY,(function(e){e.geometryChanged&&v(e.feature)})).on(i.A.event.FEATUREREMOVE,(function(e){v(e.feature)})).on(i.A.event.FEATUREREMOVE,(function(e){v(e.feature)})).on(i.A.event.LAYERREMOVE,(function(e){e.layer.features&&e.layer.features.forEach((e=>v(e)))})).on(i.A.event.POPUP+" "+i.A.event.DRAWTABLE,(function(e){m.has(e.control.currentFeature)&&t.displayElevationValue(e.control.currentFeature)})),t}async loadTemplates(){const e=this,t=r.e(5084).then(r.bind(r,5084)),n=r.e(231).then(r.bind(r,231)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-val"]=(await n).default,e.template=i}async getElevationTool(){const e=this,t={options:{displayElevation:e.options||!0},elevation:e.elevation,map:e.map},r=await super.getElevationTool.call(t);return e.elevation=r,r}setElevationToolOptions(e){const t=this;a.A.extend(t.options,e),t.elevation&&a.A.extend(t.elevation.options,t.options)}async displayElevationValue(e,t={}){const r=this;if(e instanceof c.A){let n;if(t.ignoreCache?m.delete(e):n=m.get(e),!n){const t=await r.getElevationTool(),i=await t.getElevation({crs:r.map.crs,coordinates:[e.geometry]});if(i.length){const t=i[0];n={elevation:t[2],height:t.length>3?t[3]:null},m.set(e,n)}}if(n){const t=[];let i;const s=r.map.options.locale||o.A.locale,l=r.map.getControlsByClass(p.default);l.filter((t=>t.caller&&t.caller.highlightedFeature===e)).forEach((function(r){const n=r.caller.getFeatureElement(e);n&&(i=n.querySelector("tbody"),t.push(i))})),l.filter((t=>t.currentFeature===e)).forEach((function(e){const r=e.getInfoContainer();r&&(i=r.querySelector("tbody"),t.push(i))}));const c={elevationValue:null!==n.elevation?a.A.formatNumber(Math.round(n.elevation),s):"",heightValue:n.height?n.height.toLocaleString(s,{maximumFractionDigits:1}):""},u=e.geometry[2];"number"==typeof u&&u!==n.elevation&&(c.originalValue=a.A.formatNumber(Math.round(u))),t.forEach((function(e){r.getRenderedHtml(r.CLASS+"-val",c,(function(t){e.querySelectorAll(`tr[class|=${r.CLASS}-pair]`).forEach((e=>e.remove())),e.insertAdjacentHTML("beforeend",t),r.elevationDataController=new f.A(r.elevationDataModel,new g.A(e))}))}))}}}async displayElevationProfile(e,t){const r=this,i=t||{};let o;switch(!0){case e instanceof u.A:o=[e.geometry];break;case e instanceof h.A:o=e.geometry;break;case e instanceof l.A:return;default:o=[e]}r.getProfilePanel().then((function(e){e.open()}));const s=function(e){r.getProfilePanel().then((function(t){t.renderPromise().then((function(){r.renderElevationProfile(e)}))}))};if(e instanceof l.A){r.getProfilePanel().then((function(t){t.setCurrentFeature(e)}));const t=function(e){if(e){const t=e.getCoords();return t?y.get(t.toString()):null}}(e);if(t)return void s(t)}const c=function(t,i){let o=t,c=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;r.map.getCRS()!==r.map.options.utmCrs&&(o=a.A.reproject(t,r.map.getCRS(),r.map.options.utmCrs));const h=o.map((e=>{let t=0;return e.map((function(e,r,n){let i=0===r?e:n[r-1];t+=Math.hypot(e[0]-i[0],e[1]-i[1]);var o=e[2]||0;return"number"==typeof o&&(c=Math.max(o,c),u=Math.min(o,u)),[t,o]}))})).reduce((function(e,t){const r=e[e.length-1][0];return t.forEach((e=>e[0]+=r)),e.concat(t)}));1===h.length&&h.push(h[0]);const d=o.flat();let p={x:h.map((function(e){return e[0]})),ele:h.map((function(e){return e[1]||0})),coords:d,min:u,max:c};const g={coords:d};"object"==typeof r.options&&r.map.options.elevation&&(g.hillDeltaThreshold=r.options.hillDeltaThreshold||r.map.options.elevation.hillDeltaThreshold),0===u&&0===c&&i.onlyOriginalElevation&&(p={msg:r.getLocaleString("geo.trk.chart.chpe.empty")}),a.A.extend(p,n.A.tool.Elevation.getElevationGain(g),i),i.isSecondary&&r.elevationProfileChartData&&(r.elevationProfileChartData.secondaryElevationProfileChartData?r.elevationProfileChartData.secondaryElevationProfileChartData[0]=p:(r.elevationProfileChartData.showLegend=!0,r.elevationProfileChartData.secondaryElevationProfileChartData=[],r.elevationProfileChartData.secondaryElevationProfileChartData.push(p))),e instanceof l.A&&!i.ignoreCaching&&function(e,t){if(e){const r=e.getCoords();r&&y.set(r.toString(),t)}}(e,p),r.elevationDataModel=new A,s(p)};await(r.map?.wait((async()=>{const e=await r.getElevationTool();if(i.originalElevation&&c(o,i),i.onlyOriginalElevation)return;const t=Date.now();r.#$i=t;const n={crs:r.map.getCRS()};Object.prototype.hasOwnProperty.call(e.options,"resolution")&&(n.resolution=e.options.resolution);const s=Object.prototype.hasOwnProperty.call(e.options,"sampleNumber")?e.options.sampleNumber:0;s>0&&(n.resolution=0);const l=new Array(o.length);if(l.fill(s),s>0){const e=new Array(o.length);let t=0;o.forEach(((r,n)=>{const i=new u.A(r).getLength();e[n]=i,t+=i})),l.forEach(((r,n,i)=>{i[n]=Math.floor(r*e[n]/t)}))}const h=o.map(((e,t)=>{const r=Object.assign({},n,{sampleNumber:l[t]});return d.A.interpolate(e,r)})),p=h.map(((o,a)=>{const s=Object.assign({},n,{coordinates:o,partialCallback:function(e){t===r.#$i&&(h[a]=e,c(h,{isSecondary:0!==Object.keys(i).length,ignoreCaching:i.ignoreCaching}))},resolution:0,sampleNumber:0});return e.getElevation(s)}));try{await Promise.all(p),i.callback&&a.A.isFunction(i.callback)&&i.callback()}catch(e){r.resetElevationProfile()}})))}async createProfilePanel(){const e=this,t={id:e.getUID(),content:"chart",titles:{main:e.getLocaleString("geo.trk.chart.chpe"),max:e.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:e,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}};let r;if(e.options.displayOn){let n=e.map.getControlsByClass("TC.control."+e.options.displayOn[0].toUpperCase()+e.options.displayOn.substring(1))[0];n||(n=await e.map.addControl(e.options.displayOn)),function(e){t.position=e.POSITION.RIGHT,r=e.addControl("resultsPanel",t)}(n)}else t.div=document.createElement("div"),e.map.div.appendChild(t.div),r=e.map.addControl("resultsPanel",t);const n=await r;return n.caller=e,e.resultsPanel=n,e._decorateChartPanel(),n}async getProfilePanel(){const e=this;return e.#Ki||(e.#Ki=e.createProfilePanel()),await e.#Ki}resetElevationProfile(){const e=this;e.options.displayElevation&&e.resultsPanel&&(e.elevationProfileChartData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0},e.resultsPanel.openChart(e.elevationProfileChartData))}renderElevationProfile(e){const t=this;e.isSecondary||(t.elevationProfileChartData=e||t.elevationProfileChartData),t.getProfilePanel().then((function(r){r.div.classList.contains(i.A.classes.HIDDEN)||(e.isSecondary?r.loadDataOnChart(t.elevationProfileChartData):r.openChart(t.elevationProfileChartData),r.isMinimized()||r.doVisible())}))}closeElevationProfile(){this.getProfilePanel().then((function(e){e.close()}))}_decorateChartPanel(){const e=this;e.resultsPanel.setCurrentFeature=function(e){const t=this;t.currentFeature&&t.currentFeature.toggleSelectedStyle(!1),t.currentFeature=e,e&&e.toggleSelectedStyle(!0)};const t=e.resultsPanel.close;e.resultsPanel.close=function(){const e=this;e.currentFeature&&e.currentFeature.toggleSelectedStyle(!1),t.call(e)}}getElevationTooltip(e){const t=this;return t.resultsPanel.wrap.showElevationMarker({data:e,layer:t.resultsPanel.currentFeature&&t.resultsPanel.currentFeature.layer,coords:t.elevationProfileChartData.coords}),t.resultsPanel.getElevationChartTooltip(e)}removeElevationTooltip(){const e=this;e.resultsPanel&&(e.resultsPanel.chart&&e.resultsPanel.chart.chart&&e.resultsPanel.chart.chart.tooltip.hide(),e.resultsPanel.wrap.hideElevationMarker())}async updateModel(){const e=this;(await e.getProfilePanel()).setTitles({main:e.getLocaleString("geo.trk.chart.chpe"),max:e.getLocaleString("geo.trk.chart.chpe")}),e.elevationDataModel&&(e.elevationDataModel.originalValue=e.getLocaleString("originalValue"),e.elevationDataModel.ele=e.getLocaleString("originalValue"),e.elevationDataModel.mdt=e.getLocaleString("originalValue"),e.elevationDataModel["elevation.explained"]=e.getLocaleString("elevation.explained"),e.elevationDataModel.heightOverTerrain=e.getLocaleString("heightOverTerrain"))}async updateLanguage(){this.updateModel()}}S.prototype.CLASS="tc-ctl-elev",n.A.control.Elevation=S;const E=S},7098:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var n=r(1845),i=r(8038),o=r(797),a=r(3301),s=r(3333),l=r(5121),c=r(2902),u=r(9566),h=r(3791),d=r(5777);i.A.control=i.A.control||{};const p="sitna-attributes-edit",g=e=>{if(null===e)return;let t=typeof e;return"number"===t&&(t=o.A.dataType.FLOAT),"string"===t?Date.parse(e)&&!/EPSG/.test(e)?/:/.test(e)?o.A.dataType.DATETIME:o.A.dataType.DATE:/^[0-2]\d:[0-5]\d$/.test(e)?o.A.dataType.TIME:o.A.dataType.STRING:t},f=(e,t)=>e===t,m=function(e,t){const r=t??f;return function(t){return r(t.name,e)}},y=(e,t,r)=>{let n,i=e;for(const e of t)n=i?.find(m(e,r)),n&&(i=n.value);return n};class v{constructor(){this.featureAttributes="",this.addItem="",this.addNewAttribute="",this.removeAttribute="",this.selectDataType="",this.text="",this.number="",this.integer="",this.boolean="",this.date="",this.time="",this.datetime=""}}class A extends n.default{#Xi;#Zi=[];#Ji;#Qi;#fe;#eo=new WeakMap;#to=new WeakMap;static PROPOSAL="proposal";constructor(){super(...arguments),this.#fe={BODY:`.${A.prototype.CLASS}-body`,ATTRIBUTE_VALUE:"td input,td select,td sitna-toggle",NEW_ATTRIBUTE_KEY:`input.${A.prototype.CLASS}-new-key`,NEW_ATTRIBUTE_VALUE:`td.${A.prototype.CLASS}-new-value input,td.${A.prototype.CLASS}-new-value sitna-toggle`,TYPE_SELECT:`select.${A.prototype.CLASS}-type`,ATTRIBUTE_REMOVE:`td sitna-button.${A.prototype.CLASS}-remove`,ITEM_ADD:`td sitna-button.${A.prototype.CLASS}-add`,NUMBER_INPUT:`.${A.prototype.CLASS}-new-value input[type="number"]`,BOOLEAN_INPUT:`.${A.prototype.CLASS}-new-value sitna-toggle`,DATE_INPUT:`.${A.prototype.CLASS}-new-value input[type="date"]`,TIME_INPUT:`.${A.prototype.CLASS}-new-value input[type="time"]`,DATETIME_INPUT:`.${A.prototype.CLASS}-new-value input[type="datetime-local"]`,TEXT_INPUT:`.${A.prototype.CLASS}-new-value input[type="text"]`,TOGGLE:`.${A.prototype.CLASS}-body > table sitna-toggle`},this.model=new v}get sealed(){return this.hasAttribute("sealed")}set sealed(e){this.toggleAttribute("sealed",!!e)}async loadTemplates(){const e=r.e(6947).then(r.bind(r,6947)),t=r.e(5616).then(r.bind(r,5616)),n=r.e(7456).then(r.bind(r,7456)),i=r.e(4326).then(r.bind(r,4326)),o={};o[this.CLASS]=(await e).default,o[this.CLASS+"-table"]=(await t).default,o[this.CLASS+"-row"]=(await n).default,o[this.CLASS+"-new"]=(await i).default,this.template=o}async render(e){const t={};if(this.#Xi){t.attributeProposal=this.#eo.get(this.#Xi);const e=this.#to.get(this.#Xi);let n=this.#Xi.getData();const i=this.#Xi.layer;this.#Zi=[];const a=function(t,r,n){const i=[];if(!t)return r;for(var o in t){const s=t[o];if(s instanceof u.A)continue;const l={name:o};let c;Array.isArray(r)&&(c=r?.find(m(o,n)));const h=e?.find((e=>e.name===o));l.type=c?.type??h?.type??g(s),l.optional=c?.optional??h?.optional,"object"===l.type?l.value=a(s,c?.value,n):l.value=s,i.push(l)}return i},s=function(e,t,r,n){let i=null;if(Array.isArray(e)&&Array.isArray(t))for(const o of e){const e=t.find(m(o.name,n));if(i??=[],e){const t={name:o.name};(e.multiple||o.multiple)&&(t.multiple=!0),e.optional&&o.optional&&(t.optional=!0),Object.prototype.hasOwnProperty.call(o,"type")&&!Object.prototype.hasOwnProperty.call(e,"type")?t.type=o.type:o.type!==e.type&&Object.prototype.hasOwnProperty.call(o,"type")||(t.type=e.type),t.value=s(o.value,e.value,!1,n),0===t.value.length&&(e.value===o.value?t.value=o.value:r&&void 0===o.value?t.value=e.value:t.value=void 0),i.push(t)}else i.push(o)}return i??[]},l=function(e,t,r){let n=null;if(Array.isArray(e)&&Array.isArray(t))for(const i of e){const e=t.find(m(i.name,r));if(n??=[],e){if(e.multiple!==i.multiple)continue;if(e.optional!==i.optional)continue;if(i.type!==e.type)continue;const t={...i};t.value=l(i.value,e.value,r),0===t.value.length&&(e.value===i.value?t.value=i.value:t.value=void 0),n.push(t)}}return n??[]},c=function(e){if(!Array.isArray(e))return e;let t={};e.every((e=>/^\d+$/.test(e.name)))&&(t=[]);for(const r of e){let e;e="object"===r.type||!r.type&&Array.isArray(r.value)?c(r.value):r.value,r.name&&(t[r.name]=e)}return t};let h,d,p=[];if(i){p=[];try{d=await this.#ro(i),p=d?.attributes??[],h=d?.geometries,t.sealed=i.type===o.A.layerType.WFS}catch(e){}const e=i.features,r=function(e){return e.map((e=>e.getData())).map(a).reduce(((e,t,r)=>r>0?null===e?null:l(e,t):t),null)};let u;if(Object.keys(this.#Xi.getData()).length?(u=r(e),u.length||(u=r(e.filter((e=>e instanceof this.#Xi.constructor))))):u=r(e.filter((e=>e!==this.#Xi))),u.length)if(p.length){const e=function(t,r){if(r){let n=0,i=t.slice();for(const o of r){const r=t.find(m(o.name,d.equals));if(r){const t={name:o.name,optional:!!r.optional,type:r.type};r.multiple&&(t.multiple=!0),"object"===r.type?t.value=e(r.value,o.value):o.value&&(t.value=o.value);const a=i.findIndex(m(o.name,d.equals));i[a]=t,n=a}else i.splice(++n,0,o)}return i=i.filter((e=>r.find(m(e.name,d.equals)))),i}return t};p=e(p,u)}else u.forEach((e=>{p.push({...e,optional:!0})}));const g={},y=function(e,t){for(let r of t)if(!r.isId&&r.name){const t=Object.entries(n).find((([e])=>(d?.equals??f)(e,r.name)));if(!t){let t;Object.prototype.hasOwnProperty.call(r,"value")&&(t=c(r.value)),void 0!==t||r.optional||(t=r.nonNullable?"boolean"!==r.type&&"":null),e[r.name]=t,"object"===r.type&&y(t,r.value)}}};if(y(g,p),Object.keys(g).length&&(this.#Xi.setData(g),n=this.#Xi.getData()),h)for(const e of h){const t=Array.isArray(e.name)?e.name:[e.name];let r=n;for(let e=0;e<t.length-1;e++)r=r[t[e]];r&&delete r[t[t.length-1]]}this.#Zi=s(a(n,p,d?.equals),p.filter((e=>!e.isId)),!0,d?.equals)}let y=-1;for(var r in n){const e=this.#Zi.findIndex(m(r)),t=this.#Zi[e];if(t)y=e,"object"===t.type?t.value=a(n[r],p.find(m(r))?.value,d?.equals):t.value=n[r];else{const e=n[r],t={name:r,value:e};e&&"object"==typeof e&&(t.type="object"),this.#Zi.splice(++y,0,t)}}t.value=this.#Zi,t.sealed??=this.sealed}await this.renderData(t,(()=>{this.#no(),this.addUIEventListeners(),this.#io(),this.#Xi?this.show():this.hide(),a.A.isFunction(e)&&e(),this.controller=new d.A(this.model,new h.A(this)),this.updateModel()}))}async#ro(e){let t=null;return e&&(t=await e.getFeatureTypeMetadata(),a.A.isFunction(t)&&(t=t(this.#Xi))),t}async addAttributeElement({name:e,type:t,value:r}){if(this.#Xi){let n;if(e){const i=this.#Xi.layer.type===o.A.layerType.WFS,a=this.#Xi.layer.type!==o.A.layerType.WFS;n=await this.getRenderedHtml(this.CLASS+"-row",{name:e,type:t,value:r,sealed:i,optional:a})}else{if(this.querySelector(this.CLASS+"-new"))return;n=await this.getRenderedHtml(this.CLASS+"-new")}const i=document.createElement("tbody");i.insertAdjacentHTML("beforeend",n),this.#oo(i);const a=this.querySelector(`${this.#fe.BODY} > table > tbody`),s=Array.from(a.querySelectorAll("tr:last-of-type")),l=s[s.length-1];l?l.insertAdjacentElement("afterend",i.firstElementChild):a.appendChild(i.firstElementChild),this.#no(),this.controller.add(a)}}removeAttributeElement(e){const t=`${this.#fe.BODY} > table > tbody > `+e.map((e=>`tr[data-attribute-name="${e}"]`)).join(" ");return this.querySelectorAll(t).forEach((e=>e.remove())),this}#io(){if(this.#Xi){const e=this.#Xi.getData(),t=this.div.querySelectorAll(this.#fe.TOGGLE);for(const r of t){let t=e;const n=this.#ao(r);for(const e of n)t=t[e];r.indeterminate=null==t}}}#no(){this.newAttributeElement=this.querySelector(`.${this.CLASS}-new`),this.attributeProposalElement=this.querySelector(`.${this.CLASS}-proposal`)}addUIEventListeners(){return this.#oo(this)}#ao(e){let t=e;const r=[];do{t=t.parentElement,t?.matches("tr[data-attribute-name]")&&r.unshift(t.dataset.attributeName)}while(t&&!t.matches(this.#fe.BODY));return r}#oo(e){const t=this,r=function(e){if(t.#Xi&&this.getAttribute("name")){const e=[];let r=this;do{r.dataset.attributeName&&e.unshift(r.dataset.attributeName),r=r.parentElement}while(r&&!(r instanceof A));const n=this.getAttribute("type"),i=this instanceof c.A||"checkbox"===n?this.checked:"number"===n?this.valueAsNumber:this.value;t.setFeatureAttribute(e,i)}};e.querySelectorAll(t.#fe.ATTRIBUTE_VALUE).forEach((e=>{e.addEventListener("change",r)}));const n=function(e){t.removeFeatureAttribute(t.#ao(this))};e.querySelectorAll(t.#fe.ATTRIBUTE_REMOVE).forEach((e=>{e.addEventListener("click",n)}));const a=function(e){const r=t.#ao(this),n=t.div.querySelector(t.#fe.BODY).scrollTop;t.addFeatureAttributeItem(r).then((e=>{e&&t.div.querySelector(t.#fe.BODY).scrollTo(0,n)}))};e.querySelectorAll(t.#fe.ITEM_ADD).forEach((e=>{e.addEventListener("click",a)})),e.querySelector(t.#fe.NEW_ATTRIBUTE_KEY)?.addEventListener("change",(function(e){t.#so(this.value).catch((e=>t.map.toast(e.message,{type:o.A.msgType.WARNING})))})),e.querySelector(t.#fe.TYPE_SELECT)?.addEventListener("change",(function(e){t.#lo(this.value).catch((e=>i.A.error(e)))}));const s=function(e){if(t.#Xi){let e={};e[this.name]=this.value,e={...t.#Xi.getData(),...e},t.#Xi.setData(e),t.#co();const r={name:this.name,value:this.value};if("SITNA-TOGGLE"===this.tagName)r.type="boolean";else{const e=this.getAttribute("type");switch(e){case"datetime-local":r.type="datetime";break;case"number":r.type="float";break;default:r.type=e}}t.addAttributeElement(r)}};e.querySelectorAll(t.#fe.NEW_ATTRIBUTE_VALUE).forEach((e=>e.addEventListener("change",s)))}async register(e){const t=this;return await super.register.call(t,e),t.containerControl?.on(o.A.event.FEATURESSELECT+" "+o.A.event.FEATURESUNSELECT,(function(e){const r=t.containerControl.getSelectedFeatures();t.feature=r[0]})),e.on(o.A.event.FEATUREREMOVE,(function(e){e.feature===t.feature&&(t.feature=null)})).on(o.A.event.FEATURESCLEAR,(function(e){e.layer===t.feature?.layer&&(t.feature=null)})),t}get feature(){return this.#Xi}set feature(e){this.#Xi!==e&&(this.#Xi=e,this.render())}get clientControl(){return this.#Ji}set clientControl(e){this.#Qi?.abort(),this.#Qi=new AbortController;const{signal:t}=this.#Qi;if(this.#Ji=e,this.#Ji instanceof s.default){const e=e=>{this.feature=this.clientControl.getSelectedFeatures()[0]};this.#Ji.addEventListener(o.A.event.FEATURESSELECT,e,{signal:t}),this.#Ji.addEventListener(o.A.event.FEATURESUNSELECT,e,{signal:t}),e()}else if(this.#Ji instanceof l.default){const e=e=>{setTimeout((()=>{this.feature=e.detail?.feature}),100)};this.#Ji.addEventListener(o.A.event.DRAWEND,e,{signal:t});const r=e=>{this.mode!==o.A.geom.POINT&&(this.feature=null)};this.#Ji.addEventListener(o.A.event.DRAWSTART,r,{signal:t}),this.#Ji.addEventListener(o.A.event.DRAWCANCEL,r,{signal:t}),e({})}}setFeatureAttribute(e,t){if(this.#Xi){const r=Array.isArray(e)?e:[e],n=r[r.length-1];let i=a.A.extend(!0,{},this.#Xi.getData()),o=i;for(let e=0;e<r.length-1;e++)o=o[r[e]];o[n]=t;const s=this.#Zi.find(m(n));if(s){let e;switch(s.type){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":e=parseInt(t),Number.isNaN(e)||(o[n]=e);break;case"double":case"float":case"decimal":e=parseFloat(t),Number.isNaN(e)||(o[n]=e);break;case"date":o[n]=t?new Date(t).toISOString().substring(0,10):t;break;case"dateTime":o[n]=t?new Date(t).toISOString().substring(0,19):t;break;case"boolean":o[n]=!!t;break;case void 0:break;default:o[n]=t}}this.#Xi.setData(i),this.#co()}}removeFeatureAttribute(e){if(this.#Xi&&e.length){const t=this.#eo.get(this.#Xi);if(1===e.length&&e[0]===t)this.removeAttributeElement(e),this.#eo.delete(this.#Xi),this.addAttributeElement({});else{const t=this.#Xi.layer;this.#ro(t).then((r=>{let n=!1,o=[this.#Xi],a="removeAttribute.confirm";if(t.features.length>1&&t.features.every((t=>{let r=t.getData();for(const t of e){if(!Object.prototype.hasOwnProperty.call(r,t))return!1;r=r[t]}return!0}))&&(n=!0,o=t.features,a="deleteTableMetadata.warning"),r){const t=y(r.attributes,e,r.equals);if(t&&!t.optional)throw Error(this.getLocaleString("removeAttribute.error",{name:t.name}))}i.A.confirm(this.getLocaleString(a,{name:e.join(" › ")}),(()=>{if(n&&r){let t=r.attributes;if(e.length>1){const n=e.slice(0,e.length-1);t=y(r.attributes,n,r.equals).value}const n=t.findIndex(m(e[e.length-1]));n>=0&&t.splice(n,1)}o.forEach((t=>{let r=t.getData();const n=e[e.length-1];if(1===e.length)t.unsetData(n);else for(let t=0,n=e.length-1;t<n;t++)r=r[e[t]];delete r[n]}));const t=this.#to.get(this.#Xi),i=t?.findIndex((t=>t.name===e[e.length-1]));i>=0&&t.splice(i,1),this.removeAttributeElement(e),this.#co()}))}))}}}#uo(e){let t;if("object"===e.type&&(t={},e.value))for(const r of e.value)t[r.name]=this.#uo(r);return t}async addFeatureAttributeItem(e){if(this.#Xi&&e.length){const t=this.#Xi.layer,r=await this.#ro(t),n=e[e.length-1];let i=this.#Xi.getData();for(let t=0,r=e.length-1;t<r;t++)i=i[e[t]];let o,s=i[n];if(Array.isArray(s)||(i[n]=[s],s=i[n]),r){const t=y(r.attributes,e,r.equals);if(!t?.multiple)return;o=this.#uo(t)}else{const e=s[0];o=a.A.extend(!0,{},e);const t=e=>{for(const r in e){const n=e[r];n&&"object"==typeof n?t(n):e[r]=void 0}};t(o)}return s.push(o),this.#co(),await this.render(),o}return null}#co(){this.containerControl?.trigger(o.A.event.FEATUREMODIFY,{feature:this.#Xi,layer:this.#Xi.layer,geometryChanged:!1})}async#so(e){if(this.#Xi){const t=this.querySelector(this.#fe.NEW_ATTRIBUTE_KEY);let r=e??t.value;t.value=r;const n=r.toLowerCase(),o=Object.keys(this.#Xi.getData()).find((e=>e.toLowerCase()===n));if(o){const e=this.getLocaleString("attributeAlreadyExists.warning",{name:o});throw t.value="",Error(e)}let a,s=A.PROPOSAL;const l=await this.#ro(this.#Xi.layer);if(l)if(a=y(l.attributes,[e],l.equals),a)s=a.type;else if(l.sealed)throw t.value="",Error(this.getLocaleString("forbiddenAttribute.error",{name:e}));(!l||a?.optional||1===this.#Xi.layer.features.length||i.A.confirm(this.getLocaleString("tableMetadataExists.warning")))&&(a&&(s=a.type),this.#eo.set(this.#Xi,t.value),this.newAttributeElement.remove(),this.newAttributeElement=null,await this.addAttributeElement({name:t.value,type:A.PROPOSAL}),s!==A.PROPOSAL&&this.#lo(s))}}async#lo(e){if(e&&this.#Xi){const t=this.#eo.get(this.#Xi);let r;this.#eo.delete(this.#Xi),this.#to.has(this.#Xi)||(r=[],this.#to.set(this.#Xi,r)),r.push({name:t,type:e,optional:!0}),this.attributeProposalElement.remove(),this.attributeProposalElement=null;const n=e!==o.A.dataType.BOOLEAN&&null,i={[t]:n},a=this.#Xi.layer,s=await this.#ro(a);if(s){const r=t.toLowerCase(),n=s?.attributes.find((e=>e.name.toLowerCase()===r));n||(s.attributes.push({name:t,type:e,isId:!1,optional:!0}),a.setFeatureTypeMetadata(s)),a.features.forEach((e=>e.setData({...i})))}else this.#Xi.setData(i);await this.addAttributeElement({name:t,type:e}),await this.addAttributeElement({})}}updateModel(){const e=this;e.model.featureAttributes=e.getLocaleString("featureAttributes"),e.model.addItem=e.getLocaleString("featureAttributes"),e.model.removeAttribute=e.getLocaleString("removeAttribute"),e.model.selectDataType=e.getLocaleString("selectDataType"),e.model.text=e.getLocaleString("text"),e.model.number=e.getLocaleString("number"),e.model.integer=e.getLocaleString("integer"),e.model.boolean=e.getLocaleString("boolean"),e.model.date=e.getLocaleString("date"),e.model.time=e.getLocaleString("time"),e.model.datetime=e.getLocaleString("datetime"),e.model.addNewAttribute=e.getLocaleString("addNewAttribute")}async updateLanguage(){this.updateModel()}}A.prototype.CLASS="tc-ctl-attr-edit",customElements.get(p)||customElements.define(p,A),i.A.control.AttributesEdit=A;const S=A},7206:e=>{function t(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},7232:function(e,t,r){var n;!function(i,o){"use strict";var a="function",s="undefined",l="object",c="string",u="major",h="model",d="name",p="type",g="vendor",f="version",m="architecture",y="console",v="mobile",A="tablet",S="smarttv",E="wearable",w="embedded",_="Amazon",L="Apple",C="ASUS",b="BlackBerry",T="Browser",x="Chrome",P="Firefox",M="Google",I="Huawei",R="LG",O="Microsoft",D="Motorola",N="Opera",k="Samsung",F="Sharp",G="Sony",B="Xiaomi",U="Zebra",q="Facebook",W="Chromium OS",H="Mac OS",j=" Browser",V=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},z=function(e,t){return typeof e===c&&-1!==Y(t).indexOf(Y(e))},Y=function(e){return e.toLowerCase()},$=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===s?e:e.substring(0,500)},K=function(e,t){for(var r,n,i,s,c,u,h=0;h<t.length&&!c;){var d=t[h],p=t[h+1];for(r=n=0;r<d.length&&!c&&d[r];)if(c=d[r++].exec(e))for(i=0;i<p.length;i++)u=c[++n],typeof(s=p[i])===l&&s.length>0?2===s.length?typeof s[1]==a?this[s[0]]=s[1].call(this,u):this[s[0]]=s[1]:3===s.length?typeof s[1]!==a||s[1].exec&&s[1].test?this[s[0]]=u?u.replace(s[1],s[2]):o:this[s[0]]=u?s[1].call(this,u,s[2]):o:4===s.length&&(this[s[0]]=u?s[3].call(this,u.replace(s[1],s[2])):o):this[s]=u||o;h+=2}},X=function(e,t){for(var r in t)if(typeof t[r]===l&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(z(t[r][n],e))return"?"===r?o:r}else if(z(t[r],e))return"?"===r?o:r;return t.hasOwnProperty("*")?t["*"]:e},Z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},J={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[d,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[d,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[d,f],[/opios[\/ ]+([\w\.]+)/i],[f,[d,N+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[d,N+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[d,N]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[d,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[f,[d,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[d,f],[/quark(?:pc)?\/([-\w\.]+)/i],[f,[d,"Quark"]],[/\bddg\/([\w\.]+)/i],[f,[d,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[d,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[d,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[d,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[d,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[d,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[d,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[d,/(.+)/,"$1 Secure "+T],f],[/\bfocus\/([\w\.]+)/i],[f,[d,P+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[d,N+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[d,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[d,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[d,N+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[d,"MIUI"+j]],[/fxios\/([\w\.-]+)/i],[f,[d,P]],[/\bqihoobrowser\/?([\w\.]*)/i],[f,[d,"360"]],[/\b(qq)\/([\w\.]+)/i],[[d,/(.+)/,"$1Browser"],f],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[d,/(.+)/,"$1"+j],f],[/samsungbrowser\/([\w\.]+)/i],[f,[d,k+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[f,[d,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[d,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[d,f],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[d],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[f,d],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[d,q],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[d,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[d,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[d,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[d,x+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[d,x+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[d,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[d,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[d,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,d],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[d,[f,X,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[d,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[d,"Netscape"],f],[/(wolvic|librewolf)\/([\w\.]+)/i],[d,f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[d,P+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[d,[f,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[d,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,Y]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",Y]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,Y]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[g,k],[p,A]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[h,[g,k],[p,v]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[g,L],[p,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[g,L],[p,A]],[/(macintosh);/i],[h,[g,L]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[g,F],[p,v]],[/(?:honor)([-\w ]+)[;\)]/i],[h,[g,"Honor"],[p,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[g,I],[p,A]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[g,I],[p,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[h,/_/g," "],[g,B],[p,v]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[g,B],[p,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[g,"OPPO"],[p,v]],[/\b(opd2\d{3}a?) bui/i],[h,[g,"OPPO"],[p,A]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[g,"Vivo"],[p,v]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[g,"Realme"],[p,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[g,D],[p,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[g,D],[p,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[g,R],[p,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[g,R],[p,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[g,"Lenovo"],[p,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[g,"Nokia"],[p,v]],[/(pixel c)\b/i],[h,[g,M],[p,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[g,M],[p,v]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[g,G],[p,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[g,G],[p,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[g,"OnePlus"],[p,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[g,_],[p,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[g,_],[p,v]],[/(playbook);[-\w\),; ]+(rim)/i],[h,g,[p,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[g,b],[p,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[g,C],[p,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[g,C],[p,v]],[/(nexus 9)/i],[h,[g,"HTC"],[p,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[h,/_/g," "],[p,v]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[h,[g,"TCL"],[p,A]],[/(itel) ((\w+))/i],[[g,Y],h,[p,X,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[g,"Acer"],[p,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[g,"Meizu"],[p,v]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[g,"Ulefone"],[p,v]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[g,"Energizer"],[p,v]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[g,"Cat"],[p,v]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[g,"Smartfren"],[p,v]],[/droid.+; (a(?:015|06[35]|142p?))/i],[h,[g,"Nothing"],[p,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,h,[p,v]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,h,[p,A]],[/(surface duo)/i],[h,[g,O],[p,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[g,"Fairphone"],[p,v]],[/(u304aa)/i],[h,[g,"AT&T"],[p,v]],[/\bsie-(\w*)/i],[h,[g,"Siemens"],[p,v]],[/\b(rct\w+) b/i],[h,[g,"RCA"],[p,A]],[/\b(venue[\d ]{2,7}) b/i],[h,[g,"Dell"],[p,A]],[/\b(q(?:mv|ta)\w+) b/i],[h,[g,"Verizon"],[p,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[g,"Barnes & Noble"],[p,A]],[/\b(tm\d{3}\w+) b/i],[h,[g,"NuVision"],[p,A]],[/\b(k88) b/i],[h,[g,"ZTE"],[p,A]],[/\b(nx\d{3}j) b/i],[h,[g,"ZTE"],[p,v]],[/\b(gen\d{3}) b.+49h/i],[h,[g,"Swiss"],[p,v]],[/\b(zur\d{3}) b/i],[h,[g,"Swiss"],[p,A]],[/\b((zeki)?tb.*\b) b/i],[h,[g,"Zeki"],[p,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],h,[p,A]],[/\b(ns-?\w{0,9}) b/i],[h,[g,"Insignia"],[p,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[g,"NextBook"],[p,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],h,[p,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],h,[p,v]],[/\b(ph-1) /i],[h,[g,"Essential"],[p,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[g,"Envizen"],[p,A]],[/\b(trio[-\w\. ]+) b/i],[h,[g,"MachSpeed"],[p,A]],[/\btu_(1491) b/i],[h,[g,"Rotor"],[p,A]],[/(shield[\w ]+) b/i],[h,[g,"Nvidia"],[p,A]],[/(sprint) (\w+)/i],[g,h,[p,v]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[g,O],[p,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[g,U],[p,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[g,U],[p,v]],[/smart-tv.+(samsung)/i],[g,[p,S]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[g,k],[p,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,R],[p,S]],[/(apple) ?tv/i],[g,[h,L+" TV"],[p,S]],[/crkey/i],[[h,x+"cast"],[g,M],[p,S]],[/droid.+aft(\w+)( bui|\))/i],[h,[g,_],[p,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[g,F],[p,S]],[/(bravia[\w ]+)( bui|\))/i],[h,[g,G],[p,S]],[/(mitv-\w{5}) bui/i],[h,[g,B],[p,S]],[/Hbbtv.*(technisat) (.*);/i],[g,h,[p,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,$],[h,$],[p,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,S]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,h,[p,y]],[/droid.+; (shield) bui/i],[h,[g,"Nvidia"],[p,y]],[/(playstation [345portablevi]+)/i],[h,[g,G],[p,y]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[g,O],[p,y]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[h,[g,k],[p,E]],[/((pebble))app/i],[g,h,[p,E]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[g,L],[p,E]],[/droid.+; (glass) \d/i],[h,[g,M],[p,E]],[/droid.+; (wt63?0{2,3})\)/i],[h,[g,U],[p,E]],[/droid.+; (glass) \d/i],[h,[g,M],[p,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[g,h,[p,E]],[/; (quest( \d| pro)?)/i],[h,[g,q],[p,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[p,w]],[/(aeobc)\b/i],[h,[g,_],[p,w]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[h,[p,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[p,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,A]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,v]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[d,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[d,f],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[d,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,d]],os:[[/microsoft (windows) (vista|xp)/i],[d,f],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[d,[f,X,Z]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,X,Z],[d,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[d,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[d,H],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,d],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[d,f],[/\(bb(10);/i],[f,[d,b]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[d,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[d,P+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[d,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[d,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[d,x+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[d,W],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[d,f],[/(sunos) ?([\w\.\d]*)/i],[[d,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[d,f]]},Q=function(e,t){if(typeof e===l&&(t=e,e=o),!(this instanceof Q))return new Q(e,t).getResult();var r=typeof i!==s&&i.navigator?i.navigator:o,n=e||(r&&r.userAgent?r.userAgent:""),y=r&&r.userAgentData?r.userAgentData:o,S=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(J,t):J,E=r&&r.userAgent==n;return this.getBrowser=function(){var e,t={};return t[d]=o,t[f]=o,K.call(t,n,S.browser),t[u]=typeof(e=t[f])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:o,E&&r&&r.brave&&typeof r.brave.isBrave==a&&(t[d]="Brave"),t},this.getCPU=function(){var e={};return e[m]=o,K.call(e,n,S.cpu),e},this.getDevice=function(){var e={};return e[g]=o,e[h]=o,e[p]=o,K.call(e,n,S.device),E&&!e[p]&&y&&y.mobile&&(e[p]=v),E&&"Macintosh"==e[h]&&r&&typeof r.standalone!==s&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[h]="iPad",e[p]=A),e},this.getEngine=function(){var e={};return e[d]=o,e[f]=o,K.call(e,n,S.engine),e},this.getOS=function(){var e={};return e[d]=o,e[f]=o,K.call(e,n,S.os),E&&!e[d]&&y&&y.platform&&"Unknown"!=y.platform&&(e[d]=y.platform.replace(/chrome os/i,W).replace(/macos/i,H)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===c&&e.length>500?$(e,500):e,this},this.setUA(n),this};Q.VERSION="0.7.40",Q.BROWSER=V([d,f,u]),Q.CPU=V([m]),Q.DEVICE=V([h,g,p,y,v,S,A,E,w]),Q.ENGINE=Q.OS=V([d,f]),typeof t!==s?(e.exports&&(t=e.exports=Q),t.UAParser=Q):r.amdO?(n=function(){return Q}.call(t,r,t,e))===o||(e.exports=n):typeof i!==s&&(i.UAParser=Q);var ee=typeof i!==s&&(i.jQuery||i.Zepto);if(ee&&!ee.ua){var te=new Q;ee.ua=te.getResult(),ee.ua.get=function(){return te.getUA()},ee.ua.set=function(e){te.setUA(e);var t=te.getResult();for(var r in t)ee.ua[r]=t[r]}}}("object"==typeof window?window:this)},7430:(e,t,r)=>{"use strict";r.d(t,{A:()=>p});var n=r(4120),i=r(915),o=r(4238),a=r(7947),s=r(9703),l=r(4087),c=r(7622);const u=(0,s.vt)(),h=[NaN,NaN];class d extends n.A{constructor(){super(),this.extent_=(0,i.S5)(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=(0,o.B4)(((e,t,r)=>{if(!r)return this.getSimplifiedGeometry(t);const n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(t)}))}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return(0,l.b0)()}closestPointXY(e,t,r,n){return(0,l.b0)()}containsXY(e,t){return 0===this.closestPointXY(e,t,h,Number.MIN_VALUE)}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return(0,l.b0)()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&(0,i.aZ)(e),this.extentRevision_=this.getRevision()}return(0,i.$u)(this.extent_,e)}rotate(e,t){(0,l.b0)()}scale(e,t,r){(0,l.b0)()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return(0,l.b0)()}getType(){return(0,l.b0)()}applyTransform(e){(0,l.b0)()}intersectsExtent(e){return(0,l.b0)()}translate(e,t){(0,l.b0)()}transform(e,t){const r=(0,a.Jt)(e),n="tile-pixels"==r.getUnits()?function(e,n,o){const l=r.getExtent(),h=r.getWorldExtent(),d=(0,i.Oq)(h)/(0,i.Oq)(l);(0,s.Zz)(u,h[0],h[3],d,-d,0,0,0);const p=(0,c.Rc)(e,0,e.length,o,u,n),g=(0,a.RG)(r,t);return g?g(p,p,o):p}:(0,a.RG)(r,t);return this.applyTransform(n),this}}const p=d},7468:(e,t,r)=>{"use strict";r.d(t,{E3:()=>d,Gc:()=>g,Ko:()=>m,P9:()=>c,Vf:()=>o,Z3:()=>p,_I:()=>s,_X:()=>h,cS:()=>f,e4:()=>l,gC:()=>a,pE:()=>y,uB:()=>E,yg:()=>u});var n=r(2806),i=r(3942);function o(e){return a((0,i.mT)(e,!1))}function a(e){const t=/^\s*(true|1)|(false|0)\s*$/.exec(e);if(t)return void 0!==t[1]||!1}function s(e){const t=(0,i.mT)(e,!1),r=Date.parse(t);return isNaN(r)?void 0:r/1e3}function l(e){return c((0,i.mT)(e,!1))}function c(e){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);if(t)return parseFloat(t[1])}function u(e){return h((0,i.mT)(e,!1))}function h(e){const t=/^\s*(\d+)\s*$/.exec(e);if(t)return parseInt(t[1],10)}function d(e){return(0,i.mT)(e,!1).trim()}function p(e,t){E(e,t?"1":"0")}function g(e,t){e.appendChild((0,i.YE)().createCDATASection(t))}function f(e,t){const r=new Date(1e3*t),o=r.getUTCFullYear()+"-"+(0,n.H)(r.getUTCMonth()+1,2)+"-"+(0,n.H)(r.getUTCDate(),2)+"T"+(0,n.H)(r.getUTCHours(),2)+":"+(0,n.H)(r.getUTCMinutes(),2)+":"+(0,n.H)(r.getUTCSeconds(),2)+"Z";e.appendChild((0,i.YE)().createTextNode(o))}function m(e,t){const r=t.toPrecision();e.appendChild((0,i.YE)().createTextNode(r))}function y(e,t){const r=t.toString();e.appendChild((0,i.YE)().createTextNode(r))}const v=/^\s/,A=/\s$/,S=/(\n|\t|\r|<|&| {2})/;function E(e,t){"string"==typeof t&&(v.test(t)||A.test(t)||S.test(t))?t.split("]]>").forEach(((t,r,n)=>{r<n.length-1&&(t+="]]"),r>0&&(t=">"+t),g(e,t)})):e.appendChild((0,i.YE)().createTextNode(t))}},7585:(e,t,r)=>{"use strict";r.d(t,{A:()=>g});var n=r(7596),i=r.n(n);i().noConflict(),i().registerHelper("i18n",(function(e,t){const r=TC.i18n.currentLocale[e];return"string"==typeof r?t?new(i().SafeString)(r):r:e})),i().registerHelper("gt",(function(e,t){return e>t})),i().registerHelper("lt",(function(e,t){return e<t})),i().registerHelper("eq",(function(e,t){return e==t})),i().registerHelper("every",(function(){return Array.from(arguments).slice(0,arguments.length-1).every((e=>e))})),i().registerHelper("round",(function(e){return Math.round(e)})),i().registerHelper("lowerCase",(function(e){return e&&e.toLowerCase()})),i().registerHelper("startsWith",(function(e,t){return e&&e.toString().startsWith(t)})),i().registerHelper("isPlainObject",(function(e){return e&&e instanceof Object&&!Array.isArray(e)&&!(e instanceof Date)})),i().registerHelper("isEmpty",(function(e){return!!e&&0===Object.keys(e).length})),i().registerHelper("isArray",(function(e){return Array.isArray(e)})),i().registerHelper("isNumber",(function(e){return"number"==typeof e})),i().registerHelper("isBoolean",(function(e){return"boolean"==typeof e})),i().registerHelper("isUrl",(function(e){return e&&/^(http|https|ftp|mailto)\:\/\//i.test(e)})),i().registerHelper("getYoutubeId",(function(e){if(e){const t=e.match(/^(?:https?:\/\/)?(?:m\.|www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/);if(t)return t[1]}return null})),i().registerHelper("getHeader",(function(e){if(e){const t=e.match(/^(h\d+)_/);if(t)return t[1]}return null}));const o=/(?:__(image|video|audio|embed)(?:_(\d+|auto)_(\d+|auto))?$)|(?:^(image|video|audio|embed)(?:_(\d+|auto)_(\d+|auto))?__)/,a=function(e){if(e&&"string"==typeof e){const t=e.match(o);if(t)return t[1]||t[4]}return null},s=function(e,t){if(e){const r=e.match(o);if(r){const e=r[t+1]||r[t+4];return"auto"!==e?e?e+"px":"auto":e}}return null},l=function(e,t,r){return a(e)===r||a(t)===r};i().registerHelper("isVideoAttribute",(function(e,t){return l(e,t,"video")})),i().registerHelper("isAudioAttribute",(function(e,t){return l(e,t,"audio")})),i().registerHelper("isImageAttribute",(function(e,t){return l(e,t,"image")})),i().registerHelper("isEmbedAttribute",(function(e,t){return l(e,t,"embed")})),i().registerHelper("hasDisplayName",(function(e){return e&&Object.prototype.hasOwnProperty.call(e,"displayName")&&Object.prototype.hasOwnProperty.call(e,"toString")})),i().registerHelper("getTagWidth",(function(e,t){let r=s(e,1);return r||(r=s(t,1)),r})),i().registerHelper("getTagHeight",(function(e,t){let r=s(e,2);return r||(r=s(t,2)),r})),i().registerHelper("removeSpecialAttributeTag",(function(e){if(!e)return null;if("string"==typeof e){const t=e.match(o);if(t){const r="__";return 0===t[0].indexOf(r)?e.substr(0,e.lastIndexOf(r)):e.substr(e.indexOf(r)+r.length)}}return e})),i().registerHelper("isKeyValue",(function(e){return e&&Object.prototype.hasOwnProperty.call(e,"value")&&"object"!=typeof e.value})),i()._getIdHelperIds=[],i().registerHelper("getId",(function(e){let t=i()._getIdHelperIds.find((t=>t.obj===e));return t||i()._getIdHelperIds.push(t={obj:e,id:TC.getUID()}),t.id})),i().registerHelper("countif",(function(e,t){const r=t?t.split(","):[];let n=0;for(let t in e)r.indexOf(t)<0&&n++;return n>0}));const c=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])[T\s](2[0-3]|[01][0-9]):[0-5][0-9](:[0-5][0-9])?(\.[0-9]{0,3}){0,1}Z?$/,u=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])Z?$/,h=/^(2[0-3]|[01][0-9]):([0-5][0-9])(?:(?::([0-5][0-9])(?:\.([0-9]{1,3}))?)){0,1}Z?$/;i().registerHelper("formatDateNumberOrBoolean",(function(e){if(e&&(e instanceof Date||c.test(e)))return new Date(e).toLocaleString(TC.i18n.currentLocaleKey&&TC.i18n.currentLocaleKey.length>2?TC.i18n.currentLocaleKey.substr(0,2):TC.i18n.currentLocaleKey,{hour12:!1});if(e&&u.test(e))return Number.isNaN(Date.parse(e))&&(e=e.replace("Z","")),new Date(e).toLocaleDateString(TC.i18n.currentLocaleKey&&TC.i18n.currentLocaleKey.length>2?TC.i18n.currentLocaleKey.substr(0,2):TC.i18n.currentLocaleKey);if("number"==typeof e)return TC.Util.formatNumber(e,TC.i18n.currentLocaleKey);if("string"==typeof e){const t=e.toLowerCase();if("true"===t)return TC.i18n.currentLocale.yes;if("false"===t)return TC.i18n.currentLocale.no}return!0===e?TC.i18n.currentLocale.yes:!1===e?TC.i18n.currentLocale.no:e}));const d=function(e){const t=function(e){return e instanceof Date?e:u.test(e)||c.test(e)?new Date(e):void 0}(e);return t?`${t.getFullYear().toString().padStart(4,"0")}-${(t.getMonth()+1).toString().padStart(2,"0")}-${t.getDate().toString().padStart(2,"0")}`:""};i().registerHelper("inputDate",d);const p=function(e){const t=function(e){if("string"==typeof e){const t=e.match(h);if(t){const[,e,r,n,i]=t;return{hours:e,minutes:r,seconds:n,milliseconds:i}}}}(e);return t?`${t.hours}:${t.minutes}:${t.seconds??"00"}.${t.milliseconds??"000"}`:""};i().registerHelper("inputTime",p),i().registerHelper("inputDatetime",(function(e){const t=d(e);if(t){let r=e.indexOf("T"),n=e.indexOf(" ");const i=r<0?n:r,o=p(e.substring(i+1));return o?`${t}T${o}`:t}return""})),i().registerHelper("formatNumber",(function(e,t){return e.toLocaleString(t)}));const g=i()},7596:function(e){var t;t=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}return r.m=e,r.c=t,r.p="",r(0)}([function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(2)),o=n(r(84)),a=r(85),s=r(90),l=n(r(91)),c=n(r(88)),u=n(r(83)),h=i.default.create;function d(){var e=h();return e.compile=function(t,r){return s.compile(t,r,e)},e.precompile=function(t,r){return s.precompile(t,r,e)},e.AST=o.default,e.Compiler=s.Compiler,e.JavaScriptCompiler=l.default,e.Parser=a.parser,e.parse=a.parse,e.parseWithoutProcessing=a.parseWithoutProcessing,e}var p=d();p.create=d,u.default(p),p.Visitor=c.default,p.default=p,t.default=p,e.exports=t.default},function(e,t){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,r){"use strict";var n=r(3).default,i=r(1).default;t.__esModule=!0;var o=n(r(4)),a=i(r(77)),s=i(r(6)),l=n(r(5)),c=n(r(78)),u=i(r(83));function h(){var e=new o.HandlebarsEnvironment;return l.extend(e,o),e.SafeString=a.default,e.Exception=s.default,e.Utils=l,e.escapeExpression=l.escapeExpression,e.VM=c,e.template=function(t){return c.template(t,e)},e}var d=h();d.create=h,u.default(d),d.default=d,t.default=d,e.exports=t.default},function(e,t){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},t.__esModule=!0},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.HandlebarsEnvironment=h;var i=r(5),o=n(r(6)),a=r(10),s=r(70),l=n(r(72)),c=r(73);t.VERSION="4.7.8",t.COMPILER_REVISION=8,t.LAST_COMPATIBLE_COMPILER_REVISION=7,t.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};var u="[object Object]";function h(e,t,r){this.helpers=e||{},this.partials=t||{},this.decorators=r||{},a.registerDefaultHelpers(this),s.registerDefaultDecorators(this)}h.prototype={constructor:h,logger:l.default,log:l.default.log,registerHelper:function(e,t){if(i.toString.call(e)===u){if(t)throw new o.default("Arg not supported with multiple helpers");i.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(i.toString.call(e)===u)i.extend(this.partials,e);else{if(void 0===t)throw new o.default('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(i.toString.call(e)===u){if(t)throw new o.default("Arg not supported with multiple decorators");i.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]},resetLoggedPropertyAccesses:function(){c.resetLoggedProperties()}};var d=l.default.log;t.log=d,t.createFrame=i.createFrame,t.logger=l.default},function(e,t){"use strict";t.__esModule=!0,t.extend=a,t.indexOf=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return i.test(e)?e.replace(n,o):e},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.createFrame=function(e){var t=a({},e);return t._parent=e,t},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},n=/[&<>"'`=]/g,i=/[&<>"'`=]/;function o(e){return r[e]}function a(e){for(var t=1;t<arguments.length;t++)for(var r in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],r)&&(e[r]=arguments[t][r]);return e}var s=Object.prototype.toString;t.toString=s;var l=function(e){return"function"==typeof e};l(/x/)&&(t.isFunction=l=function(e){return"function"==typeof e&&"[object Function]"===s.call(e)}),t.isFunction=l;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===s.call(e)};t.isArray=c},function(e,t,r){"use strict";var n=r(7).default;t.__esModule=!0;var i=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(e,t){var r=t&&t.loc,a=void 0,s=void 0,l=void 0,c=void 0;r&&(a=r.start.line,s=r.end.line,l=r.start.column,c=r.end.column,e+=" - "+a+":"+l);for(var u=Error.prototype.constructor.call(this,e),h=0;h<i.length;h++)this[i[h]]=u[i[h]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{r&&(this.lineNumber=a,this.endLineNumber=s,n?(Object.defineProperty(this,"column",{value:l,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:c,enumerable:!0})):(this.column=l,this.endColumn=c))}catch(e){}}o.prototype=new Error,t.default=o,e.exports=t.default},function(e,t,r){e.exports={default:r(8),__esModule:!0}},function(e,t,r){var n=r(9);e.exports=function(e,t,r){return n.setDesc(e,t,r)}},function(e,t){var r=Object;e.exports={create:r.create,getProto:r.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:r.getOwnPropertyDescriptor,setDesc:r.defineProperty,setDescs:r.defineProperties,getKeys:r.keys,getNames:r.getOwnPropertyNames,getSymbols:r.getOwnPropertySymbols,each:[].forEach}},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.registerDefaultHelpers=function(e){i.default(e),o.default(e),a.default(e),s.default(e),l.default(e),c.default(e),u.default(e)},t.moveHelperToHooks=function(e,t,r){e.helpers[t]&&(e.hooks[t]=e.helpers[t],r||delete e.helpers[t])};var i=n(r(11)),o=n(r(12)),a=n(r(65)),s=n(r(66)),l=n(r(67)),c=n(r(68)),u=n(r(69))},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5);t.default=function(e){e.registerHelper("blockHelperMissing",(function(t,r){var i=r.inverse,o=r.fn;if(!0===t)return o(this);if(!1===t||null==t)return i(this);if(n.isArray(t))return t.length>0?(r.ids&&(r.ids=[r.name]),e.helpers.each(t,r)):i(this);if(r.data&&r.ids){var a=n.createFrame(r.data);a.contextPath=n.appendContextPath(r.data.contextPath,r.name),r={data:a}}return o(t,r)}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(13).default,i=r(43).default,o=r(55).default,a=r(60).default,s=r(1).default;t.__esModule=!0;var l=r(5),c=s(r(6));t.default=function(e){e.registerHelper("each",(function(e,t){if(!t)throw new c.default("Must pass iterator to #each");var r,s=t.fn,u=t.inverse,h=0,d="",p=void 0,g=void 0;function f(t,r,n){p&&(p.key=t,p.index=r,p.first=0===r,p.last=!!n,g&&(p.contextPath=g+t)),d+=s(e[t],{data:p,blockParams:l.blockParams([e[t],t],[g+t,null])})}if(t.data&&t.ids&&(g=l.appendContextPath(t.data.contextPath,t.ids[0])+"."),l.isFunction(e)&&(e=e.call(this)),t.data&&(p=l.createFrame(t.data)),e&&"object"==typeof e)if(l.isArray(e))for(var m=e.length;h<m;h++)h in e&&f(h,h,h===e.length-1);else if("function"==typeof n&&e[i]){for(var y=[],v=o(e),A=v.next();!A.done;A=v.next())y.push(A.value);for(m=(e=y).length;h<m;h++)f(h,h,h===e.length-1)}else r=void 0,a(e).forEach((function(e){void 0!==r&&f(r,h-1),r=e,h++})),void 0!==r&&f(r,h-1,!0);return 0===h&&(d=u(this)),d}))},e.exports=t.default},function(e,t,r){e.exports={default:r(14),__esModule:!0}},function(e,t,r){r(15),r(42),e.exports=r(21).Symbol},function(e,t,r){"use strict";var n=r(9),i=r(16),o=r(17),a=r(18),s=r(20),l=r(24),c=r(19),u=r(27),h=r(28),d=r(30),p=r(29),g=r(31),f=r(36),m=r(37),y=r(38),v=r(39),A=r(32),S=r(26),E=n.getDesc,w=n.setDesc,_=n.create,L=f.get,C=i.Symbol,b=i.JSON,T=b&&b.stringify,x=!1,P=p("_hidden"),M=n.isEnum,I=u("symbol-registry"),R=u("symbols"),O="function"==typeof C,D=Object.prototype,N=a&&c((function(){return 7!=_(w({},"a",{get:function(){return w(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=E(D,t);n&&delete D[t],w(e,t,r),n&&e!==D&&w(D,t,n)}:w,k=function(e){var t=R[e]=_(C.prototype);return t._k=e,a&&x&&N(D,e,{configurable:!0,set:function(t){o(this,P)&&o(this[P],e)&&(this[P][e]=!1),N(this,e,S(1,t))}}),t},F=function(e){return"symbol"==typeof e},G=function(e,t,r){return r&&o(R,t)?(r.enumerable?(o(e,P)&&e[P][t]&&(e[P][t]=!1),r=_(r,{enumerable:S(0,!1)})):(o(e,P)||w(e,P,S(1,{})),e[P][t]=!0),N(e,t,r)):w(e,t,r)},B=function(e,t){v(e);for(var r,n=m(t=A(t)),i=0,o=n.length;o>i;)G(e,r=n[i++],t[r]);return e},U=function(e,t){return void 0===t?_(e):B(_(e),t)},q=function(e){var t=M.call(this,e);return!(t||!o(this,e)||!o(R,e)||o(this,P)&&this[P][e])||t},W=function(e,t){var r=E(e=A(e),t);return!r||!o(R,t)||o(e,P)&&e[P][t]||(r.enumerable=!0),r},H=function(e){for(var t,r=L(A(e)),n=[],i=0;r.length>i;)o(R,t=r[i++])||t==P||n.push(t);return n},j=function(e){for(var t,r=L(A(e)),n=[],i=0;r.length>i;)o(R,t=r[i++])&&n.push(R[t]);return n},V=c((function(){var e=C();return"[null]"!=T([e])||"{}"!=T({a:e})||"{}"!=T(Object(e))}));O||(C=function(){if(F(this))throw TypeError("Symbol is not a constructor");return k(d(arguments.length>0?arguments[0]:void 0))},l(C.prototype,"toString",(function(){return this._k})),F=function(e){return e instanceof C},n.create=U,n.isEnum=q,n.getDesc=W,n.setDesc=G,n.setDescs=B,n.getNames=f.get=H,n.getSymbols=j,a&&!r(41)&&l(D,"propertyIsEnumerable",q,!0));var z={for:function(e){return o(I,e+="")?I[e]:I[e]=C(e)},keyFor:function(e){return g(I,e)},useSetter:function(){x=!0},useSimple:function(){x=!1}};n.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),(function(e){var t=p(e);z[e]=O?t:k(t)})),x=!0,s(s.G+s.W,{Symbol:C}),s(s.S,"Symbol",z),s(s.S+s.F*!O,"Object",{create:U,defineProperty:G,defineProperties:B,getOwnPropertyDescriptor:W,getOwnPropertyNames:H,getOwnPropertySymbols:j}),b&&s(s.S+s.F*(!O||V),"JSON",{stringify:function(e){if(void 0!==e&&!F(e)){for(var t,r,n=[e],i=1,o=arguments;o.length>i;)n.push(o[i++]);return"function"==typeof(t=n[1])&&(r=t),!r&&y(t)||(t=function(e,t){if(r&&(t=r.call(this,e,t)),!F(t))return t}),n[1]=t,T.apply(b,n)}}}),h(C,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){e.exports=!r(19)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){var n=r(16),i=r(21),o=r(22),a="prototype",s=function(e,t,r){var l,c,u,h=e&s.F,d=e&s.G,p=e&s.S,g=e&s.P,f=e&s.B,m=e&s.W,y=d?i:i[t]||(i[t]={}),v=d?n:p?n[t]:(n[t]||{})[a];for(l in d&&(r=t),r)(c=!h&&v&&l in v)&&l in y||(u=c?v[l]:r[l],y[l]=d&&"function"!=typeof v[l]?r[l]:f&&c?o(u,n):m&&v[l]==u?function(e){var t=function(t){return this instanceof e?new e(t):e(t)};return t[a]=e[a],t}(u):g&&"function"==typeof u?o(Function.call,u):u,g&&((y[a]||(y[a]={}))[l]=u))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,e.exports=s},function(e,t){var r=e.exports={version:"1.2.6"};"number"==typeof __e&&(__e=r)},function(e,t,r){var n=r(23);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){e.exports=r(25)},function(e,t,r){var n=r(9),i=r(26);e.exports=r(18)?function(e,t,r){return n.setDesc(e,t,i(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(16),i="__core-js_shared__",o=n[i]||(n[i]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,r){var n=r(9).setDesc,i=r(17),o=r(29)("toStringTag");e.exports=function(e,t,r){e&&!i(e=r?e:e.prototype,o)&&n(e,o,{configurable:!0,value:t})}},function(e,t,r){var n=r(27)("wks"),i=r(30),o=r(16).Symbol;e.exports=function(e){return n[e]||(n[e]=o&&o[e]||(o||i)("Symbol."+e))}},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(9),i=r(32);e.exports=function(e,t){for(var r,o=i(e),a=n.getKeys(o),s=a.length,l=0;s>l;)if(o[r=a[l++]]===t)return r}},function(e,t,r){var n=r(33),i=r(35);e.exports=function(e){return n(i(e))}},function(e,t,r){var n=r(34);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,r){var n=r(32),i=r(9).getNames,o={}.toString,a="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.get=function(e){return a&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return a.slice()}}(e):i(n(e))}},function(e,t,r){var n=r(9);e.exports=function(e){var t=n.getKeys(e),r=n.getSymbols;if(r)for(var i,o=r(e),a=n.isEnum,s=0;o.length>s;)a.call(e,i=o[s++])&&t.push(i);return t}},function(e,t,r){var n=r(34);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){var n=r(40);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=!0},function(e,t){},function(e,t,r){e.exports={default:r(44),__esModule:!0}},function(e,t,r){r(45),r(51),e.exports=r(29)("iterator")},function(e,t,r){"use strict";var n=r(46)(!0);r(48)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,r=this._i;return r>=t.length?{value:void 0,done:!0}:(e=n(t,r),this._i+=e.length,{value:e,done:!1})}))},function(e,t,r){var n=r(47),i=r(35);e.exports=function(e){return function(t,r){var o,a,s=String(i(t)),l=n(r),c=s.length;return l<0||l>=c?e?"":void 0:(o=s.charCodeAt(l))<55296||o>56319||l+1===c||(a=s.charCodeAt(l+1))<56320||a>57343?e?s.charAt(l):o:e?s.slice(l,l+2):a-56320+(o-55296<<10)+65536}}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){"use strict";var n=r(41),i=r(20),o=r(24),a=r(25),s=r(17),l=r(49),c=r(50),u=r(28),h=r(9).getProto,d=r(29)("iterator"),p=!([].keys&&"next"in[].keys()),g="@@iterator",f="keys",m="values",y=function(){return this};e.exports=function(e,t,r,v,A,S,E){c(r,t,v);var w,_,L=function(e){if(!p&&e in x)return x[e];switch(e){case f:case m:return function(){return new r(this,e)}}return function(){return new r(this,e)}},C=t+" Iterator",b=A==m,T=!1,x=e.prototype,P=x[d]||x[g]||A&&x[A],M=P||L(A);if(P){var I=h(M.call(new e));u(I,C,!0),!n&&s(x,g)&&a(I,d,y),b&&P.name!==m&&(T=!0,M=function(){return P.call(this)})}if(n&&!E||!p&&!T&&x[d]||a(x,d,M),l[t]=M,l[C]=y,A)if(w={values:b?M:L(m),keys:S?M:L(f),entries:b?L("entries"):M},E)for(_ in w)_ in x||o(x,_,w[_]);else i(i.P+i.F*(p||T),t,w);return w}},function(e,t){e.exports={}},function(e,t,r){"use strict";var n=r(9),i=r(26),o=r(28),a={};r(25)(a,r(29)("iterator"),(function(){return this})),e.exports=function(e,t,r){e.prototype=n.create(a,{next:i(1,r)}),o(e,t+" Iterator")}},function(e,t,r){r(52);var n=r(49);n.NodeList=n.HTMLCollection=n.Array},function(e,t,r){"use strict";var n=r(53),i=r(54),o=r(49),a=r(32);e.exports=r(48)(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,r=this._i++;return!e||r>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?r:"values"==t?e[r]:[r,e[r]])}),"values"),o.Arguments=o.Array,n("keys"),n("values"),n("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,r){e.exports={default:r(56),__esModule:!0}},function(e,t,r){r(51),r(45),e.exports=r(57)},function(e,t,r){var n=r(39),i=r(58);e.exports=r(21).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},function(e,t,r){var n=r(59),i=r(29)("iterator"),o=r(49);e.exports=r(21).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[n(e)]}},function(e,t,r){var n=r(34),i=r(29)("toStringTag"),o="Arguments"==n(function(){return arguments}());e.exports=function(e){var t,r,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=(t=Object(e))[i])?r:o?n(t):"Object"==(a=n(t))&&"function"==typeof t.callee?"Arguments":a}},function(e,t,r){e.exports={default:r(61),__esModule:!0}},function(e,t,r){r(62),e.exports=r(21).Object.keys},function(e,t,r){var n=r(63);r(64)("keys",(function(e){return function(t){return e(n(t))}}))},function(e,t,r){var n=r(35);e.exports=function(e){return Object(n(e))}},function(e,t,r){var n=r(20),i=r(21),o=r(19);e.exports=function(e,t){var r=(i.Object||{})[e]||Object[e],a={};a[e]=t(r),n(n.S+n.F*o((function(){r(1)})),"Object",a)}},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(6));t.default=function(e){e.registerHelper("helperMissing",(function(){if(1!==arguments.length)throw new i.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=r(5),o=n(r(6));t.default=function(e){e.registerHelper("if",(function(e,t){if(2!=arguments.length)throw new o.default("#if requires exactly one argument");return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)})),e.registerHelper("unless",(function(t,r){if(2!=arguments.length)throw new o.default("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:r.inverse,inverse:r.fn,hash:r.hash})}))},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("log",(function(){for(var t=[void 0],r=arguments[arguments.length-1],n=0;n<arguments.length-1;n++)t.push(arguments[n]);var i=1;null!=r.hash.level?i=r.hash.level:r.data&&null!=r.data.level&&(i=r.data.level),t[0]=i,e.log.apply(e,t)}))},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){e.registerHelper("lookup",(function(e,t,r){return e?r.lookupProperty(e,t):e}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=r(5),o=n(r(6));t.default=function(e){e.registerHelper("with",(function(e,t){if(2!=arguments.length)throw new o.default("#with requires exactly one argument");i.isFunction(e)&&(e=e.call(this));var r=t.fn;if(i.isEmpty(e))return t.inverse(this);var n=t.data;return t.data&&t.ids&&((n=i.createFrame(t.data)).contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),r(e,{data:n,blockParams:i.blockParams([e],[n&&n.contextPath])})}))},e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.registerDefaultDecorators=function(e){i.default(e)};var i=n(r(71))},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5);t.default=function(e){e.registerDecorator("inline",(function(e,t,r,i){var o=e;return t.partials||(t.partials={},o=function(i,o){var a=r.partials;r.partials=n.extend({},a,t.partials);var s=e(i,o);return r.partials=a,s}),t.partials[i.args[0]]=i.fn,o}))},e.exports=t.default},function(e,t,r){"use strict";t.__esModule=!0;var n=r(5),i={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=n.indexOf(i.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=i.lookupLevel(e),"undefined"!=typeof console&&i.lookupLevel(i.level)<=e){var t=i.methodMap[e];console[t]||(t="log");for(var r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];console[t].apply(console,n)}}};t.default=i,e.exports=t.default},function(e,t,r){"use strict";var n=r(74).default,i=r(60).default,o=r(1).default;t.__esModule=!0,t.createProtoAccessControl=function(e){var t=n(null);t.constructor=!1,t.__defineGetter__=!1,t.__defineSetter__=!1,t.__lookupGetter__=!1;var r=n(null);return r.__proto__=!1,{properties:{whitelist:a.createNewLookupObject(r,e.allowedProtoProperties),defaultValue:e.allowProtoPropertiesByDefault},methods:{whitelist:a.createNewLookupObject(t,e.allowedProtoMethods),defaultValue:e.allowProtoMethodsByDefault}}},t.resultIsAllowed=function(e,t,r){return function(e,t){return void 0!==e.whitelist[t]?!0===e.whitelist[t]:void 0!==e.defaultValue?e.defaultValue:(function(e){!0!==l[e]&&(l[e]=!0,s.default.log("error",'Handlebars: Access has been denied to resolve the property "'+e+'" because it is not an "own property" of its parent.\nYou can add a runtime option to disable the check or this warning:\nSee https://handlebarsjs.com/api-reference/runtime-options.html#options-to-control-prototype-access for details'))}(t),!1)}("function"==typeof e?t.methods:t.properties,r)},t.resetLoggedProperties=function(){i(l).forEach((function(e){delete l[e]}))};var a=r(76),s=o(r(72)),l=n(null)},function(e,t,r){e.exports={default:r(75),__esModule:!0}},function(e,t,r){var n=r(9);e.exports=function(e,t){return n.create(e,t)}},function(e,t,r){"use strict";var n=r(74).default;t.__esModule=!0,t.createNewLookupObject=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return i.extend.apply(void 0,[n(null)].concat(t))};var i=r(5)},function(e,t){"use strict";function r(e){this.string=e}t.__esModule=!0,r.prototype.toString=r.prototype.toHTML=function(){return""+this.string},t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(79).default,i=r(60).default,o=r(3).default,a=r(1).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,r=c.COMPILER_REVISION;if(!(t>=c.LAST_COMPATIBLE_COMPILER_REVISION&&t<=c.COMPILER_REVISION)){if(t<c.LAST_COMPATIBLE_COMPILER_REVISION){var n=c.REVISION_CHANGES[r],i=c.REVISION_CHANGES[t];throw new l.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+n+") or downgrade your runtime to an older version ("+i+").")}throw new l.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){if(!t)throw new l.default("No environment passed to template");if(!e||!e.main)throw new l.default("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var r=e.compiler&&7===e.compiler[0],o={strict:function(e,t,r){if(!e||!(t in e))throw new l.default('"'+t+'" not defined in '+e,{loc:r});return o.lookupProperty(e,t)},lookupProperty:function(e,t){var r=e[t];return null==r||Object.prototype.hasOwnProperty.call(e,t)||d.resultIsAllowed(r,o.protoAccessControl,t)?r:void 0},lookup:function(e,t){for(var r=e.length,n=0;n<r;n++)if(null!=(e[n]&&o.lookupProperty(e[n],t)))return e[n][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:s.escapeExpression,invokePartial:function(r,n,i){i.hash&&(n=s.extend({},n,i.hash),i.ids&&(i.ids[0]=!0)),r=t.VM.resolvePartial.call(this,r,n,i);var o=s.extend({},i,{hooks:this.hooks,protoAccessControl:this.protoAccessControl}),a=t.VM.invokePartial.call(this,r,n,o);if(null==a&&t.compile&&(i.partials[i.name]=t.compile(r,e.compilerOptions,t),a=i.partials[i.name](n,o)),null!=a){if(i.indent){for(var c=a.split("\n"),u=0,h=c.length;u<h&&(c[u]||u+1!==h);u++)c[u]=i.indent+c[u];a=c.join("\n")}return a}throw new l.default("The partial "+i.name+" could not be compiled when running in runtime-only mode")},fn:function(t){var r=e[t];return r.decorator=e[t+"_d"],r},programs:[],program:function(e,t,r,n,i){var o=this.programs[e],a=this.fn(e);return t||i||n||r?o=p(this,e,a,t,r,n,i):o||(o=this.programs[e]=p(this,e,a)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},mergeIfNeeded:function(e,t){var r=e||t;return e&&t&&e!==t&&(r=s.extend({},t,e)),r},nullContext:n({}),noop:t.VM.noop,compilerInfo:e.compiler};function a(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=r.data;a._setup(r),!r.partial&&e.useData&&(n=function(e,t){return t&&"root"in t||((t=t?c.createFrame(t):{}).root=e),t}(t,n));var i=void 0,s=e.useBlockParams?[]:void 0;function l(t){return""+e.main(o,t,o.helpers,o.partials,n,s,i)}return e.useDepths&&(i=r.depths?t!=r.depths[0]?[t].concat(r.depths):r.depths:[t]),(l=f(e.main,l,o,r.depths||[],n,s))(t,r)}return a.isTop=!0,a._setup=function(n){if(n.partial)o.protoAccessControl=n.protoAccessControl,o.helpers=n.helpers,o.partials=n.partials,o.decorators=n.decorators,o.hooks=n.hooks;else{var a=s.extend({},t.helpers,n.helpers);!function(e,t){i(e).forEach((function(r){var n=e[r];e[r]=function(e,t){var r=t.lookupProperty;return h.wrapHelper(e,(function(e){return s.extend({lookupProperty:r},e)}))}(n,t)}))}(a,o),o.helpers=a,e.usePartial&&(o.partials=o.mergeIfNeeded(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(o.decorators=s.extend({},t.decorators,n.decorators)),o.hooks={},o.protoAccessControl=d.createProtoAccessControl(n);var l=n.allowCallsToHelperMissing||r;u.moveHelperToHooks(o,"helperMissing",l),u.moveHelperToHooks(o,"blockHelperMissing",l)}},a._child=function(t,r,n,i){if(e.useBlockParams&&!n)throw new l.default("must pass block params");if(e.useDepths&&!i)throw new l.default("must pass parent depths");return p(o,t,e[t],r,0,n,i)},a},t.wrapProgram=p,t.resolvePartial=function(e,t,r){return e?e.call||r.name||(r.name=e,e=r.partials[e]):e="@partial-block"===r.name?r.data["partial-block"]:r.partials[r.name],e},t.invokePartial=function(e,t,r){var n=r.data&&r.data["partial-block"];r.partial=!0,r.ids&&(r.data.contextPath=r.ids[0]||r.data.contextPath);var i=void 0;if(r.fn&&r.fn!==g&&function(){r.data=c.createFrame(r.data);var e=r.fn;i=r.data["partial-block"]=function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return r.data=c.createFrame(r.data),r.data["partial-block"]=n,e(t,r)},e.partials&&(r.partials=s.extend({},r.partials,e.partials))}(),void 0===e&&i&&(e=i),void 0===e)throw new l.default("The partial "+r.name+" could not be found");if(e instanceof Function)return e(t,r)},t.noop=g;var s=o(r(5)),l=a(r(6)),c=r(4),u=r(10),h=r(82),d=r(73);function p(e,t,r,n,i,o,a){function s(t){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],s=a;return!a||t==a[0]||t===e.nullContext&&null===a[0]||(s=[t].concat(a)),r(e,t,e.helpers,e.partials,i.data||n,o&&[i.blockParams].concat(o),s)}return(s=f(r,s,e,a,n,o)).program=t,s.depth=a?a.length:0,s.blockParams=i||0,s}function g(){return""}function f(e,t,r,n,i,o){if(e.decorator){var a={};t=e.decorator(t,a,r,n&&n[0],i,o,n),s.extend(t,a)}return t}},function(e,t,r){e.exports={default:r(80),__esModule:!0}},function(e,t,r){r(81),e.exports=r(21).Object.seal},function(e,t,r){var n=r(40);r(64)("seal",(function(e){return function(t){return e&&n(t)?e(t):t}}))},function(e,t){"use strict";t.__esModule=!0,t.wrapHelper=function(e,t){return"function"!=typeof e?e:function(){return arguments[arguments.length-1]=t(arguments[arguments.length-1]),e.apply(this,arguments)}}},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){"object"!=typeof globalThis&&(Object.prototype.__defineGetter__("__magic__",(function(){return this})),__magic__.globalThis=__magic__,delete Object.prototype.__magic__);var t=globalThis.Handlebars;e.noConflict=function(){return globalThis.Handlebars===e&&(globalThis.Handlebars=t),e}},e.exports=t.default},function(e,t){"use strict";t.__esModule=!0;var r={helpers:{helperExpression:function(e){return"SubExpression"===e.type||("MustacheStatement"===e.type||"BlockStatement"===e.type)&&!!(e.params&&e.params.length||e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!r.helpers.scopedId(e)&&!e.depth}}};t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default,i=r(3).default;t.__esModule=!0,t.parseWithoutProcessing=u,t.parse=function(e,t){var r=u(e,t);return new a.default(t).accept(r)};var o=n(r(86)),a=n(r(87)),s=i(r(89)),l=r(5);t.parser=o.default;var c={};function u(e,t){return"Program"===e.type?e:(o.default.yy=c,c.locInfo=function(e){return new c.SourceLocation(t&&t.srcName,e)},o.default.parse(e))}l.extend(c,s)},function(e,t){"use strict";t.__esModule=!0;var r=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,partialBlock:12,content:13,COMMENT:14,CONTENT:15,openRawBlock:16,rawBlock_repetition0:17,END_RAW_BLOCK:18,OPEN_RAW_BLOCK:19,helperName:20,openRawBlock_repetition0:21,openRawBlock_option0:22,CLOSE_RAW_BLOCK:23,openBlock:24,block_option0:25,closeBlock:26,openInverse:27,block_option1:28,OPEN_BLOCK:29,openBlock_repetition0:30,openBlock_option0:31,openBlock_option1:32,CLOSE:33,OPEN_INVERSE:34,openInverse_repetition0:35,openInverse_option0:36,openInverse_option1:37,openInverseChain:38,OPEN_INVERSE_CHAIN:39,openInverseChain_repetition0:40,openInverseChain_option0:41,openInverseChain_option1:42,inverseAndProgram:43,INVERSE:44,inverseChain:45,inverseChain_option0:46,OPEN_ENDBLOCK:47,OPEN:48,mustache_repetition0:49,mustache_option0:50,OPEN_UNESCAPED:51,mustache_repetition1:52,mustache_option1:53,CLOSE_UNESCAPED:54,OPEN_PARTIAL:55,partialName:56,partial_repetition0:57,partial_option0:58,openPartialBlock:59,OPEN_PARTIAL_BLOCK:60,openPartialBlock_repetition0:61,openPartialBlock_option0:62,param:63,sexpr:64,OPEN_SEXPR:65,sexpr_repetition0:66,sexpr_option0:67,CLOSE_SEXPR:68,hash:69,hash_repetition_plus0:70,hashSegment:71,ID:72,EQUALS:73,blockParams:74,OPEN_BLOCK_PARAMS:75,blockParams_repetition_plus0:76,CLOSE_BLOCK_PARAMS:77,path:78,dataName:79,STRING:80,NUMBER:81,BOOLEAN:82,UNDEFINED:83,NULL:84,DATA:85,pathSegments:86,SEP:87,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"COMMENT",15:"CONTENT",18:"END_RAW_BLOCK",19:"OPEN_RAW_BLOCK",23:"CLOSE_RAW_BLOCK",29:"OPEN_BLOCK",33:"CLOSE",34:"OPEN_INVERSE",39:"OPEN_INVERSE_CHAIN",44:"INVERSE",47:"OPEN_ENDBLOCK",48:"OPEN",51:"OPEN_UNESCAPED",54:"CLOSE_UNESCAPED",55:"OPEN_PARTIAL",60:"OPEN_PARTIAL_BLOCK",65:"OPEN_SEXPR",68:"CLOSE_SEXPR",72:"ID",73:"EQUALS",75:"OPEN_BLOCK_PARAMS",77:"CLOSE_BLOCK_PARAMS",80:"STRING",81:"NUMBER",82:"BOOLEAN",83:"UNDEFINED",84:"NULL",85:"DATA",87:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[13,1],[10,3],[16,5],[9,4],[9,4],[24,6],[27,6],[38,6],[43,2],[45,3],[45,1],[26,3],[8,5],[8,5],[11,5],[12,3],[59,5],[63,1],[63,1],[64,5],[69,1],[71,3],[74,3],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[20,1],[56,1],[56,1],[79,2],[78,1],[86,3],[86,1],[6,0],[6,2],[17,0],[17,2],[21,0],[21,2],[22,0],[22,1],[25,0],[25,1],[28,0],[28,1],[30,0],[30,2],[31,0],[31,1],[32,0],[32,1],[35,0],[35,2],[36,0],[36,1],[37,0],[37,1],[40,0],[40,2],[41,0],[41,1],[42,0],[42,1],[46,0],[46,1],[49,0],[49,2],[50,0],[50,1],[52,0],[52,2],[53,0],[53,1],[57,0],[57,2],[58,0],[58,1],[61,0],[61,2],[62,0],[62,1],[66,0],[66,2],[67,0],[67,1],[70,1],[70,2],[76,1],[76,2]],performAction:function(e,t,r,n,i,o,a){var s=o.length-1;switch(i){case 1:return o[s-1];case 2:this.$=n.prepareProgram(o[s]);break;case 3:case 4:case 5:case 6:case 7:case 8:case 20:case 27:case 28:case 33:case 34:case 40:case 41:this.$=o[s];break;case 9:this.$={type:"CommentStatement",value:n.stripComment(o[s]),strip:n.stripFlags(o[s],o[s]),loc:n.locInfo(this._$)};break;case 10:this.$={type:"ContentStatement",original:o[s],value:o[s],loc:n.locInfo(this._$)};break;case 11:this.$=n.prepareRawBlock(o[s-2],o[s-1],o[s],this._$);break;case 12:this.$={path:o[s-3],params:o[s-2],hash:o[s-1]};break;case 13:this.$=n.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!1,this._$);break;case 14:this.$=n.prepareBlock(o[s-3],o[s-2],o[s-1],o[s],!0,this._$);break;case 15:this.$={open:o[s-5],path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:n.stripFlags(o[s-5],o[s])};break;case 16:case 17:this.$={path:o[s-4],params:o[s-3],hash:o[s-2],blockParams:o[s-1],strip:n.stripFlags(o[s-5],o[s])};break;case 18:this.$={strip:n.stripFlags(o[s-1],o[s-1]),program:o[s]};break;case 19:var l=n.prepareBlock(o[s-2],o[s-1],o[s],o[s],!1,this._$),c=n.prepareProgram([l],o[s-1].loc);c.chained=!0,this.$={strip:o[s-2].strip,program:c,chain:!0};break;case 21:this.$={path:o[s-1],strip:n.stripFlags(o[s-2],o[s])};break;case 22:case 23:this.$=n.prepareMustache(o[s-3],o[s-2],o[s-1],o[s-4],n.stripFlags(o[s-4],o[s]),this._$);break;case 24:this.$={type:"PartialStatement",name:o[s-3],params:o[s-2],hash:o[s-1],indent:"",strip:n.stripFlags(o[s-4],o[s]),loc:n.locInfo(this._$)};break;case 25:this.$=n.preparePartialBlock(o[s-2],o[s-1],o[s],this._$);break;case 26:this.$={path:o[s-3],params:o[s-2],hash:o[s-1],strip:n.stripFlags(o[s-4],o[s])};break;case 29:this.$={type:"SubExpression",path:o[s-3],params:o[s-2],hash:o[s-1],loc:n.locInfo(this._$)};break;case 30:this.$={type:"Hash",pairs:o[s],loc:n.locInfo(this._$)};break;case 31:this.$={type:"HashPair",key:n.id(o[s-2]),value:o[s],loc:n.locInfo(this._$)};break;case 32:this.$=n.id(o[s-1]);break;case 35:this.$={type:"StringLiteral",value:o[s],original:o[s],loc:n.locInfo(this._$)};break;case 36:this.$={type:"NumberLiteral",value:Number(o[s]),original:Number(o[s]),loc:n.locInfo(this._$)};break;case 37:this.$={type:"BooleanLiteral",value:"true"===o[s],original:"true"===o[s],loc:n.locInfo(this._$)};break;case 38:this.$={type:"UndefinedLiteral",original:void 0,value:void 0,loc:n.locInfo(this._$)};break;case 39:this.$={type:"NullLiteral",original:null,value:null,loc:n.locInfo(this._$)};break;case 42:this.$=n.preparePath(!0,o[s],this._$);break;case 43:this.$=n.preparePath(!1,o[s],this._$);break;case 44:o[s-2].push({part:n.id(o[s]),original:o[s],separator:o[s-1]}),this.$=o[s-2];break;case 45:this.$=[{part:n.id(o[s]),original:o[s]}];break;case 46:case 48:case 50:case 58:case 64:case 70:case 78:case 82:case 86:case 90:case 94:this.$=[];break;case 47:case 49:case 51:case 59:case 65:case 71:case 79:case 83:case 87:case 91:case 95:case 99:case 101:o[s-1].push(o[s]);break;case 98:case 100:this.$=[o[s]]}},table:[{3:1,4:2,5:[2,46],6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:11,14:[1,12],15:[1,20],16:17,19:[1,23],24:15,27:16,29:[1,21],34:[1,22],39:[2,2],44:[2,2],47:[2,2],48:[1,13],51:[1,14],55:[1,18],59:19,60:[1,24]},{1:[2,1]},{5:[2,47],14:[2,47],15:[2,47],19:[2,47],29:[2,47],34:[2,47],39:[2,47],44:[2,47],47:[2,47],48:[2,47],51:[2,47],55:[2,47],60:[2,47]},{5:[2,3],14:[2,3],15:[2,3],19:[2,3],29:[2,3],34:[2,3],39:[2,3],44:[2,3],47:[2,3],48:[2,3],51:[2,3],55:[2,3],60:[2,3]},{5:[2,4],14:[2,4],15:[2,4],19:[2,4],29:[2,4],34:[2,4],39:[2,4],44:[2,4],47:[2,4],48:[2,4],51:[2,4],55:[2,4],60:[2,4]},{5:[2,5],14:[2,5],15:[2,5],19:[2,5],29:[2,5],34:[2,5],39:[2,5],44:[2,5],47:[2,5],48:[2,5],51:[2,5],55:[2,5],60:[2,5]},{5:[2,6],14:[2,6],15:[2,6],19:[2,6],29:[2,6],34:[2,6],39:[2,6],44:[2,6],47:[2,6],48:[2,6],51:[2,6],55:[2,6],60:[2,6]},{5:[2,7],14:[2,7],15:[2,7],19:[2,7],29:[2,7],34:[2,7],39:[2,7],44:[2,7],47:[2,7],48:[2,7],51:[2,7],55:[2,7],60:[2,7]},{5:[2,8],14:[2,8],15:[2,8],19:[2,8],29:[2,8],34:[2,8],39:[2,8],44:[2,8],47:[2,8],48:[2,8],51:[2,8],55:[2,8],60:[2,8]},{5:[2,9],14:[2,9],15:[2,9],19:[2,9],29:[2,9],34:[2,9],39:[2,9],44:[2,9],47:[2,9],48:[2,9],51:[2,9],55:[2,9],60:[2,9]},{20:25,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:36,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:37,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{4:38,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{15:[2,48],17:39,18:[2,48]},{20:41,56:40,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:44,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{5:[2,10],14:[2,10],15:[2,10],18:[2,10],19:[2,10],29:[2,10],34:[2,10],39:[2,10],44:[2,10],47:[2,10],48:[2,10],51:[2,10],55:[2,10],60:[2,10]},{20:45,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:46,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:47,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:41,56:48,64:42,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[2,78],49:49,65:[2,78],72:[2,78],80:[2,78],81:[2,78],82:[2,78],83:[2,78],84:[2,78],85:[2,78]},{23:[2,33],33:[2,33],54:[2,33],65:[2,33],68:[2,33],72:[2,33],75:[2,33],80:[2,33],81:[2,33],82:[2,33],83:[2,33],84:[2,33],85:[2,33]},{23:[2,34],33:[2,34],54:[2,34],65:[2,34],68:[2,34],72:[2,34],75:[2,34],80:[2,34],81:[2,34],82:[2,34],83:[2,34],84:[2,34],85:[2,34]},{23:[2,35],33:[2,35],54:[2,35],65:[2,35],68:[2,35],72:[2,35],75:[2,35],80:[2,35],81:[2,35],82:[2,35],83:[2,35],84:[2,35],85:[2,35]},{23:[2,36],33:[2,36],54:[2,36],65:[2,36],68:[2,36],72:[2,36],75:[2,36],80:[2,36],81:[2,36],82:[2,36],83:[2,36],84:[2,36],85:[2,36]},{23:[2,37],33:[2,37],54:[2,37],65:[2,37],68:[2,37],72:[2,37],75:[2,37],80:[2,37],81:[2,37],82:[2,37],83:[2,37],84:[2,37],85:[2,37]},{23:[2,38],33:[2,38],54:[2,38],65:[2,38],68:[2,38],72:[2,38],75:[2,38],80:[2,38],81:[2,38],82:[2,38],83:[2,38],84:[2,38],85:[2,38]},{23:[2,39],33:[2,39],54:[2,39],65:[2,39],68:[2,39],72:[2,39],75:[2,39],80:[2,39],81:[2,39],82:[2,39],83:[2,39],84:[2,39],85:[2,39]},{23:[2,43],33:[2,43],54:[2,43],65:[2,43],68:[2,43],72:[2,43],75:[2,43],80:[2,43],81:[2,43],82:[2,43],83:[2,43],84:[2,43],85:[2,43],87:[1,50]},{72:[1,35],86:51},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{52:52,54:[2,82],65:[2,82],72:[2,82],80:[2,82],81:[2,82],82:[2,82],83:[2,82],84:[2,82],85:[2,82]},{25:53,38:55,39:[1,57],43:56,44:[1,58],45:54,47:[2,54]},{28:59,43:60,44:[1,58],47:[2,56]},{13:62,15:[1,20],18:[1,61]},{33:[2,86],57:63,65:[2,86],72:[2,86],80:[2,86],81:[2,86],82:[2,86],83:[2,86],84:[2,86],85:[2,86]},{33:[2,40],65:[2,40],72:[2,40],80:[2,40],81:[2,40],82:[2,40],83:[2,40],84:[2,40],85:[2,40]},{33:[2,41],65:[2,41],72:[2,41],80:[2,41],81:[2,41],82:[2,41],83:[2,41],84:[2,41],85:[2,41]},{20:64,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:65,47:[1,66]},{30:67,33:[2,58],65:[2,58],72:[2,58],75:[2,58],80:[2,58],81:[2,58],82:[2,58],83:[2,58],84:[2,58],85:[2,58]},{33:[2,64],35:68,65:[2,64],72:[2,64],75:[2,64],80:[2,64],81:[2,64],82:[2,64],83:[2,64],84:[2,64],85:[2,64]},{21:69,23:[2,50],65:[2,50],72:[2,50],80:[2,50],81:[2,50],82:[2,50],83:[2,50],84:[2,50],85:[2,50]},{33:[2,90],61:70,65:[2,90],72:[2,90],80:[2,90],81:[2,90],82:[2,90],83:[2,90],84:[2,90],85:[2,90]},{20:74,33:[2,80],50:71,63:72,64:75,65:[1,43],69:73,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{72:[1,79]},{23:[2,42],33:[2,42],54:[2,42],65:[2,42],68:[2,42],72:[2,42],75:[2,42],80:[2,42],81:[2,42],82:[2,42],83:[2,42],84:[2,42],85:[2,42],87:[1,50]},{20:74,53:80,54:[2,84],63:81,64:75,65:[1,43],69:82,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{26:83,47:[1,66]},{47:[2,55]},{4:84,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],39:[2,46],44:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{47:[2,20]},{20:85,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{4:86,6:3,14:[2,46],15:[2,46],19:[2,46],29:[2,46],34:[2,46],47:[2,46],48:[2,46],51:[2,46],55:[2,46],60:[2,46]},{26:87,47:[1,66]},{47:[2,57]},{5:[2,11],14:[2,11],15:[2,11],19:[2,11],29:[2,11],34:[2,11],39:[2,11],44:[2,11],47:[2,11],48:[2,11],51:[2,11],55:[2,11],60:[2,11]},{15:[2,49],18:[2,49]},{20:74,33:[2,88],58:88,63:89,64:75,65:[1,43],69:90,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{65:[2,94],66:91,68:[2,94],72:[2,94],80:[2,94],81:[2,94],82:[2,94],83:[2,94],84:[2,94],85:[2,94]},{5:[2,25],14:[2,25],15:[2,25],19:[2,25],29:[2,25],34:[2,25],39:[2,25],44:[2,25],47:[2,25],48:[2,25],51:[2,25],55:[2,25],60:[2,25]},{20:92,72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,31:93,33:[2,60],63:94,64:75,65:[1,43],69:95,70:76,71:77,72:[1,78],75:[2,60],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,66],36:96,63:97,64:75,65:[1,43],69:98,70:76,71:77,72:[1,78],75:[2,66],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,22:99,23:[2,52],63:100,64:75,65:[1,43],69:101,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{20:74,33:[2,92],62:102,63:103,64:75,65:[1,43],69:104,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,105]},{33:[2,79],65:[2,79],72:[2,79],80:[2,79],81:[2,79],82:[2,79],83:[2,79],84:[2,79],85:[2,79]},{33:[2,81]},{23:[2,27],33:[2,27],54:[2,27],65:[2,27],68:[2,27],72:[2,27],75:[2,27],80:[2,27],81:[2,27],82:[2,27],83:[2,27],84:[2,27],85:[2,27]},{23:[2,28],33:[2,28],54:[2,28],65:[2,28],68:[2,28],72:[2,28],75:[2,28],80:[2,28],81:[2,28],82:[2,28],83:[2,28],84:[2,28],85:[2,28]},{23:[2,30],33:[2,30],54:[2,30],68:[2,30],71:106,72:[1,107],75:[2,30]},{23:[2,98],33:[2,98],54:[2,98],68:[2,98],72:[2,98],75:[2,98]},{23:[2,45],33:[2,45],54:[2,45],65:[2,45],68:[2,45],72:[2,45],73:[1,108],75:[2,45],80:[2,45],81:[2,45],82:[2,45],83:[2,45],84:[2,45],85:[2,45],87:[2,45]},{23:[2,44],33:[2,44],54:[2,44],65:[2,44],68:[2,44],72:[2,44],75:[2,44],80:[2,44],81:[2,44],82:[2,44],83:[2,44],84:[2,44],85:[2,44],87:[2,44]},{54:[1,109]},{54:[2,83],65:[2,83],72:[2,83],80:[2,83],81:[2,83],82:[2,83],83:[2,83],84:[2,83],85:[2,83]},{54:[2,85]},{5:[2,13],14:[2,13],15:[2,13],19:[2,13],29:[2,13],34:[2,13],39:[2,13],44:[2,13],47:[2,13],48:[2,13],51:[2,13],55:[2,13],60:[2,13]},{38:55,39:[1,57],43:56,44:[1,58],45:111,46:110,47:[2,76]},{33:[2,70],40:112,65:[2,70],72:[2,70],75:[2,70],80:[2,70],81:[2,70],82:[2,70],83:[2,70],84:[2,70],85:[2,70]},{47:[2,18]},{5:[2,14],14:[2,14],15:[2,14],19:[2,14],29:[2,14],34:[2,14],39:[2,14],44:[2,14],47:[2,14],48:[2,14],51:[2,14],55:[2,14],60:[2,14]},{33:[1,113]},{33:[2,87],65:[2,87],72:[2,87],80:[2,87],81:[2,87],82:[2,87],83:[2,87],84:[2,87],85:[2,87]},{33:[2,89]},{20:74,63:115,64:75,65:[1,43],67:114,68:[2,96],69:116,70:76,71:77,72:[1,78],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{33:[1,117]},{32:118,33:[2,62],74:119,75:[1,120]},{33:[2,59],65:[2,59],72:[2,59],75:[2,59],80:[2,59],81:[2,59],82:[2,59],83:[2,59],84:[2,59],85:[2,59]},{33:[2,61],75:[2,61]},{33:[2,68],37:121,74:122,75:[1,120]},{33:[2,65],65:[2,65],72:[2,65],75:[2,65],80:[2,65],81:[2,65],82:[2,65],83:[2,65],84:[2,65],85:[2,65]},{33:[2,67],75:[2,67]},{23:[1,123]},{23:[2,51],65:[2,51],72:[2,51],80:[2,51],81:[2,51],82:[2,51],83:[2,51],84:[2,51],85:[2,51]},{23:[2,53]},{33:[1,124]},{33:[2,91],65:[2,91],72:[2,91],80:[2,91],81:[2,91],82:[2,91],83:[2,91],84:[2,91],85:[2,91]},{33:[2,93]},{5:[2,22],14:[2,22],15:[2,22],19:[2,22],29:[2,22],34:[2,22],39:[2,22],44:[2,22],47:[2,22],48:[2,22],51:[2,22],55:[2,22],60:[2,22]},{23:[2,99],33:[2,99],54:[2,99],68:[2,99],72:[2,99],75:[2,99]},{73:[1,108]},{20:74,63:125,64:75,65:[1,43],72:[1,35],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,23],14:[2,23],15:[2,23],19:[2,23],29:[2,23],34:[2,23],39:[2,23],44:[2,23],47:[2,23],48:[2,23],51:[2,23],55:[2,23],60:[2,23]},{47:[2,19]},{47:[2,77]},{20:74,33:[2,72],41:126,63:127,64:75,65:[1,43],69:128,70:76,71:77,72:[1,78],75:[2,72],78:26,79:27,80:[1,28],81:[1,29],82:[1,30],83:[1,31],84:[1,32],85:[1,34],86:33},{5:[2,24],14:[2,24],15:[2,24],19:[2,24],29:[2,24],34:[2,24],39:[2,24],44:[2,24],47:[2,24],48:[2,24],51:[2,24],55:[2,24],60:[2,24]},{68:[1,129]},{65:[2,95],68:[2,95],72:[2,95],80:[2,95],81:[2,95],82:[2,95],83:[2,95],84:[2,95],85:[2,95]},{68:[2,97]},{5:[2,21],14:[2,21],15:[2,21],19:[2,21],29:[2,21],34:[2,21],39:[2,21],44:[2,21],47:[2,21],48:[2,21],51:[2,21],55:[2,21],60:[2,21]},{33:[1,130]},{33:[2,63]},{72:[1,132],76:131},{33:[1,133]},{33:[2,69]},{15:[2,12],18:[2,12]},{14:[2,26],15:[2,26],19:[2,26],29:[2,26],34:[2,26],47:[2,26],48:[2,26],51:[2,26],55:[2,26],60:[2,26]},{23:[2,31],33:[2,31],54:[2,31],68:[2,31],72:[2,31],75:[2,31]},{33:[2,74],42:134,74:135,75:[1,120]},{33:[2,71],65:[2,71],72:[2,71],75:[2,71],80:[2,71],81:[2,71],82:[2,71],83:[2,71],84:[2,71],85:[2,71]},{33:[2,73],75:[2,73]},{23:[2,29],33:[2,29],54:[2,29],65:[2,29],68:[2,29],72:[2,29],75:[2,29],80:[2,29],81:[2,29],82:[2,29],83:[2,29],84:[2,29],85:[2,29]},{14:[2,15],15:[2,15],19:[2,15],29:[2,15],34:[2,15],39:[2,15],44:[2,15],47:[2,15],48:[2,15],51:[2,15],55:[2,15],60:[2,15]},{72:[1,137],77:[1,136]},{72:[2,100],77:[2,100]},{14:[2,16],15:[2,16],19:[2,16],29:[2,16],34:[2,16],44:[2,16],47:[2,16],48:[2,16],51:[2,16],55:[2,16],60:[2,16]},{33:[1,138]},{33:[2,75]},{33:[2,32]},{72:[2,101],77:[2,101]},{14:[2,17],15:[2,17],19:[2,17],29:[2,17],34:[2,17],39:[2,17],44:[2,17],47:[2,17],48:[2,17],51:[2,17],55:[2,17],60:[2,17]}],defaultActions:{4:[2,1],54:[2,55],56:[2,20],60:[2,57],73:[2,81],82:[2,85],86:[2,18],90:[2,89],101:[2,53],104:[2,93],110:[2,19],111:[2,77],116:[2,97],119:[2,63],122:[2,69],135:[2,75],136:[2,32]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=[0],r=[null],n=[],i=this.table,o="",a=0,s=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var c=this.lexer.yylloc;n.push(c);var u=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,d,p,g,f,m,y,v,A,S,E={};;){if(p=t[t.length-1],this.defaultActions[p]?g=this.defaultActions[p]:(null==h&&(S=void 0,"number"!=typeof(S=this.lexer.lex()||1)&&(S=this.symbols_[S]||S),h=S),g=i[p]&&i[p][h]),void 0===g||!g.length||!g[0]){var w="";if(!l){for(m in A=[],i[p])this.terminals_[m]&&m>2&&A.push("'"+this.terminals_[m]+"'");w=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:c,expected:A})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+h);switch(g[0]){case 1:t.push(h),r.push(this.lexer.yytext),n.push(this.lexer.yylloc),t.push(g[1]),h=null,d?(h=d,d=null):(s=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,c=this.lexer.yylloc,l>0&&l--);break;case 2:if(y=this.productions_[g[1]][1],E.$=r[r.length-y],E._$={first_line:n[n.length-(y||1)].first_line,last_line:n[n.length-1].last_line,first_column:n[n.length-(y||1)].first_column,last_column:n[n.length-1].last_column},u&&(E._$.range=[n[n.length-(y||1)].range[0],n[n.length-1].range[1]]),void 0!==(f=this.performAction.call(E,o,s,a,this.yy,g[1],r,n)))return f;y&&(t=t.slice(0,-1*y*2),r=r.slice(0,-1*y),n=n.slice(0,-1*y)),t.push(this.productions_[g[1]][0]),r.push(E.$),n.push(E._$),v=i[t[t.length-2]][t[t.length-1]],t.push(v);break;case 3:return!0}}return!0}},t={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,r=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),r.length-1&&(this.yylineno-=r.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:r?(r.length===n.length?this.yylloc.first_column:0)+n[n.length-r.length].length-r[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,r,n,i;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),a=0;a<o.length&&(!(r=this._input.match(this.rules[o[a]]))||t&&!(r[0].length>t[0].length)||(t=r,n=a,this.options.flex));a++);return t?((i=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,r,n){function i(e,r){return t.yytext=t.yytext.substring(e,t.yyleng-r+e)}switch(r){case 0:if("\\\\"===t.yytext.slice(-2)?(i(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(i(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 15;break;case 1:case 5:return 15;case 2:return this.popState(),15;case 3:return this.begin("raw"),15;case 4:return this.popState(),"raw"===this.conditionStack[this.conditionStack.length-1]?15:(i(5,9),"END_RAW_BLOCK");case 6:case 22:return this.popState(),14;case 7:return 65;case 8:return 68;case 9:return 19;case 10:return this.popState(),this.begin("raw"),23;case 11:return 55;case 12:return 60;case 13:return 29;case 14:return 47;case 15:case 16:return this.popState(),44;case 17:return 34;case 18:return 39;case 19:return 51;case 20:case 23:return 48;case 21:this.unput(t.yytext),this.popState(),this.begin("com");break;case 24:return 73;case 25:case 26:case 41:return 72;case 27:return 87;case 28:break;case 29:return this.popState(),54;case 30:return this.popState(),33;case 31:return t.yytext=i(1,2).replace(/\\"/g,'"'),80;case 32:return t.yytext=i(1,2).replace(/\\'/g,"'"),80;case 33:return 85;case 34:case 35:return 82;case 36:return 83;case 37:return 84;case 38:return 81;case 39:return 75;case 40:return 77;case 42:return t.yytext=t.yytext.replace(/\\([\\\]])/g,"$1"),72;case 43:return"INVALID";case 44:return 5}},rules:[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{(?=[^/]))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]+?(?=(\{\{\{\{)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#>)/,/^(?:\{\{(~)?#\*?)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?\*?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[(\\\]|[^\]])*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[6],inclusive:!1},raw:{rules:[3,4,5],inclusive:!1},INITIAL:{rules:[0,1,44],inclusive:!0}}};function r(){this.yy={}}return e.lexer=t,r.prototype=e,e.Parser=r,new r}();t.default=r,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(88));function o(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.options=e}function a(e,t,r){void 0===t&&(t=e.length);var n=e[t-1],i=e[t-2];return n?"ContentStatement"===n.type?(i||!r?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(n.original):void 0:r}function s(e,t,r){void 0===t&&(t=-1);var n=e[t+1],i=e[t+2];return n?"ContentStatement"===n.type?(i||!r?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(n.original):void 0:r}function l(e,t,r){var n=e[null==t?0:t+1];if(n&&"ContentStatement"===n.type&&(r||!n.rightStripped)){var i=n.value;n.value=n.value.replace(r?/^\s+/:/^[ \t]*\r?\n?/,""),n.rightStripped=n.value!==i}}function c(e,t,r){var n=e[null==t?e.length-1:t-1];if(n&&"ContentStatement"===n.type&&(r||!n.leftStripped)){var i=n.value;return n.value=n.value.replace(r?/\s+$/:/[ \t]+$/,""),n.leftStripped=n.value!==i,n.leftStripped}}o.prototype=new i.default,o.prototype.Program=function(e){var t=!this.options.ignoreStandalone,r=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,o=n.length;i<o;i++){var u=n[i],h=this.accept(u);if(h){var d=a(n,i,r),p=s(n,i,r),g=h.openStandalone&&d,f=h.closeStandalone&&p,m=h.inlineStandalone&&d&&p;h.close&&l(n,i,!0),h.open&&c(n,i,!0),t&&m&&(l(n,i),c(n,i)&&"PartialStatement"===u.type&&(u.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),t&&g&&(l((u.program||u.inverse).body),c(n,i)),t&&f&&(l(n,i),c((u.inverse||u.program).body))}}return e},o.prototype.BlockStatement=o.prototype.DecoratorBlock=o.prototype.PartialBlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,r=e.program&&e.inverse,n=r,i=r;if(r&&r.chained)for(n=r.body[0].program;i.chained;)i=i.body[i.body.length-1].program;var o={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:s(t.body),closeStandalone:a((n||t).body)};if(e.openStrip.close&&l(t.body,null,!0),r){var u=e.inverseStrip;u.open&&c(t.body,null,!0),u.close&&l(n.body,null,!0),e.closeStrip.open&&c(i.body,null,!0),!this.options.ignoreStandalone&&a(t.body)&&s(n.body)&&(c(t.body),l(n.body))}else e.closeStrip.open&&c(t.body,null,!0);return o},o.prototype.Decorator=o.prototype.MustacheStatement=function(e){return e.strip},o.prototype.PartialStatement=o.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=o,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0;var i=n(r(6));function o(){this.parents=[]}function a(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")}function s(e){a.call(this,e),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")}function l(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")}o.prototype={constructor:o,mutating:!1,acceptKey:function(e,t){var r=this.accept(e[t]);if(this.mutating){if(r&&!o.prototype[r.type])throw new i.default('Unexpected node type "'+r.type+'" found when accepting '+t+" on "+e.type);e[t]=r}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new i.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,r=e.length;t<r;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,r--)},accept:function(e){if(e){if(!this[e.type])throw new i.default("Unknown type: "+e.type,e);this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:a,Decorator:a,BlockStatement:s,DecoratorBlock:s,PartialStatement:l,PartialBlockStatement:function(e){l.call(this,e),this.acceptKey(e,"program")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:a,PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=o,e.exports=t.default},function(e,t,r){"use strict";var n=r(1).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substring(1,e.length-1):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,r){r=this.locInfo(r);for(var n=e?"@":"",o=[],a=0,s=0,l=t.length;s<l;s++){var c=t[s].part,u=t[s].original!==c;if(n+=(t[s].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)o.push(c);else{if(o.length>0)throw new i.default("Invalid path: "+n,{loc:r});".."===c&&a++}}return{type:"PathExpression",data:e,depth:a,parts:o,original:n,loc:r}},t.prepareMustache=function(e,t,r,n,i,o){var a=n.charAt(3)||n.charAt(2),s="{"!==a&&"&"!==a;return{type:/\*/.test(n)?"Decorator":"MustacheStatement",path:e,params:t,hash:r,escaped:s,strip:i,loc:this.locInfo(o)}},t.prepareRawBlock=function(e,t,r,n){o(e,r);var i={type:"Program",body:t,strip:{},loc:n=this.locInfo(n)};return{type:"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:i,openStrip:{},inverseStrip:{},closeStrip:{},loc:n}},t.prepareBlock=function(e,t,r,n,a,s){n&&n.path&&o(e,n);var l=/\*/.test(e.open);t.blockParams=e.blockParams;var c=void 0,u=void 0;if(r){if(l)throw new i.default("Unexpected inverse block on decorator",r);r.chain&&(r.program.body[0].closeStrip=n.strip),u=r.strip,c=r.program}return a&&(a=c,c=t,t=a),{type:l?"DecoratorBlock":"BlockStatement",path:e.path,params:e.params,hash:e.hash,program:t,inverse:c,openStrip:e.strip,inverseStrip:u,closeStrip:n&&n.strip,loc:this.locInfo(s)}},t.prepareProgram=function(e,t){if(!t&&e.length){var r=e[0].loc,n=e[e.length-1].loc;r&&n&&(t={source:r.source,start:{line:r.start.line,column:r.start.column},end:{line:n.end.line,column:n.end.column}})}return{type:"Program",body:e,strip:{},loc:t}},t.preparePartialBlock=function(e,t,r,n){return o(e,r),{type:"PartialBlockStatement",name:e.path,params:e.params,hash:e.hash,program:t,openStrip:e.strip,closeStrip:r&&r.strip,loc:this.locInfo(n)}};var i=n(r(6));function o(e,t){if(t=t.path?t.path.original:t,e.path.original!==t){var r={loc:e.path.loc};throw new i.default(e.path.original+" doesn't match "+t,r)}}},function(e,t,r){"use strict";var n=r(74).default,i=r(1).default;t.__esModule=!0,t.Compiler=c,t.precompile=function(e,t,r){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var n=r.parse(e,t),i=(new r.Compiler).compile(n,t);return(new r.JavaScriptCompiler).compile(i,t)},t.compile=function(e,t,r){if(void 0===t&&(t={}),null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in(t=a.extend({},t))||(t.data=!0),t.compat&&(t.useDepths=!0);var n=void 0;function i(){var n=r.parse(e,t),i=(new r.Compiler).compile(n,t),o=(new r.JavaScriptCompiler).compile(i,t,void 0,!0);return r.template(o)}function s(e,t){return n||(n=i()),n.call(this,e,t)}return s._setup=function(e){return n||(n=i()),n._setup(e)},s._child=function(e,t,r,o){return n||(n=i()),n._child(e,t,r,o)},s};var o=i(r(6)),a=r(5),s=i(r(84)),l=[].slice;function c(){}function u(e,t){if(e===t)return!0;if(a.isArray(e)&&a.isArray(t)&&e.length===t.length){for(var r=0;r<e.length;r++)if(!u(e[r],t[r]))return!1;return!0}}function h(e){if(!e.path.parts){var t=e.path;e.path={type:"PathExpression",data:!1,depth:0,parts:[t.original+""],original:t.original+"",loc:t.loc}}}c.prototype={compiler:c,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var r=0;r<t;r++){var n=this.opcodes[r],i=e.opcodes[r];if(n.opcode!==i.opcode||!u(n.args,i.args))return!1}for(t=this.children.length,r=0;r<t;r++)if(!this.children[r].equals(e.children[r]))return!1;return!0},guid:0,compile:function(e,t){return this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[],t.knownHelpers=a.extend(n(null),{helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},t.knownHelpers),this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),r=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[r]=t,this.useDepths=this.useDepths||t.useDepths,r},accept:function(e){if(!this[e.type])throw new o.default("Unknown type: "+e.type,e);this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,r=t.length,n=0;n<r;n++)this.accept(t[n]);return this.options.blockParams.shift(),this.isSimple=1===r,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){h(e);var t=e.program,r=e.inverse;t=t&&this.compileProgram(t),r=r&&this.compileProgram(r);var n=this.classifySexpr(e);"helper"===n?this.helperSexpr(e,t,r):"simple"===n?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,r),this.opcode("pushProgram",t),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},DecoratorBlock:function(e){var t=e.program&&this.compileProgram(e.program),r=this.setupFullMustacheParams(e,t,void 0),n=e.path;this.useDecorators=!0,this.opcode("registerDecorator",r.length,n.original)},PartialStatement:function(e){this.usePartial=!0;var t=e.program;t&&(t=this.compileProgram(e.program));var r=e.params;if(r.length>1)throw new o.default("Unsupported number of partial arguments: "+r.length,e);r.length||(this.options.explicitPartialContext?this.opcode("pushLiteral","undefined"):r.push({type:"PathExpression",parts:[],depth:0}));var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,t,void 0,!0);var a=e.indent||"";this.options.preventIndent&&a&&(this.opcode("appendContent",a),a=""),this.opcode("invokePartial",i,n,a),this.opcode("append")},PartialBlockStatement:function(e){this.PartialStatement(e)},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},Decorator:function(e){this.DecoratorBlock(e)},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){h(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,r){var n=e.path,i=n.parts[0],o=null!=t||null!=r;this.opcode("getContext",n.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",r),n.strict=!0,this.accept(n),this.opcode("invokeAmbiguous",i,o)},simpleSexpr:function(e){var t=e.path;t.strict=!0,this.accept(t),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,r){var n=this.setupFullMustacheParams(e,t,r),i=e.path,a=i.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",n.length,a);else{if(this.options.knownHelpersOnly)throw new o.default("You specified knownHelpersOnly, but used the unknown helper "+a,e);i.strict=!0,i.falsy=!0,this.accept(i),this.opcode("invokeHelper",n.length,i.original,s.default.helpers.simpleId(i))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],r=s.default.helpers.scopedId(e),n=!e.depth&&!r&&this.blockParamIndex(t);n?this.opcode("lookupBlockParam",n,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts,e.strict)):this.opcode("lookupOnContext",e.parts,e.falsy,e.strict,r):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,r=0,n=t.length;for(this.opcode("pushHash");r<n;r++)this.pushParam(t[r].value);for(;r--;)this.opcode("assignToHash",t[r].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:l.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=s.default.helpers.simpleId(e.path),r=t&&!!this.blockParamIndex(e.path.parts[0]),n=!r&&s.default.helpers.helperExpression(e),i=!r&&(n||t);if(i&&!n){var o=e.path.parts[0],a=this.options;a.knownHelpers[o]?n=!0:a.knownHelpersOnly&&(i=!1)}return n?"helper":i?"ambiguous":"simple"},pushParams:function(e){for(var t=0,r=e.length;t<r;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var r=void 0;if(!e.parts||s.default.helpers.scopedId(e)||e.depth||(r=this.blockParamIndex(e.parts[0])),r){var n=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",r,n)}else(t=e.original||t).replace&&(t=t.replace(/^this(?:\.|$)/,"").replace(/^\.\//,"").replace(/^\.$/,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,r,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",r),e.hash?this.accept(e.hash):this.opcode("emptyHash",n),i},blockParamIndex:function(e){for(var t=0,r=this.options.blockParams.length;t<r;t++){var n=this.options.blockParams[t],i=n&&a.indexOf(n,e);if(n&&i>=0)return[t,i]}}}},function(e,t,r){"use strict";var n=r(60).default,i=r(1).default;t.__esModule=!0;var o=r(4),a=i(r(6)),s=r(5),l=i(r(92));function c(e){this.value=e}function u(){}u.prototype={nameLookup:function(e,t){return this.internalNameLookup(e,t)},depthedLookup:function(e){return[this.aliasable("container.lookup"),"(depths, ",JSON.stringify(e),")"]},compilerInfo:function(){var e=o.COMPILER_REVISION;return[e,o.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,r){return s.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:r?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},internalNameLookup:function(e,t){return this.lookupPropertyFunctionIsUsed=!0,["lookupProperty(",e,",",JSON.stringify(t),")"]},lookupPropertyFunctionIsUsed:!1,compile:function(e,t,r,n){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!n,this.name=this.environment.name,this.isChild=!!r,this.context=r||{decorators:[],programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||e.useDecorators||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var i=e.opcodes,o=void 0,s=void 0,l=void 0,c=void 0;for(l=0,c=i.length;l<c;l++)o=i[l],this.source.currentLocation=o.loc,s=s||o.loc,this[o.opcode].apply(this,o.args);if(this.source.currentLocation=s,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new a.default("Compile completed with content left on stack");this.decorators.isEmpty()?this.decorators=void 0:(this.useDecorators=!0,this.decorators.prepend(["var decorators = container.decorators, ",this.lookupPropertyFunctionVarDeclaration(),";\n"]),this.decorators.push("return fn;"),n?this.decorators=Function.apply(this,["fn","props","container","depth0","data","blockParams","depths",this.decorators.merge()]):(this.decorators.prepend("function(fn, props, container, depth0, data, blockParams, depths) {\n"),this.decorators.push("}\n"),this.decorators=this.decorators.merge()));var u=this.createFunctionContext(n);if(this.isChild)return u;var h={compiler:this.compilerInfo(),main:u};this.decorators&&(h.main_d=this.decorators,h.useDecorators=!0);var d=this.context,p=d.programs,g=d.decorators;for(l=0,c=p.length;l<c;l++)p[l]&&(h[l]=p[l],g[l]&&(h[l+"_d"]=g[l],h.useDecorators=!0));return this.environment.usePartial&&(h.usePartial=!0),this.options.data&&(h.useData=!0),this.useDepths&&(h.useDepths=!0),this.useBlockParams&&(h.useBlockParams=!0),this.options.compat&&(h.compat=!0),n?h.compilerOptions=this.options:(h.compiler=JSON.stringify(h.compiler),this.source.currentLocation={start:{line:1,column:0}},h=this.objectLiteral(h),t.srcName?(h=h.toStringWithSourceMap({file:t.destName})).map=h.map&&h.map.toString():h=h.toString()),h},preamble:function(){this.lastContext=0,this.source=new l.default(this.options.srcName),this.decorators=new l.default(this.options.srcName)},createFunctionContext:function(e){var t=this,r="",i=this.stackVars.concat(this.registers.list);i.length>0&&(r+=", "+i.join(", "));var o=0;n(this.aliases).forEach((function(e){var n=t.aliases[e];n.children&&n.referenceCount>1&&(r+=", alias"+ ++o+"="+e,n.children[0]="alias"+o)})),this.lookupPropertyFunctionIsUsed&&(r+=", "+this.lookupPropertyFunctionVarDeclaration());var a=["container","depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&a.push("blockParams"),this.useDepths&&a.push("depths");var s=this.mergeSource(r);return e?(a.push(s),Function.apply(this,a)):this.source.wrap(["function(",a.join(","),") {\n  ",s,"}"])},mergeSource:function(e){var t=this.environment.isSimple,r=!this.forceBuffer,n=void 0,i=void 0,o=void 0,a=void 0;return this.source.each((function(e){e.appendToBuffer?(o?e.prepend("  + "):o=e,a=e):(o&&(i?o.prepend("buffer += "):n=!0,a.add(";"),o=a=void 0),i=!0,t||(r=!1))})),r?o?(o.prepend("return "),a.add(";")):i||this.source.push('return "";'):(e+=", buffer = "+(n?"":this.initializeBuffer()),o?(o.prepend("return buffer + "),a.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(n?"":";\n")),this.source.merge()},lookupPropertyFunctionVarDeclaration:function(){return"\n      lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    }\n    ".trim()},blockValue:function(e){var t=this.aliasable("container.hooks.blockHelperMissing"),r=[this.contextName(0)];this.setupHelperArgs(e,0,r);var n=this.popStack();r.splice(1,0,n),this.push(this.source.functionCall(t,"call",r))},ambiguousBlockValue:function(){var e=this.aliasable("container.hooks.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var r=this.topStack();t.splice(1,0,r),this.pushSource(["if (!",this.lastHelper,") { ",r," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack((function(e){return[" != null ? ",e,' : ""']})),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("container.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,r,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t,r)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t,r){e?this.pushStackLiteral("container.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0,r)},resolvePath:function(e,t,r,n,i){var o=this;if(this.options.strict||this.options.assumeObjects)this.push(function(e,t,r,n,i){var o=t.popStack(),a=r.length;for(e&&a--;n<a;n++)o=t.nameLookup(o,r[n],i);return e?[t.aliasable("container.strict"),"(",o,", ",t.quotedString(r[n]),", ",JSON.stringify(t.source.currentLocation)," )"]:o}(this.options.strict&&i,this,t,r,e));else for(var a=t.length;r<a;r++)this.replaceStack((function(i){var a=o.nameLookup(i,t[r],e);return n?[" && ",a]:[" != null ? ",a," : ",i]}))},resolvePossibleLambda:function(){this.push([this.aliasable("container.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:{},types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},registerDecorator:function(e,t){var r=this.nameLookup("decorators",t,"decorator"),n=this.setupHelperArgs(t,e);this.decorators.push(["fn = ",this.decorators.functionCall(r,"",["fn","props","container",n])," || fn;"])},invokeHelper:function(e,t,r){var n=this.popStack(),i=this.setupHelper(e,t),o=[];r&&o.push(i.name),o.push(n),this.options.strict||o.push(this.aliasable("container.hooks.helperMissing"));var a=["(",this.itemsSeparatedBy(o,"||"),")"],s=this.source.functionCall(a,"call",i.callParams);this.push(s)},itemsSeparatedBy:function(e,t){var r=[];r.push(e[0]);for(var n=1;n<e.length;n++)r.push(t,e[n]);return r},invokeKnownHelper:function(e,t){var r=this.setupHelper(e,t);this.push(this.source.functionCall(r.name,"call",r.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var r=this.popStack();this.emptyHash();var n=this.setupHelper(0,e,t),i=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",r,")"];this.options.strict||(i[0]="(helper = ",i.push(" != null ? helper : ",this.aliasable("container.hooks.helperMissing"))),this.push(["(",i,n.paramsInit?["),(",n.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",n.callParams)," : helper))"])},invokePartial:function(e,t,r){var n=[],i=this.setupParams(t,1,n);e&&(t=this.popStack(),delete i.name),r&&(i.indent=JSON.stringify(r)),i.helpers="helpers",i.partials="partials",i.decorators="container.decorators",e?n.unshift(t):n.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(i.depths="depths"),i=this.objectLiteral(i),n.push(i),this.push(this.source.functionCall("container.invokePartial","",n))},assignToHash:function(e){var t=this.popStack(),r=void 0,n=void 0,i=void 0;this.trackIds&&(i=this.popStack()),this.stringParams&&(n=this.popStack(),r=this.popStack());var o=this.hash;r&&(o.contexts[e]=r),n&&(o.types[e]=n),i&&(o.ids[e]=i),o.values[e]=t},pushId:function(e,t,r){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(r?" + "+JSON.stringify("."+r):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:u,compileChildren:function(e,t){for(var r=e.children,n=void 0,i=void 0,o=0,a=r.length;o<a;o++){n=r[o],i=new this.compiler;var s=this.matchExistingProgram(n);if(null==s){this.context.programs.push("");var l=this.context.programs.length;n.index=l,n.name="program"+l,this.context.programs[l]=i.compile(n,t,this.context,!this.precompile),this.context.decorators[l]=i.decorators,this.context.environments[l]=n,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams,n.useDepths=this.useDepths,n.useBlockParams=this.useBlockParams}else n.index=s.index,n.name="program"+s.index,this.useDepths=this.useDepths||s.useDepths,this.useBlockParams=this.useBlockParams||s.useBlockParams}},matchExistingProgram:function(e){for(var t=0,r=this.context.environments.length;t<r;t++){var n=this.context.environments[t];if(n&&n.equals(e))return n}},programExpression:function(e){var t=this.environment.children[e],r=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&r.push("blockParams"),this.useDepths&&r.push("depths"),"container.program("+r.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof c||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new c(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],r=void 0,n=void 0,i=void 0;if(!this.isInline())throw new a.default("replaceStack on non-inline");var o=this.popStack(!0);if(o instanceof c)t=["(",r=[o.value]],i=!0;else{n=!0;var s=this.incrStack();t=["((",this.push(s)," = ",o,")"],r=this.topStack()}var l=e.call(this,r);i||this.popStack(),n&&this.stackSlot--,this.push(t.concat(l,")"))},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,r=e.length;t<r;t++){var n=e[t];if(n instanceof c)this.compileStack.push(n);else{var i=this.incrStack();this.pushSource([i," = ",n,";"]),this.compileStack.push(i)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),r=(t?this.inlineStack:this.compileStack).pop();if(!e&&r instanceof c)return r.value;if(!t){if(!this.stackSlot)throw new a.default("Invalid stack pop");this.stackSlot--}return r},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof c?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):((t=this.aliases[e]=this.source.wrap(e)).aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,r){var n=[];return{params:n,paramsInit:this.setupHelperArgs(t,e,n,r),name:this.nameLookup("helpers",t,"helper"),callParams:[this.aliasable(this.contextName(0)+" != null ? "+this.contextName(0)+" : (container.nullContext || {})")].concat(n)}},setupParams:function(e,t,r){var n={},i=[],o=[],a=[],s=!r,l=void 0;s&&(r=[]),n.name=this.quotedString(e),n.hash=this.popStack(),this.trackIds&&(n.hashIds=this.popStack()),this.stringParams&&(n.hashTypes=this.popStack(),n.hashContexts=this.popStack());var c=this.popStack(),u=this.popStack();(u||c)&&(n.fn=u||"container.noop",n.inverse=c||"container.noop");for(var h=t;h--;)l=this.popStack(),r[h]=l,this.trackIds&&(a[h]=this.popStack()),this.stringParams&&(o[h]=this.popStack(),i[h]=this.popStack());return s&&(n.args=this.source.generateArray(r)),this.trackIds&&(n.ids=this.source.generateArray(a)),this.stringParams&&(n.types=this.source.generateArray(o),n.contexts=this.source.generateArray(i)),this.options.data&&(n.data="data"),this.useBlockParams&&(n.blockParams="blockParams"),n},setupHelperArgs:function(e,t,r,n){var i=this.setupParams(e,t,r);return i.loc=JSON.stringify(this.source.currentLocation),i=this.objectLiteral(i),n?(this.useRegister("options"),r.push("options"),["options=",i]):r?(r.push(i),""):i}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=u.RESERVED_WORDS={},r=0,n=e.length;r<n;r++)t[e[r]]=!0}(),u.isValidJavaScriptVariableName=function(e){return!u.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=u,e.exports=t.default},function(e,t,r){"use strict";var n=r(60).default;t.__esModule=!0;var i=r(5),o=void 0;function a(e,t,r){if(i.isArray(e)){for(var n=[],o=0,a=e.length;o<a;o++)n.push(t.wrap(e[o],r));return n}return"boolean"==typeof e||"number"==typeof e?e+"":e}function s(e){this.srcFile=e,this.source=[]}o||((o=function(e,t,r,n){this.src="",n&&this.add(n)}).prototype={add:function(e){i.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){i.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),s.prototype={isEmpty:function(){return!this.source.length},prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each((function(t){e.add(["  ",t,"\n"])})),e},each:function(e){for(var t=0,r=this.source.length;t<r;t++)e(this.source[t])},empty:function(){var e=this.currentLocation||{start:{}};return new o(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof o?e:(e=a(e,this,t),new o(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,r){return r=this.generateList(r),this.wrap([e,t?"."+t+"(":"(",r,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=this,r=[];n(e).forEach((function(n){var i=a(e[n],t);"undefined"!==i&&r.push([t.quotedString(n),":",i])}));var i=this.generateList(r);return i.prepend("{"),i.add("}"),i},generateList:function(e){for(var t=this.empty(),r=0,n=e.length;r<n;r++)r&&t.add(","),t.add(a(e[r],this));return t},generateArray:function(e){var t=this.generateList(e);return t.prepend("["),t.add("]"),t}},t.default=s,e.exports=t.default}])},e.exports=t()},7612:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>C});var n=r(8038),i=r(797),o=r(3301),a=r(3967),s=r(7018),l=r(2948),c=r(8606),u=r(6257),h=r(6546),d=r(1667),p=r(8370),g=r(4450),f=r(6792),m=r(5121),y=r(3333);class v extends EventTarget{#ho;#do;#po;#go;#fo;#mo;#yo=[];#vo;#Ao;#So;#Eo=0;#wo=[];sketchPoints_=[];#_o="";julianDate=new cesium.JulianDate;drawingDataSource=new cesium.CustomDataSource("drawing");drawnDataSource=new cesium.CustomDataSource("drawn");minPointsStop=0;moveEntity=!1;vertexRemoveMode=!1;entityForEdit;ERROR_TYPES={needMorePoints:"need_more_points"};editMode=!1;onSelectEntity=null;draggingVertex=!1;constructor(e,t,r){super(),this.#ho=e,this.#_o=t,this.#ho.dataSources.getByName("drawing").length>0?this.drawingDataSource=this.#ho.dataSources.getByName("drawing")[0]:this.#ho.dataSources.add(this.drawingDataSource),this.#ho.dataSources.getByName("drawn").length>0?this.drawnDataSource=this.#ho.dataSources.getByName("drawn")[0]:this.#ho.dataSources.add(this.drawnDataSource),this.#do=r?.strokeColor&&r.strokeColor instanceof cesium.Color?r.strokeColor:cesium.Color.fromCssColorString(r?.strokeColor||"rgba(255, 0, 0, 1)"),this.#po=void 0!==r?.strokeWidth?r.strokeWidth:2,this.#go=r?.fillColor&&r.fillColor instanceof cesium.Color?r.fillColor:cesium.Color.fromCssColorString(r?.fillColor||"rgba(0, 0, 0, 0.3)"),this.#fo=void 0!==r?.radius?r.radius:10,this.minPointsStop=!!r?.minPointsStop}renderSceneIfTranslucent(){this.#ho.scene.globe?.translucency?.enabled&&this.#ho.scene.render()}activate(){this.active(!0)}deactivate(){this.eventHandler_&&(this.active(!1),this.removeSketches())}popCoordinate(){return this.#wo.pop(),this.#yo.pop()}pushCoordinate(e){this.#yo.push(e)}end(){this.finishDrawing()}visibility(e){this.drawingDataSource.entities.show=e,this.drawnDataSource.entities.show=e,this.#ho.scene.requestRender()}remove(e){this.drawnDataSource.entities.contains(e)&&(this.drawnDataSource.entities.remove(e),this.removeSketches(),this.#ho.scene.requestRender())}setLabel(e=null,t){(e=e||this.drawnDataSource.entities.values[this.drawnDataSource.entities.values.length-1]||this.drawingDataSource.entities.values[this.drawingDataSource.entities.values.length-1])&&(e.position||(e.position=cesium.BoundingSphere.fromPoints(e.polyline.positions.getValue()).center),e.label=t?{outlineColor:cesium.Color.fromCssColorString(t.outlineColor),fillColor:cesium.Color.fromCssColorString(t.fontColor),outlineWidth:t.outlineWidth,font:t.font,text:t.text,style:cesium.LabelStyle.FILL_AND_OUTLINE,heightReference:cesium.HeightReference.CLAMP_TO_GROUND,pixelOffset:e.polyline?new cesium.Cartesian2(0,0):new cesium.Cartesian2(0,-25)}:null,this?.#ho?.cesiumWidget&&this.#ho.scene.requestRender())}moveLabel(e){e.label?.text&&(this.#yo=this.#yo instanceof Array?cesium.BoundingSphere.fromPoints(this.#yo).center:this.#yo)}getEntities(){return[...this.#ho?.entities?.values||[],...this.#ho.drawnDataSource?.entities?.values||[]]}active(e){e?this.eventHandler_||(this.eventHandler_=new cesium.ScreenSpaceEventHandler(this.#ho.canvas),this.eventHandler_.setInputAction(this.onLeftClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.setInputAction(this.onDoubleClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),"point"===this.#_o&&(this.tempPoint_=this.createProvisionalPoint_()),this.eventHandler_.setInputAction(this.onMouseMove_.bind(this),cesium.ScreenSpaceEventType.MOUSE_MOVE)):(this.entityForEdit&&this.deactivateEditing(),this.eventHandler_&&(this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.eventHandler_.destroy(),this.eventHandler_=void 0),this.tempPoint_&&(this.drawingDataSource.entities.remove(this.tempPoint_),this.tempPoint_=null,this.#ho.scene.requestRender())),console.log("================="+(e?"Active":"Deactivate")+"================"),this.dispatchEvent(new CustomEvent("statechanged",{detail:{active:e}}))}activeSelectMode(e){this.editMode=!0,this.onSelectEntity=e,this.eventHandler_||(this.eventHandler_=new cesium.ScreenSpaceEventHandler(this.#ho.canvas)),this.eventHandler_.setInputAction(this.onLeftClick_.bind(this),cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.setInputAction(this.onMouseMove_.bind(this),cesium.ScreenSpaceEventType.MOUSE_MOVE)}deactivateSelectMode(){this.editMode=!1,this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_CLICK),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.MOUSE_MOVE)}setStyle(e,t){t?(t.point&&(t.point.color=cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity),t.point.pixelSize=2*(e.radius-e.strokeWidth),t.point.outlineWidth=e.strokeWidth,t.point.outlineColor=cesium.Color.fromCssColorString(e.strokeColor)),t.polyline&&(t.polyline.width=e.strokeWidth,t.polyline.material=cesium.Color.fromCssColorString(e.strokeColor)),t.polygon&&(t.polygon.material=cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity)),this?.#ho?.cesiumWidget&&this.#ho.scene.requestRender()):this.entityForEdit||(this.#do=cesium.Color.fromCssColorString(e.strokeColor),this.#po=e.strokeWidth,e.fillColor&&(this.#go=cesium.Color.fromCssColorString(e.fillColor).withAlpha(e.fillOpacity)),e.radius&&(this.#fo=e.radius))}vertexRemove(e){e?(this.vertexRemoveMode=!0,this.sketchPoints_.filter(((e,t)=>t%2)).forEach((e=>{e.show=!1}))):(this.vertexRemoveMode=!1,this.sketchPoints_.forEach((e=>{e.show=!0})))}activateEditing(){if(!this.eventHandler_||!this.entityForEdit)return;this.#_o=this.entityForEdit.polygon?"polygon":this.entityForEdit.polyline?"polyline":"point",this.eventHandler_.setInputAction((e=>this.onLeftDown_(e)),cesium.ScreenSpaceEventType.LEFT_DOWN),this.eventHandler_.setInputAction((e=>this.onLeftUp_(e)),cesium.ScreenSpaceEventType.LEFT_UP),this.eventHandler_.setInputAction(this.onMouseMove_.bind(this),cesium.ScreenSpaceEventType.MOUSE_MOVE);const e=this.entityForEdit.position?.getValue(this.julianDate);let t=[],r=!1;switch(this.#_o){case"point":this.#yo=e,this.entityForEdit.position=new cesium.CallbackProperty((()=>this.#yo),!1),r=!1,this.HighlightSketchPoint(this.entityForEdit);break;case"polyline":t=this.#yo=this.entityForEdit.polyline.positions.getValue(this.julianDate),this.entityForEdit.polyline.positions=new cesium.CallbackProperty((()=>this.#yo),!1),r=!0;break;case"polygon":t=this.#yo=this.entityForEdit.polygon?.hierarchy?.getValue(this.julianDate).positions,this.entityForEdit.polygon.hierarchy=new cesium.CallbackProperty((()=>new cesium.PolygonHierarchy(this.#yo)),!1),this.entityForEdit.polyline.positions=new cesium.CallbackProperty((()=>[...this.#yo,this.#yo[0]]),!1),r=!0;break;case"rectangle":t=[...this.entityForEdit.polygon?.hierarchy?.getValue(this.julianDate).positions??[]],this.entityForEdit.polygon.hierarchy=new cesium.CallbackProperty((()=>new cesium.PolygonHierarchy(this.#yo)),!1),this.drawingDataSource.entities.add({position:new cesium.CallbackProperty((()=>(t=this.#yo.length?this.#yo:t,cesium.Cartesian3.midpoint(t[0],t[1],new cesium.Cartesian3))),!1),billboard:{image:"./images/rotate-icon.svg",disableDepthTestDistance:Number.POSITIVE_INFINITY,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},properties:{type:"rotate"}})}this.createSketchPoints_(t,r),console.log("=================activateEditing================")}createSketchPoints_(e,t){if(e.forEach(((r,n)=>{const i=this.createSketchPoint_(r,{edit:!0,positionIndex:n});if(i.properties.index=n,this.sketchPoints_.push(i),t&&n+1<e.length){const t=this.halfwayPosition_(r,e[n+1]),i=this.createSketchPoint_(t,{edit:!0,virtual:!0});i.properties.index=n,this.sketchPoints_.push(i)}})),"polygon"===this.#_o&&e.length>2){const t=e.length-1,r=this.halfwayPosition_(e[t],e[0]),n=this.createSketchPoint_(r,{edit:!0,virtual:!0});n.properties.index=t,this.sketchPoints_.push(n)}this.#ho.scene.requestRender()}HighlightSketchPoint(e){let t={position:new cesium.CallbackProperty((()=>this.#yo),!1),point:{pixelSize:new cesium.CallbackProperty((()=>e.point.pixelSize.getValue(this.julianDate)+2*e.point.outlineWidth.getValue(this.julianDate)),!1),outlineWidth:2,outlineColor:cesium.Color.BLACK,color:cesium.Color.TRANSPARENT}},r={position:new cesium.CallbackProperty((()=>this.#yo),!1),point:{pixelSize:new cesium.CallbackProperty((()=>e.point.pixelSize.getValue(this.julianDate)-4),!1),outlineWidth:2,outlineColor:cesium.Color.WHITE,color:cesium.Color.TRANSPARENT}};e.innerPoint=this.drawnDataSource.entities.add(r),e.outerPoint=this.drawnDataSource.entities.add(t)}UnhighlightSketchPoint(e){this.drawnDataSource.entities.remove(e.innerPoint),this.drawnDataSource.entities.remove(e.outerPoint),delete e.innerPoint,delete e.outerPoint}deactivateEditing(){if(!this.eventHandler_||!this.entityForEdit)return;if(this.#yo instanceof Array?this.#yo.length:this.#yo){switch(this.#_o){case"polyline":this.entityForEdit.polyline.positions=[...this.#yo];break;case"point":this.entityForEdit.position=this.entityForEdit.position.getValue(this.julianDate),this.UnhighlightSketchPoint(this.entityForEdit);break;case"polygon":this.entityForEdit.polyline.positions=[...this.#yo,this.#yo[0]],this.entityForEdit.polygon.hierarchy=new cesium.PolygonHierarchy([...this.#yo])}this?.#ho?.cesiumWidget&&this.#ho.scene.requestRender()}this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_DOWN),this.eventHandler_.removeInputAction(cesium.ScreenSpaceEventType.LEFT_UP);const e=this.drawingDataSource.entities;this.sketchPoints_.forEach((function(t){e.remove(t)})),this.sketchPoints_=[],this.#yo=[],console.log("=================DeactivateEditing================")}finishDrawing(){let e,t=this.#yo;if(("polygon"===this.#_o||"rectangle"===this.#_o)&&t.length<3)return void this.dispatchEvent(new CustomEvent("drawerror",{detail:{error:this.ERROR_TYPES.needMorePoints}}));if("point"===this.#_o)e=this.drawShape_(this.#yo);else{if("polygon"===this.#_o){const e=new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(this.#yo[this.#yo.length-1]),cesium.Cartographic.fromCartesian(this.#yo[0]),cesium.Ellipsoid.WGS84).surfaceDistance;this.#wo.push(e/1e3)}e=this.drawShape_(this.#yo)}this.#ho.scene.requestRender();const r=this.getMeasurements(t,this.#_o);this.dispatchEvent(new CustomEvent("drawend",{detail:{positions:t,type:this.#_o,measurements:r,entity:e}})),this.removeSketches()}IsSketchEntity(e){return this.sketchPoint_&&this.sketchPoint_===e.id}CanIUseEntity(e){return!this.drawMode&&this.editMode&&(!this.entityForEdit&&this.drawnDataSource.entities.contains(e.id)||this.entityForEdit&&this.drawnDataSource.entities.contains(e.id)&&this.entityForEdit!=e.id||this.entityForEdit&&this.sketchPoints_.some((t=>t===e.id)))}removeSketches(e){this.drawingDataSource.entities.removeAll(),this.tempPoint_&&this.drawingDataSource.entities.add(this.tempPoint_),e&&this.drawnDataSource.entities.removeAll(),this.#yo=[],this.activePoint_=void 0,this.sketchPoint_=void 0,this.activeDistance_=0,this.#wo=[],this.entityForEdit=void 0,this.moveEntity=!1,this.sketchPoints_=[]}clear(){this.removeSketches()}createSketchPoint_(e,t){const r={position:e,point:{color:t?.virtual?cesium.Color.GREY:cesium.Color.WHITE,outlineWidth:1,outlineColor:cesium.Color.BLACK,pixelSize:t?.edit?9:5,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},properties:{}};t?.edit&&(r.point.disableDepthTestDistance=Number.POSITIVE_INFINITY);const n=this.drawingDataSource.entities.add(r);return t?.virtual&&(n.properties.virtual=t.virtual),n}createProvisionalPoint_(){return this.drawingDataSource.entities.add({position:new cesium.Cartesian3,point:{color:new cesium.CallbackProperty((()=>this.#go),!1),outlineWidth:new cesium.CallbackProperty((()=>this.#po),!1),outlineColor:new cesium.CallbackProperty((()=>this.#do),!1),pixelSize:new cesium.CallbackProperty((()=>2*(this.#fo-this.#po)),!1)}})}createSketchLine_(e){return this.drawingDataSource.entities.add({polyline:{positions:e,clampToGround:!0,width:new cesium.CallbackProperty((()=>this.#po),!1),material:new cesium.ColorMaterialProperty(new cesium.CallbackProperty((()=>this.#do),!1))}})}drawShape_(e){return"point"===this.#_o?this.drawnDataSource.entities.add({position:e[0],point:{color:this.#go,pixelSize:2*(this.#fo-this.#po),outlineWidth:this.#po,outlineColor:this.#do}}):"polyline"===this.#_o?this.drawnDataSource.entities.add({polyline:{positions:e,clampToGround:!0,width:this.#po,material:this.#do}}):"polygon"===this.#_o||"rectangle"===this.#_o?this.drawnDataSource.entities.add({polygon:{hierarchy:{positions:e},material:new cesium.ColorMaterialProperty(this.#go),clampToGround:!0},polyline:{positions:[...e,e[0]],clampToGround:!0,width:this.#po,material:this.#do}}):void 0}dynamicSketLinePositions(){return new cesium.CallbackProperty((()=>{const e=[...this.#yo,this.activePoint_],t=e;return"rectangle"===this.#_o&&4===e.length?[]:t.length>=3&&"polyline"!==this.#_o?[...t,t[0]]:t}),!1)}updateSketchPoint(){if(!this.sketchPoint_)return;const e=[...this.#yo,this.activePoint_],t=e.length;if(t>1){let r;if("rectangle"===this.#_o&&t>2){const t=e[1],n=e[2];r=cesium.Cartesian3.distance(t,n),this.sketchPoint_.position.setValue(n)}else{const n=e[t-1];r=new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(e[t-2]),cesium.Cartographic.fromCartesian(n),cesium.Ellipsoid.WGS84).surfaceDistance}return this.#Eo=r/1e3,void this.dispatchEvent(new CustomEvent("drawupdate",{detail:{positions:e,type:this.#_o,measurements:this.getMeasurements(e,this.#_o)}}))}}onLeftClick_(e){if(this.editMode)this.onEntityClick_(e);else if(this.vertexRemoveMode)this.#ho.scene.pick(e.position);else{const t=this.#ho.scene.globe.pick(this.#ho.camera.getPickRay(e.position),this.#ho.scene);if(t){if(this.sketchPoint_)this.sketchPoint_.position.setValue(t),this.#wo.includes(this.#Eo)||this.#wo.push(this.#Eo);else if(this.dispatchEvent(new CustomEvent("drawstart")),this.sketchPoint_=this.createSketchPoint_(t),this.activePoint_=t,this.createSketchLine_(this.dynamicSketLinePositions()),this.#ho.scene.requestRender(),"point"===this.#_o)return this.#yo.push(t),void this.finishDrawing();this.#yo.push(this.activePoint_);const e=this.minPointsStop&&("polygon"===this.#_o&&3===this.#yo.length||"polyline"===this.#_o&&2===this.#yo.length);("rectangle"===this.#_o&&3===this.#yo.length||e)&&this.finishDrawing(),this.dispatchEvent(new CustomEvent("point",{detail:{position:t}}))}}}onEntityClick_(e){if(console.log("entity click"),!this.onSelectEntity)return;const t=this.#ho.scene.pick(e.position);if(cesium.defined(t)&&cesium.defined(t.id)&&this.drawnDataSource.entities.contains(t.id))this.entityForEdit&&this.deactivateEditing(),this.entityForEdit=t.id,this.activateEditing(),this.onSelectEntity(t.id);else{if(cesium.defined(t)&&cesium.defined(t.id)&&this.sketchPoints_?.indexOf(t.id)>=0)return;this.deactivateEditing(),this.onSelectEntity(null)}}updateRectCorner(e,t,r,n,i,o){let a=cesium.Cartesian3.subtract(e,n,new cesium.Cartesian3);a=cesium.Cartesian3.multiplyByScalar(a,i,new cesium.Cartesian3);const s=cesium.Cartesian3.add(r,a,new cesium.Cartesian3),l=cesium.Cartesian3.distance(e,t),c=cesium.Cartesian3.distance(s,t)/l;let u=cesium.Cartesian3.subtract(e,t,new cesium.Cartesian3);u=cesium.Cartesian3.multiplyByScalar(u,c,new cesium.Cartesian3);let h=cesium.Cartesian3.add(t,u,new cesium.Cartesian3);return o&&(u=cesium.Cartesian3.negate(u,new cesium.Cartesian3),h=cesium.Cartesian3.add(t,u,new cesium.Cartesian3)),h}rotateRectangle(e,t){const r=[...this.#yo],n=cesium.Cartesian3.midpoint(r[0],r[2],new cesium.Cartesian3),i=Cartographic.fromCartesian(n),o=Cartographic.fromCartesian(t),a=Cartographic.fromCartesian(e),s=Math.PI+Math.atan2(o.longitude-i.longitude,o.latitude-i.latitude),l=Math.PI+Math.atan2(a.longitude-i.longitude,a.latitude-i.latitude)-s;r.forEach(((e,t)=>{const n=Cartographic.fromCartesian(e),o=Math.cos(l),a=Math.sin(l),s=o*(n.longitude-i.longitude)-a*(n.latitude-i.latitude)/Math.abs(Math.cos(i.latitude)),c=a*(n.longitude-i.longitude)*Math.abs(Math.cos(i.latitude))+o*(n.latitude-i.latitude),u=i.longitude+s,h=i.latitude+c;r[t]=Cartographic.toCartesian(new Cartographic(u,h))})),this.sketchPoints_.forEach(((e,t)=>{e.position=r[t],this.#yo[t]=r[t]})),this.#ho.scene.requestRender()}onMouseMove_(e){if(this.entityForEdit)this.onDragPoint_(e);else{this.renderSceneIfTranslucent();const t=this.#ho.scene.globe.pick(this.#ho.camera.getPickRay(e.endPosition),this.#ho.scene);if(!t)return;this.sketchPoint_&&(this.sketchPoint_.position.setValue(t),this.activePoint_=t,this.updateSketchPoint()),this.tempPoint_&&this.tempPoint_.position.setValue(t),this.#ho.scene.requestRender()}}onDragPoint_(e){this.renderSceneIfTranslucent();const t=this.#ho.scene.globe.pick(this.#ho.camera.getPickRay(e.endPosition),this.#ho.scene);if(t&&this.entityForEdit&&this.moveEntity)if("point"===this.#_o)this.#yo=t;else{const e=this.sketchPoint_?.properties,r=e.index;let n=new cesium.Cartesian3;if("number"==typeof r&&(this.sketchPoint_.position=t,n=this.#yo[r],this.#yo[r]=t),"polygon"===this.#_o){const e=this.sketchPoint_?.properties?.index,t=this.sketchPoints_.length,r=2*(t+e-1)%t,n=this.sketchPoints_[r],i=this.halfwayPosition_(n,this.sketchPoint_);this.sketchPoints_[r+1].position=i;const o=2*(t+e+1)%t,a=this.sketchPoints_[o],s=this.halfwayPosition_(a,this.sketchPoint_);this.sketchPoints_[2*e+1].position=s}if("polyline"===this.#_o){const e=this.sketchPoint_?.properties?.index;if(e>0){const t=this.sketchPoints_[2*(e-1)],r=this.halfwayPosition_(t,this.sketchPoint_);this.sketchPoints_[2*(e-1)+1].position=r}if(e<this.#yo.length-1){const t=this.sketchPoints_[2*(e+1)],r=this.halfwayPosition_(t,this.sketchPoint_);this.sketchPoints_[2*(e+1)-1].position=r}}else{const i=this.#yo;if("rectangle"===this.#_o){if(e.type&&"rotate"===e.type.getValue()){const e=this.sketchPoint_?.position?.getValue(this.julianDate);return void this.rotateRectangle(e,t)}const o=r>1?r-2:r+2,a=r-1<0?3:r-1,s=r+1>3?0:r+1;let l=i[r];const c=i[o];let u=i[a],h=i[s];const d=cesium.Cartesian3.midpoint(l,c,new cesium.Cartesian3),p=cesium.Cartesian3.midpoint(n,c,new cesium.Cartesian3),g=cesium.Cartesian3.distance(l,d)/cesium.Cartesian3.distance(n,p),f=this.checkForNegateMove(l,c,u,h);u=this.updateRectCorner(u,c,d,p,g,f.left),h=this.updateRectCorner(h,c,d,p,g,f.right),l=this.getCorrectRectCorner(l,c,u,h),l=this.getCorrectRectCorner(l,c,h,u),i[r]=l,this.#yo[r]=l,i[a]=u,i[s]=h,this.sketchPoints_.forEach(((e,t)=>{e.position=i[t]}))}}}}onDoubleClick_(){this.#wo.includes(this.#Eo)||this.#wo.push(this.#Eo),this.#yo.pop(),this.finishDrawing()}onLeftDown_(e){if(this.entityForEdit){const t=this.#ho.scene.drillPick(e.position,5,5,5);if(t.length)if(this.vertexRemoveMode&&this.sketchPoints_.includes(t[0].id)){if("polygon"===this.#_o&&this.#yo.length<=3||"polyline"===this.#_o&&this.#yo.length<=2)return void this.dispatchEvent(new CustomEvent("drawerror",{detail:{error:this.ERROR_TYPES.needMorePoints}}));const e=this.sketchPoints_.filter(((e,t)=>!(t%2))).indexOf(t[0].id),r=this.sketchPoints_.indexOf(t[0].id),n="polygon"===this.#_o?this.sketchPoints_[r-1]||this.sketchPoints_[this.sketchPoints_.length-1]:null,i=this.sketchPoints_[r+1]||this.sketchPoints_[r-1];n&&n!==i&&(n.position=this.halfwayPosition_(this.#yo[(0===e?this.#yo.length:e)-1],this.#yo[e===this.#yo.length-1?0:e+1])),this.sketchPoints_.splice(this.sketchPoints_.indexOf(i),1),this.sketchPoints_.splice(r,1),this.drawingDataSource.entities.remove(i),this.drawingDataSource.entities.remove(t[0].id),this.removeVertexToPolylineOrPolygon_(e),this.sketchPoints_.filter((e=>!e.properties.virtual)).forEach(((e,t)=>{e.properties.index=t})),this.sketchPoints_.filter((e=>e.properties.virtual)).forEach(((e,t)=>{e.properties.index=t})),this.dispatchEvent(new CustomEvent("drawmodify",{detail:{positions:this.#yo,type:this.#_o,entity:this.entityForEdit}})),this.moveLabel(this.entityForEdit)}else{const e=t.find((e=>!!e.id.point||!!e.id.billboard));if(!e)return;const r=e.id;this.sketchPoint_=r;const n=r.properties;this.moveEntity=r.id===this.entityForEdit.id||this.sketchPoints_.some((e=>e.id===r.id))||n&&n.type&&"rotate"===n.type.getValue(),this.moveEntity&&this.sketchPoint_?.properties?.virtual&&(this.draggingVertex||(this.extendOrSplitLineOrPolygonPositions_(),this.draggingVertex=!0))}this.moveEntity&&(this.#ho.scene.screenSpaceCameraController.enableInputs=!1,this.dispatchEvent(new CustomEvent("leftdown")))}}halfwayPosition_(e,t){e=e.position||e,t=t.position||t,e=e.getValue?e.getValue(this.julianDate):e,t=t.getValue?t.getValue(this.julianDate):t;const r=cesium.Cartesian3.add(e,t,new cesium.Cartesian3);return cesium.Cartesian3.divideByScalar(r,2,r),r}extendOrSplitLineOrPolygonPositions_(){const e=this.sketchPoint_,t=cesium.Cartesian3.clone(e.position?.getValue(this.julianDate)),r=e.properties?.index,n=this.sketchPoints_[2*r],i=this.sketchPoints_[2*(r+1)%this.sketchPoints_.length],o=this.halfwayPosition_(n,t),a=this.halfwayPosition_(t,i),s=this.createSketchPoint_(t,{edit:!0}),l=this.createSketchPoint_(a,{edit:!0,virtual:!0});e.position=o,this.insertVertexToPolylineOrPolygon_(r+1,t.clone()),this.sketchPoints_.splice(2*(r+1),0,s,l),this.sketchPoints_.forEach(((e,t)=>e.properties.index=Math.floor(t/2))),this.sketchPoint_=s,this.#ho.scene.requestRender()}insertVertexToPolylineOrPolygon_(e,t){this.#yo.splice(e,0,t)}removeVertexToPolylineOrPolygon_(e){this.#yo.splice(e,1)}onLeftUp_(e){this.#ho.scene.screenSpaceCameraController.enableInputs=!0,this.moveEntity&&(this.dispatchEvent(new CustomEvent("drawmodify",{detail:{positions:this.#yo,type:this.#_o,entity:this.entityForEdit}})),this.moveLabel(this.entityForEdit)),this.draggingVertex=!1,this.moveEntity=!1,this.sketchPoint_=void 0}getCorrectRectCorner(e,t,r,n){const i=Cartesian3.distance(r,t)/Cartesian3.distance(e,n);let o=Cartesian3.subtract(e,n,new Cartesian3);return o=Cartesian3.multiplyByScalar(o,i,new Cartesian3),Cartesian3.add(n,o,new Cartesian3)}checkForNegateMove(e,t,r,n){const i=this.#ho.scene.cartesianToCanvasCoordinates(e),o=this.#ho.scene.cartesianToCanvasCoordinates(n),a=this.#ho.scene.cartesianToCanvasCoordinates(r),s=this.#ho.scene.cartesianToCanvasCoordinates(t);return i&&o&&a&&s?{right:!!Intersections2D.computeLineSegmentLineSegmentIntersection(i.x,i.y,o.x,o.y,a.x,a.y,s.x,s.y),left:!!Intersections2D.computeLineSegmentLineSegmentIntersection(i.x,i.y,a.x,a.y,o.x,o.y,s.x,s.y)}:{right:!1,left:!1}}getMeasurements(e,t){const r={units:"m"},n=[];if(e.forEach(((t,r)=>{r>0&&n.push(new cesium.EllipsoidGeodesic(cesium.Cartographic.fromCartesian(e[r-1]),cesium.Cartographic.fromCartesian(t),cesium.Ellipsoid.WGS84).surfaceDistance)})),"polyline"===t)r.length=n.reduce(((e,t)=>e+t),0);else if("polygon"===t)r.perimeter=n.reduce(((e,t)=>e+t),0),r.area=e.length>2?Math.sqrt(Math.pow(cesium.PolygonPipeline.computeArea2D(e),2)):0;else if("point"===t)return{};return r}}var A=r(8202);const S={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){return'<div class="tc-view-3d-overlay" hidden>\r\n    <svg class="tc-view-3d-overlay-svg">\r\n        <defs>\r\n            <filter id="fGaussian" x="0" y="0">\r\n                <feGaussianBlur in="SourceGraphic" stdDeviation="3" />\r\n            </filter>\r\n        </defs>\r\n        <rect width="100%" height="100%" fill="white" fill-opacity="0.1" filter="url(#fGaussian)" />  \r\n    </svg>    \r\n</div>'},useData:!0},E={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){return'<div>\r\n    <svg xmlns:dc="http://purl.org/dc/elements/1.1/"\r\n         xmlns:cc="http://creativecommons.org/ns#"\r\n         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\r\n         xmlns:svg="http://www.w3.org/2000/svg"\r\n         xmlns="http://www.w3.org/2000/svg"\r\n         xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\r\n         xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\r\n         width="220"\r\n         height="135"\r\n         viewBox="0 0 63.40233 35.531682"\r\n         version="1.1"\r\n         id="threedControls">\r\n        <g inkscape:groupmode="layer"\r\n           id="backgroundLayer"\r\n           inkscape:label="backgroundLayer"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path style="fill:#ffffff;fill-opacity:0.23999999;stroke:none;stroke-width:0.2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.3169643;paint-order:stroke fill markers"\r\n                  d="M 48.005285,42.387899 A 17.766048,17.766048 0 0 0 34.067635,49.16888 17.754217,17.754217 0 0 0 20.123267,42.399784 17.754217,17.754217 0 0 0 2.3693123,60.153739 a 17.754217,17.754217 0 0 0 17.7539547,17.75447 17.754217,17.754217 0 0 0 13.923699,-6.76961 17.766048,17.766048 0 0 0 13.958319,6.78098 17.766048,17.766048 0 0 0 17.766357,-17.76584 17.766048,17.766048 0 0 0 -17.766357,-17.76584 z"\r\n                  id="background"\r\n                  inkscape:connector-curvature="0" />\r\n        </g>\r\n        <g inkscape:label="tiltLayer"\r\n           inkscape:groupmode="layer"\r\n           id="tiltLayer"\r\n           transform="translate(-26.69084,-42.254264)"\r\n           style="display:inline">\r\n            <g class="tc-view-3d-cm-tilt-indicator">\r\n                <path class="tc-view-3d-cm-tilt-inner"\r\n                      id="tiltInner"\r\n                      d="m 44.44423,52.861576 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>[[threed.tilt.reset]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-inner-image"\r\n                      d="m 40.116095,64.124648 c -0.12075,-0.119221 -0.171366,-0.928328 -0.171366,-2.739326 0,-2.143319 0.03709,-2.606753 0.223349,-2.79065 0.19727,-0.194769 0.269957,-0.196719 0.622509,-0.01671 0.219537,0.112088 0.761654,0.542242 1.204705,0.955894 l 0.805547,0.752098 v 0.939855 c 0,0.51692 -0.06955,1.085596 -0.154558,1.263727 -0.173436,0.363428 -1.919571,1.804317 -2.186551,1.804317 -0.09475,0 -0.249383,-0.07614 -0.343635,-0.169192 z m 3.287741,-0.05029 c -0.307698,-0.212789 -0.317387,-0.295835 -0.317387,-2.721198 0,-1.757783 0.05096,-2.552024 0.171366,-2.670904 0.120776,-0.119243 0.941399,-0.169194 2.779684,-0.169194 2.432612,0 2.618273,0.01838 2.756146,0.27272 0.08484,0.156511 0.147831,1.267987 0.147831,2.608402 0,3.088986 0.189068,2.899662 -2.895738,2.899662 -1.872744,0 -2.3862,-0.04266 -2.641902,-0.219488 z m 0.586357,-6.180807 c -0.314529,-0.267117 -0.397432,-0.458143 -0.397432,-0.915756 0,-0.785501 0.427643,-1.207722 1.223233,-1.207722 1.162181,0 1.675866,1.23538 0.851939,2.048861 -0.522115,0.515494 -1.126934,0.542392 -1.67774,0.07462 z m 2.780604,-0.09201 c -0.374474,-0.369724 -0.423284,-0.501051 -0.3506,-0.943285 0.118405,-0.72038 0.53618,-1.088187 1.236028,-1.088187 0.699848,0 1.117624,0.367807 1.236028,1.088187 0.07269,0.442234 0.02388,0.573561 -0.3506,0.943285 -0.300932,0.297119 -0.573881,0.429526 -0.885428,0.429526 -0.311544,0 -0.584496,-0.132407 -0.885428,-0.429526 z"\r\n                      id="tiltImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>[[threed.tilt.reset]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-circle"\r\n                      id="tiltOuter"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>[[threed.tilt.drag]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-tilt-outer tc-view-3d-cm-tilt-outer-shell-circle"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"\r\n                      inkscape:connector-curvature="0"\r\n                      id="tiltShell"\r\n                      d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 C 37.721509,56.11715 36.90502,57.97796 36.90502,60.0297 c 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 h 3.029207 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z">\r\n                    <title>[[threed.tilt.drag]]</title>\r\n                </path>\r\n            </g>\r\n        </g>\r\n        <g id="rotateLayer"\r\n           inkscape:groupmode="layer"\r\n           inkscape:label="rotateLayer"\r\n           style="display:inline"\r\n           transform="translate(-2.3693123,-42.387899)">\r\n            <path class="tc-view-3d-cm-rotate-right"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="right"\r\n                  d="m 53.241331,72.907368 0.900176,1.930847 c 3.602027,-1.827343 6.291427,-4.493353 8.092762,-8.066897 l 0.969844,0.452626 -0.663464,-4.788009 -3.222445,2.974451 0.983506,0.459005 c -1.447339,3.107391 -3.949649,5.598011 -7.060379,7.037977 z">\r\n                <title>[[threed.rotate.right]]</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-rotate-left"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="left"\r\n                  d="m 42.795431,72.906221 -0.900176,1.930846 c -3.602027,-1.827342 -6.291427,-4.493352 -8.092762,-8.066896 l -0.969844,0.452626 0.663465,-4.788009 3.222444,2.974451 -0.983506,0.459005 c 1.44734,3.107391 3.949649,5.598011 7.060379,7.037977 z">\r\n                <title>[[threed.rotate.left]]</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-up"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="up"\r\n                  d="M 7.737296,54.610066 5.80645,53.70989 c 1.827342,-3.602027 4.493352,-6.291427 8.066896,-8.092762 l -0.452626,-0.969844 4.788009,0.663465 -2.974451,3.222444 -0.459005,-0.983506 c -3.107391,1.44734 -5.598011,3.949649 -7.037977,7.060379 z">\r\n                <title>[[threed.tilt.left]]</title>\r\n            </path>\r\n            <path class="tc-view-3d-cm-tilt-down"\r\n                  sodipodi:nodetypes="cccccccc"\r\n                  inkscape:connector-curvature="0"\r\n                  id="down"\r\n                  d="m 7.684579,65.708846 -1.930847,0.900176 c 1.827343,3.602027 4.493353,6.291427 8.066897,8.092762 l -0.452626,0.969844 4.788009,-0.663464 -2.974451,-3.222445 -0.459005,0.983506 C 11.615165,71.321886 9.124545,68.819576 7.684579,65.708846 Z">\r\n                <title>[[threed.tilt.right]]</title>\r\n            </path>\r\n            <g class="tc-view-3d-cm-rotate-indicator">\r\n                <path class="tc-view-3d-cm-rotate-inner"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,52.995444 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateInner">\r\n                    <title>[[threed.rotate.reset]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-inner-image"\r\n                      d="m 45.461645,60.604061 c 0.860585,-1.857231 1.777009,-3.864779 2.036499,-4.461218 0.471802,-1.084433 0.471802,-1.084433 0.66474,-0.667935 2.070474,4.46957 3.86201,8.443545 3.825603,8.485934 -0.02561,0.02982 -0.943964,-0.165127 -2.040793,-0.433206 -1.994234,-0.487419 -1.994234,-0.487419 -3.881098,-0.01711 -1.037775,0.258673 -1.950491,0.470314 -2.028258,0.470314 -0.07777,0 0.562721,-1.519553 1.423307,-3.376784 z m 1.23418,2.027617 c 1.353421,-0.310159 1.353421,-0.310159 1.353421,-2.998288 0,-1.534227 -0.05572,-2.627602 -0.129797,-2.547123 -0.101525,0.110295 -2.316061,4.831583 -2.659547,5.670031 -0.09645,0.23543 -0.15884,0.240844 1.435923,-0.12462 z"\r\n                      id="rotateImage"\r\n                      inkscape:connector-curvature="0">\r\n                    <title>[[threed.rotate.reset]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-circle"\r\n                      inkscape:connector-curvature="0"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"\r\n                      id="rotateOuter">\r\n                    <title>[[threed.rotate.drag]]</title>\r\n                </path>\r\n                <path class="tc-view-3d-cm-rotate-outer tc-view-3d-cm-rotate-outer-shell-circle"\r\n                      d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 c -1.326946,1.360319 -2.143435,3.221129 -2.143435,5.272869 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 H 58.8088 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"\r\n                      id="rotateShell"\r\n                      inkscape:connector-curvature="0"\r\n                      sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc">\r\n                    <title>[[threed.rotate.drag]]</title>\r\n                </path>\r\n            </g>            \r\n        </g>\r\n    </svg>\r\n</div>'},useData:!0};var w=r(5777),_=r(3791);n.A.view=n.A.view||{},n.A.control=n.A.control||{},n.A.control.MapContents=a.default,i.A.CESIUMNS="cesium";class L{constructor(){this["threed.tilt.reset"]="",this["threed.tilt.drag"]="",this["threed.tilt.left"]="",this["threed.tilt.right"]="",this["threed.rotate.reset"]="",this["threed.rotate.drag"]="",this["threed.rotate.right"]="",this["threed.rotate.left"]=""}}const C=n.A.view.ThreeD=function(){const e=Object.prototype.hasOwnProperty;var t={VIEWNAME:"ThreeD",CLASS:"tc-view-3d",Consts:{BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256},classes:{MAP3D:"tc-map-3d",LOADING:"tc-loading",CAMERACTRARROWDISABLED:"tc-disabled-arrow",FOCUS:"focus",HIGHLIGHTED:"tc-highlighted",OUTFOCUS:"tc-outfocus"},allowedControls:[],template:{},viewer:null,mapView:null,terrainProvider:null,getLocaleString:function(e,t){var r=this.map?this.map.options.locale:n.A.Cfg.locale;return o.A.getLocaleString(r,e,t)},getRenderedHtml:function(e,t,r){return n.A.Control.prototype.getRenderedHtml.call(this,e,t,r)}};i.A.classes.THREED=i.A.classes.THREED||"tc-3d",i.A.classes.THREED_HIDDEN=i.A.classes.THREED_HIDDEN||"tc-3d-hidden",i.A.event.TERRAINLOADED=i.A.event.TERRAINLOADED||"terrainloaded.tc.threed",i.A.event.TERRAINRECEIVING=i.A.event.TERRAINRECEIVING||"terrainreceiving.tc.threed",i.A.event.TERRAIN404=i.A.event.TERRAIN404||"terrain404.tc.threed",i.A.event.THREED_DRAG=i.A.event.THREED_DRAG||"drag.tc.threed",t.template[t.CLASS]=A.default,t.template[t.CLASS+"-overlay"]=S,t.template[t.CLASS+"-cm-ctls"]=E;const a=function(e,t){var r=this;r.map=e,r.parent=t,Promise.resolve(r.map.getViewHTML()).then(function(e){r.viewHTML=e}.bind(r)),r.metersPerUnit=e.getMetersPerUnit(),r.maxResolution=null,r._oldMapSetCenter=e.setCenter,e.setCenter=function(n,i){e.on3DView?e.view3D.flyToMapCoordinates.call(t,n):r._oldMapSetCenter.call(e,n,i)}};a.prototype.getCenter=function(){return this.map.getCenter()},a.prototype.getExtent=function(){return this.map.getExtent()},a.prototype.getResolution=function(){return this.map.getResolution()},a.prototype.getRotation=function(){return this.map.getRotation()},a.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var e=this.map.options.baselayerExtent;this.maxResolution=(e[2]-e[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution},a.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)},a.prototype.setCenter=function(e){this._oldMapSetCenter.call(this.map,e)},a.prototype.setExtent=function(e){this.map.setExtent(e)},a.prototype.setResolution=function(e){this.map.setResolution(e)},a.prototype.setRotation=function(e){this.map.setRotation(e)};const C=function(e,t){return e.type===i.A.layerType.WMTS?e.wrap.getCompatibleMatrixSets(t).length>0:e.isCompatible(t)},b=function(e,t){var r=1e6,n=t[0]-e[0],i=t[1]-e[1],o=Math.atan(i/n);return n<0&&(o+=Math.PI),[e[0]+r*Math.cos(o),e[1]+r*Math.sin(o)]},T=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},x=function(e){if((e=e||{}).nearMapCoords){var t=e.bottomPixel.clone();t.y=Math.round(9*t.y/10);var r=P.call(this,t);if(r){var n=[e.nearMapCoords,r].sort((function(t,r){return T(e.cameraPosition,t)-T(e.cameraPosition,r)}));return b.apply(this,n)}}return null},P=function(e,t){var r=this,n=O(r.viewer.scene,e);if(n){n=cesium.Cartographic.fromCartesian(n);const e=t||r.view3D.view2DCRS;return r.view3D.crs!==e?o.A.reproject([cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)],r.view3D.crs,e):[cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)]}return null},M=function(e,t){var r=this,n=r.viewer.camera.frustum.fovy,i=e*r.mapView.viewHTML.getBoundingClientRect().height,o=Math.cos(Math.abs(t));return i*r.mapView.metersPerUnit*o/2/Math.tan(n/2)},I=function(e,t){var r=this,n=r.viewer.scene.canvas,i=r.viewer.camera.frustum.fovy,o=2*e*Math.tan(i/2),a=Math.cos(Math.abs(t)),s=o/r.mapView.metersPerUnit/a/n.clientHeight,l=r.map.getResolutions();if(null===l)for(var c=0,u=(l=new Array(22)).length;c<u;++c)l[c]=r.mapView.getMaxResolution()/Math.pow(2,c);for(var h=0;h<l.length;h++){if(l[h]<Math.abs(s)){s=l[h-1];break}if(l[h]===Math.abs(s)){s=l[h];break}h===l.length-1&&(s=l[h])}return s},R=function(e,t,r,n,i){var o,a=cesium.Math.clamp,s=cesium.defaultValue,l=i||{},c=s(l.duration,500),u=s(l.easing,(function(e){return e})),h=l.callback,d=0,p=new cesium.Matrix4;return new Promise((function(i,s){requestAnimationFrame((function s(l){o||(o=l);var g=u(a((l-o)/c,0,1));e.transform.clone(p);var f=(g-d)*t;d=g,e.lookAtTransform(n),e.rotate(r,f),e.lookAtTransform(p),g<1?requestAnimationFrame(s):(h&&h(),i())}))}))},O=function(e,t){var r=e.camera.getPickRay(t);return e.globe.pick(r,e)||e.camera.pickEllipsoid(t)},D=function(e){var t=e.canvas,r=new cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return O(e,r)},N=function(e){var t=e.canvas,r=new cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return O(e,r)},k=function(e,t,r,n){var i=e.camera,o=F(e,r),a=i.right,s=cesium.Quaternion.fromAxisAngle(a,o),l=cesium.Matrix3.fromQuaternion(s),c=new cesium.Cartesian3;cesium.Cartesian3.subtract(i.position,r,c);var u=new cesium.Cartesian3;cesium.Matrix3.multiplyByVector(l,c,u),cesium.Cartesian3.add(u,r,u);var h=cesium.Matrix4.fromTranslation(u);R(i,t,u,h,n)},F=function(e,t){var r=e.camera,n=r.frustum.fovy/2,i=function(e){var t=e.camera,r=t.frustum.fovy/2,n=t.direction,i=cesium.Quaternion.fromAxisAngle(t.right,r),o=cesium.Matrix3.fromQuaternion(i),a=new cesium.Cartesian3;return cesium.Matrix3.multiplyByVector(o,n,a),new cesium.Ray(t.position,a)}(e),o=cesium.Cartesian3.clone(i.direction);cesium.Cartesian3.negate(o,o);var a=new cesium.Cartesian3;cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);var s=new cesium.Cartesian3;return cesium.Cartesian3.negate(r.right,s),function(e,t,r){var n=new cesium.Cartesian3,i=new cesium.Cartesian3,o=new cesium.Cartesian3;cesium.Cartesian3.normalize(e,n),cesium.Cartesian3.normalize(t,i),cesium.Cartesian3.cross(n,i,o);var a=cesium.Cartesian3.dot(n,i),s=cesium.Cartesian3.magnitude(o),l=cesium.Cartesian3.dot(r,o),c=Math.atan2(s,a);return l>=0?c:-c}(a,o,s)+n},G=function(e,t,r,n,i,a){const s=this;return new Promise((function(i,l){var c=e.map((function(e){var t=e;return s.view3D.view2DCRS!==s.view3D.crs&&(t=o.A.reproject(e,s.view3D.view2DCRS,s.view3D.crs)),cesium.Cartographic.fromDegrees(t[0],t[1])}));cesium.when(s.viewer.terrainProvider.sampleTerrainMostDetailed(c),(function(o){var s,l,c=0;if("XYZM"===t)s=e[0][3],l=e[e.length-1][3];else if("XYM"===t)s=e[0][2],l=e[e.length-1][2];else{e[0][3]=o[0].time=Date.now();for(var u=1;u<o.length;u++){var h;let t=[];o[u].time=0,t=u+1<o.length?o.slice(u-1,u+1):o.slice(u-1),c+=h=new cesium.EllipsoidGeodesic(t[0],t[1]).surfaceDistance,e[u][3]=o[u].time=o[u-1].time+36e5*h/a}s=o[0].time,l=o[o.length-1].time}if(0===c)for(var d=1;d<o.length;d++){let e=[];e=d+1<o.length?o.slice(d-1,d+1):o.slice(d-1),c+=new cesium.EllipsoidGeodesic(e[0],e[1]).surfaceDistance}s=new Date(s).toISOString(),l=new Date(l).toISOString();var p=[{id:"document",name:"CZML Model",version:"1.0"},{id:"path",name:r,availability:s+"/"+l,position:{epoch:s,cartographicRadians:o.map((function(r,n){return"XYZM"===t?[new Date(e[n][3]).toISOString(),r.longitude,r.latitude,r.height]:"XYM"===t?[new Date(e[n][2]).toISOString(),r.longitude,r.latitude,r.height]:[new Date(r.time).toISOString(),r.longitude,r.latitude,r.height]})).reduce((function(e,t){return e.concat(t)}))},point:{heightReference:"CLAMP_TO_GROUND",pixelSize:n.radius,color:{rgba:n.fillColor},outlineColor:{rgba:n.strokeColor},outlineWidth:n.strokeWidth}}];i({czml:p,totalDistance:c,coordinates2D:e})}))}))},B=function(e){var t=this;t.model=new L,t.parent=e;var r=function(e,t){var r=e.getBBox();const n="rotate("+cesium.Math.toDegrees(t)+" "+(r.x+r.width/2)+" "+(r.y+r.height/2)+")";document.getElementsByClassName(e.className.baseVal)[0].setAttribute("transform",n)};t.outControlsEvents=o.A.detectMouse()?["mouseleave"]:["touchleave","touchend"],t.outControls=function(e){this.isFocusingCameraCtrls=!1}.bind(t),t.inControlsEvents=o.A.detectMouse()?["mouseenter"]:["touchmove","touchstart"],t.inControls=function(){var e=this;e.isFocusingCameraCtrls=!0,e.lastFocused=performance.now(),e.div.classList.contains(e.parent.classes.OUTFOCUS)&&(e.div.classList.remove(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterCircle.classList.remove(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterShellCircle.classList.remove(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterCircle.classList.remove(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterShellCircle.classList.remove(e.parent.classes.OUTFOCUS))}.bind(t),t.moveStart=function(){this.moving=!0}.bind(t),t.moveEnd=function(){var e=this;e.moving=!1,e.parent.map.trigger(i.A.event.CAMERACHANGE,{position:e.parent.view3D.getCameraData()})}.bind(t),t.postRender=function(){var e=this,t=e.parent;e.parent.view3D.isLoadingTiles.call(e.parent)&&e.customCollisionDetection();var n=e.getCamera(),i=n.positionCartographic;e.moving&&(r(e.tiltIndicator,n.pitch),r(e.rotateIndicator,-n.heading),e.disableRotate(),e.disableTilt(5),t.view3D.crs!==t.view3D.view2DCRS?e._coordsXY=o.A.reproject([cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)],t.view3D.crs,t.view3D.view2DCRS):e._coordsXY=[cesium.Math.toDegrees(i.longitude),cesium.Math.toDegrees(i.latitude)],t.mapView.setCenter(e._coordsXY),t.mapView.setResolution(I.call(t,i.height,i.latitude))),e._coordsXY&&(t._ovMap=t._ovMap||t.map.getControlsByClass("TC.control.OverviewMap")[0],t._ovMap&&t._ovMap.renderPromise().then((function(){t._ovMap.wrap.draw3DCamera({position:e._coordsXY,heading:n.heading,fov:e.parent.view3D.getFovCoords()})})))}.bind(t),t.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-left",rightArrow:"-right",downArrow:"-down",upArrow:"-up"},t.MIN_TILT=cesium.Math.toRadians(-89),t.MAX_TILT=cesium.Math.toRadians(-1),t.render()};B.prototype.bind=function(){var e=this;e.getCamera().moveStart.addEventListener(e.moveStart),e.getCamera().moveEnd.addEventListener(e.moveEnd),e.parent.viewer.scene.postRender.addEventListener(e.postRender),e.outControlsEvents.forEach((function(t){e.div.addEventListener(t,e.outControls)})),e.inControlsEvents.forEach((function(t){e.div.addEventListener(t,e.inControls)})),e.rAFInOutControls=requestAnimationFrame((function t(){e.lastFocused||(e.lastFocused=performance.now()),performance.now()-e.lastFocused>5e3&&!0!==e.isFocusingCameraCtrls&&(e.div.classList.contains(e.parent.classes.OUTFOCUS)||(e.div.classList.add(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterCircle.classList.add(e.parent.classes.OUTFOCUS),e.tiltIndicatorOuterShellCircle.classList.add(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterCircle.classList.add(e.parent.classes.OUTFOCUS),e.rotateIndicatorOuterShellCircle.classList.add(e.parent.classes.OUTFOCUS))),e.rAFInOutControls=requestAnimationFrame(t)}))},B.prototype.unbind=function(){var e=this;e.div.classList.add(i.A.classes.HIDDEN),e.getCamera().moveStart.removeEventListener(e.moveStart),e.getCamera().moveEnd.removeEventListener(e.moveEnd),e.parent.viewer.scene.postRender.removeEventListener(e.postRender),e.outControlsEvents.forEach((function(t){e.div.removeEventListener(t,e.outControls)})),e.inControlsEvents.forEach((function(t){e.div.removeEventListener(t,e.inControls)})),window.cancelAnimationFrame(e.rAFInOutControls),e.lastFocused=void 0,e.rAFInOutControls=void 0},B.prototype.getCamera=function(){return this.parent.viewer.scene.camera},B.prototype.getCameraState=function(){var e=this;if(e.parent.viewer){var t=e.parent.viewer.scene.camera,r=t.positionCartographic,n=N(e.parent.viewer.scene);if(n){var i=cesium.Cartesian3.distance(t.position,n);return{cp:[r.longitude,r.latitude,r.height],chpr:[t.heading,t.pitch,t.roll],bcpd:i}}}},B.prototype.render=function(){var e=this;e.div?(e.div.classList.remove(i.A.classes.HIDDEN),e.bind()):e.parent.getRenderedHtml(e.parent.CLASS+"-cm-ctls",{},function(t){e.div=document.createElement("div"),e.div.classList.add(e.parent.CLASS+"-cm-ctls"),e.div.innerHTML=t,e.parent.map.div.appendChild(e.div),e.controller=new w.A(e.model,new _.A(e.div)),e.updateModel();var r="."+e.parent.CLASS+e.selectors.tilt;e.tiltIndicatorInner=e.div.querySelector("[class^="+r.replace(".","")+"-inner]"),e.tiltIndicatorInner.addEventListener(i.A.event.CLICK,e.resetTilt.bind(e)),e.tiltIndicator=e.div.querySelector(r+"-indicator"),e.tiltIndicatorOuterCircle=e.div.querySelector(r+"-outer-circle"),e.tiltIndicatorOuterShellCircle=e.div.querySelector(r+"-outer-shell-circle"),e.tiltIndicatorCircle=e.div.querySelector("[class^="+r.replace(".","")+"-outer]"),e.tiltIndicatorCircle.addEventListener("mousedown",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var t=new cesium.Cartesian2,r=e.currentTarget,n=e.currentTarget.getBoundingClientRect(),i=new cesium.Cartesian2((n.right-n.left)/2,(n.bottom-n.top)/2),o=new cesium.Cartesian2(e.clientX-n.left,e.clientY-n.top),a=cesium.Cartesian2.subtract(o,i,t);return this.draggingTilt.call(this,r,a),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(e)),e.tiltUp=e.div.querySelector(r+e.selectors.upArrow),e.tiltUp.addEventListener(o.A.detectMouse()?"mousedown":"touchstart",function(t){if(t.target.disabled)return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=o.A.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.tiltUpMouseUpFunction,!1),e.tiltUpMouseUpFunction=void 0,e.tilt.call(e,5),e.tiltUpInterval=setInterval(function(){e.isTiltUpDisabled?e.tiltUpMouseUpFunction():e.tilt.call(e,5)}.bind(e),101),e.tiltUpMouseUpFunction=function(){clearInterval(e.tiltUpInterval),e.tiltUpInterval=void 0,document.removeEventListener(r,e.tiltUpMouseUpFunction,!1),e.tiltUpMouseUpFunction=void 0},document.addEventListener(r,e.tiltUpMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.tiltDown=e.div.querySelector(r+e.selectors.downArrow),e.tiltDown.addEventListener(o.A.detectMouse()?"mousedown":"touchstart",function(t){if(t.target.disabled)return t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),t.cancelBubble=!0,t.returnValue=!1,!1;t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=o.A.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.tiltDownMouseUpFunction,!1),e.tiltDownMouseUpFunction=void 0,e.tilt.call(e,-5),e.tiltDownInterval=setInterval(function(){e.isTiltDownDisabled?e.tiltDownMouseUpFunction():e.tilt.call(e,-5)}.bind(e),101),e.tiltDownMouseUpFunction=function(){clearInterval(e.tiltDownInterval),e.tiltDownInterval=void 0,document.removeEventListener(r,e.tiltDownMouseUpFunction,!1),e.tiltDownMouseUpFunction=void 0},document.addEventListener(r,e.tiltDownMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e));var n="."+e.parent.CLASS+e.selectors.rotate;e.rotateIndicatorInner=e.div.querySelector("[class^="+n.replace(".","")+"-inner]"),e.rotateIndicatorInner.addEventListener(i.A.event.CLICK,e.resetRotation.bind(e)),e.rotateIndicator=e.div.querySelector(n+"-indicator"),e.rotateIndicatorOuterCircle=e.div.querySelector(n+"-outer-circle"),e.rotateIndicatorOuterShellCircle=e.div.querySelector(n+"-outer-shell-circle"),e.rotateIndicatorCircle=e.div.querySelector("[class^="+n.replace(".","")+"-outer]"),e.rotateIndicatorCircle.addEventListener("mousedown",function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var t=new cesium.Cartesian2,r=e.currentTarget,n=e.currentTarget.getBoundingClientRect(),i=new cesium.Cartesian2((n.right-n.left)/2,(n.bottom-n.top)/2),o=new cesium.Cartesian2(e.clientX-n.left,e.clientY-n.top),a=cesium.Cartesian2.subtract(o,i,t);return this.draggingRotate.call(this,r,a),e.cancelBubble=!0,e.returnValue=!1,!1}.bind(e)),e.rotateLeft=e.div.querySelector(n+e.selectors.leftArrow),e.rotateLeft.addEventListener(o.A.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=o.A.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1),e.rotateLeftMouseUpFunction=void 0,e.rotate.call(e,-15),e.rotateLeftInterval=setInterval(function(){e.rotate.call(e,-15)}.bind(e),101),e.rotateLeftMouseUpFunction=function(){clearInterval(e.rotateLeftInterval),e.rotateLeftInterval=void 0,document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1),e.rotateLeftMouseUpFunction=void 0},document.addEventListener(r,e.rotateLeftMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.rotateRight=e.div.querySelector(n+e.selectors.rightArrow),e.rotateRight.addEventListener(o.A.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault(),e.inControls(t);var r=o.A.detectMouse()?"mouseup":"touchend";return document.removeEventListener(r,e.rotateRightMouseUpFunction,!1),e.rotateRightMouseUpFunction=void 0,e.rotate.call(e,15),e.rotateRightInterval=setInterval(function(){e.rotate.call(e,15)}.bind(e),101),e.rotateRightMouseUpFunction=function(){clearInterval(e.rotateRightInterval),e.rotateRightInterval=void 0,document.removeEventListener(r,e.rotateRightMouseUpFunction,!1),e.rotateRightMouseUpFunction=void 0},document.addEventListener(r,e.rotateRightMouseUpFunction,!1),t.cancelBubble=!0,t.returnValue=!1,!1}.bind(e)),e.bind()}.bind(this))},B.prototype.disableTilt=function(e){var t=this,r=cesium.Math.toRadians(e),n=t.getCamera().pitch;t.isTiltDownDisabled=n+-r<t.MIN_TILT,t.isTiltUpDisabled=n+r>t.MAX_TILT,t.tiltUp.disabled=t.isTiltUpDisabled,t.tiltUp.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,t.isTiltUpDisabled),t.tiltDown.disabled=t.isTiltDownDisabled,t.tiltDown.classList.toggle(t.parent.classes.CAMERACTRARROWDISABLED,t.isTiltDownDisabled)},B.prototype.disableRotate=function(){var e=this,t=!0,r=e.parent.viewer.scene.canvas,n=[new cesium.Cartesian2(0,r.clientHeight-1),new cesium.Cartesian2(r.clientWidth-1,r.clientHeight-1),new cesium.Cartesian2(r.clientWidth-1,0),new cesium.Cartesian2(0,0)].map(function(e){return P.call(this,e)}.bind(e.parent)).filter((function(e){return null!==e}));return n.length&&n.length>=2&&(t=!1),e.rotateIndicatorInner.disabled=t,e.rotateLeft.disabled=t,e.rotateLeft.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,t),e.rotateRight.disabled=t,e.rotateRight.classList.toggle(e.parent.classes.CAMERACTRARROWDISABLED,t),t},B.prototype.tilt=function(e){var t=this;if(t.disableTilt(e),t.parent.viewer&&t.parent.viewer.trackedEntity)t.getCamera().rotateUp(cesium.Math.toRadians(e));else{if(null==D(t.parent.viewer.scene)&&(e>0?t.getCamera().lookUp():t.getCamera().lookDown()),e>=cesium.Math.PI_OVER_TWO&&t.isTiltUpDisabled||e<=-cesium.Math.PI_OVER_TWO&&t.isTiltDownDisabled)return;var r=cesium.Math.toRadians(e),n=D(t.parent.viewer.scene);if(n){var i=cesium.Matrix4.fromTranslation(n);t.parent.view3D.rotateAroundAxis(t.getCamera(),-r,t.getCamera().right,i,{duration:100})}}},B.prototype.rotate=function(e){var t=this;if(e=cesium.Math.toRadians(e),t.parent.viewer&&t.parent.viewer.trackedEntity)t.getCamera().rotateRight(-e);else{var r=N(t.parent.viewer.scene);r&&k(t.parent.viewer.scene,e,r,{duration:100})}},B.prototype.draggingTilt=function(e,t){var r=this;r.tiltIndicatorOuterCircle.classList.add(r.parent.classes.HIGHLIGHTED);var n=new cesium.Matrix4,i=new cesium.Matrix4,o=new cesium.Cartesian2;document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1),r.tiltMouseMoveFunction=void 0,r.tiltMouseUpFunction=void 0,r.isTilting=!0;var a=r.parent.viewer.scene,s=a.camera,l=D(a);l?(r.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(l,cesium.Ellipsoid.WGS84,i),r.tiltIsLook=!1):(r.tiltFrame=cesium.Transforms.northUpEastToFixedFrame(s.positionWC,cesium.Ellipsoid.WGS84,i),r.tiltIsLook=!0),r.startCursorAngle=Math.atan2(-t.y,t.x);var c=cesium.Matrix4.clone(s.transform,n);s.lookAtTransform(r.tiltFrame),r.initialCameraAngle=Math.atan2(s.position.y,s.position.x),s.lookAtTransform(c),r.tiltMouseMoveFunction=function(t){var r=this;a=r.parent.viewer.scene,s=a.camera;var i=e.getBoundingClientRect();const l=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2);var u=new cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),h=cesium.Cartesian2.subtract(u,l,o);console.log("Entra: "+h.toString());var d=Math.atan2(-h.y,h.x)-r.startCursorAngle,p=cesium.Math.zeroToTwoPi(r.initialCameraAngle-d);try{c=cesium.Matrix4.clone(s.transform,n),s.lookAtTransform(r.tiltFrame);var g=p-Math.atan2(s.position.y,s.position.x),f=s.pitch;(f+=g)<r.MIN_TILT?s.rotate(s.right,s.pitch-r.MIN_TILT):f>r.MAX_TILT?s.rotate(s.right,s.pitch-r.MAX_TILT):s.rotate(s.right,-g),r.disableTilt(5),s.lookAtTransform(c)}catch(t){r.tiltMouseUpFunction()}}.bind(r),r.tiltMouseUpFunction=function(e){r.tiltIndicatorOuterCircle.classList.remove(r.parent.classes.HIGHLIGHTED),r.isTilting=!1,document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1),r.tiltMouseMoveFunction=void 0,r.tiltMouseUpFunction=void 0},document.addEventListener("mousemove",r.tiltMouseMoveFunction,!1),document.addEventListener("mouseup",r.tiltMouseUpFunction,!1)},B.prototype.draggingRotate=function(e,t){var r=this;if(document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1),r.rotateMouseMoveFunction=void 0,r.rotateMouseUpFunction=void 0,r.rotateMouseMoveFunction=function(t){var i=e.getBoundingClientRect(),s=new cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),c=new cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),u=cesium.Cartesian2.subtract(c,s,o),h=Math.atan2(-u.y,u.x)-r.rotateInitialCursorAngle,d=cesium.Math.zeroToTwoPi(r.rotateInitialCameraAngle-h);a=r.parent.viewer.scene.camera;try{l=cesium.Matrix4.clone(a.transform,n),a.lookAtTransform(r.rotateFrame);var p=Math.atan2(a.position.y,a.position.x);a.rotateRight(d-p),a.lookAtTransform(l)}catch(t){r.rotateMouseUpFunction()}},r.rotateMouseUpFunction=function(e){r.isRotating=!1,r.rotateIndicatorOuterCircle.classList.remove(r.parent.classes.HIGHLIGHTED),document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1),r.rotateMouseMoveFunction=void 0,r.rotateMouseUpFunction=void 0},r.disableRotate())r.rotateMouseUpFunction();else{r.rotateIndicatorOuterCircle.classList.add(r.parent.classes.HIGHLIGHTED);var n=new cesium.Matrix4,i=new cesium.Matrix4,o=new cesium.Cartesian2;r.isRotating=!0,r.rotateInitialCursorAngle=Math.atan2(-t.y,t.x);var a=r.parent.viewer.scene.camera,s=D(r.parent.viewer.scene);null!=s&&null!=s||null!=(s=N(r.parent.viewer.scene))&&null!=s?(r.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(s,cesium.Ellipsoid.WGS84,i),r.rotateIsLook=!1):(r.rotateFrame=cesium.Transforms.eastNorthUpToFixedFrame(a.positionWC,cesium.Ellipsoid.WGS84,i),r.rotateIsLook=!0);try{var l=cesium.Matrix4.clone(a.transform,n);a.lookAtTransform(r.rotateFrame),r.rotateInitialCameraAngle=Math.atan2(a.position.y,a.position.x),r.rotateInitialCameraDistance=cesium.Cartesian3.magnitude(new cesium.Cartesian3(a.position.x,a.position.y,0)),a.lookAtTransform(l)}catch(e){r.rotateMouseUpFunction()}document.addEventListener("mousemove",r.rotateMouseMoveFunction,!1),document.addEventListener("mouseup",r.rotateMouseUpFunction,!1)}},B.prototype.resetTilt=function(){var e=-this.getCamera().pitch-cesium.Math.toRadians(50);this.tilt(cesium.Math.toDegrees(e))},B.prototype.resetRotation=function(e){const t=this;return new Promise((function(r,n){var i;for(i=-t.getCamera().heading;i<-Math.PI;)i+=2*Math.PI;for(;i>Math.PI;)i-=2*Math.PI;e?e.callback=function(){r()}:r(),t.parent.viewer&&t.parent.viewer.trackedEntity&&t.parent.view3D.linked2DControls.geolocation.videoControls.call(t,{target:{className:"stop"},custom:!0});var o=N(t.parent.viewer.scene);o&&k(t.parent.viewer.scene,i,o,e)}))},B.prototype.customCollisionDetection=function(){var e,t,r=new cesium.Matrix4,n=new cesium.Cartographic,i=this.parent.viewer.scene,o=this.parent.viewer.scene.camera,a=i.screenSpaceCameraController,s=a.minimumCollisionTerrainHeight,l=a.minimumZoomDistance,c=i.globe,u=c.ellipsoid;cesium.Matrix4.equals(o.transform,cesium.Matrix4.IDENTITY)||(e=cesium.Matrix4.clone(o.transform,r),t=cesium.Cartesian3.magnitude(o.position),o._setTransform(cesium.Matrix4.IDENTITY));var h=n;u.cartesianToCartographic(o.position,h);var d=!1;if(h.height<s){var p=c.getHeight(h);null!=p&&(p+=l,h.height<p&&(h.height=p,u.cartographicToCartesian(h,o.position),d=!0))}null!=e&&(o._setTransform(e),d&&(cesium.Cartesian3.normalize(o.position,o.position),cesium.Cartesian3.negate(o.position,o.direction),cesium.Cartesian3.multiplyByScalar(o.position,Math.max(t,l),o.position),cesium.Cartesian3.normalize(o.direction,o.direction),cesium.Cartesian3.cross(o.direction,o.up,o.right),cesium.Cartesian3.cross(o.right,o.direction,o.up)))},B.prototype.limitCameraToInitExtent=function(){var e=this,t=e.viewer.camera.positionCartographic.clone();if(!(t.longitude>=e.initExtent.west&&t.longitude<=e.initExtent.east&&t.latitude>=e.initExtent.south&&t.latitude<=e.initExtent.north)){var r=e.viewer.scene.screenSpaceCameraController.maximumZoomDistance,n=.05*t.height/r;t.longitude=Math.max(e.initExtent.west-n,t.longitude),t.latitude=Math.max(e.initExtent.south-n,t.latitude),t.longitude=Math.min(e.initExtent.east+n,t.longitude),t.latitude=Math.min(e.initExtent.north+n,t.latitude),e.viewer.camera.setView({destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(t),orientation:{heading:e.viewer.camera.heading,pitch:e.viewer.camera.pitch}})}e.viewer.scene.screenSpaceCameraController.minimumZoomDistance=t.height>1800?400:200},B.prototype.updateModel=function(){const e=this;e.model["threed.tilt.reset"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.tilt.reset"),e.model["threed.tilt.drag"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.tilt.drag"),e.model["threed.tilt.left"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.tilt.left"),e.model["threed.tilt.right"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.tilt.right"),e.model["threed.rotate.reset"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.rotate.reset"),e.model["threed.rotate.drag"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.rotate.drag"),e.model["threed.rotate.right"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.rotate.right"),e.model["threed.rotate.left"]=o.A.getLocaleString(e.parent.map.options.locale,"threed.rotate.left")};const U=function(e){var t,r=!1,a=null,s=null,l=null,c=e.map.getResolution,u=function(t){if(s)return Promise.resolve();{const i={content:"table",titles:{main:o.A.getLocaleString(e.map.options.locale,"threed.rs.panel.gfi"),max:o.A.getLocaleString(e.map.options.locale,"threed.rs.panel.gfi")}};var r,n=e.map.getControlsByClass("TC.control.ControlContainer")[0];return n?(i.position=n.POSITION.RIGHT,r=n.addControl("resultsPanel",i)):(i.div=document.createElement("div"),e.map.div.appendChild(i.div),r=e.map.addControl("resultsPanel",i)),r.then((function(e){e.caller=t,s=e,t.resultsPanel=s}))}};(l=e.map.getControlsByClass(n.A.control.FeatureInfo)[0])&&(t=l.displayMode,u(l).then((function(){l.setDisplayMode(i.A.infoContainer.RESULTS_PANEL),e.map.on(i.A.event.RESULTSPANELCLOSE,(function(e){e.control===l.getDisplayControl()&&(l.querying||h())}))}))),this.clear=function(){l.closeResults(),h()},this.reset=function(){this.clear(),l.setDisplayMode(t),e.map.getResolution=c};var h=function(){e.view3D.removeFeature.call(e,a),a=null};this.send=function(t){return new Promise((function(n,s){r=!0,l.displayMode!==i.A.infoContainer.RESULTS_PANEL&&l.setDisplayMode(i.A.infoContainer.RESULTS_PANEL),l.resultsPanel&&l.resultsPanel.close(),e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait()),function(t){if(a)a.position=t;else{var r={position:t,billboard:{image:o.A.getFeatureStyleFromCss(e.CLASS+"-marker")?.url,eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};a=e.view3D.addNativeFeature.call(e,r)}e.viewer.scene.requestRender()}(t),u(l).then((function(){var a,s=cesium.Ellipsoid.WGS84.cartesianToCartographic(t);a=e.view3D.crs!==e.view3D.view2DCRS?o.A.reproject([cesium.Math.toDegrees(s.longitude),cesium.Math.toDegrees(s.latitude)],e.view3D.crs,e.view3D.view2DCRS):[cesium.Math.toDegrees(s.longitude),cesium.Math.toDegrees(s.latitude)];for(var c,u=e.viewer.scene.globe._surface._tilesToRender,d=0;!c&&d<u.length;++d){var p=u[d];cesium.Rectangle.contains(p.rectangle,s)&&(c=p)}if(c){for(var g=c.data.imagery,f=g.length-1;f>=0;--f)if(!g[f].readyImagery)return void n();var m=c.tilingScheme.tileXYToNativeRectangle(c.x,c.y,c.level),y=(g.find((function(e){return e.readyImagery.imageryLayer.isBaseLayer()}))||{}).readyImagery;e.map.getResolution=function(){var t=e.view3D.crs!==e.view3D.view2DCRS?o.A.reproject([m.west,m.south],e.view3D.crs,e.view3D.view2DCRS):[m.west,m.south],r=e.view3D.crs!==e.view3D.view2DCRS?o.A.reproject([m.east,m.north],e.view3D.crs,e.view3D.view2DCRS):[m.east,m.north],n=(r[0]-t[0])/(y&&y.imageryLayer.imageryProvider.tileWidth||256),i=(r[1]-t[1])/(y&&y.imageryLayer.imageryProvider.tileHeight||256);return Math.max(n,i)}.bind(e,y,m),e.map.one(i.A.event.NOFEATUREINFO,function(e){r=!1,n(e)}.bind(l)),e.map.one(i.A.event.FEATUREINFO,(function(e){r=!1,n(e)})),e.map.on(i.A.event.FEATURECLICK,(function(e){h(),n(e)})),l.isActive=!0,l.beforeRequest({xy:[0,0]}),l.callback(a)}else n()}))}))},this.get2DMarker=function(){return l.filterFeature},this.isPending=function(){return r}},q=function(t){this.layerCrs=null;var r,a=["Contents","TileMatrixSet"],s=function(t,r,n){if(n<r.length-1)return e.call(t,r[n])?s(t[r[n]],r,++n):null;if(t instanceof Array){for(var i=[],o=0;o<t.length;o++)e.call(t[o],r[n])&&i.push(t[o][r[n]]);return i}return t[r[n]]},l=function(e){const t=this;return new Promise((function(r,l){let u,h,d=function(e,t){let r;if(r=o.A.isOnCapabilities(e.url)){let l;if(l=n.A.capabilities[r]){let r=s(l,a,0),n=s(l,["Contents","Layer"],0).filter((t=>e.names.indexOf(t.Identifier)>=0)).reduce(((e,t)=>e.concat(t.TileMatrixSetLink.map((e=>e.TileMatrixSet)))),[]);r=r.filter((e=>n.indexOf(e.Identifier)>=0));for(var i=0;i<r.length;i++)if(o.A.CRSCodesEqual(t,r[i].SupportedCRS))return{id:r[i].Identifier,labels:s(r[i],["TileMatrix","Identifier"],0)}}}return null}(e,t.layerCrs);if(i.A.WMTSEncoding.KVP===e.encoding)u=new cesium.Resource({url:e.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});else if(i.A.WMTSEncoding.RESTFUL===e.encoding){const r=e.wrap.getWMTSLayer({crs:t.layerCrs});r&&r.ResourceURL&&r.ResourceURL.length>0&&(h=r.ResourceURL[0],u=new cesium.Resource({url:h.template,request:new cesium.Request({type:cesium.RequestType.IMAGERY})}))}if(u&&d){u.tcLayer=e;let t={url:u,layer:e.layerNames,style:"default",format:h&&h.format||e.format||e.options.format,tilingScheme:new cesium.GeographicTilingScheme};if(i.A.WMTSEncoding.RESTFUL===e.encoding?t.tileMatrixSetID=d.id:i.A.WMTSEncoding.KVP===e.encoding&&d&&(t.tileMatrixSetID=d.id,t.tileMatrixLabels=d.labels),d&&d.labels){const e=d.labels[d.labels.length-1];t.maximumLevel=parseInt(e.substring(e.indexOf(":")+1))}r(new cesium.WebMapTileServiceImageryProvider(t))}else e.fallbackLayer?c(e.getFallbackLayer()).then((e=>{r(e)}),(()=>{l("Faltan datos para instanciar la capa")})):l("Faltan datos para instanciar la capa")}))},c=function(e){return new Promise((function(t,r){let n=new cesium.Resource({url:e.url,request:new cesium.Request({type:cesium.RequestType.IMAGERY})});n.tcLayer=e;let i={url:n,layers:e.layerNames,parameters:{version:"1.3.0",transparent:!0,format:e.format||e.options.format}};var o=function(){var t=[];if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0)for(var r=e.names.slice(0),n=function t(r,n){if(r){let o;for(var i=0;i<r.length;i++)if(o=r[i],e.compareNames(e.wrap.getName(o),n))return o.EX_GeographicBoundingBox;return t(o.Layer,n)}};r.length>0;){var i=n([e.capabilities.Capability.Layer],r.pop());null!==i&&t.push(i)}return t}();o&&(e.geoBBox=o),t(new cesium.WebMapServiceImageryProvider(i))}))},u=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(e){return!1}}();function h(e,t){var r=e.request;r.url=e.url,r.requestFunction=function(){var r=e.url,n=!1;e.isDataUri||e.isBlobUri||(n=e.isCrossOriginUrl);var i=cesium.when.defer();return function(e,t,r,n){e.getWebGLUrl.call(e,t).then((function(i){var o=new Image;o.onload=function(e){n.resolve(o)}.bind(o,e),o.onerror=function(e,t){n.reject(t)}.bind(o,e),r&&(cesium.TrustedServers.contains(t)?o.crossOrigin="use-credentials":o.crossOrigin=""),o.src=i.url}),(function(e){n.reject(e)}))}(e.layer,r,n&&t,i),i.promise};var n=cesium.RequestScheduler.request(r);if(cesium.defined(n))return n.otherwise((function(e){return cesium.when.reject(e)}))}var d=function(e,t){if(cesium.defined(t)&&cesium.deprecationWarning("Resource.fetchImage.allowCrossOrigin","The allowCrossOrigin parameter has been deprecated and will be removed in cesium 1.44. It no longer needs to be specified."),e=cesium.defaultValue(e,!1),t=cesium.defaultValue(t,!0),function(e){if(e.state===cesium.RequestState.ISSUED||e.state===cesium.RequestState.ACTIVE)throw new cesium.RuntimeError("The Resource is already being fetched.");e.state=cesium.RequestState.UNISSUED,e.deferred=void 0}(this.request),!u||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!e)return h(this,t);var r,n,i=this.fetchBlob();return cesium.defined(i)?i.then((function(e){if(cesium.defined(e)){n=e;var t=window.URL.createObjectURL(e);return h(r=new cesium.Resource({url:t}))}})).then((function(e){if(cesium.defined(e))return window.URL.revokeObjectURL(r.url),e.blob=n,e})).otherwise((function(e){return cesium.defined(r)&&window.URL.revokeObjectURL(r.url),cesium.when.reject(e)})):void 0};this.convert=function(e,t){switch(this.layerCrs=t,r||((r=function(e,t){cesium.Resource.call(this,e),this.layer=t}).prototype.constructor=r,r.prototype=Object.create(cesium.Resource.prototype,{}),r.prototype.clone=function(e){var t=cesium.Resource.prototype.clone.call(this,e);return cesium.defined(e)||(e=new r({url:this._url},this.layer)),e._url=t._url,e._queryParameters=t._queryParameters,e._templateValues=t._templateValues,e.headers=t.headers,e.proxy=t.proxy,e.retryCallback=t.retryCallback,e.retryAttempts=t.retryAttempts,e._retryCount=0,e.request=t.request,e},r.prototype.fetchImage=d),!0){case i.A.layerType.WMTS==e.type:return l.call(this,e);case i.A.layerType.WMS==e.type:return c.call(this,e)}}},W=function(){var t=function(e,t){e instanceof Array&&(e="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")");var r=cesium.Color.fromCssColorString(e);return void 0!==t?r.withAlpha(t):r},r=function(e,t,r){for(var n in t){var i=e[t[n].prop];if(void 0!==i)if("function"==typeof i){var o=i(r);o&&(t[n].val=o)}else t[n].val=i}},i=function(t){var r;return r=null==(r=!t.layer||t.layer&&!e.call(t.layer,"styles")?n.A.Defaults.styles:t.layer.styles)[t.STYLETYPE]?r["polyline"===t.STYLETYPE?"line":t.STYLETYPE]:r["multipolygon"===t.STYLETYPE?"polygon":t.STYLETYPE],o.A.extend({},r,t.options,t.getStyle())};function a(e,t,r,n){const i={name:e,polyline:{positions:t,width:r.width,material:r.material,clampToGround:!0}};g(i,r,t),n(new cesium.Entity(i))}function g(e,t,r){t.label&&(e.position=r instanceof cesium.Cartesian3?r:cesium.BoundingSphere.fromPoints(r).center,e.label={text:t.label,pixelOffset:new cesium.Cartesian2(...t.labelOffset||[0,0]),eyeOffset:new cesium.Cartesian3(0,0,0),outlineColor:cesium.Color.WHITE,font:t.fontSize+"pt sans-serif",fillColor:t.fontColor,outlineWidth:4,style:cesium.LabelStyle.FILL_AND_OUTLINE,heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.CENTER,verticalOrigin:cesium.VerticalOrigin.CENTER},t.fontColor&&(e.label.fillColor=t.fontColor),t.fontSize&&(e.label.font=t.fontSize+"pt sans-serif"))}var f=function(n){var o={},s=i(n);return o.options=function(){var i,o={},a={color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"},fontColor:{prop:"fontColor"},fontSize:{prop:"fontSize"},label:{prop:"label"}};return r(s,a,n),e.call(a.color,"val")&&(i=e.call(a.opacity,"val")?t(a.color.val,a.opacity.val):t(a.color.val)),o.color=i,e.call(a.outlineColor,"val")&&(i=e.call(a.outlineOpacity,"val")?t(a.outlineColor.val,a.outlineOpacity.val):t(a.outlineColor.val)),o.outlineColor=i,e.call(a.width,"val")&&(o.width=a.width.val),e.call(a.label,"val")&&(o.label=a.label.val,e.call(a.fontColor,"val")&&(o.fontColor=t(a.fontColor.val)),e.call(a.fontSize,"val")&&(o.fontSize=a.fontSize.val)),o},n instanceof d.A?o.geometryType=function(e,t){return new Promise((function(r,i){for(var o=[],s=[],l=[],c=function(e){return new Promise((function(r,i){a(n.id,e,{material:t.outlineColor,width:t.width},(function(e){l.push(e),r()}))}))},u=0;u<e.length;u++){let r;for(var h=0;h<e[u].length;h++)0==h?(o.push(c.call(this,e[u][0])),r=new cesium.PolygonHierarchy(e[u][0])):(o.push(c.call(this,e[u][h])),r.holes.push(new cesium.PolygonHierarchy(e[u][h])));s.push((d=r,new cesium.GeometryInstance({id:n.id,geometry:new cesium.PolygonGeometry({polygonHierarchy:d}),attributes:{color:cesium.ColorGeometryInstanceAttribute.fromColor(t.color)}})))}var d;Promise.all(o).then((function(){o=[],r([new cesium.GroundPrimitive({releaseGeometryInstances:!1,geometryInstances:s}),l])})).catch(i)}))}:n instanceof h.A&&(o.geometryType=function(e,t){return new Promise((function(r,i){Array.isArray(e)&&1===e.length&&Array.isArray(e[0])&&(e=e[0]),function(e,t,r,n){const i={name:e,polyline:{positions:t,width:r.width,material:r.outlineColor,clampToGround:!0},polygon:{hierarchy:new cesium.PolygonHierarchy(t),material:r.color,clampToGround:!0}};g(i,r,t),n(new cesium.Entity(i))}(n.id,e,t,(function(e){r(e)}))}))}),o},m=function(n){var o={},s=i(n);return o.options=function(){var i,o={},a={material:{prop:"strokeColor"},opacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"},fontColor:{prop:"fontColor"},fontSize:{prop:"fontSize"},label:{prop:"label"}};return r(s,a,n),e.call(a.width,"val")&&(o.width=a.width.val),e.call(a.material,"val")&&(i=e.call(a.opacity,"val")?t(a.material.val,a.opacity.val):t(a.material.val)),o.material=i,e.call(a.width,"val")&&(o.width=a.width.val),e.call(a.label,"val")&&(o.label=a.label.val,e.call(a.fontColor,"val")&&(o.fontColor=t(a.fontColor.val)),e.call(a.fontSize,"val")&&(o.fontSize=a.fontSize.val)),o},n instanceof u.A?o.geometryType=function(e,t){return new Promise((function(r,i){var o=[],s=[];if(1==e.length)e=e[0],s.push(new Promise((function(r,i){a(n.id,e,t,(function(e){o.push(e),r()}))})));else{e=e.sort((function(e,t){return e.length>t.length?-1:e.length<t.length?1:0}));for(var l=0;l<e.length;l++)s.push(new Promise((function(r,i){a(n.id,e[l],t,(function(e){o.push(e),r()}))})))}Promise.all(s).then((function(){s=[],r(o)})).catch(i)}))}:n instanceof c.A&&(o.geometryType=function(e,t){return new Promise((function(r,i){a(n.id,e,t,(function(e){r(e)}))}))}),o};this.convert=function(a,y,v,A){const S=this;var E,w,_,L,C,b=!1,T=[],x=function(e,t){Array.isArray(e)&&(v!==A&&(e=o.A.reproject(e,v,A)),t.push(e.length>2?cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):cesium.Cartesian3.fromDegrees(e[0],e[1])))},P=y.geometry,M=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)x(e[r],t)},I=function(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.push([]),M(e[r],t[t.length-1])};switch(!0){case y instanceof d.A:C=P,Array.isArray(C)&&(function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)T.push([]),I(e[t],T[T.length-1])}(C),w=f.call(S,y),b=!0);break;case y instanceof p.A:P=(y=y.toPolygon()).geometry;case y instanceof h.A||y instanceof u.A:L=P,Array.isArray(L)&&(I(L,T),y instanceof h.A?(w=f(y),b=!0):y instanceof u.A&&(w=m(y),b=!0));break;case y instanceof c.A:_=P,Array.isArray(_)&&(M(_,T),w=m(y),b=!0);break;case y instanceof l.A:case y instanceof s.A:M(_=[P],T),w=function(o){var a={},c=i(o);if(a.options=function(){var i={},a={rotation:{prop:"angle"},label:{prop:"label"},labelOffset:{prop:"labelOffset"},fontSize:{prop:"fontSize"},fontColor:{prop:"fontColor"},outlineLabelColor:{prop:"labelOutlineColor"},outlineLabelWidth:{prop:"labelOutlineWidth"},anchor:{prop:"anchor"},height:{prop:"height"},width:{prop:"width"},url:{prop:"url"},color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},outlineWidth:{prop:"strokeWidth"},radius:{prop:"radius"}};return r(c,a,o),e.call(a.anchor,"val")&&(e.call(a.url,"val")||!o.options.url&&!o.options.cssClass?i.url=a.url.val:i.url=o.options.url||n.A.Util.getFeatureStyleFromCss(o.options.cssClass)?.url,i.anchor=a.anchor.val),e.call(a.height,"val")&&(i.height=a.height.val),e.call(a.width,"val")&&(i.width=a.width.val),e.call(a.rotation,"val")&&(i.rotation=a.rotation.val),e.call(a.label,"val")&&(i.label=a.label.val),e.call(a.fontSize,"val")&&(i.fontSize=a.fontSize.val,e.call(a.labelOffset,"val")&&(i.labelOffset=a.labelOffset.val)),e.call(a.fontColor,"val")&&(i.fontColor=t(a.fontColor.val)),e.call(a.outlineLabelColor,"val")&&(i.outlineLabelColor=t(a.outlineLabelColor.val)),e.call(a.outlineLabelWidth,"val")&&(i.outlineLabelWidth=a.outlineLabelWidth.val),e.call(a.color,"val")&&(e.call(a.opacity,"val")?i.color=t(a.color.val,a.opacity.val):i.color=t(a.color.val)),e.call(a.outlineColor,"val")&&(e.call(a.outlineOpacity,"val")?i.outlineColor=t(a.outlineColor.val,a.outlineOpacity.val):i.outlineColor=t(a.outlineColor.val)),e.call(a.outlineWidth,"val")&&(i.outlineWidth=a.outlineWidth.val),e.call(a.radius,"val")&&(i.radius=a.radius.val),i},o instanceof l.A)a.geometryType=function(e,t){var r={name:o.id,position:e[0],billboard:{image:t.url,width:t.width,height:t.height,eyeOffset:new cesium.Cartesian3(0,0,10),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}};return t.anchor&&t.anchor.length>0&&(r.billboard.pixelOffset=new cesium.Cartesian2(t.anchor[0],t.anchor[1])),t.label?(r.label={text:t.label,eyeOffset:new cesium.Cartesian3(0,0,0),pixelOffset:new cesium.Cartesian2(...t.labelOffset||[0,0]),heightReference:cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:cesium.HorizontalOrigin.CENTER,verticalOrigin:cesium.VerticalOrigin.CENTER,font:t.fontSize+"pt sans-serif",fillColor:t.fontColor,outlineColor:cesium.Color.WHITE,outlineWidth:4,style:cesium.LabelStyle.FILL_AND_OUTLINE},new cesium.Entity(r)):new cesium.Entity(r)};else if(o instanceof s.A){var u=new cesium.PinBuilder;a.geometryType=function(e,t){var r=t.label,i={name:o.id,position:e[0]};return!r||!/^([A-Z])\w+$/gi.test(r)&&/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(r)||g(i,t,e[0]),r&&/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(r)?i.billboard={image:u.fromText(r,t.fontColor,48).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,10),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}:t.radius&&t.radius>0?i.point={color:t.color,pixelSize:2*t.radius-t.outlineWidth,outlineWidth:t.outlineWidth,outlineColor:t.outlineColor,eyeOffset:new cesium.Cartesian3(0,0,10),heightReference:cesium.HeightReference.CLAMP_TO_GROUND}:i.billboard={image:u.fromColor(cesium.Color.fromCssColorString(o.options.fillColor?o.options.fillColor:n.A.Cfg.styles.point.fillColor),32).toDataURL(),eyeOffset:new cesium.Cartesian3(0,0,10),verticalOrigin:cesium.VerticalOrigin.BOTTOM,horizontalOrigin:cesium.HorizontalOrigin.CENTER,heightReference:cesium.HeightReference.CLAMP_TO_GROUND},new cesium.Entity(i)}}return a}(y)}return 0==T.length?null:((E={id:y.id,attributes:y.data,boundigSphere:cesium.BoundingSphere.fromPoints(T)}).geometry=b?function(e){return w.provider=e,w.geometryType(T,w.options())}:w.geometryType(T,w.options()),E)}},H={baseMap:"",baseMaps:[],baseVector:""},j=function(e){const t=this;return new Promise((function(r,n){var i=e.baseLayer instanceof g.A;if(i){if(!C(e.baseLayer,t.view3D.crs)){var o=e.baseLayer.getFallbackLayer();o&&o.getCapabilitiesPromise().then((function(){o.isCompatible(t.view3D.crs)||e.toast(t.getLocaleString("threed.baseLayerNoCompatible",{name:e.baseLayer.layerNames}))}))}}else H.baseVector=e.baseLayer;0===H.baseMaps.length&&Promise.all(e.baseLayers.map((function(e){if(C(e,t.view3D.crs))return Promise.resolve(!1);var r=e.getFallbackLayer();return r?r.getCapabilitiesPromise().then((function(){return!r.isCompatible(t.view3D.crs)})):Promise.resolve(!0)}))).then((function(t){if(t.length>0)for(var n=0;n<e.baseLayers.length;n++)e.baseLayers[n]&&(e.baseLayers[n].mustReproject=t[n]);r()})).catch(n),H.baseMap=i?e.baseLayer:t.Consts.BLANK_BASE}))};return t.init=function(e){const t=this;t.events=t.map.$events,t.selectors={divThreedMap:e.div},e.terrain?t.terrain=e.terrain:t.terrain={url:"//idena.navarra.es/cesiumTerrain/2017/epsg4326/5m/",noDataValue:0,attributions:{name:"Álvaro Huarte",site:"https://github.com/ahuarte47"}};e.terrainFallback?t.terrainFallback=(Array.isArray(e.terrainFallback)?e.terrainFallback:[e.terrainFallback]).map((e=>!e||e.url&&(e.coverageName||e.layerName||"QM"==e.type)&&void 0!==e.noDataValue?{url:e.url.trim(),layerName:e.coverageName||e.layerName,format:e.format,noDataValue:e.noDataValue,type:e.type,constraints:e.constraints}:{url:"https://qm-mdt.idee.es/1.0.0/terrain/",noDataValue:0,type:"QM"})):t.terrainFallback=[{url:"https://qm-mdt.idee.es/1.0.0/terrain/",noDataValue:0,type:"QM"}],e.controls&&(t.allowedControls=e.controls),t.mapView=new a(t.map,t),t.map.on(i.A.event.PROJECTIONCHANGE,(function(e){t.mapView.metersPerUnit=t.map.getMetersPerUnit()})),t.map.on(i.A.event.CHANGELANGUAGE,(function(){t.view3D.cameraControls.updateModel()})),t.map.view3D=t.view3D,t.getRenderedHtml(t.CLASS+"-overlay",{},(function(e){const r=new DOMParser;t.overlay=r.parseFromString(e,"text/html").body.firstChild}))},t.apply=function(t={}){const r=this;if(!t.map)throw Error("Falta referencia al mapa 2D");if(r.map=t.map,r.map.getDefaultControl()!==r.map.activeControl&&r.map.activeControl?.deactivate(),!r.map.view3D){var a=r.VIEWNAME=r.VIEWNAME.substr(0,1).toLowerCase()+r.VIEWNAME.substr(1);if(!r.map.options.views||!e.call(r.map.options.views,a))throw Error("Falta configuración de la vista");r.init(r.map.options.views[a])}if(r.view3D.view2DCRS=t.map.crs,t.map.on(i.A.event.PROJECTIONCHANGE,(function(e){r.view3D.view2DCRS=e.newCrs})),t.state&&r.map.toast(o.A.getLocaleString(r.map.options.locale,"threed.apply3DState"),{type:i.A.msgType.INFO}),r.waiting||(r.waiting=r.map.getLoadingIndicator().addWait()),!r.ctrlsToMng){for(var s=[],l=0,c=r.allowedControls.length;l<c;l++){var u=r.allowedControls[l];u=u.substr(0,1).toUpperCase()+u.substr(1);var h=r.map.getControlsByClass("TC.control."+u);0===h.length&&(u=u.toUpperCase(),h=r.map.getControlsByClass("TC.control."+u)),s=s.concat(h)}r.map.on(i.A.event.CONTROLADD,(function(e){r.allowedControls.some((t=>{const r=t.substr(0,1).toUpperCase()+t.substr(1);return n.A.control[r]&&e.control instanceof n.A.control[r]}))&&r.ctrlsToMng.push(e.control)})),r.ctrlsToMng=s}r.map.on3DView=!0,r.map.div.classList.add(i.A.classes.THREED),r.divThreedMap=document.querySelector("#"+r.selectors.divThreedMap),r.divThreedMap.classList.add(r.classes.MAP3D,r.classes.LOADING),r.view3D.container=r.divThreedMap;const d=async function(){console.log("Llega a applyEnd"),r.map.getLoadingIndicator().removeWait(r.waiting),delete r.waiting,t.callback&&t.callback()};try{r.view3D.loadViewer.call(r).then((function(){r.divThreedMap.classList.remove(r.CLASS+"-div-fadeOut"),r.divThreedMap.classList.add(r.CLASS+"-div-fadeIn"),r.mapView.viewHTML.classList.remove(r.CLASS+"-div-fadeIn"),r.mapView.viewHTML.classList.add(r.CLASS+"-div-fadeOut"),t.state||r.divThreedMap.classList.remove(r.classes.LOADING),j.call(r,r.map).then((function(){r.view3D.setCameraFromMapView.call(r),r.view3D.setBaseLayer.call(r,r.map.baseLayer),r.map.workLayers.filter((function(e){return e.type===i.A.layerType.WMTS||e.type===i.A.layerType.WMS})).reverse().forEach((function(e){r.view3D.addLayer.call(r,e)})),r.viewer.readyPromise.then(function(){if(r.view3D.cameraControls?r.view3D.cameraControls.render.call(r.view3D.cameraControls):r.view3D.cameraControls=new B(r),t.animateRendering||t.state||(t.animateRendering=!0),t.state)r.divThreedMap.classList.remove(r.classes.LOADING),r.view3D.cameraControls.getCamera().flyTo({destination:cesium.Cartesian3.fromRadians(t.state.cp[0],t.state.cp[1],t.state.cp[2]),orientation:{heading:t.state.chpr[0],pitch:t.state.chpr[1],roll:t.state.chpr[2]},complete:d});else if(t.animateRendering){let e=cesium.Math.toRadians(50),t=N(r.viewer.scene);const i=function(t){let n=cesium.Matrix4.fromTranslation(t);r.view3D.rotateAroundAxis(r.viewer.scene.camera,-e,r.viewer.scene.camera.right,n,{duration:2e3,callback:o})},o=function(){cesium.Camera.DEFAULT_VIEW_RECTANGLE=r.view3D.initialRectangle=r.viewer.camera.computeViewRectangle(),cesium.Camera.DEFAULT_VIEW_FACTOR=0,d()};if(t)i(t);else{const e=r.mapView.map.getExtent(),t=n.A.Util.reprojectExtent(e,r.map.crs,r.view3D.crs),i=function(){cesium.Camera.DEFAULT_VIEW_RECTANGLE=r.view3D.initialRectangle=r.viewer.camera.computeViewRectangle(),cesium.Camera.DEFAULT_VIEW_FACTOR=0,d()},o=cesium.Rectangle.fromDegrees(t[0],t[1],t[2],t[3]);r.viewer.scene.camera.flyTo({destination:o,complete:()=>{let e=cesium.Math.toRadians(50),t=D(r.viewer.scene),n=cesium.Matrix4.fromTranslation(t);r.view3D.rotateAroundAxis(r.viewer.scene.camera,-e,r.viewer.scene.camera.right,n,{duration:2e3,callback:i})}})}}else d();r.map.trigger(i.A.event.VIEWCHANGE,{view:i.A.view.THREED}),r.events.on(i.A.event.TERRAINLOADED,(function(){const e=function(e){var t=cesium.Ellipsoid.WGS84.cartesianToCartographic(e),n=r.viewer.scene.globe.getHeight(t)||0,i={longitude:t.longitude,latitude:t.latitude,height:t.height+n};return cesium.Ellipsoid.WGS84.cartographicToCartesian(i)};var t=r.viewer.entities.values.filter((function(e){return e.billboard}));if(t.length>0&&t.forEach((function(t){t.position=e(cesium.Property.getValueOrUndefined(t.position,cesium.JulianDate.now))})),r.viewer.billboardCollection){for(var n=0;n<r.viewer.billboardCollection.length;n++)r.viewer.billboardCollection.get(n).position=e(r.viewer.billboardCollection.get(n).position);r.viewer.scene.requestRender()}}))}.bind(r)).catch((e=>{console.log("3051"),d()}))})).catch((e=>{console.log("3053"),d()}))})).catch((e=>{console.log("3055"),d()}))}catch(e){throw d(),e}},t.unapply=function(e){const t=this;if(t.waiting||(t.waiting=t.map.getLoadingIndicator().addWait()),t.map.getDefaultControl()!==t.map.activeControl&&t.map.activeControl?.deactivate(),t.map.view3D.crs!==t.map.view3D.view2DCRS){let e=t.view3D.viewer.dataSources.getByName("drawn")[0];for(let r in t.map.view3D.vector2DFeatures)for(let n in t.map.view3D.vector2DFeatures[r])t.map.view3D.vector2DFeatures[r][n].filter((e=>e instanceof cesium.Entity)).forEach((r=>{if(!e?.entities.contains(r))return;const n=r._wrap.parent;n.setCoordinates(n.getCoordinates({geometryCrs:t.map.view3D.crs,crs:t.map.view3D.view2DCRS})),delete n.wrap.feature3D}))}let r=t.view3D.viewer.dataSources.getByName("drawn")[0];r?.entities.length&&r?.entities.removeAll(),t.map.on3DView=!1,t.viewer&&t.viewer.trackedEntity&&t.view3D.linked2DControls.geolocation.wrap.simulateTrackEnd(),t.view3D.cameraControls.resetRotation({duration:1e3}).then((function(){var r=N(t.viewer.scene),n=cesium.Matrix4.fromTranslation(r),o=F(t.viewer.scene,r);t.view3D.rotateAroundAxis(t.viewer.scene.camera,-o,t.viewer.scene.camera.right,n,{duration:1500,callback:function(){t.map.div.classList.remove(i.A.classes.THREED),t.map.trigger(i.A.event.TERRAINPROVIDERREMOVE,{terrainProvider:t.viewer.scene.terrainProvider}),t.viewer.scene.terrainProvider.fallbackProvider&&t.viewer.scene.terrainProvider.fallbackProvider.forEach((function(e){t.map.trigger(i.A.event.TERRAINPROVIDERREMOVE,{terrainProvider:e})})),t.view3D.setViewFromCameraView.call(t).then((function(){t.divThreedMap.classList.remove(t.classes.MAP3D,t.CLASS+"-div-fadeIn"),t.divThreedMap.classList.add(t.CLASS+"-div-fadeOut"),t.mapView.viewHTML.classList.remove(t.CLASS+"-div-fadeOut"),t.mapView.viewHTML.classList.add(t.CLASS+"-div-fadeIn"),t.view3D.destroy.call(t),t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting,e?.callback&&e.callback()})),t.mapView.setRotation(0),t._ovMap&&t._ovMap.wrap.draw3DCamera(null)}})})).catch((function(e){throw e}))},t.view3D=function(){let a=null;const u=new q(/(EPSG\:?4326)/i),d=new W,p=function(t,r){var n=t;switch(!0){case t instanceof cesium.GroundPrimitive:(r||this.viewer.scene).groundPrimitives.add(t);break;case t instanceof Object&&e.call(t,"billboard"):this.viewer.billboardCollection||(this.viewer.billboardCollection=(r||this.viewer.scene).primitives.add(new cesium.BillboardCollection({scene:this.viewer.scene}))),n=(r||this.viewer).billboardCollection.add({position:t.position,image:t.billboard.image,verticalOrigin:t.billboard.verticalOrigin,heightReference:t.billboard.heightReference,id:t.billboard.id});break;case t instanceof Object:(n=this.viewer.entities.getById(t.id))||(n=(r||this.viewer).entities.add(t))}return this.viewer.scene.requestRender(),n},g=function(t,r,n){e.call(t.vector2DFeatures,r.layer.id)?e.call(t.vector2DFeatures[r.layer.id],r.id)?t.vector2DFeatures[r.layer.id][r.id].push(n):t.vector2DFeatures[r.layer.id][r.id]=[n]:(t.vector2DFeatures[r.layer.id]={},t.vector2DFeatures[r.layer.id][r.id]=[n]),n instanceof cesium.Entity&&(r.wrap.feature3D=n,n._wrap={parent:r})},A=[i.A.event.BEFOREBASELAYERCHANGE,i.A.event.BASELAYERCHANGE,i.A.event.LAYERADD,i.A.event.LAYERREMOVE,i.A.event.LAYERVISIBILITY,i.A.event.LAYEROPACITY,i.A.event.LAYERORDER,i.A.event.FEATUREADD,i.A.event.FEATUREREMOVE,i.A.event.FEATURESCLEAR,i.A.event.ZOOMTO],S=function(t){var r=this;switch(!0){case t.type==i.A.event.BASELAYERCHANGE:r.view3D.setBaseLayer.call(r,t.layer);break;case t.type==i.A.event.LAYERADD:r.view3D.addLayer.call(r,t.layer);break;case t.type==i.A.event.LAYERREMOVE:r.view3D.removeLayer.call(r,t.layer);break;case t.type==i.A.event.LAYERVISIBILITY:r.view3D.setRenderOptionsLayer.call(r,t.layer,{visibility:t.layer.getVisibility()});break;case t.type==i.A.event.LAYEROPACITY:r.view3D.setRenderOptionsLayer.call(r,t.layer,{opacity:t.layer.getOpacity()}),r.viewer.scene.requestRender();break;case t.type==i.A.event.LAYERORDER:for(var o=0;o<r.view3D.workLayers.length;o++)if(r.view3D.workLayers[o].imageryProvider&&r.view3D.workLayers[o].imageryProvider.layers.join(",")===t.layer.names.join(",")){if(t.oldIndex>t.newIndex){const e=t.oldIndex-t.newIndex;for(let t=0;t<e;t++)r.viewer.scene.imageryLayers.lower(r.view3D.workLayers[o])}else{const e=t.newIndex-t.oldIndex;for(let t=0;t<e;t++)r.viewer.scene.imageryLayers.raise(r.view3D.workLayers[o])}r.view3D.workLayers.splice(t.newIndex,0,r.view3D.workLayers.splice(t.oldIndex,1)[0]);break}break;case t.type==i.A.event.FEATUREADD:t.layer?.owner&&t.layer.owner instanceof n.A.control.DrawMeasureModify||r.view3D.addFeature.call(r.view3D,t.feature);break;case t.type==i.A.event.FEATUREREMOVE:if(r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.layer.id)){const n=function(n){e.call(r.view3D.vector2DFeatures[t.layer.id],n.id)&&(r.view3D.vector2DFeatures[t.layer.id][n.id].forEach((e=>r.view3D.removeFeature.call(r,e))),delete r.view3D.vector2DFeatures[t.layer.id][n.id])};t.feature instanceof Array?t.feature.forEach(n):n(t.feature)}break;case t.type==i.A.event.FEATURESCLEAR:if(r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.layer.id))for(var a in r.view3D.viewer.dataSources.getByName("drawing").forEach((e=>{e.entities.removeAll()})),r.view3D.viewer.dataSources.getByName("drawn").forEach((e=>{e.entities.removeAll()})),r.view3D.vector2DFeatures[t.layer.id])r.view3D.vector2DFeatures[t.layer.id][a].forEach((e=>r.view3D.removeFeature.call(r,e))),delete r.view3D.vector2DFeatures[t.layer.id][a];break;case t.type==i.A.event.ZOOM:if(r.view3D.cameraControls&&!r.view3D.cameraControls.moving){var s=r.view3D.viewer.scene.canvas.clientWidth,l=r.view3D.viewer.scene.canvas.clientHeight;if(!r.view3D._canvasClientHeight||!r.view3D._canvasClientWidth||s!==r.view3D._canvasClientWidth||l!==r.view3D._canvasClientHeight)return r.view3D._canvasClientWidth||(r.view3D._canvasClientWidth=r.view3D.viewer.scene.canvas.clientWidth),r.view3D._canvasClientHeight||(r.view3D._canvasClientHeight=r.view3D.viewer.scene.canvas.clientHeight),r.view3D._canvasClientWidth=s,void(r.view3D._canvasClientHeight=l);r.view3D.flyToMapCoordinates.call(r,r.mapView.getCenter())}break;case t.type==i.A.event.ZOOMTO:{if(r.lastZoom&&performance.now()-r.lastZoom<50)return;r.lastZoom=performance.now();let e=cesium.Rectangle.fromDegrees(...t.extent);r.view3D.flyToRectangle.call(r,e);break}}},E=function(){var e=this;if(e.map.on3DView&&!e.view3D.geotrackingEntity){var t=e.view3D.linked2DControls.geolocation,r=t.geotrackingLayer.features.filter((function(e){return e instanceof c.A}));if(r&&r.length>0){var n=[];const a=new cesium.CallbackProperty(function(e,t){if(r[0].geometry.length>n.length){var i,a=r[0].geometry.slice(n.length).map(function(e){var t=e;return this.view3D.view2DCRS!==this.view3D.crs&&(t=o.A.reproject(e,this.view3D.view2DCRS,this.view3D.crs)),cesium.Cartographic.fromDegrees(t[0],t[1],e[2])}.bind(this));return i=a instanceof Array?cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(a):[cesium.Ellipsoid.WGS84.cartographicToCartesian(a)],n=n.concat(i)}return n}.bind(this),!1);var i=new cesium.Entity({id:"geotrackingEntity",polyline:{positions:a,clampToGround:!0,width:3,material:new cesium.PolylineDashMaterialProperty({color:new cesium.CallbackProperty(function(r,n){return e.viewer.scene.requestRender(),cesium.Color.fromAlpha(new cesium.Color(0,255,209),t.track.renderTrack.checked?1:0)}.bind(this),!1),gapColor:cesium.Color.TRANSPARENT})}});e.view3D.geotrackingEntity=e.viewer.entities.add(i),e.viewer.scene.requestRender()}}},w=function(e){var t=this,r=t.view3D.linked2DControls.geolocation;switch(!0){case r.const.event.IMPORTEDTRACK.indexOf(e.type)>-1:case e.target.className.indexOf("draw")>-1&&e.target.parentElement.classList.contains(r.const.className.SELECTEDTRACK):case!(e.target.parentElement&&e.target.parentElement.classList.contains(r.const.className.SELECTEDTRACK)):case e.target.className.indexOf("stop")>-1:if(t.map.on3DView&&(t.viewer.clock.shouldAnimate=!1,t.viewer.clock.currentTime=cesium.JulianDate.fromDate(new Date)),t.view3D.trackDataSource){if(t.view3D.trackDataSource.length>0){var n=t.view3D.trackDataSource.get(0).entities.values[0];t.viewer.entities.removeById(n.id)}t.view3D.trackDataSource.destroy(),delete t.view3D.trackDataSource}if(r.clearChartProgress(),e.custom){const e=r.getSelectedTrackItem();e&&e.querySelector(r.const.selector.STOP).click()}break;case e.target.classList.contains(r.const.className.PLAY):t.viewer.clock.shouldAnimate=!1;break;case e.target.classList.contains(r.const.className.PAUSE):t.viewer.clock.shouldAnimate=!0}},_=function(e,t){return e.containerControl?_(e.containerControl,t):t.indexOf(e.CLASS)<0},L=function(t){var r=this;const u=r.ctrlsToMng.map((function(e){return e.CLASS}));switch(r.map.controls.forEach((function(e){if(_(e,u))switch(!0){case i.A.view.DEFAULT==t:e.enable();break;case i.A.view.THREED==t:e.disable()}})),!0){case i.A.view.DEFAULT==t:document.querySelectorAll("[data-no-3d]").forEach((function(e){e.classList.remove(i.A.classes.THREED_HIDDEN)})),r.ctrlsToMng.forEach((function(e){e.div&&e.div.classList.remove(i.A.classes.THREED)}));break;case i.A.view.THREED==t:document.querySelectorAll("[data-no-3d]").forEach((function(e){e.classList.add(i.A.classes.THREED_HIDDEN)})),r.ctrlsToMng.forEach((function(e){e.div?.classList.add(i.A.classes.THREED)}))}var h=!1,d=null;const p=[];let g=!1;if(i.A.view.THREED===t?(!r.view3D.linked2DControls.featureInfo&&Object.keys(r.map.options.controls).indexOf("featureInfo")>-1&&r.allowedControls.indexOf("featureInfo")>-1&&(r.view3D.linked2DControls.featureInfo=new U(r)),r.eventHandlers||(r.eventHandlers={}),r.eventHandlers.handlerOfFeatures=new cesium.ScreenSpaceEventHandler(r.viewer.scene.canvas),r.eventHandlers.handlerOfFeatures.setInputAction((t=>{if(r.viewer.trackedEntity)return;const a=function(){var e=r.viewer.camera.getPickRay(t.position),n=r.viewer.scene.globe.pick(e,r.viewer.scene);n&&r.view3D.getInfoOnPickedPosition.call(r,n)};if(r.map.activeControl instanceof m.default||r.map.activeControl instanceof y.default){let e=r.viewer.scene.pickPosition(t.position);p[p.length]=e}else{var c=r.viewer.scene.pick(t.position);if(c&&c.id){var u=c.id instanceof cesium.Entity?c.id.name:c.id,h=!1;for(var d in r.view3D.vector2DFeatures)if(e.call(r.view3D.vector2DFeatures[d],u)){const e=r.map.workLayers.find((e=>e.id===d)).features.filter((e=>u.indexOf(e.id)>-1&&e.showsPopup));if(e&&e.length>0){if(h=!0,!(e instanceof s.A||e instanceof l.A)){var g=r.viewer.camera.getPickRay(t.position);let e=r.viewer.scene.globe.pick(g,r.viewer.scene);var f=r.map.view3D.addNativeFeature.call(r.map,{position:e,billboard:{image:o.A.getFeatureStyleFromCss(r.CLASS+"-marker")?.url,eyeOffset:new cesium.Cartesian3(0,0,-100),verticalOrigin:cesium.VerticalOrigin.BOTTOM,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});const n=function(e){if(e.control){const t=e.control,o=function(e){e.control===t&&(r.map.off(i.A.event.RESULTSPANELCLOSE,o),r.map.view3D.removeFeature.call(r,f))};r.map.on(i.A.event.RESULTSPANELCLOSE,o),r.map.off(i.A.event.DRAWTABLE,n)}};r.map.on(i.A.event.DRAWTABLE,n)}r.map.getControlsByClass(n.A.control.ResultsPanel).find((e=>e.isVisible()))?.close(),r.map.trigger(i.A.event.FEATURECLICK,{feature:e[0]});break}}h||a()}else a()}}),cesium.ScreenSpaceEventType.LEFT_CLICK),r.eventHandlers.handlerOfFeatures.setInputAction((e=>{if(!r.viewer.trackedEntity){var t=r.viewer.scene.pick(e.endPosition);if(!t||!t.id||r.map.activeControl instanceof m.default?r.viewer.canvas.style.cursor="default":r.viewer.canvas.style.cursor="pointer",h&&d&&!g){const t=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.endPosition),r.viewer.scene);d.primitive.position=t,g=!0,r.viewer.scene.requestRender(),setTimeout((function(){g=!1}),200)}}}),cesium.ScreenSpaceEventType.MOUSE_MOVE),r.eventHandlers.handlerOfFeatures.setInputAction((e=>{var t=r.viewer.scene.pick(e.position);t&&t.id&&(h=!0,a=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.position),r.viewer.scene),d=t,r.viewer.scene.screenSpaceCameraController.enableInputs=!1)}),cesium.ScreenSpaceEventType.LEFT_DOWN),r.eventHandlers.handlerOfFeatures.setInputAction((e=>{if(h=!1,d){const o=r.viewer.scene.globe.pick(r.viewer.camera.getPickRay(e.position),r.viewer.scene);d.primitive.position=o;var t=cesium.Ellipsoid.WGS84.cartesianToCartographic(o),n=cesium.Ellipsoid.WGS84.cartesianToCartographic(a);r.map.trigger(i.A.event.THREED_DRAG,{pickedFeature:d.primitive,newCoords:[cesium.Math.toDegrees(t.longitude),cesium.Math.toDegrees(t.latitude)],oldCoords:[cesium.Math.toDegrees(n.longitude),cesium.Math.toDegrees(n.latitude)]}),d=null,r.viewer.scene.screenSpaceCameraController.enableInputs=!0}}),cesium.ScreenSpaceEventType.LEFT_UP)):i.A.view.DEFAULT===t&&r.eventHandlers.handlerOfFeatures&&r.eventHandlers.handlerOfFeatures.destroy(),!r.view3D.linked2DControls.geolocation&&Object.keys(r.map.options.controls).indexOf("geolocation")>-1&&r.allowedControls.indexOf("geolocation")>-1&&(r.view3D.linked2DControls.geolocation=r.ctrlsToMng.find((function(e){return e instanceof n.A.control.Geolocation}))),r.view3D.linked2DControls.geolocation){var f=r.view3D.linked2DControls.geolocation;if(i.A.view.THREED===t){var v=[f.const.selector.STOP,f.const.selector.PAUSE,f.const.selector.BACKWARD,f.const.selector.FORWARD],A=w.bind(r);r.view3D.linked2DControls.geolocation.videoControls=A;var S=function(e){v.some((function(t){return e.target.classList.contains(t.replace(".",""))}))&&A(e)};f.reset=function(){n.A.wrap.control.Geolocation.prototype.setGeotracking=f._setGeotracking,n.A.wrap.control.Geolocation.prototype.simulateTrack=f._wrap_simulateTrack,f.simulateTrack=f._simulateTrack,f.displayTrackProfile=f._displayTrackProfile,v.forEach((function(e){document.removeEventListener("click",S)})),f.off(f.const.event.IMPORTEDTRACK,A)},document.addEventListener("click",S),f.on(f.const.event.IMPORTEDTRACK,A),f._setGeotracking=n.A.wrap.control.Geolocation.prototype.setGeotracking,n.A.wrap.control.Geolocation.prototype.setGeotracking=function(e){f._setGeotracking.call(f.wrap,e),e?f.on(f.const.event.POSITIONCHANGE,E.bind(r)):(f.off(f.const.event.POSITIONCHANGE,E.bind(r)),r.view3D.geotrackingEntity&&(r.viewer.entities.removeById(r.view3D.geotrackingEntity.id),delete r.view3D.geotrackingEntity))},f._displayTrackProfile=f.displayTrackProfile,f.displayTrackProfile=function(e,t){return t?.resized&&w.call(r,{target:{className:"stop"},custom:!0}),f._displayTrackProfile.call(f,e,t)};const e=f.getSelectedTrackItem();var L;e&&f.hasElevation&&f.displayTrackProfile.call(r,e,{resized:!0}),f._simulateTrack=f.simulateTrack,f.simulateTrack=function(e){var t=this.view3D.linked2DControls.geolocation;t.map.toast(t.getLocaleString("threed.interactionSimulation"),{type:i.A.msgType.INFO}),this.viewer.clock.shouldAnimate&&this.view3D.trackDataSource&&(L(),w.call(this,{target:{className:"stop"},custom:!0})),t.simulationSpeed=1,t.drawTrack(e,!1).then(function(){if(t.wrap.simulateTrack(),t.trackLayer&&t.trackLayer.features){var r=t.trackLayer.features.find((function(e){return e instanceof c.A}));r&&G.call(this,r.geometry,r.wrap.feature.getGeometry().layout,"track",t.markerStyle,t.lineStyle,t.walkingSpeed).then(function(t){var n=t.czml,i=t.totalDistance,a=t.coordinates2D;this.view3D.trackDataSource=new cesium.DataSourceCollection;var s=new cesium.DataSourceDisplay({scene:this.viewer.scene,dataSourceCollection:this.view3D.trackDataSource});this.viewer.scene.preRender.addEventListener((function(e,t){s.update(t)})),this.view3D.trackDataSource.add(cesium.CzmlDataSource.load(n)).then(function(t,r,n){var a,s;this.viewer.clock.shouldAnimate=!1,a=n.clock.startTime,s=n.clock.stopTime,this.viewer.clock.startTime=a.clone(),this.viewer.clock.stopTime=s.clone(),this.viewer.clock.currentTime=a.clone(),this.viewer.clock.clockStep=cesium.ClockStep.TICK_DEPENDENT,this.viewer.clock.clockRange=cesium.ClockRange.CLAMPED,this.viewer.clock.multiplier=1;var l=n.entities.values[0];l.layout=t,l.tagLI=e,l.availability=new cesium.TimeIntervalCollection([new cesium.TimeInterval({start:a,stop:s})]),this.viewer.trackedEntity&&(this.viewer.entities.removeById(this.viewer.trackedEntity.id),this.viewer.trackedEntity=null),this.viewer.entities.add(l),this.viewer.flyTo(l).then(function(){function e(e,t){for(var r,n=0,i=this.view3D.view2DCRS!==this.view3D.crs?o.A.reproject(e[0],this.view3D.view2DCRS,this.view3D.crs):e[0],a=new cesium.Cartographic.fromDegrees(i[0],i[1]),s=1;s<e.length;s++){i=this.view3D.view2DCRS!==this.view3D.crs?o.A.reproject(e[s],this.view3D.view2DCRS,this.view3D.crs):e[s];var c=new cesium.Cartographic.fromDegrees(i[0],i[1]);if(n+=new cesium.EllipsoidGeodesic(a,c).surfaceDistance,a=c,n>t){r=e[s-1];break}}if(r){var u="XYZM"===l.layout||"XYZ"===l.layout?2:-1;if(u>-1)return r[u]}return 0}this.viewer.trackedEntity=l;var t,n=0;L=this.viewer.scene.preUpdate.addEventListener(function(o,a){const s=this.view3D.linked2DControls.geolocation.getSelectedTrackItem();if(!s||s.getAttribute("data-id")!==l.tagLI.getAttribute("data-id")||cesium.JulianDate.greaterThanOrEquals(a,l.availability.stop))L(),w.call(this,{target:{className:"stop"},custom:!0});else if(this.viewer.clock.shouldAnimate&&l.isAvailable(a)){t||(t=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,l.availability.start)));const o=cesium.Cartographic.fromCartesian(cesium.Property.getValueOrUndefined(l.position,a));this.view3D.linked2DControls.geolocation.hasElevation&&this.view3D.linked2DControls.geolocation.setChartProgress({p:[t.longitude,t.latitude,t.height],d:n},[o.longitude,o.latitude,e.call(this,r,n)],i,("XYZM"===l.layout||"XYM"===l.layout)&&this.view3D.linked2DControls.geolocation.getTimeInterval(cesium.JulianDate.toDate(l.availability.start),cesium.JulianDate.toDate(a))),n+=new cesium.EllipsoidGeodesic(t,o).surfaceDistance,t=o,this.viewer.scene.requestRender()}}.bind(this)),this.viewer.clock.shouldAnimate=!0}.bind(this)),this.viewer.scene.requestRender()}.bind(this,r.wrap.feature.getGeometry().layout,a))}.bind(this))}}.bind(this))}.bind(r),f._wrap_simulateTrack=n.A.wrap.control.Geolocation.prototype.simulateTrack,n.A.wrap.control.Geolocation.prototype.simulateTrack=function(){}}else{const e=r.view3D.linked2DControls.geolocation.getSelectedTrackItem();e&&r.view3D.linked2DControls.geolocation.hasElevation&&f._displayTrackProfile.call(r.view3D.linked2DControls.geolocation,e,!0)}}},b=function(){var e=this;e.map.workLayers.filter((function(e){return e instanceof f.A&&e.features?.length})).forEach((function(t){t.owner&&(t.owner instanceof n.A.control.DrawMeasureModify||t.owner instanceof n.A.control.Draw)&&(t.owner.wrap.interation3D=new e.map.view3D.UI.DrawControl),t.features.forEach((function(r){if(t.owner instanceof n.A.control.DrawMeasureModify||t.owner instanceof n.A.control.Draw){const t=e.view3D.viewer.dataSources.getByName("drawn")[0];t&&(e.view3D.addFeature.call(e.view3D,r,t),e.view3D.view2DCRS!==e.view3D.crs&&r.setCoordinates(r.getCoordinates({geometryCrs:e.view3D.view2DCRS,crs:e.view3D.crs})))}else e.view3D.addFeature.call(e.view3D,r)}))}))};var T,O,N;const k=function(e){var t=this,r=function(e){var t=this,r=new cesium.Cartesian2(t.viewer.scene.canvas.clientWidth/2,t.viewer.scene.canvas.clientHeight/2);t.view3D.zoomToCartesian.call(t,{endPosition:r},e)};e?(T=function(e){var t=this;e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault();var r=t.view3D.view2DCRS;t.map.options.crs!==t.view3D.view2DCRS&&(r=t.map.options.crs);var n=o.A.reproject(t.map.options.initialExtent.slice(0,2),r,t.view3D.crs),i=o.A.reproject(t.map.options.initialExtent.slice(2),r,t.view3D.crs),a=cesium.Rectangle.fromDegrees(n[0],n[1],i[0],i[1]);return t.view3D.flyToRectangle.call(t,a,{duration:.1}),!1}.bind(t),O=function(e){r.call(t,200)}.bind(t),N=function(e){r.call(t,-200)}.bind(t),document.querySelectorAll("."+n.A.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(e){e.addEventListener("click",T)})),document.querySelectorAll("."+n.A.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(e){e.addEventListener("click",O)})),document.querySelectorAll("."+n.A.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(e){e.addEventListener("click",N)}))):(document.querySelectorAll("."+n.A.control.NavBarHome.prototype.CLASS+"-btn").forEach((function(e){e.removeEventListener("click",T)})),document.querySelectorAll("."+n.A.control.NavBar.prototype.CLASS+"-btn-zoomin").forEach((function(e){e.removeEventListener("click",O)})),document.querySelectorAll("."+n.A.control.NavBar.prototype.CLASS+"-btn-zoomout").forEach((function(e){e.removeEventListener("click",N)})))};return{container:null,crs:"EPSG:4326",crsPattern:/(EPSG\:?4326)/i,view2DCRS:null,customRender:null,baseLayer:null,workLayers:[],vector2DLayers:[],vector2DFeatures:{},linked2DControls:{},isLoadingTiles:function(){var e=this.viewer.scene.globe._surface;return!e._tileProvider.ready||e._tileLoadQueueHigh.length>0||e._tileLoadQueueMedium.length>0||e._tileLoadQueueLow.length>0||e._debug.tilesWaitingForChildren>0},loadViewer:function(){const e=this;return new Promise((function(t,o){e.viewer?t(e.viewer):r.e(2149).then(r.bind(r,2149)).then((async function(r){const o=r.default;var a=null,l=null;try{a=await o.Resource.fetchJson({url:n.A.apiLocation+"resources/data/contornoNavarra.json"}).then((function(e){return e&&e.features&&e.features.length>0?e.features[0].geometry.coordinates:[]}))}catch(e){console.warn("No se ha encontrado contorno de Navarra")}try{l=await o.Resource.fetchJson({url:n.A.apiLocation+"resources/data/contornoEspana.json"}).then((function(e){return e&&e.features&&e.features.length>0?e.features[0].geometry.coordinates:[]}))}catch(e){console.warn("No se ha encontrado contorno de España")}o.ApproximateTerrainHeights.initialize().then((function(){const r=[a,l].filter((e=>null!=e));var u;e.terrainFallback&&r.length?u=new o.MergeTerrainProvider(e.terrain,e,{boundaries:r,fallback:e.terrainFallback}):(e.terrainFallback&&!r.length&&console.warn("Se ha definido fallckback de terreno pero no se ha especificado contorno"),(u=new o.CesiumTerrainProvider({url:e.terrain.url.trim()})).sampleTerrainMostDetailed=function(e){return o.sampleTerrainMostDetailed(u,e)},u.attributions={},e.terrain.attributions&&(u.getAttribution=function(){return u.attributions},u.attributions=e.terrain.attributions,e.map.trigger(i.A.event.TERRAINPROVIDERADD,{terrainProvider:u})));var d=new o.Globe;d.baseColor=o.Color.WHITE,d.enableLighting=!1,d.tileCacheSize=1e3,d.maximumScreenSpaceError=5,e.viewer=e.view3D.viewer=new o.Viewer(e.selectors.divThreedMap,{terrainProvider:u,terrainExaggeration:1,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:d,requestRenderMode:!0,maximumRenderTimeChange:1/0}),e.viewer.scene.backgroundColor=o.Color.WHITE,e.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0,e.viewer.scene.screenSpaceCameraController.maximumZoomDistance=1e6,e.viewer.scene.imageryLayers.removeAll(),e.viewer.terrainProvider.errorEvent.addEventListener((function(e){if(e.error)switch(e.error.statusCode){case 403:case 404:console.log("es un 404 de terreno")}}),e),e.viewer.scene.renderError.addEventListener((function(e,t){var r=this;t&&18===t.code||(r.divThreedMap.classList.remove(r.classes.LOADING),r.map.toast(r.getLocaleString("fi.error"),{type:i.A.msgType.ERROR}),r.map.getControlsByClass("TC.control.ThreeD").forEach((e=>e.unset3D())))}),e),e.viewer.readyPromise=new Promise((function(t,r){e.view3D.tileLoadingHandler=new o.EventHelper,e.view3D.tileLoadingHandler.add(e.viewer.scene.globe.tileLoadProgressEvent,function(r){e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait()),(e.viewer.scene.terrainProvider.allReady||!e.viewer.scene.terrainProvider.allReady&&e.viewer.scene.terrainProvider.ready)&&0===r?(e.map.getLoadingIndicator().removeWait(e.waiting),delete e.waiting,t(),e.events.trigger(i.A.event.TERRAINLOADED,{})):e.events.trigger(i.A.event.TERRAINRECEIVING,{})}.bind(e))})),k.call(e,!0),document.querySelectorAll(".cesium-viewer-bottom").forEach((function(e){e.parentElement.removeChild(e)})),e.view3D._event2DHandler=S.bind(e),e.map.on(A.join(" "),e.view3D._event2DHandler),L.call(e,i.A.view.THREED),e.viewer.readyPromise.then((function(){b.call(e)})),e.view3D.getScene=function(){return e.viewer.scene},e.view3D.getFovCoords=function(t){var r=e.viewer.scene.canvas,n=new o.Cartesian2(0,r.clientHeight-1),i=new o.Cartesian2(r.clientWidth-1,r.clientHeight-1),a=[n,i,new o.Cartesian2(r.clientWidth-1,0),new o.Cartesian2(0,0)].map((function(r){return P.call(e,r,t)})).filter((function(e){return null!==e}));if(a.length&&a.length<4){var s=x.call(e,{nearMapCoords:a[0],bottomPixel:n,cameraPosition:e.view3D.cameraControls._coordsXY}),l=x.call(e,{nearMapCoords:a[1],bottomPixel:i,cameraPosition:e.view3D.cameraControls._coordsXY});s&&l&&(a[2]=l,a[3]=s)}return a},e.view3D.getExtent=function(){const e=this.getFovCoords(this.crs),t=o.Rectangle.fromCartographicArray(e.map((e=>new o.Cartographic(e[0],e[1]))));return[t.west,t.south,t.east,t.north]},e.view3D.getCameraData=function(){const t=e.viewer.scene.camera,r=t.position,n=o.Ellipsoid.WGS84.cartesianToCartographic(r);return{latitude:o.Math.toDegrees(n.latitude),longitude:o.Math.toDegrees(n.longitude),height:n.height,heading:t.heading*(180/Math.PI),pitch:t.pitch*(180/Math.PI)}},e.view3D.Coordinates2DTo3D=function(t){const r=t instanceof o.Cartesian2?t:new o.Cartesian2(t[0],t[1]);var n=e.viewer.camera.getPickRay(r),i=e.viewer.scene.globe.pick(n,e.viewer.scene);if(i){var a,s=o.Ellipsoid.WGS84.cartesianToCartographic(i);return a=o.Math.toDegrees(s.latitude),{lon:o.Math.toDegrees(s.longitude),lat:a,ele:Math.round(s.height)}}},e.view3D.setMarker=function(t,r,i=null,a){return t instanceof o.Cartesian3||t instanceof o.Cartesian2||(t=o.Cartesian3.fromDegrees(t[0],t[1])),i?(i.position=t,i.setImage(1e3*Math.random(),r),i.pixelOffset=new o.Cartesian2(0,20),i.show=!0):i=e.map.view3D.addNativeFeature.call(e.map,{position:t,billboard:{image:r,eyeOffset:new o.Cartesian3(0,0,-100),verticalOrigin:o.VerticalOrigin.BOTTOM,heightReference:o.HeightReference.CLAMP_TO_GROUND,pixelOffset:new o.Cartesian2(0,20),id:a||n.A.getUID()}}),e.viewer.scene.requestRender(),i},e.view3D.setCenter=function(t){const r=e.map.view3D.getScene();var n=o.Cartesian3.fromDegrees(t[0],t[1],e.view3D.getHeightFromMDT(t));const i=r.globe.pick(r.camera.getPickRay(new o.Cartesian2(e.view3D.container.clientWidth/2,e.view3D.container.clientHeight/2)),r),a=o.Cartesian3.distance(i,r.camera.positionWC);var s=new o.Matrix4;r.camera.transform.clone(s),r.camera.lookAt(n,new o.HeadingPitchRange(r.camera.heading,r.camera.pitch,a)),r.camera.lookAtTransform(s)},e.view3D.setLabel=function(t,r){e.view3D.threeDDraw.setLabel(t,r)},e.view3D.setStyle=function(t,r){e.view3D.threeDDraw.setStyle(r,t)},e.view3D.getLength=function(e){return e.polyline.positions.getValue().reduce((function(e,t,r,n){return 0===r?0:e+new o.EllipsoidGeodesic(o.Cartographic.fromCartesian(n[r-1]),o.Cartographic.fromCartesian(n[r]),o.Ellipsoid.WGS84).surfaceDistance}),0)},e.view3D.getArea=function(e){const t=e.polygon.hierarchy.getValue();return Math.sqrt(Math.pow(o.PolygonPipeline.computeArea2D(t.positions),2))};const p=function(e){const t=o.Cartographic.fromCartesian(e);return[o.Math.toDegrees(t.longitude),o.Math.toDegrees(t.latitude)]},f=function(e,t){let r;switch(t){case"polyline":r=new c.A(e.map((function(e){return p(e)})));break;case"polygon":r=new h.A(e.map((function(e){return p(e)})));break;case"point":r=new s.A(p(e instanceof Array?e[0]:e))}return r};e.view3D.UI={DrawControl:function(t,r){return e.view3D.threeDDraw=new v(e.viewer,t),e.view3D.threeDDraw.addEventListener("drawend",(t=>{e.map.activeControl.trigger(i.A.event.MEASURE,t.detail.measurements);const n=f(t.detail.positions,t.detail.type);e.map.activeControl.trigger(i.A.event.DRAWEND,{feature:n}),r(n).then((function(r){g(e.view3D,r,t.detail.entity),t.detail.entity.name=r.id,r.setStyle(t.detail.entity.getStyle())}))})),e.view3D.threeDDraw.addEventListener("drawstart",(t=>{e.map.activeControl.trigger(i.A.event.DRAWSTART,{})})),e.view3D.threeDDraw.addEventListener("drawupdate",(t=>{e.map.activeControl.trigger(i.A.event.MEASUREPARTIAL,t.detail.measurements)})),e.view3D.threeDDraw.addEventListener("point",(t=>{const r=o.Cartographic.fromCartesian(t.detail.position);e.map.activeControl.trigger(i.A.event.POINT,{point:[o.Math.toDegrees(r.longitude),o.Math.toDegrees(r.latitude)]})})),e.view3D.threeDDraw.addEventListener("drawmodify",(t=>{const r=f(t.detail.positions,t.detail.type),n=t.detail.entity._wrap.parent;n.setCoordinates(r.getCoordinates()),e.map.activeControl.trigger(i.A.event.FEATUREMODIFY,{feature:n,layer:n.layer,geometryChanged:!0})})),e.view3D.threeDDraw},SelectControl:function(){var t=null,r=null;const n=function(e){return e.polygon?new h.A(e.polygon.hierarchy.getValue().positions.map((function(e){return p(e)})),{id:e.id}):e.polyline?new c.A(e.polyline.positions.getValue().map((function(e){return p(e)})),{id:e.id}):new s.A(p(e.position.getValue(o.JulianDate.now)),{id:e.id})},a=function(e){e.control instanceof y.default&&(t=null)},l=function(s){e.map.on(i.A.event.FEATUREREMOVE,u),e.map.on(i.A.event.CONTROLDEACTIVATE,a),e.view3D.threeDDraw.vertexRemove(s),e.view3D.threeDDraw.entityForEdit&&!s&&e.view3D.threeDDraw.activate(),s?e.view3D.threeDDraw.deactivateSelectMode():e.view3D.threeDDraw.activeSelectMode((function(e){o.defined(e)&&(t=e,r({selected:[(e._wrap?.parent||n(e)).wrap.feature],deselected:[]}))}))},u=function(r){r.feature.wrap?.feature3D&&(e.view3D.threeDDraw.remove(r.feature.wrap.feature3D),t=null)},d=function(){e.view3D.threeDDraw.deactivateSelectMode(),e.view3D.threeDDraw.deactivateEditing(),e.map.off(i.A.event.FEATUREREMOVE,u),e.map.off(i.A.event.CONTROLDEACTIVATE,a),e.view3D.threeDDraw.editMode=!1};return{activate:l,setActive:function(e){e?l():d()},deactivate:d,on:function(e,t){r=t},getFeatures:function(){return o.defined(t)?new ol.Collection([(t._wrap?.parent||n(t)).wrap.feature]):new ol.Collection}}}},t(e.viewer)})),o.Entity.prototype.getStyle=function(){const e={};return this.polygon?Object.assign(e,{fillColor:this.polygon.material.getValue().color.toCssHexString().substring(0,7),fillOpacity:this.polygon.material.getValue().color.alpha,strokeColor:this.polyline.material.getValue().color.toCssHexString().substring(0,7),strokeWidth:this.polyline.width.getValue()}):this.polyline?Object.assign(e,{strokeColor:this.polyline.material.getValue().color.toCssHexString().substring(0,7),strokeWidth:this.polyline.width.getValue()}):this.point&&Object.assign(e,{fillColor:this.point.color.getValue().toCssHexString().substring(0,7),fillOpacity:this.point.color.getValue().alpha,strokeColor:this.point.outlineColor.getValue().toCssHexString().substring(0,7),strokeWidth:this.point.outlineWidth.getValue(),radius:(this.point.pixelSize.getValue()+2*this.point.outlineWidth.getValue())/2}),this.label&&(e.fontColor=this.label?.fillColor?.getValue().toCssHexString(),e.font=this.label?.font?.getValue()),e}}))}))},setBaseLayer:function(e){var t=this,r=function(e){return C(e,t.view3D.crs)||(null!==e.getFallbackLayer()&&C(e.getFallbackLayer(),t.view3D.crs)?e=e.getFallbackLayer():(t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.title})),e=null)),e};t.view3D.baseLayer?(t.viewer.scene.imageryLayers.contains(t.view3D.baseLayer)&&(t.viewer.scene.imageryLayers.raiseToTop(t.view3D.baseLayer),t.viewer.scene.imageryLayers.remove(t.view3D.baseLayer,!0)),e instanceof f.A?(t.view3D.baseLayer=t.Consts.BLANK_BASE,t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting):(e=r(e))&&(e.map=t.map,e.isBase=!0,t.view3D.addLayer.call(t,e))):e.type===i.A.layerType.WMTS||e.type===i.A.layerType.WMS?e.options.relatedWMTS?(t.map.baseLayer=e=t.map.getLayer(e.options.relatedWMTS),t.map.trigger(i.A.event.BASELAYERCHANGE,{layer:t.map.baseLayer})):(e=r(e))&&(e.isBase||(e.isBase=!0),t.view3D.addLayer.call(t,e)):t.view3D.baseLayer=t.Consts.BLANK_BASE,H.baseMap=t.map.baseLayer},addLayer:function(e){var t=this;switch(!0){case i.A.layerType.VECTOR==e.type:t.view3D.vector2DLayers.push(e);break;case i.A.layerType.WMTS==e.type:case i.A.layerType.WMS==e.type:e.isBase||e.isCompatible(t.view3D.crs)?u.convert(e,t.view3D.crs).then((function(r){if(r){void 0!==r.enablePickFeatures&&(r.enablePickFeatures=!1,r.tcLayer=e),e.isBase&&t.view3D.baseLayer&&t.viewer.scene.imageryLayers.contains(t.view3D.baseLayer)&&(t.viewer.scene.imageryLayers.raiseToTop(t.view3D.baseLayer),t.viewer.scene.imageryLayers.remove(t.view3D.baseLayer,!0)),cesium.TrustedServers.add(new URL("http://"+r.url).host,"80"),cesium.TrustedServers.add(new URL("https://"+r.url).host,"443"),cesium.TrustedServers.add("http://localhost","8080");var n=t.viewer.scene.imageryLayers.addImageryProvider(r);e.isBase?(t.view3D.baseLayer=n,t.viewer.scene.imageryLayers.lowerToBottom(n)):(n.show=e.getVisibility(),n.alpha=e.getOpacity(),t.view3D.workLayers.push(n))}})):t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}))}},removeLayer:function(t){var r=this;switch(!0){case i.A.layerType.VECTOR==t.type:if(r.view3D.vector2DFeatures&&e.call(r.view3D.vector2DFeatures,t.id)){for(var n in r.view3D.vector2DFeatures[t.id])r.view3D.vector2DFeatures[t.id][n].forEach((e=>r.view3D.removeFeature.call(r,e)));delete r.view3D.vector2DFeatures[t.id]}break;case i.A.layerType.WMTS==t.type:case i.A.layerType.WMS==t.type:for(var o=0;o<r.view3D.workLayers.length;o++)if(t.names&&r.view3D.workLayers[o].imageryProvider.layers.join(",")===t.names.join(",")||t.title&&r.view3D.workLayers[o].imageryProvider.layers.join(",")===t.title){r.viewer.scene.imageryLayers.raiseToTop(r.view3D.workLayers[o]),r.viewer.scene.imageryLayers.remove(r.view3D.workLayers[o],!0),r.view3D.workLayers.splice(o,1);break}}},setRenderOptionsLayer:function(t,r){var n=this;switch(!0){case i.A.layerType.VECTOR==t.type:if(t?.owner?.wrap?.interation3D)t.owner.wrap.interation3D.visibility(t.getVisibility());else if(n.view3D.vector2DFeatures[t.id]){for(var o in n.view3D.vector2DFeatures[t.id])n.view3D.vector2DFeatures[t.id][o].forEach((e=>n.view3D.setRenderOptionsFeature(e,{show:t.getVisibility()})));n.viewer.scene.requestRender()}break;case i.A.layerType.WMTS==t.type:case i.A.layerType.WMS==t.type:for(var a=0;a<n.view3D.workLayers.length;a++){const i=Array.isArray(n.view3D.workLayers[a].imageryProvider.layers)?n.view3D.workLayers[a].imageryProvider.layers.join(","):n.view3D.workLayers[a].imageryProvider.layers;if(t.names&&i===t.names.join(",")||t.title&&i===t.title){e.call(r,"visibility")&&(n.view3D.workLayers[a].show=r.visibility),e.call(r,"opacity")&&(n.view3D.workLayers[a].alpha=r.opacity);break}}n.viewer.scene.requestRender()}},flyToMapCoordinates:function(e){var t=this,r=t.view3D.view2DCRS!==t.view3D.crs?o.A.reproject(e,t.view3D.view2DCRS,t.view3D.crs):e,n=cesium.Cartesian3.fromDegrees(r[0],r[1],t.viewer.camera.positionCartographic.height),i=t.viewer.camera;i.flyTo({destination:n,orientation:{heading:i.heading,pitch:i.pitch}})}.bind(t),flyToRectangle:function(e,t){const r=this;return r.viewer.scene.camera.cancelFlight(),new Promise((function(n,i){t=t||{};var o=cesium.Math.EPSILON3;e.east===e.west&&(e.east+=o,e.west-=o),e.north===e.south&&(e.north+=o,e.south-=o);var a=.2*e.width/2,s=.2*e.height/2;e.east-=a,e.west+=a,e.north+=s,e.south-=s;var l=r.viewer.scene,c=l.camera,u=c.getRectangleCameraCoordinates(e),h=cesium.Ellipsoid.WGS84.cartesianToCartographic(u);cesium.sampleTerrainMostDetailed(l.terrainProvider,[cesium.Rectangle.center(e)]).then((function(e){var i={longitude:h.longitude,latitude:h.latitude,height:Math.max(h.height,200)+e[0].height||0};const o=new cesium.EllipsoidGeodesic(h,new cesium.Cartographic(h.longitude,0,h.height)).interpolateUsingSurfaceDistance(Math.max(h.height,200));o.height=i.height,c.flyTo({duration:t.duration||1,destination:cesium.Ellipsoid.WGS84.cartographicToCartesian(o),orientation:{heading:0,pitch:Math.PI/4*-1},complete:function(){n()}.bind(r)})}))}))}.bind(t),zoomToCartesian:function(e,t){var r=this,n=r.viewer.scene;if(!e||!e.endPosition){var i=n.canvas,o=new cesium.Cartesian2(i.clientWidth/2,i.clientHeight/2);e={endPosition:o}}var a=n.camera.getPickRay(e.endPosition),s=n.globe.pick(a,n);if(s){var l=cesium.Cartesian3.distance(a.origin,s);if(l<1)return;r.view3D._zoomTo||(r.view3D._zoomTo={amount:0}),r.view3D._zoomTo.direction=t>0?1:0,r.view3D._zoomTo.amount+=5*l/100,r.view3D._zoomTo.endPosition=e.endPosition}var c=function(t){var r=this,n=r.viewer.scene,i=n.camera.getPickRay(e.endPosition||t.endPosition),o=n.globe.pick(i,n);if(o){if(cesium.Cartesian3.distance(i.origin,o)<1)return;var a=n.camera.position,s=new cesium.Cartesian3,l=s;cesium.Cartesian3.multiplyByScalar(i.direction,1==t.direction?t.amount:-t.amount,l),cesium.Cartesian3.add(a,l,s);var c=new cesium.Ray(s,i.direction),u=n.globe.pick(c,n);if(u){cesium.Cartesian3.distance(s,u)<1||Math.abs(cesium.Ellipsoid.WGS84.cartesianToCartographic(s).height)<n.screenSpaceCameraController.minimumZoomDistance?function(){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}}.call(r):r.viewer.camera.flyTo({destination:s,orientation:{heading:n.camera.heading,pitch:n.camera.pitch,roll:n.camera.roll},duration:1,easingFunction:cesium.EasingFunction.LINEAR_NONE,complete:function(e){this.view3D._zoomTo={direction:1,amount:0,endPosition:{}}}.bind(r,cesium.Cartesian3.distance(s,u))})}}};setTimeout(function(){c.call(r,r.view3D._zoomTo)}.bind(r),50)},rotateAroundAxis:function(e,t,r,n,i){return R(e,t,r,n,i)},addFeature:function(e,t){var r=this,n=function(){var n=d.convert(r.viewer.scene,e,r.view2DCRS,r.crs);if(n)if("function"==typeof n.geometry)n.geometry(r.viewer.terrainProvider).then((function(n){if(n instanceof Array)n.forEach((function(n){n instanceof Array?n.forEach((function(n){n=p.call(r,n,t),g(r,e,n)})):(n=p.call(r,n,t),g(r,e,n))}));else{var i=p.call(r,n,t);g(r,e,i)}}));else if(n.geometry instanceof Array)n.geometry.forEach((function(n){n=p.call(r,n,t),g(r,e,n)}));else{var i=p.call(r,n.geometry,t);g(r,e,i)}};if(r.linked2DControls.featureInfo&&r.linked2DControls.featureInfo.get2DMarker()===e||r.linked2DControls.featureInfo&&r.linked2DControls.featureInfo.isPending())setTimeout((function(){r.linked2DControls.featureInfo.get2DMarker()!==e&&n()}),5);else{if(r.linked2DControls.geolocation&&r.linked2DControls.geolocation.geotrackingLayer===e.layer&&e instanceof c.A)return;n()}},removeFeature:function(e){var t=this;if(t.viewer&&e){switch(!0){case e instanceof cesium.GroundPrimitive:t.viewer.scene.groundPrimitives.remove(e);break;case e instanceof cesium.Billboard:t.viewer.billboardCollection.remove(e);break;case e instanceof cesium.Entity:case e instanceof Object:t.viewer.entities.removeById(e.id)}t.viewer.scene.requestRender()}},setRenderOptionsFeature:function(e,t){e&&(e.show=t.show)},addNativeFeature:function(e){return p.call(this.view3D,e)},setCameraFromMapView:function(){var e=this;e.viewer.scene.globe.terrainProvider.readyPromise.then((function(){var t=e.mapView.getCenter();if(t){var i=e.view3D.view2DCRS!==e.view3D.crs?o.A.reproject(t,e.view3D.view2DCRS,e.view3D.crs):t,a=M.call(e,e.mapView.getResolution()||0,cesium.Math.toRadians(i[0])),s=new cesium.Cartographic(cesium.Math.toRadians(i[0]),cesium.Math.toRadians(i[1]));e.viewer.scene.globe&&(s.height=e.viewer.scene.globe.getHeight(s)||0);var l=function(){if(e.map.on3DView){var t=cesium.Ellipsoid.WGS84.cartographicToCartesian(s),r={pitch:cesium.Math.toRadians(-90),heading:-e.mapView.getRotation(),roll:0};e.viewer.camera.setView({destination:t,orientation:r}),e.viewer.camera.moveBackward(a)}};0===s.height?new Promise((function(t){n.A.tool&&n.A.tool.Elevation?t(new n.A.tool.Elevation):Promise.resolve().then(r.bind(r,4363)).then((()=>{e.view3D.elevationTool=new n.A.tool.Elevation,t(e.view3D.elevationTool)}))})).then((function(t){t.getElevation({crs:e.view3D.crs,coordinates:[i]}).then((function(e){e&&e.length>0&&(s.height=e[0][2]?e[0][2]:0),l()})).catch((e=>console.log(e)))})):l()}}))},setViewFromCameraView:function(){const e=this;var t=cesium.Ellipsoid.WGS84,r=e.viewer.scene,n=D(r);if(!n){var i=e.viewer.scene.globe,a=e.viewer.camera.positionCartographic.clone(),s=i.getHeight(a);a.height=s||0,n=cesium.Ellipsoid.WGS84.cartographicToCartesian(a)}var l=cesium.Cartesian3.distance(n,e.viewer.camera.position),c=t.cartesianToCartographic(n),u=e.view3D.crs!==e.view3D.view2DCRS?o.A.reproject([cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)],e.view3D.crs,e.view3D.view2DCRS):[cesium.Math.toDegrees(c.longitude),cesium.Math.toDegrees(c.latitude)];return e.mapView.setCenter(u),e.mapView.setResolution(I.call(e,l,c?c.latitude:0)),Promise.resolve()},lookAt:function(e){const t=this;t.crs!==t.view2DCRS&&(e=o.A.reproject(e,t.view2DCRS,t.crs));var r=t.viewer.camera,n=r.positionCartographic.height,i=new cesium.Cartographic(cesium.Math.toRadians(e[0]),cesium.Math.toRadians(e[1]),n);r.flyTo({destination:cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height),duration:1})},getInfoOnPickedPosition:function(e){var t=this;e&&(t.map.one(i.A.event.DRAWTABLE,(function(e){t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting})),t.view3D.linked2DControls.featureInfo.send.call(t,e).then((function(e){t.map.getLoadingIndicator().removeWait(t.waiting),delete t.waiting})))},on:function(e,t){const r=this;var n;r.eventHandlers||(r.eventHandlers={}),r.eventHandlers.handlerOfMovementConversion=new cesium.ScreenSpaceEventHandler(r.viewer.scene.canvas),r.eventHandlers.handlerOfMovementConversion.setInputAction((function(e){if(e.endPosition||e.position){if(r.viewer.trackedEntity)return;t((n=e,r.viewer&&r.viewer.cesiumWidget?r.Coordinates2DTo3D(n.endPosition||n.position):null))}else t(e);var n}),(n=e,i.A.event.MOUSEMOVE===n?o.A.detectMobile()?cesium.ScreenSpaceEventType.LEFT_CLICK:cesium.ScreenSpaceEventType.MOUSE_MOVE:i.A.event.CLICK===n?cesium.ScreenSpaceEventType.LEFT_CLICK:n))},getHeightFromMDT:function(e){var t=new cesium.Cartographic(cesium.Math.toRadians(e[0]),cesium.Math.toRadians(e[1]));return this.viewer.scene.globe.getHeight(t)||0},addElevationMarker:function(e,t){const r=this;r.viewer&&!r.viewer.view3DElevationMarkerPromise&&(r.viewer.view3DElevationMarkerPromise=!0,r.viewer.readyPromise.then((function(){delete r.viewer.view3DElevationMarkerPromise;let n=new cesium.Entity({position:cesium.Cartesian3.fromDegrees(e[0],e[1],r.getHeightFromMDT(e)),name:"elevationMarker",point:{show:!0,color:cesium.Color.RED.withAlpha(.5),pixelSize:10,outlineColor:cesium.Color.WHITE,outlineWidth:2,heightReference:cesium.HeightReference.CLAMP_TO_GROUND}});t.view3DElevationMarker=p.call(r,n)})))},setElevationMarker:function(e,t){const r=this;r.viewer&&r.viewer.readyPromise.then((function(){if(t.view3DElevationMarker){const n=e;t.view3DElevationMarker.position=cesium.Cartesian3.fromDegrees(n[0],n[1],r.viewer.camera.positionCartographic.height),t.view3DElevationMarker.show||(t.view3DElevationMarker.show=!0),r.viewer.scene.requestRender()}else r.addElevationMarker(e,t)}))},hideElevationMarker:function(e){const t=this;t.viewer&&e.view3DElevationMarker&&t.viewer.readyPromise.then((function(){t.removeFeature.call(t,e.view3DElevationMarker),delete e.view3DElevationMarker}))},destroy:function(){var e=this;e.map.on3DView=!1,e.view3D.vector2DLayers=[],e.view3D.vector2DFeatures={},e.map.off(A.join(" "),e.view3D._event2DHandler),L.call(e,i.A.view.DEFAULT),k.call(e,!1),Promise.all(e.map.baseLayers.map((function(t){return Promise.resolve(!C(t,e.view3D.view2DCRS))}))).then((function(t){let r;if(t.length>0){for(var o,a=0;a<e.map.baseLayers.length;a++)o||t[a]||(o=e.map.baseLayers[a]),e.map.baseLayers[a]&&(e.map.baseLayers[a].mustReproject=t[a]);r=!0;const l=function(t,o,a){const s={layer:o};a&&(s.fallbackLayer=a);var l=e.map.getControlsByClass(t?n.A.control.BasemapSelector:n.A.control.Coordinates);l.length>0&&(l[0]instanceof n.A.control.Coordinates&&(r=!1),s.closeCallback=function(){e.map.trigger(i.A.event.VIEWCHANGE,{view:i.A.view.DEFAULT})},l[0].showProjectionChangeDialog(s))};var s=H.baseMap==e.Consts.BLANK_BASE?H.baseVector:H.baseMap;s.isCompatible(e.map.getCRS())?e.map.setBaseLayer(s):s.fallbackLayer?(s.getFallbackLayer(),s.getFallbackLayer().isCompatible(e.map.getCRS())?n.A.confirm(e.getLocaleString("threed.changeBaselayer"),(function(){l(!1,s,s.fallbackLayer)}),(function(){e.map.setBaseLayer(s.fallbackLayer)})):l(!0,s)):l(!0,s)}H.baseMap="",e.view3D.baseLayer=null,e.view3D.workLayers=[],e.view3D.cameraControls.unbind(),e.view3D.linked2DControls.featureInfo&&e.view3D.linked2DControls.featureInfo.reset(),e.view3D.linked2DControls.geolocation&&(e.view3D.linked2DControls.geolocation.isGeo=!1,e.view3D.linked2DControls.geolocation.reset()),e.view3D.tileLoadingHandler.removeAll(),delete e.view3D.tileLoadingHandler,e.viewer.destroy(),e.viewer=null,r&&e.map.trigger(i.A.event.VIEWCHANGE,{view:i.A.view.DEFAULT})}))}}}(),{init:t.init.bind(t),apply:t.apply.bind(t),unapply:t.unapply.bind(t),VIEWNAME:t.VIEWNAME}}()},7622:(e,t,r)=>{"use strict";function n(e,t,r,n,i,o,a){o=o||[],a=a||2;let s=0;for(let l=t;l<r;l+=n){const t=e[l],r=e[l+1];o[s++]=i[0]*t+i[2]*r+i[4],o[s++]=i[1]*t+i[3]*r+i[5];for(let t=2;t<a;t++)o[s++]=e[l+t]}return o&&o.length!=s&&(o.length=s),o}function i(e,t,r,n,i,o,a){a=a||[];const s=Math.cos(i),l=Math.sin(i),c=o[0],u=o[1];let h=0;for(let i=t;i<r;i+=n){const t=e[i]-c,r=e[i+1]-u;a[h++]=c+t*s-r*l,a[h++]=u+t*l+r*s;for(let t=i+2;t<i+n;++t)a[h++]=e[t]}return a&&a.length!=h&&(a.length=h),a}function o(e,t,r,n,i,o,a,s){s=s||[];const l=a[0],c=a[1];let u=0;for(let a=t;a<r;a+=n){const t=e[a]-l,r=e[a+1]-c;s[u++]=l+i*t,s[u++]=c+o*r;for(let t=a+2;t<a+n;++t)s[u++]=e[t]}return s&&s.length!=u&&(s.length=u),s}function a(e,t,r,n,i,o,a){a=a||[];let s=0;for(let l=t;l<r;l+=n){a[s++]=e[l]+i,a[s++]=e[l+1]+o;for(let t=l+2;t<l+n;++t)a[s++]=e[t]}return a&&a.length!=s&&(a.length=s),a}r.d(t,{Rc:()=>n,Tl:()=>a,e$:()=>i,hs:()=>o})},7633:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>I});var n=r(3790),i=r.n(n),o=r(8038),a=r(797),s=r(3301),l=r(4128),c=r(3607),u=r(8325),h=r(3365),d=r(6792),p=r(6631),g=r(2902),f=r(7018),m=r(1651),y=r(8606),v=r(6257),A=r(6546),S=r(1667),E=r(2978),w=r(3791),_=r(5777);o.A.control=o.A.control||{},o.A.Geometry=u.A,o.A.filter=p.A;let L=0;const C=async function(e,t){var r,n;switch(!0){case t instanceof A.A:n=a.A.geom.POLYGON;break;case t instanceof y.A:n=a.A.geom.POLYLINE;break;case t instanceof f.A:n=a.A.geom.POINT;break;case t instanceof S.A:n=a.A.geom.MULTIPOLYGON;break;case t instanceof v.A:n=a.A.geom.MULTIPOLYLINE;break;case t instanceof m.A:n=a.A.geom.MULTIPOINT}r={id:t.id||t.provId,attributes:t.data,type:n,geometry:t.geometry};try{return await i().setItem(e,r),{feature:t}}catch(e){throw{feature:t,error:e}}},b=async function(e){return await i().removeItem(e),e},T=function(e){return e.getPath?e.getPath().join(" • "):e.title||e.id},x=function(e,t){switch(t){case a.A.geom.POINT:case a.A.geom.MULTIPOINT:return s.A.getLegendImageFromStyle(e.styles.point,{geometryType:a.A.geom.POINT});case a.A.geom.POLYLINE:case a.A.geom.MULTIPOLYLINE:return s.A.getLegendImageFromStyle(e.styles.line,{geometryType:a.A.geom.POLYLINE});default:return s.A.getLegendImageFromStyle(e.styles.polygon,{geometryType:a.A.geom.POLYGON})}};class P{constructor(){this.featureEditing="",this.selectLayerToEdit="",this.featuresInEditedLayer="",this.featuresAsBeforeEditing="",this.unsyncedAdded="",this.unsyncedModified="",this.unsyncedRemoved="",this.refreshLayerToCurrentExtent="",this.syncChanges="",this.discardChanges="",this.clickToChangeColor=""}}class M extends l.default{LOCAL_STORAGE_KEY_PREFIX="SITNA.offline.edit.";LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";#Lo;#Co;#bo;#To;#xo;#Po;#Mo;#Io;#Ro;#Oo;#Do;constructor(){super(...arguments);const e=this;e.serviceWorkerIsRequired=e.options.serviceWorkerIsRequired||!1,e.layer=null,e.callback=s.A.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null,e.layersEditData={},e.showsOriginalFeatures="boolean"==typeof e.options.showOriginalFeatures&&e.options.showOriginalFeatures,e.highlightsAdded=e.highlightsModified=e.highlightsRemoved="boolean"!=typeof e.options.highlightChanges||e.options.highlightChanges,s.A.isFunction(e.options.getBeforeEditLayerStyleFunction)||(e.getBeforeEditLayerStyleFunction=e.getBeforeEditLayerStyle),e.styles=e.options.styles||{point:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1,radius:6},line:{strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1},polygon:{fillColor:"#0000aa",fillOpacity:.1,strokeColor:"#0000aa",strokeWidth:2,strokeOpacity:1}},e.model=new P}async register(e){const t=this;return await super.register.call(t,e),window.addEventListener("online",(function(){t.#No()})),window.addEventListener("offline",(function(){t.#No()})),e.loaded((function(){if(t.#Lo.disabled=!1,t.options.layer)t.setLayer(t.options.layer);else{const r=e.workLayers.filter((function(e){return e.type===a.A.layerType.WFS&&!e.options.stealth}));1===r.length?t.setLayer(r[0].id):t.setLayer(null)}t.showOriginalFeatures(t.showsOriginalFeatures)})),e.ready((function(){e.getControlsByClass("TC.control.WorkLayerManager").forEach((function(r){const n=s.A.getTextFromCssVar("--icon-edit",r.div);r.addItemTool({renderFn:function(r,i){const o=t.CLASS+"-btn-edit";let s=r.querySelector("sitna-toggle."+o);if(!s){const r=t.getLocaleString("featureEditing");s=new g.A,s.text=r,s.classList.add(o),s.checkedIconText=n,s.uncheckedIconText=n,s.dataset.layerId=i;const l=e.getLayer(i);l.type===a.A.layerType.WMS&&(s.classList.add(a.A.classes.LOADING),l.getWFSCapabilities().then((e=>{if(!e.Operations.Transaction)throw"Transaction no disponible"})).catch((()=>s.classList.add(a.A.classes.HIDDEN))).finally((()=>s.classList.remove(a.A.classes.LOADING))))}return s},updateEvents:[a.A.event.BEFORELAYERUPDATE,a.A.event.LAYERUPDATE,a.A.event.LAYERERROR,a.A.event.CONTROLACTIVATE,a.A.event.CONTROLDEACTIVATE],updateFn:function(r){const n=this,i=e.getLayer(n.dataset.layerId);setTimeout((()=>{n.checked=t.layer===i}),500),n.disabled=!i||i.isRaster()&&1!==i.names.length},actionFn:function(){const r=e.getLayer(this.dataset.layerId),n=t.layer;(r.names&&1===r.names.length||!r.isRaster())&&(r&&n!==r?t.setLayer(r).then((()=>{t.openEditSession()})):t.setLayer(null))}})}))})),t.#Co=e.addControl("edit",{id:t.getUID(),div:t.div.querySelector(`.${t.CLASS}-edit`),styles:t.styles,downloadElevation:t.options.downloadElevation,snapping:t.options.snapping}),t.editControl=await t.#Co,t.editControl.getAvailableFeaturesToImport=function(){const r=Object.getPrototypeOf(t.editControl).getAvailableFeaturesToImport.call(t.editControl),n=t.getLayerEditData();return r.filter((t=>{const r=e.getLayer(t.id);return r!==n.addedFeaturesLayer&&r!==n.modifiedFeaturesLayer&&r!==n.removedFeaturesLayer&&r!==n.beforeEditLayer}))},t.editControl.importFeatures=function(e){const r=e||this.featuresToImport||[],n=t.getLayerEditData(),i=n.attributes?r.map((function(e){const t={};for(let r in n.attributes)t[r]=e.data[r];return new e.constructor(e.geometry,{geometryName:n.geometryName,data:t})})):e;Object.getPrototypeOf(t.editControl).importFeatures.call(t.editControl,i)},t.editControl.on(a.A.event.DRAWEND,(function(e){t.getLayerEditData().serializable&&t.#ko(e.feature)})).on(a.A.event.FEATUREMODIFY,(function(e){const r=e.feature,n=r.provId||r.id,i=function(){t.#Fo(!0)},a=function(){o.A.error(t.getLocaleString("failedWhenSavingModifyOperationInSession"))},s=t.getLayerEditData();if(s.serializable){let e=s.addedFeaturesLayer.getFeatureById(n);e?(e.setCoords(r.geometry),e.setData(r.getData()),C(t.#Go()+n,r).then(i,a)):(e=s.modifiedFeaturesLayer.getFeatureById(n),e?(e.setCoords(r.geometry),e.setData(r.getData())):s.modifiedFeaturesLayer.addFeature(t.#Bo(r)),C(t.#Uo()+n,r).then(i,a))}})).on(a.A.event.FEATUREADD,(function(e){t.getLayerEditData().serializable&&t.#ko(e.feature)})).on(a.A.event.FEATUREREMOVE,(function(e){t.getLayerEditData().serializable&&t.#qo(e.feature)})),e.workLayers.forEach((e=>t.addLayer(e))),e.on(a.A.event.LAYERUPDATE,(function(e){const r=e.layer;r.type!==a.A.layerType.WFS||r.options.readOnly||t.getEditableLayer(r).then((e=>t.cacheLayer(e))).catch((e=>console.log("Layer not editable: "+r.id)))})).on(a.A.event.ZOOM,(function(r){e.workLayers.filter((e=>e.wfsLayer)).filter((e=>t.layer!==e)).forEach((function(e){e.wfsLayer=null,t.getEditableLayer(e)}))})).on(a.A.event.LAYERADD,(function(e){t.addLayer(e.layer)})).on(a.A.event.LAYERREMOVE,(function(e){const r=e.layer;if(t.#bo===r)return;(t.layer===r||r.wmsLayer&&t.layer===r.wmsLayer)&&t.setLayer(null);const n=t.#Lo.querySelector(`option[value="${r.id}"]`);n&&n.parentElement.removeChild(n)})).on(a.A.event.LAYERERROR,(function(r){const n=r.layer;n.type!==a.A.layerType.WFS||n.options.readOnly||(r.reason===a.A.WFSErrors.MAX_NUM_FEATURES&&e.toast(t.getLocaleString("query.msgTooManyResults",{limit:r.data.limit}),{type:a.A.msgType.WARNING}),(t.layer===n||t.layer&&t.layer.wfsLayer===n)&&(delete t.layersEditData[t.layer.id],t.setLayer(null)),n.wmsLayer&&(e.removeLayer(n),n.wmsLayer.wfsLayer=null))})),t}async loadTemplates(){const e=await r.e(503).then(r.bind(r,2884));this.template=e.default}async render(e){const t=this;var r=[];if(t.map)for(var n=0,i=t.map.workLayers.length;n<i;n++){var o=t.map.workLayers[n];o.type!==a.A.layerType.WFS||o.options.stealth||r.push({id:o.id,title:o.title||o.id})}await super.renderData.call(t,{layers:r,showOriginalFeatures:t.showsOriginalFeatures,highlightChanges:t.highlightsAdded||t.highlightsModified||t.highlightsRemoved,controlId:t.id}),t.#Lo=t.div.querySelector(`.${t.CLASS}-layer .${t.CLASS}-layer-sel`);const l=t.div.querySelector(`.${t.CLASS}-view`);t.#To=l.querySelector(`.${t.CLASS}-view-watch`),t.#xo=l.querySelector(`.${t.CLASS}-view-original-watch`),t.#Po=l.querySelector(`.${t.CLASS}-view-added-watch`),t.#Mo=l.querySelector(`.${t.CLASS}-view-modified-watch`),t.#Io=l.querySelector(`.${t.CLASS}-view-removed-watch`),t.#Ro=t.div.querySelector(`.${t.CLASS}-btn-save`),t.#Oo=t.div.querySelector(`.${t.CLASS}-btn-discard`),t.#Do=t.div.querySelector(`.${t.CLASS}-view sitna-button.${t.CLASS}-btn-crop`),t.addUIEventListeners(),s.A.isFunction(e)&&e(),t.controller=new _.A(t.model,new w.A(t.div)),t.updateModel()}addUIEventListeners(){const e=this;e.#Lo.addEventListener("change",(function(t){e.#dr(!1),e.getEditableLayer(this.value).then((function(t){e.setLayer(t.wmsLayer||t).then((function(){e.layer&&e.openEditSession()}))})).catch((t=>{console.error(t),e.setLayer(null)}))}));const t=e.div.querySelector(`.${e.CLASS}-view`);t.querySelector(`.${e.CLASS}-view-original-cb`).addEventListener("change",(function(t){e.showOriginalFeatures(t.target.checked)})),t.querySelector(`.${e.CLASS}-view-added-cb`).addEventListener("change",(function(t){e.highlightAdded(t.target.checked)})),t.querySelector(`.${e.CLASS}-view-modified-cb`).addEventListener("change",(function(t){e.highlightModified(t.target.checked)})),t.querySelector(`.${e.CLASS}-view-removed-cb`).addEventListener("change",(function(t){e.highlightRemoved(t.target.checked)}));const r=new RegExp(`${e.CLASS}-view-clr-(.+)-${e.id}`),n=function(t){const n=this.parentElement.querySelector("input[type=color]"),i=e.getLayerEditData(),o=i[n.id.match(r)[1]+"FeaturesLayer"];switch(i.geometryType){case a.A.geom.POINT:n.value=o.styles.point.strokeColor;break;case a.A.geom.POLYLINE:case a.A.geom.MULTIPOLYLINE:n.value=o.styles.line.strokeColor;break;default:n.value=o.styles.polygon.strokeColor}n.click()},i=function(t){const n=t.target,i=e.getLayerEditData(),o=n.id.match(r)[1],s=i[o+"FeaturesLayer"],l=i[o+"CustomColor"]=n.value;switch(i.geometryType){case a.A.geom.POINT:s.styles.point.strokeColor=l;break;case a.A.geom.POLYLINE:case a.A.geom.MULTIPOLYLINE:s.styles.line.strokeColor=l;break;default:s.styles.polygon.strokeColor=l,s.styles.polygon.fillColor=l}s.setStyles(s.styles),e[`_${o}Watch`].src=x(s,i.geometryType)},s=`${e.CLASS}-view-clr-added-${e.id}`;t.querySelector(`label[for="${s}"]`).addEventListener(a.A.event.CLICK,n,{passive:!0}),document.getElementById(s).addEventListener("change",i);const l=`${e.CLASS}-view-clr-modified-${e.id}`;t.querySelector(`label[for="${l}"]`).addEventListener(a.A.event.CLICK,n,{passive:!0}),document.getElementById(l).addEventListener("change",i);const c=`${e.CLASS}-view-clr-removed-${e.id}`;t.querySelector(`label[for="${c}"]`).addEventListener(a.A.event.CLICK,n,{passive:!0}),document.getElementById(c).addEventListener("change",i),e.#Ro.addEventListener(a.A.event.CLICK,(function(){o.A.confirm(e.getLocaleString("edit.applyEdits.confirm",{layerTitle:T(e.layer)}),(function(){e.applyEdits()}))}),{passive:!0}),e.#Oo.addEventListener(a.A.event.CLICK,(function(){o.A.confirm(e.getLocaleString("edit.discardEdits.confirm",{layerTitle:T(e.layer)}),(function(){e.discardEdits()}))}),{passive:!0}),e.#Do.addEventListener(a.A.event.CLICK,(function(){if(e.layer){const n=()=>{if(e.layer&&e.layer.wfsLayer&&o.A.filter&&o.A.filter.Bbox&&e.layer.wfsLayer.filter instanceof o.A.filter.Bbox){const t=e.getLayerEditData();e.layer.wfsLayer.filter=new o.A.filter.Bbox(null,e.map.getExtent(),e.map.getCRS()),e.layer.wfsLayer.refresh(),t.beforeEditLayer&&(t.beforeEditLayer.filter=e.layer.wfsLayer.filter,t.beforeEditLayer.refresh())}},i=e.getLayerEditData(),a=i.addedFeaturesLayer.features.concat(i.modifiedFeaturesLayer.features,i.removedFeaturesLayer.features);if(a.length){let i=!1;const s=e.map.getExtent(),l=[[s[0],s[1]],[s[0],s[3]],[s[2],s[3]],[s[2],s[1]]];for(var t=0,r=a.length;t<r;t++)if(!o.A.Geometry.intersects(a[t].geometry,l)){i=!0;break}i?o.A.confirm(e.getLocaleString("refreshLayerToCurrentExtent.confirm"),(function(){n()})):n()}else n()}}),{passive:!0})}#No(){const e=this,t=e.getLayerEditData();e.#Ro.disabled=!(navigator.onLine&&t&&t.checkedOut)||e.isSyncing}#dr(e){const t=this;if(t.div.querySelector(`.${t.CLASS}-view`).classList.toggle(a.A.classes.HIDDEN,!e||!t.layer||!(t.layer.type===a.A.layerType.WFS||t.layer.type===a.A.layerType.WMS)),t.layer&&t.layer.wfsLayer){const e=o.A.filter&&o.A.filter.Bbox&&t.layer.wfsLayer.filter instanceof o.A.filter.Bbox;t.#Do.classList.toggle(a.A.classes.HIDDEN,!e)}t.div.querySelector(`.${t.CLASS}-edit`).classList.toggle(a.A.classes.HIDDEN,!e)}#Wo(){const e=this;e.#No();const t=e.getLayerEditData();e.#Oo.disabled=!t||!t.checkedOut}#Fo=function(e){const t=this;if(t.layer){const n=t.getLayerEditData();if(void 0!==e)n.checkedOut=e,t.#Wo();else{var r=t.#Ho();i().keys().then((function(e){if(e){for(var i=!0,o=0,a=e.length;o<a;o++)if(0===e[o].indexOf(r)){i=!1;break}n.checkedOut=!i,t.#Wo()}}),(e=>console.warn(e)))}}else t.#Wo()};#Ho(e){const t=this;return t.LOCAL_STORAGE_KEY_PREFIX+function(e){let t=e.options.featureType[0];return t.indexOf(":")<0&&(t=e.options.featureNS+":"+t),t+"@"+e.options.url}(e||t.layer.wfsLayer||t.layer)}#Go(e){return this.#Ho(e)+this.LOCAL_STORAGE_ADDED_KEY_PREFIX}#Uo(e){return this.#Ho(e)+this.LOCAL_STORAGE_MODIFIED_KEY_PREFIX}#jo(e){return this.#Ho(e)+this.LOCAL_STORAGE_REMOVED_KEY_PREFIX}addLayer(e){const t=this;e.isBase||e.options.readOnly||e.options.stealth||t.getEditableLayer(e).then((function(r){!e.isRaster()&&r.wmsLayer||function(e){const r=document.createElement("option");r.setAttribute("value",e.id),r.innerHTML=T(e),t.renderPromise().then((function(){t.#Lo.appendChild(r)}))}(e)})).catch((t=>console.log(`Layer ${e.id} not editable. Reason: ${t.message}`)))}setLayer(e){const t=this;return new Promise((function(r,n){const i=t.map,o=t.div.querySelector(`.${t.CLASS}-layer-sel`);e=i.getLayer(e);const a=i.workLayers.find((t=>t===e)),s=function(){a?t.getEditableLayer(a).then((function(e){const s=function(){t.layer=a,t.#Vo(a).then((function(){t.getEditControl().then((n=>{o.value=t.layer.id,n.mode=null,n.setLayer(e),r(t.layer)}))})).catch((e=>{t.setLayer(null),n(e)}))};i.workLayers.indexOf(e)>=0?s():i.addLayer(e).then(s)})).catch((()=>{t.setLayer(null),r(null)})):(t.layer&&t.layer.wfsLayer&&(t.#bo=t.layer.wfsLayer),t.getEditControl().then((e=>{t.#dr(!1),t.closeEditSession().then((()=>{o.value="",e.mode=null,e.setLayer(null),t.layer=null,r(null)})).finally((()=>{t.#bo=null}))})))};null!==e&&t.layer?(t.layer.wfsLayer&&(t.#bo=t.layer.wfsLayer),t.closeEditSession().then((()=>{a&&s()}))):s()}))}#ko(e){const t=this;e.provId="NewFeature."+L++;const r=t.getLayerEditData(),n=t.#Bo(e);r.addedFeaturesLayer.addFeature(n),C(t.#Go()+e.provId,n).then((function(){t.#Fo(!0)}),(function(){o.A.error(t.getLocaleString("failedWhenSavingAddOperationInSession"))}))}#qo(e){const t=this;var r=e.provId||e.id,n=function(){t.#Fo()},i=function(){o.A.error(t.getLocaleString("failedWhenSavingRemoveOperationInSession"))};const a=t.getLayerEditData();if(a.serializable){let o=a.addedFeaturesLayer.getFeatureById(r);if(o)a.addedFeaturesLayer.removeFeature(o),b(t.#Go()+r).then(n,i);else{var s=t.#jo();o=a.modifiedFeaturesLayer.getFeatureById(r),o?(a.modifiedFeaturesLayer.removeFeature(o),a.removedFeaturesLayer.addFeature(t.#Bo(e)),b(t.#Uo()+r).then((function(){n(),C(s+r,e).then(n,i)}),i)):(o=a.removedFeaturesLayer.getFeatureById(r),o||(a.removedFeaturesLayer.addFeature(t.#Bo(e)),C(s+r,e).then(n,i)))}}}#Bo(e){const t=e.provId||e.id,r=this.getLayerEditData(),n=new e.constructor(e.geometry,{geometryName:r.geometryName,data:e.getData()});return n.setStyle(null),n.setId(t),n}getEditControl(){const e=this;return e.#Co||new Promise((function(t,r){const n=()=>e.renderPromise().then((()=>t(e.editControl)));e.map?e.map.ready(n):n()}))}async cacheLayer(e){if(await this.getServiceWorker(),navigator.onLine){const t=e.wrap.getGetFeatureUrl(),r=await e.getDescribeFeatureTypeUrl();t&&r&&await this.createCache(this.#Ho(e),{urlList:[t,r]})}}async getFeatureType(e){return await(this.map?.wait((async()=>{e=e||this.layer;const t=await e.describeFeatureType(),r=this.getLayerEditData(e);let n;for(n in r.attributes={},t){const e=t[n],i=E.A.getGeometryType(e.type);i?(r.geometryName=n,r.geometryType=i===a.A.geom.GEOMETRY?null:i):r.attributes[n]=e}for(n in r.attributes){const e=r.attributes[n];e.type=e.type.substr(e.type.indexOf(":")+1)}return r})))}async#zo(e){const t=this,r=t.map;e=e||t.layer;const n=t.getLayerEditData(e),i=n.beforeEditLayer;if(!i)throw Error(`No auxiliary layers for ${e.id}`);{const o=function(e){e.layer===i&&(i.setVisibility(t.showsOriginalFeatures),i.setOpacity(1),r.off(a.A.event.LAYERUPDATE,o))};r.on(a.A.event.LAYERUPDATE,o);const s=n.addedFeaturesLayer,l=n.modifiedFeaturesLayer,c=n.removedFeaturesLayer;await Promise.all([i.setOpacity(0),r.addLayer(i),r.addLayer(s),r.addLayer(l),r.addLayer(c)]);const u=await t.getEditableLayer(e);let h=r.layers.indexOf(u);s.setVisibility(t.highlightsAdded),l.setVisibility(t.highlightsModified),c.setVisibility(t.highlightsRemoved),await r.insertLayer(i,++h);const d=h+1;r.insertLayer(s,d),r.insertLayer(l,d),r.insertLayer(c,d),i.setStyles(t.getBeforeEditLayerStyle(u)),s.setStyles(t.getAddedFeaturesLayerStyle(u)),l.setStyles(t.getModifiedFeaturesLayerStyle(u)),c.setStyles(t.getRemovedFeaturesLayerStyle(u)),t.#To.src=x(u,n.geometryType),t.#xo.src=x(i,n.geometryType),t.#Po.src=x(s,n.geometryType),t.#Mo.src=x(l,n.geometryType),t.#Io.src=x(c,n.geometryType)}}async openEditSession(){const e=this;if(!e.layer)throw Error("No layer set for editing");let t;try{t=await e.getFeatureType()}catch(t){if(e.layer&&e.layer.type===a.A.layerType.VECTOR){const t=await e.getEditControl();return t.activate(),e.#dr(!0),void(t.mode=c.default.mode.MODIFY)}throw t}const r=await e.getEditControl(),n=await e.getEditableLayer(e.layer);switch(r.setLayer(n),t.geometryType){case a.A.geom.MULTIPOLYLINE:case a.A.geom.MULTIPOLYGON:r.setComplexGeometry(!0);break;default:r.setComplexGeometry(!1)}r.activate(),e.#dr(!0),e.#Fo();const i=[c.default.mode.MODIFY,c.default.mode.OTHER];switch(t.geometryType){case a.A.geom.POINT:i.push(c.default.mode.ADDPOINT);break;case a.A.geom.POLYLINE:case a.A.geom.MULTIPOLYLINE:i.push(c.default.mode.ADDLINE);break;case a.A.geom.POLYGON:case a.A.geom.MULTIPOLYGON:i.push(c.default.mode.ADDPOLYGON)}r.setModes(i),r.mode=c.default.mode.MODIFY,await e.#zo()}async closeEditSession(){const e=this;await e.renderPromise(),e.#Fo(!1),e.getEditControl().then((e=>e.deactivate()));const t=e.getLayerEditData();if(t?.beforeEditLayer){e.#To.src=a.A.BLANK_IMAGE,e.#xo.src=a.A.BLANK_IMAGE,e.#Po.src=a.A.BLANK_IMAGE,e.#Mo.src=a.A.BLANK_IMAGE,e.#Io.src=a.A.BLANK_IMAGE;const r=e.layer,n=await e.getEditableLayer(e.layer),i=[],o=function(t){e.map.workLayers.indexOf(t)>=0&&i.push(e.map.removeLayer(t))};o(t.beforeEditLayer),o(t.beforeEditLayer),o(t.addedFeaturesLayer),o(t.modifiedFeaturesLayer),o(t.removedFeaturesLayer),r!==n&&(r.wfsLayer=null,o(n)),await Promise.all(i)}}async getEditableLayer(e){const t=this,r=`Layer ${e.id} not editable`,n=t.map;if(e=n?n.getLayer(e):e){if(e.type!==a.A.layerType.WFS||!e.wmsLayer&&(e.options.stealth||e.options.readOnly)){if(e.type===a.A.layerType.WMS){if(e.wfsLayer)return await e.wfsLayer.getCapabilitiesPromise(),e.wfsLayer;{const i=await e.getWFSCapabilities(),s=e.getDisgregatedLayerNames();let l=s[0],c=l.indexOf(":");c<0&&(l=await e.getWFSFeatureType(),c=l.indexOf(":"));const u=l.substr(0,c),h=l.substring(c+1);if(1!==s.length||Object.prototype.hasOwnProperty.call(i.FeatureTypes,h)){const r={id:t.getUID(),type:a.A.layerType.WFS,url:await e.getWFSURL(),filter:n?new o.A.filter.Bbox(null,n.getExtent(),n.getCRS()):null,outputFormat:a.A.format.JSON,title:`${e.getPath().join(" • ")} - ${t.getLocaleString("featureEditing")}`,geometryName:"geom",featureType:[h],featureNS:u,styles:t.styles,stealth:!0};return e.wfsLayer=new d.A(r),e.wfsLayer.wmsLayer=e,e.wfsLayer}throw Error(r)}}if(e.type===a.A.layerType.VECTOR)return e;throw Error(r)}return await e.getCapabilitiesPromise(),e}throw Error("No layer to edit")}async isLayerEdited(e){const t=this.#Ho(e);try{const e=await i().keys();return!!e&&e.some((e=>0===e.indexOf(t)))}catch(e){return console.warn(e),!1}}getLayerEditData(e){const t=this,r=e||t.layer;return r?t.layersEditData[r.id]=t.layersEditData[r.id]||{checkedOut:!1}:null}#Vo(e){const t=this;return new Promise((function(r,n){t.getEditableLayer(e).then((function(n){const o=function(){const o=t.getLayerEditData(e),l=T(e);var c=o.beforeEditLayer;c||(c=o.beforeEditLayer=new d.A(s.A.extend({},n.options,{id:t.getUID(),title:`${l} - ${t.getLocaleString("dataBeforeEdits")}`,readOnly:!0,owner:t,stealth:!0})));var u=o.addedFeaturesLayer;let h=!0;u||(h=!1,u=o.addedFeaturesLayer=new d.A({id:t.getUID(),title:`${l} - ${t.getLocaleString("addedFeatures")}`,owner:t,stealth:!0,zIndex:2}));var p=o.modifiedFeaturesLayer;let g=!0;p||(g=!1,p=o.modifiedFeaturesLayer=new d.A({id:t.getUID(),title:`${l} - ${t.getLocaleString("modifiedFeatures")}`,owner:t,stealth:!0,zIndex:2}));var f=o.removedFeaturesLayer;let m=!0;f||(m=!1,f=o.removedFeaturesLayer=new d.A({id:t.getUID(),title:`${l} - ${t.getLocaleString("removedFeatures")}`,owner:t,stealth:!0,zIndex:2}));const y=[];if(h&&g&&m)f.features.forEach((function(e){const t=n.getFeatureById(e.id);t&&n.removeFeature(t)})),p.features.forEach((function(e){const t=n.getFeatureById(e.id);t&&(t.setCoords(e.geometry),t.setData(e.getData()))})),u.features.forEach((function(e){n.getFeatureById(e.id)||y.push(n.addFeature(t.#Bo(e)))})),Promise.all(y).then((()=>{o.serializable=!0,r(n)}));else{const e=t.#Ho(n),s=t.#Go(n),l=t.#Uo(n),c=t.#jo(n);i().keys().then((function(t){t&&t.filter((t=>0===t.indexOf(e))).forEach((function(e){y.push(new Promise((function(t,r){(async function(e){return{key:e,feature:await i().getItem(e)}})(e).then((function(e){var r,i=e.key;if(0===i.indexOf(c)){r=i.substr(c.length);const e=n.getFeatureById(r);n.removeFeature(e),f.addFeature(e).then((()=>t(e)))}else if(0===i.indexOf(l)){r=i.substr(l.length);const o=n.getFeatureById(r);if(o){o.setCoords(e.feature.geometry),o.setData(e.feature.attributes);const r=o.clone();r.setId(o.id),p.addFeature(r).then((()=>t(o)))}else t(o)}else if(0===i.indexOf(s)){r=i.substr(s.length);var o,h=parseInt(r.substr(r.lastIndexOf(".")+1));switch(L=Math.max(L,h+1),e.feature.type){case a.A.geom.POINT:o=n.addPoint(e.feature.geometry);break;case a.A.geom.POLYLINE:o=n.addPolyline(e.feature.geometry);break;case a.A.geom.POLYGON:o=n.addPolygon(e.feature.geometry);break;case a.A.geom.MULTIPOLYLINE:o=n.addMultiPolyline(e.feature.geometry);break;case a.A.geom.MULTIPOLYGON:o=n.addMultiPolygon(e.feature.geometry)}o.then((function(n){n.provId=r,n.setData(e.feature.attributes);const i=n.clone();i.setStyle(null),i.setId(n.provId),u.addFeature(i).then((()=>t(i)))}))}}))})))})),Promise.all(y).then((()=>{o.serializable=!0,r(n)}))}))}};if(n.type===a.A.layerType.WFS)if(n.state!==h.A.state.LOADING)o();else{const e=function(r){r.layer===n&&(o(),t.map.off(a.A.event.LAYERUPDATE,e))};t.map.on(a.A.event.LAYERUPDATE,e)}else r(n)}))}))}async applyEdits(){const e=this;if(e.layer){const t=e.getLayerEditData();t.serializable&&(e.isSyncing=!0,e.#No(),e.map?.wait((async()=>{const r=t.modifiedFeaturesLayer.features.map((function(e){const r=t.beforeEditLayer.features.filter((t=>t.id===e.id))[0];let n,i;if(r){for(var o in i=u.A.equals(e.geometry,r.geometry)?null:e.geometry,n={},e.data)if("id"!==o){const t=r.data[o],i=e.data[o];t!==i&&(n[o]=i)}}else i=e.geometry,n=e.data;const a=new e.constructor(i,{geometryName:t.geometryName});return a.setData(n),a.setId(e.id),a})),n=await e.getEditableLayer(e.layer);try{await n.applyEdits(t.addedFeaturesLayer.features,r,t.removedFeaturesLayer.features),e.layer.type===a.A.layerType.WMS&&e.layer.refresh(),t.beforeEditLayer.clearFeatures(),n.features.forEach((e=>{const r=t.beforeEditLayer.features;r[r.length]=e.clone()})),await e.deleteCache(e.#Ho());const i=function(){e.isSyncing=!1,e.discardEdits(),e.map.toast(e.getLocaleString("changesSuccessfullySyncedWithServer"),{type:a.A.msgType.INFO})};try{await e.cacheLayer(n),i()}catch(e){i()}}catch(t){e.isSyncing=!1,e.#No(),o.A.error(e.getLocaleString("errorSyncingChanges",{code:t.code,reason:t.reason}),[a.A.msgErrorMode.TOAST,a.A.msgErrorMode.CONSOLE])}})))}}discardEdits(){const e=this;var t=e.#Ho();i().keys().then((function(r){if(r){for(var n=0,o=r.length;n<o;n++){var a=r[n];0===a.indexOf(t)&&i().removeItem(a)}if(e.layer){const t=e.getLayerEditData();t.serializable&&(t.addedFeaturesLayer.clearFeatures(),t.modifiedFeaturesLayer.clearFeatures(),t.removedFeaturesLayer.clearFeatures(),e.editControl.setSelectedFeatures([]),e.getEditableLayer(e.layer).then((e=>e.refresh())))}e.#Fo(!1)}}),(e=>console.warn(e))),e.editControl.mode=null}showOriginalFeatures(e){this.showsOriginalFeatures=e;const t=this.getLayerEditData();t&&t.beforeEditLayer.setVisibility(e)}highlightAdded(e){this.highlightsAdded=e;const t=this.getLayerEditData();t&&t.addedFeaturesLayer&&t.addedFeaturesLayer.setVisibility(e)}highlightModified(e){this.highlightsModified=e;const t=this.getLayerEditData();t&&t.modifiedFeaturesLayer&&t.modifiedFeaturesLayer.setVisibility(e)}highlightRemoved(e){this.highlightsRemoved=e;const t=this.getLayerEditData();t&&t.removedFeaturesLayer&&t.removedFeaturesLayer.setVisibility(e)}#Yo(e){const t={};switch(this.getLayerEditData(e.wmsLayer||e).geometryType){case a.A.geom.POLYGON:case a.A.geom.MULTIPOLYGON:t.polygon=e.map.options.styles.polygon;break;case a.A.geom.POLYLINE:case a.A.geom.MULTIPOLYLINE:t.line=e.map.options.styles.line;break;default:t.point=e.map.options.styles.point}return t}getBeforeEditLayerStyle(e){const t=function(t){const r=e.wrap.getRGBA(t);for(var n=0;n<3;n++)r[n]=255-r[n];return"#"+(65536*r[0]+256*r[1]+r[2]).toString(16).padStart(6,"0")},r=[1,3],n=s.A.extend(!0,{},e.options.styles||this.#Yo(e));return n.point&&(n.point.strokeColor=t(n.point.strokeColor),n.point.lineDash=r),n.line&&(n.line.strokeColor=t(n.line.strokeColor),n.line.lineDash=r),n.polygon&&(n.polygon.strokeColor=t(n.polygon.strokeColor),n.polygon.lineDash=r),n}#$o(e,t){const r=s.A.extend(!0,{},e.options.styles||this.#Yo(e));return r.point&&(r.point.strokeColor=t,r.point.fillColor=t),r.line&&(r.line.strokeColor=t),r.polygon&&(r.polygon.strokeColor=t,r.polygon.fillColor=t),r}getAddedFeaturesLayerStyle(e){const t=this.getLayerEditData(e.wmsLayer||e);return this.#$o(e,t.addedCustomColor||"#00ff00")}getModifiedFeaturesLayerStyle(e){const t=this.getLayerEditData(e.wmsLayer||e);return this.#$o(e,t.modifiedCustomColor||"#ff7f00")}getRemovedFeaturesLayerStyle(e){const t=this.getLayerEditData(e.wmsLayer||e);return this.#$o(e,t.removedCustomColor||"#ff0000")}updateModel(){const e=this;e.model.featureEditing=e.getLocaleString("featureEditing"),e.model.selectLayerToEdit=e.getLocaleString("selectLayerToEdit"),e.model.featuresInEditedLayer=e.getLocaleString("featuresInEditedLayer"),e.model.featuresAsBeforeEditing=e.getLocaleString("featuresAsBeforeEditing"),e.model.unsyncedAdded=e.getLocaleString("unsyncedAdded"),e.model.unsyncedModified=e.getLocaleString("unsyncedModified"),e.model.unsyncedRemoved=e.getLocaleString("unsyncedRemoved"),e.model.refreshLayerToCurrentExtent=e.getLocaleString("refreshLayerToCurrentExtent"),e.model.syncChanges=e.getLocaleString("syncChanges"),e.model.discardChanges=e.getLocaleString("discardChanges"),e.model.clickToChangeColor=e.getLocaleString("clickToChangeColor")}updateLanguage(){this.updateModel()}}M.prototype.CLASS="tc-ctl-wfsedit",o.A.control.WFSEdit=M;const I=M},7735:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(3301),a=r(1256);n.A.control=n.A.control||{};class s extends a.A{#Cn;constructor(){super(...arguments);const e=this;e.#Cn={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"},e._dialogDiv=o.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e._dialogDiv.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector("button:not(."+e.#Cn.LOAD_CRS_BUTTON+")",(function(t){const r=t.target.dataset.crsCode;r&&e.setProjection({crs:r,allowFallbackLayer:!0})})),{passive:!0}),e._dialogDiv.addEventListener(i.A.event.CLICK,n.A.EventTarget.listenerBySelector("button."+e.#Cn.LOAD_CRS_BUTTON,(function(){e.loadFallbackProjections()})),{passive:!0})}async render(e){await super.render.call(this,e),this._dialogDiv.innerHTML=await this.getRenderedHtml(self.CLASS+"-dialog",null)}getAvailableCRS(e={}){return this.map.getCompatibleCRS(o.A.extend(e,{includeFallbacks:!0}))}showProjectionChangeDialog(e={}){const t=this,r=t._dialogDiv.querySelector("."+t.#Cn.CRS_DIALOG),n=r.querySelector(".tc-modal-body");n.classList.add(i.A.classes.LOADING);const a=n.querySelector("ul."+t.#Cn.CRS_LIST);a.innerHTML="";const s=t.map.baseLayer.firstOption||t.map.baseLayer,l=s.isRaster()?s.getFallbackLayer():null,c=function(){var l=[],c=[];if(s.isRaster())c=s.getCompatibleCRS(),l=t.getAvailableCRS(o.A.extend(e,{}));else{c=t.map.baseLayers.filter((e=>e.isRaster())).map((e=>e.getCompatibleCRS({normalized:!0,includeFallback:!0}))).reduce(((e,t)=>e.concat(t.filter((t=>e.indexOf(t)<0)))));const r=(e.layer?t.map.workLayers.concat(e.layer):t.map.workLayers).filter((function(e){return e.isRaster()})).map((function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:!0})}));l=c.filter((e=>r.every((t=>t.indexOf(e)>-1))))}t.map.loadProjections({crsList:l,orderBy:"name"}).then((function(e){var s=!1;if(e.forEach((function(e){if(t.modelDialog&&o.A.CRSCodesEqual(t.map.crs,e.code))t.modelDialog.currentCRSName=e.name,t.modelDialog.currentCRSCode=e.code;else{const r=document.createElement("button");r.setAttribute("type","button"),r.dataset.crsCode=e.code;const n=document.createElement("span");n.classList.add(t.CLASS+"-crs-code"),n.textContent=e.code;const l=document.createElement("span");l.textContent=e.name,l.classList.add(t.CLASS+"-crs-desc"),r.appendChild(n),r.appendChild(l);const u=document.createElement("li");u.appendChild(r),0===c.filter((function(t){return o.A.CRSCodesEqual(t,e.code)})).length&&(s=!0,u.classList.add(i.A.classes.HIDDEN),r.classList.add(i.A.classes.WARNING)),a.appendChild(u)}})),s){const e=document.createElement("li"),r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(t.#Cn.LOAD_CRS_BUTTON),r.textContent=t.getLocaleString("showOnTheFlyProjections"),e.appendChild(r),a.appendChild(e)}if(0===a.querySelectorAll("li").length){const e=document.createElement("li");e.textContent=t.getLocaleString("thereAreNoCompatibleCRS"),a.appendChild(e)}const l=a.querySelectorAll("li:not(."+i.A.classes.HIDDEN+")");r.querySelectorAll("."+t.#Cn.CHANGE).forEach((function(e){e.style.display=l.length>1?"":"none"})),r.querySelectorAll("."+t.#Cn.NO_CHANGE).forEach((function(e){e.style.display=l.length>1?"none":""})),r.querySelector("ul."+t.#Cn.CRS_LIST).style.display=l.length>0||s?"":"none",n.classList.remove(i.A.classes.LOADING)}))};l?l.getCapabilitiesPromise().then(c):c(),o.A.showModal(r,e)}setProjection(e={}){this.map.setProjection(e)}loadFallbackProjections(){const e=this,t=e._dialogDiv.querySelector("."+e.#Cn.CRS_DIALOG).querySelectorAll("ul."+e.#Cn.CRS_LIST+" li");t.forEach((function(t){t.classList.remove(i.A.classes.HIDDEN),t.querySelector("button."+e.#Cn.LOAD_CRS_BUTTON)&&t.classList.add(i.A.classes.HIDDEN)})),e._dialogDiv.querySelectorAll("p."+i.A.classes.WARNING).forEach((function(e){e.classList.remove(i.A.classes.HIDDEN)})),e._dialogDiv.querySelectorAll("."+e.#Cn.CHANGE).forEach((function(e){e.style.display=t.length>1?"":"none"})),e._dialogDiv.querySelectorAll("."+e.#Cn.NO_CHANGE).forEach((function(e){e.style.display=t.length>1?"none":""}))}}s.prototype.CLASS="tc-ctl-projs",n.A.control.ProjectionSelector=s;const l=s},7825:(e,t,r)=>{"use strict";r.d(t,{A:()=>ne});var n=r(588),i=r(7947),o=r(3942),a=r(581),s=r(8662),l=r(3662),c=r(1386),u=r(4165),h=r(5966),d=r(7468);const p={"http://www.opengis.net/gml":{boundedBy:(0,o.kW)(c.A.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:(0,o.VT)(c.A.prototype.readFeaturesInternal)}},g={"http://www.opengis.net/wfs":{totalInserted:(0,o.kW)(d.yg),totalUpdated:(0,o.kW)(d.yg),totalDeleted:(0,o.kW)(d.yg)},"http://www.opengis.net/wfs/2.0":{totalInserted:(0,o.kW)(d.yg),totalUpdated:(0,o.kW)(d.yg),totalDeleted:(0,o.kW)(d.yg)}},f={"http://www.opengis.net/wfs":{TransactionSummary:(0,o.kW)(T,"transactionSummary"),InsertResults:(0,o.kW)(I,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:(0,o.kW)(T,"transactionSummary"),InsertResults:(0,o.kW)(I,"insertIds")}},m={"http://www.opengis.net/wfs":{PropertyName:(0,o.mm)(d.uB)},"http://www.opengis.net/wfs/2.0":{PropertyName:(0,o.mm)(d.uB)}},y={"http://www.opengis.net/wfs":{Insert:(0,o.mm)(R),Update:(0,o.mm)(k),Delete:(0,o.mm)(N),Property:(0,o.mm)(F),Native:(0,o.mm)(G)},"http://www.opengis.net/wfs/2.0":{Insert:(0,o.mm)(R),Update:(0,o.mm)(k),Delete:(0,o.mm)(N),Property:(0,o.mm)(F),Native:(0,o.mm)(G)}},v="feature",A="http://www.w3.org/2000/xmlns/",S={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},E={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},w={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},_={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},L={"2.0.0":l.A,"1.1.0":s.A,"1.0.0":a.A};class C extends u.A{constructor(e){super(),e=e||{},this.version_=e.version?e.version:"1.1.0",this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new L[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:_[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const r={node:e};Object.assign(r,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(r,this.getReadOptions(e,t||{}));const n=[r];let i;i="2.0.0"===this.version_?p:this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let a=(0,o.eY)([],i,e,n,this.gmlFormat_);return a||(a=[]),a}readTransactionResponse(e){if(e){if("string"==typeof e){const t=(0,o.qg)(e);return this.readTransactionResponseFromDocument(t)}return(0,o.wz)(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if("string"==typeof e){const t=(0,o.qg)(e);return this.readFeatureCollectionMetadataFromDocument(t)}return(0,o.wz)(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},r=(0,d._X)(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=r,(0,o.eY)(t,p,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return(0,o.eY)({},f,e,[])}writeGetFeature(e){const t=(0,o.qq)(E[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),void 0!==e.maxFeatures&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),void 0!==e.startIndex&&t.setAttribute("startIndex",String(e.startIndex)),void 0!==e.count&&t.setAttribute("count",String(e.count)),void 0!==e.viewParams&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(o.pF,"xsi:schemaLocation",this.schemaLocation_);const r={node:t};if(Object.assign(r,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),(0,n.v)(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),"string"==typeof e.featureTypes[0]){let i=e.filter;e.bbox&&((0,n.v)(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(r,{geometryName:e.geometryName,filter:i}),te(t,e.featureTypes,[r])}else e.featureTypes.forEach((n=>{const i=this.combineBboxAndFilter(n.geometryName,n.bbox,e.srsName,e.filter);Object.assign(r,{geometryName:n.geometryName,filter:i}),te(t,[n.name],[r])}));return t}combineBboxAndFilter(e,t,r,n){const i=(0,h.Qk)(e,t,r);return n?(0,h.Uo)(n,i):i}writeTransaction(e,t,r,n){const i=[],a=n.version?n.version:this.version_,s=(0,o.qq)(E[a],"Transaction");let l;s.setAttribute("service","WFS"),s.setAttribute("version",a),n&&(l=n.gmlOptions?n.gmlOptions:{},n.handle&&s.setAttribute("handle",n.handle)),s.setAttributeNS(o.pF,"xsi:schemaLocation",_[a]);const c=function(e,t,r,n){const i=n.featurePrefix?n.featurePrefix:v;let o;"1.0.0"===r?o=2:"1.1.0"===r?o=3:"2.0.0"===r&&(o=3.2);return Object.assign({node:e},{version:r,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:o,hasZ:n.hasZ,srsName:n.srsName},t)}(s,l,a,n);return e&&b("Insert",e,i,c),t&&b("Update",t,i,c),r&&b("Delete",r,i,c),n.nativeElements&&b("Native",n.nativeElements,i,c),s}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(let t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){const e=[{}];return this.gmlFormat_.readGeometryElement(t,e),(0,i.Jt)(e.pop().srsName)}return null}}function b(e,t,r,n){(0,o.NQ)(n,y,(0,o.X1)(e),t,r)}function T(e,t){return(0,o.eY)({},g,e,t)}const x={"http://www.opengis.net/ogc":{FeatureId:(0,o.VT)((function(e,t){return e.getAttribute("fid")}))},"http://www.opengis.net/ogc/1.1":{FeatureId:(0,o.VT)((function(e,t){return e.getAttribute("fid")}))}};function P(e,t){(0,o.UN)(x,e,t)}const M={"http://www.opengis.net/wfs":{Feature:P},"http://www.opengis.net/wfs/2.0":{Feature:P}};function I(e,t){return(0,o.eY)([],M,e,t)}function R(e,t,r){const n=r[r.length-1],i=n.featureType,c=n.featureNS,u=n.gmlVersion,h=(0,o.qq)(c,i);e.appendChild(h),2===u?a.A.prototype.writeFeatureElement(h,t,r):3===u?s.A.prototype.writeFeatureElement(h,t,r):l.A.prototype.writeFeatureElement(h,t,r)}function O(e,t,r){const n=r[r.length-1].version,i=S[n],a=(0,o.qq)(i,"Filter"),s=(0,o.qq)(i,"FeatureId");a.appendChild(s),s.setAttribute("fid",t),e.appendChild(a)}function D(e,t){const r=(e=e||v)+":";return t.startsWith(r)?t:r+t}function N(e,t,r){const i=r[r.length-1];(0,n.v)(void 0!==t.getId(),"Features must have an id set");const o=i.featureType,a=i.featurePrefix,s=i.featureNS,l=D(a,o);e.setAttribute("typeName",l),e.setAttributeNS(A,"xmlns:"+a,s);const c=t.getId();void 0!==c&&O(e,c,r)}function k(e,t,r){const i=r[r.length-1];(0,n.v)(void 0!==t.getId(),"Features must have an id set");const a=i.version,s=i.featureType,l=i.featurePrefix,c=i.featureNS,u=D(l,s),h=t.getGeometryName();e.setAttribute("typeName",u),e.setAttributeNS(A,"xmlns:"+l,c);const d=t.getId();if(void 0!==d){const n=t.getKeys(),s=[];for(let e=0,r=n.length;e<r;e++){const r=t.get(n[e]);if(void 0!==r){let t=n[e];r&&"function"==typeof r.getSimplifiedGeometry&&(t=h),s.push({name:t,value:r})}}(0,o.NQ)({version:a,gmlVersion:i.gmlVersion,node:e,hasZ:i.hasZ,srsName:i.srsName},y,(0,o.X1)("Property"),s,r),O(e,d,r)}}function F(e,t,r){const n=r[r.length-1],i=n.version,c=E[i],u="2.0.0"===i?"ValueReference":"Name",h=(0,o.qq)(c,u),p=n.gmlVersion;if(e.appendChild(h),(0,d.uB)(h,t.name),void 0!==t.value&&null!==t.value){const n=(0,o.qq)(c,"Value");e.appendChild(n),t.value&&"function"==typeof t.value.getSimplifiedGeometry?2===p?a.A.prototype.writeGeometryElement(n,t.value,r):3===p?s.A.prototype.writeGeometryElement(n,t.value,r):l.A.prototype.writeGeometryElement(n,t.value,r):(0,d.uB)(n,t.value)}}function G(e,t,r){t.vendorId&&e.setAttribute("vendorId",t.vendorId),void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",String(t.safeToIgnore)),void 0!==t.value&&(0,d.uB)(e,t.value)}const B={"http://www.opengis.net/wfs":{Query:(0,o.mm)(U)},"http://www.opengis.net/wfs/2.0":{Query:(0,o.mm)(U)},"http://www.opengis.net/ogc":{During:(0,o.mm)(j),And:(0,o.mm)(V),Or:(0,o.mm)(V),Not:(0,o.mm)(z),BBOX:(0,o.mm)(q),Contains:(0,o.mm)(W),Intersects:(0,o.mm)(W),Within:(0,o.mm)(W),DWithin:(0,o.mm)(H),PropertyIsEqualTo:(0,o.mm)(Y),PropertyIsNotEqualTo:(0,o.mm)(Y),PropertyIsLessThan:(0,o.mm)(Y),PropertyIsLessThanOrEqualTo:(0,o.mm)(Y),PropertyIsGreaterThan:(0,o.mm)(Y),PropertyIsGreaterThanOrEqualTo:(0,o.mm)(Y),PropertyIsNull:(0,o.mm)($),PropertyIsBetween:(0,o.mm)(K),PropertyIsLike:(0,o.mm)(X)},"http://www.opengis.net/fes/2.0":{During:(0,o.mm)(j),And:(0,o.mm)(V),Or:(0,o.mm)(V),Not:(0,o.mm)(z),BBOX:(0,o.mm)(q),Contains:(0,o.mm)(W),Disjoint:(0,o.mm)(W),Intersects:(0,o.mm)(W),ResourceId:(0,o.mm)((function(e,t,r){e.setAttribute("rid",t.rid)})),Within:(0,o.mm)(W),DWithin:(0,o.mm)(H),PropertyIsEqualTo:(0,o.mm)(Y),PropertyIsNotEqualTo:(0,o.mm)(Y),PropertyIsLessThan:(0,o.mm)(Y),PropertyIsLessThanOrEqualTo:(0,o.mm)(Y),PropertyIsGreaterThan:(0,o.mm)(Y),PropertyIsGreaterThanOrEqualTo:(0,o.mm)(Y),PropertyIsNull:(0,o.mm)($),PropertyIsBetween:(0,o.mm)(K),PropertyIsLike:(0,o.mm)(X)}};function U(e,t,r){const n=r[r.length-1],i=n.version,a=n.featurePrefix,s=n.featureNS,l=n.propertyNames,c=n.srsName;let u,h;u=a?D(a,t):t,h="2.0.0"===i?"typeNames":"typeName",e.setAttribute(h,u),c&&e.setAttribute("srsName",c),s&&e.setAttributeNS(A,"xmlns:"+a,s);const d=Object.assign({},n);d.node=e,(0,o.NQ)(d,m,(0,o.X1)("PropertyName"),l,r);const p=n.filter;if(p){const t=(0,o.qq)(re(i),"Filter");e.appendChild(t),function(e,t,r){const n=r[r.length-1],i={node:e};Object.assign(i,{context:n}),(0,o.NQ)(i,B,(0,o.X1)(t.getTagName()),[t],r)}(t,p,r)}}function q(e,t,r){const n=r[r.length-1],i=n.context.version;n.srsName=t.srsName;const o=L[i];Q(i,e,t.geometryName),o.prototype.writeGeometryElement(e,t.extent,r)}function W(e,t,r){const n=r[r.length-1],i=n.context.version;n.srsName=t.srsName;const o=L[i];Q(i,e,t.geometryName),o.prototype.writeGeometryElement(e,t.geometry,r)}function H(e,t,r){const n=r[r.length-1].context.version;W(e,t,r);const i=(0,o.qq)(re(n),"Distance");(0,d.uB)(i,t.distance.toString()),"2.0.0"===n?i.setAttribute("uom",t.unit):i.setAttribute("units",t.unit),e.appendChild(i)}function j(e,t,r){const n=r[r.length-1].context.version;Z(w[n],"ValueReference",e,t.propertyName);const i=(0,o.qq)(c.M,"TimePeriod");e.appendChild(i);const a=(0,o.qq)(c.M,"begin");i.appendChild(a),ee(a,t.begin);const s=(0,o.qq)(c.M,"end");i.appendChild(s),ee(s,t.end)}function V(e,t,r){const n=r[r.length-1].context,i={node:e};Object.assign(i,{context:n});const a=t.conditions;for(let e=0,t=a.length;e<t;++e){const t=a[e];(0,o.NQ)(i,B,(0,o.X1)(t.getTagName()),[t],r)}}function z(e,t,r){const n=r[r.length-1].context,i={node:e};Object.assign(i,{context:n});const a=t.condition;(0,o.NQ)(i,B,(0,o.X1)(a.getTagName()),[a],r)}function Y(e,t,r){const n=r[r.length-1].context.version;void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),Q(n,e,t.propertyName),J(n,e,""+t.expression)}function $(e,t,r){Q(r[r.length-1].context.version,e,t.propertyName)}function K(e,t,r){const n=r[r.length-1].context.version,i=re(n);Q(n,e,t.propertyName);const a=(0,o.qq)(i,"LowerBoundary");e.appendChild(a),J(n,a,""+t.lowerBoundary);const s=(0,o.qq)(i,"UpperBoundary");e.appendChild(s),J(n,s,""+t.upperBoundary)}function X(e,t,r){const n=r[r.length-1].context.version;e.setAttribute("wildCard",t.wildCard),e.setAttribute("singleChar",t.singleChar),e.setAttribute("escapeChar",t.escapeChar),void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString()),Q(n,e,t.propertyName),J(n,e,""+t.pattern)}function Z(e,t,r,n){const i=(0,o.qq)(e,t);(0,d.uB)(i,n),r.appendChild(i)}function J(e,t,r){Z(re(e),"Literal",t,r)}function Q(e,t,r){"2.0.0"===e?Z(w[e],"ValueReference",t,r):Z(S[e],"PropertyName",t,r)}function ee(e,t){const r=(0,o.qq)(c.M,"TimeInstant");e.appendChild(r);const n=(0,o.qq)(c.M,"timePosition");r.appendChild(n),(0,d.uB)(n,t)}function te(e,t,r){const n=r[r.length-1],i=Object.assign({},n);i.node=e,(0,o.NQ)(i,B,(0,o.X1)("Query"),t,r)}function re(e){let t;return t="2.0.0"===e?w[e]:S[e],t}const ne=C},7830:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(5264),l=r(5056),c=r(7018),u=r(8606),h=r(6257),d=r(3791),p=r(5777);n.A.control=n.A.control||{},n.A.control.infoShare=s.default,n.A.Control=a.A,i.A.event.POPUP=i.A.event.POPUP||"popup.tc",i.A.event.POPUPHIDE=i.A.event.POPUPHIDE||"popuphide.tc",i.A.event.DRAWCHART=i.A.event.DRAWCHART||"drawchart.tc",i.A.event.DRAWTABLE=i.A.event.DRAWTABLE||"drawtable.tc",i.A.event.DIALOG=i.A.event.DIALOG||"dialog.tc",i.A.event.FEATUREHIGHLIGHT=i.A.event.FEATUREHIGHLIGHT||"featurehighlight.tc",i.A.event.FEATUREDOWNPLAY=i.A.event.FEATUREDOWNPLAY||"featuredownplay.tc";const g=function(e){return e&&Array.isArray(e.features)?1===e.features.length?e.features[0]:null:e};class f{constructor(){this.downloadFeature="",this.download="",this.shareFeature="",this.share="",this.zoomToFeature="",this.viewElevation="",this.viewElevationProfile="",this.deleteFeature=""}}class m{constructor(){this.feature="",this.share="",this.close=""}}class y{constructor(){this.linkInNewWindow="",this.open="",this["featureInfo.complexData.array"]="",this.viewEnlargedImage=""}}class v extends a.A{TITLE_SEPARATOR=" › ";FILE_TITLE_SEPARATOR="__";_dialogDiv;_parentCtl;constructor(){super(...arguments);const e=this;e.div.classList.add(e.CLASS),e.exportsState=!0,e._dialogDiv=o.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.model=new f,e.dialogModel=new m,e.dataModel=new y}async register(e){const t=this;return e.on(i.A.event.POPUP+" "+i.A.event.DRAWTABLE+" "+i.A.event.DRAWCHART,(function(e){const r=e.control;(r.caller||r.currentFeature)&&(t.addUI(r),t.dataController=new p.A(t.dataModel,new d.A(r.getInfoContainer()||r.getTableContainer())))})).on(i.A.event.FEATUREHIGHLIGHT,(function(e){t.addUI(e.control.getDisplayControl()),e.feature.toggleSelectedStyle(!0)})).on(i.A.event.FEATUREDOWNPLAY,(function(e){t.updateUI(e.control.getDisplayControl()),e.feature.toggleSelectedStyle(!1)})),await Promise.all([super.register.call(t,e),t.renderPromise()]),await t.getShareDialog(),t}async loadTemplates(){const e=this,t=r.e(5084).then(r.bind(r,5084)),n=r.e(2289).then(r.bind(r,2289)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-dialog"]=(await n).default,e.template=i}async render(){const e=this;e._dialogDiv.innerHTML=await e.getRenderedHtml(e.CLASS+"-dialog",{checkboxId:e.getUID(),elevation:e.options.displayElevation}),await e.renderData({elevation:e.options.displayElevation}),e.dialogController=new p.A(e.dialogModel,new d.A(e._dialogDiv))}addUI(e){const t=this;t._parentCtl=e;const r=e.getMenuElement(),n=function(){return r&&!r.querySelector("."+t.CLASS)};t.getCurrentFeature(e)&&(n()?t.getRenderedHtml(t.CLASS,null,(function(i){if(n()){let o=Promise.resolve();const a=e.getContainerElement();if(!a.querySelectorAll("."+l.default.prototype.CLASS+"-btn").length){const n=!e.caller&&e.currentFeature?e.currentFeature:e.caller.highlightedFeature;n&&!0===n.showsPopup&&(t.printControl=new l.default({target:r,printableElement:a,title:n.id}),o=t.printControl.renderPromise())}o.then((function(){if(n()){const n=(new DOMParser).parseFromString(i,"text/html").body.firstChild;r.appendChild(n),t.updateUI(e),t.#Ko(e),t.#Xo(e),t.controller=new p.A(t.model,new d.A(n)),t.updateModel()}}))}})):t.updateUI(e))}#Xo(e){const t=this;e.getContainerElement().querySelectorAll("table.tc-attr").forEach((function(r){!e.caller&&e.currentFeature&&(r.addEventListener(i.A.event.CLICK,(function(r){t.zoomToFeatures([t.getCurrentFeature(e)])}),{passive:!0}),r.classList.add(t.CLASS+"-zoom"),r.setAttribute("title",t.getLocaleString("clickToCenter"))),r.querySelectorAll("a, label, input, video, audio").forEach((function(e){e.addEventListener(i.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})}))}));const r=e.getContainerElement().querySelector(`.${e.CLASS}-body > table`);r&&r.parentElement.classList.add(t.CLASS+"-zoom")}updateUI(e){const t=this,r=e.getMenuElement().querySelector("."+t.CLASS),n=t.getCurrentFeature(e),o=n&&n.layer&&n.layer.owner?n.layer.owner.filterLayer!==n.layer:n&&!!n.layer;if(o)if(n){r.dataset.layerId=n.layer.id,r.dataset.featureId=n.id;const o=!!n.layer.cluster&&n.features.length>1,a=r.querySelector(`.${t.CLASS}-share-btn`);a&&a.classList.toggle(i.A.classes.HIDDEN,o),r.querySelector(`.${t.CLASS}-dl-btn`).classList.toggle(i.A.classes.HIDDEN,o),r.querySelector(`.${t.CLASS}-del-btn`).classList.toggle(i.A.classes.HIDDEN,o),t.getElevationTool().then((function(a){const s=r.querySelector(`.${t.CLASS}-prof-btn`);s&&s.classList.toggle(i.A.classes.HIDDEN,!a||!(n instanceof u.A||n instanceof h.A)||!!e.chart);const l=r.querySelector(`.${t.CLASS}-elev-btn`);l&&l.classList.toggle(i.A.classes.HIDDEN,!a||!(n instanceof c.A)||o)}))}else delete r.dataset.layerId,delete r.dataset.featureId;t.printControl&&n&&(t.printControl.title=n.id),r&&(r.classList.remove(i.A.classes.ACTIVE),setTimeout((function(){r.classList.toggle(i.A.classes.ACTIVE,!!o)}),100))}onDownloadButtonClick(e){const t=g(this.getFeatureFromElement(e.target.parentElement));t&&this.showDownloadDialog(t)}onShareButtonClick(e){const t=this,r=g(t.getFeatureFromElement(e.target.parentElement));if(!r)throw Error("FeatureTools: there is no feature to share");t.#Zo({feature:r}).then((async function(e){t.toShare={feature:e},t.showShareDialog()}))}onZoomButtonClick(e){const t=(r=this.getFeatureFromElement(e.target.parentElement))?Array.isArray(r.features)?r.features:[r]:[];var r;t.length&&this.zoomToFeatures(t)}onDeleteButtonClick(e){this.removeFeature(this.getFeatureFromElement(e.target.parentElement))}onProfileButtonClick(e){const t=this,r=g(t.getFeatureFromElement(e.target.parentElement)),n={};r&&t.getElevationControl().then((function(e){e&&(r.getGeometryStride()>2?(n.originalElevation=!0,n.onlyOriginalElevation=!1,e.setElevationToolOptions({resolution:t.options.resolution||0,sampleNumber:t.options.sampleNumber||0})):e.setElevationToolOptions(Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)),e.displayElevationProfile(r,n))}))}onElevationButtonClick(e){const t=this;t.getElevationControl().then((r=>r&&r.displayElevationValue(g(t.getFeatureFromElement(e.target.parentElement)),{ignoreCache:!0})))}#Ko(e){const t=this,r=e.getMenuElement();r.querySelector("."+t.CLASS+"-dl-btn").addEventListener(i.A.event.CLICK,(function(e){t.onDownloadButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-share-btn").addEventListener(i.A.event.CLICK,(function(e){t.onShareButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-zoom-btn").addEventListener(i.A.event.CLICK,(function(e){t.onZoomButtonClick(e)}),{passive:!0});const n=r.querySelector(`.${t.CLASS}-prof-btn`);n&&n.addEventListener(i.A.event.CLICK,(function(e){t.onProfileButtonClick(e)}),{passive:!0});const o=r.querySelector(`.${t.CLASS}-elev-btn`);o&&o.addEventListener(i.A.event.CLICK,(function(e){t.onElevationButtonClick(e)}),{passive:!0}),r.querySelector("."+t.CLASS+"-del-btn").addEventListener(i.A.event.CLICK,(function(e){t.onDeleteButtonClick(e)}),{passive:!0})}async getElevationControl(){const e=this;return e.options.displayElevation?(e.elevationControl||(e.elevationControl=await e.map.addControl("elevation",e.options.displayElevation)),e.elevationControl):null}async showDownloadDialog(e){const t=this,r=await t.getDownloadDialog();var n={title:t.getLocaleString("feature")+" - "+t.getLocaleString("download"),fileName:t.#Jo(e)};(t.map.elevation||t.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)})),n.openCallback=function(){t.map.trigger(i.A.event.DIALOG,{control:r,action:"download"})},r.open(e,n)}getCurrentFeature(e){return e?.caller?.highlightedFeature||e?.currentFeature}getFeatureFromElement(e){const t=this.map.getLayer(e.dataset.layerId);return t?t.getFeatureById(e.dataset.featureId):null}zoomToFeatures(e){this.map&&this.map.zoomToFeatures(e,{animate:!0})}removeFeature(e){const t=this,r=function(){e&&e.layer&&e.layer.removeFeature(e)};e&&e.layer&&e.layer.owner&&e.layer===e.layer.owner.resultsLayer?(r(),t._parentCtl?.caller?.removeFeature?.(e)):n.A.confirm(t.getLocaleString("deleteFeature.confirm"),(function(){r(),t._parentCtl?.caller?.removeFeature?.(e)}))}async#Zo(e={}){const t=this,r=e.feature;if(r){const i=r.clone();if(i.setId(r.id),i.layer=r.layer,e.elevation){var n=!0;if(!e.elevation.resolution&&i.getGeometryStride()>2&&(n=!1),n){const r={crs:t.map.crs,features:[i],maxCoordQuantity:t.options.displayElevation?.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:0},n=await t.getElevationTool();return(await n.setGeometry(r))[0]}return i}return i.removeZ(),i}return null}getFeatureTitle(e){var t="";return e&&(t=e.id),t}#Jo(e){const t=this;return(t.getFeatureTitle(e).toString().replace(new RegExp(t.TITLE_SEPARATOR,"g"),t.FILE_TITLE_SEPARATOR)||t.getLocaleString("feature")).toLowerCase().replace(/\s/gi,"_")+"_"+o.A.getFormattedDate((new Date).toString(),!0)}exportState(){const e=this;if(e.toShare){const t={};if(e.toShare.doZoom&&(t.doZoom=e.toShare.doZoom),t.id=e.id,e.toShare.feature){let r;const n=e.toShare.feature.clone();n.showsPopup=!0,n.autoPopup=!0,r=e.toShare.feature.layer.exportState({features:[n]}),t.features=r.features,r.crs&&(t.crs=r.crs)}else if(e.toShare.features){if(t.features=e.toShare.features,e.sharedFeaturesLayer){let r=e.sharedFeaturesLayer.exportState();t.features=r.features}e.toShare.crs&&(t.crs=e.toShare.crs)}return t}return null}importState(e){const t=this;t.map&&e.features&&e.features.length&&(t.toShare={features:e.features},e.crs&&(t.toShare.crs=e.crs),t.map.addLayer({id:t.getUID(),owner:t,type:i.A.layerType.VECTOR,title:t.getLocaleString("foi"),stealth:!0}).then((function(r){t.sharedFeaturesLayer=r,r.importState({features:e.features,crs:e.crs}).then((function(){e.doZoom&&t.map.zoomToFeatures(r.features)}))})))}async updateModel(){const e=this;e.model.downloadFeature=e.getLocaleString("downloadFeature"),e.model.download=e.getLocaleString("download"),e.model.shareFeature=e.getLocaleString("shareFeature"),e.model.share=e.getLocaleString("share"),e.model.zoomToFeature=e.getLocaleString("zoomToFeature"),e.model.viewElevation=e.getLocaleString("viewElevation"),e.model.viewElevationProfile=e.getLocaleString("viewElevationProfile"),e.model.deleteFeature=e.getLocaleString("deleteFeature"),e.dialogModel.feature=e.getLocaleString("feature"),e.dialogModel.share=e.getLocaleString("share"),e.dialogModel.close=e.getLocaleString("close"),e.printControl&&(e.printControl.model.print=e.getLocaleString("print"),e.printControl.model.printThisContent=e.getLocaleString("printThisContent")),e.dataModel.linkInNewWindow=e.getLocaleString("linkInNewWindow"),e.dataModel.open=e.getLocaleString("open"),e.dataModel["featureInfo.complexData.array"]=e.getLocaleString("featureInfo.complexData.array"),e.dataModel.viewEnlargedImage=e.getLocaleString("featureInfo.complexData.array")}async updateLanguage(){this.updateModel()}}n.A.mix(v,s.default),v.prototype.CLASS="tc-ctl-ftools",n.A.control.FeatureTools=v;const A=v},7843:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(8038),i=r(3301),o=r(8848);n.A.control=n.A.control||{};class a extends o.default{POSITION={LEFT:"left",RIGHT:"right"};SIDE=this.POSITION;async onRender(){const e=this;e.controlOptions.forEach((function(t,r){const n=Object.keys(t).find((e=>["position","index"].indexOf(e)<0));e._ctlPromises[r]=e.map.addControl(n,i.A.extend({id:e.uids[r],div:e.div.querySelector("."+e.CLASS+"-elm-"+r).querySelector("div")},t[n].options||t[n]))})),await Promise.all(e._ctlPromises);for(var t=0,r=arguments.length;t<r;t++)arguments[t].containerControl=e;return e}mergeOptions(...e){const t=e.map((e=>{if(!Array.isArray(e.controls)){const r={...e};for(var t in r.controls){const e={...r.controls[t]};e.position=e.side,delete e.side,r.controls[t]=e}return r}return e}));return super.mergeOptions(...t)}async loadTemplates(){const e=this,t=r.e(627).then(r.bind(r,627)),n=r.e(9464).then(r.bind(r,9464)),i={};i[e.CLASS]=(await t).default,i[e.CLASS+"-node"]=(await n).default,e.template=i}render(e){return this.renderData({controls:this.controlOptions.map((function(e,t){return i.A.extend(e,{index:t})}))},e)}async addControl(e,t){const r=this;t.position=t.position||t.side||r.POSITION.LEFT;const n=++r.ctlCount;await r.renderPromise();const o=await r.getRenderedHtml(r.CLASS+"-node",{index:n});var a=document.createElement("template");return a.innerHTML=o.trim(),r.div.querySelector("ul."+r.CLASS+"-"+t.position).appendChild(a.content?a.content.firstChild:a.firstChild),await r.map.addControl(e,i.A.extend({id:r.getUID(),div:r.div.querySelector("."+r.CLASS+"-elm-"+n).querySelector("div")},t))}addElement(e){const t=this;e.position=e.position||e.side||t.POSITION.LEFT;var r=document.createElement("li");r.setAttribute("class",t.CLASS+"-elm "+t.CLASS+"-elm-"+t.ctlCount+++" "),t.div.querySelector("ul."+t.CLASS+"-"+e.position).appendChild(r);var n=r.appendChild(e.htmlElement);return n.setAttribute("class",n.getAttribute("class")+" tc-ctl"),n}updateLanguage=async function(){}}a.prototype.CLASS="tc-ctl-cctr",n.A.control.ControlContainer=a;const s=a},7917:(e,t,r)=>{"use strict";r.d(t,{Jt:()=>i,WQ:()=>o});let n={};function i(e){return n[e]||n[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function o(e,t){n[e]=t}},7947:(e,t,r)=>{"use strict";r.d(t,{Ig:()=>l.I,MF:()=>s.A,hB:()=>ne,O3:()=>ee,bF:()=>Z,Av:()=>te,wU:()=>ye,HU:()=>re,RJ:()=>K,tI:()=>ie,Ad:()=>pe,SD:()=>fe,Jt:()=>J,hO:()=>Q,RG:()=>se,FO:()=>oe,Tf:()=>he,te:()=>de,JR:()=>ge,vN:()=>me,pd:()=>le,DI:()=>ce});var n=r(4422),i=r(6933),o=r(915),a=r(1597),s=r(5286),l=r(8100);const c=6378137,u=Math.PI*c,h=[-u,-u,u,u],d=[-180,-85,180,85],p=c*Math.log(Math.tan(Math.PI/2));class g extends s.A{constructor(e){super({code:e,units:"m",extent:h,global:!0,worldExtent:d,getPointResolution:function(e,t){return e/Math.cosh(t[1]/c)}})}}const f=[new g("EPSG:3857"),new g("EPSG:102100"),new g("EPSG:102113"),new g("EPSG:900913"),new g("http://www.opengis.net/def/crs/EPSG/0/3857"),new g("http://www.opengis.net/gml/srs/epsg.xml#3857")];var m=r(8673),y=r(7917),v=r(3158);const A=.9996,S=.00669438,E=S*S,w=E*S,_=S/(1-S),L=Math.sqrt(1-S),C=(1-L)/(1+L),b=C*C,T=b*C,x=T*C,P=x*C,M=.9983242984503243,I=15*E/256+45*w/1024,R=35*w/3072,O=1.5*C-27/32*T+269/512*P,D=21/16*b-55/32*x,N=151/96*T-417/128*P,k=1097/512*x,F=6378137;function G(e,t,r){const n=e-5e5,i=(r.north?t:t-1e7)/A/(F*M),o=i+O*Math.sin(2*i)+D*Math.sin(4*i)+N*Math.sin(6*i)+k*Math.sin(8*i),s=Math.sin(o),l=s*s,c=Math.cos(o),u=s/c,h=u*u,d=h*h,p=1-S*l,g=Math.sqrt(1-S*l),f=_*c**2,m=f*f,y=n/(F/g*A),v=y*y,E=v*y,w=E*y,L=w*y,C=o-u/((1-S)/p)*(v/2-w/24*(5+3*h+10*f-4*m-9*_))+L*y/720*(61+90*h+298*f+45*d-252*_-3*m);let b=(y-E/6*(1+2*h+f)+L/120*(5-2*f+28*h-3*m+8*_+24*d))/c;return b=(0,a.LV)(b+(0,a.eh)(U(r.number)),-Math.PI,Math.PI),[(0,a.xW)(b),(0,a.xW)(C)]}function B(e,t,r){e=(0,a.LV)(e,-180,180),t<-80?t=-80:t>84&&(t=84);const n=(0,a.eh)(t),i=Math.sin(n),o=Math.cos(n),s=i/o,l=s*s,c=l*l,u=(0,a.eh)(e),h=U(r.number),d=(0,a.eh)(h),p=F/Math.sqrt(1-S*i**2),g=_*o**2,f=o*(0,a.LV)(u-d,-Math.PI,Math.PI),m=f*f,y=m*f,v=y*f,E=v*f,w=E*f,L=F*(M*n-.002514607064228144*Math.sin(2*n)+I*Math.sin(4*n)-R*Math.sin(6*n)),C=A*p*(f+y/6*(1-l+g)+E/120*(5-18*l+c+72*g-58*_))+5e5;let b=A*(L+p*s*(m/2+v/24*(5-l+9*g+4*g**2)+w/720*(61-58*l+c+600*g-330*_)));return r.north||(b+=1e7),[C,b]}function U(e){return 6*(e-1)-180+3}const q=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function W(e){let t=0;for(const r of q){const n=e.match(r);if(n){t=parseInt(n[1]);break}}if(!t)return null;let r=0,n=!1;return t>32700&&t<32761?r=t-32700:t>32600&&t<32661&&(n=!0,r=t-32600),r?{number:r,north:n}:null}function H(e,t){return function(r,n,i,o){const a=r.length;i=i>1?i:2,o=o??i,n||(n=i>2?r.slice():new Array(a));for(let i=0;i<a;i+=o){const o=r[i],a=r[i+1],s=e(o,a,t);n[i]=s[0],n[i+1]=s[1]}return n}}const j=6371008.8;function V(e,t,r){r=r||j;const n=(0,a.eh)(e[1]),i=(0,a.eh)(t[1]),o=(i-n)/2,s=(0,a.eh)(t[0]-e[0])/2,l=Math.sin(o)*Math.sin(o)+Math.sin(s)*Math.sin(s)*Math.cos(n)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}const z=[function(e){const t=W(e.getCode());return t?{forward:H(B,t),inverse:H(G,t)}:null}],Y=[function(e){return W(e)?new s.A({code:e,units:"m"}):null}];let $=!0;function K(e){$=!(void 0===e||e)}function X(e,t){if(void 0!==t)for(let r=0,n=e.length;r<n;++r)t[r]=e[r];else t=e.slice();return t}function Z(e){(0,y.WQ)(e.getCode(),e),(0,v.WQ)(e,e,X)}function J(e){if("string"!=typeof e)return e;const t=(0,y.Jt)(e);if(t)return t;for(const t of Y){const r=t(e);if(r)return r}return null}function Q(e,t,r,n){let i;const o=(e=J(e)).getPointResolutionFunc();if(o){if(i=o(t,r),n&&n!==e.getUnits()){const t=e.getMetersPerUnit();t&&(i=i*t/l.I[n])}}else{const o=e.getUnits();if("degrees"==o&&!n||"degrees"==n)i=t;else{const a=oe(e,J("EPSG:4326"));if(a||"degrees"===o){let e=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];e=a(e,e,2),i=(V(e.slice(0,2),e.slice(2,4))+V(e.slice(4,6),e.slice(6,8)))/2}else i=t*e.getMetersPerUnit();const s=n?l.I[n]:e.getMetersPerUnit();void 0!==s&&(i/=s)}}return i}function ee(e){!function(e){e.forEach(Z)}(e),e.forEach((function(t){e.forEach((function(e){t!==e&&(0,v.WQ)(t,e,X)}))}))}function te(e,t){return e?"string"==typeof e?J(e):e:J(t)}function re(e){return function(t,r,n,i){const o=t.length;n=void 0!==n?n:2,i=i??n,r=void 0!==r?r:new Array(o);for(let a=0;a<o;a+=i){const o=e(t.slice(a,a+n)),s=o.length;for(let e=0,n=i;e<n;++e)r[a+e]=e>=s?t[a+e]:o[e]}return r}}function ne(e,t,r,n){const i=J(e),o=J(t);(0,v.WQ)(i,o,re(r)),(0,v.WQ)(o,i,re(n))}function ie(e,t){if(e===t)return!0;const r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||oe(e,t)===X)&&r}function oe(e,t){const r=e.getCode(),n=t.getCode();let i=(0,v.Jt)(r,n);if(i)return i;let o=null,a=null;for(const r of z)o||(o=r(e)),a||(a=r(t));if(!o&&!a)return null;const s="EPSG:4326";if(a)if(o)i=ae(o.inverse,a.forward);else{const e=(0,v.Jt)(r,s);e&&(i=ae(e,a.forward))}else{const e=(0,v.Jt)(s,n);e&&(i=ae(o.inverse,e))}return i&&(Z(e),Z(t),(0,v.WQ)(e,t,i)),i}function ae(e,t){return function(r,n,i,o){return n=e(r,n,i,o),t(n,n,i,o)}}function se(e,t){return oe(J(e),J(t))}function le(e,t,r){const n=se(t,r);if(!n){const e=J(t).getCode(),n=J(r).getCode();throw new Error(`No transform available between ${e} and ${n}`)}return n(e,void 0,e.length)}function ce(e,t,r,n){const i=se(t,r);return(0,o.NW)(e,i,void 0,n)}let ue=null;function he(){return ue}function de(e,t){return ue?le(e,t,ue):e}function pe(e,t){return ue?le(e,ue,t):($&&!(0,i.aI)(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90&&($=!1,(0,n.R8)("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),e)}function ge(e,t){return ue?ce(e,t,ue):e}function fe(e,t){return ue?ce(e,ue,t):e}function me(e,t){if(!ue)return e;const r=J(t).getMetersPerUnit(),n=ue.getMetersPerUnit();return r&&n?e*r/n:e}function ye(e,t,r){return function(n){let s,l;if(e.canWrapX()){const t=e.getExtent(),c=(0,o.RG)(t);n=n.slice(0),l=(0,i.U$)(n,e,c),l&&(n[0]=n[0]-l*c),n[0]=(0,a.qE)(n[0],t[0],t[2]),n[1]=(0,a.qE)(n[1],t[1],t[3]),s=r(n)}else s=r(n);return l&&t.canWrapX()&&(s[0]+=l*(0,o.RG)(t.getExtent())),s}}var ve,Ae,Se,Ee;ee(f),ee(m.NU),ve=m.NU,Ae=f,Se=function(e,t,r,n){const i=e.length;r=r>1?r:2,n=n??r,void 0===t&&(t=r>2?e.slice():new Array(i));for(let r=0;r<i;r+=n){t[r]=u*e[r]/180;let n=c*Math.log(Math.tan(Math.PI*(+e[r+1]+90)/360));n>p?n=p:n<-p&&(n=-p),t[r+1]=n}return t},Ee=function(e,t,r,n){const i=e.length;r=r>1?r:2,n=n??r,void 0===t&&(t=r>2?e.slice():new Array(i));for(let r=0;r<i;r+=n)t[r]=180*e[r]/u,t[r+1]=360*Math.atan(Math.exp(e[r+1]/c))/Math.PI-90;return t},ve.forEach((function(e){Ae.forEach((function(t){(0,v.WQ)(e,t,Se),(0,v.WQ)(t,e,Ee)}))}))},8038:(e,t,r)=>{"use strict";r.d(t,{A:()=>w});var n=r(797),i=r(1976),o=r.n(i),a=r(8721),s=s||{};!function(){if(!s.apiLocation)if(globalThis?.SITNA_BASE_URL)s.apiLocation=globalThis.SITNA_BASE_URL,s.apiLocation.endsWith("/")||(s.apiLocation=s.apiLocation+"/");else{const e=(document.currentScript??document.scripts[document.scripts.length-1]).getAttribute("src");s.apiLocation=e.substr(0,e.lastIndexOf("/")+1),globalThis.SITNA_BASE_URL=s.apiLocation}}(),s.control={},s.capabilities={},s.capabilitiesWFS={},s.featureTypeDescriptions={},s.legendFormat={},s.tool={},s.cache={},"boolean"!=typeof s.isDebug&&(s.isDebug=!0),s.alert=function(e){alert(e)},s.prompt=function(e,t,r){var n=prompt(e,t);s.Util.isFunction(r)&&r(n)},s.confirm=function(e,t,r){const n=confirm(e);return n?s.Util.isFunction(t)&&t():s.Util.isFunction(r)&&r(),n},s.error=function(e){const t=e.message??e;window.console&&(e instanceof Error?console.error(e):console.error(t))},s.proxify=function(e){var t=e=e.trim();const r=window.TC.Cfg.proxy;if(r){var n=!1;const o=window.TC.Cfg.proxyExceptions;if(o)for(var i=0;i<o.length;i++)if(e.indexOf(o[i])>-1){n=!0;break}n||s.Util.isSameOrigin(e)||("function"==typeof r?t=r(e):(t=r,"http"!==e.substr(0,4)&&(t+=window.location.protocol),t+=encodeURIComponent(e)))}return t};var l=function(e){let t="";try{throw new Error}catch(e){t=e&&e.stack?e.stack:e.toString()}const r=s.Map.get(document.querySelector("."+n.A.classes.MAP)),i="Error al cargar "+e,o=s.Util.getLocaleString(r?r.options.locale:"es-ES","urlFailedToLoad",{url:e});s.error(o,[n.A.msgErrorMode.TOAST],i),s.error(`${o}. Pila de la llamada al recurso: \n${t&&t.length>0?t:""}`,[n.A.msgErrorMode.EMAIL],i)};s.syncLoadJS=function(e){var t=function(e,t){var r,n=new XMLHttpRequest;n.open("GET",e,!1),n.onreadystatechange=function(e){4===n.readyState&&(404===n.status?(r=!1,t(!0)):200!==n.status?(t(),r=!1):r=n.responseText)};try{n.send(null)}catch(e){r=!1,t()}return r};/(\.js|\/)$/i.test(e)||(e+=s.isDebug?".js":".min.js");var r,n,i,o=t(e,(function(r){return r?(l(e),!1):t(e,(function(){l(e)}))}));if(o){var a=document.createElement("script");a.type="text/javascript",a.text=o,(n=document,i=n.getElementsByTagName("head"),0===i.length?(r=n.createElement("head"),n.documentElement.insertBefore(r,document.body)):r=i[0],r).appendChild(a)}},s.loadJSInOrder=function(e,t,r){return s.loadJS(e,t,r,!0)};const c=function(e,t){s.Util.isSameOrigin(e)||(t.crossOrigin="anonymous")};s.loadJS=function(e,t,r,n=!1,i){return new Promise((function(a,u){const h=function(){s.Util.isFunction(r)&&r(),a()};var d=Array.isArray(t)?t:[t];if(d=d.map((function(e){return/\.js$/i.test(e)||0!==e.indexOf(s.apiLocation)?e:e+(s.isDebug?".js":".min.js")})),e){var p="";const e=function(e){return e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase()};if((d=d instanceof Array?d:[d]).length>1){var g=d.slice(0).filter((function(t,r){return!o().isDefined(e(t))||(d.splice(r,1),o().ready(e(t),h),!1)}));1===g.length?p=e(g[0]):g.length>0&&(p=g.reduce((function(t,r){return e(t)+"_"+e(r)})))}else p=e(d[0]);if(p.length>0)if(o().isDefined(p))o().ready(p,h);else{var f={async:!n,numRetries:1};i||s.Util.detectIE()||(f.before=c),o()(d,p,f),o().ready(p,{success:function(){h()},error:function(e){l(e)}})}}else h()}))},s.loadCSS=function(e){const t=e.split("/").reverse().slice(0,2).reverse().join("_").toLowerCase();o().isDefined(t)?o().ready(t,{}):o()(e,t,{error:function(e){l(e)},numRetries:1})},s.ajax=function(e={}){return new Promise((function(t,r){const i=e.method||"GET",o="GET"===i;var a;if(e.data)if("string"==typeof e.data)a=e.data;else if("object"==typeof e.data)if(o&&(e.contentType||"boolean"==typeof e.contentType))a=s.Util.getParamString(e.data);else{const t=[];for(var l in e.data)t.push(l+"="+e.data[l].toString());a=t.join("&")}var c=e.url;o&&a&&(c=c+"?"+a),!1===e.cache&&(c+=(c.indexOf("?")<0?"?":"&")+"ts="+Date.now());const u={method:i,headers:new Headers};e.contentType||"boolean"==typeof e.contentType?e.contentType&&u.headers.append("Content-Type",e.contentType+"; charset=UTF-8"):u.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),"POST"===i&&(u.body=a),fetch(c,u).then((async i=>{if(i.ok)try{let r;switch(e.responseType){case n.A.mimeType.JSON:r=await i.json();break;case n.A.mimeType.XML:r=await i.text(),r=(new DOMParser).parseFromString(r,"application/xml");break;default:r=await i.text()}t({data:r,contentType:i.headers.get("Content-type")})}catch(e){r(e)}else r({status:i.status,msg:i.statusText,url:c})})).catch((e=>r(e)))}))};const u={25830:{code:"25830",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 30N",wkt:'PROJCS["ETRS89 / UTM zone 30N",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","25830"]]',proj4:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs",bbox:[80.49,-6,35.26,.01],unit:"metre",area:"Europe between 6°W and 0°W: Faroe Islands offshore; Ireland - offshore; Jan Mayen - offshore; Norway including Svalbard - offshore; Spain - onshore and offshore.",accuracy:1},4326:{code:"4326",kind:"CRS-GEOGCRS",name:"WGS 84",wkt:'GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]]',proj4:"+proj=longlat +datum=WGS84 +no_defs +type=crs",bbox:[90,-180,-90,180],unit:"degree (supplier to define representation)",area:"World.",accuracy:null},3857:{code:"3857",kind:"CRS-PROJCRS",name:"WGS 84 / Pseudo-Mercator",wkt:'PROJCS["WGS 84 / Pseudo-Mercator",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Mercator_1SP"],PARAMETER["central_meridian",0],PARAMETER["scale_factor",1],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs"],AUTHORITY["EPSG","3857"]]',proj4:"+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs",bbox:[85.06,-180,-85.06,180],unit:"metre",area:"World between 85.06°S and 85.06°N.",accuracy:null},900913:{code:"900913",kind:"CRS-PROJCRS",name:"Google Maps Global Mercator",wkt:'PROJCS["Google Maps Global Mercator (deprecated)",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Mercator_1SP"],PARAMETER["central_meridian",0],PARAMETER["scale_factor",1],PARAMETER["false_easting",0],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],EXTENSION["PROJ4","+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs"],AUTHORITY["EPSG","900913"]]',proj4:"+proj=merc +a=6378137 +b=6378137 +lat_ts=0 +lon_0=0 +x_0=0 +y_0=0 +k=1 +units=m +nadgrids=@null +wktext +no_defs +type=crs",bbox:[0,0,0,0],unit:null,area:null,accuracy:null},25828:{code:"25828",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 28N",wkt:'PROJCS["ETRS89 / UTM zone 28N",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-15],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","25828"]]',proj4:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs",bbox:[72.44,-16.1,34.93,-11.99],unit:"metre",area:"Europe between 18°W and 12°W: Faroe Islands - offshore; Ireland - offshore; Jan Mayen - offshore; Portugal - offshore mainland; Spain - offshore mainland; United Kingdom (UKCS) - offshore.",accuracy:1},25829:{code:"25829",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 29N",wkt:'PROJCS["ETRS89 / UTM zone 29N",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-9],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","25829"]]',proj4:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs",bbox:[74.13,-12,34.91,-6],unit:"metre",area:"Europe between 12°W and 6°W: Faroe Islands - onshore and offshore; Ireland - offshore; Jan Mayen - onshore and offshore; Portugal - onshore and offshore; Spain - onshore and offshore; United Kingdom - UKCS offshore.",accuracy:1},25831:{code:"25831",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 31N",wkt:'PROJCS["ETRS89 / UTM zone 31N",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","25831"]]',proj4:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs",bbox:[82.45,0,37,6.01],unit:"metre",area:"Europe between 0°E and 6°E: Andorra; Belgium - onshore and offshore; Denmark - offshore; Germany - offshore; Jan Mayen - offshore; Norway including Svalbard - onshore and offshore; Spain - onshore and offshore.",accuracy:1},23030:{code:"23030",kind:"CRS-PROJCRS",name:"ED50 / UTM zone 30N",wkt:'PROJCS["ED50 / UTM zone 30N",GEOGCS["ED50",DATUM["European_Datum_1950",SPHEROID["International 1924",6378388,297],TOWGS84[-87,-98,-121,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4230"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","23030"]]',proj4:"+proj=utm +zone=30 +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +units=m +no_defs +type=crs",bbox:[80.49,-6,35.26,.01],unit:"metre",area:"Europe - between 6°W and 0°W - Channel Islands (Jersey, Guernsey); France offshore; Gibraltar; Ireland offshore; Norway including Svalbard - offshore; Spain - onshore; United Kingdom - UKCS offshore.",accuracy:10},23028:{code:"23028",kind:"CRS-PROJCRS",name:"ED50 / UTM zone 28N",wkt:'PROJCS["ED50 / UTM zone 28N",GEOGCS["ED50",DATUM["European_Datum_1950",SPHEROID["International 1924",6378388,297],TOWGS84[-87,-98,-121,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4230"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-15],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","23028"]]',proj4:"+proj=utm +zone=28 +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +units=m +no_defs +type=crs",bbox:[56.57,-16.1,48.43,-12],unit:"metre",area:"Europe - between 18°W and 12°W - Ireland offshore.",accuracy:10},23029:{code:"23029",kind:"CRS-PROJCRS",name:"ED50 / UTM zone 29N",wkt:'PROJCS["ED50 / UTM zone 29N",GEOGCS["ED50",DATUM["European_Datum_1950",SPHEROID["International 1924",6378388,297],TOWGS84[-87,-98,-121,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4230"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-9],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","23029"]]',proj4:"+proj=utm +zone=29 +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +units=m +no_defs +type=crs",bbox:[62.41,-12,36.13,-6],unit:"metre",area:"Europe - between 12°W and 6°W - Faroe Islands - onshore; Spain - mainland onshore; Ireland offshore.",accuracy:10},23031:{code:"23031",kind:"CRS-PROJCRS",name:"ED50 / UTM zone 31N",wkt:'PROJCS["ED50 / UTM zone 31N",GEOGCS["ED50",DATUM["European_Datum_1950",SPHEROID["International 1924",6378388,297],TOWGS84[-87,-98,-121,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4230"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","23031"]]',proj4:"+proj=utm +zone=31 +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +units=m +no_defs +type=crs",bbox:[82.45,0,38.56,6.01],unit:"metre",area:"Europe - between 0°E and 6°E - Andorra; Denmark (North Sea); Germany offshore; Netherlands offshore; Norway including Svalbard - onshore and offshore; Spain - onshore (mainland and Balearic Islands); United Kingdom (UKCS) offshore.",accuracy:10},32630:{code:"32630",kind:"CRS-PROJCRS",name:"WGS 84 / UTM zone 30N",wkt:'PROJCS["WGS 84 / UTM zone 30N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32630"]]',proj4:"+proj=utm +zone=30 +datum=WGS84 +units=m +no_defs +type=crs",bbox:[84,-6,0,0],unit:"metre",area:"Between 6°W and 0°W, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Burkina Faso. Côte' Ivoire (Ivory Coast). Faroe Islands - offshore. France. Ghana. Gibraltar. Ireland - offshore Irish Sea. Mali. Mauritania. Morocco. Spain. United Kingdom (UK).",accuracy:null},32628:{code:"32628",kind:"CRS-PROJCRS",name:"WGS 84 / UTM zone 28N",wkt:'PROJCS["WGS 84 / UTM zone 28N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-15],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32628"]]',proj4:"+proj=utm +zone=28 +datum=WGS84 +units=m +no_defs +type=crs",bbox:[84,-18,0,-12],unit:"metre",area:"Between 18°W and 12°W, northern hemisphere between equator and 84°N, onshore and offshore. Gambia. Greenland. Guinea. Guinea-Bissau. Iceland. Ireland - offshore Porcupine Basin. Mauritania. Morocco. Senegal. Sierra Leone. Western Sahara.",accuracy:null},32629:{code:"32629",kind:"CRS-PROJCRS",name:"WGS 84 / UTM zone 29N",wkt:'PROJCS["WGS 84 / UTM zone 29N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-9],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32629"]]',proj4:"+proj=utm +zone=29 +datum=WGS84 +units=m +no_defs +type=crs",bbox:[84,-12,0,-6],unit:"metre",area:"Between 12°W and 6°W, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Côte D'Ivoire (Ivory Coast). Faroe Islands. Guinea. Ireland. Jan Mayen. Mali. Mauritania. Morocco. Portugal. Sierra Leone. Spain. United Kingdom (UK). Western Sahara.",accuracy:null},32631:{code:"32631",kind:"CRS-PROJCRS",name:"WGS 84 / UTM zone 31N",wkt:'PROJCS["WGS 84 / UTM zone 31N",GEOGCS["WGS 84",DATUM["WGS_1984",SPHEROID["WGS 84",6378137,298.257223563,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4326"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AXIS["Easting",EAST],AXIS["Northing",NORTH],AUTHORITY["EPSG","32631"]]',proj4:"+proj=utm +zone=31 +datum=WGS84 +units=m +no_defs +type=crs",bbox:[84,0,0,6],unit:"metre",area:"Between 0°E and 6°E, northern hemisphere between equator and 84°N, onshore and offshore. Algeria. Andorra. Belgium. Benin. Burkina Faso. Denmark - North Sea. France. Germany - North Sea. Ghana. Luxembourg. Mali. Netherlands. Niger. Nigeria. Norway. Spain. Togo. United Kingdom (UK) - North Sea.",accuracy:null},4230:{code:"4230",kind:"CRS-GEOGCRS",name:"ED50",wkt:'GEOGCS["ED50",DATUM["European_Datum_1950",SPHEROID["International 1924",6378388,297],TOWGS84[-87,-98,-121,0,0,0,0]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4230"]]',proj4:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +type=crs +axis=neu",bbox:[84.73,-16.1,25.71,48.61],unit:"degree (supplier to define representation)",area:"Europe - west: Andorra; Cyprus; Denmark - onshore and offshore; Faroe Islands - onshore; France - offshore; Germany - offshore North Sea; Gibraltar; Greece - offshore; Israel - offshore; Italy including San Marino and Vatican City State; Ireland offshore; Malta; Netherlands - offshore; North Sea; Norway including Svalbard - onshore and offshore; Portugal - mainland - offshore; Spain - onshore; Türkiye (Turkey) - onshore and offshore; United Kingdom - UKCS offshore east of 6°W including Channel Islands (Guernsey and Jersey). Egypt - Western Desert; Iraq - onshore; Jordan.",accuracy:10},3040:{code:"3040",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 28N (N-E)",wkt:'PROJCS["ETRS89 / UTM zone 28N (N-E)",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-15],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AUTHORITY["EPSG","3040"]]',proj4:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs +axis=neu",bbox:[72.44,-16.1,34.93,-11.99],unit:"metre",area:"Europe between 18°W and 12°W: Faroe Islands - offshore; Ireland - offshore; Jan Mayen - offshore; Portugal - offshore mainland; Spain - offshore mainland; United Kingdom (UKCS) - offshore.",accuracy:1},3041:{code:"3041",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 29N (N-E)",wkt:'PROJCS["ETRS89 / UTM zone 29N (N-E)",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-9],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AUTHORITY["EPSG","3041"]]',proj4:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs +axis=neu",bbox:[74.13,-12,34.91,-6],unit:"metre",area:"Europe between 12°W and 6°W: Faroe Islands - onshore and offshore; Ireland - offshore; Jan Mayen - onshore and offshore; Portugal - onshore and offshore; Spain - onshore and offshore; United Kingdom - UKCS offshore.",accuracy:1},3042:{code:"3042",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 30N (N-E)",wkt:'PROJCS["ETRS89 / UTM zone 30N (N-E)",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",-3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AUTHORITY["EPSG","3042"]]',proj4:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs +axis=neu",bbox:[80.49,-6,35.26,.01],unit:"metre",area:"Europe between 6°W and 0°W: Faroe Islands offshore; Ireland - offshore; Jan Mayen - offshore; Norway including Svalbard - offshore; Spain - onshore and offshore.",accuracy:1},3043:{code:"3043",kind:"CRS-PROJCRS",name:"ETRS89 / UTM zone 31N (N-E)",wkt:'PROJCS["ETRS89 / UTM zone 31N (N-E)",GEOGCS["ETRS89",DATUM["European_Terrestrial_Reference_System_1989",SPHEROID["GRS 1980",6378137,298.257222101,AUTHORITY["EPSG","7019"]],TOWGS84[0,0,0,0,0,0,0],AUTHORITY["EPSG","6258"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.0174532925199433,AUTHORITY["EPSG","9122"]],AUTHORITY["EPSG","4258"]],PROJECTION["Transverse_Mercator"],PARAMETER["latitude_of_origin",0],PARAMETER["central_meridian",3],PARAMETER["scale_factor",0.9996],PARAMETER["false_easting",500000],PARAMETER["false_northing",0],UNIT["metre",1,AUTHORITY["EPSG","9001"]],AUTHORITY["EPSG","3043"]]',proj4:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +type=crs +axis=neu",bbox:[82.45,0,37,6.01],unit:"metre",area:"Europe between 0°E and 6°E: Andorra; Belgium - onshore and offshore; Denmark - offshore; Germany - offshore; Jan Mayen - offshore; Norway including Svalbard - onshore and offshore; Spain - onshore and offshore.",accuracy:1}};s.getProjectionData=function(e={}){const t=(e.crs||"").match(/\d{4,6}$/g);let r=t?t[0]:"",n=u[r];if(n)return e.sync?n:Promise.resolve(n);if(e.sync){const e=function(e){let t=!1;const r=new XMLHttpRequest;r.onreadystatechange=function(e){4==r.readyState&&(t=404!=r.status&&200==r.status&&r.responseText)},r.open("GET",e,!1);try{r.send(null)}catch(e){t=!1}return t},t=JSON.parse(e(`${s.apiLocation}resources/data/crs/${r}.json`));return u[r]=t,t}return fetch(`${s.apiLocation}resources/data/crs/${r}.json`).then((e=>e.json().then((e=>(u[r]=e,e))).catch((()=>!1)))).catch((()=>!1))},s.loadProjDef=function(e={}){const t=e.crs,r="urn:ogc:def:crs:EPSG::",n="http://www.opengis.net/gml/srs/epsg.xml#";var i;i=function(e){return e=function(e){var t=/http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/\d\/(\d{4,5})/.exec(e);return t&&2===t.length?r+t[1]:e}(e),a.A.defs(e)};const o=function(e){return"function"==typeof e},l=function(o,s,l){const c="EPSG:"+o,u=r+o,h="urn:x-ogc:def:crs:EPSG:"+o,d=n+o,p="http://www.opengis.net/def/crs/EPSG/0/"+o;var g;"object"==typeof s?(g={...s},s={...s},g.axis&&delete g.axis):"string"==typeof s&&(g=s.replace("+axis=neu","")),a.A.defs(c,s),a.A.defs(u,s),a.A.defs(h,s),a.A.defs(d,g),a.A.defs(p,s),0===t.indexOf(n)&&(a.A.defs(t,g),i(t).name=l),globalThis.ol&&ol.proj&&(e.silent||ol.proj.proj4.register(a.A)),i(c).name=l,i(d).name=l;const f=i(p);f&&(f.name=l)};var c=t.lastIndexOf("#");c<0&&(c=t.lastIndexOf("/")),c<0&&(c=t.lastIndexOf(":"));var u=t.substr(c+1),h=i(t);if(h)l(u,h,e.name),o(e.callback)&&e.callback();else if(e.def)l(u,e.def,e.name),o(e.callback)&&e.callback();else{const t=function(t){(function(e){const t=!!e;return t&&l(e.code,e.wkt||e.proj4,e.name),t})(t)&&o(e.callback)&&e.callback()};if(!e.sync)return s.getProjectionData(e).then(t).catch((e=>console.error(e)));t(s.getProjectionData(e))}};const h=Object.entries(u);for(let e=0;e<h.length;e++){const t=h[e][1];s.loadProjDef({crs:"EPSG:"+t.code,name:t.name,def:t.proj4,silent:e<h.length-1})}s.inherit=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e._super=t.prototype},s.mix=function(e,...t){for(const r of t)for(const[t,n]of Object.entries(r))Object.prototype.hasOwnProperty.call(e.prototype,t)||(e.prototype[t]=n)};const d=new Map;s.getUID=function(e={}){const t=e.prefix||"";let r=d.get(t);r||(r=1);let n=t+r;return d.set(t,r+1),e.banlist?.includes(n)?s.getUID(e):n},s.setUIDStart=function(e,t={}){const r=t.prefix||"";let n=d.get(r);return n||(n=1),e>n?(d.set(r,e),e):n};const p=["","-webkit-","-moz-","-o-","-ms-"],g="http://sitna.tracasa.es/";var f,m,y;const v={touch:function(){if(void 0===f){if("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)return f=!0,!0;const e=p.map((function(e){return"("+e+"touch-enabled)"})).join();f=matchMedia(e).matches}return f},inputTypeColor:function(){if(void 0===m){const e=document.createElement("input");e.setAttribute("type","color"),(m="text"!==e.type&&"style"in e)&&(e.value=":-)",m=":-)"!==e.value)}return m},urlParser:function(){if(void 0===y)try{const e=new URL(g);y=e.href===g}catch(e){y=!1}return y}};s.browserFeatures=v;const A=/\+/g;function S(e){return e}function E(e){return decodeURIComponent(e.replace(A," "))}s.cookie=function(e,t,r){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(t))||null===t)){if(r={...r},null===t&&(r.expires=-1),"number"==typeof r.expires){var n=r.expires,i=r.expires=new Date;i.setDate(i.getDate()+n)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",r.raw?t:encodeURIComponent(t),r.expires?";expires="+r.expires.toUTCString():"",r.path?";path="+r.path:"",r.domain?";domain="+r.domain:"",r.secure?";secure":""].join("")}for(var o,a=(r=t||{}).raw?S:E,s=document.cookie.split("; "),l=0;o=s[l]&&s[l].split("=");l++)if(a(o.shift())===e)return a(o.join("="));return null};const w=s},8100:(e,t,r)=>{"use strict";r.d(t,{I:()=>n});const n={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937}},8176:(e,t,r)=>{var n={"./Elevation":[4363],"./Elevation.js":[4363],"./ElevationService":[5924,5924],"./ElevationService.js":[5924,5924],"./ElevationServiceGoogle":[5031,5031],"./ElevationServiceGoogle.js":[5031,5031],"./ElevationServiceIDENA":[199,199],"./ElevationServiceIDENA.js":[199,199],"./ElevationServiceIGNEs":[16,16],"./ElevationServiceIGNEs.js":[16,16],"./ElevationServiceIGNFr":[9724,9724],"./ElevationServiceIGNFr.js":[9724,9724],"./ExcelExport":[4921],"./ExcelExport.js":[4921],"./FeatureTypeParser":[5101],"./FeatureTypeParser.js":[5101],"./OgcApiProcessesElevationService":[608,608],"./OgcApiProcessesElevationService.js":[608,608],"./Proxification":[8991],"./Proxification.js":[8991],"./WellKnowNameFactory":[6014],"./WellKnowNameFactory.js":[6014],"./WellKnowNameTemplates":[3343],"./WellKnowNameTemplates.js":[3343],"./xsdDocuments.mjs":[7375,7375]};function i(e){if(!r.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return Promise.all(t.slice(1).map(r.e)).then((()=>r(i)))}i.keys=()=>Object.keys(n),i.id=8176,e.exports=i},8202:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});const n={compiler:[8,">= 4.3.0"],main:function(e,t,r,n,i){return'<button type="button" class="tc-ctl-3d-btn tc-float-btn" title="[[threed.tip]]"></button>'},useData:!0}},8217:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>f,Bs:()=>A,hX:()=>m,te:()=>S,zU:()=>y});var n=r(6717),i=r(3402),o=r(4294),a=r(1217),s=r(4142),l=r(503),c=r(6702),u=r(2871),h=r(4338),d=r(7947),p=r(4778),g=r(4087);const f=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=n.A,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let r=t.dataProjection?(0,d.Jt)(t.dataProjection):this.readProjection(e);t.extent&&r&&"tile-pixels"===r.getUnits()&&(r=(0,d.Jt)(r),r.setWorldExtent(t.extent)),t={dataProjection:r,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return(0,g.b0)()}readFeature(e,t){return(0,g.b0)()}readFeatures(e,t){return(0,g.b0)()}readGeometry(e,t){return(0,g.b0)()}readProjection(e){return(0,g.b0)()}writeFeature(e,t){return(0,g.b0)()}writeFeatures(e,t){return(0,g.b0)()}writeGeometry(e,t){return(0,g.b0)()}};function m(e,t,r){const n=r?(0,d.Jt)(r.featureProjection):null,i=r?(0,d.Jt)(r.dataProjection):null;let o=e;if(n&&i&&!(0,d.tI)(n,i)){t&&(o=e.clone());const r=t?n:i,a=t?i:n;"tile-pixels"===r.getUnits()?o.transform(r,a):o.applyTransform((0,d.RG)(r,a))}if(t&&r&&void 0!==r.decimals){const t=Math.pow(10,r.decimals),n=function(e){for(let r=0,n=e.length;r<n;++r)e[r]=Math.round(e[r]*t)/t;return e};o===e&&(o=e.clone()),o.applyTransform(n)}return o}function y(e,t){const r=t?(0,d.Jt)(t.featureProjection):null,n=t?(0,d.Jt)(t.dataProjection):null;return r&&n&&!(0,d.tI)(r,n)?(0,d.DI)(e,n,r):e}const v={Point:o.A,LineString:a.A,Polygon:s.Ay,MultiPoint:l.A,MultiLineString:c.A,MultiPolygon:u.A};function A(e,t){const r=e.geometry;if(!r)return[];if(Array.isArray(r))return r.map((t=>A({...e,geometry:t}))).flat();const n="MultiPolygon"===r.type?"Polygon":r.type;if("GeometryCollection"===n||"Circle"===n)throw new Error("Unsupported geometry type: "+n);const o=r.layout.length;return m(new p.Ay(n,"Polygon"===n?function(e,t,r){return Array.isArray(t[0])?((0,i.mb)(e,0,t,r)||(e=e.slice(),(0,i.NK)(e,0,t,r)),e):((0,i.PA)(e,0,t,r)||(e=e.slice(),(0,i.ug)(e,0,t,r)),e)}(r.flatCoordinates,r.ends,o):r.flatCoordinates,r.ends?.flat(),o,e.properties||{},e.id).enableSimplifyTransformed(),!1,t)}function S(e,t){if(!e)return null;if(Array.isArray(e)){const r=e.map((e=>S(e,t)));return new h.A(r)}return m(new(0,v[e.type])(e.flatCoordinates,e.layout||"XY",e.ends),!1,t)}},8325:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(8038);const i=function(e,t,r,n){return 8&r?[e[0]+(t[0]-e[0])*(n[3]-e[1])/(t[1]-e[1]),n[3]]:4&r?[e[0]+(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1]),n[1]]:2&r?[n[2],e[1]+(t[1]-e[1])*(n[2]-e[0])/(t[0]-e[0])]:1&r?[n[0],e[1]+(t[1]-e[1])*(n[0]-e[0])/(t[0]-e[0])]:null},o=function(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r},a=(e,t)=>{const r=(t+1)%e.length,n=e[t],i=e[r];return(i[1]+n[1])*(i[0]-n[0])},s={isPoint:function(e){return Array.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(e){return Array.isArray(e)&&(0===e.length||s.isPoint(e[0]))},isRingCollection:function(e){return Array.isArray(e)&&(0===e.length||s.isRing(e[0]))},isMultiRingCollection:function(e){return Array.isArray(e)&&(0===e.length||s.isRingCollection(e[0]))},getNearest:function(e,t){return n.A.wrap.Geometry.getNearest(e,t)},getArea:function(e){if(s.isRingCollection(e)||s.isMultiRingCollection(e))return e.reduce(((e,t)=>e+s.getArea(t)),0);if(s.isRing(e)){let t=0;for(let r=0;r<e.length;r++)t+=a(e,r);return t}return 0},isInside:function e(t,r){var n=!1;if(s.isPoint(t))if(s.isPoint(r))n=t[0]===r[0]&&t[1]===r[1];else if(s.isRing(r))for(var i=0,o=r.length-1;i<r.length;o=i++){var a=r[i][0],l=r[i][1],c=r[o][0],u=r[o][1];l>t[1]!=u>t[1]&&t[0]<(c-a)*(t[1]-l)/(u-l)+a&&(n=!n)}else if(s.isRingCollection(r)&&r.length>0){if(e(t,r[0])){var h=!1;for(i=1;i<r.length;i++)if(e(t,r[i])){h=!0;break}h||(n=!0)}}else if(s.isMultiRingCollection(r)&&r.length>0)for(i=0;i<r.length;i++)if(e(t,r[i])){n=!0;break}return n},equals:function(e,t){return Array.isArray(e)&&Array.isArray(t)?e.length===t.length&&e.every(((e,r)=>s.equals(e,t[r]))):!Array.isArray(e)&&!Array.isArray(t)&&e===t},getSquaredDistance:function(e,t){const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},getDistance:function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])},getFlatCoordinates:function(e){const t=function(e,t){return e.concat(t)};switch(!0){case s.isPoint(e):return[e];case s.isRing(e):return e;case s.isRingCollection(e):return e.reduce(t);case s.isMultiRingCollection(e):return e.reduce(t).reduce(t);default:return[]}},iterateCoordinates:function*e(t){if(Array.isArray(t))if(s.isPoint(t))yield t;else for(var r=0,n=t.length;r<n;r++)yield*e(t[r])},intersects:function(e,t){const r=function(e,t){for(var r=0,n=e.length;r<n;r++)if(s.isInside(e[r],t))return!0;return!1};return!(!r(s.getFlatCoordinates(e),t)&&!r(s.getFlatCoordinates(t),e))},clipPolygon:function(e,t){return e.map((e=>s.clipRing(e,t))).filter((e=>e.length))},clipRing:function(e,t){let r,n,a,s,l;for(n=1;n<=8&&(r=[],a=e[e.length-1],s=!(o(a,t)&n),e.forEach((e=>{l=!(o(e,t)&n),l!==s&&r.push(i(a,e,n,t)),l&&r.push(e),a=e,s=l})),(e=r).length);n*=2);return r},clipPolyline:function(e,t){let r,n,a,s,l,c=e.length,u=o(e[0],t),h=[],d=[];for(r=1;r<c;r++){for(n=e[r-1],a=e[r],s=l=o(a,t);;){if(!(u|s)){h.push(n),s!==l?(h.push(a),r<c-1&&(d=d.concat(h),h=[])):r===c-1&&h.push(a);break}if(u&s)break;u?(n=i(n,a,u,t),u=o(n,t)):(a=i(n,a,s,t),s=o(a,t))}u=l}return h.length&&(d=d.concat(h)),d},interpolate:function(e,t){let r=e;if(1!==r.length)if(t.resolution){const e=[];r.forEach((function(r,n,i){if(n){const a=i[n-1],l=s.getDistance(a,r);if(l>t.resolution){let n=l%t.resolution/2,i=Math.ceil(l/t.resolution);0===n&&(i-=1,n=t.resolution);const s=r[0]-a[0],c=(r[1]-a[1])/l,u=s/l;let h=a[0]+n*u,d=a[1]+n*c,p=t.resolution*u,g=t.resolution*c;for(var o=0;o<i;o++)e.push([h,d]),h+=p,d+=g}}e.push(r)})),r=e}else if(t.sampleNumber){const e=r.length;if(e>t.sampleNumber){const e=[];let i=0;r.forEach((function(t,r,o){r&&(i+=n.A.Geometry.getDistance(o[r-1],t)),e.push({index:r,distance:i})}));const o=i/t.sampleNumber;let a=0;e.forEach((function(e,t,r){const n=e.distance-a;if(0===n)e.included=!0;else if(n>0){if(e.index){const i=r[t-1];a-i.distance<n?i.included=!0:e.included=!0}for(;e.distance>a;)a+=o}})),e.filter((e=>!e.included)).forEach((function(e){r[e.index]=null})),r=r.filter((e=>null!==e))}else if(e<t.sampleNumber){const a=function(e,t,r){const n=e[t-1],i=e[t],o=r+1;let a=n[0],s=n[1];const l=(i[0]-a)/o,c=(i[1]-s)/o,u=new Array(r+2);u[0]=t,u[1]=0;for(var h=2,d=u.length;h<d;h++)a+=l,s+=c,u[h]=[a,s];e.splice.apply(e,u)};let s=0;const l=r.map((function(e,t,r){let i=0;return t&&(i=n.A.Geometry.getDistance(r[t-1],e),s+=i),{index:t,distance:i}}));r=r.slice();const c=t.sampleNumber-e;let u=c,h=0;for(var i=0,o=l.length;u&&i<o;i++){const e=l[i];if(0!==e.distance){const t=Math.min(Math.round(c*e.distance/s),u)||1;u-=t,a(r,e.index+h,t),h+=t}}}}return r}},l=s},8370:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(797),i=r(9566),o=r(6546);class a extends i.A{STYLETYPE=n.A.geom.POLYGON;constructor(e,t){super(e,t),this.wrap.isNative(e)||this.wrap.createCircle(a.parseGeometry(e),t)}static parseGeometry(e){let t=e;Object.prototype.hasOwnProperty.call(e,"center")&&Object.prototype.hasOwnProperty.call(e,"radius")&&(t=[e.center,[e.center[0]+e.radius,e.center[1]]]);const r=t[0],n=t[1];if(Array.isArray(t)&&Array.isArray(r)&&!Number.isNaN(r[0])&&!Number.isNaN(r[1])&&Array.isArray(n)&&!Number.isNaN(n[0])&&!Number.isNaN(n[1]))return t;throw new Error("Coordinates not valid for circle")}setCoordinates(e){return e&&(e=a.parseGeometry(e)),super.setCoordinates.call(this,e)}getCenter(){return this.wrap.getGeometry()[0]}getRadius(e){const[t,r]=this.getCoordinates(e);return Math.hypot(r[0]-t[0],r[1]-t[1])}getCoords(){return this.getCoordinates()}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}getGeometryType(){return n.A.geom.CIRCLE}toPolygon(e=72){const t=this.getRadius(),r=this.getCenter(),n=new Array(e),i=2*Math.PI/e;let a=0;for(var s=0;s<e;s++)n[s]=[r[0]+t*Math.cos(a),r[1]+t*Math.sin(a)],a+=i;return new o.A([n],Object.assign({},this.options))}}const s=a},8447:function(e,t){var r,n=this&&this.__extends||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};function r(e){if(!e)return r.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var r=t,n=0;n<this.length;n++)r=e(r,this[n],n,this);return r});var t="";return("."+e).split(".").reduce((function(e,n,i,o){t?t+="."+n:t=n;var a=e["__"+t];return void 0===a&&(r.Logger.prototype=e,a=new r.Logger(t),e["__"+t]=a),a}),r.__)}!function(e){function t(e,t,r){void 0!==t[e]&&(null!==t[e]?r[e]=t[e]:delete r[e])}function r(t){if(null!=e.enabled&&!e.enabled)return!1;if(null!=e.maxMessages&&e.maxMessages<1)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!new RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function i(e,t){try{if(e.disallow&&new RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function o(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}e.requestId="";var a=function(e,t,r){this.msg=e,this.meta=t,this.finalString=r};function s(e){var t,r=o(e);switch(typeof r){case"string":return new a(r,null,r);case"number":case"boolean":return t=r.toString(),new a(t,null,t);case"undefined":return new a("undefined",null,"undefined");case"object":return r instanceof RegExp||r instanceof String||r instanceof Number||r instanceof Boolean?(t=r.toString(),new a(t,null,t)):new a(null,r,JSON.stringify(r));default:return new a("unknown",null,"unknown")}}function l(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"}e.setOptions=function(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),this},e.getAllLevel=function(){return-2147483648},e.getTraceLevel=function(){return 1e3},e.getDebugLevel=function(){return 2e3},e.getInfoLevel=function(){return 3e3},e.getWarnLevel=function(){return 4e3},e.getErrorLevel=function(){return 5e3},e.getFatalLevel=function(){return 6e3},e.getOffLevel=function(){return 2147483647};var c=function(e,t){this.inner=t,this.name="JL.Exception",this.message=s(e).finalString};e.Exception=c,c.prototype=new Error;var u=function(e,t,r,n){this.l=e,this.m=t,this.n=r,this.t=n};e.LogItem=u;var h=function(){function n(t,r){this.appenderName=t,this.sendLogItems=r,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.buffer=[],this.batchBuffer=[]}return n.prototype.setOptions=function(e){return t("level",e,this),t("ipRegex",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("sendWithBufferLevel",e,this),t("storeInBufferLevel",e,this),t("bufferSize",e,this),t("batchSize",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this},n.prototype.log=function(e,t,n,o,a,s,l){var c;r(this)&&i(this,s)&&(a<this.storeInBufferLevel||(c=new u(a,s,l,(new Date).getTime()),a<this.level?this.bufferSize>0&&(this.buffer.push(c),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||this.buffer.length&&(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(c),this.batchBuffer.length>=this.batchSize&&this.sendBatch())))},n.prototype.sendBatch=function(){0!=this.batchBuffer.length&&(null!=e.maxMessages&&e.maxMessages<1||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0))},n}();e.Appender=h;var d=function(r){function i(e){r.call(this,e,i.prototype.sendLogItemsAjax)}return n(i,r),i.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),r.prototype.setOptions.call(this,e),this},i.prototype.sendLogItemsAjax=function(t){try{var r="/jsnlog.logger";null!=e.defaultAjaxUrl&&(r=e.defaultAjaxUrl),this.url&&(r=this.url);var n=this.getXhr(r),i={r:e.requestId,lg:t};"function"==typeof this.beforeSend?this.beforeSend.call(this,n,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,n,i);var o=JSON.stringify(i);n.send(o)}catch(e){}},i.prototype.getXhr=function(t){var r=new XMLHttpRequest;if(!("withCredentials"in r)&&"undefined"!=typeof XDomainRequest){var n=new XDomainRequest;return n.open("POST",t),n}return r.open("POST",t),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("JSNLog-RequestId",e.requestId),r},i}(h);e.AjaxAppender=d;var p=function(t){function r(e){t.call(this,e,r.prototype.sendLogItemsConsole)}return n(r,t),r.prototype.clog=function(e){console.log(e)},r.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)},r.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)},r.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)},r.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)},r.prototype.sendLogItemsConsole=function(t){try{if(!console)return;var r;for(r=0;r<t.length;++r){var n=t[r],i=n.n+": "+n.m;"undefined"==typeof window&&(i=new Date(n.t)+" | "+i),n.l<=e.getDebugLevel()?this.cdebug(i):n.l<=e.getInfoLevel()?this.cinfo(i):n.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}catch(e){}},r}(h);e.ConsoleAppender=p;var g=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,n){var a,c,u=0;if(!this.appenders)return this;if(e>=this.level&&r(this)&&(n?(c=this.buildExceptionObject(n)).logData=o(t):c=t,i(this,(a=s(c)).finalString))){if(this.onceOnly)for(u=this.onceOnly.length-1;u>=0;){if(new RegExp(this.onceOnly[u]).test(a.finalString)){if(this.seenRegexes[u])return this;this.seenRegexes[u]=!0}u--}for(a.meta=a.meta||{},a.meta.loggerName=this.loggerName,u=this.appenders.length-1;u>=0;)this.appenders[u].log(l(e),a.msg,a.meta,(function(){}),e,a.finalString,this.loggerName),u--}return this},e.prototype.trace=function(e){return this.log(1e3,e)},e.prototype.debug=function(e){return this.log(2e3,e)},e.prototype.info=function(e){return this.log(3e3,e)},e.prototype.warn=function(e){return this.log(4e3,e)},e.prototype.error=function(e){return this.log(5e3,e)},e.prototype.fatal=function(e){return this.log(6e3,e)},e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)},e}();e.Logger=g,e.createAjaxAppender=function(e){return new d(e)},e.createConsoleAppender=function(e){return new p(e)};var f=new d("");"undefined"==typeof window&&(f=new p("")),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[f]})}(r||(r={})),t.JL=r,"function"==typeof __jsnlog_configure&&__jsnlog_configure(r)},8450:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});const n={PROPERTYCHANGE:"propertychange"}},8606:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(797),i=r(9566);class o extends i.A{STYLETYPE="line";constructor(e,t){super(e,t),this.wrap.isNative(e)||this.wrap.createPolyline(e,t)}setCoordinates(e){return Array.isArray(e)&&!Array.isArray(e[0])&&(e=[e]),super.setCoordinates.call(this,e)}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){return this.getCoordinates()}getLength(e){return this.wrap.getLength({coordinates:this.getCoordinates(e)})}getGeometryType(){return n.A.geom.POLYLINE}}const a=o},8609:(e,t,r)=>{"use strict";function n(e,t,r,n){let i=0;const o=e[r-n],a=e[r-n+1];let s=0,l=0;for(;t<r;t+=n){const r=e[t]-o,n=e[t+1]-a;i+=l*r-s*n,s=r,l=n}return i/2}function i(e,t,r,i){let o=0;for(let a=0,s=r.length;a<s;++a){const s=r[a];o+=n(e,t,s,i),t=s}return o}function o(e,t,r,n){let o=0;for(let a=0,s=r.length;a<s;++a){const s=r[a];o+=i(e,t,s,n),t=s[s.length-1]}return o}r.d(t,{Cs:()=>o,PK:()=>i,eN:()=>n})},8662:(e,t,r)=>{"use strict";r.d(t,{A:()=>v});var n=r(6514),i=r(915),o=r(1217),a=r(6702),s=r(2871),l=r(4142),c=r(7947),u=r(3942),h=r(8217),d=r(581),p=r(1386),g=r(7468);const f=p.M+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",m={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class y extends p.A{constructor(e){super(e=e||{}),this.surface_=void 0!==e.surface&&e.surface,this.curve_=void 0!==e.curve&&e.curve,this.multiCurve_=void 0===e.multiCurve||e.multiCurve,this.multiSurface_=void 0===e.multiSurface||e.multiSurface,this.schemaLocation=e.schemaLocation?e.schemaLocation:f,this.hasZ=void 0!==e.hasZ&&e.hasZ}readMultiCurve(e,t){const r=(0,u.eY)([],this.MULTICURVE_PARSERS,e,t,this);if(r)return new a.A(r)}readFlatCurveRing(e,t){const r=(0,u.eY)([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let e=0,t=r.length;e<t;++e)(0,n.X$)(i,r[e].getFlatCoordinates());return i}readMultiSurface(e,t){const r=(0,u.eY)([],this.MULTISURFACE_PARSERS,e,t,this);if(r)return new s.A(r)}curveMemberParser(e,t){(0,u.UN)(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){(0,u.UN)(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return(0,u.eY)([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return(0,u.eY)([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return(0,u.eY)([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return(0,u.eY)([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const r=(0,u.eY)(void 0,this.RING_PARSERS,e,t,this);r&&t[t.length-1].push(r)}exteriorParser(e,t){const r=(0,u.eY)(void 0,this.RING_PARSERS,e,t,this);r&&(t[t.length-1][0]=r)}readSurface(e,t){const r=(0,u.eY)([null],this.SURFACE_PARSERS,e,t,this);if(r&&r[0]){const e=r[0],t=[e.length];let i,o;for(i=1,o=r.length;i<o;++i)(0,n.X$)(e,r[i]),t.push(e.length);return new l.Ay(e,"XYZ",t)}}readCurve(e,t){const r=(0,u.eY)([null],this.CURVE_PARSERS,e,t,this);if(r)return new o.A(r,"XYZ")}readEnvelope(e,t){const r=(0,u.eY)([null],this.ENVELOPE_PARSERS,e,t,this);return(0,i.N)(r[1][0],r[1][1],r[2][0],r[2][1])}readFlatPos(e,t){let r=(0,u.mT)(e,!1);const n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,i=[];let o;for(;o=n.exec(r);)i.push(parseFloat(o[1])),r=r.substr(o[0].length);if(""!==r)return;const a=t[0].srsName;if("neu"===(a?(0,c.Jt)(a).getAxisOrientation():"enu"))for(let e=0,t=i.length;e<t;e+=3){const t=i[e],r=i[e+1];i[e]=r,i[e+1]=t}const s=i.length;return 2==s&&i.push(0),0!==s?i:void 0}readFlatPosList(e,t){const r=(0,u.mT)(e,!1).replace(/^\s*|\s*$/g,""),n=t[0],i=n.srsName,o=n.srsDimension,a=i?(0,c.Jt)(i).getAxisOrientation():"enu",s=r.split(/\s+/);let l=2;e.getAttribute("srsDimension")?l=(0,g._X)(e.getAttribute("srsDimension")):e.getAttribute("dimension")?l=(0,g._X)(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?l=(0,g._X)(e.parentNode.getAttribute("srsDimension")):o&&(l=(0,g._X)(o));const h=a.startsWith("en");let d,p,f;const m=[];for(let e=0,t=s.length;e<t;e+=l)d=parseFloat(s[e]),p=parseFloat(s[e+1]),f=3===l?parseFloat(s[e+2]):0,h?m.push(d,p,f):m.push(p,d,f);return m}writePos_(e,t,r){const n=r[r.length-1],i=n.hasZ,o=i?"3":"2";e.setAttribute("srsDimension",o);const a=n.srsName,s=a?(0,c.Jt)(a).getAxisOrientation():"enu",l=t.getCoordinates();let u=s.startsWith("en")?l[0]+" "+l[1]:l[1]+" "+l[0];i&&(u+=" "+(l[2]||0)),(0,g.uB)(e,u)}getCoords_(e,t,r){let n=(t?(0,c.Jt)(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];return r&&(n+=" "+(e[2]||0)),n}writePosList_(e,t,r){const n=r[r.length-1],i=n.hasZ,o=i?"3":"2";e.setAttribute("srsDimension",o);const a=n.srsName,s=t.getCoordinates(),l=s.length,c=new Array(l);let u;for(let e=0;e<l;++e)u=s[e],c[e]=this.getCoords_(u,a,i);(0,g.uB)(e,c.join(" "))}writePoint(e,t,r){const n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);const i=(0,u.qq)(e.namespaceURI,"pos");e.appendChild(i),this.writePos_(i,t,r)}writeEnvelope(e,t,r){const n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);const i=[t[0]+" "+t[1],t[2]+" "+t[3]];(0,u.NQ)({node:e},this.ENVELOPE_SERIALIZERS,u.OL,i,r,["lowerCorner","upperCorner"],this)}writeLinearRing(e,t,r){const n=r[r.length-1].srsName;n&&e.setAttribute("srsName",n);const i=(0,u.qq)(e.namespaceURI,"posList");e.appendChild(i),this.writePosList_(i,t,r)}RING_NODE_FACTORY_(e,t,r){const n=t[t.length-1],i=n.node,o=n.exteriorWritten;return void 0===o&&(n.exteriorWritten=!0),(0,u.qq)(i.namespaceURI,void 0!==o?"interior":"exterior")}writeSurfaceOrPolygon(e,t,r){const n=r[r.length-1],i=n.hasZ,o=n.srsName;if("PolygonPatch"!==e.nodeName&&o&&e.setAttribute("srsName",o),"Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){const n=t.getLinearRings();(0,u.NQ)({node:e,hasZ:i,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,n,r,void 0,this)}else if("Surface"===e.nodeName){const n=(0,u.qq)(e.namespaceURI,"patches");e.appendChild(n),this.writeSurfacePatches_(n,t,r)}}writeCurveOrLineString(e,t,r){const n=r[r.length-1].srsName;if("LineStringSegment"!==e.nodeName&&n&&e.setAttribute("srsName",n),"LineString"===e.nodeName||"LineStringSegment"===e.nodeName){const n=(0,u.qq)(e.namespaceURI,"posList");e.appendChild(n),this.writePosList_(n,t,r)}else if("Curve"===e.nodeName){const n=(0,u.qq)(e.namespaceURI,"segments");e.appendChild(n),this.writeCurveSegments_(n,t,r)}}writeMultiSurfaceOrPolygon(e,t,r){const n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.surface;o&&e.setAttribute("srsName",o);const s=t.getPolygons();(0,u.NQ)({node:e,hasZ:i,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)}writeMultiPoint(e,t,r){const n=r[r.length-1],i=n.srsName,o=n.hasZ;i&&e.setAttribute("srsName",i);const a=t.getPoints();(0,u.NQ)({node:e,hasZ:o,srsName:i},this.POINTMEMBER_SERIALIZERS,(0,u.X1)("pointMember"),a,r,void 0,this)}writeMultiCurveOrLineString(e,t,r){const n=r[r.length-1],i=n.hasZ,o=n.srsName,a=n.curve;o&&e.setAttribute("srsName",o);const s=t.getLineStrings();(0,u.NQ)({node:e,hasZ:i,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,s,r,void 0,this)}writeRing(e,t,r){const n=(0,u.qq)(e.namespaceURI,"LinearRing");e.appendChild(n),this.writeLinearRing(n,t,r)}writeSurfaceOrPolygonMember(e,t,r){const n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r))}writePointMember(e,t,r){const n=(0,u.qq)(e.namespaceURI,"Point");e.appendChild(n),this.writePoint(n,t,r)}writeLineStringOrCurveMember(e,t,r){const n=this.GEOMETRY_NODE_FACTORY_(t,r);n&&(e.appendChild(n),this.writeCurveOrLineString(n,t,r))}writeSurfacePatches_(e,t,r){const n=(0,u.qq)(e.namespaceURI,"PolygonPatch");e.appendChild(n),this.writeSurfaceOrPolygon(n,t,r)}writeCurveSegments_(e,t,r){const n=(0,u.qq)(e.namespaceURI,"LineStringSegment");e.appendChild(n),this.writeCurveOrLineString(n,t,r)}writeGeometryElement(e,t,r){const n=r[r.length-1],i=Object.assign({},n);let o;i.node=e,o=Array.isArray(t)?(0,h.zU)(t,n):(0,h.hX)(t,!0,n),(0,u.NQ)(i,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],r,void 0,this)}writeFeatureElement(e,t,r){const n=t.getId();n&&e.setAttribute("fid",n);const i=r[r.length-1],o=i.featureNS,a=t.getGeometryName();i.serializers||(i.serializers={},i.serializers[o]={});const s=[],l=[];if(t.hasProperties()){const e=t.getProperties();for(const t in e){const r=e[t];null!=r&&(s.push(t),l.push(r),t==a||"function"==typeof r.getSimplifiedGeometry?t in i.serializers[o]||(i.serializers[o][t]=(0,u.mm)(this.writeGeometryElement,this)):t in i.serializers[o]||(i.serializers[o][t]=(0,u.mm)(g.uB)))}}const c=Object.assign({},i);c.node=e,(0,u.NQ)(c,i.serializers,(0,u.X1)(void 0,o),l,r,s)}writeFeatureMembers_(e,t,r){const n=r[r.length-1],i=n.featureType,o=n.featureNS,a={};a[o]={},a[o][i]=(0,u.mm)(this.writeFeatureElement,this);const s=Object.assign({},n);s.node=e,(0,u.NQ)(s,a,(0,u.X1)(i,o),t,r)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,r){const n=t[t.length-1].node;return(0,u.qq)(this.namespace,m[n.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,r){const n=t[t.length-1],i=n.multiSurface,o=n.surface,a=n.curve,s=n.multiCurve;return Array.isArray(e)?r="Envelope":"MultiPolygon"===(r=e.getType())&&!0===i?r="MultiSurface":"Polygon"===r&&!0===o?r="Surface":"LineString"===r&&!0===a?r="Curve":"MultiLineString"===r&&!0===s&&(r="MultiCurve"),(0,u.qq)(this.namespace,r)}writeGeometryNode(e,t){t=this.adaptOptions(t);const r=(0,u.qq)(this.namespace,"geom"),n={node:r,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(n,t),this.writeGeometryElement(r,e,[n]),r}writeFeaturesNode(e,t){t=this.adaptOptions(t);const r=(0,u.qq)(this.namespace,"featureMembers");r.setAttributeNS(u.pF,"xsi:schemaLocation",this.schemaLocation);const n={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(n,t),this.writeFeatureMembers_(r,e,[n]),r}}y.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:(0,u.Tb)(y.prototype.readFlatPos),posList:(0,u.Tb)(y.prototype.readFlatPosList),coordinates:(0,u.Tb)(d.A.prototype.readFlatCoordinates)}},y.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:y.prototype.interiorParser,exterior:y.prototype.exteriorParser}},y.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:(0,u.Tb)(p.A.prototype.readPoint),MultiPoint:(0,u.Tb)(p.A.prototype.readMultiPoint),LineString:(0,u.Tb)(p.A.prototype.readLineString),MultiLineString:(0,u.Tb)(p.A.prototype.readMultiLineString),LinearRing:(0,u.Tb)(p.A.prototype.readLinearRing),Polygon:(0,u.Tb)(p.A.prototype.readPolygon),MultiPolygon:(0,u.Tb)(p.A.prototype.readMultiPolygon),Surface:(0,u.Tb)(y.prototype.readSurface),MultiSurface:(0,u.Tb)(y.prototype.readMultiSurface),Curve:(0,u.Tb)(y.prototype.readCurve),MultiCurve:(0,u.Tb)(y.prototype.readMultiCurve),Envelope:(0,u.Tb)(y.prototype.readEnvelope)}},y.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:(0,u.VT)(y.prototype.curveMemberParser),curveMembers:(0,u.VT)(y.prototype.curveMemberParser)}},y.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:(0,u.VT)(y.prototype.surfaceMemberParser),surfaceMembers:(0,u.VT)(y.prototype.surfaceMemberParser)}},y.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:(0,u.VT)(p.A.prototype.readLineString),Curve:(0,u.VT)(y.prototype.readCurve)}},y.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:(0,u.VT)(p.A.prototype.readPolygon),Surface:(0,u.VT)(y.prototype.readSurface)}},y.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:(0,u.Tb)(y.prototype.readPatch)}},y.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:(0,u.Tb)(y.prototype.readSegment)}},y.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:(0,u.VT)(y.prototype.readFlatPosList),upperCorner:(0,u.VT)(y.prototype.readFlatPosList)}},y.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:(0,u.Tb)(y.prototype.readPolygonPatch)}},y.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:(0,u.Vh)(y.prototype.readLineStringSegment)}},p.A.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:(0,u.Tb)(p.A.prototype.readFlatLinearRing),Ring:(0,u.Tb)(y.prototype.readFlatCurveRing)}},y.prototype.writeFeatures,y.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:(0,u.mm)(y.prototype.writeRing),interior:(0,u.mm)(y.prototype.writeRing)}},y.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:(0,u.mm)(g.uB),upperCorner:(0,u.mm)(g.uB)}},y.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:(0,u.mm)(y.prototype.writeSurfaceOrPolygonMember),polygonMember:(0,u.mm)(y.prototype.writeSurfaceOrPolygonMember)}},y.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:(0,u.mm)(y.prototype.writePointMember)}},y.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:(0,u.mm)(y.prototype.writeLineStringOrCurveMember),curveMember:(0,u.mm)(y.prototype.writeLineStringOrCurveMember)}},y.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:(0,u.mm)(y.prototype.writeCurveOrLineString),MultiCurve:(0,u.mm)(y.prototype.writeMultiCurveOrLineString),Point:(0,u.mm)(y.prototype.writePoint),MultiPoint:(0,u.mm)(y.prototype.writeMultiPoint),LineString:(0,u.mm)(y.prototype.writeCurveOrLineString),MultiLineString:(0,u.mm)(y.prototype.writeMultiCurveOrLineString),LinearRing:(0,u.mm)(y.prototype.writeLinearRing),Polygon:(0,u.mm)(y.prototype.writeSurfaceOrPolygon),MultiPolygon:(0,u.mm)(y.prototype.writeMultiSurfaceOrPolygon),Surface:(0,u.mm)(y.prototype.writeSurfaceOrPolygon),MultiSurface:(0,u.mm)(y.prototype.writeMultiSurfaceOrPolygon),Envelope:(0,u.mm)(y.prototype.writeEnvelope)}};const v=y},8673:(e,t,r)=>{"use strict";r.d(t,{Ig:()=>o,NU:()=>s});var n=r(5286);const i=[-180,-90,180,90],o=6378137*Math.PI/180;class a extends n.A{constructor(e,t){super({code:e,units:"degrees",extent:i,axisOrientation:t,global:!0,metersPerUnit:o,worldExtent:i})}}const s=[new a("CRS:84"),new a("EPSG:4326","neu"),new a("urn:ogc:def:crs:OGC:1.3:CRS84"),new a("urn:ogc:def:crs:OGC:2:84"),new a("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new a("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new a("http://www.opengis.net/def/crs/EPSG/0/4326","neu")]},8721:(e,t,r)=>{"use strict";r.d(t,{A:()=>ar});var n=6378137,i=.0066943799901413165,o=484813681109536e-20,a=Math.PI/2,s=1e-10,l=.017453292519943295,c=57.29577951308232,u=Math.PI/4,h=2*Math.PI,d=3.14159265359,p={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};const g={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.01},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var f=/[\s_\-\/\(\)]/g;function m(e,t){if(e[t])return e[t];for(var r,n=Object.keys(e),i=t.toLowerCase().replace(f,""),o=-1;++o<n.length;)if((r=n[o]).toLowerCase().replace(f,"")===i)return e[r]}function y(e){var t,r,n,i={},o=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e}),{}),a={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*l},lat_1:function(e){i.lat1=e*l},lat_2:function(e){i.lat2=e*l},lat_ts:function(e){i.lat_ts=e*l},lon_0:function(e){i.long0=e*l},lon_1:function(e){i.long1=e*l},lon_2:function(e){i.long2=e*l},alpha:function(e){i.alpha=parseFloat(e)*l},gamma:function(e){i.rectified_grid_angle=parseFloat(e)},lonc:function(e){i.longc=e*l},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r:function(e){i.a=i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=m(g,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*l},pm:function(e){var t=m(p,e);i.from_greenwich=(t||parseFloat(e))*l},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(i.axis=e)},approx:function(){i.approx=!0}};for(t in o)r=o[t],t in a?"function"==typeof(n=a[t])?n(r):i[n]=r:i[t]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}var v=1,A=/\s/,S=/[A-Za-z]/,E=/[A-Za-z84_]/,w=/[,\]]/,_=/[\d\.E\-\+]/;function L(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=v}function C(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var n=t?{}:e,i=r.reduce((function(e,t){return b(t,e),e}),n);t&&(e[t]=i)}function b(e,t){if(Array.isArray(e)){var r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void b(e[0],t[r])):void(t[r]=e[0]);if(e.length)if("TOWGS84"!==r){if("AXIS"===r)return r in t||(t[r]=[]),void t[r].push(e);var n;switch(Array.isArray(r)||(t[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&b(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&b(e[3],t[r]));case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":return e[0]=["name",e[0]],void C(t,r,e);case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":return e[0]=["name",e[0]],C(t,r,e),void(t[r].type=r);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return b(e,t[r]);return C(t,r,e)}}else t[r]=e;else t[r]=!0}else t[e]=!0}L.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;A.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case v:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},L.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(w.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},L.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=v)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=v,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},L.prototype.number=function(e){if(!_.test(e)){if(w.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},L.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},L.prototype.keyword=function(e){if(E.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=v)}if(!w.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},L.prototype.neutral=function(e){if(S.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(_.test(e))return this.word=e,void(this.state=3);if(!w.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},L.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var T=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function x(e){return.017453292519943295*e}function P(e){for(var t=Object.keys(e),r=0,n=t.length;r<n;++r){var i=t[r];-1!==T.indexOf(i)&&M(e[i]),"object"==typeof e[i]&&P(e[i])}}function M(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",n=0,i=e.AXIS.length;n<i;++n){var o=[e.AXIS[n][0].toLowerCase(),e.AXIS[n][1].toLowerCase()];-1!==o[0].indexOf("north")||("y"===o[0]||"lat"===o[0])&&"north"===o[1]?r+="n":-1!==o[0].indexOf("south")||("y"===o[0]||"lat"===o[0])&&"south"===o[1]?r+="s":-1!==o[0].indexOf("east")||("x"===o[0]||"lon"===o[0])&&"east"===o[1]?r+="e":-1===o[0].indexOf("west")&&("x"!==o[0]&&"lon"!==o[0]||"west"!==o[1])||(r+="w")}2===r.length&&(r+="u"),3===r.length&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var a=e.GEOGCS;function s(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(a=e),a&&(a.DATUM?e.datumCode=a.DATUM.name.toLowerCase():e.datumCode=a.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_1949"===e.datumCode&&(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"belge_1972"===e.datumCode&&(e.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(e.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=a.DATUM.SPHEROID.a,e.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(e.datum_params=a.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",x],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",x],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",x],["lat0","latitude_of_origin",x],["lat0","standard_parallel_1",x],["lat1","standard_parallel_1",x],["lat2","standard_parallel_2",x],["azimuth","Azimuth"],["alpha","azimuth",x],["srsCode","name"]].forEach((function(t){return function(e,t){var r=t[0],n=t[1];!(r in e)&&n in e&&(e[r]=e[n],3===t.length&&(e[r]=t[2](e[r])))}(e,t)})),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName?!e.lat_ts&&e.lat0&&"Polar_Stereographic"===e.projName&&(e.lat_ts=e.lat0,e.lat0=x(e.lat0>0?90:-90)):(e.lat0=x(e.lat1>0?90:-90),e.lat_ts=e.lat1)}function I(e){var t=new L(e).output(),r=t[0],n={};return b(t,n),P(n),n[r]}function R(e){var t=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?R[e]=y(arguments[1]):R[e]=I(arguments[1]):R[e]=r}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){Array.isArray(e)?R.apply(t,e):R(e)}));if("string"==typeof e){if(e in R)return R[e]}else"EPSG"in e?R["EPSG:"+e.EPSG]=e:"ESRI"in e?R["ESRI:"+e.ESRI]=e:"IAU2000"in e?R["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(R);const O=R;var D=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],N=["3857","900913","3785","102113"];function k(e,t){var r,n;if(e=e||{},!t)return e;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e}function F(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)}function G(e){return e<0?-1:1}function B(e){return Math.abs(e)<=d?e:e-G(e)*h}function U(e,t,r){var n=e*r,i=.5*e;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(a-t))/n}function q(e,t){for(var r,n,i=.5*e,o=a-2*Math.atan(t),s=0;s<=15;s++)if(r=e*Math.sin(o),o+=n=a-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-o,Math.abs(n)<=1e-10)return o;return-9999}function W(e){return e}var H=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=F(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,r,n=e.x,i=e.y;if(i*c>90&&i*c<-90&&n*c>180&&n*c<-180)return null;if(Math.abs(Math.abs(i)-a)<=s)return null;if(this.sphere)t=this.x0+this.a*this.k0*B(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(u+.5*i));else{var o=Math.sin(i),l=U(this.e,i,o);t=this.x0+this.a*this.k0*B(n-this.long0),r=this.y0-this.a*this.k0*Math.log(l)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=a-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var o=Math.exp(-i/(this.a*this.k0));if(-9999===(r=q(this.e,o)))return null}return t=B(this.long0+n/(this.a*this.k0)),e.x=t,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:W,inverse:W,names:["longlat","identity"]}],j={},V=[];function z(e,t){var r=V.length;return e.names?(V[r]=e,e.names.forEach((function(e){j[e.toLowerCase()]=r})),this):(console.log(t),!0)}const Y={start:function(){H.forEach(z)},add:z,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==j[t]&&V[j[t]]?V[j[t]]:void 0}};var $={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},K=$.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};$.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var X={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};for(var Z in X){var J=X[Z];X[J.datumName]=J}const Q=X;var ee={};function te(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:ee[e]||null,isNull:!1}}function re(e){return e/3600*Math.PI/180}function ne(e,t,r){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,r)))}function ie(e){return e.map((function(e){return[re(e.longitudeShift),re(e.latitudeShift)]}))}function oe(e,t,r){return{name:ne(e,t+8,t+16).trim(),parent:ne(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,r),upperLatitude:e.getFloat64(t+88,r),lowerLongitude:e.getFloat64(t+104,r),upperLongitude:e.getFloat64(t+120,r),latitudeInterval:e.getFloat64(t+136,r),longitudeInterval:e.getFloat64(t+152,r),gridNodeCount:e.getInt32(t+168,r)}}function ae(e,t,r,n){for(var i=t+176,o=[],a=0;a<r.gridNodeCount;a++){var s={latitudeShift:e.getFloat32(i+16*a,n),longitudeShift:e.getFloat32(i+16*a+4,n),latitudeAccuracy:e.getFloat32(i+16*a+8,n),longitudeAccuracy:e.getFloat32(i+16*a+12,n)};o.push(s)}return o}function se(e,t){if(!(this instanceof se))return new se(e);t=t||function(e){if(e)throw e};var r=function(e){if(!function(e){return"string"==typeof e}(e))return e;if(function(e){return e in O}(e))return O[e];if(function(e){return D.some((function(t){return e.indexOf(t)>-1}))}(e)){var t=I(e);if(function(e){var t=m(e,"authority");if(t){var r=m(t,"epsg");return r&&N.indexOf(r)>-1}}(t))return O["EPSG:3857"];var r=function(e){var t=m(e,"extension");if(t)return m(t,"proj4")}(t);return r?y(r):t}return function(e){return"+"===e[0]}(e)?y(e):void 0}(e);if("object"==typeof r){var n=se.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=m(Q,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var a,l,c,u,h,d,p=function(e,t,r,n,i){if(!e){var o=m($,n);o||(o=K),e=o.a,t=o.b,r=o.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<s)&&(i=!0,t=e),{a:e,b:t,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),g=(a=p.a,l=p.b,p.rf,h=((c=a*a)-(u=l*l))/c,d=0,r.R_A?(c=(a*=1-h*(.16666666666666666+h*(.04722222222222222+.022156084656084655*h)))*a,h=0):d=Math.sqrt(h),{es:h,e:d,ep2:(c-u)/u}),f=function(e){return void 0===e?null:e.split(",").map(te)}(r.nadgrids),v=r.datum||function(e,t,r,n,i,a,s){var l={};return l.datum_type=void 0===e||"none"===e?5:4,t&&(l.datum_params=t.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=1),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=2,l.datum_params[3]*=o,l.datum_params[4]*=o,l.datum_params[5]*=o,l.datum_params[6]=l.datum_params[6]/1e6+1))),s&&(l.datum_type=3,l.grids=s),l.a=r,l.b=n,l.es=i,l.ep2=a,l}(r.datumCode,r.datum_params,p.a,p.b,g.es,g.ep2,f);k(this,r),k(this,n),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=g.es,this.e=g.e,this.ep2=g.ep2,this.datum=v,this.init(),t(null,this)}else t("Could not get projection name from: "+e)}else t("Could not parse to valid json: "+e)}se.projections=Y,se.projections.start();const le=se;function ce(e,t,r){var n,i,o,s,l=e.x,c=e.y,u=e.z?e.z:0;if(c<-a&&c>-1.001*a)c=-a;else if(c>a&&c<1.001*a)c=a;else{if(c<-a)return{x:-1/0,y:-1/0,z:e.z};if(c>a)return{x:1/0,y:1/0,z:e.z}}return l>Math.PI&&(l-=2*Math.PI),i=Math.sin(c),s=Math.cos(c),o=i*i,{x:((n=r/Math.sqrt(1-t*o))+u)*s*Math.cos(l),y:(n+u)*s*Math.sin(l),z:(n*(1-t)+u)*i}}function ue(e,t,r,n){var i,o,a,s,l,c,u,h,d,p,g,f,m,y,v,A=e.x,S=e.y,E=e.z?e.z:0;if(i=Math.sqrt(A*A+S*S),o=Math.sqrt(A*A+S*S+E*E),i/r<1e-12){if(y=0,o/r<1e-12)return v=-n,{x:e.x,y:e.y,z:e.z}}else y=Math.atan2(S,A);a=E/o,h=(s=i/o)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*s*s)),d=a*l,m=0;do{m++,c=t*(u=r/Math.sqrt(1-t*d*d))/(u+(v=i*h+E*d-u*(1-t*d*d))),f=(g=a*(l=1/Math.sqrt(1-c*(2-c)*s*s)))*h-(p=s*(1-c)*l)*d,h=p,d=g}while(f*f>1e-24&&m<30);return{x:y,y:Math.atan(g/Math.abs(p)),z:v}}function he(e){return 1===e||2===e}function de(e,t,r){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},o=[];e:for(var a=0;a<e.grids.length;a++){var s=e.grids[a];if(o.push(s.name),s.isNull){i=n;break}if(s.mandatory,null!==s.grid)for(var l=s.grid.subgrids,u=0,h=l.length;u<h;u++){var d=l[u],p=(Math.abs(d.del[1])+Math.abs(d.del[0]))/1e4,g=d.ll[0]-p,f=d.ll[1]-p,m=d.ll[0]+(d.lim[0]-1)*d.del[0]+p,y=d.ll[1]+(d.lim[1]-1)*d.del[1]+p;if(!(f>n.y||g>n.x||y<n.y||m<n.x||(i=pe(n,t,d),isNaN(i.x))))break e}else if(s.mandatory)return console.log("Unable to find mandatory grid '"+s.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*c+" "+n.y*c+" tried: '"+o+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function pe(e,t,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return n;var i={x:e.x,y:e.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=B(i.x-Math.PI)+Math.PI;var o=ge(i,r);if(t){if(isNaN(o.x))return n;o.x=i.x-o.x,o.y=i.y-o.y;var a,s,l=9;do{if(s=ge(o,r),isNaN(s.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}a={x:i.x-(s.x+o.x),y:i.y-(s.y+o.y)},o.x+=a.x,o.y+=a.y}while(l--&&Math.abs(a.x)>1e-12&&Math.abs(a.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=B(o.x+r.ll[0]),n.y=o.y+r.ll[1]}else isNaN(o.x)||(n.x=e.x+o.x,n.y=e.y+o.y);return n}function ge(e,t){var r,n={x:e.x/t.del[0],y:e.y/t.del[1]},i=Math.floor(n.x),o=Math.floor(n.y),a=n.x-1*i,s=n.y-1*o,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=t.lim[0])return l;if(o<0||o>=t.lim[1])return l;r=o*t.lim[0]+i;var c=t.cvs[r][0],u=t.cvs[r][1];r++;var h=t.cvs[r][0],d=t.cvs[r][1];r+=t.lim[0];var p=t.cvs[r][0],g=t.cvs[r][1];r--;var f=t.cvs[r][0],m=t.cvs[r][1],y=a*s,v=a*(1-s),A=(1-a)*(1-s),S=(1-a)*s;return l.x=A*c+v*h+S*f+y*p,l.y=A*u+v*d+S*m+y*g,l}function fe(e,t,r){var n,i,o,a=r.x,s=r.y,l=r.z||0,c={};for(o=0;o<3;o++)if(!t||2!==o||void 0!==r.z)switch(0===o?(n=a,i=-1!=="ew".indexOf(e.axis[o])?"x":"y"):1===o?(n=s,i=-1!=="ns".indexOf(e.axis[o])?"y":"x"):(n=l,i="z"),e.axis[o]){case"e":case"n":c[i]=n;break;case"w":case"s":c[i]=-n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c}function me(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function ye(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function ve(e,t,r,o){var a,s=void 0!==(r=Array.isArray(r)?me(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(e){ye(e.x),ye(e.y)}(r),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type||3===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type||3===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(r=ve(e,a=new le("WGS84"),r,o),e=a),o&&"enu"!==e.axis&&(r=fe(e,!1,r)),"longlat"===e.projName)r={x:r.x*l,y:r.y*l,z:r.z||0};else if(e.to_meter&&(r={x:r.x*e.to_meter,y:r.y*e.to_meter,z:r.z||0}),!(r=e.inverse(r)))return;if(e.from_greenwich&&(r.x+=e.from_greenwich),r=function(e,t,r){if(function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t))return r;if(5===e.datum_type||5===t.datum_type)return r;var o=e.a,a=e.es;if(3===e.datum_type){if(0!==de(e,!1,r))return;o=n,a=i}var s=t.a,l=t.b,c=t.es;return 3===t.datum_type&&(s=n,l=6356752.314,c=i),a!==c||o!==s||he(e.datum_type)||he(t.datum_type)?(r=ce(r,a,o),he(e.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6];return{x:c*(e.x-l*e.y+s*e.z)+n,y:c*(l*e.x+e.y-a*e.z)+i,z:c*(-s*e.x+a*e.y+e.z)+o}}}(r,e.datum_type,e.datum_params)),he(t.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(2===t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],c=r[6],u=(e.x-n)/c,h=(e.y-i)/c,d=(e.z-o)/c;return{x:u+l*h-s*d,y:-l*u+h+a*d,z:s*u-a*h+d}}}(r,t.datum_type,t.datum_params)),r=ue(r,c,s,l),3!==t.datum_type||0===de(t,!0,r)?r:void 0):r}(e.datum,t.datum,r))return t.from_greenwich&&(r={x:r.x-t.from_greenwich,y:r.y,z:r.z||0}),"longlat"===t.projName?r={x:r.x*c,y:r.y*c,z:r.z||0}:(r=t.forward(r),t.to_meter&&(r={x:r.x/t.to_meter,y:r.y/t.to_meter,z:r.z||0})),o&&"enu"!==t.axis?fe(t,!0,r):(r&&!s&&delete r.z,r)}var Ae=le("WGS84");function Se(e,t,r,n){var i,o,a;return Array.isArray(r)?(i=ve(e,t,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.slice(3)):[i.x,i.y,r[2]].concat(r.slice(3)):[i.x,i.y].concat(r.slice(2)):[i.x,i.y]):(o=ve(e,t,r,n),2===(a=Object.keys(r)).length||a.forEach((function(n){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;o[n]=r[n]})),o)}function Ee(e){return e instanceof le?e:e.oProj?e.oProj:le(e)}const we=function(e,t,r){e=Ee(e);var n,i=!1;return void 0===t?(t=e,e=Ae,i=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,t=e,e=Ae,i=!0),t=Ee(t),r?Se(e,t,r):(n={forward:function(r,n){return Se(e,t,r,n)},inverse:function(r,n){return Se(t,e,r,n)}},i&&(n.oProj=t),n)};var _e="AJSAJS",Le="AFAFAF",Ce=65,be=73,Te=79;const xe={forward:Pe,inverse:function(e){var t=Oe(Ne(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:Me};function Pe(e,t){return t=t||5,function(e,t){var r,n,i,o,a,s,l,c,u,h,d,p="00000"+e.easting,g="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(u=e.easting,h=e.northing,d=De(e.zoneNumber),r=Math.floor(u/1e5),n=Math.floor(h/1e5)%20,o=_e.charCodeAt(i=d-1),a=Le.charCodeAt(i),c=!1,(s=o+r-1)>90&&(s=s-90+Ce-1,c=!0),(s===be||o<be&&s>be||(s>be||o<be)&&c)&&s++,(s===Te||o<Te&&s>Te||(s>Te||o<Te)&&c)&&++s===be&&s++,s>90&&(s=s-90+Ce-1),(l=a+n)>86?(l=l-86+Ce-1,c=!0):c=!1,(l===be||a<be&&l>be||(l>be||a<be)&&c)&&l++,(l===Te||a<Te&&l>Te||(l>Te||a<Te)&&c)&&++l===be&&l++,l>86&&(l=l-86+Ce-1),String.fromCharCode(s)+String.fromCharCode(l))+p.substr(p.length-5,t)+g.substr(g.length-5,t)}(function(e){var t,r,n,i,o,a,s,l=e.lat,c=e.lon,u=6378137,h=.00669438,d=.9996,p=Ie(l),g=Ie(c);s=Math.floor((c+180)/6)+1,180===c&&(s=60),l>=56&&l<64&&c>=3&&c<12&&(s=32),l>=72&&l<84&&(c>=0&&c<9?s=31:c>=9&&c<21?s=33:c>=21&&c<33?s=35:c>=33&&c<42&&(s=37)),a=Ie(6*(s-1)-180+3),t=.006739496752268451,r=u/Math.sqrt(1-h*Math.sin(p)*Math.sin(p)),n=Math.tan(p)*Math.tan(p),i=t*Math.cos(p)*Math.cos(p);var f,m,y=d*r*((o=Math.cos(p)*(g-a))+(1-n+i)*o*o*o/6+(5-18*n+n*n+72*i-58*t)*o*o*o*o*o/120)+5e5,v=d*(u*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-3.418046101696858e-9*Math.sin(6*p))+r*Math.tan(p)*(o*o/2+(5-n+9*i+4*i*i)*o*o*o*o/24+(61-58*n+n*n+600*i-2.2240339282485886)*o*o*o*o*o*o/720));return l<0&&(v+=1e7),{northing:Math.round(v),easting:Math.round(y),zoneNumber:s,zoneLetter:(f=l,m="Z",84>=f&&f>=72?m="X":72>f&&f>=64?m="W":64>f&&f>=56?m="V":56>f&&f>=48?m="U":48>f&&f>=40?m="T":40>f&&f>=32?m="S":32>f&&f>=24?m="R":24>f&&f>=16?m="Q":16>f&&f>=8?m="P":8>f&&f>=0?m="N":0>f&&f>=-8?m="M":-8>f&&f>=-16?m="L":-16>f&&f>=-24?m="K":-24>f&&f>=-32?m="J":-32>f&&f>=-40?m="H":-40>f&&f>=-48?m="G":-48>f&&f>=-56?m="F":-56>f&&f>=-64?m="E":-64>f&&f>=-72?m="D":-72>f&&f>=-80&&(m="C"),m)}}({lat:e[1],lon:e[0]}),t)}function Me(e){var t=Oe(Ne(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Ie(e){return e*(Math.PI/180)}function Re(e){return e/Math.PI*180}function Oe(e){var t=e.northing,r=e.easting,n=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var o,a,s,l,c,u,h,d,p,g=.9996,f=6378137,m=.00669438,y=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),v=r-5e5,A=t;n<"N"&&(A-=1e7),h=6*(i-1)-180+3,o=.006739496752268451,p=(d=A/g/6367449.145945056)+(3*y/2-27*y*y*y/32)*Math.sin(2*d)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*d)+151*y*y*y/96*Math.sin(6*d),a=f/Math.sqrt(1-m*Math.sin(p)*Math.sin(p)),s=Math.tan(p)*Math.tan(p),l=o*Math.cos(p)*Math.cos(p),c=.99330562*f/Math.pow(1-m*Math.sin(p)*Math.sin(p),1.5),u=v/(a*g);var S=p-a*Math.tan(p)/c*(u*u/2-(5+3*s+10*l-4*l*l-9*o)*u*u*u*u/24+(61+90*s+298*l+45*s*s-1.6983531815716497-3*l*l)*u*u*u*u*u*u/720);S=Re(S);var E,w=(u-(1+2*s+l)*u*u*u/6+(5-2*l+28*s-3*l*l+8*o+24*s*s)*u*u*u*u*u/120)/Math.cos(p);if(w=h+Re(w),e.accuracy){var _=Oe({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});E={top:_.lat,right:_.lon,bottom:S,left:w}}else E={lat:S,lon:w};return E}function De(e){var t=e%6;return 0===t&&(t=6),t}function Ne(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,n=null,i="",o=0;!/[A-Z]/.test(t=e.charAt(o));){if(o>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,o++}var a=parseInt(i,10);if(0===o||o+3>r)throw"MGRSPoint bad conversion from: "+e;var s=e.charAt(o++);if(s<="A"||"B"===s||"Y"===s||s>="Z"||"I"===s||"O"===s)throw"MGRSPoint zone letter "+s+" not handled: "+e;n=e.substring(o,o+=2);for(var l=De(a),c=function(e,t){for(var r=_e.charCodeAt(t-1),n=1e5,i=!1;r!==e.charCodeAt(0);){if(++r===be&&r++,r===Te&&r++,r>90){if(i)throw"Bad character: "+e;r=Ce,i=!0}n+=1e5}return n}(n.charAt(0),l),u=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var r=Le.charCodeAt(t-1),n=0,i=!1;r!==e.charCodeAt(0);){if(++r===be&&r++,r===Te&&r++,r>86){if(i)throw"Bad character: "+e;r=Ce,i=!0}n+=1e5}return n}(n.charAt(1),l);u<ke(s);)u+=2e6;var h=r-o;if(h%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,p,g,f=h/2,m=0,y=0;return f>0&&(d=1e5/Math.pow(10,f),p=e.substring(o,o+f),m=parseFloat(p)*d,g=e.substring(o+f),y=parseFloat(g)*d),{easting:m+c,northing:y+u,zoneLetter:s,zoneNumber:a,accuracy:d}}function ke(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function Fe(e,t,r){if(!(this instanceof Fe))return new Fe(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Fe.fromMGRS=function(e){return new Fe(Me(e))},Fe.prototype.toMGRS=function(e){return Pe([this.x,this.y],e)};const Ge=Fe;var Be=.046875,Ue=.01953125,qe=.01068115234375;function We(e){var t=[];t[0]=1-e*(.25+e*(Be+e*(Ue+e*qe))),t[1]=e*(.75-e*(Be+e*(Ue+e*qe)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t}function He(e,t,r,n){return r*=t,t*=t,n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}function je(e,t,r){for(var n=1/(1-t),i=e,o=20;o;--o){var a=Math.sin(i),l=1-t*a*a;if(i-=l=(He(i,a,Math.cos(i),r)-e)*(l*Math.sqrt(l))*n,Math.abs(l)<s)return i}return i}const Ve={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=We(this.es),this.ml0=He(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,r,n,i=e.x,o=e.y,a=B(i-this.long0),l=Math.sin(o),c=Math.cos(o);if(this.es){var u=c*a,h=Math.pow(u,2),d=this.ep2*Math.pow(c,2),p=Math.pow(d,2),g=Math.abs(c)>s?Math.tan(o):0,f=Math.pow(g,2),m=Math.pow(f,2);t=1-this.es*Math.pow(l,2),u/=Math.sqrt(t);var y=He(o,l,c,this.en);r=this.a*(this.k0*u*(1+h/6*(1-f+d+h/20*(5-18*f+m+14*d-58*f*d+h/42*(61+179*m-m*f-479*f)))))+this.x0,n=this.a*(this.k0*(y-this.ml0+l*a*u/2*(1+h/12*(5-f+9*d+4*p+h/30*(61+m-58*f+270*d-330*f*d+h/56*(1385+543*m-m*f-3111*f))))))+this.y0}else{var v=c*Math.sin(a);if(Math.abs(Math.abs(v)-1)<s)return 93;if(r=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=c*Math.cos(a)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>s)return 93;n=0}else n=Math.acos(n);o<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=r,e.y=n,e},inverse:function(e){var t,r,n,i,o=(e.x-this.x0)*(1/this.a),l=(e.y-this.y0)*(1/this.a);if(this.es)if(r=je(t=this.ml0+l/this.k0,this.es,this.en),Math.abs(r)<a){var c=Math.sin(r),u=Math.cos(r),h=Math.abs(u)>s?Math.tan(r):0,d=this.ep2*Math.pow(u,2),p=Math.pow(d,2),g=Math.pow(h,2),f=Math.pow(g,2);t=1-this.es*Math.pow(c,2);var m=o*Math.sqrt(t)/this.k0,y=Math.pow(m,2);n=r-(t*=h)*y/(1-this.es)*.5*(1-y/12*(5+3*g-9*d*g+d-4*p-y/30*(61+90*g-252*d*g+45*f+46*d-y/56*(1385+3633*g+4095*f+1574*f*g)))),i=B(this.long0+m*(1-y/6*(1+2*g+d-y/20*(5+28*g+24*f+8*d*g+6*d-y/42*(61+662*g+1320*f+720*f*g))))/u)}else n=a*G(l),i=0;else{var v=Math.exp(o/this.k0),A=.5*(v-1/v),S=this.lat0+l/this.k0,E=Math.cos(S);t=Math.sqrt((1-Math.pow(E,2))/(1+Math.pow(A,2))),n=Math.asin(t),l<0&&(n=-n),i=0===A&&0===E?0:B(Math.atan2(A,E)+this.long0)}return e.x=i,e.y=n,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function ze(e){var t=Math.exp(e);return(t-1/t)/2}function Ye(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),n=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function $e(e,t){for(var r,n=2*Math.cos(2*t),i=e.length-1,o=e[i],a=0;--i>=0;)r=n*o-a+e[i],a=o,o=r;return t+r*Math.sin(2*t)}function Ke(e,t,r){for(var n,i,o=Math.sin(t),a=Math.cos(t),s=ze(r),l=function(e){var t=Math.exp(e);return(t+1/t)/2}(r),c=2*a*l,u=-2*o*s,h=e.length-1,d=e[h],p=0,g=0,f=0;--h>=0;)n=g,i=p,d=c*(g=d)-n-u*(p=f)+e[h],f=u*g-i+c*p;return[(c=o*l)*d-(u=a*s)*f,c*f+u*d]}const Xe={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(Ve.init.apply(this),this.forward=Ve.forward,this.inverse=Ve.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=$e(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(e,t){for(var r,n=2*Math.cos(t),i=e.length-1,o=e[i],a=0;--i>=0;)r=n*o-a+e[i],a=o,o=r;return Math.sin(t)*r}(this.gtu,2*n))},forward:function(e){var t=B(e.x-this.long0),r=e.y;r=$e(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),o=Math.sin(t),a=Math.cos(t);r=Math.atan2(n,a*i),t=Math.atan2(o*i,Ye(n,i*a)),t=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}(t*(1+t/(Ye(1,t)+1))),e<0?-t:t}(Math.tan(t));var s,l,c=Ke(this.gtu,2*r,2*t);return r+=c[0],t+=c[1],Math.abs(t)<=2.623395162778?(s=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(s=1/0,l=1/0),e.x=s,e.y=l,e},inverse:function(e){var t,r,n=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var o=Ke(this.utg,2*i,2*n);i+=o[0],n+=o[1],n=Math.atan(ze(n));var a=Math.sin(i),s=Math.cos(i),l=Math.sin(n),c=Math.cos(n);i=Math.atan2(a*c,Ye(l,c*s)),t=B((n=Math.atan2(l,c*s))+this.long0),r=$e(this.cgb,i)}else t=1/0,r=1/0;return e.x=t,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},Ze={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(B(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*l,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Xe.init.apply(this),this.forward=Xe.forward,this.inverse=Xe.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Je(e,t){return Math.pow((1-e)/(1+e),t)}const Qe={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+u)/(Math.pow(Math.tan(.5*this.lat0+u),this.C)*Je(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+u),this.C)*Je(this.e*Math.sin(r),this.ratexp))-a,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+u)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*Je(this.e*Math.sin(e.y),-.5*this.e))-a,!(Math.abs(r-e.y)<1e-14));--i)e.y=r;return i?(e.x=t,e.y=r,e):null},names:["gauss"]},et={init:function(){Qe.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,r,n,i;return e.x=B(e.x-this.long0),Qe.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),n=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n),e.x=i*r*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*r*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,r,n,i,o;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,o=Ye(e.x,e.y)){var a=2*Math.atan2(o,this.R2);t=Math.sin(a),r=Math.cos(a),i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/o),n=Math.atan2(e.x*t,o*this.cosc0*r-e.y*this.sinc0*t)}else i=this.phic0,n=0;return e.x=n,e.y=i,Qe.inverse.apply(this,[e]),e.x=B(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]},tt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&(this.k0=.5*(1+G(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=s&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=s&&Math.abs(Math.cos(this.lat_ts))>s&&(this.k0=.5*this.cons*F(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/U(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=F(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-a,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,r,n,i,o,l,c=e.x,u=e.y,h=Math.sin(u),d=Math.cos(u),p=B(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=s&&Math.abs(u+this.lat0)<=s?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*h+this.coslat0*d*Math.cos(p)),e.x=this.a*t*d*Math.sin(p)+this.x0,e.y=this.a*t*(this.coslat0*h-this.sinlat0*d*Math.cos(p))+this.y0,e):(r=2*Math.atan(this.ssfn_(u,h,this.e))-a,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=s?(o=U(this.e,u*this.con,this.con*h),l=2*this.a*this.k0*o/this.cons,e.x=this.x0+l*Math.sin(c-this.long0),e.y=this.y0-this.con*l*Math.cos(c-this.long0),e):(Math.abs(this.sinlat0)<s?(t=2*this.a*this.k0/(1+i*Math.cos(p)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(p))),e.y=t*(this.cosX0*n-this.sinX0*i*Math.cos(p))+this.y0),e.x=t*i*Math.sin(p)+this.x0,e))},inverse:function(e){var t,r,n,i,o;e.x-=this.x0,e.y-=this.y0;var l=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var c=2*Math.atan(l/(2*this.a*this.k0));return t=this.long0,r=this.lat0,l<=s?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(c)*this.sinlat0+e.y*Math.sin(c)*this.coslat0/l),t=Math.abs(this.coslat0)<s?this.lat0>0?B(this.long0+Math.atan2(e.x,-1*e.y)):B(this.long0+Math.atan2(e.x,e.y)):B(this.long0+Math.atan2(e.x*Math.sin(c),l*this.coslat0*Math.cos(c)-e.y*this.sinlat0*Math.sin(c))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=s){if(l<=s)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,n=l*this.cons/(2*this.a*this.k0),r=this.con*q(this.e,n),t=this.con*B(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,l<=s?o=this.X0:(o=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/l),t=B(this.long0+Math.atan2(e.x*Math.sin(i),l*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),r=-1*q(this.e,Math.tan(.5*(a+o)));return e.x=t,e.y=r,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"],ssfn_:function(e,t,r){return t*=r,Math.tan(.5*(a+e))*Math.pow((1-t)/(1+t),.5*r)}},rt={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),o=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),s=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+o*t)/(1-o*t));this.K=a-this.alpha*s+this.alpha*o/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),o=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(o)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(o))),s=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(o));return e.y=this.R/2*Math.log((1+Math.sin(s))/(1-Math.sin(s)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),o=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),s=this.lambda0+a/this.alpha,l=0,c=o,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+o/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),u=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=s,e.y=c,e},names:["somerc"]};var nt=1e-7;const it={init:function(){var e,t,r,n,i,o,c,d,p,g,f,m,y,v=0,A=0,S=0,E=0,w=0,_=0,L=0;this.no_off=(y="object"==typeof(m=this).PROJECTION?Object.keys(m.PROJECTION)[0]:m.PROJECTION,"no_uoff"in m||"no_off"in m||-1!==["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"].indexOf(y)),this.no_rot="no_rot"in this;var C=!1;"alpha"in this&&(C=!0);var b=!1;if("rectified_grid_angle"in this&&(b=!0),C&&(L=this.alpha),b&&(v=this.rectified_grid_angle*l),C||b)A=this.longc;else if(S=this.long1,w=this.lat1,E=this.long2,_=this.lat2,Math.abs(w-_)<=nt||(e=Math.abs(w))<=nt||Math.abs(e-a)<=nt||Math.abs(Math.abs(this.lat0)-a)<=nt||Math.abs(Math.abs(_)-a)<=nt)throw new Error;var T=1-this.es;t=Math.sqrt(T),Math.abs(this.lat0)>s?(d=Math.sin(this.lat0),r=Math.cos(this.lat0),e=1-this.es*d*d,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/T),this.A=this.B*this.k0*t/e,(i=(n=this.B*t/(r*Math.sqrt(e)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(U(this.e,this.lat0,d),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=i=1),C||b?(C?(f=Math.asin(Math.sin(L)/n),b||(v=L)):(f=v,L=Math.asin(n*Math.sin(f))),this.lam0=A-Math.asin(.5*(i-1/i)*Math.tan(f))/this.B):(o=Math.pow(U(this.e,w,Math.sin(w)),this.B),c=Math.pow(U(this.e,_,Math.sin(_)),this.B),i=this.E/o,p=(c-o)/(c+o),g=((g=this.E*this.E)-c*o)/(g+c*o),(e=S-E)<-Math.pi?E-=h:e>Math.pi&&(E+=h),this.lam0=B(.5*(S+E)-Math.atan(g*Math.tan(.5*this.B*(S-E))/p)/this.B),f=Math.atan(2*Math.sin(this.B*B(S-this.lam0))/(i-1/i)),v=L=Math.asin(n*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(v),this.cosrot=Math.cos(v),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A,this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(L))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(u-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(u+i))},forward:function(e){var t,r,n,i,o,l,c,u,h={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-a)>s){if(t=.5*((o=this.E/Math.pow(U(this.e,e.y,Math.sin(e.y)),this.B))-(l=1/o)),r=.5*(o+l),i=Math.sin(this.B*e.x),n=(t*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<s)throw new Error;u=.5*this.ArB*Math.log((1-n)/(1+n)),l=Math.cos(this.B*e.x),c=Math.abs(l)<nt?this.A*e.x:this.ArB*Math.atan2(t*this.cosgam+i*this.singam,l)}else u=e.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*e.y;return this.no_rot?(h.x=c,h.y=u):(c-=this.u_0,h.x=u*this.cosrot+c*this.sinrot,h.y=c*this.cosrot-u*this.sinrot),h.x=this.a*h.x+this.x0,h.y=this.a*h.y+this.y0,h},inverse:function(e){var t,r,n,i,o,l,c,u={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(r=e.y,t=e.x):(r=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),o=.5*(n+1/n),c=((l=Math.sin(this.BrA*t))*this.cosgam+i*this.singam)/o,Math.abs(Math.abs(c)-1)<s)u.x=0,u.y=c<0?-a:a;else{if(u.y=this.E/Math.sqrt((1+c)/(1-c)),u.y=q(this.e,Math.pow(u.y,1/this.B)),u.y===1/0)throw new Error;u.x=-this.rB*Math.atan2(i*this.cosgam-l*this.singam,Math.cos(this.BrA*t))}return u.x+=this.lam0,u},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},ot={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<s)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=F(this.e,t,r),i=U(this.e,this.lat1,t),o=Math.sin(this.lat2),a=Math.cos(this.lat2),l=F(this.e,o,a),c=U(this.e,this.lat2,o),u=U(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>s?this.ns=Math.log(n/l)/Math.log(i/c):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=s&&(r=G(r)*(a-2e-10));var n,i,o=Math.abs(Math.abs(r)-a);if(o>s)n=U(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((o=r*this.ns)<=0)return null;i=0}var l=this.ns*B(t-this.long0);return e.x=this.k0*(i*Math.sin(l))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(l))+this.y0,e},inverse:function(e){var t,r,n,i,o,s=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(s*s+l*l),r=1):(t=-Math.sqrt(s*s+l*l),r=-1);var c=0;if(0!==t&&(c=Math.atan2(r*s,r*l)),0!==t||this.ns>0){if(r=1/this.ns,n=Math.pow(t/(this.a*this.f0),r),-9999===(i=q(this.e,n)))return null}else i=-a;return o=B(c/this.ns+this.long0),e.x=o,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},at={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,o,a,s,l=e.x,c=e.y,u=B(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-u*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),o=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),a=this.n*o,s=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=s*Math.cos(a)/1,e.x=s*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,r,n,i,o,a,s,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),o=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/o,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),e.x=this.long0-r/this.alfa,a=t,s=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(s=1),a=e.y,c+=1}while(0===s&&c<15);return c>=15?null:e},names:["Krovak","krovak"]};function st(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function lt(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function ct(e){return.375*e*(1+.25*e*(1+.46875*e))}function ut(e){return.05859375*e*e*(1+.75*e)}function ht(e){return e*e*e*(35/3072)}function dt(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)}function pt(e){return Math.abs(e)<a?e:e-G(e)*Math.PI}function gt(e,t,r,n,i){var o,a;o=e/t;for(var s=0;s<15;s++)if(o+=a=(e-(t*o-r*Math.sin(2*o)+n*Math.sin(4*o)-i*Math.sin(6*o)))/(t-2*r*Math.cos(2*o)+4*n*Math.cos(4*o)-6*i*Math.cos(6*o)),Math.abs(a)<=1e-10)return o;return NaN}const ft={init:function(){this.sphere||(this.e0=lt(this.es),this.e1=ct(this.es),this.e2=ut(this.es),this.e3=ht(this.es),this.ml0=this.a*st(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,r,n=e.x,i=e.y;if(n=B(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var o=Math.sin(i),a=Math.cos(i),s=dt(this.a,this.e,o),l=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),u=c*c,h=this.es*a*a/(1-this.es);t=s*c*(1-u*l*(1/6-(8-l+8*h)*u/120)),r=this.a*st(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+s*o/a*u*(.5+(5-l+6*h)*u/24)}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var o=i+this.lat0;t=Math.asin(Math.sin(o)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(o))}else{var l=gt(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-a)<=s)return e.x=this.long0,e.y=a,i<0&&(e.y*=-1),e;var c=dt(this.a,this.e,Math.sin(l)),u=c*c*c/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(l),2),d=n*this.a/c,p=d*d;t=l-c*Math.tan(l)/u*d*d*(.5-(1+3*h)*d*d/24),r=d*(1-p*(h/3+(1+3*h)*h*p/15))/Math.cos(l)}return e.x=B(r+this.long0),e.y=pt(t),e},names:["Cassini","Cassini_Soldner","cass"]};function mt(e,t){var r;return e>1e-7?(1-e*e)*(t/(1-(r=e*t)*r)-.5/e*Math.log((1-r)/(1+r))):2*t}const yt={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-a)<s?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(t)<s?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=mt(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,r=[];return r[0]=.3333333333333333*e,t=e*e,r[0]+=.17222222222222222*t,r[1]=.06388888888888888*t,t*=e,r[0]+=.10257936507936508*t,r[1]+=.0664021164021164*t,r[2]=.016415012942191543*t,r}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=mt(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,r,n,i,o,l,c,h,d,p,g=e.x,f=e.y;if(g=B(g-this.long0),this.sphere){if(o=Math.sin(f),p=Math.cos(f),n=Math.cos(g),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+p*n:1+this.sinph0*o+this.cosph0*p*n)<=s)return null;t=(r=Math.sqrt(2/r))*p*Math.sin(g),r*=this.mode===this.EQUIT?o:this.cosph0*o-this.sinph0*p*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<s)return null;r=u-.5*f,t=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(g),r*=n}}else{switch(c=0,h=0,d=0,n=Math.cos(g),i=Math.sin(g),o=Math.sin(f),l=mt(this.e,o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=l/this.qp,h=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:d=1+this.sinb1*c+this.cosb1*h*n;break;case this.EQUIT:d=1+h*n;break;case this.N_POLE:d=a+f,l=this.qp-l;break;case this.S_POLE:d=f-a,l=this.qp+l}if(Math.abs(d)<s)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),r=this.mode===this.OBLIQ?this.ymf*d*(this.cosb1*c-this.sinb1*h*n):(d=Math.sqrt(2/(1+h*n)))*c*this.ymf,t=this.xmf*d*h*i;break;case this.N_POLE:case this.S_POLE:l>=0?(t=(d=Math.sqrt(l))*i,r=n*(this.mode===this.S_POLE?d:-d)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n,i,o,l,c,u,h,d,p=e.x/this.a,g=e.y/this.a;if(this.sphere){var f,m=0,y=0;if((r=.5*(f=Math.sqrt(p*p+g*g)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(y=Math.sin(r),m=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(f)<=s?0:Math.asin(g*y/f),p*=y,g=m*f;break;case this.OBLIQ:r=Math.abs(f)<=s?this.lat0:Math.asin(m*this.sinph0+g*y*this.cosph0/f),p*=y*this.cosph0,g=(m-Math.sin(r)*this.sinph0)*f;break;case this.N_POLE:g=-g,r=a-r;break;case this.S_POLE:r-=a}t=0!==g||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(p,g):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(p/=this.dd,g*=this.dd,(l=Math.sqrt(p*p+g*g))<s)return e.x=this.long0,e.y=this.lat0,e;i=2*Math.asin(.5*l/this.rq),n=Math.cos(i),p*=i=Math.sin(i),this.mode===this.OBLIQ?(c=n*this.sinb1+g*i*this.cosb1/l,o=this.qp*c,g=l*this.cosb1*n-g*this.sinb1*i):(c=g*i/l,o=this.qp*c,g=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(g=-g),!(o=p*p+g*g))return e.x=this.long0,e.y=this.lat0,e;c=1-o/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(p,g),d=(u=Math.asin(c))+u,r=u+(h=this.apa)[0]*Math.sin(d)+h[1]*Math.sin(d+d)+h[2]*Math.sin(d+d+d)}return e.x=B(this.long0+t),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function vt(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}const At={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=F(this.e3,this.sin_po,this.cos_po),this.qs1=mt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=F(this.e3,this.sin_po,this.cos_po),this.qs2=mt(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=mt(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>s?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=mt(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,o=this.ns0*B(t-this.long0),a=i*Math.sin(o)+this.x0,s=this.rh-i*Math.cos(o)+this.y0;return e.x=a,e.y=s,e},inverse:function(e){var t,r,n,i,o,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),i=0,0!==t&&(i=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,r)),o=B(i/this.ns0+this.long0),e.x=o,e.y=a,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var r,n,i,o,a=vt(.5*t);if(e<s)return a;for(var l=e*e,c=1;c<=25;c++)if(a+=o=.5*(i=1-(n=e*(r=Math.sin(a)))*n)*i/Math.cos(a)*(t/(1-l)-r/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(o)<=1e-7)return a;return null}},St={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,r,n,i,o,a,l,c=e.x,u=e.y;return n=B(c-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),(o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=s?(a=this.x0+1*this.a*r*Math.sin(n)/o,l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)/o):(a=this.x0+this.infinity_dist*r*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)),e.x=a,e.y=l,e},inverse:function(e){var t,r,n,i,o,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),r=Math.sin(i),a=vt((n=Math.cos(i))*this.sin_p14+e.y*r*this.cos_p14/t),o=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r),o=B(this.long0+o)):(a=this.phic0,o=0),e.x=o,e.y=a,e},names:["gnom"]},Et={init:function(){this.sphere||(this.k0=F(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,r,n=e.x,i=e.y,o=B(n-this.long0);if(this.sphere)t=this.x0+this.a*o*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=mt(this.e,Math.sin(i));t=this.x0+this.a*this.k0*o,r=this.y0+this.a*a*.5/this.k0}return e.x=t,e.y=r,e},inverse:function(e){var t,r;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=B(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*a:a;for(var n,i,o,s,l=Math.asin(.5*t),c=0;c<30;c++)if(i=Math.sin(l),o=Math.cos(l),s=e*i,l+=n=Math.pow(1-s*s,2)/(2*o)*(t/(1-e*e)-i/(1-s*s)+.5/e*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return l;return NaN}(this.e,2*e.y*this.k0/this.a),t=B(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e},names:["cea"]},wt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=B(t-this.long0),i=pt(r-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,r=e.y;return e.x=B(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=pt(this.lat0+(r-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},_t={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=lt(this.es),this.e1=ct(this.es),this.e2=ut(this.es),this.e3=ht(this.es),this.ml0=this.a*st(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,o=e.y,a=B(i-this.long0);if(n=a*Math.sin(o),this.sphere)Math.abs(o)<=s?(t=this.a*a,r=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(o),r=this.a*(pt(o-this.lat0)+(1-Math.cos(n))/Math.tan(o)));else if(Math.abs(o)<=s)t=this.a*a,r=-1*this.ml0;else{var l=dt(this.a,this.e,Math.sin(o))/Math.tan(o);t=l*Math.sin(n),r=this.a*st(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+l*(1-Math.cos(n))}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,r,n,i,o,a,l,c,u;if(n=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=s)t=B(n/this.a+this.long0),r=0;else{var h;for(a=this.lat0+i/this.a,l=n*n/this.a/this.a+a*a,c=a,o=20;o;--o)if(c+=u=-1*(a*(c*(h=Math.tan(c))+1)-c-.5*(c*c+l)*h)/((c-a)/h-1),Math.abs(u)<=s){r=c;break}t=B(this.long0+Math.asin(n*Math.tan(c)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=s)r=0,t=B(this.long0+n/this.a);else{var d,p,g,f,m;for(a=(this.ml0+i)/this.a,l=n*n/this.a/this.a+a*a,c=a,o=20;o;--o)if(m=this.e*Math.sin(c),d=Math.sqrt(1-m*m)*Math.tan(c),p=this.a*st(this.e0,this.e1,this.e2,this.e3,c),g=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),c-=u=(a*(d*(f=p/this.a)+1)-f-.5*d*(f*f+l))/(this.es*Math.sin(2*c)*(f*f+l-2*a*f)/(4*d)+(a-f)*(d*g-2/Math.sin(2*c))-g),Math.abs(u)<=s){r=c;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=B(this.long0+Math.asin(n*d/this.a)/Math.sin(r))}return e.x=t,e.y=r,e},names:["Polyconic","poly"]},Lt={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,r=e.x,n=e.y-this.lat0,i=r-this.long0,a=n/o*1e-5,s=i,l=1,c=0;for(t=1;t<=10;t++)l*=a,c+=this.A[t]*l;var u,h=c,d=s,p=1,g=0,f=0,m=0;for(t=1;t<=6;t++)u=g*h+p*d,p=p*h-g*d,g=u,f=f+this.B_re[t]*p-this.B_im[t]*g,m=m+this.B_im[t]*p+this.B_re[t]*g;return e.x=m*this.a+this.x0,e.y=f*this.a+this.y0,e},inverse:function(e){var t,r,n=e.x,i=e.y,a=n-this.x0,s=(i-this.y0)/this.a,l=a/this.a,c=1,u=0,h=0,d=0;for(t=1;t<=6;t++)r=u*s+c*l,c=c*s-u*l,u=r,h=h+this.C_re[t]*c-this.C_im[t]*u,d=d+this.C_im[t]*c+this.C_re[t]*u;for(var p=0;p<this.iterations;p++){var g,f=h,m=d,y=s,v=l;for(t=2;t<=6;t++)g=m*h+f*d,f=f*h-m*d,m=g,y+=(t-1)*(this.B_re[t]*f-this.B_im[t]*m),v+=(t-1)*(this.B_im[t]*f+this.B_re[t]*m);f=1,m=0;var A=this.B_re[1],S=this.B_im[1];for(t=2;t<=6;t++)g=m*h+f*d,f=f*h-m*d,m=g,A+=t*(this.B_re[t]*f-this.B_im[t]*m),S+=t*(this.B_im[t]*f+this.B_re[t]*m);var E=A*A+S*S;h=(y*A+v*S)/E,d=(v*A-y*S)/E}var w=h,_=d,L=1,C=0;for(t=1;t<=9;t++)L*=w,C+=this.D[t]*L;var b=this.lat0+C*o*1e5,T=this.long0+_;return e.x=T,e.y=b,e},names:["New_Zealand_Map_Grid","nzmg"]},Ct={init:function(){},forward:function(e){var t=e.x,r=e.y,n=B(t-this.long0),i=this.x0+this.a*n,o=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=i,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=B(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e},names:["Miller_Cylindrical","mill"]},bt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=We(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;if(n=B(n-this.long0),this.sphere){if(this.m)for(var o=this.n*Math.sin(i),a=20;a;--a){var l=(this.m*i+Math.sin(i)-o)/(this.m+Math.cos(i));if(i-=l,Math.abs(l)<s)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var c=Math.sin(i),u=Math.cos(i);r=this.a*He(i,c,u,this.en),t=this.a*n*u/Math.sqrt(1-this.es*c*c)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=vt((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=vt(Math.sin(t)/this.n)),r=B(r+this.long0),t=pt(t)):(t=je(e.y/this.a,this.es,this.en),(n=Math.abs(t))<a?(n=Math.sin(t),r=B(this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)))):n-s<a&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]},Tt={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=B(t-this.long0),i=r,o=Math.PI*Math.sin(r);;){var a=-(i+Math.sin(i)-o)/(1+Math.cos(i));if(i+=a,Math.abs(a)<s)break}i/=2,Math.PI/2-Math.abs(r)<s&&(n=0);var l=.900316316158*this.a*n*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=l,e.y=c,e},inverse:function(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var n=B(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return e.x=n,e.y=i,e},names:["Mollweide","moll"]},xt={init:function(){Math.abs(this.lat1+this.lat2)<s||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=lt(this.es),this.e1=ct(this.es),this.e2=ut(this.es),this.e3=ht(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=F(this.e,this.sinphi,this.cosphi),this.ml1=st(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<s?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=F(this.e,this.sinphi,this.cosphi),this.ml2=st(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=st(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,r=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var i=st(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-i)}var o=this.ns*B(r-this.long0),a=this.x0+t*Math.sin(o),s=this.y0+this.rh-t*Math.cos(o);return e.x=a,e.y=s,e},inverse:function(e){var t,r,n,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var o=0;return 0!==r&&(o=Math.atan2(t*e.x,t*e.y)),this.sphere?(i=B(this.long0+o/this.ns),n=pt(this.g-r/this.a),e.x=i,e.y=n,e):(n=gt(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=B(this.long0+o/this.ns),e.x=i,e.y=n,e)},names:["Equidistant_Conic","eqdc"]},Pt={init:function(){this.R=this.a},forward:function(e){var t,r,n=e.x,i=e.y,o=B(n-this.long0);Math.abs(i)<=s&&(t=this.x0+this.R*o,r=this.y0);var l=vt(2*Math.abs(i/Math.PI));(Math.abs(o)<=s||Math.abs(Math.abs(i)-a)<=s)&&(t=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var c=.5*Math.abs(Math.PI/o-o/Math.PI),u=c*c,h=Math.sin(l),d=Math.cos(l),p=d/(h+d-1),g=p*p,f=p*(2/h-1),m=f*f,y=Math.PI*this.R*(c*(p-m)+Math.sqrt(u*(p-m)*(p-m)-(m+u)*(g-m)))/(m+u);o<0&&(y=-y),t=this.x0+y;var v=u+p;return y=Math.PI*this.R*(f*v-c*Math.sqrt((m+u)*(u+1)-v*v))/(m+u),r=i>=0?this.y0+y:this.y0-y,e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i,o,a,l,c,u,h,d,p;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,o=(n=e.x/d)*n+(i=e.y/d)*i,d=3*(i*i/(c=-2*(a=-Math.abs(i)*(1+o))+1+2*i*i+o*o)+(2*(l=a-2*i*i+n*n)*l*l/c/c/c-9*a*l/c/c)/27)/(u=(a-l*l/3/c)/c)/(h=2*Math.sqrt(-u/3)),Math.abs(d)>1&&(d=d>=0?1:-1),p=Math.acos(d)/3,r=e.y>=0?(-h*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI:-(-h*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI,t=Math.abs(n)<s?this.long0:B(this.long0+Math.PI*(o-1+Math.sqrt(1+2*(n*n-i*i)+o*o))/2/n),e.x=t,e.y=r,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},Mt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,l,c,u,h,d,p,g,f,m,y,v,A,S,E,w,_,L,C=e.x,b=e.y,T=Math.sin(e.y),x=Math.cos(e.y),P=B(C-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=s?(e.x=this.x0+this.a*(a-b)*Math.sin(P),e.y=this.y0-this.a*(a-b)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=s?(e.x=this.x0+this.a*(a+b)*Math.sin(P),e.y=this.y0+this.a*(a+b)*Math.cos(P),e):(S=this.sin_p12*T+this.cos_p12*x*Math.cos(P),A=(v=Math.acos(S))?v/Math.sin(v):1,e.x=this.x0+this.a*A*x*Math.sin(P),e.y=this.y0+this.a*A*(this.cos_p12*T-this.sin_p12*x*Math.cos(P)),e):(t=lt(this.es),r=ct(this.es),n=ut(this.es),i=ht(this.es),Math.abs(this.sin_p12-1)<=s?(o=this.a*st(t,r,n,i,a),l=this.a*st(t,r,n,i,b),e.x=this.x0+(o-l)*Math.sin(P),e.y=this.y0-(o-l)*Math.cos(P),e):Math.abs(this.sin_p12+1)<=s?(o=this.a*st(t,r,n,i,a),l=this.a*st(t,r,n,i,b),e.x=this.x0+(o+l)*Math.sin(P),e.y=this.y0+(o+l)*Math.cos(P),e):(c=T/x,u=dt(this.a,this.e,this.sin_p12),h=dt(this.a,this.e,T),d=Math.atan((1-this.es)*c+this.es*u*this.sin_p12/(h*x)),E=0===(p=Math.atan2(Math.sin(P),this.cos_p12*Math.tan(d)-this.sin_p12*Math.cos(P)))?Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.abs(Math.abs(p)-Math.PI)<=s?-Math.asin(this.cos_p12*Math.sin(d)-this.sin_p12*Math.cos(d)):Math.asin(Math.sin(P)*Math.cos(d)/Math.sin(p)),g=this.e*this.sin_p12/Math.sqrt(1-this.es),v=u*E*(1-(w=E*E)*(y=(f=this.e*this.cos_p12*Math.cos(p)/Math.sqrt(1-this.es))*f)*(1-y)/6+(_=w*E)/8*(m=g*f)*(1-2*y)+(L=_*E)/120*(y*(4-7*y)-3*g*g*(1-7*y))-L*E/48*m),e.x=this.x0+v*Math.sin(p),e.y=this.y0+v*Math.cos(p),e))},inverse:function(e){var t,r,n,i,o,l,c,u,h,d,p,g,f,m,y,v,A,S,E,w,_,L,C;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*a*this.a)return;return r=t/this.a,n=Math.sin(r),i=Math.cos(r),o=this.long0,Math.abs(t)<=s?l=this.lat0:(l=vt(i*this.sin_p12+e.y*n*this.cos_p12/t),c=Math.abs(this.lat0)-a,o=Math.abs(c)<=s?this.lat0>=0?B(this.long0+Math.atan2(e.x,-e.y)):B(this.long0-Math.atan2(-e.x,e.y)):B(this.long0+Math.atan2(e.x*n,t*this.cos_p12*i-e.y*this.sin_p12*n))),e.x=o,e.y=l,e}return u=lt(this.es),h=ct(this.es),d=ut(this.es),p=ht(this.es),Math.abs(this.sin_p12-1)<=s?(l=gt(((g=this.a*st(u,h,d,p,a))-(t=Math.sqrt(e.x*e.x+e.y*e.y)))/this.a,u,h,d,p),o=B(this.long0+Math.atan2(e.x,-1*e.y)),e.x=o,e.y=l,e):Math.abs(this.sin_p12+1)<=s?(g=this.a*st(u,h,d,p,a),l=gt(((t=Math.sqrt(e.x*e.x+e.y*e.y))-g)/this.a,u,h,d,p),o=B(this.long0+Math.atan2(e.x,e.y)),e.x=o,e.y=l,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),y=Math.atan2(e.x,e.y),f=dt(this.a,this.e,this.sin_p12),v=Math.cos(y),S=-(A=this.e*this.cos_p12*v)*A/(1-this.es),E=3*this.es*(1-S)*this.sin_p12*this.cos_p12*v/(1-this.es),L=1-S*(_=(w=t/f)-S*(1+S)*Math.pow(w,3)/6-E*(1+3*S)*Math.pow(w,4)/24)*_/2-w*_*_*_/6,m=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*v),o=B(this.long0+Math.asin(Math.sin(y)*Math.sin(_)/Math.cos(m))),C=Math.sin(m),l=Math.atan2((C-this.es*L*this.sin_p12)*Math.tan(m),C*(1-this.es)),e.x=o,e.y=l,e)},names:["Azimuthal_Equidistant","aeqd"]},It={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,o,a,l,c=e.x,u=e.y;return n=B(c-this.long0),t=Math.sin(u),r=Math.cos(u),i=Math.cos(n),((o=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(o)<=s)&&(a=1*this.a*r*Math.sin(n),l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)),e.x=a,e.y=l,e},inverse:function(e){var t,r,n,i,o,l,c;return e.x-=this.x0,e.y-=this.y0,r=vt((t=Math.sqrt(e.x*e.x+e.y*e.y))/this.a),n=Math.sin(r),i=Math.cos(r),l=this.long0,Math.abs(t)<=s?(c=this.lat0,e.x=l,e.y=c,e):(c=vt(i*this.sin_p14+e.y*n*this.cos_p14/t),o=Math.abs(this.lat0)-a,Math.abs(o)<=s?(l=this.lat0>=0?B(this.long0+Math.atan2(e.x,-e.y)):B(this.long0-Math.atan2(-e.x,e.y)),e.x=l,e.y=c,e):(l=B(this.long0+Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n)),e.x=l,e.y=c,e))},names:["ortho"]};function Rt(e,t,r,n){var i;return e<s?(n.value=1,i=0):(i=Math.atan2(t,r),Math.abs(i)<=u?n.value=1:i>u&&i<=a+u?(n.value=2,i-=a):i>a+u||i<=-(a+u)?(n.value=3,i=i>=0?i-d:i+d):(n.value=4,i+=a)),i}function Ot(e,t){var r=e+t;return r<-d?r+=h:r>+d&&(r-=h),r}const Dt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=a-u/2?this.face=5:this.lat0<=-(a-u/2)?this.face=6:Math.abs(this.long0)<=u?this.face=1:Math.abs(this.long0)<=a+u?this.face=this.long0>0?2:4:this.face=3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,r,n,i,o,s,l={x:0,y:0},c={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,5===this.face)i=a-t,r>=u&&r<=a+u?(c.value=1,n=r-a):r>a+u||r<=-(a+u)?(c.value=2,n=r>0?r-d:r+d):r>-(a+u)&&r<=-u?(c.value=3,n=r+a):(c.value=4,n=r);else if(6===this.face)i=a+t,r>=u&&r<=a+u?(c.value=1,n=-r+a):r<u&&r>=-u?(c.value=2,n=-r):r<-u&&r>=-(a+u)?(c.value=3,n=-r-a):(c.value=4,n=r>0?-r+d:-r-d);else{var h,p,g,f,m,y;2===this.face?r=Ot(r,+a):3===this.face?r=Ot(r,+d):4===this.face&&(r=Ot(r,-a)),f=Math.sin(t),m=Math.cos(t),y=Math.sin(r),h=m*Math.cos(r),p=m*y,g=f,1===this.face?n=Rt(i=Math.acos(h),g,p,c):2===this.face?n=Rt(i=Math.acos(p),g,-h,c):3===this.face?n=Rt(i=Math.acos(-h),g,-p,c):4===this.face?n=Rt(i=Math.acos(-p),g,h,c):(i=n=0,c.value=1)}return s=Math.atan(12/d*(n+Math.acos(Math.sin(n)*Math.cos(u))-a)),o=Math.sqrt((1-Math.cos(i))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),2===c.value?s+=a:3===c.value?s+=d:4===c.value&&(s+=1.5*d),l.x=o*Math.cos(s),l.y=o*Math.sin(s),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,e.x=l.x,e.y=l.y,e},inverse:function(e){var t,r,n,i,o,s,l,c,u,h,p,g,f={lam:0,phi:0},m={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?m.value=1:e.y>=0&&e.y>=Math.abs(e.x)?(m.value=2,t-=a):e.x<0&&-e.x>=Math.abs(e.y)?(m.value=3,t=t<0?t+d:t-d):(m.value=4,t+=a),u=d/12*Math.tan(t),o=Math.sin(u)/(Math.cos(u)-1/Math.sqrt(2)),s=Math.atan(o),(l=1-(n=Math.cos(t))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?l=-1:l>1&&(l=1),5===this.face)c=Math.acos(l),f.phi=a-c,1===m.value?f.lam=s+a:2===m.value?f.lam=s<0?s+d:s-d:3===m.value?f.lam=s-a:f.lam=s;else if(6===this.face)c=Math.acos(l),f.phi=c-a,1===m.value?f.lam=-s+a:2===m.value?f.lam=-s:3===m.value?f.lam=-s-a:f.lam=s<0?-s-d:-s+d;else{var y,v,A;u=(y=l)*y,v=(u+=(A=u>=1?0:Math.sqrt(1-u)*Math.sin(s))*A)>=1?0:Math.sqrt(1-u),2===m.value?(u=v,v=-A,A=u):3===m.value?(v=-v,A=-A):4===m.value&&(u=v,v=A,A=-u),2===this.face?(u=y,y=-v,v=u):3===this.face?(y=-y,v=-v):4===this.face&&(u=y,y=v,v=-u),f.phi=Math.acos(-A)-a,f.lam=Math.atan2(v,y),2===this.face?f.lam=Ot(f.lam,-a):3===this.face?f.lam=Ot(f.lam,-d):4===this.face&&(f.lam=Ot(f.lam,+a))}return 0!==this.es&&(h=f.phi<0?1:0,p=Math.tan(f.phi),g=this.b/Math.sqrt(p*p+this.one_minus_f_squared),f.phi=Math.atan(Math.sqrt(this.a*this.a-g*g)/(this.one_minus_f*g)),h&&(f.phi=-f.phi)),f.lam+=this.long0,e.x=f.lam,e.y=f.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var Nt=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],kt=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ft=.8487,Gt=1.3523,Bt=c/5,Ut=1/Bt,qt=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};const Wt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=B(e.x-this.long0),r=Math.abs(e.y),n=Math.floor(r*Bt);n<0?n=0:n>=18&&(n=17);var i={x:qt(Nt[n],r=c*(r-Ut*n))*t,y:qt(kt[n],r)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*Ft+this.x0,i.y=i.y*this.a*Gt+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*Ft),y:Math.abs(e.y-this.y0)/(this.a*Gt)};if(t.y>=1)t.x/=Nt[18][0],t.y=e.y<0?-a:a;else{var r=Math.floor(18*t.y);for(r<0?r=0:r>=18&&(r=17);;)if(kt[r][0]>t.y)--r;else{if(!(kt[r+1][0]<=t.y))break;++r}var n=kt[r],i=5*(t.y-n[0])/(kt[r+1][0]-n[0]);i=function(e,t,r,n){for(var i=t;n;--n){var o=e(i);if(i-=o,Math.abs(o)<1e-10)break}return i}((function(e){return(qt(n,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(n,e)}),i,0,100),t.x/=qt(Nt[r],i),t.y=(5*r+i)*l,e.y<0&&(t.y=-t.y)}return t.x=B(t.x+this.long0),t},names:["Robinson","robin"]},Ht={init:function(){this.name="geocent"},forward:function(e){return ce(e,this.es,this.a)},inverse:function(e){return ue(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var jt={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const Vt={init:function(){if(Object.keys(jt).forEach(function(e){if(void 0===this[e])this[e]=jt[e].def;else{if(jt[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);jt[e].num&&(this[e]=parseFloat(this[e]))}jt[e].degrees&&(this[e]=this[e]*l)}.bind(this)),Math.abs(Math.abs(this.lat0)-a)<s?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<s?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,r,n,i,o=Math.sin(e.y),a=Math.cos(e.y),s=Math.cos(e.x);switch(this.mode){case 3:r=this.sinph0*o+this.cosph0*a*s;break;case 2:r=a*s;break;case 1:r=-o;break;case 0:r=o}switch(t=(r=this.pn1/(this.p-r))*a*Math.sin(e.x),this.mode){case 3:r*=this.cosph0*o-this.sinph0*a*s;break;case 2:r*=o;break;case 0:r*=-a*s;break;case 1:r*=a*s}return i=1/((n=r*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-r*this.sg)*this.cw*i,r=n*i,e.x=t*this.a,e.y=r*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,r,n,i={x:e.x,y:e.y};n=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*n,r=this.pn1*e.y*this.cw*n,e.x=t*this.cg+r*this.sg,e.y=r*this.cg-t*this.sg;var o=Ye(e.x,e.y);if(Math.abs(o)<s)i.x=0,i.y=e.y;else{var a,l;switch(l=1-o*o*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/o+o/this.pn1),a=Math.sqrt(1-l*l),this.mode){case 3:i.y=Math.asin(a*this.sinph0+e.y*l*this.cosph0/o),e.y=(a-this.sinph0*Math.sin(i.y))*o,e.x*=l*this.cosph0;break;case 2:i.y=Math.asin(e.y*l/o),e.y=a*o,e.x*=l;break;case 0:i.y=Math.asin(a),e.y=-e.y;break;case 1:i.y=-Math.asin(a)}i.x=Math.atan2(e.x,e.y)}return e.x=i.x+this.long0,e.y=i.y,e},names:["Tilted_Perspective","tpers"]},zt={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(e){var t,r,n,i,o=e.x,a=e.y;if(o-=this.long0,"ellipse"===this.shape){a=Math.atan(this.radius_p2*Math.tan(a));var s=this.radius_p/Ye(this.radius_p*Math.cos(a),Math.sin(a));if(r=s*Math.cos(o)*Math.cos(a),n=s*Math.sin(o)*Math.cos(a),i=s*Math.sin(a),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/Ye(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/Ye(n,t)))}else"sphere"===this.shape&&(t=Math.cos(a),r=Math.cos(o)*t,n=Math.sin(o)*t,i=Math.sin(a),t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/Ye(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/Ye(n,t))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function(e){var t,r,n,i,o=-1,a=0,s=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Ye(1,s)):(a=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Ye(1,a));var l=s/this.radius_p;if(t=a*a+l*l+o*o,(n=(r=2*this.radius_g*o)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),o=this.radius_g+i*o,a*=i,s*=i,e.x=Math.atan2(a,o),e.y=Math.atan(s*Math.cos(e.x)/o),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(s=Math.tan(e.y/this.radius_g_1),a=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+s*s)):(a=Math.tan(e.x/this.radius_g_1),s=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+a*a)),t=a*a+s*s+o*o,(n=(r=2*this.radius_g*o)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),o=this.radius_g+i*o,a*=i,s*=i,e.x=Math.atan2(a,o),e.y=Math.atan(s*Math.cos(e.x)/o)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var Yt=1.340264,$t=-.081106,Kt=893e-6,Xt=.003796,Zt=Math.sqrt(3)/2;const Jt={init:function(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function(e){var t=B(e.x-this.long0),r=e.y,n=Math.asin(Zt*Math.sin(r)),i=n*n,o=i*i*i;return e.x=t*Math.cos(n)/(Zt*(Yt+3*$t*i+o*(7*Kt+9*Xt*i))),e.y=n*(Yt+$t*i+o*(Kt+Xt*i)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t,r,n,i,o=e.y;for(i=0;i<12&&(o-=n=(o*(Yt+$t*(t=o*o)+(r=t*t*t)*(Kt+Xt*t))-e.y)/(Yt+3*$t*t+r*(7*Kt+9*Xt*t)),!(Math.abs(n)<1e-9));++i);return r=(t=o*o)*t*t,e.x=Zt*e.x*(Yt+3*$t*t+r*(7*Kt+9*Xt*t))/Math.cos(o),e.y=Math.asin(Math.sin(o)/Zt),e.x=B(e.x+this.long0),e},names:["eqearth","Equal Earth","Equal_Earth"]};var Qt=1e-10;function er(e){var t,r,n,i=B(e.x-(this.long0||0)),o=e.y;return t=this.am1+this.m1-He(o,r=Math.sin(o),n=Math.cos(o),this.en),r=n*i/(t*Math.sqrt(1-this.es*r*r)),e.x=t*Math.sin(r),e.y=this.am1-t*Math.cos(r),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function tr(e){var t,r,n,i;if(e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a,r=Ye(e.x,e.y=this.am1-e.y),i=je(this.am1+this.m1-r,this.es,this.en),(t=Math.abs(i))<a)t=Math.sin(i),n=r*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(i);else{if(!(Math.abs(t-a)<=Qt))throw new Error;n=0}return e.x=B(n+(this.long0||0)),e.y=pt(i),e}function rr(e){var t,r,n=B(e.x-(this.long0||0)),i=e.y;return r=this.cphi1+this.phi1-i,Math.abs(r)>Qt?(e.x=r*Math.sin(t=n*Math.cos(i)/r),e.y=this.cphi1-r*Math.cos(t)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function nr(e){var t,r;e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var n=Ye(e.x,e.y=this.cphi1-e.y);if(r=this.cphi1+this.phi1-n,Math.abs(r)>a)throw new Error;return t=Math.abs(Math.abs(r)-a)<=Qt?0:n*Math.atan2(e.x,e.y)/Math.cos(r),e.x=B(t+(this.long0||0)),e.y=pt(r),e}const ir={init:function(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<Qt)throw new Error;this.es?(this.en=We(this.es),this.m1=He(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=tr,this.forward=er):(Math.abs(this.phi1)+Qt>=a?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=nr,this.forward=rr)},names:["bonne","Bonne (Werner lat_1=90)"]};var or;we.defaultDatum="WGS84",we.Proj=le,we.WGS84=new we.Proj("WGS84"),we.Point=Ge,we.toPoint=me,we.defs=O,we.nadgrid=function(e,t){var r=new DataView(t),n=function(e){var t=e.getInt32(8,!1);return 11!==t&&(11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(r),i=function(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:ne(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(r,n),o=function(e,t,r){for(var n=176,i=[],o=0;o<t.nSubgrids;o++){var a=oe(e,n,r),s=ae(e,n,a,r),l=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),c=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);i.push({ll:[re(a.lowerLongitude),re(a.lowerLatitude)],del:[re(a.longitudeInterval),re(a.latitudeInterval)],lim:[l,c],count:a.gridNodeCount,cvs:ie(s)}),n+=176+16*a.gridNodeCount}return i}(r,i,n),a={header:i,subgrids:o};return ee[e]=a,a},we.transform=ve,we.mgrs=xe,we.version="__VERSION__",(or=we).Proj.projections.add(Ve),or.Proj.projections.add(Xe),or.Proj.projections.add(Ze),or.Proj.projections.add(et),or.Proj.projections.add(tt),or.Proj.projections.add(rt),or.Proj.projections.add(it),or.Proj.projections.add(ot),or.Proj.projections.add(at),or.Proj.projections.add(ft),or.Proj.projections.add(yt),or.Proj.projections.add(At),or.Proj.projections.add(St),or.Proj.projections.add(Et),or.Proj.projections.add(wt),or.Proj.projections.add(_t),or.Proj.projections.add(Lt),or.Proj.projections.add(Ct),or.Proj.projections.add(bt),or.Proj.projections.add(Tt),or.Proj.projections.add(xt),or.Proj.projections.add(Pt),or.Proj.projections.add(Mt),or.Proj.projections.add(It),or.Proj.projections.add(Dt),or.Proj.projections.add(Wt),or.Proj.projections.add(Ht),or.Proj.projections.add(Vt),or.Proj.projections.add(zt),or.Proj.projections.add(Jt),or.Proj.projections.add(ir);const ar=we},8839:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var n=r(8038),i=r(797),o=r(3301),a=r(5909);n.A.control=n.A.control||{};class s extends a.default{constructor(){super(...arguments);const e=this;e.geometryType=i.A.geom.POLYGON,e.style=o.A.extend(!0,{strokeColor:e.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},e.options.style)}}n.A.control.PolygonFeatureInfo=s;const l=s},8848:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(8038),i=r(1256);n.A.control=n.A.control||{};class o extends i.A{constructor(){super(...arguments),this.controlOptions=this.options.controls,this.ctlCount=this.controlOptions.length,this.defaultSelection=this.options.defaultSelection,this._ctlPromises=new Array(this.ctlCount)}async register(e){const t=super.register.call(this,e);this.uids=new Array(this.ctlCount);for(let e=0;e<this.uids.length;e++)this.uids[e]=this.getUID();return await Promise.all([t,this.renderPromise()]),await this.onRender()}mergeOptions(...e){const t=super.mergeOptions(...e),r=e.map((e=>e.controls??[])).map((e=>Array.isArray(e)?e:Object.keys(e).map((t=>{const r={...e[t]};return delete r.position,{[t]:r,position:e[t].position}}))));return t.controls=r[r.length-1],t}onRender(){return Promise.resolve(this)}async render(e){}async getControl(e){const t=await this._ctlPromises[e];if(!t)throw Error("No control found");return t}getControls(){return Promise.all(this._ctlPromises)}onControlDisable(e){}onControlEnable(e){}}n.A.control.Container=o;const a=o},8927:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var n=r(8038),i=r(797),o=r(3301),a=r(187),s=r(9687),l=r(3503),c=r.n(l);n.A.control=n.A.control||{},i.A.classes.FROMLEFT="tc-fromleft",i.A.classes.FROMRIGHT="tc-fromright";const u=function e(t,r){var n;if(Array.isArray(t))for(var i=0,o=(n=t.slice()).length;i<o;i++)n[i]=e(n[i]);else n="number"==typeof t?Math.round(t.toFixed(r)):t;return n};class h extends s.default{constructor(){super(...arguments),this.wrap=new n.A.wrap.control.FeatureInfo(this)}async register(e){const t=await super.register.call(this,e);return document.createElement("div").appendChild(this.div),t}async callback(e,t){const r=this;r.querying=!0;const n=r.getElevationTool();if(n.then((function(t){t&&(r.elevationRequest=t.getElevation({crs:r.map.crs,coordinates:[e]}))})),r.map&&r.filterLayer){var a=r.getLocaleString("featureInfo"),s=o.A.extend({},r.map.options.styles.marker,r.markerStyle,{title:a,set:a,showsPopup:!1});r.filterLayer.clearFeatures(),r.highlightedFeature=null,r.filterFeature=null;const t=await r.filterLayer.addMarker(e,s);r.map.putLayerOnTop(r.filterLayer),r.filterFeature=t,n.then((function(e){r.renderResults({coords:t.geometry,displayElevation:e,loading:!0},(function(){r.displayResults()}))}));const l=r.map.workLayers.filter((e=>e.type===i.A.layerType.WMS)).filter((e=>e.getVisibility())).some((e=>e.names.length>0));r.queryResolution=r.map.getResolution(),l?await r.wrap.getFeatureInfo(e,r.queryResolution):await o.A.getTimedPromise((()=>r.responseCallback({coords:e})))}}sendRequest(e){return this.callback(e.getCoordinates())}responseCallback(e){const t=this;if(super.responseCallback.call(t,e),t.filterFeature){var r=e.services;if(r)for(var o=0;o<r.length;o++){for(var a=r[o],s=0;s<a.layers.length;s++)a.layers[s].features.length||(a.layers.splice(s,1),s-=1);a.layers.length||(r.splice(o,1),o-=1)}t.info.defaultFeature=e.defaultFeature,t.elevationRequest&&(e.displayElevation=!0),t.renderResults(e,(function(){if(t.insertLinks(),t.sharedFeatureInfo){var e;t.div.querySelectorAll("ul."+t.CLASS+"-services li").forEach((function(e){e.classList.add(i.A.classes.CHECKED)}));for(var r=t.sharedFeatureInfo,o=0,a=t.info.services.length;o<a;o++){var s=t.info.services[o];if(s.mapLayers.some((e=>e.url===r.s))){for(var l=0,h=s.layers.length;l<h;l++){var d=s.layers[l];if(d.name===r.l){for(var p=0,g=d.features.length;p<g;p++){var f=d.features[p];if(f.id===r.f){e=f;var m=c()(JSON.stringify({data:f.getData(),geometry:u(f.geometry,i.A.DEGREE_PRECISION)}));r.h!==m&&n.A.alert(t.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}e&&(t.highlightedFeature=e,t.map.addLayer({id:t.getUID(),type:i.A.layerType.VECTOR,title:t.getLocaleString("foi"),owner:t,stealth:!0}).then((function(r){t.sharedFeatureLayer=r,t.filterLayer.clearFeatures(),t.filterFeature=null,r.addFeature(e),t.map.zoomToFeatures([e])}))),delete t.sharedFeatureInfo}else t.displayResults();t.div.querySelectorAll("ul."+t.CLASS+"-services label, ul."+t.CLASS+"-services a").forEach((function(e){e.addEventListener(i.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})}))}))}}displayResultsCallback(){const e=this;if(super.displayResultsCallback.call(e),e.elevationRequest){const t=e.getDisplayControl();e.getDisplayTarget().querySelectorAll(`.${e.CLASS}-elev,.${e.CLASS}-height`).forEach((e=>e.classList.add(i.A.classes.HIDDEN))),e.elevationRequest.then((function(r){if(t.currentFeature&&r?.length){const n=t.currentFeature.geometry,i=r[0];if(n[0]===i[0]&&n[1]===i[1]){const t=r.length?r[0].slice(2):null;e.displayElevationValues(t)}}}))}new ResizeObserver((t=>{for(let r of t)r.target.querySelectorAll("ul."+e.CLASS+"-services label, ul."+e.CLASS+"-services h4, ul."+e.CLASS+"-services h3 span").forEach((function(e){e.addEventListener("mouseenter",(function(e){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item("H4"===this.tagName?2:0).textContent:this.title=""}),{passive:!0})}))})).observe(e.getDisplayTarget())}renderResults(e,t){const r=this;if(r.filterFeature){const n=r.filterFeature.geometry;e.coords&&n[0]===e.coords[0]&&n[1]===e.coords[1]&&(e.isGeo=r.map.wrap.isGeo(),e.coords&&(e.crs=r.map.crs,e.coords=e.coords.map((function(t){const r=e.isGeo?i.A.DEGREE_PRECISION:i.A.METER_PRECISION;return o.A.formatCoord(t,r)}))),r.renderData(e,t))}}displayElevationValues(e){const t=this;let r,n;Array.isArray(e)?(r=e[0],n=e.length>1?e[1]:null):(r=e,n=null);const s=t.map.options.locale||a.A.locale;let l=null===r?"-":o.A.formatNumber(Math.round(r),s)+" m",c=n?n.toLocaleString(s,{maximumFractionDigits:1})+" m":"-";const u=t.getDisplayTarget().querySelector(`.${t.CLASS}-elev`),h=t.getDisplayTarget().querySelector(`.${t.CLASS}-height`);u&&h&&(u.classList.toggle(i.A.classes.HIDDEN,null===r),h.classList.toggle(i.A.classes.HIDDEN,!n),u.querySelector(`.${t.CLASS}-coords-val`).innerHTML=l,h.querySelector(`.${t.CLASS}-coords-val`).innerHTML=c)}loadSharedFeature(e){const t=this;if(e){if(0===t.map.workLayers.filter((function(t,r){return t.type===i.A.layerType.WMS&&t.url===e.s&&t.getDisgregatedLayerNames().indexOf(e.l)>=0})).length)return void n.A.error(t.getLocaleString("sharedFeatureNotValid"),i.A.msgErrorMode.TOAST);t.sharedFeatureInfo=e;const r=[-100,-100];t.beforeRequest({xy:r}),t.filterLayer.clearFeatures(),t.filterFeature=null,t.filterLayer.addMarker(r).then((function(r){t.filterFeature=r,t.wrap.getFeatureInfo(e.xy,e.r,{serviceUrl:e.s,layerName:e.l,featureId:e.f})}))}}exportQuery(){const e=super.exportQuery.call(this);return e.res=this.queryResolution,e}importQuery(e){const t=this;e.filter&&t.map.ready((()=>{t.map.setResolution(e.res).then((()=>super.importQuery.call(t,e)))}))}}n.A.control.FeatureInfo=h;const d=h},8991:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(8038),i=r(797);n.A.tool=n.A.tool||{},n.A.tool.Proxification=function(e,t={}){var r=this;if(r.Consts={url:{SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/}},void 0===e)throw new TypeError('"proxy" parameter is undefined',"TC.tool.Proxification.js");r.proxy="function"==typeof e?e:function(t){var r=e;return"http"!==t.substr(0,4)&&(r+=window.location.protocol),r+encodeURIComponent(t)},r._location=t.location||window.location,r.preventMixedContent=void 0===t.allowedMixedContent||!t.allowedMixedContent},function(){window.fetch||function(e){if(!e.fetch){var t="URLSearchParams"in e,r="Symbol"in e&&"iterator"in Symbol,n="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&Object.prototype.isPrototypeOf.call(DataView.prototype,e)},l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};g.prototype.append=function(e,t){e=h(e),t=d(t);var r=this.map[e];this.map[e]=r?r+","+t:t},g.prototype.delete=function(e){delete this.map[h(e)]},g.prototype.get=function(e){return e=h(e),this.has(e)?this.map[e]:null},g.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this.map,h(e))},g.prototype.set=function(e,t){this.map[h(e)]=d(t)},g.prototype.forEach=function(e,t){for(var r in this.map)Object.prototype.hasOwnProperty.call(this.map,r)&&e.call(t,this.map[r],r,this)},g.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),p(e)},g.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},g.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),p(e)},r&&(g.prototype[Symbol.iterator]=g.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];S.prototype.clone=function(){return new S(this,{body:this._bodyInit})},A.call(S.prototype),A.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var u=[301,302,303,307,308];w.redirect=function(e,t){if(-1===u.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},e.Headers=g,e.Request=S,e.Response=w,e.fetch=function(e,t){return new Promise((function(r,i){var o=new S(e,t);t=t||{};var a=new XMLHttpRequest;a.onload=function(){if(0===a.status)return new w(null,{status:a.status});var e={status:a.status,statusText:a.statusText,headers:(t=a.getAllResponseHeaders()||"",n=new g,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var t=e.split(":"),r=t.shift().trim();if(r){var i=t.join(":").trim();n.append(r,i)}})),n)};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t,n,i="response"in a?a.response:a.responseText;r(new w(i,e))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!t.sync),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),!t.sync&&"responseType"in a&&n&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),a.send(void 0===o._bodyInit?null:o._bodyInit)}))},e.fetch.polyfill=!0}function h(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function d(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r&&(t[Symbol.iterator]=function(){return t}),t}function g(e){this.map={},e instanceof g?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function m(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function y(e){var t=new FileReader,r=m(t);return t.readAsArrayBuffer(e),r}function v(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function A(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(n&&Object.prototype.isPrototypeOf.call(Blob.prototype,e))this._bodyBlob=e;else if(i&&Object.prototype.isPrototypeOf.call(FormData.prototype,e))this._bodyFormData=e;else if(t&&Object.prototype.isPrototypeOf.call(URLSearchParams.prototype,e))this._bodyText=e.toString();else if(o&&n&&s(e))this._bodyArrayBuffer=v(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!Object.prototype.isPrototypeOf.call(ArrayBuffer.prototype,e)&&!l(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=v(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&Object.prototype.isPrototypeOf.call(URLSearchParams.prototype,e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,r,n=f(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=m(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(E)}),this.json=function(){return this.text().then(JSON.parse)},this}function S(e,t={}){var r,n,i=t.body;if(e instanceof S){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new g(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new g(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),c.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function E(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new g(t.headers),this.url=t.url||"",this._initBody(e)}}(this);var e=function(e){var t=document.createElement("a");if(t.href=e,!t.origin){if(!t.protocol||!t.hostname){var r=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/.exec(t.href);if(t.protocol=r[1],r[4].indexOf(":")>-1){var n=r[4].split(":");t.hostname=n[0],t.port=n[1]}else t.hostname=r[4]}t.origin=(0===t.protocol.length?window.location.protocol:t.protocol)+"//"+t.hostname+(t.port&&e.indexOf(t.port)>-1?":"+t.port:"")}return t},t=n.A.tool.Proxification.prototype;t.cacheHost=new function(){var t=function(t){var r=e(t);return r?r.origin:null};this._hosts=[],this._hostsImage=[],this.is=function(e,r){var n=t(e);return null!==this.get(n,r)},this.get=function(e,t){if(0===this.getList(t).length)return null;var r=this.getList(t).filter((function(r){return r.key===e&&t.exportable==r.exportable}));return 0===r.length?null:r[0]},this.getList=function(e){return e.forImage?this._hostsImage:this._hosts},this.addKey=function(e,r){var n={key:t(e),action:null};return r.exportable&&(n.exportable=r.exportable),this.getList(r).push(n),this.getList(r)[this.getList(r).length-1]},this.removeKey=function(e,r){for(var n=t(e),i=0;i<this.getList(r).length;i++)if(this.getList(r)[i].key===n&&r.exportable==this.getList(r)[i].exportable){this.getList(r).splice(i,1);break}},this.getAction=function(e,r={}){var n=t(e),i=this.get(n,r);return i?i._actionPromise:Promise.reject(new Error("Cache null"))}},t._isServiceWorker=function(){return!(!navigator.serviceWorker||(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)&&(navigator.serviceWorker.ready.then((function(e){return!!e.active})).catch((()=>{console.log("Capturamos error que se produce en FF por configuración del navegador.")})),1))},t._isSameOrigin=function(e){var t=this,r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(t.Consts.url.SPLIT_REGEX);if(n){var i=n[1];r=(i==t._location.protocol||null==i)&&n[3]==t._location.hostname;var o=n[4],a=t._location.port;(80!=o&&""!==o||"80"!=a&&""!==a)&&(r=r&&o==a)}return r},t._isSameProtocol=function(e){const t=this;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var i=t._location.match(r);if(i&&i.length>1)return n[0].trim()===i[0].trim()}return!1},t._isSecureURL=function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)};const r=function(e,t,r){this.status=e,this.text=t,this.url=r};var o=function(t,r){var n=e(t);return t.replace(n.protocol,r)},a=function(e){return o(e,"https:")},s=function(e){return o(e,"http:")},l=function(e,t,r,n){var i=this;e=a(e),i._image.getImgTag(e,t).then((function(e){r(e,i._actionHTTPS)}),(function(o){o===i._image.ErrorType.PROTOCOL?n(o):u.call(i,s(e),t,r,n)}))},c=function(e,t,r,n){var i=this;e=s(e),i._image.getImgTag(e,t).then((function(e){r(e,i._actionHTTP)}),(function(o){o===i._image.ErrorType.PROTOCOL||o===i._image.ErrorType.UNEXPECTEDCONTENTTYPE||o===i._image.ErrorType.METHODNOTALLOWED?n(o):u.call(i,a(e),t,r,n)}))},u=function(e,t,r,n){var i=this;t.sameOrigin=i._isSameOrigin(i._actionProxy.call(i,e)),i._image.getImgTagByAction(e,t,i._actionProxy.bind(i)).then((function(e){r(e,i._actionProxy)}),(function(e){n(e)}))};t._actionDirect=function(e){return e},t._actionHTTP=function(e){return o(e,"http:")},t._actionHTTPS=function(e){return o(e,"https:")},t._actionProxy=function(e){return this.proxy(e)},t._image={ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"notfounded",UNEXPECTED:"unexpected",OFFLINE:"offline",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType",METHODNOTALLOWED:"Method_Not_Allowed"},validContentType:["image/png","image/jpeg","image/tiff","image/gif","image/bmp","image/svg+xml","image/webp","image/avif"],checkHttpStatus:function(e){const r=this;return navigator.onLine?fetch(e,{credentials:"omit"}).then(t._fetch.validateResponse.bind()).then(t._fetch.validateContentType.bind(t,r.validContentType)).then((function(e){return{status:e.status,statusText:e.statusText}})).catch((function(e){return e.message===r.ErrorType.UNEXPECTEDCONTENTTYPE||e.status?e:{statusText:r.ErrorType.UNEXPECTED}})):Promise.reject({statusText:r.ErrorType.OFFLINE})},getImgTag:function(e,r){return new Promise(function(t,n){var i=this,o=document.createElement("img");r.exportable&&!r.sameOrigin&&(o.dataset.checkCORSHeaders=!0,o.crossOrigin="string"==typeof r.exportable?r.exportable:"anonymous"),o.onload=function(){if(console.log("Load OK: "+o.src),o.onload=o.onerror=void 0,r.exportable&&!r.sameOrigin)try{var e=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");return t.height=e.height,t.width=e.width,r.drawImage(e,0,0),t}(o);e.toDataURL("image/png"),t(o)}catch(e){18===e.code?n(i.ErrorType.CORS):t(o)}else t(o)},o.onerror=function(t){console.log("Load crossOrigin ERROR: "+o.src),o.dataset.checkCORSHeaders?(o.crossOrigin=null,o.onerror=void 0,o.onerror=function(e){console.log("Load ERROR: "+o.src),i.checkHttpStatus(o.src).then((function(e){r.ignoreProxification||400===e.status?n(i.ErrorType.PROTOCOL):n(e)})).catch(n),o.onload=o.onerror=void 0},o.src=e):(console.log("Load ERROR: "+o.src),o.onload=o.onerror=void 0,i.checkHttpStatus(o.src).then((function(e){r.ignoreProxification||400===e.status?n(i.ErrorType.PROTOCOL):n(e)})).catch(n))};try{o.src=e}catch(e){console.log("Load ERROR: "+o.src),n(i.ErrorType.UNEXPECTED)}}.bind(t._image))},getImgTagByAction:function(e,r,n){return new Promise(function(t,i){var o=this,a=document.createElement("img");r.sameOrigin||r.exportable&&(a.crossOrigin="anonymous"),a.onload=function(){a.onload=a.onerror=void 0,t(a)},a.onerror=function(e){console.log("Load ERROR: "+a.src),a.onload=a.onerror=void 0,o.checkHttpStatus(a.src).then((function(e){r.ignoreProxification||400===e.status?i(o.ErrorType.PROTOCOL):405===e.status?i(o.ErrorType.METHODNOTALLOWED):i(e)})).catch(i)},a.src=n(e)}.bind(t._image))}},t._fetch={Headers:{CONTENTTYPE:"content-type",CONTENTDISPOSITION:"content-disposition"},ErrorType:{CORS:"cors",PROTOCOL:"protocol",NOTFOUNDED:"Not_Founded",UNEXPECTED:"Un_Expected",UNEXPECTEDCONTENTTYPE:"Un_Expected_ContentType"},validateResponse:function(e){if(!e.ok)throw new r(e.status,e.statusText,e.url);return e},validateContentType:function(e,t){if(!e)return t;var r=t.headers.get(this._fetch.Headers.CONTENTTYPE);if(r&&-1===r.indexOf(e))throw Error(this._fetch.ErrorType.UNEXPECTEDCONTENTTYPE);return t}},t.fetchImage=function(e,t={}){const r=this;return t.forImage=!0,new Promise((function(n,i){if(r.cacheHost.is(e,t))r.cacheHost.getAction(e,t).then((function(o){t.sameOrigin=r._isSameOrigin(o.action(e)),r._image.getImgTagByAction(e,t,o.action).then((function(e){n(e)}),(function(e){i(e)}))})).catch((e=>i(e)));else{var o=r.cacheHost.addKey(e,t);o._actionPromise=new Promise((function(a,s){const h=function(e,i){o.action=i.bind(r),o.exportable=t.exportable,a({action:o.action}),n(e)},d=function(n){s(n),n.status,r.cacheHost.removeKey(e,t),i(n)};!function(t){r._isSameOrigin(e)?(t.sameOrigin=!0,r._image.getImgTag(e,t).then((function(e){h(e,r._actionDirect)}),d)):r._isSecureURL(e)?r._image.getImgTag(e,t).then((function(e){h(e,r._actionDirect)}),(function(n){t.exportable&&n===r._image.ErrorType.CORS||r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?n===r._image.ErrorType.PROTOCOL&&t.ignoreProxification||405===n?.status?d(n):u.call(r,e,t,h,d):405===n.status?d(n):c.call(r,e,t,h,d)})):r._isServiceWorker()||r._isSecureURL(r._location)&&r.preventMixedContent?l.call(r,e,t,h,d):r._image.getImgTag(e,t).then((function(e){h(e,r._actionDirect)}),(function(n){t.exportable&&n===r._image.ErrorType.CORS||!r._isSecureURL(r._location)?n===r._image.ErrorType.PROTOCOL&&t.ignoreProxification?d(n):u.call(r,e,t,h,d):l.call(r,e,t,h,d)}))}(t)})),o._actionPromise.catch((function(o){!o.status||o.status>=400?i(o):n(r.fetch(e,t))}))}}))},t.fetchRetry=function(e,t,r){const n=this;var i=fetch;return t.sync&&(i=n.fetchSync),i(e,t).catch((function(i){if(1===r)throw i;return n.fetchRetry(e,t,r-1)}))},t.fetchSync=function(e,t){var r=this;return new Promise((function(n,i){"Symbol"in r&&Symbol;var o="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}(),a=new Request(e,t),s=new XMLHttpRequest;s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new Headers,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;n(new Response(i,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(a.method,a.url,!1),"include"===a.credentials?s.withCredentials=!t.sync:"omit"===a.credentials&&(s.withCredentials=!1),!t.sync&&"responseType"in s&&o&&(s.responseType="blob"),a.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),s.send(void 0===a._bodyInit?null:a._bodyInit)}))},t.fetchXML=function(e,t={}){const r={...t};return r.responseType="xml",this.fetch(e,r)},t.fetchJSON=function(e,t={}){const r={...t};return r.responseType=i.A.mimeType.JSON,this.fetch(e,r)},t.fetchBlob=function(e,t={}){const r={...t};return r.responseType="blob",this.fetch(e,r)},t.fetchImageAsBlob=function(e,t={}){const r={...t};return r.responseType="image",this.fetch(e,r)},t.fetch=function(t,r){const n=this;(r=r||{}).type&&(r.method=r.type,delete r.type),r.data&&(r.body=r.data,delete r.data),r.contentType&&(r.headers=new Headers,r.headers.append("Content-Type",r.contentType),delete r.contentType),r.responseType||(r.responseType="");var o=function(e,t,r,a){return(t.retryAttempts?n.fetchRetry(r[0].call(n,e),t,t.retryAttempts):fetch(r[0].call(n,e),t)).then(n._fetch.validateResponse).then(n._fetch.validateContentType.bind(n,t.responseType)).then((function(e){a&&(a.action=r[0].bind(n));const o=e.headers.get(n._fetch.Headers.CONTENTTYPE);if(t.nomanage)return Promise.resolve(e);const s=function(t){return e.blob().then((function(e){const r=new FileReader;return new Promise((function(n,i){r.addEventListener("error",(function(){r.abort(),i(new DOMException("Problem decoding"))})),r.addEventListener("loadend",(function(){n(r.result)})),r.readAsText(e,t)}))})).catch((function(e){throw e}))};let l;switch(!0){case t.responseType.indexOf("xml")>-1:case t.responseType.indexOf("text/xml")>-1:case t.responseType.indexOf(i.A.mimeType.XML)>-1:return l=/charset=([^;]*)/i.exec(o),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).catch((function(e){throw e})):e.text().then((function(e){return(new window.DOMParser).parseFromString(e,"text/xml")})).catch((function(e){throw e}));case t.responseType.indexOf("arraybuffer")>-1:return e.arrayBuffer();case t.responseType.indexOf("image")>-1:case t.responseType.indexOf("blob")>-1:case t.responseType.indexOf("application/zip")>-1:case t.responseType.indexOf("application/x-zip-compressed")>-1:case t.responseType.indexOf("application/vnd.google-earth.kmz")>-1:case t.responseType.indexOf("application/octet-stream")>-1:case t.responseType.indexOf("application/geopackage+sqlite3")>-1:return e.blob().then((function(e){return new Blob([e],{type:o})})).catch((function(e){throw e}));case t.responseType.indexOf("document")>-1:throw new DeveloperError("Unhandled responseType: "+t.responseType);case t.responseType.indexOf(i.A.mimeType.JSON)>-1:return e.json();case""==t.responseType:case t.responseType.indexOf("text")>-1:default:return l=/charset=([^;]*)/i.exec(o),l&&2===l.length&&"UTF-8"!==l[1]?s(l[1]).then((function(e){return""==t.responseType?{responseText:e,contentType:o}:e})).catch((function(e){throw e})):e.text().then((function(e){return""==t.responseType?{responseText:e,contentType:o}:e})).catch((function(e){throw e}))}})).catch((function(n){return 1===r.length||n.status&&500===n.status?(console.log("request failed",n),Promise.reject(n)):(r.shift(),o(e,t,r,a))}))};if(n.cacheHost.is(t,r))return new Promise((function(e,i){n.cacheHost.getAction(t,r).then((function(n){e(o(t,r,[n.action]))})).catch((function(o){!o.status||o.status>=400?i(o):e(n.fetch(t,r))}))}));var a=n.cacheHost.addKey(t,r);return new Promise((function(i,s){a._actionPromise=new Promise((function(l,c){t=e(t).href;const u=function(e){l({action:a.action}),i(e)},h=function(e){n.cacheHost.removeKey(t,r),c(e),s(e)};n._isSameOrigin(t)?o(t,r,[n._actionDirect,n._actionProxy],a).then(u).catch(h):n._isSecureURL(t)?n._isServiceWorker()?o(t,r,[n._actionDirect,n._actionProxy],a).then(u).catch(h):o(t,r,n._isSecureURL(n._location)?[n._actionDirect,n._actionProxy]:[n._actionDirect,n._actionHTTP,n._actionProxy],a).then(u).catch(h):n._isServiceWorker()?o(t,r,[n._actionHTTPS,n._actionProxy],a).then(u).catch(h):o(t,r,n._isSecureURL(n._location)?[n._actionHTTPS,n._actionProxy]:[n._actionDirect,n._actionHTTPS,n._actionProxy],a).then(u).catch(h)})),a._actionPromise.catch((e=>s(e)))}))},t.fetchFile=function(e,t={}){const r=this,n={...t};return n.nomanage=!0,new Promise((function(t,i){r.fetch(e,n).then((function(n){const i=n.headers.get(r._fetch.Headers.CONTENTDISPOSITION);var o=new RegExp(/[\w|\-|\.]+.\w{1,}$/gi).exec(e)[0];if(i&&/(attachment);([^;]*)/gi.test(i))try{o=/filename\*?=\"?([\w|\-|\.]*\'\')?(.*\.\w*)\"?/gi.exec(i)[2]}catch(e){try{o=i.substring((i.lastIndexOf("'")||i.indexOf("="))+1)}catch(e){}}n.blob().then((function(e){t(new File([e],o,{type:n.headers.get(r._fetch.Headers.CONTENTTYPE)}))}))})).catch(i)}))}}();const o=n.A.tool.Proxification},8994:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(5777),l=r(3791);n.A.control=n.A.control||{};class c{constructor(){this.zoomToInitialExtent=""}}class u extends a.A{render(){const e=this;e.wrap||(e.wrap=new n.A.wrap.control.NavBarHome(e));const t=Promise.resolve();return e._firstRender??=t,t}async register(e){const t=this,r=super.register.call(t,e);return t.wrap.register(e),e.on(i.A.event.PROJECTIONCHANGE,(function(r){const n=r.newCrs,i=o.A.reproject([e.options.initialExtent[0],e.options.initialExtent[1]],e.options.crs,n),a=o.A.reproject([e.options.initialExtent[2],e.options.initialExtent[3]],e.options.crs,n);t.wrap.setInitialExtent([i[0],i[1],a[0],a[1]])})),await r,t.model=new c,t.controller=new s.A(t.model,new l.A(t.div)),t.model.zoomToInitialExtent=t.getLocaleString("zoomToInitialExtent"),t}async updateLanguage(){this.model.zoomToInitialExtent=this.getLocaleString("zoomToInitialExtent")}}u.prototype.CLASS="tc-ctl-nav-home",n.A.control.NavBarHome=u;const h=u},9096:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});var n=r(8038),i=r(5357);n.A.control=n.A.control||{};class o extends i.default{async loadTemplates(){await super.loadTemplates();const e=this,t=await r.e(6720).then(r.bind(r,6720));e.template={[e.CLASS]:e.template,[e.CLASS+"-ext-dldlog"]:t.default}}async open(e,t){await super.open(e,t);const r=await this.getRenderedHtml(self.CLASS+"-ext-dldlog"),n=this.modalBody.querySelector("."+this.CLASS+"-ext");n?.insertAdjacentHTML("beforend",r)}addUIEventListeners(){super.addUIEventListeners(),this.modalBody&&this.modalBody.addEventListener("change",n.A.EventTarget.listenerBySelector('input[type=radio][name$="-dldlog-source"]',(function(e){})))}}n.A.control.TrackDownloadDialog=o;const a=o},9105:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var n=r(1256);class i extends n.A{getInfoContainer(){return null}}const o=i},9239:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CreateSymbolizer:()=>I,default:()=>M});var n=r(8038),i=r(797),o=r(3301),a=r(1845),s=r(5112),l=r(6014),c=r(3343);n.A.control=n.A.control||{};const u="tc-ctl-layer-legend",h="sitna-layer-legend",d="tc-ctl-layer-legend-loading",p={fill:"transparent",stroke:"transparent","stroke-width":1},g={fill:"transparent",stroke:"transparent","stroke-width":1},f={fill:"transparent","stroke-opacity":"1","stroke-width":1},m=20,y=20,v='<svg xmlns="http://www.w3.org/2000/svg" height="{height}" width="{width}" {viewBox}>{inner}</svg>',A='<circle cx="{x}" cy="{y}" r="{r}" {style} />',S=function(e){const t=[];for(var r in delete e.mark,e)e[r]instanceof Object?e[r]instanceof Array?t.push(r+'="'+e[r].join(" ")+'"'):(e[r].rotation&&(t.push('transform="rotate('+e[r].rotation+')"'),t.push('transform-origin="50% 50%"')),e[r].opacity&&Number(e[r].opacity)<1&&t.push('opacity="'+e[r].opacity+'"')):("stroke-width"===r&&Number(e[r])<1&&(e[r]=1),t.push(r+'="'+e[r]+'"'));return t.join(" ")},E=function(e){const t=[];return e.rotation&&t.push("rotate("+e.rotation+"deg)"),t.length?'style="transform:'+t.join(";")+';transform-origin: 50% 50%"':""},w=(e,t,r)=>{const n=(new ol.format.WKT).readGeometry(e.substring(e.lastIndexOf("/")+1)).getCoordinates(),i=e.substring(e.lastIndexOf("/")+1,e.indexOf("(")),o=e=>e.reduce(((e,n,i)=>(n=n.map(((e,n)=>e*t+(n?r:0))),e+(i?" L":"")+n)),"M");switch(i.toUpperCase()){case"LINESTRING":return o(n);case"MULTILINESTRING":case"POLYGON":return n.reduce(((e,t,r)=>e+(r?" ":"")+o(t)),"");case"MULTIPOLYGON":return n.reduce(((e,t,r)=>e+(r?" ":"")+t.reduce(((e,t,r)=>e+(r?" ":"")+o(t)),"")),"")}return""},_=async function(e,t,r){const i=-5-30*e,o=t.indexOf("LEGEND_OPTIONS=")+15,a=new URL(t.substring(0,o)+"forceTitles%3Aoff%3BforceLabels%3Aon%3B"+t.substring(o)+"&WIDTH=30&HEIGHT=30",document.location).href,s=await(e=>r(e).then((e=>new Promise(((t,r)=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.onerror=r,n.readAsDataURL(e)})))))(a);return n.A.Util.formatTemplate('<image x="{x}" y="{y}" href="{src}" />',{x:-5,y:i,width:30,height:30,src:s})},L=async function(e,t){var r=new Array(2);const i=e.map((async(e,i)=>{const a=await async function(e,t,r,i){const a=[];let s=m,u=y,h=null;const d=[...e?.symbolizers||[],...e.graphics&&!n.A.Util.isEmptyObject(e.graphics)?[e.graphics]:[]].map((async(e,t,d)=>{if(!e.Raster?.colormap){const t=[];try{if(h=new Number(d.reduce(((e,t)=>!t?.Point?.size||new Number(t?.Point?.size)<=e?e:new Number(t.Point.size)),0)||d.reduce(((e,t)=>!t?.Line?.["graphic-stroke"]?.size||t?.Line?.["graphic-stroke"]?.size<=e?e:t.Line?.["graphic-stroke"].size),0)||m),h>y&&(u=h),e.Line)if(e.Line["graphic-stroke"])if(e.Line["graphic-stroke"].graphics?.length)t.push(await async function(e,t){const r=[],i=n.A.getUID(),o=e["graphic-stroke"].graphics.map((async r=>{const i=e=>{if(e){let r=[];return e.rotate&&r.push(n.A.Util.formatTemplate("rotate({angle} {x} {y})",{angle:e.rotate,x:t/2,y:t/2})),e.translate&&r.push(n.A.Util.formatTemplate("translate({x} {y})",{x:e.translate[0],y:e.translate[1]})),0===r.length?"":'transform="'+r.join(" ")+'"'}return""};switch(!0){case!!r["external-graphic-url"]:try{return(await C(r,e["graphic-stroke"].size,!0)).data}catch(e){return""}case"shape://oarrow"===r.mark:{let i=Number(r["stroke-dasharray"][0])-Number(e["graphic-stroke"].size)/t*Number(r["stroke-dasharray"][0]);return n.A.Util.formatTemplate(((e,t)=>{const r=13/15;return'<path d="M'+(e-t)+" "+r*e/2+" L"+(1+t)+" "+(r*e-t)+" L"+(1+t)+" "+(1+t)+' Z" {style} transform="translate(0 '+(y-e)/2+')" />'})(Number(r["stroke-dasharray"][0]),i/2),{style:S(Object.assign({},r,{"stroke-dasharray":""}))})}case r.mark?.startsWith("extshape"):if(r.mark.endsWith("emicircle")){let e=5;return n.A.Util.formatTemplate('<path d="M{w},{h} a1,1 0 0,0 -{size},0" {style} />',{w:e/2+e/2,h:e/2,size:e,style:S(r)})}return"";case"triangle"===r.mark:{const o={translate:[(y-t)/2,0]};return o.rotate=e["graphic-stroke"].rotation,n.A.Util.formatTemplate('<path d="M0 {W} L{W} {W} L{w2} 0 Z" {style} {transform} />',{w2:t/2,W:t,style:S(r),transform:i(o)})}case r.mark?.startsWith("wkt"):return n.A.Util.formatTemplate('<path d="{path}" {style} />',{path:w(r.mark,e["graphic-stroke"].size,10),style:S(Object.assign({},f,r))});case"circle"===r.mark:return n.A.Util.formatTemplate(A,{r:t/2,x:t/2+Number(r["stroke-width"]||0)/2,y:10,style:S(Object.assign({},f,r))});default:return""}})),a=await Promise.all(o);return r.push(n.A.Util.formatTemplate('<defs><pattern id="{patternId}" x = "{x}" y = "{y}" width = "{w}" height = "{h}" patternUnits = "userSpaceOnUse">{innerPath}</pattern></defs>',{w:e["stroke-dasharray"]?.[1]||m,h:Math.max(t,y),y:0,x:e["stroke-dasharray"]?.[0]||0,patternId:i,innerPath:a.join(" ")||await(async e=>e.url?(await C(e,20)).data:"")(e["graphic-stroke"])})),r.push(n.A.Util.formatTemplate('<line x1="0" y1="{y}" x2="{w}" y2="{y}" stroke="url(#{patternId})" shape-rendering="crispEdges" stroke-width="{h}" {style} />',{y:Math.max(t,y)/2,w:m,h:Math.max(t,y),patternId:i,style:""})),r}(e.Line,h));else try{const r=await C(e.Line["graphic-stroke"].graphics[0]);s=Math.max(s,r.imageSize.width),u=Math.max(s,r.imageSize.height),t.push(r.data)}catch(e){t.push("")}else t.push(n.A.Util.formatTemplate(c.line,{x1:0,y1:Math.max(u,y)/2,x2:Math.max(s,m),y2:Math.max(u,y)/2,style:S(e.Line)}));if(e.Point){const r=new l.default(y,m);for(var L=0;L<e.Point?.graphics.length;L++)if(e.Point?.graphics[L].mark){const n=e.Point.graphics[L],i=n["stroke-width"]?Math.max(Number(n["stroke-width"]),1):0;switch(h>m&&(u=s=h+2*i),n.mark){case"square":t.push(r.square(h,s,S(Object.assign({},g,n)),E(e.Point)));break;case"triangle":t.push(r.triangle(h,s,S(Object.assign({},g,n)),E(e.Point)));break;case"star":t.push(r.star(h,s,S(Object.assign({},g,n)),E(e.Point)));break;case"cross":t.push(r.cross(h,s,S(Object.assign({},g,n)),E(e.Point)));break;case"circle":t.push(r.circle(h,s,S(Object.assign({},g,n)),E(e.Point)));break;default:if(n.mark.startsWith("ttf://")&&o.A.fontSupported(n.mark.slice(6,n.mark.lastIndexOf("#"))))t.push(x(n,e.Point.size));else{const r=await C(e.Point,h);s=Math.max(s,r.imageSize.width),u=Math.max(s,r.imageSize.height),t.push(r.data)}}}else try{const r=await C(e.Point?.graphics[L],h);s=Math.max(s,r.imageSize.width),u=Math.max(s,r.imageSize.height),t.push(r.data)}catch(e){t.push("")}}if(e.Polygon){var b="";if(e.Polygon["vendor-options"])return[await _(i,r.getLegendFormatUrl(name,!1,!0),r.proxificationTool.fetchImageAsBlob.bind(r.proxificationTool))];{if(e.Polygon["graphic-fill"]?.graphics?.length){const t=n.A.getUID();b=function(e,t,r){const i=Number(e.size)+2*Number(r?.["graphic-margin"]||0);var o=n.A.Util.formatTemplate('<defs><pattern id="{patternId}" x = "0" y = "{y}" width = "{w}" height = "{h}" patternUnits = "userSpaceOnUse" >',{w:i,h:i,patternId:t,y:i});return e.graphics.forEach((t=>{switch(t.mark){case"shape://slash":case"shape://backslash":case"shape://vertline":case"shape://horline":o+=((e,t)=>{const r='<line x1="{x1}" y1="{y1}" x2="{x2}" y2="{y2}" shape-rendering="crispEdges" {style} />';switch(e.mark){case"shape://slash":return n.A.Util.formatTemplate(r,{x1:t,y1:0,x2:0,y2:t,style:S(e)});case"shape://backslash":return n.A.Util.formatTemplate(r,{x1:0,y1:0,x2:t,y2:t,style:S(e)});case"shape://vertline":return n.A.Util.formatTemplate(r,{x1:t/2,y1:0,x2:t/2,y2:t,style:S(e)});case"shape://horline":return n.A.Util.formatTemplate(r,{x1:0,y1:t/2,x2:t,y2:t/2,style:S(e)});case"shape://dot":return n.A.Util.formatTemplate(A,{x:0,y:0,r:t,style:S(e)})}})(t,i);break;case"shape://dot":o+=((e,t)=>{if("shape://dot"===e.mark)return n.A.Util.formatTemplate(A,{x:t/2,y:t/2,r:1,style:S(e)})})(t,i);break;default:t.mark?.startsWith("ttf")&&(o+=((e,t)=>{const r=/ttf:\/\/(?<font>.+)\#(?<char>\d+)/gim.exec(e.mark).groups;return n.A.Util.formatTemplate('<text x="0" y="{size}" font-family="{font}" font-size="{size}px" {style} >&#{char};</text>',{size:t,font:r.font,char:r.char,style:S(e)})})(t,Number(e.size)))}})),o+="</pattern></defs >"}(e.Polygon["graphic-fill"],t,e.Polygon["vendor-options"]),e.Polygon.fill="url(#"+t+")"}const r=new l.default(y,m);t.push(b+r.square(m,m,S(Object.assign({},p,e.Polygon)),""))}}if(e.Text)if(e.Text?.fonts.some((e=>o.A.fontSupported(e["font-family"]))))t.push(await T(e.Text,d.filter((t=>t!==e&&!t["external-graphic-type"])).length?"x":null));else try{const r=await C(e.Text.graphics[0],h,!0);s=Math.max(s,r.imageSize.width),u=Math.max(u,r.imageSize.height),t.push(r.data)}catch(e){t.push("")}}catch(r){if(e["external-graphic-url"]&&!d.filter((t=>t!==e)).every((e=>e.Text)))try{const r=await C(e,h,!0);s=Math.max(s,r.imageSize.width),u=Math.max(u,r.imageSize.height),t.push(r.data)}catch(e){t.push("")}}return t}{const t='<rect width="{width}" height="{height}" fill="{color}" />';await e.Raster.colormap.entries.map((async function(e){a.push({src:"data:image/svg+xml;base64,"+window.btoa(n.A.Util.formatTemplate(v,{width:m,height:y,viewBox:"",inner:n.A.Util.formatTemplate(t,{width:m,height:y,color:e.color})})),value:e.label})}))}}));if(!d)return[];const L=await Promise.all(d);if(L.every((e=>!e)))return a;const b=L.find((e=>e.find&&e.find((e=>e.indexOf("text")>=0&&e.indexOf("pattern")<0))));var P;if(b&&b.length){const e=(new DOMParser).parseFromString(b[0],"text/xml").firstChild,t=document.createElement("canvas").getContext("2d");t.font=[e.attributes["font-size"].value+"px",e.attributes["font-family"]?.value||"",e.attributes["font-weight"]?.value||""].join(" "),P=t.measureText(e.innerText||e.innerHTML).width+2*parseInt(e.attributes["stroke-width"]?.value||0)}return[{src:"data:image/svg+xml;base64,"+window.btoa(n.A.Util.formatTemplate(v,{width:Math.max(P||0,m,s),height:Math.max(y,u),viewBox:"",inner:L.join("")})),value:t}]}(e,e.title||e.name||"",t,i);return r.splice(i,0,...a),a}));return await Promise.all(i),r},C=async function(e,t,r){var i=e["external-graphic-url"]?e["external-graphic-url"]:e.url;if(!i)throw new Error("URL vacía");i.indexOf("image/png")&&e["external-graphic-type"]&&"image/svg+xml"==e["external-graphic-type"]&&(i=i.replace("image/png","image/svg+xml"));try{const o=await b(i);let a,s=0,l=0;return o.width>m&&o.height>y?a=o.width*t/Math.max(t,o.height):(a=o.width,t=o.height),o.height<y?l=(y-o.height)/2:t<y&&(l=(y-t)/2),a<m&&(s=(m-a)/2),r&&(s=(m-a)/2),e.geometry&&1==e.geometry.indexOf("endPoint")>=0&&(s=m-a),{data:n.A.Util.formatTemplate('<image x="{x}" y="{y}" width="{width}" height="{height}" href="{url}" style="transform-origin:50% 50%" />',{x:s,y:l,width:a,height:Math.min(t,o.height),url:o.base64Data}),imageSize:{width:a<m?m:a,height:t<y?y:t}}}catch(e){throw new Error("img load error")}},b=function(e){return new Promise((function(t,r){var i=new Image;i.onload=async function(){let r;var n;e.startsWith("http")&&(r=await(n=i.src,fetch(n).then((e=>e.blob())).then((e=>new Promise((t=>{let r=new FileReader;r.onload=function(){t(this.result)},r.readAsDataURL(e)})))))),t({width:i.width,height:i.height,base64Data:r||e})},i.onerror=function(e){r(e)},i.src=e.startsWith("http")?n.A.proxify(e):e}))},T=async function(e,t){const r='<text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" {styles}>'+(t||"ABC")+"</text>";if(e?.fonts?.length){const t=e.fonts.map((e=>Object.assign(e,{"font-family":e["font-family"].join(",")})))[0],i=Object.entries(t).reduce(((e,t)=>e.concat(t[0]+'="'+t[1]+'"')),[]);return e.fill&&i.push('fill="'+e.fill+'"'),e["fill-opacity"]&&i.push('fill-opacity="'+e["fill-opacity"]+'"'),e.halo&&(i.push('stroke="'+e.halo.fill+'"'),Object.prototype.hasOwnProperty.call(e.halo,"fill-opacity")&&i.push('stroke-opacity="'+e.halo["fill-opacity"]+'"'),i.push('stroke-width="'+Math.round(e.halo.radius)+'"'),i.push('paint-order="stroke"')),n.A.Util.formatTemplate(r,{styles:i.join(" ")})}return""},x=(e,t)=>{const r=/ttf:\/\/(?<font>.+)\#(?<char>\d+)/gim.exec(e.mark).groups;return n.A.Util.formatTemplate('<text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="{font}" font-size="{size}px" {style} >&#{char};</text>',{size:t,font:r.font,char:r.char,style:S(e)})};class P extends a.default{CLASS=u;#t="."+u;#Qo;#Hn;#ea;static=!1;#ta=!1;#ra=!1;constructor(){super(...arguments);const e=this;e.initProperty("layerId"),e.initProperty("static"),e.#Qo=e.options.layer}async replaceSymbolizer(e,t){const r=this;if(e.children?.length)for(var n=e.children.length-1;n>=0;n--)await r.replaceSymbolizer(e.children[n],t);else if(e.name){t=t?.reduce(((e,t)=>t?e.concat(t):e),[]);var i=t.findByProperty("layerName",e.name.substring(e.name.indexOf(":")+1))||(r.#Qo.names.includes(e.name)&&t.length==r.#Qo.names.length?t[r.#Qo.names.indexOf(e.name)]:null);if(i)try{e.legend=i.rules?await L(i.rules,r.#Qo):[{src:i.src}]}catch(e){console.error(e)}else e.parent.children.splice(e.parent.children.indexOf(e),1),e=null}}async getLegend(){const e=this;if(e.#Qo&&e.#Qo.map&&e.#Qo instanceof SITNA.layer.Raster)if(e.#Qo.availableNames.some((t=>e.#Qo.isVisibleByScale(t)))||!e.#ta)if(e.innerHTML="",(e.#Qo?.map||e.#ea).magnifier.hideMagnifier(),e.classList.add(d),e.#Qo.getVisibility()||e.#ta)try{var t=await e.#Qo.getLegend(e.#ta||e.#ra);t=t?.filter((e=>e)),t&&t.length?await e.setData(t):await e.setData(!1)}catch(t){await e.setData(null),e.unBindZoomEvent()}else await e.setData(!1);else e.innerHTML=""}async setData(e){const t=this,r=t.#Qo.getNestedTree?t.#Qo.getNestedTree():t.#Qo.getTree();"boolean"!=typeof e||e?(e&&e.length&&await t.replaceSymbolizer(r,e),t.renderData(r,(function(){t.classList.remove(d),t.querySelector(".tc-ctl-legend-node").dataset.layerId=t.dataset.layerId,t.dispatchEvent(new CustomEvent("update",{composed:!0,bubbles:!0}))}))):t.classList.remove(d)}async register(e){const t=this;t.controller=new AbortController;const r=e.layers.findByProperty("id",this.dataset.layerId);if(!(r instanceof SITNA.layer.Raster))return;t.#ra=(await(r.describeLayer?.(!0)))?.every((e=>"WCS"===e.owsType)),t.#ta=e.on3DView,t.#ea=e,t.#Qo||(t.#Qo=r);let a=null;const l=function(e){a&&(clearTimeout(a),a=null),a=setTimeout((()=>{t.getLegend()}),300)},c=function(e){(e.layer.getVisibility()||t.#ta)&&t.getLegend()};t.unBindZoomEvent=()=>{e.off(i.A.event.ZOOM,l)},t.#ra||t.#ta||(e.on(i.A.event.ZOOM,l),e.on(i.A.event.LAYERVISIBILITY,c)),e.on(i.A.event.LAYERREMOVE,(function(r){r.layer===t.#Qo&&(e.off(i.A.event.ZOOM,l),t.parentNode?.removeChild(t),t.remove())}),{signal:t.controller.signal}),e.on(i.A.event.LAYERVISIBILITY,c,{signal:t.controller.signal}),e.magnifier||(e.magnifier=new s.default(3,{textToOpen:o.A.getLocaleString(e.options.locale,"clickToEnlarge"),textToClose:o.A.getLocaleString(e.options.locale,"clickToClose")}),document.body.appendChild(e.magnifier)),e.on(n.A.Consts.event.VIEWCHANGE,(function(r){r.currentTarget.on3DView?(t.#ta=!0,e.off(i.A.event.ZOOM,l),e.off(i.A.event.LAYERVISIBILITY,c),t.getLegend()):(t.#ta=!1,e.on(i.A.event.ZOOM,l),e.on(i.A.event.LAYERVISIBILITY,c),t.getLegend())}),{signal:t.controller.signal}),t.getLegend()}async unregister(e){this.controller.abort(),this.controller=null,this?.#ea?.magnifier&&1===this?.#ea.controls.filter((e=>e.tagName===this.tagName)).length&&(this.#ea.magnifier=null)}async loadTemplates(){const e=await r.e(585).then(r.bind(r,585));this.template=e.default}}customElements.get(h)||customElements.define(h,P),n.A.control.LayerLegend=P;const M=P;async function I(e,t){return await L(e,t)}},9332:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var n=r(25),i=r(4238),o=r(3530),a=r(1685);class s extends n.A{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const r=this.listeners_||(this.listeners_={}),n=r[e]||(r[e]=[]);n.includes(t)||n.push(t)}dispatchEvent(e){const t="string"==typeof e,r=t?e:e.type,n=this.listeners_&&this.listeners_[r];if(!n)return;const o=t?new a.Ay(e):e;o.target||(o.target=this.eventTarget_||this);const s=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});let c;r in s||(s[r]=0,l[r]=0),++s[r];for(let e=0,t=n.length;e<t;++e)if(c="handleEvent"in n[e]?n[e].handleEvent(o):n[e].call(this,o),!1===c||o.propagationStopped){c=!1;break}if(0==--s[r]){let e=l[r];for(delete l[r];e--;)this.removeEventListener(r,i.tV);delete s[r]}return c}disposeInternal(){this.listeners_&&(0,o.I)(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return!!this.listeners_&&(e?e in this.listeners_:Object.keys(this.listeners_).length>0)}removeEventListener(e,t){if(!this.listeners_)return;const r=this.listeners_[e];if(!r)return;const n=r.indexOf(t);-1!==n&&(this.pendingRemovals_&&e in this.pendingRemovals_?(r[n]=i.tV,++this.pendingRemovals_[e]):(r.splice(n,1),0===r.length&&delete this.listeners_[e]))}}const l=s},9433:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var n=r(8038),i=r(1256),o=r(5777),a=r(3791);n.A.control=n.A.control||{};class s{constructor(){this.zoomIn="",this.zoomOut="",this.zoomBar=""}}class l extends i.A{render(){const e=this;e.wrap||(e.wrap=new n.A.wrap.control.NavBar(e));const t=Promise.resolve();return e._firstRender??=t,t.then((()=>{})),t}async register(e){const t=this,r=super.register.call(t,e);return t.wrap.register(e),(void 0===t.options.home||t.options.home)&&await e.addControl("navBarHome"),e.loaded((function(){t.wrap.refresh()})),await r,t.model=new s,t.controller=new o.A(t.model,new a.A(t.div)),t.model.zoomIn=t.getLocaleString("zoomIn"),t.model.zoomOut=t.getLocaleString("zoomOut"),t.model.zoomBar=t.getLocaleString("zoomBar"),t}async updateLanguage(){const e=this;e.model.zoomIn=e.getLocaleString("zoomIn"),e.model.zoomOut=e.getLocaleString("zoomOut"),e.model.zoomBar=e.getLocaleString("zoomBar")}}l.prototype.CLASS="tc-ctl-nav",n.A.control.NavBar=l;const c=l},9438:(e,t,r)=>{"use strict";r.d(t,{JH:()=>a,Jz:()=>o,KT:()=>i});var n=r(3530);function i(e,t,r,n,i){if(i){const i=r;r=function(o){return e.removeEventListener(t,r),i.call(n??this,o)}}else n&&n!==e&&(r=r.bind(n));const o={target:e,type:t,listener:r};return e.addEventListener(t,r),o}function o(e,t,r,n){return i(e,t,r,n,!0)}function a(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),(0,n.I)(e))}},9439:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(1651);class i extends n.A{STYLETYPE="marker";constructor(e,t){super(e,t),this.wrap.isNative(e)||(this.wrap.feature=e,this.wrap.createMultiMarker(e,t))}getCoordinates(e){return super.getCoordinates.call(this,e)}setCoordinates(e){if(e){if(!Array.isArray(e))throw new TypeError("Coordinates not valid for multimarker");Array.isArray(e[0])||(e=[e])}return super.setCoordinates.call(this,e)}getCoords(e){return this.getCoordinates(e)}setCoords(e){return this.setCoordinates(e)}}const o=i},9566:(e,t,r)=>{"use strict";r.d(t,{A:()=>u});var n=r(8038),i=r(797),o=r(3301),a=r(187),s=r(1256),l=r(7843);class c{STYLETYPE=i.A.geom.POLYGON;#na=!1;#ia=!1;#oa=i.A.visibility.VISIBLE;constructor(e,t){let r;this.wrap=new n.A.wrap.Feature,this.wrap.parent=this,this.wrap.isNative(e)&&(this.wrap.feature=e,e._wrap=this.wrap,r=this.wrap.getId(),this.geometry=this.wrap.getGeometry(),e._group&&(this.group=e._group),e._folders&&(this.folders=e._folders),this.setData(this.wrap.getData()));var i=this.options=o.A.extend(!0,{},t);this.id=r||i.id||n.A.getUID(),this.wrap.feature&&!r&&this.wrap.feature.setId(this.id),this.data=i.data||this.data||null,void 0===i.showsPopup?this.showsPopup=!0:this.showsPopup=i.showsPopup,i.showPopup&&(this.autoPopup=!0),this.layer=i.layer||null,i.selected&&this.select()}getPath(){let e=[];return this.folders?e=this.folders:(this.group??this.options.group)&&(e=[this.group??this.options.group]),e}setVisibility(e){if(!e&&this.showsPopup&&this.layer){var t=this.layer.map.getControlsByClass("TC.control.Popup").filter((function(e){return e.currentFeature===this}));if(t.length>0){const e=t[0];e.isVisible()&&e.hide()}}return(e&&this.#oa===i.A.visibility.NOT_VISIBLE||!e&&this.#oa===i.A.visibility.VISIBLE)&&(this.#oa=e?i.A.visibility.VISIBLE:i.A.visibility.NOT_VISIBLE,this.layer.wrap.setFeatureVisibility(this,e)),this}getVisibilityState(){return this.#oa}getId(){return this.wrap.getId()}setId(e){return this.id=e,this.wrap.setId(e),this}getBounds(){return this.wrap.getBounds()}setStyle(e){let t;if(null===e)t=null;else{const r=[this.getStyle(),e];this.layer?.styles?.[this.STYLETYPE]&&r.unshift(this.layer.styles[this.STYLETYPE]),this.layer?.map.options.styles?.[this.STYLETYPE]&&r.unshift(this.layer.map.options.styles[this.STYLETYPE]),a.A?.styles?.[this.STYLETYPE]&&r.unshift(a.A.styles[this.STYLETYPE]),t=o.A.mergeStyles(...r)}return this.wrap.setStyle(t),this}toggleSelectedStyle(e){return this.#na!==e&&(this.#na=e,this.wrap.toggleSelectedStyle(e)),this}getLegend(){return this._legend||(this._legend=this.wrap.getLegend()),this._legend}getCoordinates(e){const t=this,r=e?.geometryCrs||t.layer?.map?.crs,n=e?.crs||t.layer?.map?.options.utmCrs||a.A.utmCrs;return t.geometry=t.wrap.getGeometry(),r&&n&&r!==n?o.A.reproject(this.geometry,r,n):this.geometry}setCoordinates(e){const t=function(e){e.forEach((function(r,n){Array.isArray(r)?t(r):null===r?e[n]=null:"number"!=typeof r&&(console.log("Warning: coordinate does not have number type"),e[n]=parseFloat(r))}))};return Array.isArray(e)&&t(e),this.geometry=e,this.wrap.setGeometry(e),this}getCoords(){return this.getCoordinates()}setCoords(e){return this.setCoordinates(e)}getCoordsArray(){const e=function(e){return Array.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},t=function(t){return e(t)?[t]:t.reduce(r,[])},r=function(r,n){return e(n)?r.push(n):r=r.concat(t(n)),r};return t(this.getCoordinates())}getGeometryStride(){const e=this.getCoordsArray()[0];return e?e.length:0}getGeometryType(){return null}removeZ(){const e=this.getCoordsArray();return e[0]?.length>2&&(e.forEach((e=>e.length=2)),this.setCoordinates(this.geometry)),this}getData(){let e=null;return e=this.data?this.data:this.wrap.getData(),e}setData(e){if("string"==typeof e)this.data=e;else{for(var t in this.data={...this.data,...e},this.attributes=this.attributes||[],e){let r=this.attributes.find((e=>e.name===t));r?r.value=e[t]:this.attributes.push({name:t,value:e[t]})}this.wrap.setData(e)}return this}unsetData(e){delete this.data[e];const t=(this.attributes||[]).find((t=>t.name===e));return t&&this.attributes.splice(this.attributes.indexOf(t),1),this.wrap.unsetData(e),this}clearData(){return this.data={},this.attributes=[],this.wrap.clearData(),this}getInfo(e){let t=null;const r=e?.locale||this.layer?.map&&o.A.getMapLocale(this.layer.map),i=this.getData();if("object"==typeof i){var a=this.wrap.getTemplate();if(a)t=a.replace(/\$\[?(?:\w+\/)*([^><]+)\]/g,(function(e,t){return i[t]instanceof Object&&Object.prototype.hasOwnProperty.call(i[t],"value")?i[t].value:i[t]}));else{var s=[];const e=[],a=o.A.getLocaleString(r,"open"),c=o.A.getLocaleString(r,"linkInNewWindow"),u=function(e){let t;return t=o.A.isURL(e)?`<a href="${e}" target="_blank" title="${c}">${a}</a>`:void 0!==e?"number"==typeof e?o.A.formatNumber(e,r):e:"&mdash;",t},h=function(e){var t=[];if(e instanceof Array){const i="complexAttr_"+n.A.getUID();t.push(`<div class="tc-complex-attr"><input type="checkbox" id="${i}" /><div><label for="${i}" title="" class="tc-plus"></label>`),t.push(`<label for="${i}" title="" class="tc-title">${e.length} ${o.A.getLocaleString(r,"featureInfo.complexData.array")}</label><br/>`),t.push('<table class="tc-complex-attr"><tbody>'),e.forEach((e=>{t.push("<tr><td>"),(t=t.concat(h(e))).push("</td></tr>")})),t.push("</tbody></table></div></div>")}else if(e instanceof Object)if(e.getType){const r={type:e.getType(),coordinates:e.getCoordinates()};t=t.concat(h(r))}else{for(var i in t.push('<table class="tc-complex-attr"><tbody>'),e){if(t.push("<tr>"),e[i]&&e[i]instanceof Array){const r="complexAttr_"+n.A.getUID();t.push(`<th style="display:none">${i}</th>\n                                           <td><label for="${r}" class="tc-title">${i}</label><br/>`),(t=t.concat(h(e[i]))).push("</div></td>")}else if(e[i]&&e[i]instanceof Object){const r="complexAttr_"+n.A.getUID();t.push(`<th style="display:none">${i}</th>\n                                           <td><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="tc-plus"></label>`),t.push(`<label for="${r}" title="" class="tc-title">${i}</label><br/>`),(t=t.concat(h(e[i]))).push("</div></td>")}else t.push(`<th class="key">${i}</th>\n                                           <td class="value">`),(t=t.concat(h(e[i]))).push("</td>");t.push("</tr>")}t.push("</tbody></table>")}else t.push(u(e));return t};for(var l in i){const t=i[l],r=l.match(/^h(\d)_/i);r?e[r[1]]=t:"string"==typeof t||"number"==typeof t||void 0===t?s.push(`<tr><th>${l}</th><td>${u(t)}</td></tr>`):(s.push(`<tr><th>${l}</th><td>`),(s=s.concat(h(t))).push("</td></tr>"))}const d=e.map((function(e,t){if(e)return`<h${t}>${e}</h${t}>`})).filter((function(e){return e}));d.length&&(s=d.concat(s)),s.length>0&&(s.unshift('<table class="tc-attr">'),s.push("</table>"),t=s.join(""))}}else"string"==typeof i&&(t=i);return t||(t=this.title,this.group&&(t+=" "+this.group)),t||(t=o.A.getLocaleString(r,"noData")),t}getTemplate(){return this.wrap.getTemplate()||null}clone(){const e=this.wrap.cloneFeature();e._wrap=this.wrap;const t=new this.constructor(e,this.options);return this.folders&&(t.folders=this.folders.slice()),t}getStyle(){return this.wrap.getStyle()}async showPopup(e={}){const t=e instanceof s.A?e:e.control,r=this.layer?.map||t?.map;if(r){let s=t||this.popup;if(!s)for(var n=r.getControlsByClass("TC.control.Popup"),o=0,a=n.length;o<a;o++){var l=n[o];if(!l.caller){s=l;break}}return s||(s=await r.addControl("popup")),s.isVisible()&&s.currentFeature!==this&&s.hide(),s.currentFeature=this,r.getControlsByClass("TC.control.Popup").filter((e=>e!==s&&e.isVisible())).forEach((e=>e.hide())),s.getContainerElement()||await s.renderPromise(),s.setDragged(!1),this.wrap.showPopup(Object.assign({},e,{control:s})),r.trigger(i.A.event.POPUP,{control:s}),s.fitToView(!0),s.contentDiv.querySelectorAll("img").forEach((e=>e.addEventListener("load",(()=>s.fitToView())))),s}return null}async showResultsPanel(e={}){const t=e instanceof s.A?e:e.control,r=this.layer?.map||t?.map;if(r){let t;var n={content:"table",titles:{main:o.A.getLocaleString(r.options.locale,"rsp.title"),max:o.A.getLocaleString(r.options.locale,"rsp.title")}},a=r.getControlsByClass(l.default)[0];a?(n.position=a.POSITION.RIGHT,t=r.getControlsByClass("TC.control.ResultsPanel").find((e=>e.currentFeature===this)),t||(t=await a.addControl("resultsPanel",n))):(n.div=document.createElement("div"),r.div.appendChild(n.div),t=r.getControlsByClass("TC.control.ResultsPanel").find((e=>e.currentFeature===this)),t||(t=await r.addControl("resultsPanel",n))),t.currentFeature=this,0===r.getControlsByClass(l.default).length&&r.getControlsByClass("TC.control.ResultsPanel").filter((e=>"table"===e.options.content)).forEach((function(e){e.close()})),r.getControlsByClass("TC.control.ResultsPanel").filter((e=>t!==e)).forEach((function(e){e.currentFeature&&!e.chart&&e.close()})),t.menuDiv.innerHTML="",t.open(e.html||this.getInfo({locale:r.options.locale}),t.getInfoContainer()),new ResizeObserver((e=>{for(let t of e)t.target.querySelectorAll("h3, h4").forEach((function(e){e.addEventListener("mouseenter",(function(e){this.offsetWidth<this.scrollWidth?this.title=this.childNodes.item(0).textContent:this.title=""}),{passive:!0})}))})).observe(t.infoDiv);var c=function(e){r.off(i.A.event.VIEWCHANGE,c),t.close()};return r.on(i.A.event.VIEWCHANGE,c),t}return null}async showInfo(e={}){if(!n.A.control||!n.A.control.FeatureInfoCommons){const{default:e}=await Promise.resolve().then(r.bind(r,9687));n.A.control=n.A.control||{},n.A.control.FeatureInfoCommons=e}let t;t=this.getTemplate()?this.getInfo():"string"==typeof this.data?this.data:await n.A.control.FeatureInfoCommons.renderFeatureAttributeTable({attributes:this.attributes.filter((e=>!(e.value instanceof c))),singleFeature:!0});const a=o.A.extend({},e,{html:t});let s;if(e.control&&n.A.control){const t=e.control,{default:n}=await Promise.resolve().then(r.bind(r,3521)),{default:i}=await Promise.resolve().then(r.bind(r,1535));t instanceof n?s=await this.showPopup(a):t instanceof i&&(s=await this.showResultsPanel(a))}else s=this.layer.map.on3DView||this.layer.map.defaultInfoContainer===i.A.infoContainer.RESULTS_PANEL?await this.showResultsPanel(a):await this.showPopup(a);this.infoControl=s,this.toggleSelectedStyle(!0),n.A.control.FeatureInfoCommons.addSpecialAttributeEventListeners(s.getContainerElement())}select(){this.#ia=!0,this.layer&&this.layer.selectedFeatures.push(this);var e=this.options.selection||{};return this.setStyle(o.A.extend({},a.A.styles.selection[this.STYLETYPE],e[this.STYLETYPE])),this}unselect(){if(this.#ia=!1,this.setStyle(this.options),this.layer){const e=this.layer.selectedFeatures.indexOf(this);e>=0&&this.layer.selectedFeatures.splice(e,1)}return this}isSelected(){return this.#ia}toGML(e,t){return this.wrap.toGML(e,t)}}const u=c},9669:(e,t,r)=>{"use strict";r.d(t,{A:()=>Y});var n=r(3790),i=r.n(n),o=r(8038),a=r(797),s=r(187),l=r(3301),c=r(3408),u=r(153),h=r(3365),d=r(4450),p=r(6792),g=r(1126),f=(r(6394),r(4459),r(5794),r(6083),r(8848),r(7843)),m=(r(5272),r(2484),r(3387),r(5121),r(4532),r(3607),r(7088),r(2335),r(5357),r(8927)),y=(r(9687),r(7830),r(3721),r(780),r(1302),r(3093),r(5909),r(5264),r(2376),r(9683),r(3126),r(2875),r(2189),r(5874)),v=(r(3967),r(1421),r(1979),r(6052),r(3333),r(5882)),A=(r(9433),r(8994),r(2994),r(9770),r(8839),r(3521)),S=(r(5056),r(5232),r(7735),r(1535),r(4641),r(2180),r(4272),r(2639),r(6728),r(2268),r(3833),r(4128),r(1993),r(1783)),E=(r(2773),r(7633),r(4193),r(6378),r(8447)),w=(r(7018),r(1651),r(2948)),_=(r(8606),r(6257),r(6546),r(1667),r(6631));const L=new Blob([String.raw`/*
 Copyright (c) 2013, Rodrigo González, Sapienlab All Rights Reserved.
 Available via MIT LICENSE. See https://github.com/rgcl/jsonpack/blob/master/LICENSE.md for details.
 */
(function (n) { n([], function () { var f = -1, e = -2, i = -3, n = -4, r = -5, h = function (s, h) { var l, c, a; h = h || {}; l = h.verbose || !1; l && console.log("Normalize the JSON Object"); s = typeof s == "string" ? this.JSON.parse(s) : s; l && console.log("Creating a empty dictionary"); c = { strings: [], integers: [], floats: [] }; l && console.log("Creating the AST"); var y = function v(s) { var y, w, a, p, h; if (l && console.log("Calling recursiveAstBuilder with " + this.JSON.stringify(s)), y = typeof s, s === null) return { type: "null", index: i }; if (typeof s == "undefined") return { type: "undefined", index: r }; if (s instanceof Array) { a = ["@"]; for (w in s) s.hasOwnProperty(w) && a.push(v(s[w])); return a } if (y === "object") { a = ["$"]; for (p in s) s.hasOwnProperty(p) && (a.push(v(p)), a.push(v(s[p]))); return a } if (s === "") return { type: "empty", index: n }; if (y === "string") return h = u.call(c.strings, s), h == -1 && (c.strings.push(o(s)), h = c.strings.length - 1), { type: "strings", index: h }; if (y === "number" && s % 1 == 0) return h = u.call(c.integers, s), h == -1 && (c.integers.push(t(s)), h = c.integers.length - 1), { type: "integers", index: h }; if (y === "number") return h = u.call(c.floats, s), h == -1 && (c.floats.push(s), h = c.floats.length - 1), { type: "floats", index: h }; if (y === "boolean") return { type: "boolean", index: s ? f : e }; throw new Error("Unexpected argument of type " + typeof s); }(s), p = c.strings.length, w = c.integers.length, k = c.floats.length; return (l && console.log("Parsing the dictionary"), a = c.strings.join("|"), a += "^" + c.integers.join("|"), a += "^" + c.floats.join("|"), l && console.log("Parsing the structure"), a += "^" + function b(u) { var e, s, f, o; if (l && console.log("Calling a recursiveParser with " + this.JSON.stringify(u)), u instanceof Array) { e = u.shift(); for (s in u) u.hasOwnProperty(s) && (e += b(u[s]) + "|"); return (e[e.length - 1] === "|" ? e.slice(0, -1) : e) + "]" } if (f = u.type, o = u.index, f === "strings") return t(o); if (f === "integers") return t(p + o); if (f === "floats") return t(p + w + o); if (f === "boolean") return u.index; if (f === "null") return i; if (f === "undefined") return r; if (f === "empty") return n; throw new TypeError("The item is alien!"); }(y), l && console.log("Ending parser"), h.debug) ? { dictionary: c, ast: y, packed: a } : a }, c = function (t, u) { var p, v, o, w, h, a, k, c; if (u = u || {}, p = t.split("^"), u.verbose && console.log("Building dictionary"), v = [], o = p[0], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the strings dictionary"), h = 0, w = o.length; h < w; h++) v.push(l(o[h])); if (o = p[1], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the integers dictionary"), h = 0, w = o.length; h < w; h++) v.push(s(o[h])); if (o = p[2], o !== "") for (o = o.split("|"), u.verbose && console.log("Parse the floats dictionary"), h = 0, w = o.length; h < w; h++) v.push(parseFloat(o[h])); o = null; u.verbose && console.log("Tokenizing the structure"); var b = "", y = [], g = p[3].length; for (h = 0; h < g; h++) a = p[3].charAt(h), a === "|" || a === "$" || a === "@" || a === "]" ? (b && (y.push(s(b)), b = ""), a !== "|" && y.push(a)) : b += a; return k = y.length, c = 0, u.verbose && console.log("Starting recursive parser"), function d() { var h = y[c++], t, s, o; if (u.verbose && console.log("Reading collection type " + (h === "$" ? "object" : "Array")), h === "@") { for (t = []; c < k; c++) { if (o = y[c], u.verbose && console.log("Read " + o + " symbol"), o === "]") return t; if (o === "@" || o === "$") t.push(d()); else switch (o) { case f: t.push(!0); break; case e: t.push(!1); break; case i: t.push(null); break; case r: t.push(undefined); break; case n: t.push(""); break; default: t.push(v[o]) } } return u.verbose && console.log("Parsed " + this.JSON.stringify(t)), t } if (h === "$") { for (t = {}; c < k; c++) { if (s = y[c], s === "]") return t; if (s = s === n ? "" : v[s], o = y[++c], o === "@" || o === "$") t[s] = d(); else switch (o) { case f: t[s] = !0; break; case e: t[s] = !1; break; case i: t[s] = null; break; case r: t[s] = undefined; break; case n: t[s] = ""; break; default: t[s] = v[o] } } return u.verbose && console.log("Parsed " + this.JSON.stringify(t)), t } throw new TypeError("Bad token " + h + " isn't a type"); }() }, a = function (s, h) { var c = typeof h, l; if (c === "boolean") return h ? f : e; if (h === null) return i; if (typeof h == "undefined") return r; if (h === "") return n; if (c === "string" && (h = o(h), l = u.call(s.strings, h), l === -1 && (s.strings.push(h), l = s.strings.length - 1)), c !== "string" && c !== "number") throw new Error("The type is not a JSON type"); return c === "string" ? h = o(h) : h % 1 == 0 && (h = t(h)), h = c === "number" ? t(h) : o(h), l = u.call(s[c], h), l === -1 && (s[c].push(h), l = s[c].length - 1), c === "number" ? "+" + l : l }, o = function (n) { return typeof n != "string" ? n : n.replace(/[\+ \|\^\%]/g, function (n) { return { " ": "+", "+": "%2B", "|": "%7C", "^": "%5E", "%": "%25" }[n] }) }, l = function (n) { return typeof n != "string" ? n : n.replace(/\+|%2B|%7C|%5E|%25/g, function (n) { return { "+": " ", "%2B": "+", "%7C": "|", "%5E": "^", "%25": "%" }[n] }) }, t = function (n) { return Number.prototype.toString.call(n, 36).toUpperCase() }, s = function (n) { return parseInt(n, 36) }, u = Array.prototype.indexOf || function (n, t) { for (var i = t || 0, r = this.length; i < r; i++) if (this[i] === n) return i; return -1 }; return { JSON: JSON, pack: h, unpack: c } }) })(typeof define == "undefined" || !define.amd ? function (n, t) { var i = t(), r; if (typeof exports != "undefined") for (r in i) exports[r] = i[r]; else self.jsonpack = i } : define);

onmessage = function (e) {
    if (e.data.action) {
        try {
            const result = jsonpack[e.data.action](e.data.object);
            postMessage({
                id: e.data.id,
                action: e.data.action,
                result: result
            });
        }
        catch (error) {
            postMessage({
                id: e.data.id,
                action: e.data.action,
                error: error.toString()
            });
        }
    }
};
`],{type:"text/javascript; charset=utf-8"});r(5777),r(3791);var C=r(6031);o.A.EventTarget=c.A,o.A.i18n=o.A.i18n||u.A,o.A.wrap=g.A,o.A.control=o.A.control||{};var b=null,T=null;let x=0,P=0;Array.prototype.findLastIndex||(Array.prototype.findLastIndex=function(e,t){for(let r=this.length-1;r>=0;r--)if(e.call(t,this[r],r,this))return r;return-1});const M={},I=function(e,t){return new Promise((function(r,n){const i=function(){const e=URL.createObjectURL(L),t=new Worker(e);return t.onmessage=function(e){const r=M[e.data.id];r&&(e.data.error?r.reject(e.data.error):r.resolve(e.data.result),t.terminate(),delete M[e.data.id])},t}(),a=o.A.getUID();M[a]={resolve:r,reject:n};try{i.postMessage({id:a,action:e,object:t})}catch(e){n(e)}}))},R=l.A.isFunction(DataTransferItem.prototype.getAsFileSystemHandle),O=e=>e.type===a.A.layerType.WMS||R&&e.type===a.A.layerType.VECTOR&&e.file&&!e.stealth,D=async function(e){const t=this;var{state:r,index:n}=await t.exportState();if(t.replaceCurrent)return window.history.replaceState(r,null,null),void delete t.replaceCurrent;var i=function(){T=b,(b=l.A.utf8ToBase64(r))!==T&&n>P&&(P=n,window.history.pushState(r,null,window.location.href.split("#").shift()+"#"+b))};if(e){switch(t.lastEventType=e.type,!0){case e.type===a.A.event.BASELAYERCHANGE:case e.type===a.A.event.LAYERORDER:case e.type===a.A.event.ZOOM:i();break;case e.type===a.A.event.UPDATEPARAMS:e.layer.type===a.A.layerType.WMS&&i();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:O(e.layer)&&i()}t.trigger(a.A.event.MAPCHANGE)}},N=async function(e){const t=this,r=[];e&&await t.wait((async()=>{let n;if("string"==typeof e)try{n=await I("unpack",e)}catch(r){try{n=JSON.parse(e)}catch(e){return void o.A.error(l.A.getLocaleString(t.options.locale,"mapStateNotValid"))}}else n=e;if(n.crs&&n.crs!==t.crs||void 0===n.crs&&t.crs!==t.options.crs)r.push(t.setProjection({crs:n.crs||t.options.crs,oldCrs:t.crs,extent:n.ext,baseLayer:t.getLayer(n.base)}));else{if(n.base!=t.getBaseLayer().id){t.getLayer(n.base)&&t.setBaseLayer(n.base);const e=t.baseLayers.filter((function(e){return e.options.fallbackLayer===n.base}))[0];if(e){const n=t.addLayer(e.getFallbackLayer());r.push(n),n.then((function(e){t.setBaseLayer(e)}))}}n.ext&&r.push(t.setExtent(n.ext,{animate:!1}))}if(n.layers=n.layers||n.capas||[],n.layers.length>0)for(var i=0;i<n.layers.length;i++){var s=n.layers[i],c=!1;let e;for(var u=0;u<t.options.workLayers.length;u++)e=l.A.extend({},t.options.workLayers[u],{map:t}),s.u===e.url&&s.i===e.id&&(c=!0,e.renderOptions={opacity:s.o,hide:!s.v},e.unremovable=s.ur,e.title=s.t,e.hideTree=!Object.prototype.hasOwnProperty.call(s,"x")||!!s.x,s.n&&(e.layerNames=s.n),s.a&&(e.availableNames=s.a),r.push(t.addOrUpdateLayer(e).then(function(e){e.setVisibility(this.v),e.setOpacity(this.o,!0)}.bind(s))));if(!c){const e={id:s.i||o.A.getUID(),hideTitle:s.h,unremovable:s.ur,title:s.t,hideTree:!Object.prototype.hasOwnProperty.call(s,"x")||!!s.x,renderOptions:{opacity:s.o,hide:!s.v},groupIndex:s.g};s.fn?(e.type=a.A.layerType.VECTOR,e.file=s.fn):(e.url=l.A.isOnCapabilities(s.u,s.u.indexOf(window.location.protocol)<0)||s.u,e.layerNames=s.n?s.n.split(","):[]),r.push(t.addOrUpdateLayer(e).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title,e.setOpacity(this.o,!0),e.setVisibility(this.v)}.bind(s)))}}t.workLayers.filter((e=>O(e)&&!n.layers.some((t=>t.i===e.id)))).forEach((e=>t.removeLayer(e)));try{await Promise.all(r)}catch(e){o.A.error(e)}}))};var k={},F=function(){const e=this;var t=e;do{t=t.parentElement}while(t&&!t.matches("."+a.A.classes.TOAST_CONTAINER));const r=e.innerHTML;e.classList.add(a.A.classes.HIDDEN),void 0!==k[r]&&(k[r]=void 0),setTimeout((function(){e.parentElement&&e.parentElement.removeChild(e),t&&!t.querySelector("."+a.A.classes.TOAST)&&t.parentElement&&t.parentElement.removeChild(t)}),1e3)},G=!1,B=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.getBoundingClientRect.height===t+(matchMedia("only screen and (orientation : landscape)").matches?20:0)&&(G=!0)}var r=function(){e.classList.toggle(a.A.classes.IPAD_IOS7_FIX,matchMedia("only screen and (orientation : landscape)").matches)};G?(r(),window.addEventListener("resize",r)):window.removeEventListener("resize",r)};const U=l.A.createSemaphore();class q extends c.A{static _instances=[];isReady=!1;isLoaded=!1;controls=[];activeControl=null;layers=[];baseLayers=[];workLayers=[];baseLayer=null;availableBaseLayers=s.A.availableBaseLayers;#aa=null;div=null;RECENT_FILES_STORE_KEY_PREFIX="TC.fileImportRecent.";recentFiles=[];recentFileCount=8;_markerPromises=[];#sa;#la;constructor(e,t={}){super();const n=this;q._instances.push(this);let i=0;if(this.div=l.A.getDiv(e),this.div.classList.add(a.A.classes.LOADING,a.A.classes.MAP),t&&t.controls&&t.controls.search&&t.controls.search.allowedSearchTypes)for(var c in s.A.controls.search.allowedSearchTypes)Object.prototype.hasOwnProperty.call(t.controls.search.allowedSearchTypes,c)||(t.controls.search.allowedSearchTypes[c]=!1);j.call(n,t),n.id=t.id||o.A.getUID({prefix:"map-"}),n.crossOrigin=n.options.crossOrigin,n.options.availableBaseLayers&&(n.availableBaseLayers=n.options.availableBaseLayers);const u=n.#ca;n.#sa={layers:[],contains:e=>n.#sa.layers.some((t=>t.id===e)),getIndex:e=>n.#sa.layers.findLastIndex((t=>t.id===e)),add:(e,t,r)=>n.#sa.layers.splice(n.#sa.getIndexForZIndex(t),0,{id:e,pending:!0,zIndex:t,isBase:r}),remove:e=>n.#sa.layers.splice(n.#sa.getIndex(e),1),resolve:(e,t)=>{const r=n.#sa.layers[n.#sa.getIndex(e.id)];r.mapLayer=e,r.pending=!1,n.#sa.insertLayerInMapCollection(e,n.layers),n.#sa.insertLayerInMapCollection(e,t?n.baseLayers:n.workLayers)},reject:e=>{const t=n.#sa.layers[n.#sa.getIndex(e.layerId)];t.mapLayer=null,t.pending=!1,t.rejected=!0;var r=n.options.baseLayers.map((e=>e.id)).indexOf(e.layerId);r>=0&&n.baseLayers.splice(r,1)},getIndexForZIndex:e=>n.#sa.layers.findLastIndex((t=>t.zIndex<=e))+1,getMapCollectionIndex:(e,t)=>{let r=-1;for(let i=0;i<e;i++){const e=t.findIndex((e=>e.id===n.#sa.layers[i].id));e>=0&&(r=e)}return r+1},insertLayerInMapCollection:(e,t)=>{const r=n.#sa.getIndex(e.id),i=n.#sa.getMapCollectionIndex(r,t);i===t.length?t.push(e):t.splice(i,0,e)},checkMapLoad:()=>{if(n.options.baseLayers.concat(n.options.workLayers).every((e=>n.#sa.contains(e.id||e)))&&n.#sa.layers.every((e=>!e.pending))){const e=async function(){if(!n.isLoaded){const e=function(){n.options.stateful&&u.call(n),n.isLoaded=!0,n.ready((()=>n.div.classList.remove(a.A.classes.LOADING))),n.trigger(a.A.event.MAPLOAD)};if(n.state&&n.state.vw3){if(!n.div.classList.contains(a.A.classes.THREED)){if(n.div.classList.add(a.A.classes.THREED),!o.A.view||!o.A.view.ThreeD){const e=await Promise.resolve().then(r.bind(r,7612));o.A.view=o.A.view||{},o.A.view.ThreeD=e.default}o.A.view.ThreeD.apply({map:n,state:n.state.vw3,callback:function(){e(),n.getControlsByClass(S.default)[0].button.removeAttribute("disabled")}})}}else e()}};if(n.baseLayer)e();else{let t;if(n.state&&n.state.base&&(t=n.availableBaseLayers.find((e=>e.id===n.state.base))),t)t.isBase=!0,n.addLayer(t).then((function(t){e()}));else{const t=n.baseLayers.filter((e=>!e.mustReproject)).filter((e=>e.wrap&&e.wrap.layer));t.length>0&&(n.wrap.setBaseLayer(t[0].wrap.layer),n.baseLayer=t[0]),e()}}}}};var h=async function(){n.state=n.options.stateful?await n.checkLocation():void 0,n.options.layout&&n.trigger(a.A.event.LAYOUTLOAD,{map:n}),t&&void 0!==t.workLayers&&(n.options.workLayers=t.workLayers),t&&void 0!==t.baseLayers&&(n.options.baseLayers=t.baseLayers),n.options.zoomToFeatures&&n.on(a.A.event.FEATURESADD,(function e(t){clearTimeout(n._zoomToFeaturesTimeout),n._zoomToFeaturesTimeout=setTimeout((function(){n.zoomToFeatures(t.layer.features,{animate:!1}),n.off(a.A.event.FEATURESADD,e)}),100)})),n.on(a.A.event.LAYERADD,(function e(t){t.layer.isBase&&(t.layer===n.baseLayer||n.baseLayer&&t.layer.getFallbackLayer?.()?.id===n.baseLayer.id)&&(void 0!==n.state&&(n.state.crs?n.loaded((function(){n.setProjection({crs:n.state.crs,extent:n.state.ext})})):n.setExtent(n.state.ext,{animate:!1})),n.off(a.A.event.LAYERADD,e))})),n.state?.crs?(n.crs=n.state.crs,n.initialExtent=l.A.reprojectExtent(n.options.initialExtent,n.options.crs,n.crs),n.options.maxExtent?n.maxExtent=l.A.reprojectExtent(n.options.maxExtent,n.options.crs,n.crs):n.maxExtent=n.options.maxExtent):(n.crs=n.options.crs,n.initialExtent=n.options.initialExtent,n.maxExtent=n.options.maxExtent),n.defaultInfoContainer=n.defaultInfoContainer||n.options.defaultInfoContainer,!n.defaultInfoContainer&&window.matchMedia("screen and (max-width: 40em), screen and (max-height: 40em)").matches&&(n.defaultInfoContainer=a.A.infoContainer.RESULTS_PANEL),n.wrap=new o.A.wrap.Map(n),await o.A.loadProjDef({crs:n.options.crs}),n.wrap.setMap();const e=[];for(var r in n.options.controls){var s=n.options.controls[r];s&&("string"==typeof(s="boolean"==typeof s?{}:l.A.extend(!0,{},s)).div&&(s.div=n.div.querySelector("#"+s.div)||s.div),e.push(n.addControl(r,s)))}var c=function(e){i-=1,i<=0&&(i=0,n.trigger(a.A.event.UPDATE))};n.on(a.A.event.BEFORELAYERUPDATE,(function(e){i<=0&&(i=0,n.trigger(a.A.event.BEFOREUPDATE)),i+=1})),n.on(a.A.event.LAYERUPDATE,c),n.on(a.A.event.LAYERERROR,c);for(let e of n.options.baseLayers)e="string"==typeof e?n.getAvailableBaseLayer(e):l.A.extend({},n.getAvailableBaseLayer(e.id),e),await n.addLayer(l.A.extend(e,{isBase:!0,map:n}));(n.state&&n.state.layers?n.state.layers.map((function(e){const t={id:e.i||o.A.getUID(),hideTitle:e.h,unremovable:e.ur,title:e.t,filter:e.f,hideTree:0!==e.x,renderOptions:{opacity:e.o,hide:!e.v},groupIndex:e.g};return e.u?(t.url=l.A.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,t.layerNames=e.a||e.n?(e.a||e.n).split(","):void 0):(t.type=a.A.layerType.VECTOR,t.file=e.fn),t})):[]).concat(n.options.workLayers.filter((function(e){return!n.state||!n.state.layers||!n.state.layers.some((t=>e.url===t.u&&e.id===t.i))})).map((function(e){return l.A.extend({},e,{map:n})}))).forEach((e=>{n.addLayer(e).then(function(t){if(t.wrap.getRootLayerNode)var r=t.wrap.getRootLayerNode();t.title=t.title||e.title||r&&(r.Title||r.title),e.renderOptions&&e.renderOptions.opacity<1&&t.setOpacity(e.renderOptions.opacity),e.renderOptions&&e.renderOptions.hide&&t.setVisibility(!e.renderOptions.hide);const i=(n.state&&n.state.layers||[]).find((t=>t.u===e.url&&t.i===e.id));i&&i.n&&i.a&&i.n!==i.a&&t.setLayerNames(i.n)}.bind()).catch((function(e){n.toast(e.message,{type:a.A.msgType.ERROR})}))})),Promise.all(e).finally((function(){n.state&&n.state.ctl&&n.importControlStates(n.state.ctl),n.isReady=!0,n.trigger(a.A.event.MAPREADY)})),B(n.div),n.on(a.A.event.FEATURECLICK,(function(e){n.activeControl&&n.activeControl.isExclusive()||e.feature.showInfo()})),n.on(a.A.event.NOFEATURECLICK,(function(e){e.layer._noFeatureClicked=!0;for(var t=!0,r=0,i=n.workLayers.length;r<i;r++)if(!n.workLayers[r]._noFeatureClicked){t=!1;break}t&&(n.workLayers.forEach((function(e){delete e._noFeatureClicked})),n.getControlsByClass(A.default).forEach((function(e){e.isVisible()&&e.hide()})))}))};const d=this.options.locale;o.A.i18n.loadResources(!o.A.i18n[d],o.A.apiLocation+"resources/",d).finally((function(){if(0===n.div.getBoundingClientRect().height&&(document.querySelectorAll("html,body").forEach((e=>e.classList.add(a.A.classes.FULL_SCREEN))),n.div.classList.add(a.A.classes.FULL_SCREEN)),n.options.layout){var e=n.options.layout;n.trigger(a.A.event.BEFORELAYOUTLOAD,{map:n});var r={},i=!1;if("string"==typeof e){var s=e.trim();s+=s.match(/\/$/)?"":"/",r.config=s+"config.json",r.markup=s+"markup.html",r.style=s+"style.css",r.script=s+"script.js",r.i18n=s+"resources",i=!0}else(Object.prototype.hasOwnProperty.call(e,"config")||Object.prototype.hasOwnProperty.call(e,"markup")||Object.prototype.hasOwnProperty.call(e,"style")||Object.prototype.hasOwnProperty.call(e,"script")||Object.prototype.hasOwnProperty.call(e,"href")||Object.prototype.hasOwnProperty.call(e,"i18n"))&&(r=l.A.extend({},e));r.i18n&&(r.i18n+=r.i18n.match(/\/$/)?"":"/"),n.layout=r;const c=[],u=function(e,t){this.status=e,this.url=t},p=function(e){if(!i||404!=e.status){const t=o.A.Map.get(document.querySelector("."+a.A.classes.MAP));o.A.error(l.A.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e.url}),[a.A.msgErrorMode.TOAST,a.A.msgErrorMode.EMAIL],"Error al cargar "+e.url)}},g=new Promise((function(e,i){r.config?c.push(fetch(r.config).then((function(e){if(!e.ok)throw new u(e.status,r.config);return e.json()})).then((function(r){e(r.i18n),j.call(n,r,t)})).catch((function(t){t.status&&p(t),e(!1)}))):e(!1)}));c.push(g),r.style&&c.push(new Promise((function(e,t){n.div.classList.add("tc-lo"),fetch(r.style,{method:"GET"}).then((function(e){if(!e.ok)throw new u(e.status,r.style);return e})).then((function(){var t=document.createElement("link");t.rel="stylesheet",t.href=r.style,t.addEventListener("load",e),t.addEventListener("error",e),document.head.appendChild(t)})).catch((function(t){t.status&&p(t),e()}))}))),r.markup&&c.push(new Promise((function(e,t){fetch(r.markup).then((function(e){if(!e.ok)throw new u(e.status,r.markup);return e.text()})).then((function(t){g.then((function(i){i&&d&&r.i18n?o.A.i18n.loadResources(!0,r.i18n,d).finally((function(){t=t.replace(/\{\{i18n "([^\}\{]+)"\}\}|\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\}/g,(function(e,t,r,n){return l.A.getLocaleString(d,t||r||n)})),n.div.insertAdjacentHTML("beforeend",t);const r=n.div.querySelectorAll("[data-i18n-title]");r.length&&r.forEach((e=>e.title=o.A.Util.getLocaleString(d,e.dataset.i18nTitle)));const i=n.div.querySelectorAll("[data-i18n-content]");i.length&&i.forEach((e=>e.innerHTML=l.A.getLocaleString(d,e.dataset.i18nContent))),e()})):(n.div.insertAdjacentHTML("beforeend",t),e())}))})).catch((function(t){t.status&&p(t),e()}))}))),Promise.all(c).finally((function(){r.script?fetch(r.script).then((function(e){if(!e.ok)throw new u(e.status,r.script);return e.blob()})).then((function(e){var t=URL.createObjectURL(e),r=document.createElement("script");r.src=t,r.onload=function(){B(n.div),h()},document.head.appendChild(r)})).catch((function(e){e.status&&p(e),h()})):h()}))}else h()})),n.on(a.A.event.UPDATEPARAMS,(function(e){W(e.layer)})),n.on(a.A.event.ZOOM,(function(){for(var e=0;e<n.workLayers.length;e++)W(n.workLayers[e])}));var p=o.A.error;o.A.error=function(e,t,r){const i=e.message??e;if(o.A.isDebug&&console.trace&&console.trace(),t){var l=function(e,t,r){const i=e.message??e;switch(t){case a.A.msgErrorMode.TOAST:if(!n.toast)return void console.warn("No existe el objeto Toast");n.toast(i,{type:a.A.msgType.ERROR,duration:2*s.A.toastDuration});break;case a.A.msgErrorMode.EMAIL:s.A.loggingErrorsEnabled&&(0,E.JL)("onerrorLogger").fatalException(r?{msg:r,errorMsg:i}:i,null);break;case a.A.msgErrorMode.CONSOLE:default:console.error(e)}};if(Array.isArray(t))for(var c=0;c<t.length;c++)l(e,t[c],r);else l(e,t,r)}else p(e),n.toast(i,{type:a.A.msgType.ERROR,duration:2*s.A.toastDuration})}}#ca(){const e=this;var t=[a.A.event.LAYERADD,a.A.event.LAYERORDER,a.A.event.LAYERREMOVE,a.A.event.LAYERVISIBILITY,a.A.event.ZOOM,a.A.event.BASELAYERCHANGE,a.A.event.UPDATEPARAMS].join(" ");let r=[a.A.event.LAYERUPDATE,a.A.event.FEATUREADD,a.A.event.FEATUREREMOVE,a.A.event.FEATUREMODIFY,a.A.event.FEATURESADD,a.A.event.FEATURESCLEAR,a.A.event.UPDATEPARAMS].join(" ");e.on(r,(()=>e.trigger(a.A.event.MAPCHANGE))),e.replaceCurrent=!0,D.call(e);const n=D.bind(e);var i;e.on(t,n),e.on(a.A.event.LAYEROPACITY,(function(t){clearTimeout(i),i=setTimeout((function(){D.call(e,t)}),500)})),globalThis.addEventListener("popstate",(function(r){e.wait(l.A.getTimedPromise((async function(){if(r){e.off(t,n);var i=r.state;"[object Object]"===Object.prototype.toString.call(i)&&(i=await e.checkLocation()),await N.call(e,i),setTimeout((function(){e.on(t,n)}),200)}}),4))}))}async exportState(e={}){const t=this;var r={};let n,i=x++;t.crs!==t.options.crs&&(r.crs=t.crs);for(var o=t.getExtent(),s=0;s<o.length;s++)Math.abs(o[s])>180&&(o[s]=Math.floor(1e3*o[s])/1e3);r.ext=o,t.baseLayers&&(n=t.baseLayers.filter((e=>e.isRaster()&&e.fallbackLayer)).map((e=>({baseLayer:e,fallbackLayerID:e.fallbackLayer.id}))).find((e=>e.fallbackLayerID===(t.baseLayer?t.baseLayer.id:t.baseLayers[0].id)))),n?r.base=n.baseLayer.id:(t.baseLayer||t.baseLayers&&t.baseLayers[0])&&(r.base=(t.baseLayer||t.baseLayers[0]).id),r.layers=[],t.workLayers.forEach((function(e){if(e.type!==a.A.layerType.WMS||e.options.stateless){if(R&&e.type===a.A.layerType.VECTOR&&e.file&&!e.stealth){const t={o:e.getOpacity(),v:e.getVisibility(),h:e.options.hideTitle,ur:e.unremovable,fn:e.file,t:e.title,i:e.id};void 0!==e.groupIndex&&(t.g=e.groupIndex),r.layers.push(t)}}else if(e.layerNames=e.names||e.layerNames,e.layerNames&&e.layerNames.length||!1===e.hideTree){const t={u:l.A.isOnCapabilities(e.url),n:Array.isArray(e.names)?e.names.join(","):e.names,o:e.getOpacity(),v:e.getVisibility(),h:e.options.hideTitle,ur:e.unremovable,f:e.filter&&(e.filter instanceof _.A.Filter?e.filter.getText():e.filter instanceof C.B?e.filter.getFilterText(e):e.filter),t:e.title,i:e.id};!1===e.hideTree&&(t.x=0);const n=Array.isArray(e.availableNames)?e.availableNames.join(","):e.availableNames;t.n!==n&&(t.a=n),r.layers.push(t)}})),t.on3DView&&t.view3D.cameraControls&&(r.vw3=t.view3D.cameraControls.getCameraState());const c=e.extraStates??t.#la;if(c&&l.A.extend(r,c),!e.cacheResult&&t._controlStatesCache&&delete t._controlStatesCache,t._controlStatesCache)return{state:t._controlStatesCache,index:i};const u=await I("pack",r);return e.cacheResult&&(t._controlStatesCache=u),{state:u,index:i}}async getMapState(e){const{state:t}=await this.exportState(e);return l.A.utf8ToBase64(t)}async refreshMapState(e){const{state:t}=await this.exportState(e),r=l.A.utf8ToBase64(t);window.history.replaceState(t,null,window.location.href.split("#").shift()+"#"+r)}addControlState(e){this.#la??={},this.#la.ctl??=[];const t=e.exportState(),r=this.#la.ctl.findIndex((t=>t.id===e.id));return r<0?this.#la.ctl.push(t):this.#la.ctl[r]=t,this.refreshMapState(),this}removeControlState(e){const t=this.#la?.ctl?.findIndex((t=>t.id===e.id));return t>=0&&(this.#la.ctl.splice(t,1),this.#la.ctl.length||(delete this.#la.ctl,Object.keys(this.#la).length||(this.#la=null))),this.refreshMapState(),this}getPreviousMapState(){return T}async checkLocation(){var e=window.location.hash;if(e&&e.length>1){var t;e=e.substr(1);try{t=await I("unpack",l.A.base64ToUtf8(e))}catch(r){try{t=JSON.parse(l.A.base64ToUtf8(e))}catch(e){return void o.A.error(l.A.getLocaleString(this.options.locale,"mapStateNotValid"),a.A.msgErrorMode.TOAST)}}if(l.A.detectIE()&&2047===window.location.href.length&&o.A.error(l.A.getLocaleString(this.options.locale,"mapStateNotValidForEdge"),a.A.msgErrorMode.TOAST),t){var r=!1;if(Object.prototype.hasOwnProperty.call(t,"ext")||(r=!0,t.ext=this.options.initialExtent),Object.prototype.hasOwnProperty.call(t,"base")||(r=!0,t.base=this.options.defaultBaseLayer),Object.prototype.hasOwnProperty.call(t,"layers"))for(var n=t.layers.length-1;n>=0;n--){const e=t.layers[n];e&&(Object.prototype.hasOwnProperty.call(e,"u")&&Object.prototype.hasOwnProperty.call(e,"n")||Object.prototype.hasOwnProperty.call(e,"fn"))?Object.prototype.hasOwnProperty.call(e,"o")&&Object.prototype.hasOwnProperty.call(e,"v")&&Object.prototype.hasOwnProperty.call(e,"h")||(r=!0,l.A.extend(e,{o:e.o||1,v:e.v||!0,h:e.h||!1})):(r=!0,t.layers.length=t.layers.length-1)}else r=!0,t.layers=[];return Object.prototype.hasOwnProperty.call(t,"vw3")&&(t.vw3&&t.vw3.cp&&3===t.vw3.cp.length&&t.vw3.chpr&&3===t.vw3.chpr.length&&t.vw3.bcpd||(r=!0)),r&&o.A.error(l.A.getLocaleString(this.options.locale,"mapStateNotValid"),a.A.msgErrorMode.TOAST),t}o.A.error(l.A.getLocaleString(this.options.locale,"mapStateNotValid"),a.A.msgErrorMode.TOAST)}}static get(e){for(var t=0,r=this._instances.length;t<r;t++){const r=this._instances[t];if(r.div===e)return r}}getCrs(){return this.on3DView?this.view3D.crs:this.crs}getCRS(){return this.getCrs()}async setCrs(e,t){return await this.setProjection({crs:e}),l.A.isFunction(t)&&t(e),e}async#ua(e,t){const r=e=>{e&&this.setExtent(this.initialExtent,{animate:!1,contain:!0})};if(!e.isCompatible(t)){const r=await e.getCapabilitiesOnline();if(e.capabilities=r,!e.isCompatible(t))if(e.type!==a.A.layerType.WMTS)e.mustReproject=!0;else{const r=e.wrap.getCompatibleMatrixSets(t)[0];r?e.wrap.setMatrixSet(r):e.mustReproject=this?.state?.base!==e.id}}if(this.state?e.isDefault=this.state.base===e.id||this.state.base===e.options.fallbackLayer:"string"==typeof this.options.defaultBaseLayer?e.isDefault=this.options.defaultBaseLayer===e.id:"number"==typeof this.options.defaultBaseLayer&&(e.isDefault=this.options.defaultBaseLayer===this.baseLayers.length),e.isDefault){let n;if(!e.mustReproject||e.type===a.A.layerType.WMTS&&e.wrap.getCompatibleMatrixSets(t)[0]){n=null===this.baseLayer;const t=await e.wrap.getLayer();return this.wrap.setBaseLayer(t),this.baseLayer=e,r(n),e}if(e.options.fallbackLayer&&e.getFallbackLayer){const t=await this.addLayer(e.getFallbackLayer());if(t.isCompatible(this.getCrs()))return this.wrap.setBaseLayer(t.wrap.layer),this.baseLayer=t.wrap.parent,r(n),e;throw V(this,e)}throw V(this,e)}return e}async#ha(e,t){if(e.isCompatible(t))return await e.wrap.getLayer(),e;{const r=await e.getCapabilitiesOnline();if(e.capabilities=r,e.isCompatible(t))return await e.wrap.getLayer(),e;throw V(this,e)}}async addLayer(e,t){const r=this;try{if("object"==typeof e)if(e.id){const t=r.getAvailableBaseLayer(e.id);!t||e instanceof h.A||(e={...t,...e});const n=/(?<ctl>[-_\p{Letter}]+(\u002D\d)?\u002D)?(?<num>[\d]*)?/gu.exec(e.id).groups;n.num&&n.ctl&&o.A.setUIDStart(parseInt(n.num)+1,{prefix:n.ctl})}else e.id=o.A.getUID();const n=e.options?.zIndex??e.zIndex??(e.stealth?1:0);if(r.#sa.add(e.id||e,n,e.isBase),r.getLayer(e.id)){const t=Error(`Layer "${e.id}" already exists`);throw t.layerId=e.id,t}let i,s,c;"string"==typeof e?i=new d.A(l.A.extend({},r.getAvailableBaseLayer(e),{map:r})):e instanceof h.A?(i=e,i.map=r):(e.map=r,i=e.type===a.A.layerType.VECTOR||e.type===a.A.layerType.KML||e.type===a.A.layerType.WFS?new p.A(e):new d.A(e));try{await Promise.all([r.wrap.getMap(),i.wrap.getLayer()])}catch(t){const r=t instanceof Error?t:new Error(t);throw r.layerId=e.id,r}r.trigger(a.A.event.BEFORELAYERADD,{layer:i}),function(e){return"string"==typeof e||e.type!==a.A.layerType.VECTOR&&e.type!==a.A.layerType.KML&&e.type!==a.A.layerType.WFS}(i)&&(z(i),s=r.wrap.indexOfFirstVector()),-1===s&&(s=r.wrap.getLayerCount());const u=r.state&&r.state.crs?r.state.crs:r.getCRS();if(await o.A.loadProjDef({crs:u}),c=i.isBase?await r.#ua(i,u):await r.#ha(i,u),r.#sa.resolve(c,c.isBase),!c.isBase){const e=r.#sa.layers.map((e=>e.mapLayer?.wrap?.layer)).filter((e=>!!e)),t=e.indexOf(c.wrap.layer),n=t<0?e:e.slice(0,t);r.wrap.insertLayer(c.wrap.layer,{previousLayers:n})}return r.trigger(a.A.event.LAYERADD,{layer:c}),r.#sa.checkMapLoad(),l.A.isFunction(t)&&t(c),c}catch(e){throw r.#sa.reject(e),r.#sa.checkMapLoad(),e}}async addOrUpdateLayer(e,t){const r=this.getLayer(e.id);if(r){const t=Array.isArray(e.layerNames)?e.layerNames:e.layerNames?e.layerNames.split(","):[];switch(r.type){case a.A.layerType.WFS:break;case a.A.layerType.WMS:r.layerNames!==t&&await r.setLayerNames(t)}return null!=e.visibility&&r.visibility!==e.visibility&&(r.setVisibility(e.visibility),r.renderOptions=Object.assign(e.renderOptions,{hide:e.visibility})),void 0!==e.opacity&&r.opacity!==e.opacity&&(r.setOpacity(e.opacity,!0),r.renderOptions=Object.assign(e.renderOptions,{opacity:e.opacity})),r.unremovable=e.unremovable,r.title=e.title,r.hideTree=e.hideTree,r}return await this.addLayer(e,t)}async removeLayer(e){const t=this;if(e.unremovable)throw Error("Unremovable");let r=t.layers.indexOf(e);if(!(r>=0))throw Error(`Layer ${e.id} not found in map`);t.layers.splice(r,1),e.isBase?(r=t.baseLayers.indexOf(e),r>=0&&(t.baseLayers.splice(r,1),t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]))):(r=t.workLayers.indexOf(e),r>=0&&t.workLayers.splice(r,1),e===t.#aa&&(t.#aa=null));const n=await e.wrap.getLayer();return t.wrap.removeLayer(n),t.#sa.remove(e.id),t.trigger(a.A.event.LAYERREMOVE,{layer:e}),t.#sa.checkMapLoad(),e.map=null,e}async insertLayer(e,t,r){const n=this;for(var i=-1,o=0;o<n.layers.length;o++)if(e===n.layers[o]){i=o;break}const s=e.wrap.getLayer(),c=n.layers[t];let u;c&&(u=await c.wrap.getLayer());const h=await s;var d;return(d=u?n.wrap.getLayerIndex(u):n.wrap.getLayerCount())>=0&&(e.map=n,n.wrap.insertLayer(h,d),i>-1&&n.layers.splice(i,1),n.layers.splice(t,0,e),n.workLayers=n.layers.filter((function(e){return!e.isBase})),n.trigger(a.A.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t})),l.A.isFunction(r)&&r(),e}setLayerIndex(e,t){const r=t-this.baseLayers.length+1;return this.wrap.setLayerIndex(e.wrap.layer,r),this}putLayerOnTop(e){var t=this.wrap.getLayerCount();return this.wrap.setLayerIndex(e.wrap.layer,t-1),this}async setBaseLayer(e,t){const r=this;var n=null,i=!1;if("string"==typeof e){var s;for(s=0;s<r.layers.length;s++)if(r.layers[s].id===e){e=r.layers[s],i=!0;break}i||(e=r.getAvailableBaseLayer(e))&&(e=await r.addLayer(l.A.extend(!0,{},e,{isDefault:!0,isBase:!0,map:r})),i=!0)}else r.layers.indexOf(e)<0&&(e.isDefault=!0,e.isBase=!0,e.map=r,r.addLayer(e)),i=!0;if(i){if(!e.isCompatible(r.getCRS())){let t=e.fallbackLayer;if("string"==typeof t&&(t=r.getAvailableBaseLayer(t),t&&(t=new d.A(t),await t.getCapabilitiesPromise())),!t?.isCompatible(r.getCRS()))return o.A.error("Base layer must be reprojected"),n}r.trigger(a.A.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:e}),n=e,await r.wrap.getMap();const i=await e.wrap.getLayer();await r.wrap.setBaseLayer(i),r.baseLayer=e,r.trigger(a.A.event.BASELAYERCHANGE,{layer:e}),l.A.isFunction(t)&&t()}else o.A.error("Base layer is not available");return n}setView(e){return this.view=e,this.trigger(a.A.event.VIEWCHANGE,{view:e}),this}ready(e){l.A.isFunction(e)&&(this.isReady?e():this.one(a.A.event.MAPREADY,e))}loaded(e){return l.A.isFunction(e)&&(this.isLoaded?e():this.one(a.A.event.MAPLOAD,e)),new Promise((e=>{this.isLoaded?e():this.one(a.A.event.MAPLOAD,e)}))}getLayerTree(){const e={baseLayers:[],workLayers:[]};this.baseLayer&&(e.baseLayers[0]=this.baseLayer.getTree());for(var t=0;t<this.workLayers.length;t++){const r=this.workLayers[t].getTree();r&&e.workLayers.unshift(r)}return e}async addControl(e,t){let n;if("string"==typeof e){const i=e.substr(0,1).toUpperCase()+e.substr(1);if(!o.A.control?.[i]){const e=await r(561)("./"+i);o.A.control[i]??=e.default}n=new o.A.control[i](void 0,t)}else n=e;return this.controls.push(n),await n.register(this),n.div&&(n.div.parentNode||this.div.appendChild(n.div)),this.trigger(a.A.event.CONTROLADD,{control:n}),n}getControlsByClass(e){let t=[],r=e;if("string"==typeof e){let t=e;t.indexOf(".")<0&&(t="TC.control."+t),r=window;const i=t.split(".");for(var n=0;n<i.length&&(r=r[i[n]],r);n++);}return l.A.isFunction(r)&&this.controls.forEach((e=>{e instanceof r&&t.push(e)})),t}getControlById(e){return this.controls.find((t=>t.id===e))||null}getDefaultControl(){let e;return this.options.defaultActiveControl&&(e=this.getControlsByClass("TC.control."+this.options.defaultActiveControl.substr(0,1).toUpperCase()+this.options.defaultActiveControl.substr(1))[0]),e||(e=this.getControlsByClass(v.default)[0],e=e?e.lastCtrlActive:this.getControlsByClass(m.default)[0]),e}getLoadingIndicator(){let e=null,t=this.getControlsByClass(y.default);return t.length&&(e=t[0]),e}async wait(e){let t;const r=l.A.isFunction(e)?e():e,n=this.getLoadingIndicator(),i=n?.addWait();try{t=await r}catch(e){throw n?.removeWait(i),e}return n?.removeWait(i),t}addResultsPanel(e){const t=Object.assign({},e),r=this.getControlsByClass(f.default)[0];return r?(t.position=r.POSITION.RIGHT,r.addControl("resultsPanel",t)):this.addControl("resultsPanel",t)}setExtent(e,t,r){return this.wrap.setExtent(e,t,r)}getExtent(){return this.wrap.getExtent()}getMaxExtent(){return this.maxExtent||null}setCenter(e,t){return this.wrap.setCenter(e,t)}getCenter(){return this.wrap.getCenter()}setRotation(e){this.wrap.setRotation(e)}getRotation(){return this.wrap.getRotation()}getViewHTML(){return this.wrap.getViewport()}getCompatibleCRS(e={}){const t=(e.layers||this.workLayers.concat(this.baseLayer)).filter((function(e){return e.isRaster()})).map((function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})})),r=t.slice(1);return t[0].filter((function(e){return r.every((function(t){return t.indexOf(e)>=0}))}))}async loadProjections(e={}){const t=e.crsList||[];let r=(await Promise.all(t.map((e=>o.A.getProjectionData({crs:l.A.getCRSCode(e)}))))).filter((e=>!!e)).map((function(e){const t="EPSG:"+e.code;return o.A.loadProjDef({crs:t,def:e.proj4||e.wkt,name:e.name,silent:!0}),{code:t,name:e.name,def:e.proj4||e.wkt,unit:e.unit}}));return e.orderBy&&(r=r.sort(l.A.getSorterByProperty(e.orderBy))),r}setProjection(e={}){const t=this,r=t.crs;return new Promise((function(n,i){var s;if(e.crs){t.isReprojecting=!0,e.baseLayer?s=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(s=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(s=t.baseLayer.getFallbackLayer())),s||(s=t.baseLayer);const c=()=>t.isReprojecting=!1,u=async function(){e.extent&&await t.setExtent(e.extent)},h=async function(){c(),t.trigger(a.A.event.PROJECTIONCHANGE,{oldCrs:r,newCrs:e.crs}),await u(),n()},d=function(){o.A.loadProjDef({crs:e.crs,callback:function(){const r=function(n){const o=function(){const o=l.A.extend({},e,{oldCrs:t.crs}),a=function(e){e.setProjection(o)};n.isCompatible(e.crs)||n.wrap.getCompatibleMatrixSets(e.crs).length>0?(n.setProjection(o),t.wrap.setProjection(l.A.extend({},e,{baseLayer:n})),t.crs=e.crs,t.baseLayers.filter((function(e){return e!==n})).forEach(a),t.workLayers.forEach(a),n&&n!==t.baseLayer?t.setBaseLayer(n,h):h()):n.fallbackLayer?r(n.getFallbackLayer()):(c(),i(Error("Layer has no fallback")))};n.type===a.A.layerType.WMS||n.type===a.A.layerType.WMTS?n.getCapabilitiesPromise().then(o).catch(c):o()};r(s)}})};t.baseLayers.indexOf(s)<0?t.addLayer(s).then(d).catch(c):d()}}))}getMetersPerUnit(){return this.wrap.getMetersPerUnit()}getCoordinateFromPixel(e){return this.wrap.getCoordinateFromPixel(e)}getPixelFromCoordinate(e){return this.wrap.getPixelFromCoordinate(e)}zoomToFeatures(e,t={}){const r=this;if(e.length>0){let n;const i=()=>{n=[1/0,1/0,-1/0,-1/0];var i={...t};i.contain=!0;var o=i.pointBoundsRadius||r.options.pointBoundsRadius;o/=r.getMetersPerUnit();var a=i.extentMargin;"number"!=typeof a&&(a=r.options.extentMargin);for(var s=0;s<e.length;s++){var l=e[s].getBounds();l&&(n[0]=Math.min(n[0],l[0]),n[1]=Math.min(n[1],l[1]),n[2]=Math.max(n[2],l[2]),n[3]=Math.max(n[3],l[3]))}if(n[2]-n[0]==0&&(n[0]=n[0]-o,n[2]=n[2]+o),n[3]-n[1]==0&&(n[1]=n[1]-o,n[3]=n[3]+o),a){var c=(n[2]-n[0])*a/2,u=(n[3]-n[1])*a/2;n[0]=n[0]-c,n[1]=n[1]-u,n[2]=n[2]+c,n[3]=n[3]+u}r.maxExtent&&(n[0]=Math.max(n[0],r.maxExtent[0]),n[1]=Math.max(n[1],r.maxExtent[1]),n[2]=Math.min(n[2],r.maxExtent[2]),n[3]=Math.min(n[3],r.maxExtent[3])),r.setExtent(n,i)};r.isReprojecting?r.one(a.A.event.PROJECTIONCHANGE,i):i(),r.on3DView&&r._on3DZoomTo({extent:n})}}_on3DZoomTo(e={}){const t=this;if(t.on3DView&&e.extent&&4===e.extent.length)if(e.reprojected)t.trigger(a.A.event.ZOOMTO,e);else{let r=e.extent,n=t.view3D.view2DCRS!==t.view3D.crs?l.A.reproject(r.slice(0,2),t.view3D.view2DCRS,t.view3D.crs):r.slice(0,2),i=t.view3D.view2DCRS!==t.view3D.crs?l.A.reproject(r.slice(2),t.view3D.view2DCRS,t.view3D.crs):r.slice(2);e.extent=n.concat(i),t.trigger(a.A.event.ZOOMTO,e)}}zoomToMarkers(e){var t=this;Promise.all(t._markerPromises).then((function(){for(var r=[],n=0;n<t.workLayers.length;n++){var i=t.workLayers[n];if(i.type===a.A.layerType.VECTOR)for(var o=0;o<i.features.length;o++){var s=i.features[o];s instanceof w.A&&r.push(s)}}t.zoomToFeatures(r,e),t._markerPromises=[]}))}zoomToLayer(e,t={}){const r=this;if((e=r.getLayer(e)).isRaster()){const n=e.getExtent();if(n){const e={...t};e.contain=!0,"number"!=typeof e.extentMargin&&(e.extentMargin=r.options.extentMargin),r.setExtent(n,e),r.on3DView&&r._on3DZoomTo({extent:n,reprojected:!0})}}else e.features&&e.features.length&&r.zoomToFeatures(e.features,t)}getLayer(e){return"string"==typeof e?this.layers.find((t=>t.id===e))||null:e instanceof h.A&&e.map===this?e:null}async#da(){return this.#aa||(this.#aa=await this.addLayer({id:o.A.getUID(),title:o.A.i18n[this.options.locale].vectorLayer,type:a.A.layerType.VECTOR})),this.#aa}getAvailableBaseLayer(e){return this.availableBaseLayers.find((t=>t.id===e))}addPoint(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPoint(e,l.A.extend(!0,{},t,{layer:r}))}else this.#da().then((function(r){r.addPoint(e,t)}))}async addMarker(e,t={},r){let n,i;if(l.A.isFunction(t)?(r=t,n={}):n={...t},n.layer){var o=this.getLayer(n.layer);if(!o)throw new Error('Layer "'+n.layer+'" not found');i=o.addMarker(e,l.A.extend(!0,{},n,{layer:o}))}else{const t=this.#da();this._markerPromises.push(t),i=(await t).addMarker(e,n)}this._markerPromises.push(i);const a=await i;return l.A.isFunction(r)&&r(a),a}addPolyline(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPolyline(e,l.A.extend(!0,{},t,{layer:r}))}else this.#da().then((function(r){r.addPolyline(e,t)}))}addPolygon(e,t){if(t&&t.layer){var r=this.getLayer(t.layer);if(!r)throw new Error('Layer "'+t.layer+'" not found');r.addPolygon(e,l.A.extend(!0,{},t,{layer:r}))}else this.#da().then((function(r){r.addPolygon(e,t)}))}removeFeatures(e){this.workLayers.filter((e=>e instanceof p.A)).map((function(t){return{layer:t,features:t.features.filter((t=>e.includes(t)))}})).forEach((e=>e.features.forEach((t=>e.layer.removeFeature(t)))))}getBaseLayer(){return this.baseLayer||this.baseLayers[0]}getResolutions(){return this.wrap.getResolutions()}getResolution(){return this.wrap.getResolution()}setResolution(e){return this.wrap.setResolution(e)}async exportFeatures(e,t={}){return await this.wait((async()=>{const n=e.filter((e=>!e.options.noExport)),i=t.format===a.A.format.GPX?Number.NaN:0;n.forEach((function(e,t){const r=e.getData();for(let t in r)if(/&(\w+|#\d{2,4});/g.test(t)){const n=r[t],i={},o=document.createElement("div");o.innerHTML=t,i[o.innerText]=n,e.unsetData(t),e.setData(i)}var o=e.getCoords({pointArray:!0});if(o.some((function(e){return null===e[2]}))){const r=e.clone();r.setId(e.id),n[t]=e=r,(o=e.getCoords({pointArray:!0})).forEach((function(e){null===e[2]&&(e[2]=i)}))}}));const o=t.format||"",s=a.A.mimeType[t.format],c=/\.zip$/i.test(t.fileName);let u;if((o===a.A.format.KMZ||c)&&(u=(await r.e(1710).then(r.t.bind(r,1710,23))).default),c){const e=new Map;n.forEach((t=>{const r=t.layer?.file??t.layer?.title+l.A.getFileExtensionFromFormat(o);if(r){let n=e.get(r);n||(n=[],e.set(r,n)),n.push(t)}}));const r=e=>l.A.getFormatFromFileExtension(e.substr(e.lastIndexOf("."))),i=async(e,n)=>{const i=r(e);return await this.exportFeatures(n,{...t,format:i,fileName:e})},c=Array.from(e.entries()),d=await Promise.all(c.map((e=>i(...e)))),p=new u;for(var h=0;h<d.length;h++){const e=d[h],t=c[h][0];if(r(t)===a.A.format.SHAPEFILE){const t=new u,r=await t.loadAsync(e),n=new Map;r.forEach((function(e,t){n.set(e,t)}));for(let[e,t]of n.entries())p.file(e,await t.async("blob"))}else p.file(t,e)}return await p.generateAsync({type:"blob",mimeType:s,compression:"DEFLATE"})}const d=await this.wrap.exportFeatures(n,t);if(o===a.A.format.KMZ){const e=new u,r=(/(.+)\.kmz$/i.exec(t.fileName)?.[1]??"doc")+".kml";return e.file(r,d),await e.generateAsync({type:"blob",mimeType:s,compression:"DEFLATE"})}return d}))}exportControlStates(){return this.controls.map((e=>e.exportState())).filter((function(e){if(e)for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!0;return!1}))}importControlStates(e){e.forEach((e=>{const t=this.getControlById(e.id);t&&this.loaded((function(){t.importState(e)}))}))}toastHide(e){var t=k[e];return t&&(clearTimeout(t.timeout),t.toast&&t.toast.parentElement&&t.toast.parentElement.removeChild(t.toast),t.toast=null),this}toast(e,t={}){var r=t.duration||s.A.toastDuration,n=k[e];n&&(clearTimeout(n.timeout),n.toast&&n.toast.parentElement&&n.toast.parentElement.removeChild(n.toast),n.toast=null);var i=this.div.querySelector("."+a.A.classes.TOAST_CONTAINER);i||((i=document.createElement("div")).classList.add(a.A.classes.TOAST_CONTAINER),(t.container?t.container:this.div).appendChild(i));const o=document.createElement("div"),l=document.createElement("span");o.classList.add(a.A.classes.TOAST),o.appendChild(l);const c=document.createElement("p");c.innerHTML=e,o.appendChild(c),o.addEventListener(a.A.event.CLICK,F,{passive:!0}),i.appendChild(o),n=k[e]={toast:o};var u="";switch(t.type){case a.A.msgType.INFO:u=a.A.classes.INFO;break;case a.A.msgType.WARNING:u=a.A.classes.WARNING;break;case a.A.msgType.ERROR:u=a.A.classes.ERROR}u.length&&n.toast.classList.add(u),n.timeout=setTimeout((function(){F.call(n.toast)}),r)}exportImage(){var e=null,t="El mapa actual no es compatible con la exportación de imágenes",r=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(r&&this.crossOrigin)try{e=r.toDataURL()}catch(e){o.A.error(t+": "+e.message)}else o.A.error(t);return e}loadFiles(e,t={}){if(t.layers){const e=new Set(t.layers.map((e=>e.id))),r=function(t){if(t.targetLayers)for(const n of t.targetLayers)n.state=h.A.state.IDLE,this.trigger(a.A.event.LAYERUPDATE,{layer:n}),e.delete(n.id),0===e.size&&this.off(a.A.event.FEATURESIMPORT,r)};this.on(a.A.event.FEATURESIMPORT,r);for(const e of t.layers)e.state=h.A.state.LOADING,this.trigger(a.A.event.BEFORELAYERUPDATE,{layer:e})}return this.wrap.loadFiles(e,t),this}async getElevationTool(){const e=this;if(!e.elevation&&!e.options.elevation)return null;if(e.elevation)return e.elevation;if(await Promise.resolve().then(r.bind(r,4363)),e.options.elevation){const t="boolean"==typeof e.options.elevation?{}:e.options.elevation;t.services&&e.options.googleMapsKey&&(t.services=t.services.map((function(t){const r="string"==typeof t,n=r?t:t.name;return"elevationServiceGoogle"===n?l.A.extend({name:n,googleMapsKey:e.options.googleMapsKey},r?{}:t):t}))),e.elevation=new o.A.tool.Elevation(t)}else e.elevation=null;return e.elevation}extractFeatures(e={}){const t=this,r=[],n=e.filter,i=e.outputFormat,o=e.download,s=e.layers||t.layers,c={},u=function(e){const t=e.mapLayers[0];return e.title||e.mapLayers.reduce((function(e,t){return e||t.title}),"")||t.tree&&t.tree.title||t.capabilities.Service.Title},h=function(){return!o||i!==a.A.mimeType.JSON&&i!==a.A.mimeType.KML?l.A.toURNCRS(t.getCRS()):a.A.SRSDOWNLOAD_GEOJSON_KML},d=async function(e,t){if(o)return{url:(await e.mapLayer.proxificationTool.cacheHost.getAction(e.url)).action(e.url),data:t};{const r=await function(e,t){return new Promise((function(r){e.mapLayer.proxificationTool.fetch(e.url,{data:t,contentType:"application/xml",type:"POST"}).then((function(e){if(e instanceof XMLDocument){const t=e.querySelector("ExceptionReport Exception");if(t)return void r({errors:[{key:a.A.WFSErrors.INDETERMINATE,params:{err:t.getAttribute("exceptionCode"),errorThrown:t.querySelector("ExceptionText").textContent}}]})}r({response:e})})).catch((function(e){r({errors:[{key:a.A.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message}}]})}))}))}(e,t);return r.errors&&r.errors.length>0&&(r.errors[0].params.serviceTitle=e.service.mapLayers.reduce((function(e,t){return e||t.title}),"")||u(e.service)),r}};return s.forEach((function(e){if(!e.getVisibility()||t.workLayers.indexOf(e)<0||e.type!==a.A.layerType.WMS)return;var s=e.getDisgregatedLayerNames()||e.availableNames;const p=e.url.toLowerCase();var g=c[p];g||(g=c[p]={url:p,layers:[],mapLayers:[e],layerNames:[]});for(var f=0;f<s.length;f++){var m=s[f];if(e.wrap.getInfo(m).queryable){g.layerNames.push(m);var y=e.getPath(m);g.layers.push({name:m,title:y[0],path:y.slice(1),features:[]})}}0!==g.layerNames.length&&void 0===g.request&&(g.request=g.request||e.getWFSCapabilities(),r.push(new Promise((function(e,t){g.request.then((function(t){var r=null,s=[];for(var p in c)c[p].request&&c[p].request===g.request&&(r=c[p]);var f=null,m=r.layerNames;if(!(m instanceof Array&&m.length))return;if(void 0===t.Operations.GetFeature)return s.push({key:a.A.WFSErrors.GETFEATURE_NOT_AVAILABLE,params:{serviceTitle:u(r)}}),void e({errors:s});for(var y=[],v=0;v<m.length;v++){for(var A=m[v];"_"===A[A.length-1];)A=A.substring(0,A.lastIndexOf("_"));if(Object.prototype.hasOwnProperty.call(t.FeatureTypes,A.substring(m[v].indexOf(":")+1)))y.indexOf(A)<0&&y.push(A);else{var S=r.mapLayers[0].getPath(A.substring(m[v].indexOf(":")+1));s.push({key:a.A.WFSErrors.LAYERS_NOT_AVAILABLE,params:{serviceTitle:u(r),layerName:S[S.length-1]}})}}if(0===y.length)return s.push({key:a.A.WFSErrors.NO_VALID_LAYERS,params:{serviceTitle:u(r)}}),void e({errors:s});if(!t.Operations.GetFeature.outputFormat.includes(i.toLowerCase())&&!t.Operations.GetFeature.outputFormat.includes(i.toUpperCase()))return s.push({key:a.A.WFSErrors.NO_VALID_FORMAT,params:{serviceTitle:u(r),format:i}}),void e({errors:s});if(t.Operations.GetFeature.CountDefault&&(f=t.Operations.GetFeature.CountDefault.DefaultValue),"1.0.0"===t.version&&!Object.prototype.hasOwnProperty.call(t.Operations.GetFeature.Operations,"Query")||("2.0.0"===t.version||"1.1.0"===t.version)&&t.Operations.QueryExpressions.indexOf("wfs:Query")<0)return s.push({key:a.A.WFSErrors.QUERY_NOT_AVAILABLE,params:{serviceTitle:u(r)}}),void e({errors:s});const E=t.Operations.GetFeature.DCPType?t.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:t.Operations.GetFeature.DCP.HTTP.Post.href;(async function(e,t,r){let n=await e.describeFeatureType(t);var i={};if(1===t.length){var o={};o[t[0]]=n,n=o}for(var a in n){let e;var s=[];const t=n[a];for(var c in t){const e=t[c];!l.A.isGeometry(e.type)||e.nillable||e.minOccurs||s.push(c)}if(s.length<=1){const t=(e,r)=>{if(e instanceof _.A.LogicalNary)e.conditions.forEach((e=>t(e,r)));else if(e instanceof _.A.Spatial)return e.geometryName=r,e};e=Object.assign(new r.constructor,t(r,0===s.length?null:s[0]))}else if(s.length>1){const t=function(e,r){return Object.prototype.hasOwnProperty.call(e,"geometryName")&&(e.geometryName=r),Object.prototype.hasOwnProperty.call(e,"condition")&&t(e.condition),e.conditions?.forEach((e=>t(e))),e},n=s.map((e=>{const n=t(r.clone(),e),i=new _.A.isNull(e);return new _.A.Or(i,n)}));e=new _.A.And(...n)}i[a]=e}return i})(r.mapLayers[0],y,n).then((function(n){f?async function(e,t,r){try{const i=await t.mapLayer.proxificationTool.fetchXML(t.url,{data:r,contentType:"application/xml",type:"POST"});if(i instanceof XMLDocument){const e=i.querySelector("ExceptionReport Exception");if(e)return{errors:[{key:a.A.WFSErrors.INDETERMINATE,params:{err:e.getAttribute("exceptionCode"),errorThrown:e.querySelector("ExceptionText").textContent}}]}}var n=parseInt(i.querySelector("FeatureCollection").getAttribute("numberMatched")||i.querySelector("FeatureCollection").getAttribute("numberOfFeatures"),10);return Number.isNaN(n)||n>parseInt(e,10)?{errors:[{key:a.A.WFSErrors.MAX_NUM_FEATURES}]}:0===n?{errors:[{key:a.A.WFSErrors.NO_FEATURES}]}:n}catch(e){return{errors:[{key:a.A.WFSErrors.INDETERMINATE,params:{err:e.name,errorThrown:e.message}}]}}}(f,{url:E,mapLayer:r.mapLayers[0]},l.A.WFSQueryBuilder(n,null,t,i,!0,h())).then((function(c){if(c.errors&&c.errors.length>0){switch(c.errors[0].key){case a.A.WFSErrors.INDETERMINATE:c.errors[0].params.serviceTitle=r.mapLayers.reduce(((e,t)=>e||t.title),"")||u(r);break;case a.A.WFSErrors.MAX_NUM_FEATURES:c.errors[0].params={limit:f,serviceTitle:u(r)};break;case a.A.WFSErrors.NO_FEATURES:c.errors[0].params={serviceTitle:u(r)}}e(c)}else d({url:E,mapLayer:r.mapLayers[0],service:r},l.A.WFSQueryBuilder(n,null,t,o?i:a.A.mimeType.JSON,!1,h())).then((function(t){e(Object.assign({service:r,errors:s},t))}))})):d({url:E,mapLayer:r.mapLayers[0],service:r},l.A.WFSQueryBuilder(n,null,t,o?i:a.A.mimeType.JSON,!1,h())).then((function(t){e(Object.assign({service:r,errors:s},t))}))})).catch((function(t){e({errors:[{key:a.A.WFSErrors.INDETERMINATE,params:{err:t.name,errorThrown:t.message,serviceTitle:u(r)}}]})}))}),(function(t){var r=null;for(var n in c)c[n].request&&c[n].request===g.request&&(r=c[n]);e({errors:[{key:a.A.WFSErrors.GETCAPABILITIES,params:{err:t.name,serviceTitle:u(r)}}]})}))}))))})),r}updateSize(){return this.wrap.updateSize(),this}linkTo(e){return this.wrap.linkTo(e),this}async loadRecentFiles(){const e=[];for(var t=0;t<this.recentFileCount;t++)e.push(i().getItem(this.RECENT_FILES_STORE_KEY_PREFIX+t).catch((e=>console.warn(e))));const r=[];for await(const t of e)t&&r.push(t);return this.recentFiles=r,r}async storeRecentFiles(e){const t=this;e=e||t.recentFiles;for(var r=0;r<t.recentFileCount;r++)if(r<e.length){const n=e[r];await i().setItem(t.RECENT_FILES_STORE_KEY_PREFIX+r,n).catch((e=>console.warn(e)))}else await i().removeItem(t.RECENT_FILES_STORE_KEY_PREFIX+r).catch((e=>console.warn(e)));t.recentFiles=e}async addRecentFileEntry(e){await U.acquire();const t=this;let r=!1;for await(const n of t.recentFiles.map((t=>(t.mainHandle||t).isSameEntry(e.mainHandle))))if(n){r=!0;break}if(r){const r=t.recentFiles.findIndex((t=>(t.mainHandle?.name||t.name)===e.mainHandle.name));t.recentFiles.splice(r,1)}else t.recentFiles.length>=t.recentFileCount&&t.recentFiles.pop();t.recentFiles.unshift(e),await t.storeRecentFiles(t.recentFiles),t.trigger(a.A.event.RECENTFILEADD,{file:e}),U.release()}async removeRecentFileEntry(e){this.recentFiles.splice(e,1),await this.storeRecentFiles(this.recentFiles)}async loadRecentFileEntry(e){const t=this,r=t.recentFiles[e];if(r){for await(const e of t.workLayers.filter((e=>e._fileHandle)).map((e=>{const t=r.mainHandle||r;return e._fileHandle.isSameEntry(t)})))e&&t.toast(l.A.getLocaleString(t.options.locale,"fileLoadedMoreThanOnce"),{type:a.A.msgType.WARNING});let e=[r.mainHandle||r];r.additionalHandles&&(e[0]._siblings=r.additionalHandles,e=e.concat(r.additionalHandles));const i=[];for await(let t of e.map((e=>e.queryPermission())))i.push(t);for(var n=0;n<i.length;n++)"prompt"===i[n]&&(i[n]=await e[n].requestPermission());if(i.every((e=>"granted"===e)))return t.loadFiles(e),r}return null}setLanguage(e){const t=this;if(u.A.currentLocaleKey!=e){t.trigger(a.A.event.BEFORECHANGELANGUAGE,{lang:e});const r=new Promise((async(r,n)=>{try{u.A[e]?await o.A.i18n.loadResources(!1,null,e):(await o.A.i18n.loadResources(!0,o.A.apiLocation+"resources/",e),await o.A.i18n.loadResources(!0,t.layout.i18n,e)),await new Promise((e=>{setTimeout(e,100)})),t.options.locale=u.A.currentLocaleKey=e,await Promise.all(t.controls.filter((e=>e.updateLanguage&&!(e instanceof o.A.control.LoadingIndicator))).map((e=>e.updateLanguage?.apply(e))));const n=t.div.querySelectorAll("[data-i18n-title]");n.length&&n.forEach((t=>t.title=o.A.Util.getLocaleString(e,t.dataset.i18nTitle)));const i=t.div.querySelectorAll("[data-i18n-content]");i.length&&i.forEach((t=>t.innerHTML=l.A.getLocaleString(e,t.dataset.i18nContent))),t.trigger(a.A.event.CHANGELANGUAGE,{lang:e}),r()}catch(e){n(e)}}));return t.wait(r),r}return Promise.reject("Same language")}}var W=function(e){e.type===a.A.layerType.WMS&&(e.tree=null)};const H=function(e,t){const r=e.filter((e=>Object.prototype.hasOwnProperty.call(e,t))).map((e=>({[t]:e[t]})));return r.unshift({[t]:s.A[t]}),r.pop()[t]},j=function(){const e=[...arguments],t=[!0,{},s.A].concat(e),r=this.options=l.A.extend(...t);r.availableBaseLayers??=this.availableBaseLayers,r.baseLayers=H(e,"baseLayers"),r.workLayers=H(e,"workLayers");const n=e.filter((e=>e.controls)).map((e=>e.controls));var i;return n.length>0&&(r.controls=l.A.extend(!0,r.controls,((i=l.A.extend(!0,n[0],n[1])).controlContainer&&(Array.isArray(i.controlContainer.controls)?i.controlContainer.controls.forEach((e=>{Object.keys(e).filter((e=>"position"!==e)).forEach((t=>{void 0!==i[t]&&("boolean"==typeof e[t]&&(e[t]={}),l.A.extend(e[t],i[t]),delete i[t])}))})):Object.keys(i).filter((function(e){return Object.keys(i.controlContainer.controls).indexOf(e)>-1})).forEach((function(e){const t=i.controlContainer.controls[e];"boolean"==typeof t.options&&(t.options={}),l.A.extend(t.options,i[e]),delete i[e]}))),i))),r};var V=function(e,t){var r,n='Layer "'+t.title+'" ("'+t.names+'"): ';r=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid",n+=l.A.getLocaleString(e.options.locale,r),o.A.error(n),e.trigger(a.A.event.LAYERERROR,{layer:t,reason:r});const i=Error(n);return i.layerId=t.id,i};const z=function(e){e.wrap.$events.on(a.A.event.TILELOADERROR,(function(t){if(t.error.code&&"404"!=t.error.code.toString()&&"offline"!=t.error.text){const r=this;if(!r._tileloaderror){const n=e.getPath(),i=n.length?n[n.length-1]:e.title;e.map.toast(l.A.getLocaleString(e.map.options.locale,"tileload.error",{name:i,error:t.error.text}),{type:a.A.msgType.ERROR}),r._tileloaderror=!0;const o=function(e){e.tile.src&&e.tile.src!==a.A.BLANK_IMAGE&&(delete r._tileloaderror,r.$events.off(a.A.event.TILELOAD,o))};r.$events.on(a.A.event.TILELOAD,o)}}}))};o.A.Map=q;const Y=q},9683:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var n,i,o,a=r(8038),s=r(797),l=r(3301),c=r(7735),u=r(6378),h=r(3365),d=r(4450),p=r(5246),g=r(5777),f=r(3791);a.A.control=a.A.control||{},a.A.UI=a.A.UI||{},a.A.UI.autocomplete=p.A,s.A.classes.SELECTABLE||(s.A.classes.SELECTABLE="tc-selectable"),s.A.classes.INCOMPATIBLE||(s.A.classes.INCOMPATIBLE="tc-incompatible"),s.A.classes.ACTIVE||(s.A.classes.ACTIVE="tc-active");const m=function(e){e.target.blur(),e.stopPropagation();const t=e.target.parentElement;"LI"!==t.tagName||t.classList.contains("tc-ctl-lcat-leaf")||(t.classList.toggle(s.A.classes.COLLAPSED),t.querySelector("ul").classList.toggle(s.A.classes.COLLAPSED),e.target.title=t.classList.contains(a.A.Consts.classes.COLLAPSED)?i:o)};class y{constructor(){this.searchLayersByText="",this.textToSearchInLayers="",this.loadingLayers="",this.loadingLayerTree="",this.availableLayers="",this.clickToAddToMap="",this.infoFromThisLayer="",this.close="",this.layerInfo="",this.abstract="",this.metadata="",this.changeCRS="",this.cancel="",this["wmsLayerNotCompatible.instructions"]=""}}class v{constructor(){this.layerAlreadyAdded="",this.clickToAddToMap="",this.noMatches="",this.infoFromThisLayer=""}}class A{constructor(){this.close="",this.layerInfo="",this.abstract="",this.metadata=""}}class S extends c.default{layers=[];searchInit=!1;#fe={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};#pa;#ga;async loadTemplates(){const e=this,t=r.e(5091).then(r.bind(r,5091)),n=r.e(8532).then(r.bind(r,8532)),i=r.e(5560).then(r.bind(r,5560)),o=r.e(6868).then(r.bind(r,6868)),a=r.e(9346).then(r.bind(r,9346)),s=r.e(5418).then(r.bind(r,5418)),l=r.e(5508).then(r.bind(r,5508)),c={};c[e.CLASS]=(await t).default,c[e.CLASS+"-branch"]=(await n).default,c[e.CLASS+"-node"]=(await i).default,c[e.CLASS+"-info"]=(await o).default,c[e.CLASS+"-results"]=(await a).default,c[e.CLASS+"-results-path"]=(await s).default,c[e.CLASS+"-dialog"]=(await l).default,e.template=c}async render(e){const t=this;if(t.sourceLayers=[],t.model=new y,t.infoModel=new A,0===t.layers.length)await t.renderData({layerTrees:[],enableSearch:!1},e),t._roots=[],t.controller=new g.A(t.model,new f.A(t.div)),t.updateModel();else{await t.renderData({layers:t.layers,enableSearch:!0}),t.controller=new g.A(t.model,new f.A(t.div)),t.updateModel(),t._roots=t.div.querySelectorAll(t.#fe.LAYER_ROOT),t.#fa();for(const e of t.layers)await t.renderBranch(e),t.getLayerRootNode(e).querySelectorAll(".tc-collapsed > button").forEach((e=>e.title=i)),t.getLayerRootNode(e).querySelectorAll(":not(.tc-collapsed) > button").forEach((e=>e.title=o)),t.controller.add(t.getLayerRootNode(e));l.A.isFunction(e)&&e()}t.updateModel(),t.searchInit=!1}async register(e){const t=this;await super.register.call(t,e);const r=function(e,r){if(Array.isArray(t.options.layers)){for(var n=0;n<t.options.layers.length;n++){var i=t.options.layers[n];i.type&&i.type!==s.A.layerType.WMS||(i.id||(i.id=a.A.getUID()),l.A.isPlainObject(i)&&(i=new d.A(i)),t.layers.push(i))}t.render((function(){e()}))}else e()};t.#pa=new Promise((function(t,n){const i=function(n){n.layer===e.baseLayer&&(r(t),e.off(s.A.event.LAYERUPDATE,i))};e.loaded((function(){e.baseLayer.state&&e.baseLayer.state!==h.A.state.IDLE?e.on(s.A.event.LAYERUPDATE,i):r(t)}))})),n=t.getLocaleString("clickToAddToMap"),i=t.getLocaleString("expand"),o=t.getLocaleString("collapse"),e.on(s.A.event.BEFORELAYERADD+" "+s.A.event.BEFOREUPDATEPARAMS,(function(e){t.getLayerNodes(e.layer).forEach((function(e){e.classList.add(s.A.classes.LOADING),delete e.querySelector("span").dataset.tooltip}))})).on(s.A.event.LAYERADD+" "+s.A.event.UPDATEPARAMS,(function(e){const r=e.layer;r.isBase||r.type!==s.A.layerType.WMS||t.loaded().then((function(){if(t.getLayerRootNode(r))t.#ma(r);else{for(var e=!1,n=0,i=t.layers.length;n<i;n++){var o=t.layers[n];if(o.type===r.type&&o.options.url===r.options.url){e=!0;break}}e?(t.layersToSetChecked||(t.layersToSetChecked=[]),t.layersToSetChecked.push(r)):t.addLayer(new d.A({url:r.options.url,type:r.type,layerNames:[],title:r.title||r.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then((function(){t.#ma(r)}))}}))})).on(s.A.event.LAYERERROR,(function(e){const r=e.reason;t.layers.some((t=>t===e.layer))&&(r&&a.A.alert(t.getLocaleString(r,{url:e.layer.url})),t.getLayerNodes(e.layer).forEach((function(e){e.classList.remove(s.A.classes.LOADING)})))})).on(s.A.event.LAYERREMOVE,(function(e){const r=e.layer;t.getLayerNodes(r).forEach((function(e){e.classList.remove(s.A.classes.CHECKED),e.querySelector("span").dataset.tooltip=n})),function(e){const r=[];if(!e.isBase){var n=e.options.url;t.list&&t.list.querySelectorAll("li").forEach((function(i){const o=t.getLayer(i.dataset.layerId);if(o&&o.type===e.type&&o.options.url===n)for(var a=0;a<e.names.length;a++)if(i.dataset.layerName===e.names[a]){r.push(i);break}}))}return r}(r).forEach((function(e){e.classList.remove(s.A.classes.CHECKED),e.querySelector("h5").dataset.tooltip=n})),function(e){var r=t.map.getControlsByClass(u.default)[0];if(r)for(var n=r.layers,i=0;i<n.length;i++){var o=n[i];o!==e&&t.getLayerNodes(o).forEach((function(e){e.classList.add(s.A.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")}))}}(r),t.#ya()})).on(s.A.event.EXTERNALSERVICEADDED,(function(e){e&&e.layer&&(t.addLayer(e.layer),t.div.classList.remove(s.A.classes.COLLAPSED))})).on(s.A.event.PROJECTIONCHANGE,(function(e){t.update()}));const c=new Set(t.layers.map((e=>e.id)));return t.layers.length>c.size&&console.warn(`LayerCatalog [${t.id}]: There are duplicate layer ids`),t.resultController=[],t}#va(e){const t=this;t.showProjectionChangeDialog({layer:e,closeCallback:function(){t.getLayerNodes(t.#ga).forEach((function(e){e.classList.remove(s.A.classes.LOADING),e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap")}))}})}#Aa=function(e,t){const r=this,n=e.target.closest("li");if(!n.classList.contains(s.A.classes.LOADING)&&!n.classList.contains(s.A.classes.CHECKED)){e.preventDefault;var i=n.dataset.layerName;i=void 0!==i?i.toString():"";var o=t.call(r,n);if(o&&i){var a=1;/iPad/i.test(navigator.userAgent)?a=10:l.A.detectFirefox()&&(a=250),o.title||(o.title=o.getTree().title),n.classList.add(s.A.classes.LOADING),n.querySelector("span,h5").dataset.tooltip="",(c=n,l.A.getTimedPromise((function(){c.setAttribute("offsetHeight",c.offsetHeight),c.setAttribute("offsetWidth",c.offsetWidth)}),a)).then((function(){r.addLayerToMap(o,i)})),e.stopPropagation()}}var c};#fa(){const e=this;e.textInput=e.div.querySelector("."+e.CLASS+"-input"),e.list=e.div.querySelector("."+e.CLASS+"-search ul"),e.textInput.addEventListener("mouseup",(function(t){""!==e.textInput.value&&setTimeout((function(){""===e.textInput.value&&(e.list.innerHTML="")}),1)}));var t=[];if(a.A._search=a.A._search||{},a.A._search.retryTimeout=null,a.A.UI.autocomplete.call(e.textInput,{link:"#",target:e.list,minLength:0,source:function(r,n){t=[],e._roots.forEach((function(e){e.querySelectorAll("li."+s.A.classes.CHECKED).forEach((function(e){t.push(e.dataset.layerName)}))})),(r=r.trim()).length<3?e.list.innerHTML="":r.length>=3&&(a.A._search.retryTimeout&&clearTimeout(a.A._search.retryTimeout),a.A._search.retryTimeout=setTimeout((function(){for(var t=[],i=0,o=e.sourceLayers.length;i<o;i++){const n=e.sourceLayers[i];var a=n.searchSubLayers(r);a.length&&t.push({service:{id:n.id,title:n.title||n.id},founds:a})}n({servicesFound:t,servicesLooked:e.sourceLayers.length})}),a.A._search.interval))},callback:function(t){e.textInput.value=t.target.text||t.target.innerText,a.A._search.lastPattern=e.textInput.value,e.goToResult(unescape(t.target.hash).substring(1)),a.A.UI.autocomplete.call(e.textInput,"clear")},buildHTML:function(r){var n=this.target;if(r.results&&r.results.servicesFound.length>0)for(var i=e.map.getLayerTree().workLayers,o=0;o<r.results.servicesFound.length;o++){for(var l=r.results.servicesFound[o].founds,c=0;c<l.length;c++){delete l[c].alreadyAdded;for(var u=0;u<i.length;u++)if(t.indexOf(l[c].Name)>=0){l[c].alreadyAdded=!0;break}l[c].Name||(l.splice(c,1),c--)}r.results.servicesFound[o].founds.length?e.div.querySelectorAll(".tc-ctl-lcat-search-group")[o]&&(r.results.servicesFound[o].service.isCollapsed=e.div.querySelectorAll(".tc-ctl-lcat-search-group")[o].classList.contains(s.A.classes.COLLAPSED)):r.results.servicesFound.splice(o,1)}var h="";return e.getRenderedHtml(e.CLASS+"-results",r.results).then((function(t){const r=new RegExp("(?<pre>[\\;|\\>][\\w\\s\\\\r\\\\n\\t\\(\\)\\.\\:\\\\(À-ÿ]*)(?<match>"+a.A.Util.patternFn(e.textInput.value)+")(?<post>[\\w\\s\\\\r\\n\\t\\(\\)\\.\\:\\\\À-ÿ)]*[\\<|\\&])","gi");n.innerHTML=h=t.replace(r,"$<pre><strong>$<match></strong>$<post>");const i=e.div.querySelector(`.${e.CLASS}-info`);if(i){const t=i.dataset.serviceId;let r=`li[data-layer-name="${i.dataset.layerName}"] .${e.CLASS}-search-btn-info`;e.sourceLayers.length>1&&(r=`li[data-service-id="${t}"] ${r}`);const o=n.querySelector(r);o&&(o.checked=!0)}e.resultController=[];const o=new v,s=new g.A(o,new f.A(n));o.clickToAddToMap=e.getLocaleString("clickToAddToMap"),o.layerAlreadyAdded=e.getLocaleString("layerAlreadyAdded"),o.noMatches=e.getLocaleString("noMatches"),o.infoFromThisLayer=e.getLocaleString("infoFromThisLayer"),e.resultController.push(s)})),h}}),!e.searchInit){e.div.querySelector("h2 sitna-toggle").addEventListener("change",(function(t){const r=e.div.querySelector("."+e.CLASS+"-search"),n=e.div.querySelector("."+e.CLASS+"-tree"),i=e.div.querySelector("."+e.CLASS+"-info"),o=r.classList.contains(s.A.classes.HIDDEN);r.classList.toggle(s.A.classes.HIDDEN,!o),n.classList.toggle(s.A.classes.HIDDEN,o),o?(e.textInput.focus(),t.target.setAttribute("title",e.getLocaleString("viewAvailableLayersTree"))):(t.target.setAttribute("title",e.getLocaleString("searchLayersByText")),e.div.querySelectorAll(".tc-ctl-lcat-tree li [checked]").length>0&&i.classList.remove(s.A.classes.HIDDEN))}),{passive:!0}),e.div.addEventListener("change",a.A.EventTarget.listenerBySelector("."+e.CLASS+"-search ."+e.CLASS+"-search-btn-info",(function(t){t.stopPropagation();const r=t.target;if(r.checked){const t=r.parentElement;var n=t;do{n=n.parentElement}while(n&&"LI"!==n.tagName);e.showLayerInfo(e.layers.length>1?e.layers.filter((e=>e.id===n.dataset.serviceId))[0]:e.layers[0],t.dataset.layerName)}else e.hideLayerInfo()}))),e.div.addEventListener("click",a.A.EventTarget.listenerBySelector("."+e.CLASS+"-search ."+e.CLASS+"-search-btn-info",(function(e){e.stopPropagation()})));const t="."+e.CLASS+"-search li";e.div.addEventListener("click",a.A.EventTarget.listenerBySelector(t,(function(r){r.stopPropagation();for(var n=r.target;n&&!n.matches(t);)n=n.parentElement;n.classList.contains(e.CLASS+"-no-results")||(n.classList.contains(e.CLASS+"-search-group")?n.classList.toggle(s.A.classes.COLLAPSED):e.#Aa(r,(function(){return 1===this.layers.length?this.layers[0]:this.getLayer(n.closest(".tc-ctl-lcat-search-group")&&n.closest(".tc-ctl-lcat-search-group").dataset.serviceId)})))}))),e.searchInit=!0}}#ya(){const e=this;if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("keyup",!1,!0),e.textInput&&e.textInput.dispatchEvent(t)}else e.textInput&&e.textInput.fireEvent("keyup")}#ma(e){const t=this,r=t.map.workLayers.filter((t=>t.type===e.type&&t.url===e.url)).map((e=>t.getLayerNodes(e))).flat();r.forEach((function(e){e.classList.remove(s.A.classes.LOADING),e.classList.add(s.A.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")})),t.controller.add(t.getLayerRootNode(e)),t.getLayerRootNode(e).querySelectorAll("li.tc-ctl-lcat-node.tc-ctl-lcat-leaf.tc-checked").forEach((function(e){r.find((t=>t===e))||(e.classList.remove(s.A.classes.CHECKED),e.querySelector("span").dataset.tooltip=t.getLocaleString("clickToAddToMap"))})),t.#ya()}#Sa(){const e=this;e.layersToSetChecked&&e.layersToSetChecked.length>0&&e.layersToSetChecked.forEach((function(t,r,n){e.getLayerRootNode(t)&&(e.#ma(t),n.splice(r,1))}))}#Ea(e,t){const r=this;e.querySelectorAll("li > button."+r.CLASS+"-collapse-btn").forEach((function(e){e.addEventListener("click",m)})),e.querySelectorAll("span").forEach((function(e){e.addEventListener("click",(function(e){r.#Aa(e,(function(e){for(var t=0,n=this._roots.length;t<n;t++){const r=this._roots[t];if(r.contains(e))return this.getLayer(r.dataset.layerId)}return r.getLayer(e.dataset.layerId)}))}))})),r._roots=r.div.querySelectorAll(r.#fe.LAYER_ROOT),e.dataset.layerId=t.id,e.querySelectorAll("."+r.CLASS+"-btn-info").forEach((function(e){const n=e.parentElement.querySelector("span"),i=e.parentElement.dataset.layerName;if(i){n.classList.add(s.A.classes.SELECTABLE);var o=t.getInfo(i);if(Object.prototype.hasOwnProperty.call(o,"abstract")||Object.prototype.hasOwnProperty.call(o,"legend")||Object.prototype.hasOwnProperty.call(o,"metadata")?(e.addEventListener("change",(function(e){e.stopPropagation(),this.checked?r.showLayerInfo(t,i):r.hideLayerInfo()}),{passive:!0}),e.addEventListener(s.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})):e.parentElement.removeChild(e),t.compatibleLayers&&t.compatibleLayers.indexOf(i)<0&&(n.classList.add(s.A.classes.INCOMPATIBLE),n.setAttribute("title",r.getLocaleString("reprojectionNeeded"))),r.map)for(var a=0,l=r.map.workLayers.length;a<l;a++){var c=r.map.workLayers[a];c.type===s.A.layerType.WMS&&c.url===t.url&&1===c.names.length&&c.names[0]===i&&(n.parentElement.classList.add(s.A.classes.CHECKED),n.dataset.tooltip=r.getLocaleString("layerAlreadyAdded"))}}else e.addEventListener("change",(function(e){e.stopPropagation(),this.checked?r.showLayerInfo(t,i,n.innerText):r.hideLayerInfo()}),{passive:!0}),e.addEventListener(s.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),r.#Sa(),r.getRenderedHtml(r.CLASS+"-dialog",null,(function(e){r._dialogDiv.innerHTML=e,r.controller.add(r._dialogDiv)}))}async renderBranch(e,t,r){const n=this;n.sourceLayers.unshift(e);try{await e.getCapabilitiesPromise();const s=await n.getRenderedHtml(n.CLASS+"-branch",function(e){var t=e.getTree();const r=function(t,n){if(e.options.expandedNodeLevel>n){t.expanded=!0;for(var i=0;i<t.children.length;i++)r(t.children[i],n+1)}};return function t(r){for(var n=!1,i=0;i<r.children.length;i++)t(r.children[i])&&(n=!0);return Object.prototype.hasOwnProperty.call(r,"isVisible")&&(r.isVisible=!e.names||!e.names.length||n||r.isVisible),r.isVisible}(t),r(t,0),t}(e));var i=document.createElement("template");i.innerHTML=s;const c=n.div.querySelector("."+n.CLASS+"-branch");var o=i.content?i.content.firstChild:i.firstChild,a=c.querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+e.id+'"]');a?c.replaceChild(o,a):c.insertAdjacentElement("afterbegin",o),n.#Ea(o,e),1===c.childElementCount&&l.A.isFunction(r)&&r(),l.A.isFunction(t)&&t(n.sourceLayers[n.sourceLayers.map((e=>e&&e.id)).indexOf(e.id)])}catch(t){var c=n.layers.map((e=>e.id)).indexOf(e.id);n.layers.splice(c,1);var u=n.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:e.title}),h=n.div.querySelector("."+n.CLASS+"-branch").querySelector("li."+n.CLASS+'-loading-node[data-layer-id="'+e.id+'"]');h.classList.add("tc-error"),h.setAttribute("title",u),n.map.toast(u,{type:s.A.msgType.ERROR})}}getLayerRootNode(e){const t=this;var r=null;if(!e.isBase){var n=e.options.url;t._roots&&t._roots.forEach((function(i){const o=t.getLayer(i.dataset.layerId);o&&o.type===e.type&&o.options.url.toLowerCase()===n.toLowerCase()&&(r=i)}))}return r}getLayerNodes(e){const t=[],r=this.getLayerRootNode(e);if(r)for(var n=0;n<e.names.length;n++){const i=r.querySelector('li[data-layer-name="'+e.names[n]+'"]');i&&(t.push(i),i.querySelectorAll("li").forEach((function(e){t.push(e)})))}return t}showLayerInfo(e,t,r){const n=this;var i=null,o=n.div.querySelector("."+n.CLASS+"-info");const c=function(t,r){var i=!1;return r&&(i=!0,o.dataset.serviceId=e.id,o.dataset.layerName=t,o.classList.remove(s.A.classes.HIDDEN),n.getRenderedHtml(n.CLASS+"-info",r).then((function(e){o.innerHTML=e,n.infoModel=new A,n.layerInfoController=new g.A(n.infoModel,new f.A(o)),o.querySelectorAll("."+n.CLASS+"-metadata ul li a").forEach((e=>{n.infoModel[e.type]=n.getLocaleString(e.type),n.layerInfoController.setAttribute(e.type,"title",e)})),Object.keys(n.infoModel).filter((e=>!e.startsWith("#"))).forEach((e=>n.infoModel[e]=n.getLocaleString(e))),o.querySelector("."+n.CLASS+"-info-close").addEventListener(s.A.event.CLICK,(function(){n.hideLayerInfo()}),{passive:!0})})).catch((function(e){a.A.error(e)}))),i};n.div.querySelectorAll("."+n.CLASS+"-btn-info, ."+n.CLASS+"-search-btn-info").forEach((function(e){e.checked=!1}));const u=function(e,t){if(e.Title===t)return{title:t,abstract:e.Abstract,metadata:e.MetadataURL?e.MetadataURL.reduce((function(e,t){return e.push({format:t.Format,formatDescription:l.A.getLocaleString(n.map.options.locale,l.A.getSimpleMimeType(t.Format))||l.A.getLocaleString(n.map.options.locale,"viewMetadata"),type:t.type,url:t.OnlineResource}),e}),[]):null};if(e.Layer)for(var r=0;r<e.Layer.length;r++){const n=u(e.Layer[r],t);if(n)return n}};for(var h=0,d=n._roots.length;h<d;h++){const o=n._roots[h];if(o.dataset.layerId===e.id){const a=o.querySelectorAll("."+n.CLASS+"-btn-info");for(var p=0,m=a.length;p<m;p++){const o=a[p];var y=o.parentElement.dataset.layerName;if(t&&y===t){const r=e.getInfo(t),o=n.div.querySelector('li[data-layer-name="'+y+'"] > .'+n.CLASS+"-btn-info");o.checked=c(y,r);const a=n.div.querySelector('li[data-layer-name="'+y+'"] > .'+n.CLASS+"-search-btn-info");a&&(a.checked=o.checked),i=r;break}const s=o.parentElement.querySelector("span").innerText;if(!t&&r&&s===r){const t=u(e.capabilities.Capability.Layer,r);o.checked=c(s,t),i=t;break}}break}}return i}update(){const e=this;e.sourceLayers.forEach((function(t){t.getCapabilitiesPromise().then((function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);const r=e.getLayerRootNode(t);r&&r.querySelectorAll("li[data-layer-name]").forEach((function(r){const n=r.dataset.layerName,i=r.querySelector("span."+s.A.classes.SELECTABLE);t.compatibleLayers.indexOf(n)<0?(i.classList.add(s.A.classes.INCOMPATIBLE),i.setAttribute("title",e.getLocaleString("reprojectionNeeded"))):(i.classList.remove(s.A.classes.INCOMPATIBLE),i.removeAttribute("title"))}))}))}))}hideLayerInfo(){const e=this;e.div.querySelectorAll("."+e.CLASS+"-btn-info, ."+e.CLASS+"-search-btn-info").forEach((function(e){e.checked=!1}));const t=e.div.querySelector("."+e.CLASS+"-info");delete t.dataset.serviceId,delete t.dataset.layerName,t.classList.add(s.A.classes.HIDDEN)}addLayer(e){const t=this;return new Promise((function(r,n){var i=[];t.options.layers&&t.options.layers.length&&(i=t.options.layers.filter((function(t){var r=l.A.reqGetMapOnCapabilities(t.url);return r&&r.replace(l.A.regex.PROTOCOL)===e.url.replace(l.A.regex.PROTOCOL)}))),0===i.length&&(i=t.layers.filter((function(t){return t.url.replace(l.A.regex.PROTOCOL)===e.url.replace(l.A.regex.PROTOCOL)}))),0===i.length?(t.layers.unshift(e),e.getCapabilitiesPromise().then((function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs),e.title=e.title||e.wrap.getServiceTitle(),t.renderBranch(e,(function(){t.controller.add(t.getLayerRootNode(e)),r()}))}))):r()}))}getLayer(e){const t=this;for(var r=0,n=t.layers.length;r<n;r++){const n=t.layers[r];if(n.id===e){var i=t.options.layers.filter((t=>t.id===e));return i.length>0?n.hideTitle=n.options.hideTitle=i[0].hideTitle:n.hideTitle=n.options.hideTitle=!1,n}}return null}addLayerToMap(e,t){const r=this,n=l.A.extend({},e.options);n.id=r.getUID(),n.layerNames=[t],n.title=e.title,n.hideTree=!0;const i=new d.A(n);i.isCompatible(r.map.crs)?r.map.addLayer(n):r.#va(i)}loaded(){return this.#pa}getAvailableCRS(e={}){const t=this;return t.map.getCompatibleCRS({layers:t.map.workLayers.concat(t.map.baseLayer,e.layer),includeFallbacks:!0})}setProjection(e={}){const t=this;t.map.setProjection(e).then((function(){t.#ga&&t.map.addLayer(t.#ga),l.A.closeModal()}))}showProjectionChangeDialog(e){this.#ga=e.layer,super.showProjectionChangeDialog.call(this,e)}updateModel(){const e=this;n=e.getLocaleString("clickToAddToMap"),this.model.searchLayersByText=e.getLocaleString("searchLayersByText"),this.model.textToSearchInLayers=e.getLocaleString("textToSearchInLayers"),this.model.loadingLayers=e.getLocaleString("loadingLayers"),this.model.loadingLayerTree=e.getLocaleString("loadingLayerTree"),this.model.availableLayers=e.getLocaleString("availableLayers"),this.model.clickToAddToMap=e.getLocaleString("clickToAddToMap"),this.model.infoFromThisLayer=e.getLocaleString("infoFromThisLayer"),this.model.changeCRS=e.getLocaleString("changeCRS"),this.model.cancel=e.getLocaleString("cancel"),this.model.close=e.getLocaleString("close"),this.model["wmsLayerNotCompatible.instructions"]=e.getLocaleString("wmsLayerNotCompatible.instructions"),e.resultController?.forEach((t=>{t.model.clickToAddToMap=e.getLocaleString("clickToAddToMap"),t.model.layerAlreadyAdded=e.getLocaleString("layerAlreadyAdded"),t.model.noMatches=e.getLocaleString("noMatches"),t.model.infoFromThisLayer=e.getLocaleString("infoFromThisLayer")})),Object.keys(e.infoModel).filter((e=>!e.startsWith("#"))).forEach((t=>this.infoModel[t]=e.getLocaleString(t)))}async updateLanguage(){const e=this;i=e.getLocaleString("expand"),o=e.getLocaleString("collapse"),e.layers.forEach((t=>{e.getLayerRootNode(t).querySelectorAll(".tc-collapsed > button").forEach((e=>e.title=i)),e.getLayerRootNode(t).querySelectorAll(":not(.tc-collapsed) > button").forEach((e=>e.title=o))})),e.updateModel()}}S.prototype.CLASS="tc-ctl-lcat",a.A.control.LayerCatalog=S;const E=S},9687:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>L});var n=r(8038),i=r(797),o=r(3301),a=r(6083),s=r(5056),l=r(3521),c=r(1535),u=r(7843),h=r(5264),d=r(9566),p=r(7018),g=r(3791),f=r(5777);n.A.control=n.A.control||{},i.A.event.POPUP=i.A.event.POPUP||"popup.tc",i.A.event.POPUPHIDE=i.A.event.POPUPHIDE||"popuphide.tc",i.A.event.DRAWCHART=i.A.event.DRAWCHART||"drawchart.tc",i.A.event.DRAWTABLE=i.A.event.DRAWTABLE||"drawtable.tc",i.A.event.RESULTSPANELCLOSE=i.A.event.RESULTSPANELCLOSE||"resultspanelclose.tc",i.A.event.FEATUREHIGHLIGHT="featurehighlight.tc",i.A.event.FEATUREDOWNPLAY="featuredownplay.tc";const m="tc-ctl-finfo",y=function(e){return Array.from(e.parentElement.children).indexOf(e)},v=function(e,t){var r=e;do{r=r.parentElement}while(r&&r.tagName!==t);return r};class A{constructor(){this.crs="",this.lat="",this.lon="",this.feature="",this.heightOverTerrain="",this.height="",this["elevation.explained"]="",this.ele="",this.expand="",this["fi.error"]="",this.noDataInThisLayer="",this.noDataAtThisService="",this.noData="",this.previous="",this.next="",this.showOnMapAllResults="",this.zoomToAllResults="",this.removeAllResults="",this.downloadAllResults="",this.clickToShowOnMap=""}}class S{constructor(){this.linkInNewWindow="",this.open="",this["featureInfo.complexData.array"]="",this.viewEnlargedImage="",this.audioFormatNotCompatible="",this.videoFormatNotCompatible="",this.openInNewTab=""}}class E{constructor(){this.showOnMapAllResults="",this.zoomToAllResults="",this.removeAllResults="",this.downloadAllResults=""}}class w{constructor(){this.shareQuery="",this.close=""}}class _ extends a.default{CURRENT_CLASS="tc-current";TITLE_SEPARATOR=" › ";DEFAULT_STROKE_COLOR="#0000ff";resultsLayer=null;filterLayer=null;filterFeature=null;info=null;popup=null;resultsPanel=null;lastFeatureCount=null;markerStyle={cssClass:i.A.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};#fe={LIST_ITEM:`ul.${m}-features li`,SHOW_ALL_CHECKBOX:`.${m}-btn sitna-toggle.${m}-btn-show-all`,ZOOM_ALL_BUTTON:`.${m}-btn sitna-button.${m}-btn-zoom-all`,DEL_ALL_BUTTON:`.${m}-btn sitna-button.${m}-btn-del-all`};#wa=null;#_a={};#La;static#Ca={CLASS:m};constructor(){super(...arguments);const e=this;e.exportsState=!0,e._dialogDiv=o.A.getDiv(e.options.dialogDiv),e.options.dialogDiv||document.body.appendChild(e._dialogDiv),e.model=new A,e.menuModel=new E,e.dataModel=new S,e.dialogModel=new w}async register(e){const t=this,r=super.register.call(t,e);return t.#ba(),await t.setDisplayMode(t.options.displayMode||e.defaultInfoContainer||i.A.infoContainer.POPUP),e.loaded((function(){const r=e.getControlsByClass("TC.control.Share")[0];r&&t.loadSharedFeature(r.loadParamFeature())})),e.on(i.A.event.POPUPHIDE+" "+i.A.event.RESULTSPANELCLOSE,(function(e){const r=e.control;r.caller!==t&&r.currentFeature!==t.highlightedFeature||t.highlightedFeature?.toggleSelectedStyle(!1),r===t.getDisplayControl()&&t.resultsLayer&&(t.highlightedFeature&&!t.options.persistentHighlights&&(t.downplayFeature(t.highlightedFeature),t.highlightedFeature=null),!t.querying&&e.feature&&(t.filterLayer.removeFeature(e.feature),t.filterLayer.refresh()))})).on(i.A.event.POPUP+" "+i.A.event.DRAWTABLE+" "+i.A.event.DRAWCHART,(function(e){const r=e.control;r.currentFeature!==t.filterFeature&&(t.highlightedFeature=r.currentFeature),e.control.caller===t&&t._decorateDisplay(r)})).on(i.A.event.DRAWCHART,(function(e){setTimeout((function(){t.highlightedFeature=e.control.currentFeature}),50)})).on(i.A.event.LAYERREMOVE,(function(){if(Object.keys(t.#_a).length){const e={};t.map.workLayers.filter((function(e){return e.type===i.A.layerType.WMS})).forEach((function(t){const r=e[t.url]||[];e[t.url]=r.concat(t.getDisgregatedLayerNames())}));let r=!1;for(let n in t.#_a){const i=t.#_a[n];if(Object.prototype.hasOwnProperty.call(e,n)){const o=e[n];for(let e in i){const n=i[e];o.indexOf(e)<0&&(n.slice().forEach((e=>t.downplayFeature(e))),n.length=0,r=!0)}}else{for(let e in i)i[e].slice().forEach((e=>t.downplayFeature(e))),r=!0;delete t.#_a[n]}}r&&t.closeResults()}})).on(i.A.event.FEATUREREMOVE,(function(e){if(e.layer===t.resultsLayer)for(let r in t.#_a){const n=t.#_a[r];for(let t in n){const r=n[t];n[t]=r.filter((t=>t!==e.feature))}}})).on(i.A.event.FEATURESCLEAR,(function(e){e.layer===t.resultsLayer&&(t.#_a={})})).on(i.A.event.VIEWCHANGE,(function(e){t.closeResults()})),await r,t.options.share&&await t.getShareDialog(),t}async loadTemplates(){this.template=await _.loadTemplates()}static async loadTemplates(){const e=r.e(9111).then(r.bind(r,9111)),t=r.e(6589).then(r.bind(r,6589)),n=r.e(4021).then(r.bind(r,4021)),i=r.e(4455).then(r.bind(r,4455)),o=r.e(136).then(r.bind(r,136)),a=r.e(9031).then(r.bind(r,9031)),s=r.e(947).then(r.bind(r,947)),l=r.e(1517).then(r.bind(r,1517)),c=r.e(8332).then(r.bind(r,8332)),u=r.e(6453).then(r.bind(r,6453)),h={};return h[m]=(await e).default,h[m+"-attr"]=(await t).default,h[m+"-object"]=(await n).default,h[m+"-buttons"]=(await i).default,h[m+"-dialog"]=(await o).default,h[m+"-attr-val"]=(await a).default,h[m+"-attr-video"]=(await s).default,h[m+"-attr-image"]=(await l).default,h[m+"-attr-audio"]=(await c).default,h[m+"-attr-embed"]=(await u).default,h}async render(){const e=this;e.div.classList.add(i.A.classes.HIDDEN);const t=e.getRenderedHtml(e.CLASS+"-dialog",{checkboxId:e.getUID(),elevation:e.options.displayElevation});e._firstRender??=t,e._dialogDiv.innerHTML=await t,new f.A(e.dialogModel,new g.A(e._dialogDiv)),e.dialogModel.shareQuery=e.getLocaleString("shareQuery"),e.dialogModel.close=e.getLocaleString("close")}get layerCount(){return this.info?.services?this.info.services.reduce((function(e,t){return e+t.layers.reduce((function(e,t){return e+1}),0)}),0):0}#Ta(){const e=this,t=e.getMenuTarget(),r=t.querySelector(e.#fe.SHOW_ALL_CHECKBOX);r&&(r.checked=!0,r.setAttribute("title",e.getLocaleString("doNotShowOnMapAllResults"))),t.querySelector(e.#fe.ZOOM_ALL_BUTTON).classList.remove(i.A.classes.HIDDEN),t.querySelector(e.#fe.DEL_ALL_BUTTON).classList.remove(i.A.classes.HIDDEN)}#xa(){const e=this,t=e.getMenuTarget(),r=t.querySelector(e.#fe.SHOW_ALL_CHECKBOX);r&&(r.checked=!1,r.setAttribute("title",e.getLocaleString("showOnMapAllResults")),t.querySelector(e.#fe.ZOOM_ALL_BUTTON).classList.add(i.A.classes.HIDDEN),t.querySelector(e.#fe.DEL_ALL_BUTTON).classList.add(i.A.classes.HIDDEN))}responseCallback(e){const t=this;if(t.querying=!1,t.filterFeature&&(t.info={services:e.services},t.options.persistentHighlights))for(let e in t.#_a){const r=(t.info.services||[]).find((t=>t.url===e));if(r){const n=t.#_a[e];for(let e in n){const t=r.layers.find((t=>t.name===e));t&&n[e].forEach((function(e){const r=e.wrap.getId(),n=t.features.findIndex((e=>e.wrap.getId()===r));-1!==n&&t.features.splice(n,1)}))}}}e.featureCount?(t.#Pa(),t.lastFeatureCount=e.featureCount,t.map.trigger(i.A.event.FEATUREINFO,o.A.extend({control:t},e))):(t.lastFeatureCount=0,t.map.trigger(i.A.event.NOFEATUREINFO,{control:t}))}responseError(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:i.A.msgType.ERROR}),t.responseCallback({})}async setDisplayMode(e){const t=this;t.displayMode=e,e===i.A.infoContainer.RESULTS_PANEL?await t.getResultsPanel():(t.displayMode=i.A.infoContainer.POPUP,await t.getPopup())}async getPopup(){const e=this;return e.popup||(e.popup=await e.map.addControl("popup",{closeButton:!0,draggable:e.options.draggable,share:e.options.share}),e.popup.caller=e,e.map.on(i.A.event.POPUP,(function(t){e.onShowPopup(t)}))),e.popup}async getResultsPanel(){const e=this;if(!e.resultsPanel){let t;const r={content:"table",titles:{main:e.getLocaleString("threed.rs.panel.gfi"),max:e.getLocaleString("threed.rs.panel.gfi")},share:e.options.share},n=e.map.getControlsByClass(u.default)[0];n?(r.position=n.POSITION.RIGHT,t=n.addControl("resultsPanel",r)):(r.div=document.createElement("div"),e.map.div.appendChild(r.div),t=e.map.addControl("resultsPanel",r)),e.resultsPanel=await t,e.resultsPanel.caller=e}return e.resultsPanel}getDisplayControl(){const e=this;return e.displayMode===i.A.infoContainer.RESULTS_PANEL?e.resultsPanel:e.popup}getDisplayTarget(e={}){const t=this;if(e.control)switch(!0){case e.control instanceof l.default:return e.control.getContainerElement();case e.control instanceof c.default:return e.control.getInfoContainer();default:return null}return t.displayMode===i.A.infoContainer.RESULTS_PANEL?t.resultsPanel.getInfoContainer():t.popup.getContainerElement()}getMenuTarget(){var e=this;return e.displayMode===i.A.infoContainer.RESULTS_PANEL?e.resultsPanel.getMenuElement():e.popup.getMenuElement()}displayResults(){const e=this,t=e.div.cloneNode(!0);t.classList.remove(i.A.classes.HIDDEN),e.filterFeature.data=t.outerHTML,e.displayMode===i.A.infoContainer.RESULTS_PANEL?e.resultsPanel&&(0===e.map.getControlsByClass(u.default).length&&e.map.getControlsByClass(c.default).forEach((function(e){e.isVisible()&&e.close()})),e.map.getControlsByClass(c.default).forEach((function(t){t!==e.resultsPanel&&t.currentFeature&&!t.chart&&t.close()})),e.resultsPanel.currentFeature=e.filterFeature,e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer()),e.getMenuTarget().innerHTML="",e.displayResultsCallback(),e.getResultsPanel().then((t=>{e.dataController=new f.A(e.dataModel,new g.A(t.getInfoContainer())),e.dataModel.open=e.getLocaleString("open"),e.dataModel.linkInNewWindow=e.getLocaleString("linkInNewWindow"),e.dataModel["featureInfo.complexData.array"]=e.getLocaleString("featureInfo.complexData.array"),e.dataModel.viewEnlargedImage=e.getLocaleString("viewEnlargedImage"),e.dataModel.audioFormatNotCompatible=e.getLocaleString("audioFormatNotCompatible"),e.dataModel.videoFormatNotCompatible=e.getLocaleString("videoFormatNotCompatible"),e.dataModel.openInNewTab=e.getLocaleString("openInNewTab")}))):e.getPopup().then((async t=>{const r=await e.filterFeature.showPopup(t);e?.resultsLayer?.features&&(e.dataController=new f.A(e.dataModel,new g.A(r.popupDiv)),e.dataModel.open=e.getLocaleString("open"),e.dataModel.linkInNewWindow=e.getLocaleString("linkInNewWindow"),e.dataModel["featureInfo.complexData.array"]=e.getLocaleString("featureInfo.complexData.array"),e.dataModel.viewEnlargedImage=e.getLocaleString("viewEnlargedImage"),e.dataModel.audioFormatNotCompatible=e.getLocaleString("audioFormatNotCompatible"),e.dataModel.videoFormatNotCompatible=e.getLocaleString("videoFormatNotCompatible"),e.dataModel.openInNewTab=e.getLocaleString("openInNewTab"))}))}#Ma(e){const t=e,r=v(e,"LI"),n=v(r,"LI");return this.getFeature(y(n),y(r),y(t))}getFeatureElement(e){const t=this;let r;const n=t.getDisplayTarget().querySelectorAll(t.#fe.LIST_ITEM);for(var i=0,o=n.length;i<o;i++){const o=n[i];if(t.#Ma(o)===e){r=o;break}}return r}getNextFeatureElement(e){const t=this,r=t.getDisplayTarget().querySelectorAll("ul."+t.CLASS+"-features > li"),n=r.length;for(var i=0;i<n;i++)if(r[i].matches("."+t.CURRENT_CLASS))return r[(i+e+n)%n];return null}getFeaturePath(e){const t=this;if(t.info?.services)for(var r=0,n=t.info.services.length;r<n;r++){const n=t.info.services[r];for(var i=0,o=n.layers.length;i<o;i++){const t=n.layers[i];for(var a=0,s=t.features.length;a<s;a++)if(t.features[a]===e)return{service:n.title||n.mapLayers.reduce((function(e,t){return e||t.title}),""),layer:t.path}}}return null}closeResults(){const e=this;e.displayMode===i.A.infoContainer.RESULTS_PANEL?e.resultsPanel&&e.resultsPanel.isVisible()&&e.resultsPanel.close():e.popup&&e.popup.isVisible()&&e.popup.hide()}displayResultsCallback(){const e=this,t=e.getDisplayTarget().querySelector("."+e.CLASS),r=t.querySelector(`.${e.CLASS}-btn-next`);r&&r.addEventListener(i.A.event.CLICK,(function(t){return e.highlightFeature(e.getNextFeatureElement(1),1),!1}),{passive:!0});const a=t.querySelector(`.${e.CLASS}-btn-prev`);a&&a.addEventListener(i.A.event.CLICK,(function(t){return e.highlightFeature(e.getNextFeatureElement(-1),-1),!1}),{passive:!0});const s=function(r){const n=getSelection();if("Range"===n.type&&(r.target.contains(n.anchorNode)||r.target.contains(n.focusNode)))return;const o=v(r.target,"LI");if(o.classList.contains(i.A.classes.CHECKED)){const r=t.querySelector(`.${e.CLASS}-layers > li:not(.tc-current)`);r&&"none"!==getComputedStyle(r).display&&e.downplayFeatures()}else e.highlightFeature(o.querySelector(e.#fe.LIST_ITEM)),e.displayMode===i.A.infoContainer.POPUP&&e.popup.fitToView(!0)};if(t.querySelectorAll(`ul.${e.CLASS}-layers h4`).forEach((e=>e.addEventListener(i.A.event.CLICK,s,{passive:!0}))),e.displayMode===i.A.infoContainer.POPUP&&t.querySelectorAll("img").forEach((t=>t.addEventListener("load",(()=>e.popup.fitToView())))),e.info){const r=e.getFeatures(),n=e.getMenuTarget();if(r.length>1)e.getRenderedHtml(`${e.CLASS}-buttons`,{id:e.id}).then((function(t){n.querySelector(`.${e.CLASS}-btn-dl`)||(n.insertAdjacentHTML("beforeend",t),n.querySelector(`.${e.CLASS}-btn-dl`).addEventListener(i.A.event.CLICK,(async function(t){const r=await e.getDownloadDialog();let n={title:e.getLocaleString("featureInfo")+" - "+e.getLocaleString("download"),fileName:e._getFileName()};(e.map.elevation||e.options.displayElevation)&&(n=Object.assign({},n,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)})),r.open(e.getFeatures(),n)}),{passive:!0}),n.querySelector(e.#fe.SHOW_ALL_CHECKBOX).addEventListener("change",(function(t){t.target.checked?e.showAllFeatures():e.hideAllFeatures()}),{passive:!0}),n.querySelector(e.#fe.ZOOM_ALL_BUTTON).addEventListener(i.A.event.CLICK,(function(t){e.map.zoomToFeatures(r)}),{passive:!0}),n.querySelector(e.#fe.DEL_ALL_BUTTON).addEventListener(i.A.event.CLICK,(function(t){e.downplayFeatures(),e.filterLayer.removeFeature(e.filterFeature)}),{passive:!0}))}));else{const t=n.querySelector(`.${e.CLASS}-btn`);t&&t.remove()}e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)?(e.getFeatureElement(e.info.defaultFeature).classList.add(i.A.classes.DEFAULT),e.highlightFeature(e.info.defaultFeature)):t.querySelector(e.#fe.LIST_ITEM)&&e.highlightFeature(t.querySelector(e.#fe.LIST_ITEM))}if(t.querySelectorAll("table:not(.tc-complex-attr)").forEach((function(t){t.parentElement.classList.contains(i.A.classes.CHECKED)||(e.controller.setAttribute("clickToShowOnMap","title",t),e.controller.model.clickToShowOnMap=e.getLocaleString("clickToShowOnMap")),t.addEventListener("click",(function(t){const r=this.parentElement;if(!r.classList.contains(i.A.classes.DISABLED)){if(r.classList.contains(i.A.classes.CHECKED)){const t=e.#Ma(r);t&&window.getSelection()&&0===window.getSelection().toString().trim().length&&(e.map.on(i.A.event.ZOOM,(function t(){e.#La=!1,e.map.off(i.A.event.ZOOM,t)})),e.#La=!0,e.map.zoomToFeatures([t],{animate:!0}))}else e.highlightFeature(r);t.stopPropagation()}}),{passive:!0})})),t.querySelectorAll("table a, table label, table input").forEach((function(e){e.addEventListener(i.A.event.CLICK,(function(e){e.stopPropagation()}),{passive:!0})})),n.A.browserFeatures.touch()&&e.displayMode===i.A.infoContainer.RESULTS_PANEL){const r=t.querySelector("."+e.CLASS+"-btn-prev");r&&"none"===r.style.display||(e.resultsPanel&&o.A.swipe(e.resultsPanel.div,"disable"),e.layerCount>1&&o.A.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}}))}e.displayMode!==i.A.infoContainer.RESULTS_PANEL?e.getPopup().then((t=>{e.controller=new f.A(e.model,new g.A(t.contentDiv)),e.menuController=new f.A(e.menuModel,new g.A(t.menuDiv)),e.updateModel()})):e.getResultsPanel().then((t=>{e.controller=new f.A(e.model,new g.A(t.getInfoContainer())),e.menuController=new f.A(e.menuModel,new g.A(t.getMenuElement())),e.updateModel()}))}onShowPopup(e){e.control===this.popup&&this.displayResultsCallback()}loadSharedFeature(e){}insertLinks(){const e=this,t=e.getLocaleString("open"),r=e.getLocaleString("linkInNewWindow");e.div.querySelectorAll("td."+e.CLASS+"-val").forEach((function(e){const n=e.textContent;o.A.isURL(n)&&(e.innerHTML='<a href="'+n+'" target="_blank" title="'+r+'">'+t+"</a>")}))}highlightFeature(e,t){const r=this;var n;if(!r.#La){var o;if(e instanceof d.A)n=e,o=r.getFeatureElement(n);else for(o=e;o&&"LI"!==o.tagName;)o=o.parentElement;const a=v(o,"LI"),s=v(a,"LI"),l=y(s),c=y(a),u=y(o);n=n||r.getFeature(l,c,u),r.downplayFeatures({exception:n});const h=r.info.services[l];Object.prototype.hasOwnProperty.call(r.#_a,h.url)||(r.#_a[h.url]={});const p=r.#_a[h.url],g=h.layers[c],f=p[g.name]||[];f.includes(n)||(p[g.name]=f.concat(n));const m=r.getDisplayTarget();if(m.querySelectorAll("li").forEach((e=>e.classList.remove(r.CURRENT_CLASS))),o.classList.add(i.A.classes.CHECKED,r.CURRENT_CLASS),a.classList.add(i.A.classes.CHECKED,r.CURRENT_CLASS),s.classList.add(i.A.classes.CHECKED,r.CURRENT_CLASS),t>0?(o.classList.add(i.A.classes.FROMLEFT),a.classList.add(i.A.classes.FROMLEFT),s.classList.add(i.A.classes.FROMLEFT)):t<0&&(o.classList.add(i.A.classes.FROMRIGHT),a.classList.add(i.A.classes.FROMRIGHT),s.classList.add(i.A.classes.FROMRIGHT)),o.querySelector("table")&&o.querySelector("table").setAttribute("title",r.getLocaleString("clickToCenter")),n instanceof d.A||(n=null),n&&n===r.highlightedFeature)return;r.highlightedFeature=n;const A=m.querySelector("."+r.CLASS+"-counter-current");if(A&&(A.innerHTML=r.getFeatureIndex(l,c,u)+1),r.options.persistentHighlights||r.resultsLayer.features.slice().forEach((e=>{e!==n&&r.downplayFeature(e)})),n){const e=e=>r.map.trigger(i.A.event.FEATUREHIGHLIGHT,{feature:e,control:r});if(n.geometry){let t;n.showsPopup=r.options.persistentHighlights,r.options.persistentHighlights&&(t=r.resultsLayer.getFeatureById(n.wrap.getId()),t&&e(t)),t||r.resultsLayer.addFeature(n).then((function(t){e(n)}))}else o.classList.add(i.A.classes.DISABLED),e(n)}}}downplayFeature(e){const t=this,r=t.getFeatureElement(e);let n;for(var o in r&&r.classList.remove(i.A.classes.CHECKED),t.options.persistentHighlights&&(n=t.resultsLayer.getFeatureById(e.wrap.getId())),t.resultsLayer.removeFeature(n||e),t.#_a){const r=t.#_a[o];for(var a in r){let t=r[a];t=r[a]=t.filter((t=>t!==e)),t.length||delete r[a]}}t.highlightedFeature===e&&(t.highlightedFeature=null),t.map.trigger(i.A.event.FEATUREDOWNPLAY,{feature:e,control:t})}downplayFeatures(e={}){const t=this,r=t.highlightedFeature;r&&r!==e.exception&&(t.downplayFeature(r),t.highlightedFeature=null),t.getFeatures().filter((e=>e!==r)).forEach((e=>t.resultsLayer.removeFeature(e)));const n=e.exception?t.getFeatureElement(e.exception):void 0;var o,a;n&&(o=v(n,"LI"),a=v(o,"LI"));const s=t.getDisplayTarget();Array.from(s.querySelectorAll("ul."+t.CLASS+"-services li")).filter((function(e){return e!==n&&e!==o&&e!==a})).forEach((function(e){e.classList.remove(i.A.classes.CHECKED,i.A.classes.DISABLED,i.A.classes.FROMLEFT,i.A.classes.FROMRIGHT)})),s.querySelectorAll("."+t.CLASS+"-features table:not(.tc-complex-attr)").forEach((function(e){t.controller&&(t.controller.setAttribute("clickToShowOnMap","title",e),t.controller.model.clickToShowOnMap=t.getLocaleString("clickToShowOnMap"))})),t.#xa()}showAllFeatures(){const e=this;e.highlightedFeature&&e.downplayFeature(e.highlightedFeature);for(var t=0,r=e.info.services.length;t<r;t++){const r=e.info.services[t],s=e.#_a[r.url]=e.#_a[r.url]||{};for(var n=0,i=r.layers.length;n<i;n++){const t=r.layers[n];let i=s[t.name]||[];for(var o=0,a=t.features.length;o<a;o++){const r=t.features[o];r.showsPopup=e.options.persistentHighlights,i.includes(r)||(s[t.name]=i=i.concat(r)),e.resultsLayer.features.includes(r)||e.resultsLayer.addFeature(r)}}}e.#Ta()}hideAllFeatures(){const e=this,t=e.getDisplayTarget().querySelector(`ul.${e.CLASS}-layers > li.${i.A.classes.CHECKED}`);e.downplayFeatures(),t&&t.classList.add(i.A.classes.CHECKED)}getFeature(e,t,r){var n;const i=this.info;return i&&i.services&&(n=i.services[e])&&(n=n.layers[t])&&(n=n.features[r]),n}getFeatures(){let e=[];const t=this.info;return t&&t.services&&(e=t.services.reduce(((e,t)=>e.concat(t.layers.reduce(((e,t)=>e.concat(t.features)),[]))),e)),e}getFeatureIndex(e,t,r){var n=-1;const i=this.info;if(i)for(var o=0;o<=e;o++)for(var a=i.services[o],s=o===e?t:a.layers.length-1,l=0;l<=s;l++)for(var c=a.layers[l],u=l===t&&o===e?r:c.features.length-1,h=0;h<=u;h++)n+=1;return n}removeFeature(e){const t=this,r=t.info;if(r){let o=t.getFeatures();const a=o.indexOf(e);for(var n=0;n<r.services?.length;n++)for(var i=0;i<r.services[n].layers.length;i++){const s=r.services[n].layers[i].features.findIndex((t=>t.id===e.id));if(s>=0&&r.services[n].layers[i].features.splice(s,1).length)return o=t.getFeatures(),t.responseCallback(Object.assign(r,{coords:t.filterFeature.geometry,defaultFeature:o[a===o.length?a-1:a],featureCount:o.length})),!0}}return!1}beforeRequest(e){const t=this;t.querying=!0,t.map.trigger(i.A.event.BEFOREFEATUREINFO,{xy:e.xy,control:t}),t.closeResults(),t.map&&t.resultsLayer&&(t.lastFeatureCount=null,t.options.persistentHighlights||t.resultsLayer.features.slice().forEach((e=>t.downplayFeature(e))),t.info=null)}deactivate(e){const t=this;t.popup&&t.popup.isVisible()&&t.popup.hide(),t.options.persistentHighlights||(t.resultsLayer.features.slice().forEach((e=>t.downplayFeature(e))),t.info=null,t.#_a={}),t.filterLayer&&t.filterLayer.clearFeatures(),t.filterFeature=null,super.deactivate.call(t,e)}exportState(){const e=this;if(e.exportsState&&e.resultsLayer){const t={};return e.toShare&&(t.features=[]),{id:e.id,layer:e.resultsLayer.exportState(t),query:e.toShare}}return null}importState(e){const t=this;t.#wa.then((function(){e.layer&&t.resultsLayer.importState(e.layer),e.query&&t.importQuery(e.query)}))}#ba(){const e=this;var t,r;if(t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:i.A.layerType.VECTOR,owner:e,stealth:!0},e.options.filterLayer)r=e.options.filterLayer;else{const t={};e.geometryType===i.A.geom.POLYLINE&&(t.line=e.style),e.geometryType===i.A.geom.POLYGON&&(t.polygon=e.style),r={id:e.getUID(),title:e.CLASS+": Filter layer",owner:e,stealth:!0,type:i.A.layerType.VECTOR,styles:t}}const n=e.map;return e.#wa=new Promise((function(i,o){n.loaded((function(){const o=n.layers.indexOf(t)>=0?Promise.resolve(t):n.addLayer(t),a=n.layers.indexOf(r)>=0?Promise.resolve(r):n.addLayer(r);Promise.all([o,a]).then((function(t){e.resultsLayer=t[0],e.filterLayer=t[1],i()}))}))})),e.#wa}_generateTitle(e){const t=this;var r=t.getLocaleString("feature");if(e===t.getDisplayControl())if(t.filterFeature instanceof p.A){const e=t.filterFeature.geometry;r=t.getLocaleString("featuresAt",{crs:t.map.crs,x:o.A.formatCoord(e[0],t.map.wrap.isGeo()?i.A.DEGREE_PRECISION:i.A.METER_PRECISION),y:o.A.formatCoord(e[1],t.map.wrap.isGeo()?i.A.DEGREE_PRECISION:i.A.METER_PRECISION)})}else r=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(r=e.currentFeature.id);return r}_decorateDisplay(e){const t=this,r=t.getMenuTarget({control:e}),n=r.querySelector("."+s.default.prototype.CLASS+"-btn");if(n)t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup||n.remove();else{var i=t._generateTitle(e);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&(t.printCtl=new s.default({target:r,printableElement:t.getDisplayTarget({control:e}),title:i}),t.printToolModel=t.printCtl.model,t.printToolModel.printThisContent=t.getLocaleString("printThisContent"),t.printToolModel.print=t.getLocaleString("print"))}_.addSpecialAttributeEventListeners(e.getContainerElement())}#Pa(){const e=this,t="h3_"+e.getLocaleString("service"),r="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach((function(n){n.layers.forEach((function(n){n.features.forEach((function(n){if(n instanceof d.A){const i=e.getFeaturePath(n);if(i){const a={};a[t]=i.service,i.layer&&(a[r]=i.layer.join(e.TITLE_SEPARATOR));const s=o.A.extend(a,n.getData());n.clearData(),n.setData(s)}}}))}))}))}_getFileName(){return this.getLocaleString("featureInfo").toLowerCase().replace(/\s/gi,"_")+"_"+o.A.getFormattedDate((new Date).toString(),!0)}showShareDialog(e){const t=this;return t.toShare=t.exportQuery(),h.default.showShareDialog.call(t,e)}exportQuery(){const e=this,t={};if(e.filterFeature){const r=e.filterLayer.exportState();r.features.forEach((e=>delete e.data)),t.filter=r,e.highlightedFeature&&(t.hlf=e.highlightedFeature.getId())}return t}importQuery(e){const t=this;e.filter&&(t.activate(),t.filterLayer.importState(e.filter).then((function(){t.filterFeature=t.filterLayer.features[0],t.sendRequest(t.filterFeature);const r=function(n){if(n.control===t){const n=t.getFeatures().find((t=>t.getId()===e.hlf));n?t.highlightFeature(n):Object.prototype.hasOwnProperty.call(e,"hlf")||setTimeout((()=>t.showAllFeatures()),100),t.map.off(i.A.event.FEATUREHIGHLIGHT,r)}};t.map.on(i.A.event.FEATUREHIGHLIGHT,r)})))}static async renderFeatureAttributeTable(e={}){const t=this;t.#Ca.template||(t.#Ca.template=await t.loadTemplates());const r={...e},n=e=>{const t={};for(const r in e){const i=e[r];i instanceof d.A||(i&&o.A.isPlainObject(i)?t[r]=n(i):t[r]=i)}return t};return r.attributes=n(e.attributes),await t.prototype.getRenderedHtml.call(t.#Ca,m+"-attr",r)}static async renderFeatureAttribute(e){const t=this;return t.#Ca.template||(t.#Ca.template=await t.loadTemplates()),await t.prototype.getRenderedHtml.call(t.#Ca,m+"-attr-val",e)}static async showImageDialog(e){const t=this;t.#Ca.template||(t.#Ca.template=await t.loadTemplates());const r=await t.prototype.getRenderedHtml.call(t.#Ca,m+"-dialog",{src:e.getAttribute("src")}),n=document.createElement("div");return n.insertAdjacentHTML("beforeend",r),document.body.appendChild(n),o.A.showModal(n.querySelector(`.${m}-img-dialog`),{closeCallback:()=>n.remove()}),n.querySelector(".tc-modal-img img").addEventListener(i.A.event.CLICK,(function(e){o.A.closeModal()}),{passive:!0}),n}static addSpecialAttributeEventListeners(e){const t=this;e.querySelectorAll("img.tc-img-attr").forEach((function(e){e.addEventListener(i.A.event.CLICK,(function(e){setTimeout((()=>t.showImageDialog(e.target)),50),e.stopPropagation()}),{passive:!0})}))}async updateModel(){const e=this;e.model.crs=e.getLocaleString("crs"),e.model.lat=e.getLocaleString("lat"),e.model.lon=e.getLocaleString("lon"),e.model.feature=e.getLocaleString("feature"),e.model.heightOverTerrain=e.getLocaleString("heightOverTerrain"),e.model.height=e.getLocaleString("height"),e.model["elevation.explained"]=e.getLocaleString("elevation.explained"),e.model.ele=e.getLocaleString("ele"),e.model.expand=e.getLocaleString("expand"),e.model["fi.error"]=e.getLocaleString("fi.error"),e.model.noDataInThisLayer=e.getLocaleString("noDataInThisLayer"),e.model.noDataAtThisService=e.getLocaleString("noDataAtThisService"),e.model.noData=e.getLocaleString("noData"),e.model.previous=e.getLocaleString("previous"),e.model.next=e.getLocaleString("next"),e.dialogModel.shareQuery=e.getLocaleString("shareQuery"),e.dialogModel.close=e.getLocaleString("close"),e.model.clickToShowOnMap=e.getLocaleString("clickToShowOnMap"),(await e.getResultsPanel())?.setTitles({main:e.getLocaleString("threed.rs.panel.gfi"),max:e.getLocaleString("threed.rs.panel.gfi")}),e.menuModel.showOnMapAllResults=e.getLocaleString("showOnMapAllResults"),e.menuModel.zoomToAllResults=e.getLocaleString("zoomToAllResults"),e.menuModel.removeAllResults=e.getLocaleString("removeAllResults"),e.menuModel.downloadAllResults=e.getLocaleString("downloadAllResults"),e.dataModel.open=e.getLocaleString("open"),e.dataModel.linkInNewWindow=e.getLocaleString("linkInNewWindow"),e.dataModel["featureInfo.complexData.array"]=e.getLocaleString("featureInfo.complexData.array"),e.dataModel.viewEnlargedImage=e.getLocaleString("viewEnlargedImage"),e.dataModel.audioFormatNotCompatible=e.getLocaleString("audioFormatNotCompatible"),e.dataModel.videoFormatNotCompatible=e.getLocaleString("videoFormatNotCompatible"),e.dataModel.openInNewTab=e.getLocaleString("openInNewTab")}async updateLanguage(){const e=this;e.updateModel(),e.printCtl&&(e.printCtl.title=e._generateTitle(e.getDisplayControl()))}}n.A.mix(_,h.default),_.prototype.CLASS=m,n.A.control.FeatureInfoCommons=_;const L=_},9703:(e,t,r)=>{"use strict";r.d(t,{Bb:()=>u,T9:()=>f,Tl:()=>p,Zz:()=>g,cL:()=>a,dI:()=>y,e$:()=>h,hs:()=>d,k3:()=>c,lw:()=>s,tI:()=>A,vt:()=>o});var n=r(588);const i=new Array(6);function o(){return[1,0,0,1,0,0]}function a(e){return l(e,1,0,0,1,0,0)}function s(e,t){const r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],p=t[5];return e[0]=r*l+i*c,e[1]=n*l+o*c,e[2]=r*u+i*h,e[3]=n*u+o*h,e[4]=r*d+i*p+a,e[5]=n*d+o*p+s,e}function l(e,t,r,n,i,o,a){return e[0]=t,e[1]=r,e[2]=n,e[3]=i,e[4]=o,e[5]=a,e}function c(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function u(e,t){const r=t[0],n=t[1];return t[0]=e[0]*r+e[2]*n+e[4],t[1]=e[1]*r+e[3]*n+e[5],t}function h(e,t){const r=Math.cos(t),n=Math.sin(t);return s(e,l(i,r,n,-n,r,0,0))}function d(e,t,r){return s(e,l(i,t,0,0,r,0,0))}function p(e,t,r){return s(e,l(i,1,0,0,1,t,r))}function g(e,t,r,n,i,o,a,s){const l=Math.sin(o),c=Math.cos(o);return e[0]=n*c,e[1]=i*l,e[2]=-n*l,e[3]=i*c,e[4]=a*n*c-s*n*l+t,e[5]=a*i*l+s*i*c+r,e}function f(e,t){const r=(i=t)[0]*i[3]-i[1]*i[2];var i;(0,n.v)(0!==r,"Transformation matrix cannot be inverted");const o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5];return e[0]=l/r,e[1]=-a/r,e[2]=-s/r,e[3]=o/r,e[4]=(s*u-l*c)/r,e[5]=-(o*u-a*c)/r,e}const m=[1e5,1e5,1e5,1e5,2,2];function y(e){return"matrix("+e.join(", ")+")"}function v(e){return e.substring(7,e.length-1).split(",").map(parseFloat)}function A(e,t){const r=v(e),n=v(t);for(let e=0;e<6;++e)if(0!==Math.round((r[e]-n[e])*m[e]))return!1;return!0}},9740:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var n=r(8038),i=r(797),o=r(3301),a=r(8325),s=r(3721),l=r(3607),c=r(3093),u=r(2902),h=r(7018),d=r(8606),p=r(6257);n.A.control=n.A.control||{};const g="sitna-track-edit";class f extends s.default{#Ia;formats=[i.A.format.GPX,i.A.format.KMZ];async register(e){await super.register.call(this,e),this.#Ia=this.options.caller;const t=await this.getEditControl();return t.setModes([l.default.mode.MODIFY,l.default.mode.ADDPOINT,l.default.mode.ADDLINE]),t.getModeTab(l.default.mode.ADDPOLYGON)?.classList.add(i.A.classes.HIDDEN),this}async loadTemplates(){const e=r.e(4397).then(r.bind(r,4397));this.template=(await e).default}async render(e){await super.render.call(this),await this.panel.renderPromise(),this.panel.setTitles({main:this.getLocaleString("editTrack")}),o.A.isFunction(e)&&e()}getCallerControls(){return this.options.caller?[this.options.caller]:this.map.getControlsByClass(c.default)}registerTool(e){const t=this;if(e.options.fileEditing){const r=o.A.getTextFromCssVar("--icon-edit",e.div);if(e instanceof c.default){const o=t.getEditControl(),s=function(t){return t.layer===e.trackLayer&&!t.wrap._extending&&e.trackLayer.features.some((e=>e instanceof d.A||e instanceof p.A))};o.then((function(r){r.on(i.A.event.DRAWEND+" "+i.A.event.FEATUREMODIFY,(function(t){if(t.feature.layer===e.trackLayer&&(t.type===i.A.event.DRAWEND||t.geometryChanged)&&(t.feature instanceof d.A||t.feature instanceof p.A)){e.updateEndMarkers();const t=e.getSelectedTrackItem();t&&e.displayTrackProfile(t,{forceRefresh:!0})}})),r.on(i.A.event.DRAWEND,(async function(n){if(n.feature.layer===e.trackLayer&&n.feature instanceof h.A){n.feature.setData({name:""});const i=await t.map.getElevationTool();await i.setGeometry({features:[n.feature],crs:t.map.crs}),r.displayMeasurement(n.feature);const o=n.feature.getStyle()||{};o.label=e.trackLayer.styles?.point?.label,n.feature.setStyle(o)}})),r.getLineDrawControl().then((function(r){t.map.on(i.A.event.CONTROLACTIVATE,(function(t){t.control===r&&r.layer===e.trackLayer&&(r.snapping=e.trackLayer.features.filter((e=>!(e instanceof h.A))))})).on(i.A.event.FEATUREADD,(function(t){t.feature.layer!==e.trackLayer||!Array.isArray(r.snapping)||t.feature instanceof h.A||r.snapping.push(t.feature)}));const n=async function(e){let r=!1;const n=await t.map.getElevationTool();for(const t of a.A.iterateCoordinates(e.geometry)){if(null==t[2]){const e=await n.getElevation({coordinates:[t]});e?.length&&(r=!0,t[2]=e[0][2])}}return r&&e.setCoordinates(e.geometry),e},o=async function(t){if(r.layer===e.trackLayer){let t=await n(r.getSketch().clone());if(s(r))return;const i=r.getExtendedFeature();i&&(t=i instanceof p.A?new p.A(i.getCoordinates().concat([t.getCoordinates()])):i.getCoordsArray().concat(t.getCoordsArray())),e.displayTrackProfile(e.getSelectedTrackItem(),{forceRefresh:!0,feature:t})}};r.addEventListener(i.A.event.POINT,o),r.addEventListener(i.A.event.DRAWUNDO,o),r.addEventListener(i.A.event.DRAWREDO,o),r.addEventListener(i.A.event.DRAWCANCEL,(function(t){r.layer===e.trackLayer&&e.displayTrackProfile(e.getSelectedTrackItem(),{forceRefresh:!0})})),r.addEventListener(i.A.event.DRAWEND,(function(t){r.layer===e.trackLayer&&n(t.detail.feature)}))}))})),e.addItemTool({renderFn:function(n){const i=t.CLASS+"-btn-edit";let o=n.querySelector("sitna-toggle."+i);if(!o){const n=t.getLocaleString("editTrack");o=new u.A,o.setAttribute("title",n),o.checkedIconText=r,o.uncheckedIconText=r,t.getLayer().then((function(t){o.checked=t===e.trackLayer}))}return o},updateEvents:[i.A.event.CONTROLACTIVATE,i.A.event.CONTROLDEACTIVATE,i.A.event.LAYERUPDATE],updateFn:function(r){const n=this;t.getLayer().then((function(t){n.checked=t===e.trackLayer}))},actionFn:function(){const r=this,i=async function(){t.closeEditSession(),await t.setLayer(e.trackLayer),t.openEditSession({stylable:!1,extensibleSketch:!0,modes:[l.default.mode.MODIFY,l.default.mode.ADDPOINT,l.default.mode.ADDLINE]})};r.checked?e.trackLayer.features.some((e=>e.getGeometryStride()>2))?n.A.confirm(t.getLocaleString("elevationsWillBeRequested.confirm"),i,(()=>r.checked=!r.checked)):i():t.closeEditSession()}}),o.then((e=>{e.getLineDrawControl().then((e=>{e.addEventListener(i.A.event.DRAWSTART,(function(r){s(e)&&(e.new(),t.map.toast(t.getLocaleString("cannotAddSeparateLines.warning"),{type:i.A.msgType.WARNING}))}))}))}))}}}async save(e={}){const t=await this.getLayer();if(t.file)return e.formats??=this.formats,super.save.call(this,e);let r;this.#Ia?r=this.#Ia.getSelectedTrackItem()?.dataset.uid:this.#Ia=await this.map.addControl("geolocation"),r??=this.#Ia.createTrackUID(),this.#Ia.saveTrack({uid:r}),this.markAsSaved(t)}async openEditSession(e){await super.openEditSession(e),await this.#Sr()}async#Sr(){const e=this,t=await e.getLayer(),r=!t||!(t._fileHandle&&!t._additionalFileHandles?.length||t.fileSystemFile||t.file)||t._additionalFileHandles?.length;e.saveButton.disabled=!1,e.saveAsButton&&(e.saveAsButton.disabled=r)}}f.prototype.CLASS="tc-ctl-tedit",customElements.get(g)||customElements.define(g,f),n.A.control.TrackEdit=f;const m=f},9770:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var n=r(8038),i=r(797),o=r(3301),a=r(1256),s=r(4450),l=r(6792);n.A.control=n.A.control||{},n.A.Control=a.A;class c extends a.A{#Ra;constructor(){super(...arguments),this.isLoaded=!1,this.layer=null}async loadTemplates(){const e=await r.e(9238).then(r.bind(r,9238));this.template=e.default}async register(e){const t=this,r=function(t){var r;return r=function(t){var r,n=function(e,t){for(var r=null,n=0;n<t.length;n++){var i=t[n];if((i.id||i)===e){r=i;break}}return r};if("string"==typeof t){var a=n(t,e.availableBaseLayers);o.A.isPlainObject(a)||(a=n(t,e.options.baseLayers)),o.A.isPlainObject(a)&&(r=new s.A(a))}else r=t instanceof s.A||t instanceof l.A?t:t.type===i.A.layerType.VECTOR||t.type===i.A.layerType.KML||t.type===i.A.layerType.WFS?new l.A(t):new s.A(t);return r}(t),r},a=function(e){const t=this;if(t.map.baseLayer.type===i.A.layerType.WMS||t.map.baseLayer.type===i.A.layerType.WMTS||t.options.layer){var n=t.map.baseLayer.overviewMapLayer||t.options.layer;let o;t.layer.id!==n?o=r(n):i.A.event.PROJECTIONCHANGE.includes(e.type)&&(o=t.layer),o&&t.wrap.reset({layer:o}).then((function(e){t.layer=e}))}},c=await super.register.call(t,e);return t.wrap=new n.A.wrap.control.OverviewMap(t),e.loaded((function(){t.defaultLayer=r(t.options.layer),t.layer=r(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.availableBaseLayers[0]),t.#Oa().then((()=>function(){const r={};t.layer.getCapabilitiesPromise().then((function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(r.layer=t.layer.getFallbackLayer()),t.wrap.reset(r)}))}(e.crs))),e.on(i.A.event.PROJECTIONCHANGE+" "+i.A.event.BASELAYERCHANGE,a.bind(t))})),c}loaded(e){const t=this;o.A.isFunction(e)&&(t.isLoaded&&t.map&&t.map.isLoaded?e():t.on(i.A.event.MAPLOAD,e))}activate(){this.enable()}deactivate(){this.disable()}enable(){const e=this;super.enable.call(e),e.#Oa().then((()=>e.wrap.enable()))}disable(){const e=this;super.disable.call(e),e.#Oa().then((()=>e.wrap.disable()))}#Oa(){const e=this;return!e.#Ra&&e.map&&(e.#Ra=e.wrap.register(e.map)),e.#Ra}}c.prototype.CLASS="tc-ctl-ovmap",n.A.control.OverviewMap=c;const u=c},9797:(e,t,r)=>{var n={"./AttributesEdit":7098,"./AttributesEdit.js":7098,"./Attribution":6394,"./Attribution.js":6394,"./BasemapSelector":4459,"./BasemapSelector.js":4459,"./CacheBuilder":5794,"./CacheBuilder.js":5794,"./Click":6083,"./Click.js":6083,"./Container":8848,"./Container.js":8848,"./ControlContainer":7843,"./ControlContainer.js":7843,"./Coordinates":5272,"./Coordinates.js":5272,"./DataLoader":2484,"./DataLoader.js":2484,"./Download":3387,"./Download.js":3387,"./Draw":5121,"./Draw.js":5121,"./DrawMeasureModify":4532,"./DrawMeasureModify.js":4532,"./Edit":3607,"./Edit.js":3607,"./Elevation":7088,"./Elevation.js":7088,"./ExternalWMS":2335,"./ExternalWMS.js":2335,"./FeatureDownloadDialog":5357,"./FeatureDownloadDialog.js":5357,"./FeatureInfo":8927,"./FeatureInfo.js":8927,"./FeatureInfoCommons":9687,"./FeatureInfoCommons.js":9687,"./FeatureStyler":1092,"./FeatureStyler.js":1092,"./FeatureTools":7830,"./FeatureTools.js":7830,"./FileEdit":3721,"./FileEdit.js":3721,"./FileImport":780,"./FileImport.js":780,"./FullScreen":1302,"./FullScreen.js":1302,"./Geolocation":3093,"./Geolocation.js":3093,"./GeometryFeatureInfo":5909,"./GeometryFeatureInfo.js":5909,"./ImageMagnifier":5112,"./ImageMagnifier.js":5112,"./InfoDisplay":9105,"./InfoDisplay.js":9105,"./LanguageSelector":2376,"./LanguageSelector.js":2376,"./LayerCatalog":9683,"./LayerCatalog.js":9683,"./LayerLegend":9239,"./LayerLegend.js":9239,"./Legend":3126,"./Legend.js":3126,"./LineFeatureInfo":2875,"./LineFeatureInfo.js":2875,"./ListTOC":2189,"./ListTOC.js":2189,"./LoadingIndicator":5874,"./LoadingIndicator.js":5874,"./MapContents":3967,"./MapContents.js":3967,"./MapInfo":1421,"./MapInfo.js":1421,"./Measure":1979,"./Measure.js":1979,"./Measurement":6052,"./Measurement.js":6052,"./Modify":3333,"./Modify.js":3333,"./MultiFeatureInfo":5882,"./MultiFeatureInfo.js":5882,"./NavBar":9433,"./NavBar.js":9433,"./NavBarHome":8994,"./NavBarHome.js":8994,"./OfflineMapMaker":2994,"./OfflineMapMaker.js":2994,"./OverviewMap":9770,"./OverviewMap.js":9770,"./PolygonFeatureInfo":8839,"./PolygonFeatureInfo.js":8839,"./Popup":3521,"./Popup.js":3521,"./Print":5056,"./Print.js":5056,"./PrintMap":5232,"./PrintMap.js":5232,"./ProjectionSelector":7735,"./ProjectionSelector.js":7735,"./ResultsPanel":1535,"./ResultsPanel.js":1535,"./SWCacheClient":4128,"./SWCacheClient.js":4128,"./Scale":4641,"./Scale.js":4641,"./ScaleBar":2180,"./ScaleBar.js":2180,"./ScaleSelector":4272,"./ScaleSelector.js":4272,"./Search":2639,"./Search.js":2639,"./SelectContainer":6728,"./SelectContainer.js":6728,"./Share":2268,"./Share.js":2268,"./StreetView":3833,"./StreetView.js":3833,"./TOC":2773,"./TOC.js":2773,"./TabContainer":1993,"./TabContainer.js":1993,"./ThreeD":1783,"./ThreeD.js":1783,"./TrackDownloadDialog":9096,"./TrackDownloadDialog.js":9096,"./TrackEdit":9740,"./TrackEdit.js":9740,"./WFSEdit":7633,"./WFSEdit.js":7633,"./WFSQuery":4193,"./WFSQuery.js":4193,"./WebComponentControl":1845,"./WebComponentControl.js":1845,"./WorkLayerManager":6378,"./WorkLayerManager.js":6378,"./infoShare":5264,"./infoShare.js":5264,"./itemToolContainer":575,"./itemToolContainer.js":575,"./layerOwner":2935,"./layerOwner.js":2935};function i(e){return Promise.resolve().then((()=>{if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r(n[e])}))}i.keys=()=>Object.keys(n),i.id=9797,e.exports=i},9969:(e,t,r)=>{"use strict";r.d(t,{L8:()=>s,SH:()=>o,gr:()=>a});var n=r(6514),i=r(1597);function o(e,t,r,o,a,s,l){let c,u;const h=(r-t)/o;if(1===h)c=t;else if(2===h)c=t,u=a;else if(0!==h){let i=e[t],s=e[t+1],l=0;const h=[0];for(let n=t+o;n<r;n+=o){const t=e[n],r=e[n+1];l+=Math.sqrt((t-i)*(t-i)+(r-s)*(r-s)),h.push(l),i=t,s=r}const d=a*l,p=(0,n.El)(h,d);p<0?(u=(d-h[-p-2])/(h[-p-1]-h[-p-2]),c=t+(-p-2)*o):c=t+p*o}l=l>1?l:2,s=s||new Array(l);for(let t=0;t<l;++t)s[t]=void 0===c?NaN:void 0===u?e[c+t]:(0,i.Cc)(e[c+t],e[c+o+t],u);return s}function a(e,t,r,n,o,a){if(r==t)return null;let s;if(o<e[t+n-1])return a?(s=e.slice(t,t+n),s[n-1]=o,s):null;if(e[r-1]<o)return a?(s=e.slice(r-n,r),s[n-1]=o,s):null;if(o==e[t+n-1])return e.slice(t,t+n);let l=t/n,c=r/n;for(;l<c;){const t=l+c>>1;o<e[(t+1)*n-1]?c=t:l=t+1}const u=e[l*n-1];if(o==u)return e.slice((l-1)*n,(l-1)*n+n);const h=(o-u)/(e[(l+1)*n-1]-u);s=[];for(let t=0;t<n-1;++t)s.push((0,i.Cc)(e[(l-1)*n+t],e[l*n+t],h));return s.push(o),s}function s(e,t,r,n,i,o,s){if(s)return a(e,t,r[r.length-1],n,i,o);let l;if(i<e[n-1])return o?(l=e.slice(0,n),l[n-1]=i,l):null;if(e[e.length-1]<i)return o?(l=e.slice(e.length-n),l[n-1]=i,l):null;for(let o=0,s=r.length;o<s;++o){const s=r[o];if(t!=s){if(i<e[t+n-1])return null;if(i<=e[s-1])return a(e,t,s,n,i,!1);t=s}}return null}}},__webpack_module_cache__={},leafPrototypes,getProto,inProgress,dataWebpackPrefix;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var r=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(r.exports,r,r.exports,__webpack_require__),r.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.amdO={},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var r=Object.create(null);__webpack_require__.r(r);var n={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>n[t]=()=>e[t]));return n.default=()=>e,__webpack_require__.d(r,n),r},__webpack_require__.d=(e,t)=>{for(var r in t)__webpack_require__.o(t,r)&&!__webpack_require__.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,r)=>(__webpack_require__.f[r](e,t),t)),[])),__webpack_require__.u=e=>e+".bundle.js",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},dataWebpackPrefix="sitna-map-project-by-kimia-jimenez-majidi:",__webpack_require__.l=(e,t,r,n)=>{if(inProgress[e])inProgress[e].push(t);else{var i,o;if(void 0!==r)for(var a=document.getElementsByTagName("script"),s=0;s<a.length;s++){var l=a[s];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==dataWebpackPrefix+r){i=l;break}}i||(o=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack",dataWebpackPrefix+r),i.src=e),inProgress[e]=[t];var c=(t,r)=>{i.onerror=i.onload=null,clearTimeout(u);var n=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.removeChild(i),n&&n.forEach((e=>e(r))),t)return t(r)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=c.bind(null,i.onerror),i.onload=c.bind(null,i.onload),o&&document.head.appendChild(i)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;__webpack_require__.g.importScripts&&(e=__webpack_require__.g.location+"");var t=__webpack_require__.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),__webpack_require__.p=e})(),(()=>{var e={8792:0};__webpack_require__.f.j=(t,r)=>{var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,i)=>n=e[t]=[r,i]));r.push(n[2]=i);var o=__webpack_require__.p+__webpack_require__.u(t),a=new Error;__webpack_require__.l(o,(r=>{if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+o+")",a.name="ChunkLoadError",a.type=i,a.request=o,n[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var n,i,[o,a,s]=r,l=0;if(o.some((t=>0!==e[t]))){for(n in a)__webpack_require__.o(a,n)&&(__webpack_require__.m[n]=a[n]);s&&s(__webpack_require__)}for(t&&t(r);l<o.length;l++)i=o[l],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[i]=0},r=self.webpackChunksitna_map_project_by_kimia_jimenez_majidi=self.webpackChunksitna_map_project_by_kimia_jimenez_majidi||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var __webpack_exports__={};(()=>{"use strict";var e=__webpack_require__(8038),t=__webpack_require__(3301),r=__webpack_require__(797),n=__webpack_require__(153),i=__webpack_require__(187),o=__webpack_require__(9669),a=__webpack_require__(2639),s=__webpack_require__(8927),l=__webpack_require__(6631);e.A.Map=o.A,e.A.filter=l.A;const c=globalThis.SITNA?.Map||class extends o.A{#Da;#Na;constructor(e,r){if(i.A.controls.search&&(i.A.controls.search.allowedSearchTypes=t.A.extend(i.A.controls.search.allowedSearchTypes,{town:{},street:{},postalAddress:{},cadastralParcel:{}}),r?.controls?.search)){const e=Object.keys(r.controls.search),n={...r.controls.search};e.forEach((function(e){const i=r.controls.search[e];("boolean"==typeof i||t.A.isPlainObject(i))&&(i&&(n.allowedSearchTypes??={},n.allowedSearchTypes[e]=t.A.isPlainObject(i)?i:{}),delete n[e])})),r.controls.search=n}i.A.controls.threeD&&i.A.views&&i.A.views.threeD&&(i.A.views.threeD.controls=["search","TOC","attribution","basemapSelector","workLayerManager","layerCatalog","featureInfo","fullScreen","loadingIndicator","navBarHome","navBar","overviewMap","legend","threeD","coordinates","geolocation","resultsPanel","share"]),super(e,r);const n=this;n.search=null,n.loaded((async function(){const e=n.#Da=new a.default;if(await e.register(n),!n.activeControl){const e=n.getControlsByClass(s.default)[0];e&&e.activate()}n.#Na=await e.getLayer()}))}static get(e){return o.A.get(e)}async getQueryableData(n,i){const o=this;await o.#Da.renderPromise();const a=o.#Da.getAvailableSearchTypes()[n];if(a.queryableData)i&&i(a.queryableData);else{const n={request:"GetFeature",service:"WFS",typename:a.featurePrefix+":"+a.featureType,version:a.version,propertyname:(a.dataIdProperty instanceof Array?a.dataIdProperty:[a.dataIdProperty]).concat(a.outputProperties instanceof Array?a.outputProperties:[a.outputProperties]).join(","),outputformat:r.A.format.JSON},p=a.url+"?"+t.A.getParamString(n),g=(await e.A.ajax({url:p,responseType:r.A.mimeType.JSON})).data;if(a.queryableData=[],g.features){const e=g.features;for(var s=0,l=e.length;s<l;s++){const r=e[s],n={id:[]};Array.isArray(a.dataIdProperty)||(a.dataIdProperty=[a.dataIdProperty]);for(var c=0,u=a.dataIdProperty.length;c<u;c++){const e=a.dataIdProperty[c];Object.prototype.hasOwnProperty.call(r.properties,e)&&n.id.push(r.properties[e])}n.id=a.idPropertiesIdentifier?n.id.join(a.idPropertiesIdentifier):n.id.join(""),n.label=[],Array.isArray(a.outputProperties)||(a.outputProperties=[a.outputProperties]);for(var h=0,d=a.outputProperties.length;h<d;h++){const e=a.outputProperties[h];Object.prototype.hasOwnProperty.call(r.properties,e)&&n.label.push(r.properties[e])}const i=(Array.isArray(n.label)?n.label.join(""):n.label).trim().length>0;n.label=a.outputFormatLabel?t.A.formatIndexedTemplate(a.outputFormatLabel,...n.label):n.label.join("-"),i&&a.queryableData.push(n)}}a.queryableData=a.queryableData.sort((function(e,t){const r=o.#Da;return a.idPropertiesIdentifier&&-1===e.id.indexOf(a.idPropertiesIdentifier)?r.removePunctuation(e.label)<r.removePunctuation(t.label)?-1:r.removePunctuation(e.label)>r.removePunctuation(t.label)?1:0:r.removePunctuation(e.label.split(" ")[0])<r.removePunctuation(t.label.split(" ")[0])?-1:r.removePunctuation(e.label.split(" ")[0])>r.removePunctuation(t.label.split(" ")[0])?1:0})),a.queryableData=a.queryableData.filter((function(e,t,r){return t<1||e.id!==r[t-1].id&&e.label!==r[t-1].label})),i&&i(a.queryableData)}return a.queryableData}getMunicipalities(e){return this.getQueryableData(r.A.mapSearchType.MUNICIPALITY,e)}getUrbanAreas(e){return this.getQueryableData(r.A.mapSearchType.TOWN,e)}getCommonwealths(e){return this.getQueryableData(r.A.mapSearchType.COMMONWEALTH,e)}getCouncils(e){return this.getQueryableData(r.A.mapSearchType.COUNCIL,e)}searchCommonwealth(e,t){return this.searchTyped(r.A.mapSearchType.COMMONWEALTH,e,t)}searchCouncil(e,t){return this.searchTyped(r.A.mapSearchType.COUNCIL,e,t)}searchUrbanArea(e,t){return this.searchTyped(r.A.mapSearchType.TOWN,e,t)}searchMunicipality(e,t){return this.searchTyped(r.A.mapSearchType.MUNICIPALITY,e,t)}searchTyped(n,i,o){const a=this,s=e.A.getUID(),l=a.#Da,c=l.availableSearchTypes[n];return Array.isArray(i)&&c.goToIdFormat&&(i=t.A.formatIndexedTemplate(c.goToIdFormat,...i)),l.data=l.data||[],l.data.push({dataLayer:c.featureType,dataRole:n,id:i,label:"",text:""}),a.removeSearch(),l.availableSearchTypes[n]&&!l.getSearchTypeByRole(n)&&(l.availableSearchTypes[n].queryFactory||(l.availableSearchTypes[n].queryFactory=function(t){return{params:{type:r.A.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:function(t){let r=[];c.idPropertiesIdentifier&&(t=t.split(c.idPropertiesIdentifier)),Array.isArray(t)||(t=[t]);for(var n=0,i=c.dataIdProperty.length;n<i;n++)r.push(new e.A.filter.equalTo(c.dataIdProperty[n],t[n].trim()));return r=r.length>1?new e.A.filter.and(r):r[0],r}(t),outputFormat:this.outputFormat,styles:this.styles}}}.bind(c)),l.addAllowedSearchType(n,l.availableSearchTypes[n],l)),new Promise((function(e,t){a.one(r.A.event.SEARCHQUERYEMPTY,(function(t){a.toast(l.EMPTY_RESULTS_LABEL,{type:r.A.msgType.INFO,duration:5e3}),o&&o(null),e(null)})),a.one(r.A.event.FEATURESADD,(function(t){t.layer===a.#Na&&t.layer.features&&t.layer.features.length>0&&a.zoomToFeatures(t.layer.features),a.search={layer:t.layer,type:n};const r=t.layer.id!==s?t.layer.id:s;o&&o(r),e(r)})),l.goToResult(i,n)}))}searchFeature(t,n,i,o){const a=this,s=e.A.getUID();let l=a.#Da.featurePrefix;if(a.removeSearch(),t=(t||"").trim(),n=(n||"").trim(),i=(i||"").trim(),0!==t.length&&0!==n.length&&0!==i.length){t.indexOf(":")>-1&&(l=t.split(":")[0],t=t.split(":")[1]);const c=function(t){if(Array.isArray(t)){const n=t.map((function(t){return Object.prototype.hasOwnProperty.call(t,"type")?1==(t.type===r.A.comparison.EQUAL_TO)?new e.A.filter.equalTo(t.name,t.value):void 0:new e.A.filter.equalTo(t.name,t.value)}));return n.length>1?e.A.filter.and.apply(null,n):n[0]}},u={id:s,type:r.A.layerType.WFS,url:a.#Da.url,version:a.#Da.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:t,maxFeatures:1,properties:c([{name:n,value:i,type:r.A.comparison.EQUAL_TO}]),outputFormat:r.A.format.JSON};let h;return a.addLayer(u).then((function(e){h=e,a.search={layer:e,type:r.A.mapSearchType.GENERIC}})),a.on(r.A.event.FEATURESADD,(function(e){const t=e.layer;if(t===h&&t.features&&t.features.length>0){for(var r=0,n=t.features.length;r<n;r++)t.features[r].showsPopup!=a.#Da.queryableFeatures&&(t.features[r].showsPopup=a.#Da.queryableFeatures);a.zoomToFeatures(t.features)}})),new Promise((function(e,t){a.on(r.A.event.LAYERUPDATE,(function(t){const n=t.layer,i=t.newData;n===h&&i&&i.features&&0===i.features.length&&a.toast(a.#Da.EMPTY_RESULTS_LABEL,{type:r.A.msgType.INFO,duration:5e3});const l=n===h&&i&&i.features&&0===i.features.length?null:s;o&&o(l),e(l)}))}))}a.toast(a.#Da.EMPTY_RESULTS_LABEL,{type:r.A.msgType.INFO,duration:5e3}),o&&o(null)}removeSearch(e){const t=this;if(t.search){for(var r=0,n=t.search.layer.features.length;r<n;r++)t.search.layer.removeFeature(t.search.layer.features[r]);t.search=null}e&&e()}},u=c;var h=__webpack_require__(9566),d=__webpack_require__(7018),p=__webpack_require__(1651),g=__webpack_require__(2948),f=__webpack_require__(9439),m=__webpack_require__(8606),y=__webpack_require__(6257),v=__webpack_require__(6546),A=__webpack_require__(1667),S=__webpack_require__(8370),E=__webpack_require__(3365),w=__webpack_require__(4450),_=__webpack_require__(6792),L=(__webpack_require__(4921),__webpack_require__(8991),__webpack_require__(5637)),C=__webpack_require__(8447),b=__webpack_require__(4370),T=(__webpack_require__(2902),__webpack_require__(3327));const x="sitna-tab";class P extends T.A{#ka;constructor(){super(),this.createTemplate();const e=this.getTemplate();this.shadowRoot.appendChild(e.content.cloneNode(!0)),this.shadowRoot.querySelector("slot").addEventListener("slotchange",(()=>this.#en())),this.addEventListener(r.A.event.CLICK,(e=>this.onClick()),{passive:!0})}connectedCallback(){this.#en(),this.toggleAttribute("selected",this.selected),this.#Fa()}static get observedAttributes(){return["text","selected","disabled","deselectable"]}attributeChangedCallback(e,t,r){t!==r&&("text"===e?this.#en():"selected"===e&&this.#Fa())}get elementName(){return x}get text(){return this.getAttribute("text")||""}set text(e){e?this.setAttribute("text",e):this.removeAttribute("text")}#en(){const e=this.text||this.textContent;this.textContent!==e&&(this.textContent=e)}get group(){return this.getAttribute("group")}get target(){const e=this.getAttribute("for");return e?document.getElementById(e):null}get selected(){return this.hasAttribute("selected")}set selected(e){this.toggleAttribute("selected",!!e)}#Fa(){const e=this.siblings,t=e.concat(this);this.selected&&e.forEach((e=>{e.removeAttribute("selected")}));const n=t.some((e=>e.selected));t.forEach((e=>{e.toggleAttribute("no-selection",!n);const t=e.target;t&&t.classList.toggle(r.A.classes.HIDDEN,!e.selected)}))}get disabled(){return this.hasAttribute("disabled")}set disabled(e){this.toggleAttribute("disabled",!!e)}get deselectable(){return this.hasAttribute("deselectable")}set deselectable(e){this.toggleAttribute("deselectable",!!e)}get siblings(){return Array.from(document.querySelectorAll(`${this.elementName}[group="${this.group}"]`)).filter((e=>e!==this))}onClick(){if(!this.disabled){const e=!this.deselectable||!this.selected;this.toggleAttribute("selected",e),t.A.isFunction(this.callback)&&this.callback()}}}customElements.get(x)||(T.A.preloadStyle(x),customElements.define(x,P)),__webpack_require__(6031),e.A.isDebug=!0;const M={Layer:E.A,Raster:w.A,Vector:_.A},I={Feature:h.A,Point:d.A,MultiPoint:p.A,Marker:g.A,MultiMarker:f.A,Polyline:m.A,MultiPolyline:y.A,Polygon:v.A,MultiPolygon:A.A,Circle:S.A},R=(b.A,e.A.tool||{});e.A.feature=I,e.A.layer=M,e.A.tool=R,e.A.Util=t.A,e.A.Consts=r.A,e.A.i18n=n.A,e.A.Cfg=i.A,e.A.Map=o.A,e.A.wrap=L.A,globalThis.TC=globalThis.TC||e.A,e.A.version="4.6.0",e.A.loadCSS(e.A.apiLocation+"css/sitna.css"),Object.prototype.hasOwnProperty.call(Array.prototype,"findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var r=0;r<this.length;r++)if(this[r][e]==t)return this[r]}}),document.addEventListener("DOMContentLoaded",(function(){var n,i,o="Unknown library";if(window.ol&&(o="OpenLayers "+ol.VERSION),e.A.version=e.A.version+" ("+o+"; @ "+e.A.apiLocation+")",e.A.browser=t.A.getBrowser(),fetch(e.A.apiLocation+"config/browser-versions.json").then((e=>e.ok?e.json():Promise.resolve([]))).then((n=>{e.A._isSupported=!0,e.A.Cfg.acceptedBrowserVersions=n;const i=n.find((t=>t.name.toLowerCase()===e.A.browser.name.toLowerCase()));i&&i.expired?e.A.Cfg.loggingErrorsEnabled=!1:(i&&!Number.isNaN(i.version)&&e.A.browser.version<i.version&&(e.A._isSupported=!1),e.A.Cfg.oldBrowserAlert&&!e.A._isSupported&&(e.A.Cfg.loggingErrorsEnabled=!1,setTimeout((()=>{const n=e.A.Map.get(document.querySelector("."+r.A.classes.MAP));e.A.i18n.loadResources(!e.A.i18n[n.options.locale],e.A.apiLocation+"TC/resources/",n.options.locale).then((function(){e.A.error(t.A.getLocaleString(n.options.locale,"outdatedBrowser"),r.A.msgErrorMode.TOAST)}))}),500)))})),/ip(ad|hone|od)/i.test(navigator.userAgent)&&(r.A.event.CLICK="touchstart"),e.A.Cfg.loggingErrorsEnabled){C.JL.setOptions({defaultAjaxUrl:r.A.url.ERROR_LOGGER.includes("//localhost")?"":r.A.url.ERROR_LOGGER});const o=(i=0,function(o){if(!(n=n||e.A.Map.get(document.querySelector("."+r.A.classes.MAP))))return!1;var a,s,l,c="",u=-1,h=-1;if("unhandledrejection"===o.type?(a=o.reason?o.reason instanceof XMLDocument?o.reason.firstElementChild.outerHTML:o.reason.message:"",l=!o.reason||!o.reason.stack||o.reason.stack.indexOf(e.A.apiLocation)>=0,s=o.reason):(a=o.message,c=o.filename,u=o.lineno,h=o.colno,s=o.error,l=c.indexOf(e.A.apiLocation)>=0),(e.A.Cfg.notifyApplicationErrors||l)&&i<e.A.Cfg.maxErrorCount&&e.A.Cfg.loggingErrorsEnabled){const o=n.getPreviousMapState(),p=function(t){var n=l?r.A.text.API_ERROR:r.A.text.APP_ERROR;(0,C.JL)("onerrorLogger").fatalException({msg:n,errorMsg:a,url:c,lineNumber:u,column:h,appUrl:t,apiVersion:e.A.version,prevState:o,userAgent:navigator.userAgent},s),i++};let g=location.href;const f=n.exportControlStates()||[];if(f.length>0){var d=location.href;const e=d.indexOf("#");e>0&&(d=d.substring(0,e)),n.getMapState({extraStates:{ctl:f}}).then((e=>{g=d.concat("#",e),p(g)}))}else p(g);e.A.isDebug||e.A.i18n.loadResources(!e.A.i18n[n.options.locale],e.A.apiLocation+"TC/resources/",n.options.locale).then((function(){e.A.error(t.A.getLocaleString(n.options.locale,"genericError")+(n.options.contactEmail||"webmaster@itracasa.es"),{type:r.A.msgType.ERROR})}))}return!1});window.addEventListener("error",o,!1),window.addEventListener("unhandledrejection",o,!1)}})),i.A.layout=e.A.apiLocation+"layout/responsive",globalThis.SITNA={Cfg:i.A,Map:u,Consts:r.A,feature:I,layer:M};const O={id:"bike-lanes",type:SITNA.Consts.layerType.WMS,url:"https://idena.navarra.es/ogc/wms",layerNames:"IDENA:INFRAE_Lin_TrazadoSIGMC",title:"Bike Lanes",opacity:.8,legends:!0};new SITNA.Map("mapa",{baseLayer:"default",center:[-1.645,42.816],zoom:10}).addLayer(O).then((()=>{console.log("---\x3e Capa de carriles bici añadida con éxito!")})).catch((e=>{console.error("Error añadiendo la capa de carriles bici:",e)}))})()})();