import GeoJSON_ from"ol/format/GeoJSON.js";import Feature from"ol/Feature.js";import RenderFeature from"ol/render/Feature.js";import{createGeometry,createRenderFeature,transformGeometryWithOptions}from"ol/format/Feature.js";import{deflateCoordinatesArray,deflateMultiCoordinatesArray}from"ol/geom/flat/deflate.js";import{getLayoutForStride}from"ol/geom/SimpleGeometry.js";import Geometry from"ol/geom/Geometry.js";import{isEmpty}from"ol/obj.js";const filterProperties=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map((e=>filterProperties(e)));const t={};for(const r in e){const o=e[r];o instanceof Geometry||(t[r]=filterProperties(o))}return t};class GeoJSON extends GeoJSON_{readFeatureFromObject(e,t){let r=null;r="Feature"===e.type?e:{type:"Feature",geometry:e,properties:null};const o=r.geometry?.coordinates?.length?readGeometryInternal(r.geometry,t):null;if(this.featureClass===RenderFeature)return createRenderFeature({geometry:o,id:r.id,properties:r.properties},t);const n=new Feature;return this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&n.setGeometryName(r.geometry_name),n.setGeometry(createGeometry(o,t)),"id"in r&&n.setId(r.id),r.properties&&n.setProperties(r.properties,!0),n}writeFeatureObject(e,t){t=this.adaptOptions(t);const r={type:"Feature",geometry:null,properties:null},o=e.getId();if(void 0!==o&&(r.id=o),!e.hasProperties())return r;const n=e.getProperties(),i=e.getGeometry();return i&&(r.geometry=writeGeometry(i,t),delete n[e.getGeometryName()]),isEmpty(n)||(r.properties=filterProperties(n)),r}}function readGeometryInternal(e,t){if(!e)return null;let r;switch(e.type){case"Point":r=readPointGeometry(e);break;case"LineString":r=readLineStringGeometry(e);break;case"Polygon":r=readPolygonGeometry(e);break;case"MultiPoint":r=readMultiPointGeometry(e);break;case"MultiLineString":r=readMultiLineStringGeometry(e);break;case"MultiPolygon":r=readMultiPolygonGeometry(e);break;case"GeometryCollection":r=readGeometryCollectionGeometry(e);break;default:throw new Error("Unsupported GeoJSON type: "+e.type)}return r}function readGeometryCollectionGeometry(e,t){return e.geometries.map((function(e){return readGeometryInternal(e,t)}))}function readPointGeometry(e){const t=e.coordinates;return{type:"Point",flatCoordinates:t,layout:getLayoutForStride(t.length)}}function readLineStringGeometry(e){const t=e.coordinates,r=t.flat();return{type:"LineString",flatCoordinates:r,ends:[r.length],layout:getLayoutForStride(t[0].length)}}function readMultiLineStringGeometry(e){const t=e.coordinates,r=t[0][0].length,o=[];return{type:"MultiLineString",flatCoordinates:o,ends:deflateCoordinatesArray(o,0,t,r),layout:getLayoutForStride(r)}}function readMultiPointGeometry(e){const t=e.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:getLayoutForStride(t[0].length)}}function readMultiPolygonGeometry(e){const t=e.coordinates,r=[],o=t[0][0][0].length;return{type:"MultiPolygon",flatCoordinates:r,ends:deflateMultiCoordinatesArray(r,0,t,o),layout:getLayoutForStride(o)}}function readPolygonGeometry(e){const t=e.coordinates,r=[],o=t[0][0].length;return{type:"Polygon",flatCoordinates:r,ends:deflateCoordinatesArray(r,0,t,o),layout:getLayoutForStride(o)}}function writeGeometry(e,t){const r=(e=transformGeometryWithOptions(e,!0,t)).getType();let o;switch(r){case"Point":o=writePointGeometry(e,t);break;case"LineString":o=writeLineStringGeometry(e,t);break;case"Polygon":o=writePolygonGeometry(e,t);break;case"MultiPoint":o=writeMultiPointGeometry(e,t);break;case"MultiLineString":o=writeMultiLineStringGeometry(e,t);break;case"MultiPolygon":o=writeMultiPolygonGeometry(e,t);break;case"GeometryCollection":o=writeGeometryCollectionGeometry(e,t);break;case"Circle":o={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+r)}return o}function writeGeometryCollectionGeometry(e,t){return delete(t=Object.assign({},t)).featureProjection,{type:"GeometryCollection",geometries:e.getGeometriesArray().map((function(e){return writeGeometry(e,t)}))}}function writeLineStringGeometry(e,t){return{type:"LineString",coordinates:e.getCoordinates()}}function writeMultiLineStringGeometry(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}}function writeMultiPointGeometry(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}}function writeMultiPolygonGeometry(e,t){let r;return t&&(r=t.rightHanded),{type:"MultiPolygon",coordinates:e.getCoordinates(r)}}function writePointGeometry(e,t){return{type:"Point",coordinates:e.getCoordinates()}}function writePolygonGeometry(e,t){let r;return t&&(r=t.rightHanded),{type:"Polygon",coordinates:e.getCoordinates(r)}}export default GeoJSON;