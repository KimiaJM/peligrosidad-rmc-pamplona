var exports,define,__extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n};function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,r=0;r<this.length;r++)n=e(n,this[r],r,this);return n});var t="";return("."+e).split(".").reduce((function(e,n,r,i){return void 0===(n=e["__"+(t=t?t+"."+n:n)])&&(JL.Logger.prototype=e,n=new JL.Logger(t),e["__"+t]=n),n}),JL.__)}!function(e){function t(e,t,n){void 0!==t[e]&&(null===t[e]?delete n[e]:n[e]=t[e])}function n(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function o(e){switch(typeof(e=i(e))){case"string":return new s(e,null,e);case"number":case"boolean":return e=e.toString(),new s(e,null,e);case"undefined":return new s("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new s(e,null,e)):new s(null,e,JSON.stringify(e));default:return new s("unknown",null,"unknown")}}e.enabled,e.maxMessages,e.defaultAjaxUrl,e.clientIP,e.defaultBeforeSend,e.requestId="";var s=function(e,t,n){this.msg=e,this.meta=t,this.finalString=n};e.setOptions=function(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),this},e.getAllLevel=function(){return-2147483648},e.getTraceLevel=function(){return 1e3},e.getDebugLevel=function(){return 2e3},e.getInfoLevel=function(){return 3e3},e.getWarnLevel=function(){return 4e3},e.getErrorLevel=function(){return 5e3},e.getFatalLevel=function(){return 6e3},e.getOffLevel=function(){return 2147483647};var u=function(e,t){this.inner=t,this.name="JL.Exception",this.message=o(e).finalString};e.Exception=u,u.prototype=Error();var f=function(e,t,n,r){this.l=e,this.m=t,this.n=n,this.t=r};e.LogItem=f,u=function(){function i(t,n){this.appenderName=t,this.sendLogItems=n,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.buffer=[],this.batchBuffer=[]}return i.prototype.setOptions=function(e){return t("level",e,this),t("ipRegex",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("sendWithBufferLevel",e,this),t("storeInBufferLevel",e,this),t("bufferSize",e,this),t("batchSize",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this},i.prototype.log=function(e,t,i,o,s,u,l){!n(this)||!r(this,u)||s<this.storeInBufferLevel||(e=new f(s,u,l,(new Date).getTime()),s<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(s<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))},i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)},i}(),e.Appender=u;var l=function(n){function r(e){n.call(this,e,r.prototype.sendLogItemsAjax)}return __extends(r,n),r.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),n.prototype.setOptions.call(this,e),this},r.prototype.sendLogItemsAjax=function(t){try{var n="/jsnlog.logger";null!=e.defaultAjaxUrl&&(n=e.defaultAjaxUrl),this.url&&(n=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(n);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i),i.send(r)}catch(e){}},r.prototype.getXhr=function(t){var n=new XMLHttpRequest;return"withCredentials"in n||"undefined"==typeof XDomainRequest?(n.open("POST",t),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("JSNLog-RequestId",e.requestId),n):((n=new XDomainRequest).open("POST",t),n)},r}(u);e.AjaxAppender=l;var a=function(t){function n(e){t.call(this,e,n.prototype.sendLogItemsConsole)}return __extends(n,t),n.prototype.clog=function(e){console.log(e)},n.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)},n.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)},n.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)},n.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)},n.prototype.sendLogItemsConsole=function(t){try{var n;if(console)for(n=0;n<t.length;++n){var r=t[n],i=r.n+": "+r.m;"undefined"==typeof window&&(i=new Date(r.t)+" | "+i),r.l<=e.getDebugLevel()?this.cdebug(i):r.l<=e.getInfoLevel()?this.cinfo(i):r.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}catch(e){}},n}(u);e.ConsoleAppender=a,u=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,s){var u=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(s?(u=this.buildExceptionObject(s)).logData=i(t):u=t,r(this,(t=o(u)).finalString))){if(this.onceOnly)for(u=this.onceOnly.length-1;0<=u;){if(RegExp(this.onceOnly[u]).test(t.finalString)){if(this.seenRegexes[u])return this;this.seenRegexes[u]=!0}u--}for(t.meta=t.meta||{},t.meta.loggerName=this.loggerName,u=this.appenders.length-1;0<=u;)this.appenders[u].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,(function(){}),e,t.finalString,this.loggerName),u--}return this},e.prototype.trace=function(e){return this.log(1e3,e)},e.prototype.debug=function(e){return this.log(2e3,e)},e.prototype.info=function(e){return this.log(3e3,e)},e.prototype.warn=function(e){return this.log(4e3,e)},e.prototype.error=function(e){return this.log(5e3,e)},e.prototype.fatal=function(e){return this.log(6e3,e)},e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)},e}(),e.Logger=u,e.createAjaxAppender=function(e){return new l(e)},e.createConsoleAppender=function(e){return new a(e)},u=new l(""),"undefined"==typeof window&&(u=new a("")),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[u]})}(JL||(JL={})),void 0!==exports&&(exports.JL=JL),"function"==typeof define&&define.amd&&define("jsnlog",[],(function(){return JL})),"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);