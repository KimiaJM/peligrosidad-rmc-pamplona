var JL,exports,define,__extends=this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r};function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,r=0;r<this.length;r++)n=e(n,this[r],r,this);return n});var t="";return("."+e).split(".").reduce((function(e,n,r,i){t?t+="."+n:t=n;var o=e["__"+t];return void 0===o&&(JL.Logger.prototype=e,o=new JL.Logger(t),e["__"+t]=o),o}),JL.__)}!function(e){function t(e,t,n){void 0!==t[e]&&(null!==t[e]?n[e]=t[e]:delete n[e])}function n(t){if(null!=e.enabled&&!e.enabled)return!1;if(null!=e.maxMessages&&e.maxMessages<1)return!1;try{if(t.userAgentRegex&&!new RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!new RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&new RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}e.enabled,e.maxMessages,e.defaultAjaxUrl,e.clientIP,e.defaultBeforeSend,e.requestId="";var o=function(e,t,n){this.msg=e,this.meta=t,this.finalString=n};function s(e){var t,n=i(e);switch(typeof n){case"string":return new o(n,null,n);case"number":case"boolean":return t=n.toString(),new o(t,null,t);case"undefined":return new o("undefined",null,"undefined");case"object":return n instanceof RegExp||n instanceof String||n instanceof Number||n instanceof Boolean?(t=n.toString(),new o(t,null,t)):new o(null,n,JSON.stringify(n));default:return new o("unknown",null,"unknown")}}function u(e){return e<=1e3?"trace":e<=2e3?"debug":e<=3e3?"info":e<=4e3?"warn":e<=5e3?"error":"fatal"}e.setOptions=function(e){return t("enabled",e,this),t("maxMessages",e,this),t("defaultAjaxUrl",e,this),t("clientIP",e,this),t("requestId",e,this),t("defaultBeforeSend",e,this),this},e.getAllLevel=function(){return-2147483648},e.getTraceLevel=function(){return 1e3},e.getDebugLevel=function(){return 2e3},e.getInfoLevel=function(){return 3e3},e.getWarnLevel=function(){return 4e3},e.getErrorLevel=function(){return 5e3},e.getFatalLevel=function(){return 6e3},e.getOffLevel=function(){return 2147483647};var f=function(e,t){this.inner=t,this.name="JL.Exception",this.message=s(e).finalString};e.Exception=f,f.prototype=new Error;var a=function(e,t,n,r){this.l=e,this.m=t,this.n=n,this.t=r};e.LogItem=a;var l=function(){function i(t,n){this.appenderName=t,this.sendLogItems=n,this.level=e.getTraceLevel(),this.sendWithBufferLevel=2147483647,this.storeInBufferLevel=-2147483648,this.bufferSize=0,this.batchSize=1,this.buffer=[],this.batchBuffer=[]}return i.prototype.setOptions=function(e){return t("level",e,this),t("ipRegex",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("sendWithBufferLevel",e,this),t("storeInBufferLevel",e,this),t("bufferSize",e,this),t("batchSize",e,this),this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize),this},i.prototype.log=function(e,t,i,o,s,u,f){var l;n(this)&&r(this,u)&&(s<this.storeInBufferLevel||(l=new a(s,u,f,(new Date).getTime()),s<this.level?this.bufferSize>0&&(this.buffer.push(l),this.buffer.length>this.bufferSize&&this.buffer.shift()):(s<this.sendWithBufferLevel||this.buffer.length&&(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(l),this.batchBuffer.length>=this.batchSize&&this.sendBatch())))},i.prototype.sendBatch=function(){0!=this.batchBuffer.length&&(null!=e.maxMessages&&e.maxMessages<1||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0))},i}();e.Appender=l;var h=function(n){function r(e){n.call(this,e,r.prototype.sendLogItemsAjax)}return __extends(r,n),r.prototype.setOptions=function(e){return t("url",e,this),t("beforeSend",e,this),n.prototype.setOptions.call(this,e),this},r.prototype.sendLogItemsAjax=function(t){try{var n="/jsnlog.logger";null!=e.defaultAjaxUrl&&(n=e.defaultAjaxUrl),this.url&&(n=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(n);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i),i.send(r)}catch(e){}},r.prototype.getXhr=function(t){var n=new XMLHttpRequest;if(!("withCredentials"in n)&&"undefined"!=typeof XDomainRequest){var r=new XDomainRequest;return r.open("POST",t),r}return n.open("POST",t),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("JSNLog-RequestId",e.requestId),n},r}(l);e.AjaxAppender=h;var c=function(t){function n(e){t.call(this,e,n.prototype.sendLogItemsConsole)}return __extends(n,t),n.prototype.clog=function(e){console.log(e)},n.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)},n.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)},n.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)},n.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)},n.prototype.sendLogItemsConsole=function(t){try{if(!console)return;var n;for(n=0;n<t.length;++n){var r=t[n],i=r.n+": "+r.m;"undefined"==typeof window&&(i=new Date(r.t)+" | "+i),r.l<=e.getDebugLevel()?this.cdebug(i):r.l<=e.getInfoLevel()?this.cinfo(i):r.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}catch(e){}},n}(l);e.ConsoleAppender=c;var g=function(){function e(e){this.loggerName=e,this.seenRegexes=[]}return e.prototype.setOptions=function(e){return t("level",e,this),t("userAgentRegex",e,this),t("disallow",e,this),t("ipRegex",e,this),t("appenders",e,this),t("onceOnly",e,this),this.seenRegexes=[],this},e.prototype.buildExceptionObject=function(e){var t={};return e.stack?t.stack=e.stack:t.e=e,e.message&&(t.message=e.message),e.name&&(t.name=e.name),e.data&&(t.data=e.data),e.inner&&(t.inner=this.buildExceptionObject(e.inner)),t},e.prototype.log=function(e,t,o){var f,a,l=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(o?(a=this.buildExceptionObject(o)).logData=i(t):a=t,r(this,(f=s(a)).finalString))){if(this.onceOnly)for(l=this.onceOnly.length-1;l>=0;){if(new RegExp(this.onceOnly[l]).test(f.finalString)){if(this.seenRegexes[l])return this;this.seenRegexes[l]=!0}l--}for(f.meta=f.meta||{},f.meta.loggerName=this.loggerName,l=this.appenders.length-1;l>=0;)this.appenders[l].log(u(e),f.msg,f.meta,(function(){}),e,f.finalString,this.loggerName),l--}return this},e.prototype.trace=function(e){return this.log(1e3,e)},e.prototype.debug=function(e){return this.log(2e3,e)},e.prototype.info=function(e){return this.log(3e3,e)},e.prototype.warn=function(e){return this.log(4e3,e)},e.prototype.error=function(e){return this.log(5e3,e)},e.prototype.fatal=function(e){return this.log(6e3,e)},e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)},e}();e.Logger=g,e.createAjaxAppender=function(e){return new h(e)},e.createConsoleAppender=function(e){return new c(e)};var p=new h("");"undefined"==typeof window&&(p=new c("")),e.__=new e.Logger(""),e.__.setOptions({level:e.getDebugLevel(),appenders:[p]})}(JL||(JL={})),void 0!==exports&&(exports.JL=JL),"function"==typeof define&&define.amd&&define("jsnlog",[],(function(){return JL})),"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);